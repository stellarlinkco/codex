const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/xml-sdJ4AIDG.js","assets/java-CylS5w8V.js","assets/html-GMplVEZG.js","assets/javascript-wDzz0qaB.js","assets/css-DPfMkruS.js","assets/scss-OYdSNvt2.js","assets/graphql-ChdNCCLP.js","assets/typescript-BPQ3VLAy.js","assets/jsx-g9-lgVsj.js","assets/tsx-COt5Ahok.js","assets/php-Dhbhpdrm.js","assets/sql-BLtJtn59.js","assets/json-Cp-IABpG.js"])))=>i.map(i=>d[i]);
function o4(e,t){for(var n=0;n<t.length;n++){const i=t[n];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in e)){const r=Object.getOwnPropertyDescriptor(i,s);r&&Object.defineProperty(e,s,r.get?r:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function Ga(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Bb={exports:{}},Mu={};var uT;function a4(){if(uT)return Mu;uT=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(i,s,r){var a=null;if(r!==void 0&&(a=""+r),s.key!==void 0&&(a=""+s.key),"key"in s){r={};for(var o in s)o!=="key"&&(r[o]=s[o])}else r=s;return s=r.ref,{$$typeof:e,type:i,key:a,ref:s!==void 0?s:null,props:r}}return Mu.Fragment=t,Mu.jsx=n,Mu.jsxs=n,Mu}var dT;function l4(){return dT||(dT=1,Bb.exports=a4()),Bb.exports}var b=l4(),Fb={exports:{}},Je={};var hT;function c4(){if(hT)return Je;hT=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),m=Symbol.iterator;function g(z){return z===null||typeof z!="object"?null:(z=m&&z[m]||z["@@iterator"],typeof z=="function"?z:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,v={};function _(z,G,H){this.props=z,this.context=G,this.refs=v,this.updater=H||C}_.prototype.isReactComponent={},_.prototype.setState=function(z,G){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,G,"setState")},_.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function w(){}w.prototype=_.prototype;function x(z,G,H){this.props=z,this.context=G,this.refs=v,this.updater=H||C}var k=x.prototype=new w;k.constructor=x,S(k,_.prototype),k.isPureReactComponent=!0;var A=Array.isArray;function T(){}var M={H:null,A:null,T:null,S:null},E=Object.prototype.hasOwnProperty;function L(z,G,H){var ee=H.ref;return{$$typeof:e,type:z,key:G,ref:ee!==void 0?ee:null,props:H}}function D(z,G){return L(z.type,G,z.props)}function O(z){return typeof z=="object"&&z!==null&&z.$$typeof===e}function j(z){var G={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(H){return G[H]})}var U=/\/+/g;function q(z,G){return typeof z=="object"&&z!==null&&z.key!=null?j(""+z.key):G.toString(36)}function K(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(T,T):(z.status="pending",z.then(function(G){z.status==="pending"&&(z.status="fulfilled",z.value=G)},function(G){z.status==="pending"&&(z.status="rejected",z.reason=G)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function $(z,G,H,ee,ue){var ce=typeof z;(ce==="undefined"||ce==="boolean")&&(z=null);var J=!1;if(z===null)J=!0;else switch(ce){case"bigint":case"string":case"number":J=!0;break;case"object":switch(z.$$typeof){case e:case t:J=!0;break;case h:return J=z._init,$(J(z._payload),G,H,ee,ue)}}if(J)return ue=ue(z),J=ee===""?"."+q(z,0):ee,A(ue)?(H="",J!=null&&(H=J.replace(U,"$&/")+"/"),$(ue,G,H,"",function(he){return he})):ue!=null&&(O(ue)&&(ue=D(ue,H+(ue.key==null||z&&z.key===ue.key?"":(""+ue.key).replace(U,"$&/")+"/")+J)),G.push(ue)),1;J=0;var V=ee===""?".":ee+":";if(A(z))for(var ne=0;ne<z.length;ne++)ee=z[ne],ce=V+q(ee,ne),J+=$(ee,G,H,ce,ue);else if(ne=g(z),typeof ne=="function")for(z=ne.call(z),ne=0;!(ee=z.next()).done;)ee=ee.value,ce=V+q(ee,ne++),J+=$(ee,G,H,ce,ue);else if(ce==="object"){if(typeof z.then=="function")return $(K(z),G,H,ee,ue);throw G=String(z),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return J}function Y(z,G,H){if(z==null)return z;var ee=[],ue=0;return $(z,ee,"","",function(ce){return G.call(H,ce,ue++)}),ee}function Q(z){if(z._status===-1){var G=z._result;G=G(),G.then(function(H){(z._status===0||z._status===-1)&&(z._status=1,z._result=H)},function(H){(z._status===0||z._status===-1)&&(z._status=2,z._result=H)}),z._status===-1&&(z._status=0,z._result=G)}if(z._status===1)return z._result.default;throw z._result}var F=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},N={map:Y,forEach:function(z,G,H){Y(z,function(){G.apply(this,arguments)},H)},count:function(z){var G=0;return Y(z,function(){G++}),G},toArray:function(z){return Y(z,function(G){return G})||[]},only:function(z){if(!O(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return Je.Activity=f,Je.Children=N,Je.Component=_,Je.Fragment=n,Je.Profiler=s,Je.PureComponent=x,Je.StrictMode=i,Je.Suspense=l,Je.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,Je.__COMPILER_RUNTIME={__proto__:null,c:function(z){return M.H.useMemoCache(z)}},Je.cache=function(z){return function(){return z.apply(null,arguments)}},Je.cacheSignal=function(){return null},Je.cloneElement=function(z,G,H){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var ee=S({},z.props),ue=z.key;if(G!=null)for(ce in G.key!==void 0&&(ue=""+G.key),G)!E.call(G,ce)||ce==="key"||ce==="__self"||ce==="__source"||ce==="ref"&&G.ref===void 0||(ee[ce]=G[ce]);var ce=arguments.length-2;if(ce===1)ee.children=H;else if(1<ce){for(var J=Array(ce),V=0;V<ce;V++)J[V]=arguments[V+2];ee.children=J}return L(z.type,ue,ee)},Je.createContext=function(z){return z={$$typeof:a,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:r,_context:z},z},Je.createElement=function(z,G,H){var ee,ue={},ce=null;if(G!=null)for(ee in G.key!==void 0&&(ce=""+G.key),G)E.call(G,ee)&&ee!=="key"&&ee!=="__self"&&ee!=="__source"&&(ue[ee]=G[ee]);var J=arguments.length-2;if(J===1)ue.children=H;else if(1<J){for(var V=Array(J),ne=0;ne<J;ne++)V[ne]=arguments[ne+2];ue.children=V}if(z&&z.defaultProps)for(ee in J=z.defaultProps,J)ue[ee]===void 0&&(ue[ee]=J[ee]);return L(z,ce,ue)},Je.createRef=function(){return{current:null}},Je.forwardRef=function(z){return{$$typeof:o,render:z}},Je.isValidElement=O,Je.lazy=function(z){return{$$typeof:h,_payload:{_status:-1,_result:z},_init:Q}},Je.memo=function(z,G){return{$$typeof:u,type:z,compare:G===void 0?null:G}},Je.startTransition=function(z){var G=M.T,H={};M.T=H;try{var ee=z(),ue=M.S;ue!==null&&ue(H,ee),typeof ee=="object"&&ee!==null&&typeof ee.then=="function"&&ee.then(T,F)}catch(ce){F(ce)}finally{G!==null&&H.types!==null&&(G.types=H.types),M.T=G}},Je.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},Je.use=function(z){return M.H.use(z)},Je.useActionState=function(z,G,H){return M.H.useActionState(z,G,H)},Je.useCallback=function(z,G){return M.H.useCallback(z,G)},Je.useContext=function(z){return M.H.useContext(z)},Je.useDebugValue=function(){},Je.useDeferredValue=function(z,G){return M.H.useDeferredValue(z,G)},Je.useEffect=function(z,G){return M.H.useEffect(z,G)},Je.useEffectEvent=function(z){return M.H.useEffectEvent(z)},Je.useId=function(){return M.H.useId()},Je.useImperativeHandle=function(z,G,H){return M.H.useImperativeHandle(z,G,H)},Je.useInsertionEffect=function(z,G){return M.H.useInsertionEffect(z,G)},Je.useLayoutEffect=function(z,G){return M.H.useLayoutEffect(z,G)},Je.useMemo=function(z,G){return M.H.useMemo(z,G)},Je.useOptimistic=function(z,G){return M.H.useOptimistic(z,G)},Je.useReducer=function(z,G,H){return M.H.useReducer(z,G,H)},Je.useRef=function(z){return M.H.useRef(z)},Je.useState=function(z){return M.H.useState(z)},Je.useSyncExternalStore=function(z,G,H){return M.H.useSyncExternalStore(z,G,H)},Je.useTransition=function(){return M.H.useTransition()},Je.version="19.2.4",Je}var fT;function Zd(){return fT||(fT=1,Fb.exports=c4()),Fb.exports}var P=Zd();const Un=Ga(P),rS=o4({__proto__:null,default:Un},[P]);var Ub={exports:{}},Lu={},zb={exports:{}},Hb={};var pT;function u4(){return pT||(pT=1,(function(e){function t($,Y){var Q=$.length;$.push(Y);e:for(;0<Q;){var F=Q-1>>>1,N=$[F];if(0<s(N,Y))$[F]=Y,$[Q]=N,Q=F;else break e}}function n($){return $.length===0?null:$[0]}function i($){if($.length===0)return null;var Y=$[0],Q=$.pop();if(Q!==Y){$[0]=Q;e:for(var F=0,N=$.length,z=N>>>1;F<z;){var G=2*(F+1)-1,H=$[G],ee=G+1,ue=$[ee];if(0>s(H,Q))ee<N&&0>s(ue,H)?($[F]=ue,$[ee]=Q,F=ee):($[F]=H,$[G]=Q,F=G);else if(ee<N&&0>s(ue,Q))$[F]=ue,$[ee]=Q,F=ee;else break e}}return Y}function s($,Y){var Q=$.sortIndex-Y.sortIndex;return Q!==0?Q:$.id-Y.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;e.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,f=null,m=3,g=!1,C=!1,S=!1,v=!1,_=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;function k($){for(var Y=n(u);Y!==null;){if(Y.callback===null)i(u);else if(Y.startTime<=$)i(u),Y.sortIndex=Y.expirationTime,t(l,Y);else break;Y=n(u)}}function A($){if(S=!1,k($),!C)if(n(l)!==null)C=!0,T||(T=!0,j());else{var Y=n(u);Y!==null&&K(A,Y.startTime-$)}}var T=!1,M=-1,E=5,L=-1;function D(){return v?!0:!(e.unstable_now()-L<E)}function O(){if(v=!1,T){var $=e.unstable_now();L=$;var Y=!0;try{e:{C=!1,S&&(S=!1,w(M),M=-1),g=!0;var Q=m;try{t:{for(k($),f=n(l);f!==null&&!(f.expirationTime>$&&D());){var F=f.callback;if(typeof F=="function"){f.callback=null,m=f.priorityLevel;var N=F(f.expirationTime<=$);if($=e.unstable_now(),typeof N=="function"){f.callback=N,k($),Y=!0;break t}f===n(l)&&i(l),k($)}else i(l);f=n(l)}if(f!==null)Y=!0;else{var z=n(u);z!==null&&K(A,z.startTime-$),Y=!1}}break e}finally{f=null,m=Q,g=!1}Y=void 0}}finally{Y?j():T=!1}}}var j;if(typeof x=="function")j=function(){x(O)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,q=U.port2;U.port1.onmessage=O,j=function(){q.postMessage(null)}}else j=function(){_(O,0)};function K($,Y){M=_(function(){$(e.unstable_now())},Y)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function($){$.callback=null},e.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<$?Math.floor(1e3/$):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_next=function($){switch(m){case 1:case 2:case 3:var Y=3;break;default:Y=m}var Q=m;m=Y;try{return $()}finally{m=Q}},e.unstable_requestPaint=function(){v=!0},e.unstable_runWithPriority=function($,Y){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var Q=m;m=$;try{return Y()}finally{m=Q}},e.unstable_scheduleCallback=function($,Y,Q){var F=e.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?F+Q:F):Q=F,$){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=Q+N,$={id:h++,callback:Y,priorityLevel:$,startTime:Q,expirationTime:N,sortIndex:-1},Q>F?($.sortIndex=Q,t(u,$),n(l)===null&&$===n(u)&&(S?(w(M),M=-1):S=!0,K(A,Q-F))):($.sortIndex=N,t(l,$),C||g||(C=!0,T||(T=!0,j()))),$},e.unstable_shouldYield=D,e.unstable_wrapCallback=function($){var Y=m;return function(){var Q=m;m=Y;try{return $.apply(this,arguments)}finally{m=Q}}}})(Hb)),Hb}var mT;function d4(){return mT||(mT=1,zb.exports=u4()),zb.exports}var $b={exports:{}},Nn={};var gT;function h4(){if(gT)return Nn;gT=1;var e=Zd();function t(l){var u="https://react.dev/errors/"+l;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)u+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(l,u,h){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:f==null?null:""+f,children:l,containerInfo:u,implementation:h}}var a=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,u){if(l==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Nn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Nn.createPortal=function(l,u){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(t(299));return r(l,u,null,h)},Nn.flushSync=function(l){var u=a.T,h=i.p;try{if(a.T=null,i.p=2,l)return l()}finally{a.T=u,i.p=h,i.d.f()}},Nn.preconnect=function(l,u){typeof l=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,i.d.C(l,u))},Nn.prefetchDNS=function(l){typeof l=="string"&&i.d.D(l)},Nn.preinit=function(l,u){if(typeof l=="string"&&u&&typeof u.as=="string"){var h=u.as,f=o(h,u.crossOrigin),m=typeof u.integrity=="string"?u.integrity:void 0,g=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;h==="style"?i.d.S(l,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:f,integrity:m,fetchPriority:g}):h==="script"&&i.d.X(l,{crossOrigin:f,integrity:m,fetchPriority:g,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Nn.preinitModule=function(l,u){if(typeof l=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var h=o(u.as,u.crossOrigin);i.d.M(l,{crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&i.d.M(l)},Nn.preload=function(l,u){if(typeof l=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var h=u.as,f=o(h,u.crossOrigin);i.d.L(l,h,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Nn.preloadModule=function(l,u){if(typeof l=="string")if(u){var h=o(u.as,u.crossOrigin);i.d.m(l,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else i.d.m(l)},Nn.requestFormReset=function(l){i.d.r(l)},Nn.unstable_batchedUpdates=function(l,u){return l(u)},Nn.useFormState=function(l,u,h){return a.H.useFormState(l,u,h)},Nn.useFormStatus=function(){return a.H.useHostTransitionStatus()},Nn.version="19.2.4",Nn}var vT;function LL(){if(vT)return $b.exports;vT=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),$b.exports=h4(),$b.exports}var bT;function f4(){if(bT)return Lu;bT=1;var e=d4(),t=Zd(),n=LL();function i(c){var d="https://react.dev/errors/"+c;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+c+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function r(c){var d=c,p=c;if(c.alternate)for(;d.return;)d=d.return;else{c=d;do d=c,(d.flags&4098)!==0&&(p=d.return),c=d.return;while(c)}return d.tag===3?p:null}function a(c){if(c.tag===13){var d=c.memoizedState;if(d===null&&(c=c.alternate,c!==null&&(d=c.memoizedState)),d!==null)return d.dehydrated}return null}function o(c){if(c.tag===31){var d=c.memoizedState;if(d===null&&(c=c.alternate,c!==null&&(d=c.memoizedState)),d!==null)return d.dehydrated}return null}function l(c){if(r(c)!==c)throw Error(i(188))}function u(c){var d=c.alternate;if(!d){if(d=r(c),d===null)throw Error(i(188));return d!==c?null:c}for(var p=c,y=d;;){var R=p.return;if(R===null)break;var I=R.alternate;if(I===null){if(y=R.return,y!==null){p=y;continue}break}if(R.child===I.child){for(I=R.child;I;){if(I===p)return l(R),c;if(I===y)return l(R),d;I=I.sibling}throw Error(i(188))}if(p.return!==y.return)p=R,y=I;else{for(var B=!1,W=R.child;W;){if(W===p){B=!0,p=R,y=I;break}if(W===y){B=!0,y=R,p=I;break}W=W.sibling}if(!B){for(W=I.child;W;){if(W===p){B=!0,p=I,y=R;break}if(W===y){B=!0,y=I,p=R;break}W=W.sibling}if(!B)throw Error(i(189))}}if(p.alternate!==y)throw Error(i(190))}if(p.tag!==3)throw Error(i(188));return p.stateNode.current===p?c:d}function h(c){var d=c.tag;if(d===5||d===26||d===27||d===6)return c;for(c=c.child;c!==null;){if(d=h(c),d!==null)return d;c=c.sibling}return null}var f=Object.assign,m=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),x=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function j(c){return c===null||typeof c!="object"?null:(c=O&&c[O]||c["@@iterator"],typeof c=="function"?c:null)}var U=Symbol.for("react.client.reference");function q(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===U?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case S:return"Fragment";case _:return"Profiler";case v:return"StrictMode";case A:return"Suspense";case T:return"SuspenseList";case L:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case C:return"Portal";case x:return c.displayName||"Context";case w:return(c._context.displayName||"Context")+".Consumer";case k:var d=c.render;return c=c.displayName,c||(c=d.displayName||d.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case M:return d=c.displayName||null,d!==null?d:q(c.type)||"Memo";case E:d=c._payload,c=c._init;try{return q(c(d))}catch{}}return null}var K=Array.isArray,$=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},F=[],N=-1;function z(c){return{current:c}}function G(c){0>N||(c.current=F[N],F[N]=null,N--)}function H(c,d){N++,F[N]=c.current,c.current=d}var ee=z(null),ue=z(null),ce=z(null),J=z(null);function V(c,d){switch(H(ce,d),H(ue,c),H(ee,null),d.nodeType){case 9:case 11:c=(c=d.documentElement)&&(c=c.namespaceURI)?P1(c):0;break;default:if(c=d.tagName,d=d.namespaceURI)d=P1(d),c=D1(d,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}G(ee),H(ee,c)}function ne(){G(ee),G(ue),G(ce)}function he(c){c.memoizedState!==null&&H(J,c);var d=ee.current,p=D1(d,c.type);d!==p&&(H(ue,c),H(ee,p))}function _e(c){ue.current===c&&(G(ee),G(ue)),J.current===c&&(G(J),Tu._currentValue=Q)}var Ce,we;function Ee(c){if(Ce===void 0)try{throw Error()}catch(p){var d=p.stack.trim().match(/\n( *(at )?)/);Ce=d&&d[1]||"",we=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ce+c+we}var qe=!1;function yt(c,d){if(!c||qe)return"";qe=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var y={DetermineComponentFrameRoot:function(){try{if(d){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(de){var le=de}Reflect.construct(c,[],me)}else{try{me.call()}catch(de){le=de}c.call(me.prototype)}}else{try{throw Error()}catch(de){le=de}(me=c())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(de){if(de&&le&&typeof de.stack=="string")return[de.stack,le.stack]}return[null,null]}};y.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var R=Object.getOwnPropertyDescriptor(y.DetermineComponentFrameRoot,"name");R&&R.configurable&&Object.defineProperty(y.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var I=y.DetermineComponentFrameRoot(),B=I[0],W=I[1];if(B&&W){var Z=B.split(`
`),ae=W.split(`
`);for(R=y=0;y<Z.length&&!Z[y].includes("DetermineComponentFrameRoot");)y++;for(;R<ae.length&&!ae[R].includes("DetermineComponentFrameRoot");)R++;if(y===Z.length||R===ae.length)for(y=Z.length-1,R=ae.length-1;1<=y&&0<=R&&Z[y]!==ae[R];)R--;for(;1<=y&&0<=R;y--,R--)if(Z[y]!==ae[R]){if(y!==1||R!==1)do if(y--,R--,0>R||Z[y]!==ae[R]){var fe=`
`+Z[y].replace(" at new "," at ");return c.displayName&&fe.includes("<anonymous>")&&(fe=fe.replace("<anonymous>",c.displayName)),fe}while(1<=y&&0<=R);break}}}finally{qe=!1,Error.prepareStackTrace=p}return(p=c?c.displayName||c.name:"")?Ee(p):""}function Pe(c,d){switch(c.tag){case 26:case 27:case 5:return Ee(c.type);case 16:return Ee("Lazy");case 13:return c.child!==d&&d!==null?Ee("Suspense Fallback"):Ee("Suspense");case 19:return Ee("SuspenseList");case 0:case 15:return yt(c.type,!1);case 11:return yt(c.type.render,!1);case 1:return yt(c.type,!0);case 31:return Ee("Activity");default:return""}}function Ot(c){try{var d="",p=null;do d+=Pe(c,p),p=c,c=c.return;while(c);return d}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}var Nt=Object.prototype.hasOwnProperty,Qe=e.unstable_scheduleCallback,Ge=e.unstable_cancelCallback,Ke=e.unstable_shouldYield,Te=e.unstable_requestPaint,Fe=e.unstable_now,_t=e.unstable_getCurrentPriorityLevel,se=e.unstable_ImmediatePriority,ge=e.unstable_UserBlockingPriority,Me=e.unstable_NormalPriority,je=e.unstable_LowPriority,ze=e.unstable_IdlePriority,Ye=e.log,He=e.unstable_setDisableYieldValue,Yt=null,zt=null;function sn(c){if(typeof Ye=="function"&&He(c),zt&&typeof zt.setStrictMode=="function")try{zt.setStrictMode(Yt,c)}catch{}}var St=Math.clz32?Math.clz32:il,Wn=Math.log,Gn=Math.LN2;function il(c){return c>>>=0,c===0?32:31-(Wn(c)/Gn|0)|0}var ss=256,yi=262144,_i=4194304;function rs(c){var d=c&42;if(d!==0)return d;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function sl(c,d,p){var y=c.pendingLanes;if(y===0)return 0;var R=0,I=c.suspendedLanes,B=c.pingedLanes;c=c.warmLanes;var W=y&134217727;return W!==0?(y=W&~I,y!==0?R=rs(y):(B&=W,B!==0?R=rs(B):p||(p=W&~c,p!==0&&(R=rs(p))))):(W=y&~I,W!==0?R=rs(W):B!==0?R=rs(B):p||(p=y&~c,p!==0&&(R=rs(p)))),R===0?0:d!==0&&d!==R&&(d&I)===0&&(I=R&-R,p=d&-d,I>=p||I===32&&(p&4194048)!==0)?d:R}function Vo(c,d){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&d)===0}function Tg(c,d){switch(c){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mh(){var c=_i;return _i<<=1,(_i&62914560)===0&&(_i=4194304),c}function Le(c){for(var d=[],p=0;31>p;p++)d.push(c);return d}function Ze(c,d){c.pendingLanes|=d,d!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function Si(c,d,p,y,R,I){var B=c.pendingLanes;c.pendingLanes=p,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=p,c.entangledLanes&=p,c.errorRecoveryDisabledLanes&=p,c.shellSuspendCounter=0;var W=c.entanglements,Z=c.expirationTimes,ae=c.hiddenUpdates;for(p=B&~p;0<p;){var fe=31-St(p),me=1<<fe;W[fe]=0,Z[fe]=-1;var le=ae[fe];if(le!==null)for(ae[fe]=null,fe=0;fe<le.length;fe++){var de=le[fe];de!==null&&(de.lane&=-536870913)}p&=~me}y!==0&&Kn(c,y,0),I!==0&&R===0&&c.tag!==0&&(c.suspendedLanes|=I&~(B&~d))}function Kn(c,d,p){c.pendingLanes|=d,c.suspendedLanes&=~d;var y=31-St(d);c.entangledLanes|=d,c.entanglements[y]=c.entanglements[y]|1073741824|p&261930}function os(c,d){var p=c.entangledLanes|=d;for(c=c.entanglements;p;){var y=31-St(p),R=1<<y;R&d|c[y]&d&&(c[y]|=d),p&=~R}}function Wo(c,d){var p=d&-d;return p=(p&42)!==0?1:Eg(p),(p&(c.suspendedLanes|d))!==0?0:p}function Eg(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function Rg(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function bx(){var c=Y.p;return c!==0?c:(c=window.event,c===void 0?32:iT(c.type))}function yx(c,d){var p=Y.p;try{return Y.p=c,d()}finally{Y.p=p}}var Hr=Math.random().toString(36).slice(2),An="__reactFiber$"+Hr,ri="__reactProps$"+Hr,rl="__reactContainer$"+Hr,Ag="__reactEvents$"+Hr,Y3="__reactListeners$"+Hr,Q3="__reactHandles$"+Hr,_x="__reactResources$"+Hr,zc="__reactMarker$"+Hr;function Mg(c){delete c[An],delete c[ri],delete c[Ag],delete c[Y3],delete c[Q3]}function ol(c){var d=c[An];if(d)return d;for(var p=c.parentNode;p;){if(d=p[rl]||p[An]){if(p=d.alternate,d.child!==null||p!==null&&p.child!==null)for(c=z1(c);c!==null;){if(p=c[An])return p;c=z1(c)}return d}c=p,p=c.parentNode}return null}function al(c){if(c=c[An]||c[rl]){var d=c.tag;if(d===5||d===6||d===13||d===31||d===26||d===27||d===3)return c}return null}function Hc(c){var d=c.tag;if(d===5||d===26||d===27||d===6)return c.stateNode;throw Error(i(33))}function ll(c){var d=c[_x];return d||(d=c[_x]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function Cn(c){c[zc]=!0}var Sx=new Set,Cx={};function Go(c,d){cl(c,d),cl(c+"Capture",d)}function cl(c,d){for(Cx[c]=d,c=0;c<d.length;c++)Sx.add(d[c])}var J3=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xx={},wx={};function X3(c){return Nt.call(wx,c)?!0:Nt.call(xx,c)?!1:J3.test(c)?wx[c]=!0:(xx[c]=!0,!1)}function gh(c,d,p){if(X3(d))if(p===null)c.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":c.removeAttribute(d);return;case"boolean":var y=d.toLowerCase().slice(0,5);if(y!=="data-"&&y!=="aria-"){c.removeAttribute(d);return}}c.setAttribute(d,""+p)}}function vh(c,d,p){if(p===null)c.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(d);return}c.setAttribute(d,""+p)}}function sr(c,d,p,y){if(y===null)c.removeAttribute(p);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(p);return}c.setAttributeNS(d,p,""+y)}}function Ni(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function kx(c){var d=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function Z3(c,d,p){var y=Object.getOwnPropertyDescriptor(c.constructor.prototype,d);if(!c.hasOwnProperty(d)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var R=y.get,I=y.set;return Object.defineProperty(c,d,{configurable:!0,get:function(){return R.call(this)},set:function(B){p=""+B,I.call(this,B)}}),Object.defineProperty(c,d,{enumerable:y.enumerable}),{getValue:function(){return p},setValue:function(B){p=""+B},stopTracking:function(){c._valueTracker=null,delete c[d]}}}}function Lg(c){if(!c._valueTracker){var d=kx(c)?"checked":"value";c._valueTracker=Z3(c,d,""+c[d])}}function Tx(c){if(!c)return!1;var d=c._valueTracker;if(!d)return!0;var p=d.getValue(),y="";return c&&(y=kx(c)?c.checked?"true":"false":c.value),c=y,c!==p?(d.setValue(c),!0):!1}function bh(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var ej=/[\n"\\]/g;function ji(c){return c.replace(ej,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function Ig(c,d,p,y,R,I,B,W){c.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?c.type=B:c.removeAttribute("type"),d!=null?B==="number"?(d===0&&c.value===""||c.value!=d)&&(c.value=""+Ni(d)):c.value!==""+Ni(d)&&(c.value=""+Ni(d)):B!=="submit"&&B!=="reset"||c.removeAttribute("value"),d!=null?Pg(c,B,Ni(d)):p!=null?Pg(c,B,Ni(p)):y!=null&&c.removeAttribute("value"),R==null&&I!=null&&(c.defaultChecked=!!I),R!=null&&(c.checked=R&&typeof R!="function"&&typeof R!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?c.name=""+Ni(W):c.removeAttribute("name")}function Ex(c,d,p,y,R,I,B,W){if(I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(c.type=I),d!=null||p!=null){if(!(I!=="submit"&&I!=="reset"||d!=null)){Lg(c);return}p=p!=null?""+Ni(p):"",d=d!=null?""+Ni(d):p,W||d===c.value||(c.value=d),c.defaultValue=d}y=y??R,y=typeof y!="function"&&typeof y!="symbol"&&!!y,c.checked=W?c.checked:!!y,c.defaultChecked=!!y,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(c.name=B),Lg(c)}function Pg(c,d,p){d==="number"&&bh(c.ownerDocument)===c||c.defaultValue===""+p||(c.defaultValue=""+p)}function ul(c,d,p,y){if(c=c.options,d){d={};for(var R=0;R<p.length;R++)d["$"+p[R]]=!0;for(p=0;p<c.length;p++)R=d.hasOwnProperty("$"+c[p].value),c[p].selected!==R&&(c[p].selected=R),R&&y&&(c[p].defaultSelected=!0)}else{for(p=""+Ni(p),d=null,R=0;R<c.length;R++){if(c[R].value===p){c[R].selected=!0,y&&(c[R].defaultSelected=!0);return}d!==null||c[R].disabled||(d=c[R])}d!==null&&(d.selected=!0)}}function Rx(c,d,p){if(d!=null&&(d=""+Ni(d),d!==c.value&&(c.value=d),p==null)){c.defaultValue!==d&&(c.defaultValue=d);return}c.defaultValue=p!=null?""+Ni(p):""}function Ax(c,d,p,y){if(d==null){if(y!=null){if(p!=null)throw Error(i(92));if(K(y)){if(1<y.length)throw Error(i(93));y=y[0]}p=y}p==null&&(p=""),d=p}p=Ni(d),c.defaultValue=p,y=c.textContent,y===p&&y!==""&&y!==null&&(c.value=y),Lg(c)}function dl(c,d){if(d){var p=c.firstChild;if(p&&p===c.lastChild&&p.nodeType===3){p.nodeValue=d;return}}c.textContent=d}var tj=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Mx(c,d,p){var y=d.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?y?c.setProperty(d,""):d==="float"?c.cssFloat="":c[d]="":y?c.setProperty(d,p):typeof p!="number"||p===0||tj.has(d)?d==="float"?c.cssFloat=p:c[d]=(""+p).trim():c[d]=p+"px"}function Lx(c,d,p){if(d!=null&&typeof d!="object")throw Error(i(62));if(c=c.style,p!=null){for(var y in p)!p.hasOwnProperty(y)||d!=null&&d.hasOwnProperty(y)||(y.indexOf("--")===0?c.setProperty(y,""):y==="float"?c.cssFloat="":c[y]="");for(var R in d)y=d[R],d.hasOwnProperty(R)&&p[R]!==y&&Mx(c,R,y)}else for(var I in d)d.hasOwnProperty(I)&&Mx(c,I,d[I])}function Dg(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nj=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ij=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function yh(c){return ij.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function rr(){}var Og=null;function Ng(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var hl=null,fl=null;function Ix(c){var d=al(c);if(d&&(c=d.stateNode)){var p=c[ri]||null;e:switch(c=d.stateNode,d.type){case"input":if(Ig(c,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),d=p.name,p.type==="radio"&&d!=null){for(p=c;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+ji(""+d)+'"][type="radio"]'),d=0;d<p.length;d++){var y=p[d];if(y!==c&&y.form===c.form){var R=y[ri]||null;if(!R)throw Error(i(90));Ig(y,R.value,R.defaultValue,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name)}}for(d=0;d<p.length;d++)y=p[d],y.form===c.form&&Tx(y)}break e;case"textarea":Rx(c,p.value,p.defaultValue);break e;case"select":d=p.value,d!=null&&ul(c,!!p.multiple,d,!1)}}}var jg=!1;function Px(c,d,p){if(jg)return c(d,p);jg=!0;try{var y=c(d);return y}finally{if(jg=!1,(hl!==null||fl!==null)&&(af(),hl&&(d=hl,c=fl,fl=hl=null,Ix(d),c)))for(d=0;d<c.length;d++)Ix(c[d])}}function $c(c,d){var p=c.stateNode;if(p===null)return null;var y=p[ri]||null;if(y===null)return null;p=y[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(c=c.type,y=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!y;break e;default:c=!1}if(c)return null;if(p&&typeof p!="function")throw Error(i(231,d,typeof p));return p}var or=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bg=!1;if(or)try{var qc={};Object.defineProperty(qc,"passive",{get:function(){Bg=!0}}),window.addEventListener("test",qc,qc),window.removeEventListener("test",qc,qc)}catch{Bg=!1}var $r=null,Fg=null,_h=null;function Dx(){if(_h)return _h;var c,d=Fg,p=d.length,y,R="value"in $r?$r.value:$r.textContent,I=R.length;for(c=0;c<p&&d[c]===R[c];c++);var B=p-c;for(y=1;y<=B&&d[p-y]===R[I-y];y++);return _h=R.slice(c,1<y?1-y:void 0)}function Sh(c){var d=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&d===13&&(c=13)):c=d,c===10&&(c=13),32<=c||c===13?c:0}function Ch(){return!0}function Ox(){return!1}function oi(c){function d(p,y,R,I,B){this._reactName=p,this._targetInst=R,this.type=y,this.nativeEvent=I,this.target=B,this.currentTarget=null;for(var W in c)c.hasOwnProperty(W)&&(p=c[W],this[W]=p?p(I):I[W]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?Ch:Ox,this.isPropagationStopped=Ox,this}return f(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=Ch)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=Ch)},persist:function(){},isPersistent:Ch}),d}var Ko={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xh=oi(Ko),Vc=f({},Ko,{view:0,detail:0}),sj=oi(Vc),Ug,zg,Wc,wh=f({},Vc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$g,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==Wc&&(Wc&&c.type==="mousemove"?(Ug=c.screenX-Wc.screenX,zg=c.screenY-Wc.screenY):zg=Ug=0,Wc=c),Ug)},movementY:function(c){return"movementY"in c?c.movementY:zg}}),Nx=oi(wh),rj=f({},wh,{dataTransfer:0}),oj=oi(rj),aj=f({},Vc,{relatedTarget:0}),Hg=oi(aj),lj=f({},Ko,{animationName:0,elapsedTime:0,pseudoElement:0}),cj=oi(lj),uj=f({},Ko,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),dj=oi(uj),hj=f({},Ko,{data:0}),jx=oi(hj),fj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gj(c){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(c):(c=mj[c])?!!d[c]:!1}function $g(){return gj}var vj=f({},Vc,{key:function(c){if(c.key){var d=fj[c.key]||c.key;if(d!=="Unidentified")return d}return c.type==="keypress"?(c=Sh(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?pj[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$g,charCode:function(c){return c.type==="keypress"?Sh(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Sh(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),bj=oi(vj),yj=f({},wh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bx=oi(yj),_j=f({},Vc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$g}),Sj=oi(_j),Cj=f({},Ko,{propertyName:0,elapsedTime:0,pseudoElement:0}),xj=oi(Cj),wj=f({},wh,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),kj=oi(wj),Tj=f({},Ko,{newState:0,oldState:0}),Ej=oi(Tj),Rj=[9,13,27,32],qg=or&&"CompositionEvent"in window,Gc=null;or&&"documentMode"in document&&(Gc=document.documentMode);var Aj=or&&"TextEvent"in window&&!Gc,Fx=or&&(!qg||Gc&&8<Gc&&11>=Gc),Ux=" ",zx=!1;function Hx(c,d){switch(c){case"keyup":return Rj.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $x(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var pl=!1;function Mj(c,d){switch(c){case"compositionend":return $x(d);case"keypress":return d.which!==32?null:(zx=!0,Ux);case"textInput":return c=d.data,c===Ux&&zx?null:c;default:return null}}function Lj(c,d){if(pl)return c==="compositionend"||!qg&&Hx(c,d)?(c=Dx(),_h=Fg=$r=null,pl=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Fx&&d.locale!=="ko"?null:d.data;default:return null}}var Ij={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qx(c){var d=c&&c.nodeName&&c.nodeName.toLowerCase();return d==="input"?!!Ij[c.type]:d==="textarea"}function Vx(c,d,p,y){hl?fl?fl.push(y):fl=[y]:hl=y,d=pf(d,"onChange"),0<d.length&&(p=new xh("onChange","change",null,p,y),c.push({event:p,listeners:d}))}var Kc=null,Yc=null;function Pj(c){E1(c,0)}function kh(c){var d=Hc(c);if(Tx(d))return c}function Wx(c,d){if(c==="change")return d}var Gx=!1;if(or){var Vg;if(or){var Wg="oninput"in document;if(!Wg){var Kx=document.createElement("div");Kx.setAttribute("oninput","return;"),Wg=typeof Kx.oninput=="function"}Vg=Wg}else Vg=!1;Gx=Vg&&(!document.documentMode||9<document.documentMode)}function Yx(){Kc&&(Kc.detachEvent("onpropertychange",Qx),Yc=Kc=null)}function Qx(c){if(c.propertyName==="value"&&kh(Yc)){var d=[];Vx(d,Yc,c,Ng(c)),Px(Pj,d)}}function Dj(c,d,p){c==="focusin"?(Yx(),Kc=d,Yc=p,Kc.attachEvent("onpropertychange",Qx)):c==="focusout"&&Yx()}function Oj(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return kh(Yc)}function Nj(c,d){if(c==="click")return kh(d)}function jj(c,d){if(c==="input"||c==="change")return kh(d)}function Bj(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var Ci=typeof Object.is=="function"?Object.is:Bj;function Qc(c,d){if(Ci(c,d))return!0;if(typeof c!="object"||c===null||typeof d!="object"||d===null)return!1;var p=Object.keys(c),y=Object.keys(d);if(p.length!==y.length)return!1;for(y=0;y<p.length;y++){var R=p[y];if(!Nt.call(d,R)||!Ci(c[R],d[R]))return!1}return!0}function Jx(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function Xx(c,d){var p=Jx(c);c=0;for(var y;p;){if(p.nodeType===3){if(y=c+p.textContent.length,c<=d&&y>=d)return{node:p,offset:d-c};c=y}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=Jx(p)}}function Zx(c,d){return c&&d?c===d?!0:c&&c.nodeType===3?!1:d&&d.nodeType===3?Zx(c,d.parentNode):"contains"in c?c.contains(d):c.compareDocumentPosition?!!(c.compareDocumentPosition(d)&16):!1:!1}function ew(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var d=bh(c.document);d instanceof c.HTMLIFrameElement;){try{var p=typeof d.contentWindow.location.href=="string"}catch{p=!1}if(p)c=d.contentWindow;else break;d=bh(c.document)}return d}function Gg(c){var d=c&&c.nodeName&&c.nodeName.toLowerCase();return d&&(d==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||d==="textarea"||c.contentEditable==="true")}var Fj=or&&"documentMode"in document&&11>=document.documentMode,ml=null,Kg=null,Jc=null,Yg=!1;function tw(c,d,p){var y=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;Yg||ml==null||ml!==bh(y)||(y=ml,"selectionStart"in y&&Gg(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),Jc&&Qc(Jc,y)||(Jc=y,y=pf(Kg,"onSelect"),0<y.length&&(d=new xh("onSelect","select",null,d,p),c.push({event:d,listeners:y}),d.target=ml)))}function Yo(c,d){var p={};return p[c.toLowerCase()]=d.toLowerCase(),p["Webkit"+c]="webkit"+d,p["Moz"+c]="moz"+d,p}var gl={animationend:Yo("Animation","AnimationEnd"),animationiteration:Yo("Animation","AnimationIteration"),animationstart:Yo("Animation","AnimationStart"),transitionrun:Yo("Transition","TransitionRun"),transitionstart:Yo("Transition","TransitionStart"),transitioncancel:Yo("Transition","TransitionCancel"),transitionend:Yo("Transition","TransitionEnd")},Qg={},nw={};or&&(nw=document.createElement("div").style,"AnimationEvent"in window||(delete gl.animationend.animation,delete gl.animationiteration.animation,delete gl.animationstart.animation),"TransitionEvent"in window||delete gl.transitionend.transition);function Qo(c){if(Qg[c])return Qg[c];if(!gl[c])return c;var d=gl[c],p;for(p in d)if(d.hasOwnProperty(p)&&p in nw)return Qg[c]=d[p];return c}var iw=Qo("animationend"),sw=Qo("animationiteration"),rw=Qo("animationstart"),Uj=Qo("transitionrun"),zj=Qo("transitionstart"),Hj=Qo("transitioncancel"),ow=Qo("transitionend"),aw=new Map,Jg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Jg.push("scrollEnd");function as(c,d){aw.set(c,d),Go(d,[c])}var Th=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},Bi=[],vl=0,Xg=0;function Eh(){for(var c=vl,d=Xg=vl=0;d<c;){var p=Bi[d];Bi[d++]=null;var y=Bi[d];Bi[d++]=null;var R=Bi[d];Bi[d++]=null;var I=Bi[d];if(Bi[d++]=null,y!==null&&R!==null){var B=y.pending;B===null?R.next=R:(R.next=B.next,B.next=R),y.pending=R}I!==0&&lw(p,R,I)}}function Rh(c,d,p,y){Bi[vl++]=c,Bi[vl++]=d,Bi[vl++]=p,Bi[vl++]=y,Xg|=y,c.lanes|=y,c=c.alternate,c!==null&&(c.lanes|=y)}function Zg(c,d,p,y){return Rh(c,d,p,y),Ah(c)}function Jo(c,d){return Rh(c,null,null,d),Ah(c)}function lw(c,d,p){c.lanes|=p;var y=c.alternate;y!==null&&(y.lanes|=p);for(var R=!1,I=c.return;I!==null;)I.childLanes|=p,y=I.alternate,y!==null&&(y.childLanes|=p),I.tag===22&&(c=I.stateNode,c===null||c._visibility&1||(R=!0)),c=I,I=I.return;return c.tag===3?(I=c.stateNode,R&&d!==null&&(R=31-St(p),c=I.hiddenUpdates,y=c[R],y===null?c[R]=[d]:y.push(d),d.lane=p|536870912),I):null}function Ah(c){if(50<yu)throw yu=0,lb=null,Error(i(185));for(var d=c.return;d!==null;)c=d,d=c.return;return c.tag===3?c.stateNode:null}var bl={};function $j(c,d,p,y){this.tag=c,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xi(c,d,p,y){return new $j(c,d,p,y)}function ev(c){return c=c.prototype,!(!c||!c.isReactComponent)}function ar(c,d){var p=c.alternate;return p===null?(p=xi(c.tag,d,c.key,c.mode),p.elementType=c.elementType,p.type=c.type,p.stateNode=c.stateNode,p.alternate=c,c.alternate=p):(p.pendingProps=d,p.type=c.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=c.flags&65011712,p.childLanes=c.childLanes,p.lanes=c.lanes,p.child=c.child,p.memoizedProps=c.memoizedProps,p.memoizedState=c.memoizedState,p.updateQueue=c.updateQueue,d=c.dependencies,p.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},p.sibling=c.sibling,p.index=c.index,p.ref=c.ref,p.refCleanup=c.refCleanup,p}function cw(c,d){c.flags&=65011714;var p=c.alternate;return p===null?(c.childLanes=0,c.lanes=d,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=p.childLanes,c.lanes=p.lanes,c.child=p.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=p.memoizedProps,c.memoizedState=p.memoizedState,c.updateQueue=p.updateQueue,c.type=p.type,d=p.dependencies,c.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),c}function Mh(c,d,p,y,R,I){var B=0;if(y=c,typeof c=="function")ev(c)&&(B=1);else if(typeof c=="string")B=KB(c,p,ee.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case L:return c=xi(31,p,d,R),c.elementType=L,c.lanes=I,c;case S:return Xo(p.children,R,I,d);case v:B=8,R|=24;break;case _:return c=xi(12,p,d,R|2),c.elementType=_,c.lanes=I,c;case A:return c=xi(13,p,d,R),c.elementType=A,c.lanes=I,c;case T:return c=xi(19,p,d,R),c.elementType=T,c.lanes=I,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case x:B=10;break e;case w:B=9;break e;case k:B=11;break e;case M:B=14;break e;case E:B=16,y=null;break e}B=29,p=Error(i(130,c===null?"null":typeof c,"")),y=null}return d=xi(B,p,d,R),d.elementType=c,d.type=y,d.lanes=I,d}function Xo(c,d,p,y){return c=xi(7,c,y,d),c.lanes=p,c}function tv(c,d,p){return c=xi(6,c,null,d),c.lanes=p,c}function uw(c){var d=xi(18,null,null,0);return d.stateNode=c,d}function nv(c,d,p){return d=xi(4,c.children!==null?c.children:[],c.key,d),d.lanes=p,d.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},d}var dw=new WeakMap;function Fi(c,d){if(typeof c=="object"&&c!==null){var p=dw.get(c);return p!==void 0?p:(d={value:c,source:d,stack:Ot(d)},dw.set(c,d),d)}return{value:c,source:d,stack:Ot(d)}}var yl=[],_l=0,Lh=null,Xc=0,Ui=[],zi=0,qr=null,Ls=1,Is="";function lr(c,d){yl[_l++]=Xc,yl[_l++]=Lh,Lh=c,Xc=d}function hw(c,d,p){Ui[zi++]=Ls,Ui[zi++]=Is,Ui[zi++]=qr,qr=c;var y=Ls;c=Is;var R=32-St(y)-1;y&=~(1<<R),p+=1;var I=32-St(d)+R;if(30<I){var B=R-R%5;I=(y&(1<<B)-1).toString(32),y>>=B,R-=B,Ls=1<<32-St(d)+R|p<<R|y,Is=I+c}else Ls=1<<I|p<<R|y,Is=c}function iv(c){c.return!==null&&(lr(c,1),hw(c,1,0))}function sv(c){for(;c===Lh;)Lh=yl[--_l],yl[_l]=null,Xc=yl[--_l],yl[_l]=null;for(;c===qr;)qr=Ui[--zi],Ui[zi]=null,Is=Ui[--zi],Ui[zi]=null,Ls=Ui[--zi],Ui[zi]=null}function fw(c,d){Ui[zi++]=Ls,Ui[zi++]=Is,Ui[zi++]=qr,Ls=d.id,Is=d.overflow,qr=c}var Mn=null,$t=null,gt=!1,Vr=null,Hi=!1,rv=Error(i(519));function Wr(c){var d=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Zc(Fi(d,c)),rv}function pw(c){var d=c.stateNode,p=c.type,y=c.memoizedProps;switch(d[An]=c,d[ri]=y,p){case"dialog":ct("cancel",d),ct("close",d);break;case"iframe":case"object":case"embed":ct("load",d);break;case"video":case"audio":for(p=0;p<Su.length;p++)ct(Su[p],d);break;case"source":ct("error",d);break;case"img":case"image":case"link":ct("error",d),ct("load",d);break;case"details":ct("toggle",d);break;case"input":ct("invalid",d),Ex(d,y.value,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name,!0);break;case"select":ct("invalid",d);break;case"textarea":ct("invalid",d),Ax(d,y.value,y.defaultValue,y.children)}p=y.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||d.textContent===""+p||y.suppressHydrationWarning===!0||L1(d.textContent,p)?(y.popover!=null&&(ct("beforetoggle",d),ct("toggle",d)),y.onScroll!=null&&ct("scroll",d),y.onScrollEnd!=null&&ct("scrollend",d),y.onClick!=null&&(d.onclick=rr),d=!0):d=!1,d||Wr(c,!0)}function mw(c){for(Mn=c.return;Mn;)switch(Mn.tag){case 5:case 31:case 13:Hi=!1;return;case 27:case 3:Hi=!0;return;default:Mn=Mn.return}}function Sl(c){if(c!==Mn)return!1;if(!gt)return mw(c),gt=!0,!1;var d=c.tag,p;if((p=d!==3&&d!==27)&&((p=d===5)&&(p=c.type,p=!(p!=="form"&&p!=="button")||xb(c.type,c.memoizedProps)),p=!p),p&&$t&&Wr(c),mw(c),d===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(i(317));$t=U1(c)}else if(d===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(i(317));$t=U1(c)}else d===27?(d=$t,oo(c.type)?(c=Rb,Rb=null,$t=c):$t=d):$t=Mn?qi(c.stateNode.nextSibling):null;return!0}function Zo(){$t=Mn=null,gt=!1}function ov(){var c=Vr;return c!==null&&(ui===null?ui=c:ui.push.apply(ui,c),Vr=null),c}function Zc(c){Vr===null?Vr=[c]:Vr.push(c)}var av=z(null),ea=null,cr=null;function Gr(c,d,p){H(av,d._currentValue),d._currentValue=p}function ur(c){c._currentValue=av.current,G(av)}function lv(c,d,p){for(;c!==null;){var y=c.alternate;if((c.childLanes&d)!==d?(c.childLanes|=d,y!==null&&(y.childLanes|=d)):y!==null&&(y.childLanes&d)!==d&&(y.childLanes|=d),c===p)break;c=c.return}}function cv(c,d,p,y){var R=c.child;for(R!==null&&(R.return=c);R!==null;){var I=R.dependencies;if(I!==null){var B=R.child;I=I.firstContext;e:for(;I!==null;){var W=I;I=R;for(var Z=0;Z<d.length;Z++)if(W.context===d[Z]){I.lanes|=p,W=I.alternate,W!==null&&(W.lanes|=p),lv(I.return,p,c),y||(B=null);break e}I=W.next}}else if(R.tag===18){if(B=R.return,B===null)throw Error(i(341));B.lanes|=p,I=B.alternate,I!==null&&(I.lanes|=p),lv(B,p,c),B=null}else B=R.child;if(B!==null)B.return=R;else for(B=R;B!==null;){if(B===c){B=null;break}if(R=B.sibling,R!==null){R.return=B.return,B=R;break}B=B.return}R=B}}function Cl(c,d,p,y){c=null;for(var R=d,I=!1;R!==null;){if(!I){if((R.flags&524288)!==0)I=!0;else if((R.flags&262144)!==0)break}if(R.tag===10){var B=R.alternate;if(B===null)throw Error(i(387));if(B=B.memoizedProps,B!==null){var W=R.type;Ci(R.pendingProps.value,B.value)||(c!==null?c.push(W):c=[W])}}else if(R===J.current){if(B=R.alternate,B===null)throw Error(i(387));B.memoizedState.memoizedState!==R.memoizedState.memoizedState&&(c!==null?c.push(Tu):c=[Tu])}R=R.return}c!==null&&cv(d,c,p,y),d.flags|=262144}function Ih(c){for(c=c.firstContext;c!==null;){if(!Ci(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function ta(c){ea=c,cr=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function Ln(c){return gw(ea,c)}function Ph(c,d){return ea===null&&ta(c),gw(c,d)}function gw(c,d){var p=d._currentValue;if(d={context:d,memoizedValue:p,next:null},cr===null){if(c===null)throw Error(i(308));cr=d,c.dependencies={lanes:0,firstContext:d},c.flags|=524288}else cr=cr.next=d;return p}var qj=typeof AbortController<"u"?AbortController:function(){var c=[],d=this.signal={aborted:!1,addEventListener:function(p,y){c.push(y)}};this.abort=function(){d.aborted=!0,c.forEach(function(p){return p()})}},Vj=e.unstable_scheduleCallback,Wj=e.unstable_NormalPriority,dn={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function uv(){return{controller:new qj,data:new Map,refCount:0}}function eu(c){c.refCount--,c.refCount===0&&Vj(Wj,function(){c.controller.abort()})}var tu=null,dv=0,xl=0,wl=null;function Gj(c,d){if(tu===null){var p=tu=[];dv=0,xl=pb(),wl={status:"pending",value:void 0,then:function(y){p.push(y)}}}return dv++,d.then(vw,vw),d}function vw(){if(--dv===0&&tu!==null){wl!==null&&(wl.status="fulfilled");var c=tu;tu=null,xl=0,wl=null;for(var d=0;d<c.length;d++)(0,c[d])()}}function Kj(c,d){var p=[],y={status:"pending",value:null,reason:null,then:function(R){p.push(R)}};return c.then(function(){y.status="fulfilled",y.value=d;for(var R=0;R<p.length;R++)(0,p[R])(d)},function(R){for(y.status="rejected",y.reason=R,R=0;R<p.length;R++)(0,p[R])(void 0)}),y}var bw=$.S;$.S=function(c,d){t1=Fe(),typeof d=="object"&&d!==null&&typeof d.then=="function"&&Gj(c,d),bw!==null&&bw(c,d)};var na=z(null);function hv(){var c=na.current;return c!==null?c:jt.pooledCache}function Dh(c,d){d===null?H(na,na.current):H(na,d.pool)}function yw(){var c=hv();return c===null?null:{parent:dn._currentValue,pool:c}}var kl=Error(i(460)),fv=Error(i(474)),Oh=Error(i(542)),Nh={then:function(){}};function _w(c){return c=c.status,c==="fulfilled"||c==="rejected"}function Sw(c,d,p){switch(p=c[p],p===void 0?c.push(d):p!==d&&(d.then(rr,rr),d=p),d.status){case"fulfilled":return d.value;case"rejected":throw c=d.reason,xw(c),c;default:if(typeof d.status=="string")d.then(rr,rr);else{if(c=jt,c!==null&&100<c.shellSuspendCounter)throw Error(i(482));c=d,c.status="pending",c.then(function(y){if(d.status==="pending"){var R=d;R.status="fulfilled",R.value=y}},function(y){if(d.status==="pending"){var R=d;R.status="rejected",R.reason=y}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw c=d.reason,xw(c),c}throw sa=d,kl}}function ia(c){try{var d=c._init;return d(c._payload)}catch(p){throw p!==null&&typeof p=="object"&&typeof p.then=="function"?(sa=p,kl):p}}var sa=null;function Cw(){if(sa===null)throw Error(i(459));var c=sa;return sa=null,c}function xw(c){if(c===kl||c===Oh)throw Error(i(483))}var Tl=null,nu=0;function jh(c){var d=nu;return nu+=1,Tl===null&&(Tl=[]),Sw(Tl,c,d)}function iu(c,d){d=d.props.ref,c.ref=d!==void 0?d:null}function Bh(c,d){throw d.$$typeof===m?Error(i(525)):(c=Object.prototype.toString.call(d),Error(i(31,c==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":c)))}function ww(c){function d(ie,te){if(c){var oe=ie.deletions;oe===null?(ie.deletions=[te],ie.flags|=16):oe.push(te)}}function p(ie,te){if(!c)return null;for(;te!==null;)d(ie,te),te=te.sibling;return null}function y(ie){for(var te=new Map;ie!==null;)ie.key!==null?te.set(ie.key,ie):te.set(ie.index,ie),ie=ie.sibling;return te}function R(ie,te){return ie=ar(ie,te),ie.index=0,ie.sibling=null,ie}function I(ie,te,oe){return ie.index=oe,c?(oe=ie.alternate,oe!==null?(oe=oe.index,oe<te?(ie.flags|=67108866,te):oe):(ie.flags|=67108866,te)):(ie.flags|=1048576,te)}function B(ie){return c&&ie.alternate===null&&(ie.flags|=67108866),ie}function W(ie,te,oe,pe){return te===null||te.tag!==6?(te=tv(oe,ie.mode,pe),te.return=ie,te):(te=R(te,oe),te.return=ie,te)}function Z(ie,te,oe,pe){var Ue=oe.type;return Ue===S?fe(ie,te,oe.props.children,pe,oe.key):te!==null&&(te.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===E&&ia(Ue)===te.type)?(te=R(te,oe.props),iu(te,oe),te.return=ie,te):(te=Mh(oe.type,oe.key,oe.props,null,ie.mode,pe),iu(te,oe),te.return=ie,te)}function ae(ie,te,oe,pe){return te===null||te.tag!==4||te.stateNode.containerInfo!==oe.containerInfo||te.stateNode.implementation!==oe.implementation?(te=nv(oe,ie.mode,pe),te.return=ie,te):(te=R(te,oe.children||[]),te.return=ie,te)}function fe(ie,te,oe,pe,Ue){return te===null||te.tag!==7?(te=Xo(oe,ie.mode,pe,Ue),te.return=ie,te):(te=R(te,oe),te.return=ie,te)}function me(ie,te,oe){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return te=tv(""+te,ie.mode,oe),te.return=ie,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case g:return oe=Mh(te.type,te.key,te.props,null,ie.mode,oe),iu(oe,te),oe.return=ie,oe;case C:return te=nv(te,ie.mode,oe),te.return=ie,te;case E:return te=ia(te),me(ie,te,oe)}if(K(te)||j(te))return te=Xo(te,ie.mode,oe,null),te.return=ie,te;if(typeof te.then=="function")return me(ie,jh(te),oe);if(te.$$typeof===x)return me(ie,Ph(ie,te),oe);Bh(ie,te)}return null}function le(ie,te,oe,pe){var Ue=te!==null?te.key:null;if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return Ue!==null?null:W(ie,te,""+oe,pe);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case g:return oe.key===Ue?Z(ie,te,oe,pe):null;case C:return oe.key===Ue?ae(ie,te,oe,pe):null;case E:return oe=ia(oe),le(ie,te,oe,pe)}if(K(oe)||j(oe))return Ue!==null?null:fe(ie,te,oe,pe,null);if(typeof oe.then=="function")return le(ie,te,jh(oe),pe);if(oe.$$typeof===x)return le(ie,te,Ph(ie,oe),pe);Bh(ie,oe)}return null}function de(ie,te,oe,pe,Ue){if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return ie=ie.get(oe)||null,W(te,ie,""+pe,Ue);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case g:return ie=ie.get(pe.key===null?oe:pe.key)||null,Z(te,ie,pe,Ue);case C:return ie=ie.get(pe.key===null?oe:pe.key)||null,ae(te,ie,pe,Ue);case E:return pe=ia(pe),de(ie,te,oe,pe,Ue)}if(K(pe)||j(pe))return ie=ie.get(oe)||null,fe(te,ie,pe,Ue,null);if(typeof pe.then=="function")return de(ie,te,oe,jh(pe),Ue);if(pe.$$typeof===x)return de(ie,te,oe,Ph(te,pe),Ue);Bh(te,pe)}return null}function Ie(ie,te,oe,pe){for(var Ue=null,Ct=null,Ne=te,tt=te=0,mt=null;Ne!==null&&tt<oe.length;tt++){Ne.index>tt?(mt=Ne,Ne=null):mt=Ne.sibling;var xt=le(ie,Ne,oe[tt],pe);if(xt===null){Ne===null&&(Ne=mt);break}c&&Ne&&xt.alternate===null&&d(ie,Ne),te=I(xt,te,tt),Ct===null?Ue=xt:Ct.sibling=xt,Ct=xt,Ne=mt}if(tt===oe.length)return p(ie,Ne),gt&&lr(ie,tt),Ue;if(Ne===null){for(;tt<oe.length;tt++)Ne=me(ie,oe[tt],pe),Ne!==null&&(te=I(Ne,te,tt),Ct===null?Ue=Ne:Ct.sibling=Ne,Ct=Ne);return gt&&lr(ie,tt),Ue}for(Ne=y(Ne);tt<oe.length;tt++)mt=de(Ne,ie,tt,oe[tt],pe),mt!==null&&(c&&mt.alternate!==null&&Ne.delete(mt.key===null?tt:mt.key),te=I(mt,te,tt),Ct===null?Ue=mt:Ct.sibling=mt,Ct=mt);return c&&Ne.forEach(function(ho){return d(ie,ho)}),gt&&lr(ie,tt),Ue}function Ve(ie,te,oe,pe){if(oe==null)throw Error(i(151));for(var Ue=null,Ct=null,Ne=te,tt=te=0,mt=null,xt=oe.next();Ne!==null&&!xt.done;tt++,xt=oe.next()){Ne.index>tt?(mt=Ne,Ne=null):mt=Ne.sibling;var ho=le(ie,Ne,xt.value,pe);if(ho===null){Ne===null&&(Ne=mt);break}c&&Ne&&ho.alternate===null&&d(ie,Ne),te=I(ho,te,tt),Ct===null?Ue=ho:Ct.sibling=ho,Ct=ho,Ne=mt}if(xt.done)return p(ie,Ne),gt&&lr(ie,tt),Ue;if(Ne===null){for(;!xt.done;tt++,xt=oe.next())xt=me(ie,xt.value,pe),xt!==null&&(te=I(xt,te,tt),Ct===null?Ue=xt:Ct.sibling=xt,Ct=xt);return gt&&lr(ie,tt),Ue}for(Ne=y(Ne);!xt.done;tt++,xt=oe.next())xt=de(Ne,ie,tt,xt.value,pe),xt!==null&&(c&&xt.alternate!==null&&Ne.delete(xt.key===null?tt:xt.key),te=I(xt,te,tt),Ct===null?Ue=xt:Ct.sibling=xt,Ct=xt);return c&&Ne.forEach(function(r4){return d(ie,r4)}),gt&&lr(ie,tt),Ue}function Pt(ie,te,oe,pe){if(typeof oe=="object"&&oe!==null&&oe.type===S&&oe.key===null&&(oe=oe.props.children),typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case g:e:{for(var Ue=oe.key;te!==null;){if(te.key===Ue){if(Ue=oe.type,Ue===S){if(te.tag===7){p(ie,te.sibling),pe=R(te,oe.props.children),pe.return=ie,ie=pe;break e}}else if(te.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===E&&ia(Ue)===te.type){p(ie,te.sibling),pe=R(te,oe.props),iu(pe,oe),pe.return=ie,ie=pe;break e}p(ie,te);break}else d(ie,te);te=te.sibling}oe.type===S?(pe=Xo(oe.props.children,ie.mode,pe,oe.key),pe.return=ie,ie=pe):(pe=Mh(oe.type,oe.key,oe.props,null,ie.mode,pe),iu(pe,oe),pe.return=ie,ie=pe)}return B(ie);case C:e:{for(Ue=oe.key;te!==null;){if(te.key===Ue)if(te.tag===4&&te.stateNode.containerInfo===oe.containerInfo&&te.stateNode.implementation===oe.implementation){p(ie,te.sibling),pe=R(te,oe.children||[]),pe.return=ie,ie=pe;break e}else{p(ie,te);break}else d(ie,te);te=te.sibling}pe=nv(oe,ie.mode,pe),pe.return=ie,ie=pe}return B(ie);case E:return oe=ia(oe),Pt(ie,te,oe,pe)}if(K(oe))return Ie(ie,te,oe,pe);if(j(oe)){if(Ue=j(oe),typeof Ue!="function")throw Error(i(150));return oe=Ue.call(oe),Ve(ie,te,oe,pe)}if(typeof oe.then=="function")return Pt(ie,te,jh(oe),pe);if(oe.$$typeof===x)return Pt(ie,te,Ph(ie,oe),pe);Bh(ie,oe)}return typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint"?(oe=""+oe,te!==null&&te.tag===6?(p(ie,te.sibling),pe=R(te,oe),pe.return=ie,ie=pe):(p(ie,te),pe=tv(oe,ie.mode,pe),pe.return=ie,ie=pe),B(ie)):p(ie,te)}return function(ie,te,oe,pe){try{nu=0;var Ue=Pt(ie,te,oe,pe);return Tl=null,Ue}catch(Ne){if(Ne===kl||Ne===Oh)throw Ne;var Ct=xi(29,Ne,null,ie.mode);return Ct.lanes=pe,Ct.return=ie,Ct}}}var ra=ww(!0),kw=ww(!1),Kr=!1;function pv(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function mv(c,d){c=c.updateQueue,d.updateQueue===c&&(d.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function Yr(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function Qr(c,d,p){var y=c.updateQueue;if(y===null)return null;if(y=y.shared,(kt&2)!==0){var R=y.pending;return R===null?d.next=d:(d.next=R.next,R.next=d),y.pending=d,d=Ah(c),lw(c,null,p),d}return Rh(c,y,d,p),Ah(c)}function su(c,d,p){if(d=d.updateQueue,d!==null&&(d=d.shared,(p&4194048)!==0)){var y=d.lanes;y&=c.pendingLanes,p|=y,d.lanes=p,os(c,p)}}function gv(c,d){var p=c.updateQueue,y=c.alternate;if(y!==null&&(y=y.updateQueue,p===y)){var R=null,I=null;if(p=p.firstBaseUpdate,p!==null){do{var B={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};I===null?R=I=B:I=I.next=B,p=p.next}while(p!==null);I===null?R=I=d:I=I.next=d}else R=I=d;p={baseState:y.baseState,firstBaseUpdate:R,lastBaseUpdate:I,shared:y.shared,callbacks:y.callbacks},c.updateQueue=p;return}c=p.lastBaseUpdate,c===null?p.firstBaseUpdate=d:c.next=d,p.lastBaseUpdate=d}var vv=!1;function ru(){if(vv){var c=wl;if(c!==null)throw c}}function ou(c,d,p,y){vv=!1;var R=c.updateQueue;Kr=!1;var I=R.firstBaseUpdate,B=R.lastBaseUpdate,W=R.shared.pending;if(W!==null){R.shared.pending=null;var Z=W,ae=Z.next;Z.next=null,B===null?I=ae:B.next=ae,B=Z;var fe=c.alternate;fe!==null&&(fe=fe.updateQueue,W=fe.lastBaseUpdate,W!==B&&(W===null?fe.firstBaseUpdate=ae:W.next=ae,fe.lastBaseUpdate=Z))}if(I!==null){var me=R.baseState;B=0,fe=ae=Z=null,W=I;do{var le=W.lane&-536870913,de=le!==W.lane;if(de?(pt&le)===le:(y&le)===le){le!==0&&le===xl&&(vv=!0),fe!==null&&(fe=fe.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Ie=c,Ve=W;le=d;var Pt=p;switch(Ve.tag){case 1:if(Ie=Ve.payload,typeof Ie=="function"){me=Ie.call(Pt,me,le);break e}me=Ie;break e;case 3:Ie.flags=Ie.flags&-65537|128;case 0:if(Ie=Ve.payload,le=typeof Ie=="function"?Ie.call(Pt,me,le):Ie,le==null)break e;me=f({},me,le);break e;case 2:Kr=!0}}le=W.callback,le!==null&&(c.flags|=64,de&&(c.flags|=8192),de=R.callbacks,de===null?R.callbacks=[le]:de.push(le))}else de={lane:le,tag:W.tag,payload:W.payload,callback:W.callback,next:null},fe===null?(ae=fe=de,Z=me):fe=fe.next=de,B|=le;if(W=W.next,W===null){if(W=R.shared.pending,W===null)break;de=W,W=de.next,de.next=null,R.lastBaseUpdate=de,R.shared.pending=null}}while(!0);fe===null&&(Z=me),R.baseState=Z,R.firstBaseUpdate=ae,R.lastBaseUpdate=fe,I===null&&(R.shared.lanes=0),to|=B,c.lanes=B,c.memoizedState=me}}function Tw(c,d){if(typeof c!="function")throw Error(i(191,c));c.call(d)}function Ew(c,d){var p=c.callbacks;if(p!==null)for(c.callbacks=null,c=0;c<p.length;c++)Tw(p[c],d)}var El=z(null),Fh=z(0);function Rw(c,d){c=yr,H(Fh,c),H(El,d),yr=c|d.baseLanes}function bv(){H(Fh,yr),H(El,El.current)}function yv(){yr=Fh.current,G(El),G(Fh)}var wi=z(null),$i=null;function Jr(c){var d=c.alternate;H(rn,rn.current&1),H(wi,c),$i===null&&(d===null||El.current!==null||d.memoizedState!==null)&&($i=c)}function _v(c){H(rn,rn.current),H(wi,c),$i===null&&($i=c)}function Aw(c){c.tag===22?(H(rn,rn.current),H(wi,c),$i===null&&($i=c)):Xr()}function Xr(){H(rn,rn.current),H(wi,wi.current)}function ki(c){G(wi),$i===c&&($i=null),G(rn)}var rn=z(0);function Uh(c){for(var d=c;d!==null;){if(d.tag===13){var p=d.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||Tb(p)||Eb(p)))return d}else if(d.tag===19&&(d.memoizedProps.revealOrder==="forwards"||d.memoizedProps.revealOrder==="backwards"||d.memoizedProps.revealOrder==="unstable_legacy-backwards"||d.memoizedProps.revealOrder==="together")){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var dr=0,et=null,Lt=null,hn=null,zh=!1,Rl=!1,oa=!1,Hh=0,au=0,Al=null,Yj=0;function Zt(){throw Error(i(321))}function Sv(c,d){if(d===null)return!1;for(var p=0;p<d.length&&p<c.length;p++)if(!Ci(c[p],d[p]))return!1;return!0}function Cv(c,d,p,y,R,I){return dr=I,et=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,$.H=c===null||c.memoizedState===null?hk:jv,oa=!1,I=p(y,R),oa=!1,Rl&&(I=Lw(d,p,y,R)),Mw(c),I}function Mw(c){$.H=uu;var d=Lt!==null&&Lt.next!==null;if(dr=0,hn=Lt=et=null,zh=!1,au=0,Al=null,d)throw Error(i(300));c===null||fn||(c=c.dependencies,c!==null&&Ih(c)&&(fn=!0))}function Lw(c,d,p,y){et=c;var R=0;do{if(Rl&&(Al=null),au=0,Rl=!1,25<=R)throw Error(i(301));if(R+=1,hn=Lt=null,c.updateQueue!=null){var I=c.updateQueue;I.lastEffect=null,I.events=null,I.stores=null,I.memoCache!=null&&(I.memoCache.index=0)}$.H=fk,I=d(p,y)}while(Rl);return I}function Qj(){var c=$.H,d=c.useState()[0];return d=typeof d.then=="function"?lu(d):d,c=c.useState()[0],(Lt!==null?Lt.memoizedState:null)!==c&&(et.flags|=1024),d}function xv(){var c=Hh!==0;return Hh=0,c}function wv(c,d,p){d.updateQueue=c.updateQueue,d.flags&=-2053,c.lanes&=~p}function kv(c){if(zh){for(c=c.memoizedState;c!==null;){var d=c.queue;d!==null&&(d.pending=null),c=c.next}zh=!1}dr=0,hn=Lt=et=null,Rl=!1,au=Hh=0,Al=null}function Yn(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hn===null?et.memoizedState=hn=c:hn=hn.next=c,hn}function on(){if(Lt===null){var c=et.alternate;c=c!==null?c.memoizedState:null}else c=Lt.next;var d=hn===null?et.memoizedState:hn.next;if(d!==null)hn=d,Lt=c;else{if(c===null)throw et.alternate===null?Error(i(467)):Error(i(310));Lt=c,c={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},hn===null?et.memoizedState=hn=c:hn=hn.next=c}return hn}function $h(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function lu(c){var d=au;return au+=1,Al===null&&(Al=[]),c=Sw(Al,c,d),d=et,(hn===null?d.memoizedState:hn.next)===null&&(d=d.alternate,$.H=d===null||d.memoizedState===null?hk:jv),c}function qh(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return lu(c);if(c.$$typeof===x)return Ln(c)}throw Error(i(438,String(c)))}function Tv(c){var d=null,p=et.updateQueue;if(p!==null&&(d=p.memoCache),d==null){var y=et.alternate;y!==null&&(y=y.updateQueue,y!==null&&(y=y.memoCache,y!=null&&(d={data:y.data.map(function(R){return R.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),p===null&&(p=$h(),et.updateQueue=p),p.memoCache=d,p=d.data[d.index],p===void 0)for(p=d.data[d.index]=Array(c),y=0;y<c;y++)p[y]=D;return d.index++,p}function hr(c,d){return typeof d=="function"?d(c):d}function Vh(c){var d=on();return Ev(d,Lt,c)}function Ev(c,d,p){var y=c.queue;if(y===null)throw Error(i(311));y.lastRenderedReducer=p;var R=c.baseQueue,I=y.pending;if(I!==null){if(R!==null){var B=R.next;R.next=I.next,I.next=B}d.baseQueue=R=I,y.pending=null}if(I=c.baseState,R===null)c.memoizedState=I;else{d=R.next;var W=B=null,Z=null,ae=d,fe=!1;do{var me=ae.lane&-536870913;if(me!==ae.lane?(pt&me)===me:(dr&me)===me){var le=ae.revertLane;if(le===0)Z!==null&&(Z=Z.next={lane:0,revertLane:0,gesture:null,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null}),me===xl&&(fe=!0);else if((dr&le)===le){ae=ae.next,le===xl&&(fe=!0);continue}else me={lane:0,revertLane:ae.revertLane,gesture:null,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null},Z===null?(W=Z=me,B=I):Z=Z.next=me,et.lanes|=le,to|=le;me=ae.action,oa&&p(I,me),I=ae.hasEagerState?ae.eagerState:p(I,me)}else le={lane:me,revertLane:ae.revertLane,gesture:ae.gesture,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null},Z===null?(W=Z=le,B=I):Z=Z.next=le,et.lanes|=me,to|=me;ae=ae.next}while(ae!==null&&ae!==d);if(Z===null?B=I:Z.next=W,!Ci(I,c.memoizedState)&&(fn=!0,fe&&(p=wl,p!==null)))throw p;c.memoizedState=I,c.baseState=B,c.baseQueue=Z,y.lastRenderedState=I}return R===null&&(y.lanes=0),[c.memoizedState,y.dispatch]}function Rv(c){var d=on(),p=d.queue;if(p===null)throw Error(i(311));p.lastRenderedReducer=c;var y=p.dispatch,R=p.pending,I=d.memoizedState;if(R!==null){p.pending=null;var B=R=R.next;do I=c(I,B.action),B=B.next;while(B!==R);Ci(I,d.memoizedState)||(fn=!0),d.memoizedState=I,d.baseQueue===null&&(d.baseState=I),p.lastRenderedState=I}return[I,y]}function Iw(c,d,p){var y=et,R=on(),I=gt;if(I){if(p===void 0)throw Error(i(407));p=p()}else p=d();var B=!Ci((Lt||R).memoizedState,p);if(B&&(R.memoizedState=p,fn=!0),R=R.queue,Lv(Ow.bind(null,y,R,c),[c]),R.getSnapshot!==d||B||hn!==null&&hn.memoizedState.tag&1){if(y.flags|=2048,Ml(9,{destroy:void 0},Dw.bind(null,y,R,p,d),null),jt===null)throw Error(i(349));I||(dr&127)!==0||Pw(y,d,p)}return p}function Pw(c,d,p){c.flags|=16384,c={getSnapshot:d,value:p},d=et.updateQueue,d===null?(d=$h(),et.updateQueue=d,d.stores=[c]):(p=d.stores,p===null?d.stores=[c]:p.push(c))}function Dw(c,d,p,y){d.value=p,d.getSnapshot=y,Nw(d)&&jw(c)}function Ow(c,d,p){return p(function(){Nw(d)&&jw(c)})}function Nw(c){var d=c.getSnapshot;c=c.value;try{var p=d();return!Ci(c,p)}catch{return!0}}function jw(c){var d=Jo(c,2);d!==null&&di(d,c,2)}function Av(c){var d=Yn();if(typeof c=="function"){var p=c;if(c=p(),oa){sn(!0);try{p()}finally{sn(!1)}}}return d.memoizedState=d.baseState=c,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hr,lastRenderedState:c},d}function Bw(c,d,p,y){return c.baseState=p,Ev(c,Lt,typeof y=="function"?y:hr)}function Jj(c,d,p,y,R){if(Kh(c))throw Error(i(485));if(c=d.action,c!==null){var I={payload:R,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){I.listeners.push(B)}};$.T!==null?p(!0):I.isTransition=!1,y(I),p=d.pending,p===null?(I.next=d.pending=I,Fw(d,I)):(I.next=p.next,d.pending=p.next=I)}}function Fw(c,d){var p=d.action,y=d.payload,R=c.state;if(d.isTransition){var I=$.T,B={};$.T=B;try{var W=p(R,y),Z=$.S;Z!==null&&Z(B,W),Uw(c,d,W)}catch(ae){Mv(c,d,ae)}finally{I!==null&&B.types!==null&&(I.types=B.types),$.T=I}}else try{I=p(R,y),Uw(c,d,I)}catch(ae){Mv(c,d,ae)}}function Uw(c,d,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(y){zw(c,d,y)},function(y){return Mv(c,d,y)}):zw(c,d,p)}function zw(c,d,p){d.status="fulfilled",d.value=p,Hw(d),c.state=p,d=c.pending,d!==null&&(p=d.next,p===d?c.pending=null:(p=p.next,d.next=p,Fw(c,p)))}function Mv(c,d,p){var y=c.pending;if(c.pending=null,y!==null){y=y.next;do d.status="rejected",d.reason=p,Hw(d),d=d.next;while(d!==y)}c.action=null}function Hw(c){c=c.listeners;for(var d=0;d<c.length;d++)(0,c[d])()}function $w(c,d){return d}function qw(c,d){if(gt){var p=jt.formState;if(p!==null){e:{var y=et;if(gt){if($t){t:{for(var R=$t,I=Hi;R.nodeType!==8;){if(!I){R=null;break t}if(R=qi(R.nextSibling),R===null){R=null;break t}}I=R.data,R=I==="F!"||I==="F"?R:null}if(R){$t=qi(R.nextSibling),y=R.data==="F!";break e}}Wr(y)}y=!1}y&&(d=p[0])}}return p=Yn(),p.memoizedState=p.baseState=d,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$w,lastRenderedState:d},p.queue=y,p=ck.bind(null,et,y),y.dispatch=p,y=Av(!1),I=Nv.bind(null,et,!1,y.queue),y=Yn(),R={state:d,dispatch:null,action:c,pending:null},y.queue=R,p=Jj.bind(null,et,R,I,p),R.dispatch=p,y.memoizedState=c,[d,p,!1]}function Vw(c){var d=on();return Ww(d,Lt,c)}function Ww(c,d,p){if(d=Ev(c,d,$w)[0],c=Vh(hr)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var y=lu(d)}catch(B){throw B===kl?Oh:B}else y=d;d=on();var R=d.queue,I=R.dispatch;return p!==d.memoizedState&&(et.flags|=2048,Ml(9,{destroy:void 0},Xj.bind(null,R,p),null)),[y,I,c]}function Xj(c,d){c.action=d}function Gw(c){var d=on(),p=Lt;if(p!==null)return Ww(d,p,c);on(),d=d.memoizedState,p=on();var y=p.queue.dispatch;return p.memoizedState=c,[d,y,!1]}function Ml(c,d,p,y){return c={tag:c,create:p,deps:y,inst:d,next:null},d=et.updateQueue,d===null&&(d=$h(),et.updateQueue=d),p=d.lastEffect,p===null?d.lastEffect=c.next=c:(y=p.next,p.next=c,c.next=y,d.lastEffect=c),c}function Kw(){return on().memoizedState}function Wh(c,d,p,y){var R=Yn();et.flags|=c,R.memoizedState=Ml(1|d,{destroy:void 0},p,y===void 0?null:y)}function Gh(c,d,p,y){var R=on();y=y===void 0?null:y;var I=R.memoizedState.inst;Lt!==null&&y!==null&&Sv(y,Lt.memoizedState.deps)?R.memoizedState=Ml(d,I,p,y):(et.flags|=c,R.memoizedState=Ml(1|d,I,p,y))}function Yw(c,d){Wh(8390656,8,c,d)}function Lv(c,d){Gh(2048,8,c,d)}function Zj(c){et.flags|=4;var d=et.updateQueue;if(d===null)d=$h(),et.updateQueue=d,d.events=[c];else{var p=d.events;p===null?d.events=[c]:p.push(c)}}function Qw(c){var d=on().memoizedState;return Zj({ref:d,nextImpl:c}),function(){if((kt&2)!==0)throw Error(i(440));return d.impl.apply(void 0,arguments)}}function Jw(c,d){return Gh(4,2,c,d)}function Xw(c,d){return Gh(4,4,c,d)}function Zw(c,d){if(typeof d=="function"){c=c();var p=d(c);return function(){typeof p=="function"?p():d(null)}}if(d!=null)return c=c(),d.current=c,function(){d.current=null}}function ek(c,d,p){p=p!=null?p.concat([c]):null,Gh(4,4,Zw.bind(null,d,c),p)}function Iv(){}function tk(c,d){var p=on();d=d===void 0?null:d;var y=p.memoizedState;return d!==null&&Sv(d,y[1])?y[0]:(p.memoizedState=[c,d],c)}function nk(c,d){var p=on();d=d===void 0?null:d;var y=p.memoizedState;if(d!==null&&Sv(d,y[1]))return y[0];if(y=c(),oa){sn(!0);try{c()}finally{sn(!1)}}return p.memoizedState=[y,d],y}function Pv(c,d,p){return p===void 0||(dr&1073741824)!==0&&(pt&261930)===0?c.memoizedState=d:(c.memoizedState=p,c=i1(),et.lanes|=c,to|=c,p)}function ik(c,d,p,y){return Ci(p,d)?p:El.current!==null?(c=Pv(c,p,y),Ci(c,d)||(fn=!0),c):(dr&42)===0||(dr&1073741824)!==0&&(pt&261930)===0?(fn=!0,c.memoizedState=p):(c=i1(),et.lanes|=c,to|=c,d)}function sk(c,d,p,y,R){var I=Y.p;Y.p=I!==0&&8>I?I:8;var B=$.T,W={};$.T=W,Nv(c,!1,d,p);try{var Z=R(),ae=$.S;if(ae!==null&&ae(W,Z),Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){var fe=Kj(Z,y);cu(c,d,fe,Ri(c))}else cu(c,d,y,Ri(c))}catch(me){cu(c,d,{then:function(){},status:"rejected",reason:me},Ri())}finally{Y.p=I,B!==null&&W.types!==null&&(B.types=W.types),$.T=B}}function eB(){}function Dv(c,d,p,y){if(c.tag!==5)throw Error(i(476));var R=rk(c).queue;sk(c,R,d,Q,p===null?eB:function(){return ok(c),p(y)})}function rk(c){var d=c.memoizedState;if(d!==null)return d;d={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hr,lastRenderedState:Q},next:null};var p={};return d.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hr,lastRenderedState:p},next:null},c.memoizedState=d,c=c.alternate,c!==null&&(c.memoizedState=d),d}function ok(c){var d=rk(c);d.next===null&&(d=c.alternate.memoizedState),cu(c,d.next.queue,{},Ri())}function Ov(){return Ln(Tu)}function ak(){return on().memoizedState}function lk(){return on().memoizedState}function tB(c){for(var d=c.return;d!==null;){switch(d.tag){case 24:case 3:var p=Ri();c=Yr(p);var y=Qr(d,c,p);y!==null&&(di(y,d,p),su(y,d,p)),d={cache:uv()},c.payload=d;return}d=d.return}}function nB(c,d,p){var y=Ri();p={lane:y,revertLane:0,gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Kh(c)?uk(d,p):(p=Zg(c,d,p,y),p!==null&&(di(p,c,y),dk(p,d,y)))}function ck(c,d,p){var y=Ri();cu(c,d,p,y)}function cu(c,d,p,y){var R={lane:y,revertLane:0,gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null};if(Kh(c))uk(d,R);else{var I=c.alternate;if(c.lanes===0&&(I===null||I.lanes===0)&&(I=d.lastRenderedReducer,I!==null))try{var B=d.lastRenderedState,W=I(B,p);if(R.hasEagerState=!0,R.eagerState=W,Ci(W,B))return Rh(c,d,R,0),jt===null&&Eh(),!1}catch{}if(p=Zg(c,d,R,y),p!==null)return di(p,c,y),dk(p,d,y),!0}return!1}function Nv(c,d,p,y){if(y={lane:2,revertLane:pb(),gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},Kh(c)){if(d)throw Error(i(479))}else d=Zg(c,p,y,2),d!==null&&di(d,c,2)}function Kh(c){var d=c.alternate;return c===et||d!==null&&d===et}function uk(c,d){Rl=zh=!0;var p=c.pending;p===null?d.next=d:(d.next=p.next,p.next=d),c.pending=d}function dk(c,d,p){if((p&4194048)!==0){var y=d.lanes;y&=c.pendingLanes,p|=y,d.lanes=p,os(c,p)}}var uu={readContext:Ln,use:qh,useCallback:Zt,useContext:Zt,useEffect:Zt,useImperativeHandle:Zt,useLayoutEffect:Zt,useInsertionEffect:Zt,useMemo:Zt,useReducer:Zt,useRef:Zt,useState:Zt,useDebugValue:Zt,useDeferredValue:Zt,useTransition:Zt,useSyncExternalStore:Zt,useId:Zt,useHostTransitionStatus:Zt,useFormState:Zt,useActionState:Zt,useOptimistic:Zt,useMemoCache:Zt,useCacheRefresh:Zt};uu.useEffectEvent=Zt;var hk={readContext:Ln,use:qh,useCallback:function(c,d){return Yn().memoizedState=[c,d===void 0?null:d],c},useContext:Ln,useEffect:Yw,useImperativeHandle:function(c,d,p){p=p!=null?p.concat([c]):null,Wh(4194308,4,Zw.bind(null,d,c),p)},useLayoutEffect:function(c,d){return Wh(4194308,4,c,d)},useInsertionEffect:function(c,d){Wh(4,2,c,d)},useMemo:function(c,d){var p=Yn();d=d===void 0?null:d;var y=c();if(oa){sn(!0);try{c()}finally{sn(!1)}}return p.memoizedState=[y,d],y},useReducer:function(c,d,p){var y=Yn();if(p!==void 0){var R=p(d);if(oa){sn(!0);try{p(d)}finally{sn(!1)}}}else R=d;return y.memoizedState=y.baseState=R,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:R},y.queue=c,c=c.dispatch=nB.bind(null,et,c),[y.memoizedState,c]},useRef:function(c){var d=Yn();return c={current:c},d.memoizedState=c},useState:function(c){c=Av(c);var d=c.queue,p=ck.bind(null,et,d);return d.dispatch=p,[c.memoizedState,p]},useDebugValue:Iv,useDeferredValue:function(c,d){var p=Yn();return Pv(p,c,d)},useTransition:function(){var c=Av(!1);return c=sk.bind(null,et,c.queue,!0,!1),Yn().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,d,p){var y=et,R=Yn();if(gt){if(p===void 0)throw Error(i(407));p=p()}else{if(p=d(),jt===null)throw Error(i(349));(pt&127)!==0||Pw(y,d,p)}R.memoizedState=p;var I={value:p,getSnapshot:d};return R.queue=I,Yw(Ow.bind(null,y,I,c),[c]),y.flags|=2048,Ml(9,{destroy:void 0},Dw.bind(null,y,I,p,d),null),p},useId:function(){var c=Yn(),d=jt.identifierPrefix;if(gt){var p=Is,y=Ls;p=(y&~(1<<32-St(y)-1)).toString(32)+p,d="_"+d+"R_"+p,p=Hh++,0<p&&(d+="H"+p.toString(32)),d+="_"}else p=Yj++,d="_"+d+"r_"+p.toString(32)+"_";return c.memoizedState=d},useHostTransitionStatus:Ov,useFormState:qw,useActionState:qw,useOptimistic:function(c){var d=Yn();d.memoizedState=d.baseState=c;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=p,d=Nv.bind(null,et,!0,p),p.dispatch=d,[c,d]},useMemoCache:Tv,useCacheRefresh:function(){return Yn().memoizedState=tB.bind(null,et)},useEffectEvent:function(c){var d=Yn(),p={impl:c};return d.memoizedState=p,function(){if((kt&2)!==0)throw Error(i(440));return p.impl.apply(void 0,arguments)}}},jv={readContext:Ln,use:qh,useCallback:tk,useContext:Ln,useEffect:Lv,useImperativeHandle:ek,useInsertionEffect:Jw,useLayoutEffect:Xw,useMemo:nk,useReducer:Vh,useRef:Kw,useState:function(){return Vh(hr)},useDebugValue:Iv,useDeferredValue:function(c,d){var p=on();return ik(p,Lt.memoizedState,c,d)},useTransition:function(){var c=Vh(hr)[0],d=on().memoizedState;return[typeof c=="boolean"?c:lu(c),d]},useSyncExternalStore:Iw,useId:ak,useHostTransitionStatus:Ov,useFormState:Vw,useActionState:Vw,useOptimistic:function(c,d){var p=on();return Bw(p,Lt,c,d)},useMemoCache:Tv,useCacheRefresh:lk};jv.useEffectEvent=Qw;var fk={readContext:Ln,use:qh,useCallback:tk,useContext:Ln,useEffect:Lv,useImperativeHandle:ek,useInsertionEffect:Jw,useLayoutEffect:Xw,useMemo:nk,useReducer:Rv,useRef:Kw,useState:function(){return Rv(hr)},useDebugValue:Iv,useDeferredValue:function(c,d){var p=on();return Lt===null?Pv(p,c,d):ik(p,Lt.memoizedState,c,d)},useTransition:function(){var c=Rv(hr)[0],d=on().memoizedState;return[typeof c=="boolean"?c:lu(c),d]},useSyncExternalStore:Iw,useId:ak,useHostTransitionStatus:Ov,useFormState:Gw,useActionState:Gw,useOptimistic:function(c,d){var p=on();return Lt!==null?Bw(p,Lt,c,d):(p.baseState=c,[c,p.queue.dispatch])},useMemoCache:Tv,useCacheRefresh:lk};fk.useEffectEvent=Qw;function Bv(c,d,p,y){d=c.memoizedState,p=p(y,d),p=p==null?d:f({},d,p),c.memoizedState=p,c.lanes===0&&(c.updateQueue.baseState=p)}var Fv={enqueueSetState:function(c,d,p){c=c._reactInternals;var y=Ri(),R=Yr(y);R.payload=d,p!=null&&(R.callback=p),d=Qr(c,R,y),d!==null&&(di(d,c,y),su(d,c,y))},enqueueReplaceState:function(c,d,p){c=c._reactInternals;var y=Ri(),R=Yr(y);R.tag=1,R.payload=d,p!=null&&(R.callback=p),d=Qr(c,R,y),d!==null&&(di(d,c,y),su(d,c,y))},enqueueForceUpdate:function(c,d){c=c._reactInternals;var p=Ri(),y=Yr(p);y.tag=2,d!=null&&(y.callback=d),d=Qr(c,y,p),d!==null&&(di(d,c,p),su(d,c,p))}};function pk(c,d,p,y,R,I,B){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(y,I,B):d.prototype&&d.prototype.isPureReactComponent?!Qc(p,y)||!Qc(R,I):!0}function mk(c,d,p,y){c=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(p,y),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(p,y),d.state!==c&&Fv.enqueueReplaceState(d,d.state,null)}function aa(c,d){var p=d;if("ref"in d){p={};for(var y in d)y!=="ref"&&(p[y]=d[y])}if(c=c.defaultProps){p===d&&(p=f({},p));for(var R in c)p[R]===void 0&&(p[R]=c[R])}return p}function gk(c){Th(c)}function vk(c){console.error(c)}function bk(c){Th(c)}function Yh(c,d){try{var p=c.onUncaughtError;p(d.value,{componentStack:d.stack})}catch(y){setTimeout(function(){throw y})}}function yk(c,d,p){try{var y=c.onCaughtError;y(p.value,{componentStack:p.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(R){setTimeout(function(){throw R})}}function Uv(c,d,p){return p=Yr(p),p.tag=3,p.payload={element:null},p.callback=function(){Yh(c,d)},p}function _k(c){return c=Yr(c),c.tag=3,c}function Sk(c,d,p,y){var R=p.type.getDerivedStateFromError;if(typeof R=="function"){var I=y.value;c.payload=function(){return R(I)},c.callback=function(){yk(d,p,y)}}var B=p.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(c.callback=function(){yk(d,p,y),typeof R!="function"&&(no===null?no=new Set([this]):no.add(this));var W=y.stack;this.componentDidCatch(y.value,{componentStack:W!==null?W:""})})}function iB(c,d,p,y,R){if(p.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){if(d=p.alternate,d!==null&&Cl(d,p,R,!0),p=wi.current,p!==null){switch(p.tag){case 31:case 13:return $i===null?lf():p.alternate===null&&en===0&&(en=3),p.flags&=-257,p.flags|=65536,p.lanes=R,y===Nh?p.flags|=16384:(d=p.updateQueue,d===null?p.updateQueue=new Set([y]):d.add(y),db(c,y,R)),!1;case 22:return p.flags|=65536,y===Nh?p.flags|=16384:(d=p.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([y])},p.updateQueue=d):(p=d.retryQueue,p===null?d.retryQueue=new Set([y]):p.add(y)),db(c,y,R)),!1}throw Error(i(435,p.tag))}return db(c,y,R),lf(),!1}if(gt)return d=wi.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=R,y!==rv&&(c=Error(i(422),{cause:y}),Zc(Fi(c,p)))):(y!==rv&&(d=Error(i(423),{cause:y}),Zc(Fi(d,p))),c=c.current.alternate,c.flags|=65536,R&=-R,c.lanes|=R,y=Fi(y,p),R=Uv(c.stateNode,y,R),gv(c,R),en!==4&&(en=2)),!1;var I=Error(i(520),{cause:y});if(I=Fi(I,p),bu===null?bu=[I]:bu.push(I),en!==4&&(en=2),d===null)return!0;y=Fi(y,p),p=d;do{switch(p.tag){case 3:return p.flags|=65536,c=R&-R,p.lanes|=c,c=Uv(p.stateNode,y,c),gv(p,c),!1;case 1:if(d=p.type,I=p.stateNode,(p.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(no===null||!no.has(I))))return p.flags|=65536,R&=-R,p.lanes|=R,R=_k(R),Sk(R,c,p,y),gv(p,R),!1}p=p.return}while(p!==null);return!1}var zv=Error(i(461)),fn=!1;function In(c,d,p,y){d.child=c===null?kw(d,null,p,y):ra(d,c.child,p,y)}function Ck(c,d,p,y,R){p=p.render;var I=d.ref;if("ref"in y){var B={};for(var W in y)W!=="ref"&&(B[W]=y[W])}else B=y;return ta(d),y=Cv(c,d,p,B,I,R),W=xv(),c!==null&&!fn?(wv(c,d,R),fr(c,d,R)):(gt&&W&&iv(d),d.flags|=1,In(c,d,y,R),d.child)}function xk(c,d,p,y,R){if(c===null){var I=p.type;return typeof I=="function"&&!ev(I)&&I.defaultProps===void 0&&p.compare===null?(d.tag=15,d.type=I,wk(c,d,I,y,R)):(c=Mh(p.type,null,y,d,d.mode,R),c.ref=d.ref,c.return=d,d.child=c)}if(I=c.child,!Yv(c,R)){var B=I.memoizedProps;if(p=p.compare,p=p!==null?p:Qc,p(B,y)&&c.ref===d.ref)return fr(c,d,R)}return d.flags|=1,c=ar(I,y),c.ref=d.ref,c.return=d,d.child=c}function wk(c,d,p,y,R){if(c!==null){var I=c.memoizedProps;if(Qc(I,y)&&c.ref===d.ref)if(fn=!1,d.pendingProps=y=I,Yv(c,R))(c.flags&131072)!==0&&(fn=!0);else return d.lanes=c.lanes,fr(c,d,R)}return Hv(c,d,p,y,R)}function kk(c,d,p,y){var R=y.children,I=c!==null?c.memoizedState:null;if(c===null&&d.stateNode===null&&(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),y.mode==="hidden"){if((d.flags&128)!==0){if(I=I!==null?I.baseLanes|p:p,c!==null){for(y=d.child=c.child,R=0;y!==null;)R=R|y.lanes|y.childLanes,y=y.sibling;y=R&~I}else y=0,d.child=null;return Tk(c,d,I,p,y)}if((p&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},c!==null&&Dh(d,I!==null?I.cachePool:null),I!==null?Rw(d,I):bv(),Aw(d);else return y=d.lanes=536870912,Tk(c,d,I!==null?I.baseLanes|p:p,p,y)}else I!==null?(Dh(d,I.cachePool),Rw(d,I),Xr(),d.memoizedState=null):(c!==null&&Dh(d,null),bv(),Xr());return In(c,d,R,p),d.child}function du(c,d){return c!==null&&c.tag===22||d.stateNode!==null||(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.sibling}function Tk(c,d,p,y,R){var I=hv();return I=I===null?null:{parent:dn._currentValue,pool:I},d.memoizedState={baseLanes:p,cachePool:I},c!==null&&Dh(d,null),bv(),Aw(d),c!==null&&Cl(c,d,y,!0),d.childLanes=R,null}function Qh(c,d){return d=Xh({mode:d.mode,children:d.children},c.mode),d.ref=c.ref,c.child=d,d.return=c,d}function Ek(c,d,p){return ra(d,c.child,null,p),c=Qh(d,d.pendingProps),c.flags|=2,ki(d),d.memoizedState=null,c}function sB(c,d,p){var y=d.pendingProps,R=(d.flags&128)!==0;if(d.flags&=-129,c===null){if(gt){if(y.mode==="hidden")return c=Qh(d,y),d.lanes=536870912,du(null,c);if(_v(d),(c=$t)?(c=F1(c,Hi),c=c!==null&&c.data==="&"?c:null,c!==null&&(d.memoizedState={dehydrated:c,treeContext:qr!==null?{id:Ls,overflow:Is}:null,retryLane:536870912,hydrationErrors:null},p=uw(c),p.return=d,d.child=p,Mn=d,$t=null)):c=null,c===null)throw Wr(d);return d.lanes=536870912,null}return Qh(d,y)}var I=c.memoizedState;if(I!==null){var B=I.dehydrated;if(_v(d),R)if(d.flags&256)d.flags&=-257,d=Ek(c,d,p);else if(d.memoizedState!==null)d.child=c.child,d.flags|=128,d=null;else throw Error(i(558));else if(fn||Cl(c,d,p,!1),R=(p&c.childLanes)!==0,fn||R){if(y=jt,y!==null&&(B=Wo(y,p),B!==0&&B!==I.retryLane))throw I.retryLane=B,Jo(c,B),di(y,c,B),zv;lf(),d=Ek(c,d,p)}else c=I.treeContext,$t=qi(B.nextSibling),Mn=d,gt=!0,Vr=null,Hi=!1,c!==null&&fw(d,c),d=Qh(d,y),d.flags|=4096;return d}return c=ar(c.child,{mode:y.mode,children:y.children}),c.ref=d.ref,d.child=c,c.return=d,c}function Jh(c,d){var p=d.ref;if(p===null)c!==null&&c.ref!==null&&(d.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(i(284));(c===null||c.ref!==p)&&(d.flags|=4194816)}}function Hv(c,d,p,y,R){return ta(d),p=Cv(c,d,p,y,void 0,R),y=xv(),c!==null&&!fn?(wv(c,d,R),fr(c,d,R)):(gt&&y&&iv(d),d.flags|=1,In(c,d,p,R),d.child)}function Rk(c,d,p,y,R,I){return ta(d),d.updateQueue=null,p=Lw(d,y,p,R),Mw(c),y=xv(),c!==null&&!fn?(wv(c,d,I),fr(c,d,I)):(gt&&y&&iv(d),d.flags|=1,In(c,d,p,I),d.child)}function Ak(c,d,p,y,R){if(ta(d),d.stateNode===null){var I=bl,B=p.contextType;typeof B=="object"&&B!==null&&(I=Ln(B)),I=new p(y,I),d.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,I.updater=Fv,d.stateNode=I,I._reactInternals=d,I=d.stateNode,I.props=y,I.state=d.memoizedState,I.refs={},pv(d),B=p.contextType,I.context=typeof B=="object"&&B!==null?Ln(B):bl,I.state=d.memoizedState,B=p.getDerivedStateFromProps,typeof B=="function"&&(Bv(d,p,B,y),I.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(B=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),B!==I.state&&Fv.enqueueReplaceState(I,I.state,null),ou(d,y,I,R),ru(),I.state=d.memoizedState),typeof I.componentDidMount=="function"&&(d.flags|=4194308),y=!0}else if(c===null){I=d.stateNode;var W=d.memoizedProps,Z=aa(p,W);I.props=Z;var ae=I.context,fe=p.contextType;B=bl,typeof fe=="object"&&fe!==null&&(B=Ln(fe));var me=p.getDerivedStateFromProps;fe=typeof me=="function"||typeof I.getSnapshotBeforeUpdate=="function",W=d.pendingProps!==W,fe||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(W||ae!==B)&&mk(d,I,y,B),Kr=!1;var le=d.memoizedState;I.state=le,ou(d,y,I,R),ru(),ae=d.memoizedState,W||le!==ae||Kr?(typeof me=="function"&&(Bv(d,p,me,y),ae=d.memoizedState),(Z=Kr||pk(d,p,Z,y,le,ae,B))?(fe||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(d.flags|=4194308)):(typeof I.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=y,d.memoizedState=ae),I.props=y,I.state=ae,I.context=B,y=Z):(typeof I.componentDidMount=="function"&&(d.flags|=4194308),y=!1)}else{I=d.stateNode,mv(c,d),B=d.memoizedProps,fe=aa(p,B),I.props=fe,me=d.pendingProps,le=I.context,ae=p.contextType,Z=bl,typeof ae=="object"&&ae!==null&&(Z=Ln(ae)),W=p.getDerivedStateFromProps,(ae=typeof W=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(B!==me||le!==Z)&&mk(d,I,y,Z),Kr=!1,le=d.memoizedState,I.state=le,ou(d,y,I,R),ru();var de=d.memoizedState;B!==me||le!==de||Kr||c!==null&&c.dependencies!==null&&Ih(c.dependencies)?(typeof W=="function"&&(Bv(d,p,W,y),de=d.memoizedState),(fe=Kr||pk(d,p,fe,y,le,de,Z)||c!==null&&c.dependencies!==null&&Ih(c.dependencies))?(ae||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(y,de,Z),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(y,de,Z)),typeof I.componentDidUpdate=="function"&&(d.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof I.componentDidUpdate!="function"||B===c.memoizedProps&&le===c.memoizedState||(d.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||B===c.memoizedProps&&le===c.memoizedState||(d.flags|=1024),d.memoizedProps=y,d.memoizedState=de),I.props=y,I.state=de,I.context=Z,y=fe):(typeof I.componentDidUpdate!="function"||B===c.memoizedProps&&le===c.memoizedState||(d.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||B===c.memoizedProps&&le===c.memoizedState||(d.flags|=1024),y=!1)}return I=y,Jh(c,d),y=(d.flags&128)!==0,I||y?(I=d.stateNode,p=y&&typeof p.getDerivedStateFromError!="function"?null:I.render(),d.flags|=1,c!==null&&y?(d.child=ra(d,c.child,null,R),d.child=ra(d,null,p,R)):In(c,d,p,R),d.memoizedState=I.state,c=d.child):c=fr(c,d,R),c}function Mk(c,d,p,y){return Zo(),d.flags|=256,In(c,d,p,y),d.child}var $v={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qv(c){return{baseLanes:c,cachePool:yw()}}function Vv(c,d,p){return c=c!==null?c.childLanes&~p:0,d&&(c|=Ei),c}function Lk(c,d,p){var y=d.pendingProps,R=!1,I=(d.flags&128)!==0,B;if((B=I)||(B=c!==null&&c.memoizedState===null?!1:(rn.current&2)!==0),B&&(R=!0,d.flags&=-129),B=(d.flags&32)!==0,d.flags&=-33,c===null){if(gt){if(R?Jr(d):Xr(),(c=$t)?(c=F1(c,Hi),c=c!==null&&c.data!=="&"?c:null,c!==null&&(d.memoizedState={dehydrated:c,treeContext:qr!==null?{id:Ls,overflow:Is}:null,retryLane:536870912,hydrationErrors:null},p=uw(c),p.return=d,d.child=p,Mn=d,$t=null)):c=null,c===null)throw Wr(d);return Eb(c)?d.lanes=32:d.lanes=536870912,null}var W=y.children;return y=y.fallback,R?(Xr(),R=d.mode,W=Xh({mode:"hidden",children:W},R),y=Xo(y,R,p,null),W.return=d,y.return=d,W.sibling=y,d.child=W,y=d.child,y.memoizedState=qv(p),y.childLanes=Vv(c,B,p),d.memoizedState=$v,du(null,y)):(Jr(d),Wv(d,W))}var Z=c.memoizedState;if(Z!==null&&(W=Z.dehydrated,W!==null)){if(I)d.flags&256?(Jr(d),d.flags&=-257,d=Gv(c,d,p)):d.memoizedState!==null?(Xr(),d.child=c.child,d.flags|=128,d=null):(Xr(),W=y.fallback,R=d.mode,y=Xh({mode:"visible",children:y.children},R),W=Xo(W,R,p,null),W.flags|=2,y.return=d,W.return=d,y.sibling=W,d.child=y,ra(d,c.child,null,p),y=d.child,y.memoizedState=qv(p),y.childLanes=Vv(c,B,p),d.memoizedState=$v,d=du(null,y));else if(Jr(d),Eb(W)){if(B=W.nextSibling&&W.nextSibling.dataset,B)var ae=B.dgst;B=ae,y=Error(i(419)),y.stack="",y.digest=B,Zc({value:y,source:null,stack:null}),d=Gv(c,d,p)}else if(fn||Cl(c,d,p,!1),B=(p&c.childLanes)!==0,fn||B){if(B=jt,B!==null&&(y=Wo(B,p),y!==0&&y!==Z.retryLane))throw Z.retryLane=y,Jo(c,y),di(B,c,y),zv;Tb(W)||lf(),d=Gv(c,d,p)}else Tb(W)?(d.flags|=192,d.child=c.child,d=null):(c=Z.treeContext,$t=qi(W.nextSibling),Mn=d,gt=!0,Vr=null,Hi=!1,c!==null&&fw(d,c),d=Wv(d,y.children),d.flags|=4096);return d}return R?(Xr(),W=y.fallback,R=d.mode,Z=c.child,ae=Z.sibling,y=ar(Z,{mode:"hidden",children:y.children}),y.subtreeFlags=Z.subtreeFlags&65011712,ae!==null?W=ar(ae,W):(W=Xo(W,R,p,null),W.flags|=2),W.return=d,y.return=d,y.sibling=W,d.child=y,du(null,y),y=d.child,W=c.child.memoizedState,W===null?W=qv(p):(R=W.cachePool,R!==null?(Z=dn._currentValue,R=R.parent!==Z?{parent:Z,pool:Z}:R):R=yw(),W={baseLanes:W.baseLanes|p,cachePool:R}),y.memoizedState=W,y.childLanes=Vv(c,B,p),d.memoizedState=$v,du(c.child,y)):(Jr(d),p=c.child,c=p.sibling,p=ar(p,{mode:"visible",children:y.children}),p.return=d,p.sibling=null,c!==null&&(B=d.deletions,B===null?(d.deletions=[c],d.flags|=16):B.push(c)),d.child=p,d.memoizedState=null,p)}function Wv(c,d){return d=Xh({mode:"visible",children:d},c.mode),d.return=c,c.child=d}function Xh(c,d){return c=xi(22,c,null,d),c.lanes=0,c}function Gv(c,d,p){return ra(d,c.child,null,p),c=Wv(d,d.pendingProps.children),c.flags|=2,d.memoizedState=null,c}function Ik(c,d,p){c.lanes|=d;var y=c.alternate;y!==null&&(y.lanes|=d),lv(c.return,d,p)}function Kv(c,d,p,y,R,I){var B=c.memoizedState;B===null?c.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:y,tail:p,tailMode:R,treeForkCount:I}:(B.isBackwards=d,B.rendering=null,B.renderingStartTime=0,B.last=y,B.tail=p,B.tailMode=R,B.treeForkCount=I)}function Pk(c,d,p){var y=d.pendingProps,R=y.revealOrder,I=y.tail;y=y.children;var B=rn.current,W=(B&2)!==0;if(W?(B=B&1|2,d.flags|=128):B&=1,H(rn,B),In(c,d,y,p),y=gt?Xc:0,!W&&c!==null&&(c.flags&128)!==0)e:for(c=d.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&Ik(c,p,d);else if(c.tag===19)Ik(c,p,d);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===d)break e;for(;c.sibling===null;){if(c.return===null||c.return===d)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(R){case"forwards":for(p=d.child,R=null;p!==null;)c=p.alternate,c!==null&&Uh(c)===null&&(R=p),p=p.sibling;p=R,p===null?(R=d.child,d.child=null):(R=p.sibling,p.sibling=null),Kv(d,!1,R,p,I,y);break;case"backwards":case"unstable_legacy-backwards":for(p=null,R=d.child,d.child=null;R!==null;){if(c=R.alternate,c!==null&&Uh(c)===null){d.child=R;break}c=R.sibling,R.sibling=p,p=R,R=c}Kv(d,!0,p,null,I,y);break;case"together":Kv(d,!1,null,null,void 0,y);break;default:d.memoizedState=null}return d.child}function fr(c,d,p){if(c!==null&&(d.dependencies=c.dependencies),to|=d.lanes,(p&d.childLanes)===0)if(c!==null){if(Cl(c,d,p,!1),(p&d.childLanes)===0)return null}else return null;if(c!==null&&d.child!==c.child)throw Error(i(153));if(d.child!==null){for(c=d.child,p=ar(c,c.pendingProps),d.child=p,p.return=d;c.sibling!==null;)c=c.sibling,p=p.sibling=ar(c,c.pendingProps),p.return=d;p.sibling=null}return d.child}function Yv(c,d){return(c.lanes&d)!==0?!0:(c=c.dependencies,!!(c!==null&&Ih(c)))}function rB(c,d,p){switch(d.tag){case 3:V(d,d.stateNode.containerInfo),Gr(d,dn,c.memoizedState.cache),Zo();break;case 27:case 5:he(d);break;case 4:V(d,d.stateNode.containerInfo);break;case 10:Gr(d,d.type,d.memoizedProps.value);break;case 31:if(d.memoizedState!==null)return d.flags|=128,_v(d),null;break;case 13:var y=d.memoizedState;if(y!==null)return y.dehydrated!==null?(Jr(d),d.flags|=128,null):(p&d.child.childLanes)!==0?Lk(c,d,p):(Jr(d),c=fr(c,d,p),c!==null?c.sibling:null);Jr(d);break;case 19:var R=(c.flags&128)!==0;if(y=(p&d.childLanes)!==0,y||(Cl(c,d,p,!1),y=(p&d.childLanes)!==0),R){if(y)return Pk(c,d,p);d.flags|=128}if(R=d.memoizedState,R!==null&&(R.rendering=null,R.tail=null,R.lastEffect=null),H(rn,rn.current),y)break;return null;case 22:return d.lanes=0,kk(c,d,p,d.pendingProps);case 24:Gr(d,dn,c.memoizedState.cache)}return fr(c,d,p)}function Dk(c,d,p){if(c!==null)if(c.memoizedProps!==d.pendingProps)fn=!0;else{if(!Yv(c,p)&&(d.flags&128)===0)return fn=!1,rB(c,d,p);fn=(c.flags&131072)!==0}else fn=!1,gt&&(d.flags&1048576)!==0&&hw(d,Xc,d.index);switch(d.lanes=0,d.tag){case 16:e:{var y=d.pendingProps;if(c=ia(d.elementType),d.type=c,typeof c=="function")ev(c)?(y=aa(c,y),d.tag=1,d=Ak(null,d,c,y,p)):(d.tag=0,d=Hv(null,d,c,y,p));else{if(c!=null){var R=c.$$typeof;if(R===k){d.tag=11,d=Ck(null,d,c,y,p);break e}else if(R===M){d.tag=14,d=xk(null,d,c,y,p);break e}}throw d=q(c)||c,Error(i(306,d,""))}}return d;case 0:return Hv(c,d,d.type,d.pendingProps,p);case 1:return y=d.type,R=aa(y,d.pendingProps),Ak(c,d,y,R,p);case 3:e:{if(V(d,d.stateNode.containerInfo),c===null)throw Error(i(387));y=d.pendingProps;var I=d.memoizedState;R=I.element,mv(c,d),ou(d,y,null,p);var B=d.memoizedState;if(y=B.cache,Gr(d,dn,y),y!==I.cache&&cv(d,[dn],p,!0),ru(),y=B.element,I.isDehydrated)if(I={element:y,isDehydrated:!1,cache:B.cache},d.updateQueue.baseState=I,d.memoizedState=I,d.flags&256){d=Mk(c,d,y,p);break e}else if(y!==R){R=Fi(Error(i(424)),d),Zc(R),d=Mk(c,d,y,p);break e}else for(c=d.stateNode.containerInfo,c.nodeType===9?c=c.body:c=c.nodeName==="HTML"?c.ownerDocument.body:c,$t=qi(c.firstChild),Mn=d,gt=!0,Vr=null,Hi=!0,p=kw(d,null,y,p),d.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling;else{if(Zo(),y===R){d=fr(c,d,p);break e}In(c,d,y,p)}d=d.child}return d;case 26:return Jh(c,d),c===null?(p=V1(d.type,null,d.pendingProps,null))?d.memoizedState=p:gt||(p=d.type,c=d.pendingProps,y=mf(ce.current).createElement(p),y[An]=d,y[ri]=c,Pn(y,p,c),Cn(y),d.stateNode=y):d.memoizedState=V1(d.type,c.memoizedProps,d.pendingProps,c.memoizedState),null;case 27:return he(d),c===null&&gt&&(y=d.stateNode=H1(d.type,d.pendingProps,ce.current),Mn=d,Hi=!0,R=$t,oo(d.type)?(Rb=R,$t=qi(y.firstChild)):$t=R),In(c,d,d.pendingProps.children,p),Jh(c,d),c===null&&(d.flags|=4194304),d.child;case 5:return c===null&&gt&&((R=y=$t)&&(y=OB(y,d.type,d.pendingProps,Hi),y!==null?(d.stateNode=y,Mn=d,$t=qi(y.firstChild),Hi=!1,R=!0):R=!1),R||Wr(d)),he(d),R=d.type,I=d.pendingProps,B=c!==null?c.memoizedProps:null,y=I.children,xb(R,I)?y=null:B!==null&&xb(R,B)&&(d.flags|=32),d.memoizedState!==null&&(R=Cv(c,d,Qj,null,null,p),Tu._currentValue=R),Jh(c,d),In(c,d,y,p),d.child;case 6:return c===null&&gt&&((c=p=$t)&&(p=NB(p,d.pendingProps,Hi),p!==null?(d.stateNode=p,Mn=d,$t=null,c=!0):c=!1),c||Wr(d)),null;case 13:return Lk(c,d,p);case 4:return V(d,d.stateNode.containerInfo),y=d.pendingProps,c===null?d.child=ra(d,null,y,p):In(c,d,y,p),d.child;case 11:return Ck(c,d,d.type,d.pendingProps,p);case 7:return In(c,d,d.pendingProps,p),d.child;case 8:return In(c,d,d.pendingProps.children,p),d.child;case 12:return In(c,d,d.pendingProps.children,p),d.child;case 10:return y=d.pendingProps,Gr(d,d.type,y.value),In(c,d,y.children,p),d.child;case 9:return R=d.type._context,y=d.pendingProps.children,ta(d),R=Ln(R),y=y(R),d.flags|=1,In(c,d,y,p),d.child;case 14:return xk(c,d,d.type,d.pendingProps,p);case 15:return wk(c,d,d.type,d.pendingProps,p);case 19:return Pk(c,d,p);case 31:return sB(c,d,p);case 22:return kk(c,d,p,d.pendingProps);case 24:return ta(d),y=Ln(dn),c===null?(R=hv(),R===null&&(R=jt,I=uv(),R.pooledCache=I,I.refCount++,I!==null&&(R.pooledCacheLanes|=p),R=I),d.memoizedState={parent:y,cache:R},pv(d),Gr(d,dn,R)):((c.lanes&p)!==0&&(mv(c,d),ou(d,null,null,p),ru()),R=c.memoizedState,I=d.memoizedState,R.parent!==y?(R={parent:y,cache:y},d.memoizedState=R,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=R),Gr(d,dn,y)):(y=I.cache,Gr(d,dn,y),y!==R.cache&&cv(d,[dn],p,!0))),In(c,d,d.pendingProps.children,p),d.child;case 29:throw d.pendingProps}throw Error(i(156,d.tag))}function pr(c){c.flags|=4}function Qv(c,d,p,y,R){if((d=(c.mode&32)!==0)&&(d=!1),d){if(c.flags|=16777216,(R&335544128)===R)if(c.stateNode.complete)c.flags|=8192;else if(a1())c.flags|=8192;else throw sa=Nh,fv}else c.flags&=-16777217}function Ok(c,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!Q1(d))if(a1())c.flags|=8192;else throw sa=Nh,fv}function Zh(c,d){d!==null&&(c.flags|=4),c.flags&16384&&(d=c.tag!==22?mh():536870912,c.lanes|=d,Dl|=d)}function hu(c,d){if(!gt)switch(c.tailMode){case"hidden":d=c.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?c.tail=null:p.sibling=null;break;case"collapsed":p=c.tail;for(var y=null;p!==null;)p.alternate!==null&&(y=p),p=p.sibling;y===null?d||c.tail===null?c.tail=null:c.tail.sibling=null:y.sibling=null}}function qt(c){var d=c.alternate!==null&&c.alternate.child===c.child,p=0,y=0;if(d)for(var R=c.child;R!==null;)p|=R.lanes|R.childLanes,y|=R.subtreeFlags&65011712,y|=R.flags&65011712,R.return=c,R=R.sibling;else for(R=c.child;R!==null;)p|=R.lanes|R.childLanes,y|=R.subtreeFlags,y|=R.flags,R.return=c,R=R.sibling;return c.subtreeFlags|=y,c.childLanes=p,d}function oB(c,d,p){var y=d.pendingProps;switch(sv(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(d),null;case 1:return qt(d),null;case 3:return p=d.stateNode,y=null,c!==null&&(y=c.memoizedState.cache),d.memoizedState.cache!==y&&(d.flags|=2048),ur(dn),ne(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(c===null||c.child===null)&&(Sl(d)?pr(d):c===null||c.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,ov())),qt(d),null;case 26:var R=d.type,I=d.memoizedState;return c===null?(pr(d),I!==null?(qt(d),Ok(d,I)):(qt(d),Qv(d,R,null,y,p))):I?I!==c.memoizedState?(pr(d),qt(d),Ok(d,I)):(qt(d),d.flags&=-16777217):(c=c.memoizedProps,c!==y&&pr(d),qt(d),Qv(d,R,c,y,p)),null;case 27:if(_e(d),p=ce.current,R=d.type,c!==null&&d.stateNode!=null)c.memoizedProps!==y&&pr(d);else{if(!y){if(d.stateNode===null)throw Error(i(166));return qt(d),null}c=ee.current,Sl(d)?pw(d):(c=H1(R,y,p),d.stateNode=c,pr(d))}return qt(d),null;case 5:if(_e(d),R=d.type,c!==null&&d.stateNode!=null)c.memoizedProps!==y&&pr(d);else{if(!y){if(d.stateNode===null)throw Error(i(166));return qt(d),null}if(I=ee.current,Sl(d))pw(d);else{var B=mf(ce.current);switch(I){case 1:I=B.createElementNS("http://www.w3.org/2000/svg",R);break;case 2:I=B.createElementNS("http://www.w3.org/1998/Math/MathML",R);break;default:switch(R){case"svg":I=B.createElementNS("http://www.w3.org/2000/svg",R);break;case"math":I=B.createElementNS("http://www.w3.org/1998/Math/MathML",R);break;case"script":I=B.createElement("div"),I.innerHTML="<script><\/script>",I=I.removeChild(I.firstChild);break;case"select":I=typeof y.is=="string"?B.createElement("select",{is:y.is}):B.createElement("select"),y.multiple?I.multiple=!0:y.size&&(I.size=y.size);break;default:I=typeof y.is=="string"?B.createElement(R,{is:y.is}):B.createElement(R)}}I[An]=d,I[ri]=y;e:for(B=d.child;B!==null;){if(B.tag===5||B.tag===6)I.appendChild(B.stateNode);else if(B.tag!==4&&B.tag!==27&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===d)break e;for(;B.sibling===null;){if(B.return===null||B.return===d)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}d.stateNode=I;e:switch(Pn(I,R,y),R){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}y&&pr(d)}}return qt(d),Qv(d,d.type,c===null?null:c.memoizedProps,d.pendingProps,p),null;case 6:if(c&&d.stateNode!=null)c.memoizedProps!==y&&pr(d);else{if(typeof y!="string"&&d.stateNode===null)throw Error(i(166));if(c=ce.current,Sl(d)){if(c=d.stateNode,p=d.memoizedProps,y=null,R=Mn,R!==null)switch(R.tag){case 27:case 5:y=R.memoizedProps}c[An]=d,c=!!(c.nodeValue===p||y!==null&&y.suppressHydrationWarning===!0||L1(c.nodeValue,p)),c||Wr(d,!0)}else c=mf(c).createTextNode(y),c[An]=d,d.stateNode=c}return qt(d),null;case 31:if(p=d.memoizedState,c===null||c.memoizedState!==null){if(y=Sl(d),p!==null){if(c===null){if(!y)throw Error(i(318));if(c=d.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(i(557));c[An]=d}else Zo(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;qt(d),c=!1}else p=ov(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=p),c=!0;if(!c)return d.flags&256?(ki(d),d):(ki(d),null);if((d.flags&128)!==0)throw Error(i(558))}return qt(d),null;case 13:if(y=d.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(R=Sl(d),y!==null&&y.dehydrated!==null){if(c===null){if(!R)throw Error(i(318));if(R=d.memoizedState,R=R!==null?R.dehydrated:null,!R)throw Error(i(317));R[An]=d}else Zo(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;qt(d),R=!1}else R=ov(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=R),R=!0;if(!R)return d.flags&256?(ki(d),d):(ki(d),null)}return ki(d),(d.flags&128)!==0?(d.lanes=p,d):(p=y!==null,c=c!==null&&c.memoizedState!==null,p&&(y=d.child,R=null,y.alternate!==null&&y.alternate.memoizedState!==null&&y.alternate.memoizedState.cachePool!==null&&(R=y.alternate.memoizedState.cachePool.pool),I=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(I=y.memoizedState.cachePool.pool),I!==R&&(y.flags|=2048)),p!==c&&p&&(d.child.flags|=8192),Zh(d,d.updateQueue),qt(d),null);case 4:return ne(),c===null&&bb(d.stateNode.containerInfo),qt(d),null;case 10:return ur(d.type),qt(d),null;case 19:if(G(rn),y=d.memoizedState,y===null)return qt(d),null;if(R=(d.flags&128)!==0,I=y.rendering,I===null)if(R)hu(y,!1);else{if(en!==0||c!==null&&(c.flags&128)!==0)for(c=d.child;c!==null;){if(I=Uh(c),I!==null){for(d.flags|=128,hu(y,!1),c=I.updateQueue,d.updateQueue=c,Zh(d,c),d.subtreeFlags=0,c=p,p=d.child;p!==null;)cw(p,c),p=p.sibling;return H(rn,rn.current&1|2),gt&&lr(d,y.treeForkCount),d.child}c=c.sibling}y.tail!==null&&Fe()>rf&&(d.flags|=128,R=!0,hu(y,!1),d.lanes=4194304)}else{if(!R)if(c=Uh(I),c!==null){if(d.flags|=128,R=!0,c=c.updateQueue,d.updateQueue=c,Zh(d,c),hu(y,!0),y.tail===null&&y.tailMode==="hidden"&&!I.alternate&&!gt)return qt(d),null}else 2*Fe()-y.renderingStartTime>rf&&p!==536870912&&(d.flags|=128,R=!0,hu(y,!1),d.lanes=4194304);y.isBackwards?(I.sibling=d.child,d.child=I):(c=y.last,c!==null?c.sibling=I:d.child=I,y.last=I)}return y.tail!==null?(c=y.tail,y.rendering=c,y.tail=c.sibling,y.renderingStartTime=Fe(),c.sibling=null,p=rn.current,H(rn,R?p&1|2:p&1),gt&&lr(d,y.treeForkCount),c):(qt(d),null);case 22:case 23:return ki(d),yv(),y=d.memoizedState!==null,c!==null?c.memoizedState!==null!==y&&(d.flags|=8192):y&&(d.flags|=8192),y?(p&536870912)!==0&&(d.flags&128)===0&&(qt(d),d.subtreeFlags&6&&(d.flags|=8192)):qt(d),p=d.updateQueue,p!==null&&Zh(d,p.retryQueue),p=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),y=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(y=d.memoizedState.cachePool.pool),y!==p&&(d.flags|=2048),c!==null&&G(na),null;case 24:return p=null,c!==null&&(p=c.memoizedState.cache),d.memoizedState.cache!==p&&(d.flags|=2048),ur(dn),qt(d),null;case 25:return null;case 30:return null}throw Error(i(156,d.tag))}function aB(c,d){switch(sv(d),d.tag){case 1:return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 3:return ur(dn),ne(),c=d.flags,(c&65536)!==0&&(c&128)===0?(d.flags=c&-65537|128,d):null;case 26:case 27:case 5:return _e(d),null;case 31:if(d.memoizedState!==null){if(ki(d),d.alternate===null)throw Error(i(340));Zo()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 13:if(ki(d),c=d.memoizedState,c!==null&&c.dehydrated!==null){if(d.alternate===null)throw Error(i(340));Zo()}return c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 19:return G(rn),null;case 4:return ne(),null;case 10:return ur(d.type),null;case 22:case 23:return ki(d),yv(),c!==null&&G(na),c=d.flags,c&65536?(d.flags=c&-65537|128,d):null;case 24:return ur(dn),null;case 25:return null;default:return null}}function Nk(c,d){switch(sv(d),d.tag){case 3:ur(dn),ne();break;case 26:case 27:case 5:_e(d);break;case 4:ne();break;case 31:d.memoizedState!==null&&ki(d);break;case 13:ki(d);break;case 19:G(rn);break;case 10:ur(d.type);break;case 22:case 23:ki(d),yv(),c!==null&&G(na);break;case 24:ur(dn)}}function fu(c,d){try{var p=d.updateQueue,y=p!==null?p.lastEffect:null;if(y!==null){var R=y.next;p=R;do{if((p.tag&c)===c){y=void 0;var I=p.create,B=p.inst;y=I(),B.destroy=y}p=p.next}while(p!==R)}}catch(W){At(d,d.return,W)}}function Zr(c,d,p){try{var y=d.updateQueue,R=y!==null?y.lastEffect:null;if(R!==null){var I=R.next;y=I;do{if((y.tag&c)===c){var B=y.inst,W=B.destroy;if(W!==void 0){B.destroy=void 0,R=d;var Z=p,ae=W;try{ae()}catch(fe){At(R,Z,fe)}}}y=y.next}while(y!==I)}}catch(fe){At(d,d.return,fe)}}function jk(c){var d=c.updateQueue;if(d!==null){var p=c.stateNode;try{Ew(d,p)}catch(y){At(c,c.return,y)}}}function Bk(c,d,p){p.props=aa(c.type,c.memoizedProps),p.state=c.memoizedState;try{p.componentWillUnmount()}catch(y){At(c,d,y)}}function pu(c,d){try{var p=c.ref;if(p!==null){switch(c.tag){case 26:case 27:case 5:var y=c.stateNode;break;case 30:y=c.stateNode;break;default:y=c.stateNode}typeof p=="function"?c.refCleanup=p(y):p.current=y}}catch(R){At(c,d,R)}}function Ps(c,d){var p=c.ref,y=c.refCleanup;if(p!==null)if(typeof y=="function")try{y()}catch(R){At(c,d,R)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(R){At(c,d,R)}else p.current=null}function Fk(c){var d=c.type,p=c.memoizedProps,y=c.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":p.autoFocus&&y.focus();break e;case"img":p.src?y.src=p.src:p.srcSet&&(y.srcset=p.srcSet)}}catch(R){At(c,c.return,R)}}function Jv(c,d,p){try{var y=c.stateNode;AB(y,c.type,p,d),y[ri]=d}catch(R){At(c,c.return,R)}}function Uk(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&oo(c.type)||c.tag===4}function Xv(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||Uk(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&oo(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Zv(c,d,p){var y=c.tag;if(y===5||y===6)c=c.stateNode,d?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(c,d):(d=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,d.appendChild(c),p=p._reactRootContainer,p!=null||d.onclick!==null||(d.onclick=rr));else if(y!==4&&(y===27&&oo(c.type)&&(p=c.stateNode,d=null),c=c.child,c!==null))for(Zv(c,d,p),c=c.sibling;c!==null;)Zv(c,d,p),c=c.sibling}function ef(c,d,p){var y=c.tag;if(y===5||y===6)c=c.stateNode,d?p.insertBefore(c,d):p.appendChild(c);else if(y!==4&&(y===27&&oo(c.type)&&(p=c.stateNode),c=c.child,c!==null))for(ef(c,d,p),c=c.sibling;c!==null;)ef(c,d,p),c=c.sibling}function zk(c){var d=c.stateNode,p=c.memoizedProps;try{for(var y=c.type,R=d.attributes;R.length;)d.removeAttributeNode(R[0]);Pn(d,y,p),d[An]=c,d[ri]=p}catch(I){At(c,c.return,I)}}var mr=!1,pn=!1,eb=!1,Hk=typeof WeakSet=="function"?WeakSet:Set,xn=null;function lB(c,d){if(c=c.containerInfo,Sb=Cf,c=ew(c),Gg(c)){if("selectionStart"in c)var p={start:c.selectionStart,end:c.selectionEnd};else e:{p=(p=c.ownerDocument)&&p.defaultView||window;var y=p.getSelection&&p.getSelection();if(y&&y.rangeCount!==0){p=y.anchorNode;var R=y.anchorOffset,I=y.focusNode;y=y.focusOffset;try{p.nodeType,I.nodeType}catch{p=null;break e}var B=0,W=-1,Z=-1,ae=0,fe=0,me=c,le=null;t:for(;;){for(var de;me!==p||R!==0&&me.nodeType!==3||(W=B+R),me!==I||y!==0&&me.nodeType!==3||(Z=B+y),me.nodeType===3&&(B+=me.nodeValue.length),(de=me.firstChild)!==null;)le=me,me=de;for(;;){if(me===c)break t;if(le===p&&++ae===R&&(W=B),le===I&&++fe===y&&(Z=B),(de=me.nextSibling)!==null)break;me=le,le=me.parentNode}me=de}p=W===-1||Z===-1?null:{start:W,end:Z}}else p=null}p=p||{start:0,end:0}}else p=null;for(Cb={focusedElem:c,selectionRange:p},Cf=!1,xn=d;xn!==null;)if(d=xn,c=d.child,(d.subtreeFlags&1028)!==0&&c!==null)c.return=d,xn=c;else for(;xn!==null;){switch(d=xn,I=d.alternate,c=d.flags,d.tag){case 0:if((c&4)!==0&&(c=d.updateQueue,c=c!==null?c.events:null,c!==null))for(p=0;p<c.length;p++)R=c[p],R.ref.impl=R.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&I!==null){c=void 0,p=d,R=I.memoizedProps,I=I.memoizedState,y=p.stateNode;try{var Ie=aa(p.type,R);c=y.getSnapshotBeforeUpdate(Ie,I),y.__reactInternalSnapshotBeforeUpdate=c}catch(Ve){At(p,p.return,Ve)}}break;case 3:if((c&1024)!==0){if(c=d.stateNode.containerInfo,p=c.nodeType,p===9)kb(c);else if(p===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":kb(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(i(163))}if(c=d.sibling,c!==null){c.return=d.return,xn=c;break}xn=d.return}}function $k(c,d,p){var y=p.flags;switch(p.tag){case 0:case 11:case 15:vr(c,p),y&4&&fu(5,p);break;case 1:if(vr(c,p),y&4)if(c=p.stateNode,d===null)try{c.componentDidMount()}catch(B){At(p,p.return,B)}else{var R=aa(p.type,d.memoizedProps);d=d.memoizedState;try{c.componentDidUpdate(R,d,c.__reactInternalSnapshotBeforeUpdate)}catch(B){At(p,p.return,B)}}y&64&&jk(p),y&512&&pu(p,p.return);break;case 3:if(vr(c,p),y&64&&(c=p.updateQueue,c!==null)){if(d=null,p.child!==null)switch(p.child.tag){case 27:case 5:d=p.child.stateNode;break;case 1:d=p.child.stateNode}try{Ew(c,d)}catch(B){At(p,p.return,B)}}break;case 27:d===null&&y&4&&zk(p);case 26:case 5:vr(c,p),d===null&&y&4&&Fk(p),y&512&&pu(p,p.return);break;case 12:vr(c,p);break;case 31:vr(c,p),y&4&&Wk(c,p);break;case 13:vr(c,p),y&4&&Gk(c,p),y&64&&(c=p.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(p=vB.bind(null,p),jB(c,p))));break;case 22:if(y=p.memoizedState!==null||mr,!y){d=d!==null&&d.memoizedState!==null||pn,R=mr;var I=pn;mr=y,(pn=d)&&!I?br(c,p,(p.subtreeFlags&8772)!==0):vr(c,p),mr=R,pn=I}break;case 30:break;default:vr(c,p)}}function qk(c){var d=c.alternate;d!==null&&(c.alternate=null,qk(d)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(d=c.stateNode,d!==null&&Mg(d)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var Wt=null,ai=!1;function gr(c,d,p){for(p=p.child;p!==null;)Vk(c,d,p),p=p.sibling}function Vk(c,d,p){if(zt&&typeof zt.onCommitFiberUnmount=="function")try{zt.onCommitFiberUnmount(Yt,p)}catch{}switch(p.tag){case 26:pn||Ps(p,d),gr(c,d,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:pn||Ps(p,d);var y=Wt,R=ai;oo(p.type)&&(Wt=p.stateNode,ai=!1),gr(c,d,p),xu(p.stateNode),Wt=y,ai=R;break;case 5:pn||Ps(p,d);case 6:if(y=Wt,R=ai,Wt=null,gr(c,d,p),Wt=y,ai=R,Wt!==null)if(ai)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(p.stateNode)}catch(I){At(p,d,I)}else try{Wt.removeChild(p.stateNode)}catch(I){At(p,d,I)}break;case 18:Wt!==null&&(ai?(c=Wt,j1(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,p.stateNode),Hl(c)):j1(Wt,p.stateNode));break;case 4:y=Wt,R=ai,Wt=p.stateNode.containerInfo,ai=!0,gr(c,d,p),Wt=y,ai=R;break;case 0:case 11:case 14:case 15:Zr(2,p,d),pn||Zr(4,p,d),gr(c,d,p);break;case 1:pn||(Ps(p,d),y=p.stateNode,typeof y.componentWillUnmount=="function"&&Bk(p,d,y)),gr(c,d,p);break;case 21:gr(c,d,p);break;case 22:pn=(y=pn)||p.memoizedState!==null,gr(c,d,p),pn=y;break;default:gr(c,d,p)}}function Wk(c,d){if(d.memoizedState===null&&(c=d.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{Hl(c)}catch(p){At(d,d.return,p)}}}function Gk(c,d){if(d.memoizedState===null&&(c=d.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{Hl(c)}catch(p){At(d,d.return,p)}}function cB(c){switch(c.tag){case 31:case 13:case 19:var d=c.stateNode;return d===null&&(d=c.stateNode=new Hk),d;case 22:return c=c.stateNode,d=c._retryCache,d===null&&(d=c._retryCache=new Hk),d;default:throw Error(i(435,c.tag))}}function tf(c,d){var p=cB(c);d.forEach(function(y){if(!p.has(y)){p.add(y);var R=bB.bind(null,c,y);y.then(R,R)}})}function li(c,d){var p=d.deletions;if(p!==null)for(var y=0;y<p.length;y++){var R=p[y],I=c,B=d,W=B;e:for(;W!==null;){switch(W.tag){case 27:if(oo(W.type)){Wt=W.stateNode,ai=!1;break e}break;case 5:Wt=W.stateNode,ai=!1;break e;case 3:case 4:Wt=W.stateNode.containerInfo,ai=!0;break e}W=W.return}if(Wt===null)throw Error(i(160));Vk(I,B,R),Wt=null,ai=!1,I=R.alternate,I!==null&&(I.return=null),R.return=null}if(d.subtreeFlags&13886)for(d=d.child;d!==null;)Kk(d,c),d=d.sibling}var ls=null;function Kk(c,d){var p=c.alternate,y=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:li(d,c),ci(c),y&4&&(Zr(3,c,c.return),fu(3,c),Zr(5,c,c.return));break;case 1:li(d,c),ci(c),y&512&&(pn||p===null||Ps(p,p.return)),y&64&&mr&&(c=c.updateQueue,c!==null&&(y=c.callbacks,y!==null&&(p=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=p===null?y:p.concat(y))));break;case 26:var R=ls;if(li(d,c),ci(c),y&512&&(pn||p===null||Ps(p,p.return)),y&4){var I=p!==null?p.memoizedState:null;if(y=c.memoizedState,p===null)if(y===null)if(c.stateNode===null){e:{y=c.type,p=c.memoizedProps,R=R.ownerDocument||R;t:switch(y){case"title":I=R.getElementsByTagName("title")[0],(!I||I[zc]||I[An]||I.namespaceURI==="http://www.w3.org/2000/svg"||I.hasAttribute("itemprop"))&&(I=R.createElement(y),R.head.insertBefore(I,R.querySelector("head > title"))),Pn(I,y,p),I[An]=c,Cn(I),y=I;break e;case"link":var B=K1("link","href",R).get(y+(p.href||""));if(B){for(var W=0;W<B.length;W++)if(I=B[W],I.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&I.getAttribute("rel")===(p.rel==null?null:p.rel)&&I.getAttribute("title")===(p.title==null?null:p.title)&&I.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){B.splice(W,1);break t}}I=R.createElement(y),Pn(I,y,p),R.head.appendChild(I);break;case"meta":if(B=K1("meta","content",R).get(y+(p.content||""))){for(W=0;W<B.length;W++)if(I=B[W],I.getAttribute("content")===(p.content==null?null:""+p.content)&&I.getAttribute("name")===(p.name==null?null:p.name)&&I.getAttribute("property")===(p.property==null?null:p.property)&&I.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&I.getAttribute("charset")===(p.charSet==null?null:p.charSet)){B.splice(W,1);break t}}I=R.createElement(y),Pn(I,y,p),R.head.appendChild(I);break;default:throw Error(i(468,y))}I[An]=c,Cn(I),y=I}c.stateNode=y}else Y1(R,c.type,c.stateNode);else c.stateNode=G1(R,y,c.memoizedProps);else I!==y?(I===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):I.count--,y===null?Y1(R,c.type,c.stateNode):G1(R,y,c.memoizedProps)):y===null&&c.stateNode!==null&&Jv(c,c.memoizedProps,p.memoizedProps)}break;case 27:li(d,c),ci(c),y&512&&(pn||p===null||Ps(p,p.return)),p!==null&&y&4&&Jv(c,c.memoizedProps,p.memoizedProps);break;case 5:if(li(d,c),ci(c),y&512&&(pn||p===null||Ps(p,p.return)),c.flags&32){R=c.stateNode;try{dl(R,"")}catch(Ie){At(c,c.return,Ie)}}y&4&&c.stateNode!=null&&(R=c.memoizedProps,Jv(c,R,p!==null?p.memoizedProps:R)),y&1024&&(eb=!0);break;case 6:if(li(d,c),ci(c),y&4){if(c.stateNode===null)throw Error(i(162));y=c.memoizedProps,p=c.stateNode;try{p.nodeValue=y}catch(Ie){At(c,c.return,Ie)}}break;case 3:if(bf=null,R=ls,ls=gf(d.containerInfo),li(d,c),ls=R,ci(c),y&4&&p!==null&&p.memoizedState.isDehydrated)try{Hl(d.containerInfo)}catch(Ie){At(c,c.return,Ie)}eb&&(eb=!1,Yk(c));break;case 4:y=ls,ls=gf(c.stateNode.containerInfo),li(d,c),ci(c),ls=y;break;case 12:li(d,c),ci(c);break;case 31:li(d,c),ci(c),y&4&&(y=c.updateQueue,y!==null&&(c.updateQueue=null,tf(c,y)));break;case 13:li(d,c),ci(c),c.child.flags&8192&&c.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(sf=Fe()),y&4&&(y=c.updateQueue,y!==null&&(c.updateQueue=null,tf(c,y)));break;case 22:R=c.memoizedState!==null;var Z=p!==null&&p.memoizedState!==null,ae=mr,fe=pn;if(mr=ae||R,pn=fe||Z,li(d,c),pn=fe,mr=ae,ci(c),y&8192)e:for(d=c.stateNode,d._visibility=R?d._visibility&-2:d._visibility|1,R&&(p===null||Z||mr||pn||la(c)),p=null,d=c;;){if(d.tag===5||d.tag===26){if(p===null){Z=p=d;try{if(I=Z.stateNode,R)B=I.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none";else{W=Z.stateNode;var me=Z.memoizedProps.style,le=me!=null&&me.hasOwnProperty("display")?me.display:null;W.style.display=le==null||typeof le=="boolean"?"":(""+le).trim()}}catch(Ie){At(Z,Z.return,Ie)}}}else if(d.tag===6){if(p===null){Z=d;try{Z.stateNode.nodeValue=R?"":Z.memoizedProps}catch(Ie){At(Z,Z.return,Ie)}}}else if(d.tag===18){if(p===null){Z=d;try{var de=Z.stateNode;R?B1(de,!0):B1(Z.stateNode,!1)}catch(Ie){At(Z,Z.return,Ie)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===c)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break e;for(;d.sibling===null;){if(d.return===null||d.return===c)break e;p===d&&(p=null),d=d.return}p===d&&(p=null),d.sibling.return=d.return,d=d.sibling}y&4&&(y=c.updateQueue,y!==null&&(p=y.retryQueue,p!==null&&(y.retryQueue=null,tf(c,p))));break;case 19:li(d,c),ci(c),y&4&&(y=c.updateQueue,y!==null&&(c.updateQueue=null,tf(c,y)));break;case 30:break;case 21:break;default:li(d,c),ci(c)}}function ci(c){var d=c.flags;if(d&2){try{for(var p,y=c.return;y!==null;){if(Uk(y)){p=y;break}y=y.return}if(p==null)throw Error(i(160));switch(p.tag){case 27:var R=p.stateNode,I=Xv(c);ef(c,I,R);break;case 5:var B=p.stateNode;p.flags&32&&(dl(B,""),p.flags&=-33);var W=Xv(c);ef(c,W,B);break;case 3:case 4:var Z=p.stateNode.containerInfo,ae=Xv(c);Zv(c,ae,Z);break;default:throw Error(i(161))}}catch(fe){At(c,c.return,fe)}c.flags&=-3}d&4096&&(c.flags&=-4097)}function Yk(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var d=c;Yk(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),c=c.sibling}}function vr(c,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)$k(c,d.alternate,d),d=d.sibling}function la(c){for(c=c.child;c!==null;){var d=c;switch(d.tag){case 0:case 11:case 14:case 15:Zr(4,d,d.return),la(d);break;case 1:Ps(d,d.return);var p=d.stateNode;typeof p.componentWillUnmount=="function"&&Bk(d,d.return,p),la(d);break;case 27:xu(d.stateNode);case 26:case 5:Ps(d,d.return),la(d);break;case 22:d.memoizedState===null&&la(d);break;case 30:la(d);break;default:la(d)}c=c.sibling}}function br(c,d,p){for(p=p&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var y=d.alternate,R=c,I=d,B=I.flags;switch(I.tag){case 0:case 11:case 15:br(R,I,p),fu(4,I);break;case 1:if(br(R,I,p),y=I,R=y.stateNode,typeof R.componentDidMount=="function")try{R.componentDidMount()}catch(ae){At(y,y.return,ae)}if(y=I,R=y.updateQueue,R!==null){var W=y.stateNode;try{var Z=R.shared.hiddenCallbacks;if(Z!==null)for(R.shared.hiddenCallbacks=null,R=0;R<Z.length;R++)Tw(Z[R],W)}catch(ae){At(y,y.return,ae)}}p&&B&64&&jk(I),pu(I,I.return);break;case 27:zk(I);case 26:case 5:br(R,I,p),p&&y===null&&B&4&&Fk(I),pu(I,I.return);break;case 12:br(R,I,p);break;case 31:br(R,I,p),p&&B&4&&Wk(R,I);break;case 13:br(R,I,p),p&&B&4&&Gk(R,I);break;case 22:I.memoizedState===null&&br(R,I,p),pu(I,I.return);break;case 30:break;default:br(R,I,p)}d=d.sibling}}function tb(c,d){var p=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),c=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(c=d.memoizedState.cachePool.pool),c!==p&&(c!=null&&c.refCount++,p!=null&&eu(p))}function nb(c,d){c=null,d.alternate!==null&&(c=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==c&&(d.refCount++,c!=null&&eu(c))}function cs(c,d,p,y){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)Qk(c,d,p,y),d=d.sibling}function Qk(c,d,p,y){var R=d.flags;switch(d.tag){case 0:case 11:case 15:cs(c,d,p,y),R&2048&&fu(9,d);break;case 1:cs(c,d,p,y);break;case 3:cs(c,d,p,y),R&2048&&(c=null,d.alternate!==null&&(c=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==c&&(d.refCount++,c!=null&&eu(c)));break;case 12:if(R&2048){cs(c,d,p,y),c=d.stateNode;try{var I=d.memoizedProps,B=I.id,W=I.onPostCommit;typeof W=="function"&&W(B,d.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(Z){At(d,d.return,Z)}}else cs(c,d,p,y);break;case 31:cs(c,d,p,y);break;case 13:cs(c,d,p,y);break;case 23:break;case 22:I=d.stateNode,B=d.alternate,d.memoizedState!==null?I._visibility&2?cs(c,d,p,y):mu(c,d):I._visibility&2?cs(c,d,p,y):(I._visibility|=2,Ll(c,d,p,y,(d.subtreeFlags&10256)!==0||!1)),R&2048&&tb(B,d);break;case 24:cs(c,d,p,y),R&2048&&nb(d.alternate,d);break;default:cs(c,d,p,y)}}function Ll(c,d,p,y,R){for(R=R&&((d.subtreeFlags&10256)!==0||!1),d=d.child;d!==null;){var I=c,B=d,W=p,Z=y,ae=B.flags;switch(B.tag){case 0:case 11:case 15:Ll(I,B,W,Z,R),fu(8,B);break;case 23:break;case 22:var fe=B.stateNode;B.memoizedState!==null?fe._visibility&2?Ll(I,B,W,Z,R):mu(I,B):(fe._visibility|=2,Ll(I,B,W,Z,R)),R&&ae&2048&&tb(B.alternate,B);break;case 24:Ll(I,B,W,Z,R),R&&ae&2048&&nb(B.alternate,B);break;default:Ll(I,B,W,Z,R)}d=d.sibling}}function mu(c,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var p=c,y=d,R=y.flags;switch(y.tag){case 22:mu(p,y),R&2048&&tb(y.alternate,y);break;case 24:mu(p,y),R&2048&&nb(y.alternate,y);break;default:mu(p,y)}d=d.sibling}}var gu=8192;function Il(c,d,p){if(c.subtreeFlags&gu)for(c=c.child;c!==null;)Jk(c,d,p),c=c.sibling}function Jk(c,d,p){switch(c.tag){case 26:Il(c,d,p),c.flags&gu&&c.memoizedState!==null&&YB(p,ls,c.memoizedState,c.memoizedProps);break;case 5:Il(c,d,p);break;case 3:case 4:var y=ls;ls=gf(c.stateNode.containerInfo),Il(c,d,p),ls=y;break;case 22:c.memoizedState===null&&(y=c.alternate,y!==null&&y.memoizedState!==null?(y=gu,gu=16777216,Il(c,d,p),gu=y):Il(c,d,p));break;default:Il(c,d,p)}}function Xk(c){var d=c.alternate;if(d!==null&&(c=d.child,c!==null)){d.child=null;do d=c.sibling,c.sibling=null,c=d;while(c!==null)}}function vu(c){var d=c.deletions;if((c.flags&16)!==0){if(d!==null)for(var p=0;p<d.length;p++){var y=d[p];xn=y,e1(y,c)}Xk(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)Zk(c),c=c.sibling}function Zk(c){switch(c.tag){case 0:case 11:case 15:vu(c),c.flags&2048&&Zr(9,c,c.return);break;case 3:vu(c);break;case 12:vu(c);break;case 22:var d=c.stateNode;c.memoizedState!==null&&d._visibility&2&&(c.return===null||c.return.tag!==13)?(d._visibility&=-3,nf(c)):vu(c);break;default:vu(c)}}function nf(c){var d=c.deletions;if((c.flags&16)!==0){if(d!==null)for(var p=0;p<d.length;p++){var y=d[p];xn=y,e1(y,c)}Xk(c)}for(c=c.child;c!==null;){switch(d=c,d.tag){case 0:case 11:case 15:Zr(8,d,d.return),nf(d);break;case 22:p=d.stateNode,p._visibility&2&&(p._visibility&=-3,nf(d));break;default:nf(d)}c=c.sibling}}function e1(c,d){for(;xn!==null;){var p=xn;switch(p.tag){case 0:case 11:case 15:Zr(8,p,d);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var y=p.memoizedState.cachePool.pool;y!=null&&y.refCount++}break;case 24:eu(p.memoizedState.cache)}if(y=p.child,y!==null)y.return=p,xn=y;else e:for(p=c;xn!==null;){y=xn;var R=y.sibling,I=y.return;if(qk(y),y===p){xn=null;break e}if(R!==null){R.return=I,xn=R;break e}xn=I}}}var uB={getCacheForType:function(c){var d=Ln(dn),p=d.data.get(c);return p===void 0&&(p=c(),d.data.set(c,p)),p},cacheSignal:function(){return Ln(dn).controller.signal}},dB=typeof WeakMap=="function"?WeakMap:Map,kt=0,jt=null,lt=null,pt=0,Rt=0,Ti=null,eo=!1,Pl=!1,ib=!1,yr=0,en=0,to=0,ca=0,sb=0,Ei=0,Dl=0,bu=null,ui=null,rb=!1,sf=0,t1=0,rf=1/0,of=null,no=null,vn=0,io=null,Ol=null,_r=0,ob=0,ab=null,n1=null,yu=0,lb=null;function Ri(){return(kt&2)!==0&&pt!==0?pt&-pt:$.T!==null?pb():bx()}function i1(){if(Ei===0)if((pt&536870912)===0||gt){var c=yi;yi<<=1,(yi&3932160)===0&&(yi=262144),Ei=c}else Ei=536870912;return c=wi.current,c!==null&&(c.flags|=32),Ei}function di(c,d,p){(c===jt&&(Rt===2||Rt===9)||c.cancelPendingCommit!==null)&&(Nl(c,0),so(c,pt,Ei,!1)),Ze(c,p),((kt&2)===0||c!==jt)&&(c===jt&&((kt&2)===0&&(ca|=p),en===4&&so(c,pt,Ei,!1)),Ds(c))}function s1(c,d,p){if((kt&6)!==0)throw Error(i(327));var y=!p&&(d&127)===0&&(d&c.expiredLanes)===0||Vo(c,d),R=y?pB(c,d):ub(c,d,!0),I=y;do{if(R===0){Pl&&!y&&so(c,d,0,!1);break}else{if(p=c.current.alternate,I&&!hB(p)){R=ub(c,d,!1),I=!1;continue}if(R===2){if(I=d,c.errorRecoveryDisabledLanes&I)var B=0;else B=c.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){d=B;e:{var W=c;R=bu;var Z=W.current.memoizedState.isDehydrated;if(Z&&(Nl(W,B).flags|=256),B=ub(W,B,!1),B!==2){if(ib&&!Z){W.errorRecoveryDisabledLanes|=I,ca|=I,R=4;break e}I=ui,ui=R,I!==null&&(ui===null?ui=I:ui.push.apply(ui,I))}R=B}if(I=!1,R!==2)continue}}if(R===1){Nl(c,0),so(c,d,0,!0);break}e:{switch(y=c,I=R,I){case 0:case 1:throw Error(i(345));case 4:if((d&4194048)!==d)break;case 6:so(y,d,Ei,!eo);break e;case 2:ui=null;break;case 3:case 5:break;default:throw Error(i(329))}if((d&62914560)===d&&(R=sf+300-Fe(),10<R)){if(so(y,d,Ei,!eo),sl(y,0,!0)!==0)break e;_r=d,y.timeoutHandle=O1(r1.bind(null,y,p,ui,of,rb,d,Ei,ca,Dl,eo,I,"Throttled",-0,0),R);break e}r1(y,p,ui,of,rb,d,Ei,ca,Dl,eo,I,null,-0,0)}}break}while(!0);Ds(c)}function r1(c,d,p,y,R,I,B,W,Z,ae,fe,me,le,de){if(c.timeoutHandle=-1,me=d.subtreeFlags,me&8192||(me&16785408)===16785408){me={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:rr},Jk(d,I,me);var Ie=(I&62914560)===I?sf-Fe():(I&4194048)===I?t1-Fe():0;if(Ie=QB(me,Ie),Ie!==null){_r=I,c.cancelPendingCommit=Ie(f1.bind(null,c,d,I,p,y,R,B,W,Z,fe,me,null,le,de)),so(c,I,B,!ae);return}}f1(c,d,I,p,y,R,B,W,Z)}function hB(c){for(var d=c;;){var p=d.tag;if((p===0||p===11||p===15)&&d.flags&16384&&(p=d.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var y=0;y<p.length;y++){var R=p[y],I=R.getSnapshot;R=R.value;try{if(!Ci(I(),R))return!1}catch{return!1}}if(p=d.child,d.subtreeFlags&16384&&p!==null)p.return=d,d=p;else{if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function so(c,d,p,y){d&=~sb,d&=~ca,c.suspendedLanes|=d,c.pingedLanes&=~d,y&&(c.warmLanes|=d),y=c.expirationTimes;for(var R=d;0<R;){var I=31-St(R),B=1<<I;y[I]=-1,R&=~B}p!==0&&Kn(c,p,d)}function af(){return(kt&6)===0?(_u(0),!1):!0}function cb(){if(lt!==null){if(Rt===0)var c=lt.return;else c=lt,cr=ea=null,kv(c),Tl=null,nu=0,c=lt;for(;c!==null;)Nk(c.alternate,c),c=c.return;lt=null}}function Nl(c,d){var p=c.timeoutHandle;p!==-1&&(c.timeoutHandle=-1,IB(p)),p=c.cancelPendingCommit,p!==null&&(c.cancelPendingCommit=null,p()),_r=0,cb(),jt=c,lt=p=ar(c.current,null),pt=d,Rt=0,Ti=null,eo=!1,Pl=Vo(c,d),ib=!1,Dl=Ei=sb=ca=to=en=0,ui=bu=null,rb=!1,(d&8)!==0&&(d|=d&32);var y=c.entangledLanes;if(y!==0)for(c=c.entanglements,y&=d;0<y;){var R=31-St(y),I=1<<R;d|=c[R],y&=~I}return yr=d,Eh(),p}function o1(c,d){et=null,$.H=uu,d===kl||d===Oh?(d=Cw(),Rt=3):d===fv?(d=Cw(),Rt=4):Rt=d===zv?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,Ti=d,lt===null&&(en=1,Yh(c,Fi(d,c.current)))}function a1(){var c=wi.current;return c===null?!0:(pt&4194048)===pt?$i===null:(pt&62914560)===pt||(pt&536870912)!==0?c===$i:!1}function l1(){var c=$.H;return $.H=uu,c===null?uu:c}function c1(){var c=$.A;return $.A=uB,c}function lf(){en=4,eo||(pt&4194048)!==pt&&wi.current!==null||(Pl=!0),(to&134217727)===0&&(ca&134217727)===0||jt===null||so(jt,pt,Ei,!1)}function ub(c,d,p){var y=kt;kt|=2;var R=l1(),I=c1();(jt!==c||pt!==d)&&(of=null,Nl(c,d)),d=!1;var B=en;e:do try{if(Rt!==0&&lt!==null){var W=lt,Z=Ti;switch(Rt){case 8:cb(),B=6;break e;case 3:case 2:case 9:case 6:wi.current===null&&(d=!0);var ae=Rt;if(Rt=0,Ti=null,jl(c,W,Z,ae),p&&Pl){B=0;break e}break;default:ae=Rt,Rt=0,Ti=null,jl(c,W,Z,ae)}}fB(),B=en;break}catch(fe){o1(c,fe)}while(!0);return d&&c.shellSuspendCounter++,cr=ea=null,kt=y,$.H=R,$.A=I,lt===null&&(jt=null,pt=0,Eh()),B}function fB(){for(;lt!==null;)u1(lt)}function pB(c,d){var p=kt;kt|=2;var y=l1(),R=c1();jt!==c||pt!==d?(of=null,rf=Fe()+500,Nl(c,d)):Pl=Vo(c,d);e:do try{if(Rt!==0&&lt!==null){d=lt;var I=Ti;t:switch(Rt){case 1:Rt=0,Ti=null,jl(c,d,I,1);break;case 2:case 9:if(_w(I)){Rt=0,Ti=null,d1(d);break}d=function(){Rt!==2&&Rt!==9||jt!==c||(Rt=7),Ds(c)},I.then(d,d);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:_w(I)?(Rt=0,Ti=null,d1(d)):(Rt=0,Ti=null,jl(c,d,I,7));break;case 5:var B=null;switch(lt.tag){case 26:B=lt.memoizedState;case 5:case 27:var W=lt;if(B?Q1(B):W.stateNode.complete){Rt=0,Ti=null;var Z=W.sibling;if(Z!==null)lt=Z;else{var ae=W.return;ae!==null?(lt=ae,cf(ae)):lt=null}break t}}Rt=0,Ti=null,jl(c,d,I,5);break;case 6:Rt=0,Ti=null,jl(c,d,I,6);break;case 8:cb(),en=6;break e;default:throw Error(i(462))}}mB();break}catch(fe){o1(c,fe)}while(!0);return cr=ea=null,$.H=y,$.A=R,kt=p,lt!==null?0:(jt=null,pt=0,Eh(),en)}function mB(){for(;lt!==null&&!Ke();)u1(lt)}function u1(c){var d=Dk(c.alternate,c,yr);c.memoizedProps=c.pendingProps,d===null?cf(c):lt=d}function d1(c){var d=c,p=d.alternate;switch(d.tag){case 15:case 0:d=Rk(p,d,d.pendingProps,d.type,void 0,pt);break;case 11:d=Rk(p,d,d.pendingProps,d.type.render,d.ref,pt);break;case 5:kv(d);default:Nk(p,d),d=lt=cw(d,yr),d=Dk(p,d,yr)}c.memoizedProps=c.pendingProps,d===null?cf(c):lt=d}function jl(c,d,p,y){cr=ea=null,kv(d),Tl=null,nu=0;var R=d.return;try{if(iB(c,R,d,p,pt)){en=1,Yh(c,Fi(p,c.current)),lt=null;return}}catch(I){if(R!==null)throw lt=R,I;en=1,Yh(c,Fi(p,c.current)),lt=null;return}d.flags&32768?(gt||y===1?c=!0:Pl||(pt&536870912)!==0?c=!1:(eo=c=!0,(y===2||y===9||y===3||y===6)&&(y=wi.current,y!==null&&y.tag===13&&(y.flags|=16384))),h1(d,c)):cf(d)}function cf(c){var d=c;do{if((d.flags&32768)!==0){h1(d,eo);return}c=d.return;var p=oB(d.alternate,d,yr);if(p!==null){lt=p;return}if(d=d.sibling,d!==null){lt=d;return}lt=d=c}while(d!==null);en===0&&(en=5)}function h1(c,d){do{var p=aB(c.alternate,c);if(p!==null){p.flags&=32767,lt=p;return}if(p=c.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!d&&(c=c.sibling,c!==null)){lt=c;return}lt=c=p}while(c!==null);en=6,lt=null}function f1(c,d,p,y,R,I,B,W,Z){c.cancelPendingCommit=null;do uf();while(vn!==0);if((kt&6)!==0)throw Error(i(327));if(d!==null){if(d===c.current)throw Error(i(177));if(I=d.lanes|d.childLanes,I|=Xg,Si(c,p,I,B,W,Z),c===jt&&(lt=jt=null,pt=0),Ol=d,io=c,_r=p,ob=I,ab=R,n1=y,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,yB(Me,function(){return b1(),null})):(c.callbackNode=null,c.callbackPriority=0),y=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||y){y=$.T,$.T=null,R=Y.p,Y.p=2,B=kt,kt|=4;try{lB(c,d,p)}finally{kt=B,Y.p=R,$.T=y}}vn=1,p1(),m1(),g1()}}function p1(){if(vn===1){vn=0;var c=io,d=Ol,p=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||p){p=$.T,$.T=null;var y=Y.p;Y.p=2;var R=kt;kt|=4;try{Kk(d,c);var I=Cb,B=ew(c.containerInfo),W=I.focusedElem,Z=I.selectionRange;if(B!==W&&W&&W.ownerDocument&&Zx(W.ownerDocument.documentElement,W)){if(Z!==null&&Gg(W)){var ae=Z.start,fe=Z.end;if(fe===void 0&&(fe=ae),"selectionStart"in W)W.selectionStart=ae,W.selectionEnd=Math.min(fe,W.value.length);else{var me=W.ownerDocument||document,le=me&&me.defaultView||window;if(le.getSelection){var de=le.getSelection(),Ie=W.textContent.length,Ve=Math.min(Z.start,Ie),Pt=Z.end===void 0?Ve:Math.min(Z.end,Ie);!de.extend&&Ve>Pt&&(B=Pt,Pt=Ve,Ve=B);var ie=Xx(W,Ve),te=Xx(W,Pt);if(ie&&te&&(de.rangeCount!==1||de.anchorNode!==ie.node||de.anchorOffset!==ie.offset||de.focusNode!==te.node||de.focusOffset!==te.offset)){var oe=me.createRange();oe.setStart(ie.node,ie.offset),de.removeAllRanges(),Ve>Pt?(de.addRange(oe),de.extend(te.node,te.offset)):(oe.setEnd(te.node,te.offset),de.addRange(oe))}}}}for(me=[],de=W;de=de.parentNode;)de.nodeType===1&&me.push({element:de,left:de.scrollLeft,top:de.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<me.length;W++){var pe=me[W];pe.element.scrollLeft=pe.left,pe.element.scrollTop=pe.top}}Cf=!!Sb,Cb=Sb=null}finally{kt=R,Y.p=y,$.T=p}}c.current=d,vn=2}}function m1(){if(vn===2){vn=0;var c=io,d=Ol,p=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||p){p=$.T,$.T=null;var y=Y.p;Y.p=2;var R=kt;kt|=4;try{$k(c,d.alternate,d)}finally{kt=R,Y.p=y,$.T=p}}vn=3}}function g1(){if(vn===4||vn===3){vn=0,Te();var c=io,d=Ol,p=_r,y=n1;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?vn=5:(vn=0,Ol=io=null,v1(c,c.pendingLanes));var R=c.pendingLanes;if(R===0&&(no=null),Rg(p),d=d.stateNode,zt&&typeof zt.onCommitFiberRoot=="function")try{zt.onCommitFiberRoot(Yt,d,void 0,(d.current.flags&128)===128)}catch{}if(y!==null){d=$.T,R=Y.p,Y.p=2,$.T=null;try{for(var I=c.onRecoverableError,B=0;B<y.length;B++){var W=y[B];I(W.value,{componentStack:W.stack})}}finally{$.T=d,Y.p=R}}(_r&3)!==0&&uf(),Ds(c),R=c.pendingLanes,(p&261930)!==0&&(R&42)!==0?c===lb?yu++:(yu=0,lb=c):yu=0,_u(0)}}function v1(c,d){(c.pooledCacheLanes&=d)===0&&(d=c.pooledCache,d!=null&&(c.pooledCache=null,eu(d)))}function uf(){return p1(),m1(),g1(),b1()}function b1(){if(vn!==5)return!1;var c=io,d=ob;ob=0;var p=Rg(_r),y=$.T,R=Y.p;try{Y.p=32>p?32:p,$.T=null,p=ab,ab=null;var I=io,B=_r;if(vn=0,Ol=io=null,_r=0,(kt&6)!==0)throw Error(i(331));var W=kt;if(kt|=4,Zk(I.current),Qk(I,I.current,B,p),kt=W,_u(0,!1),zt&&typeof zt.onPostCommitFiberRoot=="function")try{zt.onPostCommitFiberRoot(Yt,I)}catch{}return!0}finally{Y.p=R,$.T=y,v1(c,d)}}function y1(c,d,p){d=Fi(p,d),d=Uv(c.stateNode,d,2),c=Qr(c,d,2),c!==null&&(Ze(c,2),Ds(c))}function At(c,d,p){if(c.tag===3)y1(c,c,p);else for(;d!==null;){if(d.tag===3){y1(d,c,p);break}else if(d.tag===1){var y=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(no===null||!no.has(y))){c=Fi(p,c),p=_k(2),y=Qr(d,p,2),y!==null&&(Sk(p,y,d,c),Ze(y,2),Ds(y));break}}d=d.return}}function db(c,d,p){var y=c.pingCache;if(y===null){y=c.pingCache=new dB;var R=new Set;y.set(d,R)}else R=y.get(d),R===void 0&&(R=new Set,y.set(d,R));R.has(p)||(ib=!0,R.add(p),c=gB.bind(null,c,d,p),d.then(c,c))}function gB(c,d,p){var y=c.pingCache;y!==null&&y.delete(d),c.pingedLanes|=c.suspendedLanes&p,c.warmLanes&=~p,jt===c&&(pt&p)===p&&(en===4||en===3&&(pt&62914560)===pt&&300>Fe()-sf?(kt&2)===0&&Nl(c,0):sb|=p,Dl===pt&&(Dl=0)),Ds(c)}function _1(c,d){d===0&&(d=mh()),c=Jo(c,d),c!==null&&(Ze(c,d),Ds(c))}function vB(c){var d=c.memoizedState,p=0;d!==null&&(p=d.retryLane),_1(c,p)}function bB(c,d){var p=0;switch(c.tag){case 31:case 13:var y=c.stateNode,R=c.memoizedState;R!==null&&(p=R.retryLane);break;case 19:y=c.stateNode;break;case 22:y=c.stateNode._retryCache;break;default:throw Error(i(314))}y!==null&&y.delete(d),_1(c,p)}function yB(c,d){return Qe(c,d)}var df=null,Bl=null,hb=!1,hf=!1,fb=!1,ro=0;function Ds(c){c!==Bl&&c.next===null&&(Bl===null?df=Bl=c:Bl=Bl.next=c),hf=!0,hb||(hb=!0,SB())}function _u(c,d){if(!fb&&hf){fb=!0;do for(var p=!1,y=df;y!==null;){if(c!==0){var R=y.pendingLanes;if(R===0)var I=0;else{var B=y.suspendedLanes,W=y.pingedLanes;I=(1<<31-St(42|c)+1)-1,I&=R&~(B&~W),I=I&201326741?I&201326741|1:I?I|2:0}I!==0&&(p=!0,w1(y,I))}else I=pt,I=sl(y,y===jt?I:0,y.cancelPendingCommit!==null||y.timeoutHandle!==-1),(I&3)===0||Vo(y,I)||(p=!0,w1(y,I));y=y.next}while(p);fb=!1}}function _B(){S1()}function S1(){hf=hb=!1;var c=0;ro!==0&&LB()&&(c=ro);for(var d=Fe(),p=null,y=df;y!==null;){var R=y.next,I=C1(y,d);I===0?(y.next=null,p===null?df=R:p.next=R,R===null&&(Bl=p)):(p=y,(c!==0||(I&3)!==0)&&(hf=!0)),y=R}vn!==0&&vn!==5||_u(c),ro!==0&&(ro=0)}function C1(c,d){for(var p=c.suspendedLanes,y=c.pingedLanes,R=c.expirationTimes,I=c.pendingLanes&-62914561;0<I;){var B=31-St(I),W=1<<B,Z=R[B];Z===-1?((W&p)===0||(W&y)!==0)&&(R[B]=Tg(W,d)):Z<=d&&(c.expiredLanes|=W),I&=~W}if(d=jt,p=pt,p=sl(c,c===d?p:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),y=c.callbackNode,p===0||c===d&&(Rt===2||Rt===9)||c.cancelPendingCommit!==null)return y!==null&&y!==null&&Ge(y),c.callbackNode=null,c.callbackPriority=0;if((p&3)===0||Vo(c,p)){if(d=p&-p,d===c.callbackPriority)return d;switch(y!==null&&Ge(y),Rg(p)){case 2:case 8:p=ge;break;case 32:p=Me;break;case 268435456:p=ze;break;default:p=Me}return y=x1.bind(null,c),p=Qe(p,y),c.callbackPriority=d,c.callbackNode=p,d}return y!==null&&y!==null&&Ge(y),c.callbackPriority=2,c.callbackNode=null,2}function x1(c,d){if(vn!==0&&vn!==5)return c.callbackNode=null,c.callbackPriority=0,null;var p=c.callbackNode;if(uf()&&c.callbackNode!==p)return null;var y=pt;return y=sl(c,c===jt?y:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),y===0?null:(s1(c,y,d),C1(c,Fe()),c.callbackNode!=null&&c.callbackNode===p?x1.bind(null,c):null)}function w1(c,d){if(uf())return null;s1(c,d,!0)}function SB(){PB(function(){(kt&6)!==0?Qe(se,_B):S1()})}function pb(){if(ro===0){var c=xl;c===0&&(c=ss,ss<<=1,(ss&261888)===0&&(ss=256)),ro=c}return ro}function k1(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:yh(""+c)}function T1(c,d){var p=d.ownerDocument.createElement("input");return p.name=d.name,p.value=d.value,c.id&&p.setAttribute("form",c.id),d.parentNode.insertBefore(p,d),c=new FormData(c),p.parentNode.removeChild(p),c}function CB(c,d,p,y,R){if(d==="submit"&&p&&p.stateNode===R){var I=k1((R[ri]||null).action),B=y.submitter;B&&(d=(d=B[ri]||null)?k1(d.formAction):B.getAttribute("formAction"),d!==null&&(I=d,B=null));var W=new xh("action","action",null,y,R);c.push({event:W,listeners:[{instance:null,listener:function(){if(y.defaultPrevented){if(ro!==0){var Z=B?T1(R,B):new FormData(R);Dv(p,{pending:!0,data:Z,method:R.method,action:I},null,Z)}}else typeof I=="function"&&(W.preventDefault(),Z=B?T1(R,B):new FormData(R),Dv(p,{pending:!0,data:Z,method:R.method,action:I},I,Z))},currentTarget:R}]})}}for(var mb=0;mb<Jg.length;mb++){var gb=Jg[mb],xB=gb.toLowerCase(),wB=gb[0].toUpperCase()+gb.slice(1);as(xB,"on"+wB)}as(iw,"onAnimationEnd"),as(sw,"onAnimationIteration"),as(rw,"onAnimationStart"),as("dblclick","onDoubleClick"),as("focusin","onFocus"),as("focusout","onBlur"),as(Uj,"onTransitionRun"),as(zj,"onTransitionStart"),as(Hj,"onTransitionCancel"),as(ow,"onTransitionEnd"),cl("onMouseEnter",["mouseout","mouseover"]),cl("onMouseLeave",["mouseout","mouseover"]),cl("onPointerEnter",["pointerout","pointerover"]),cl("onPointerLeave",["pointerout","pointerover"]),Go("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Go("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Go("onBeforeInput",["compositionend","keypress","textInput","paste"]),Go("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Go("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Go("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Su="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kB=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Su));function E1(c,d){d=(d&4)!==0;for(var p=0;p<c.length;p++){var y=c[p],R=y.event;y=y.listeners;e:{var I=void 0;if(d)for(var B=y.length-1;0<=B;B--){var W=y[B],Z=W.instance,ae=W.currentTarget;if(W=W.listener,Z!==I&&R.isPropagationStopped())break e;I=W,R.currentTarget=ae;try{I(R)}catch(fe){Th(fe)}R.currentTarget=null,I=Z}else for(B=0;B<y.length;B++){if(W=y[B],Z=W.instance,ae=W.currentTarget,W=W.listener,Z!==I&&R.isPropagationStopped())break e;I=W,R.currentTarget=ae;try{I(R)}catch(fe){Th(fe)}R.currentTarget=null,I=Z}}}}function ct(c,d){var p=d[Ag];p===void 0&&(p=d[Ag]=new Set);var y=c+"__bubble";p.has(y)||(R1(d,c,2,!1),p.add(y))}function vb(c,d,p){var y=0;d&&(y|=4),R1(p,c,y,d)}var ff="_reactListening"+Math.random().toString(36).slice(2);function bb(c){if(!c[ff]){c[ff]=!0,Sx.forEach(function(p){p!=="selectionchange"&&(kB.has(p)||vb(p,!1,c),vb(p,!0,c))});var d=c.nodeType===9?c:c.ownerDocument;d===null||d[ff]||(d[ff]=!0,vb("selectionchange",!1,d))}}function R1(c,d,p,y){switch(iT(d)){case 2:var R=ZB;break;case 8:R=e4;break;default:R=Pb}p=R.bind(null,d,p,c),R=void 0,!Bg||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(R=!0),y?R!==void 0?c.addEventListener(d,p,{capture:!0,passive:R}):c.addEventListener(d,p,!0):R!==void 0?c.addEventListener(d,p,{passive:R}):c.addEventListener(d,p,!1)}function yb(c,d,p,y,R){var I=y;if((d&1)===0&&(d&2)===0&&y!==null)e:for(;;){if(y===null)return;var B=y.tag;if(B===3||B===4){var W=y.stateNode.containerInfo;if(W===R)break;if(B===4)for(B=y.return;B!==null;){var Z=B.tag;if((Z===3||Z===4)&&B.stateNode.containerInfo===R)return;B=B.return}for(;W!==null;){if(B=ol(W),B===null)return;if(Z=B.tag,Z===5||Z===6||Z===26||Z===27){y=I=B;continue e}W=W.parentNode}}y=y.return}Px(function(){var ae=I,fe=Ng(p),me=[];e:{var le=aw.get(c);if(le!==void 0){var de=xh,Ie=c;switch(c){case"keypress":if(Sh(p)===0)break e;case"keydown":case"keyup":de=bj;break;case"focusin":Ie="focus",de=Hg;break;case"focusout":Ie="blur",de=Hg;break;case"beforeblur":case"afterblur":de=Hg;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":de=Nx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":de=oj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":de=Sj;break;case iw:case sw:case rw:de=cj;break;case ow:de=xj;break;case"scroll":case"scrollend":de=sj;break;case"wheel":de=kj;break;case"copy":case"cut":case"paste":de=dj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":de=Bx;break;case"toggle":case"beforetoggle":de=Ej}var Ve=(d&4)!==0,Pt=!Ve&&(c==="scroll"||c==="scrollend"),ie=Ve?le!==null?le+"Capture":null:le;Ve=[];for(var te=ae,oe;te!==null;){var pe=te;if(oe=pe.stateNode,pe=pe.tag,pe!==5&&pe!==26&&pe!==27||oe===null||ie===null||(pe=$c(te,ie),pe!=null&&Ve.push(Cu(te,pe,oe))),Pt)break;te=te.return}0<Ve.length&&(le=new de(le,Ie,null,p,fe),me.push({event:le,listeners:Ve}))}}if((d&7)===0){e:{if(le=c==="mouseover"||c==="pointerover",de=c==="mouseout"||c==="pointerout",le&&p!==Og&&(Ie=p.relatedTarget||p.fromElement)&&(ol(Ie)||Ie[rl]))break e;if((de||le)&&(le=fe.window===fe?fe:(le=fe.ownerDocument)?le.defaultView||le.parentWindow:window,de?(Ie=p.relatedTarget||p.toElement,de=ae,Ie=Ie?ol(Ie):null,Ie!==null&&(Pt=r(Ie),Ve=Ie.tag,Ie!==Pt||Ve!==5&&Ve!==27&&Ve!==6)&&(Ie=null)):(de=null,Ie=ae),de!==Ie)){if(Ve=Nx,pe="onMouseLeave",ie="onMouseEnter",te="mouse",(c==="pointerout"||c==="pointerover")&&(Ve=Bx,pe="onPointerLeave",ie="onPointerEnter",te="pointer"),Pt=de==null?le:Hc(de),oe=Ie==null?le:Hc(Ie),le=new Ve(pe,te+"leave",de,p,fe),le.target=Pt,le.relatedTarget=oe,pe=null,ol(fe)===ae&&(Ve=new Ve(ie,te+"enter",Ie,p,fe),Ve.target=oe,Ve.relatedTarget=Pt,pe=Ve),Pt=pe,de&&Ie)t:{for(Ve=TB,ie=de,te=Ie,oe=0,pe=ie;pe;pe=Ve(pe))oe++;pe=0;for(var Ue=te;Ue;Ue=Ve(Ue))pe++;for(;0<oe-pe;)ie=Ve(ie),oe--;for(;0<pe-oe;)te=Ve(te),pe--;for(;oe--;){if(ie===te||te!==null&&ie===te.alternate){Ve=ie;break t}ie=Ve(ie),te=Ve(te)}Ve=null}else Ve=null;de!==null&&A1(me,le,de,Ve,!1),Ie!==null&&Pt!==null&&A1(me,Pt,Ie,Ve,!0)}}e:{if(le=ae?Hc(ae):window,de=le.nodeName&&le.nodeName.toLowerCase(),de==="select"||de==="input"&&le.type==="file")var Ct=Wx;else if(qx(le))if(Gx)Ct=jj;else{Ct=Oj;var Ne=Dj}else de=le.nodeName,!de||de.toLowerCase()!=="input"||le.type!=="checkbox"&&le.type!=="radio"?ae&&Dg(ae.elementType)&&(Ct=Wx):Ct=Nj;if(Ct&&(Ct=Ct(c,ae))){Vx(me,Ct,p,fe);break e}Ne&&Ne(c,le,ae),c==="focusout"&&ae&&le.type==="number"&&ae.memoizedProps.value!=null&&Pg(le,"number",le.value)}switch(Ne=ae?Hc(ae):window,c){case"focusin":(qx(Ne)||Ne.contentEditable==="true")&&(ml=Ne,Kg=ae,Jc=null);break;case"focusout":Jc=Kg=ml=null;break;case"mousedown":Yg=!0;break;case"contextmenu":case"mouseup":case"dragend":Yg=!1,tw(me,p,fe);break;case"selectionchange":if(Fj)break;case"keydown":case"keyup":tw(me,p,fe)}var tt;if(qg)e:{switch(c){case"compositionstart":var mt="onCompositionStart";break e;case"compositionend":mt="onCompositionEnd";break e;case"compositionupdate":mt="onCompositionUpdate";break e}mt=void 0}else pl?Hx(c,p)&&(mt="onCompositionEnd"):c==="keydown"&&p.keyCode===229&&(mt="onCompositionStart");mt&&(Fx&&p.locale!=="ko"&&(pl||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&pl&&(tt=Dx()):($r=fe,Fg="value"in $r?$r.value:$r.textContent,pl=!0)),Ne=pf(ae,mt),0<Ne.length&&(mt=new jx(mt,c,null,p,fe),me.push({event:mt,listeners:Ne}),tt?mt.data=tt:(tt=$x(p),tt!==null&&(mt.data=tt)))),(tt=Aj?Mj(c,p):Lj(c,p))&&(mt=pf(ae,"onBeforeInput"),0<mt.length&&(Ne=new jx("onBeforeInput","beforeinput",null,p,fe),me.push({event:Ne,listeners:mt}),Ne.data=tt)),CB(me,c,ae,p,fe)}E1(me,d)})}function Cu(c,d,p){return{instance:c,listener:d,currentTarget:p}}function pf(c,d){for(var p=d+"Capture",y=[];c!==null;){var R=c,I=R.stateNode;if(R=R.tag,R!==5&&R!==26&&R!==27||I===null||(R=$c(c,p),R!=null&&y.unshift(Cu(c,R,I)),R=$c(c,d),R!=null&&y.push(Cu(c,R,I))),c.tag===3)return y;c=c.return}return[]}function TB(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function A1(c,d,p,y,R){for(var I=d._reactName,B=[];p!==null&&p!==y;){var W=p,Z=W.alternate,ae=W.stateNode;if(W=W.tag,Z!==null&&Z===y)break;W!==5&&W!==26&&W!==27||ae===null||(Z=ae,R?(ae=$c(p,I),ae!=null&&B.unshift(Cu(p,ae,Z))):R||(ae=$c(p,I),ae!=null&&B.push(Cu(p,ae,Z)))),p=p.return}B.length!==0&&c.push({event:d,listeners:B})}var EB=/\r\n?/g,RB=/\u0000|\uFFFD/g;function M1(c){return(typeof c=="string"?c:""+c).replace(EB,`
`).replace(RB,"")}function L1(c,d){return d=M1(d),M1(c)===d}function It(c,d,p,y,R,I){switch(p){case"children":typeof y=="string"?d==="body"||d==="textarea"&&y===""||dl(c,y):(typeof y=="number"||typeof y=="bigint")&&d!=="body"&&dl(c,""+y);break;case"className":vh(c,"class",y);break;case"tabIndex":vh(c,"tabindex",y);break;case"dir":case"role":case"viewBox":case"width":case"height":vh(c,p,y);break;case"style":Lx(c,y,I);break;case"data":if(d!=="object"){vh(c,"data",y);break}case"src":case"href":if(y===""&&(d!=="a"||p!=="href")){c.removeAttribute(p);break}if(y==null||typeof y=="function"||typeof y=="symbol"||typeof y=="boolean"){c.removeAttribute(p);break}y=yh(""+y),c.setAttribute(p,y);break;case"action":case"formAction":if(typeof y=="function"){c.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof I=="function"&&(p==="formAction"?(d!=="input"&&It(c,d,"name",R.name,R,null),It(c,d,"formEncType",R.formEncType,R,null),It(c,d,"formMethod",R.formMethod,R,null),It(c,d,"formTarget",R.formTarget,R,null)):(It(c,d,"encType",R.encType,R,null),It(c,d,"method",R.method,R,null),It(c,d,"target",R.target,R,null)));if(y==null||typeof y=="symbol"||typeof y=="boolean"){c.removeAttribute(p);break}y=yh(""+y),c.setAttribute(p,y);break;case"onClick":y!=null&&(c.onclick=rr);break;case"onScroll":y!=null&&ct("scroll",c);break;case"onScrollEnd":y!=null&&ct("scrollend",c);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(i(61));if(p=y.__html,p!=null){if(R.children!=null)throw Error(i(60));c.innerHTML=p}}break;case"multiple":c.multiple=y&&typeof y!="function"&&typeof y!="symbol";break;case"muted":c.muted=y&&typeof y!="function"&&typeof y!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(y==null||typeof y=="function"||typeof y=="boolean"||typeof y=="symbol"){c.removeAttribute("xlink:href");break}p=yh(""+y),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":y!=null&&typeof y!="function"&&typeof y!="symbol"?c.setAttribute(p,""+y):c.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":y&&typeof y!="function"&&typeof y!="symbol"?c.setAttribute(p,""):c.removeAttribute(p);break;case"capture":case"download":y===!0?c.setAttribute(p,""):y!==!1&&y!=null&&typeof y!="function"&&typeof y!="symbol"?c.setAttribute(p,y):c.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":y!=null&&typeof y!="function"&&typeof y!="symbol"&&!isNaN(y)&&1<=y?c.setAttribute(p,y):c.removeAttribute(p);break;case"rowSpan":case"start":y==null||typeof y=="function"||typeof y=="symbol"||isNaN(y)?c.removeAttribute(p):c.setAttribute(p,y);break;case"popover":ct("beforetoggle",c),ct("toggle",c),gh(c,"popover",y);break;case"xlinkActuate":sr(c,"http://www.w3.org/1999/xlink","xlink:actuate",y);break;case"xlinkArcrole":sr(c,"http://www.w3.org/1999/xlink","xlink:arcrole",y);break;case"xlinkRole":sr(c,"http://www.w3.org/1999/xlink","xlink:role",y);break;case"xlinkShow":sr(c,"http://www.w3.org/1999/xlink","xlink:show",y);break;case"xlinkTitle":sr(c,"http://www.w3.org/1999/xlink","xlink:title",y);break;case"xlinkType":sr(c,"http://www.w3.org/1999/xlink","xlink:type",y);break;case"xmlBase":sr(c,"http://www.w3.org/XML/1998/namespace","xml:base",y);break;case"xmlLang":sr(c,"http://www.w3.org/XML/1998/namespace","xml:lang",y);break;case"xmlSpace":sr(c,"http://www.w3.org/XML/1998/namespace","xml:space",y);break;case"is":gh(c,"is",y);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=nj.get(p)||p,gh(c,p,y))}}function _b(c,d,p,y,R,I){switch(p){case"style":Lx(c,y,I);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(i(61));if(p=y.__html,p!=null){if(R.children!=null)throw Error(i(60));c.innerHTML=p}}break;case"children":typeof y=="string"?dl(c,y):(typeof y=="number"||typeof y=="bigint")&&dl(c,""+y);break;case"onScroll":y!=null&&ct("scroll",c);break;case"onScrollEnd":y!=null&&ct("scrollend",c);break;case"onClick":y!=null&&(c.onclick=rr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Cx.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(R=p.endsWith("Capture"),d=p.slice(2,R?p.length-7:void 0),I=c[ri]||null,I=I!=null?I[p]:null,typeof I=="function"&&c.removeEventListener(d,I,R),typeof y=="function")){typeof I!="function"&&I!==null&&(p in c?c[p]=null:c.hasAttribute(p)&&c.removeAttribute(p)),c.addEventListener(d,y,R);break e}p in c?c[p]=y:y===!0?c.setAttribute(p,""):gh(c,p,y)}}}function Pn(c,d,p){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ct("error",c),ct("load",c);var y=!1,R=!1,I;for(I in p)if(p.hasOwnProperty(I)){var B=p[I];if(B!=null)switch(I){case"src":y=!0;break;case"srcSet":R=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,d));default:It(c,d,I,B,p,null)}}R&&It(c,d,"srcSet",p.srcSet,p,null),y&&It(c,d,"src",p.src,p,null);return;case"input":ct("invalid",c);var W=I=B=R=null,Z=null,ae=null;for(y in p)if(p.hasOwnProperty(y)){var fe=p[y];if(fe!=null)switch(y){case"name":R=fe;break;case"type":B=fe;break;case"checked":Z=fe;break;case"defaultChecked":ae=fe;break;case"value":I=fe;break;case"defaultValue":W=fe;break;case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(i(137,d));break;default:It(c,d,y,fe,p,null)}}Ex(c,I,W,Z,ae,B,R,!1);return;case"select":ct("invalid",c),y=B=I=null;for(R in p)if(p.hasOwnProperty(R)&&(W=p[R],W!=null))switch(R){case"value":I=W;break;case"defaultValue":B=W;break;case"multiple":y=W;default:It(c,d,R,W,p,null)}d=I,p=B,c.multiple=!!y,d!=null?ul(c,!!y,d,!1):p!=null&&ul(c,!!y,p,!0);return;case"textarea":ct("invalid",c),I=R=y=null;for(B in p)if(p.hasOwnProperty(B)&&(W=p[B],W!=null))switch(B){case"value":y=W;break;case"defaultValue":R=W;break;case"children":I=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(i(91));break;default:It(c,d,B,W,p,null)}Ax(c,y,R,I);return;case"option":for(Z in p)p.hasOwnProperty(Z)&&(y=p[Z],y!=null)&&(Z==="selected"?c.selected=y&&typeof y!="function"&&typeof y!="symbol":It(c,d,Z,y,p,null));return;case"dialog":ct("beforetoggle",c),ct("toggle",c),ct("cancel",c),ct("close",c);break;case"iframe":case"object":ct("load",c);break;case"video":case"audio":for(y=0;y<Su.length;y++)ct(Su[y],c);break;case"image":ct("error",c),ct("load",c);break;case"details":ct("toggle",c);break;case"embed":case"source":case"link":ct("error",c),ct("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ae in p)if(p.hasOwnProperty(ae)&&(y=p[ae],y!=null))switch(ae){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,d));default:It(c,d,ae,y,p,null)}return;default:if(Dg(d)){for(fe in p)p.hasOwnProperty(fe)&&(y=p[fe],y!==void 0&&_b(c,d,fe,y,p,void 0));return}}for(W in p)p.hasOwnProperty(W)&&(y=p[W],y!=null&&It(c,d,W,y,p,null))}function AB(c,d,p,y){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var R=null,I=null,B=null,W=null,Z=null,ae=null,fe=null;for(de in p){var me=p[de];if(p.hasOwnProperty(de)&&me!=null)switch(de){case"checked":break;case"value":break;case"defaultValue":Z=me;default:y.hasOwnProperty(de)||It(c,d,de,null,y,me)}}for(var le in y){var de=y[le];if(me=p[le],y.hasOwnProperty(le)&&(de!=null||me!=null))switch(le){case"type":I=de;break;case"name":R=de;break;case"checked":ae=de;break;case"defaultChecked":fe=de;break;case"value":B=de;break;case"defaultValue":W=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(i(137,d));break;default:de!==me&&It(c,d,le,de,y,me)}}Ig(c,B,W,Z,ae,fe,I,R);return;case"select":de=B=W=le=null;for(I in p)if(Z=p[I],p.hasOwnProperty(I)&&Z!=null)switch(I){case"value":break;case"multiple":de=Z;default:y.hasOwnProperty(I)||It(c,d,I,null,y,Z)}for(R in y)if(I=y[R],Z=p[R],y.hasOwnProperty(R)&&(I!=null||Z!=null))switch(R){case"value":le=I;break;case"defaultValue":W=I;break;case"multiple":B=I;default:I!==Z&&It(c,d,R,I,y,Z)}d=W,p=B,y=de,le!=null?ul(c,!!p,le,!1):!!y!=!!p&&(d!=null?ul(c,!!p,d,!0):ul(c,!!p,p?[]:"",!1));return;case"textarea":de=le=null;for(W in p)if(R=p[W],p.hasOwnProperty(W)&&R!=null&&!y.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:It(c,d,W,null,y,R)}for(B in y)if(R=y[B],I=p[B],y.hasOwnProperty(B)&&(R!=null||I!=null))switch(B){case"value":le=R;break;case"defaultValue":de=R;break;case"children":break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(i(91));break;default:R!==I&&It(c,d,B,R,y,I)}Rx(c,le,de);return;case"option":for(var Ie in p)le=p[Ie],p.hasOwnProperty(Ie)&&le!=null&&!y.hasOwnProperty(Ie)&&(Ie==="selected"?c.selected=!1:It(c,d,Ie,null,y,le));for(Z in y)le=y[Z],de=p[Z],y.hasOwnProperty(Z)&&le!==de&&(le!=null||de!=null)&&(Z==="selected"?c.selected=le&&typeof le!="function"&&typeof le!="symbol":It(c,d,Z,le,y,de));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ve in p)le=p[Ve],p.hasOwnProperty(Ve)&&le!=null&&!y.hasOwnProperty(Ve)&&It(c,d,Ve,null,y,le);for(ae in y)if(le=y[ae],de=p[ae],y.hasOwnProperty(ae)&&le!==de&&(le!=null||de!=null))switch(ae){case"children":case"dangerouslySetInnerHTML":if(le!=null)throw Error(i(137,d));break;default:It(c,d,ae,le,y,de)}return;default:if(Dg(d)){for(var Pt in p)le=p[Pt],p.hasOwnProperty(Pt)&&le!==void 0&&!y.hasOwnProperty(Pt)&&_b(c,d,Pt,void 0,y,le);for(fe in y)le=y[fe],de=p[fe],!y.hasOwnProperty(fe)||le===de||le===void 0&&de===void 0||_b(c,d,fe,le,y,de);return}}for(var ie in p)le=p[ie],p.hasOwnProperty(ie)&&le!=null&&!y.hasOwnProperty(ie)&&It(c,d,ie,null,y,le);for(me in y)le=y[me],de=p[me],!y.hasOwnProperty(me)||le===de||le==null&&de==null||It(c,d,me,le,y,de)}function I1(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function MB(){if(typeof performance.getEntriesByType=="function"){for(var c=0,d=0,p=performance.getEntriesByType("resource"),y=0;y<p.length;y++){var R=p[y],I=R.transferSize,B=R.initiatorType,W=R.duration;if(I&&W&&I1(B)){for(B=0,W=R.responseEnd,y+=1;y<p.length;y++){var Z=p[y],ae=Z.startTime;if(ae>W)break;var fe=Z.transferSize,me=Z.initiatorType;fe&&I1(me)&&(Z=Z.responseEnd,B+=fe*(Z<W?1:(W-ae)/(Z-ae)))}if(--y,d+=8*(I+B)/(R.duration/1e3),c++,10<c)break}}if(0<c)return d/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var Sb=null,Cb=null;function mf(c){return c.nodeType===9?c:c.ownerDocument}function P1(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function D1(c,d){if(c===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&d==="foreignObject"?0:c}function xb(c,d){return c==="textarea"||c==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var wb=null;function LB(){var c=window.event;return c&&c.type==="popstate"?c===wb?!1:(wb=c,!0):(wb=null,!1)}var O1=typeof setTimeout=="function"?setTimeout:void 0,IB=typeof clearTimeout=="function"?clearTimeout:void 0,N1=typeof Promise=="function"?Promise:void 0,PB=typeof queueMicrotask=="function"?queueMicrotask:typeof N1<"u"?function(c){return N1.resolve(null).then(c).catch(DB)}:O1;function DB(c){setTimeout(function(){throw c})}function oo(c){return c==="head"}function j1(c,d){var p=d,y=0;do{var R=p.nextSibling;if(c.removeChild(p),R&&R.nodeType===8)if(p=R.data,p==="/$"||p==="/&"){if(y===0){c.removeChild(R),Hl(d);return}y--}else if(p==="$"||p==="$?"||p==="$~"||p==="$!"||p==="&")y++;else if(p==="html")xu(c.ownerDocument.documentElement);else if(p==="head"){p=c.ownerDocument.head,xu(p);for(var I=p.firstChild;I;){var B=I.nextSibling,W=I.nodeName;I[zc]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&I.rel.toLowerCase()==="stylesheet"||p.removeChild(I),I=B}}else p==="body"&&xu(c.ownerDocument.body);p=R}while(p);Hl(d)}function B1(c,d){var p=c;c=0;do{var y=p.nextSibling;if(p.nodeType===1?d?(p._stashedDisplay=p.style.display,p.style.display="none"):(p.style.display=p._stashedDisplay||"",p.getAttribute("style")===""&&p.removeAttribute("style")):p.nodeType===3&&(d?(p._stashedText=p.nodeValue,p.nodeValue=""):p.nodeValue=p._stashedText||""),y&&y.nodeType===8)if(p=y.data,p==="/$"){if(c===0)break;c--}else p!=="$"&&p!=="$?"&&p!=="$~"&&p!=="$!"||c++;p=y}while(p)}function kb(c){var d=c.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var p=d;switch(d=d.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":kb(p),Mg(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}c.removeChild(p)}}function OB(c,d,p,y){for(;c.nodeType===1;){var R=p;if(c.nodeName.toLowerCase()!==d.toLowerCase()){if(!y&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(y){if(!c[zc])switch(d){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(I=c.getAttribute("rel"),I==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(I!==R.rel||c.getAttribute("href")!==(R.href==null||R.href===""?null:R.href)||c.getAttribute("crossorigin")!==(R.crossOrigin==null?null:R.crossOrigin)||c.getAttribute("title")!==(R.title==null?null:R.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(I=c.getAttribute("src"),(I!==(R.src==null?null:R.src)||c.getAttribute("type")!==(R.type==null?null:R.type)||c.getAttribute("crossorigin")!==(R.crossOrigin==null?null:R.crossOrigin))&&I&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(d==="input"&&c.type==="hidden"){var I=R.name==null?null:""+R.name;if(R.type==="hidden"&&c.getAttribute("name")===I)return c}else return c;if(c=qi(c.nextSibling),c===null)break}return null}function NB(c,d,p){if(d==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!p||(c=qi(c.nextSibling),c===null))return null;return c}function F1(c,d){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!d||(c=qi(c.nextSibling),c===null))return null;return c}function Tb(c){return c.data==="$?"||c.data==="$~"}function Eb(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function jB(c,d){var p=c.ownerDocument;if(c.data==="$~")c._reactRetry=d;else if(c.data!=="$?"||p.readyState!=="loading")d();else{var y=function(){d(),p.removeEventListener("DOMContentLoaded",y)};p.addEventListener("DOMContentLoaded",y),c._reactRetry=y}}function qi(c){for(;c!=null;c=c.nextSibling){var d=c.nodeType;if(d===1||d===3)break;if(d===8){if(d=c.data,d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"||d==="F!"||d==="F")break;if(d==="/$"||d==="/&")return null}}return c}var Rb=null;function U1(c){c=c.nextSibling;for(var d=0;c;){if(c.nodeType===8){var p=c.data;if(p==="/$"||p==="/&"){if(d===0)return qi(c.nextSibling);d--}else p!=="$"&&p!=="$!"&&p!=="$?"&&p!=="$~"&&p!=="&"||d++}c=c.nextSibling}return null}function z1(c){c=c.previousSibling;for(var d=0;c;){if(c.nodeType===8){var p=c.data;if(p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"){if(d===0)return c;d--}else p!=="/$"&&p!=="/&"||d++}c=c.previousSibling}return null}function H1(c,d,p){switch(d=mf(p),c){case"html":if(c=d.documentElement,!c)throw Error(i(452));return c;case"head":if(c=d.head,!c)throw Error(i(453));return c;case"body":if(c=d.body,!c)throw Error(i(454));return c;default:throw Error(i(451))}}function xu(c){for(var d=c.attributes;d.length;)c.removeAttributeNode(d[0]);Mg(c)}var Vi=new Map,$1=new Set;function gf(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var Sr=Y.d;Y.d={f:BB,r:FB,D:UB,C:zB,L:HB,m:$B,X:VB,S:qB,M:WB};function BB(){var c=Sr.f(),d=af();return c||d}function FB(c){var d=al(c);d!==null&&d.tag===5&&d.type==="form"?ok(d):Sr.r(c)}var Fl=typeof document>"u"?null:document;function q1(c,d,p){var y=Fl;if(y&&typeof d=="string"&&d){var R=ji(d);R='link[rel="'+c+'"][href="'+R+'"]',typeof p=="string"&&(R+='[crossorigin="'+p+'"]'),$1.has(R)||($1.add(R),c={rel:c,crossOrigin:p,href:d},y.querySelector(R)===null&&(d=y.createElement("link"),Pn(d,"link",c),Cn(d),y.head.appendChild(d)))}}function UB(c){Sr.D(c),q1("dns-prefetch",c,null)}function zB(c,d){Sr.C(c,d),q1("preconnect",c,d)}function HB(c,d,p){Sr.L(c,d,p);var y=Fl;if(y&&c&&d){var R='link[rel="preload"][as="'+ji(d)+'"]';d==="image"&&p&&p.imageSrcSet?(R+='[imagesrcset="'+ji(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(R+='[imagesizes="'+ji(p.imageSizes)+'"]')):R+='[href="'+ji(c)+'"]';var I=R;switch(d){case"style":I=Ul(c);break;case"script":I=zl(c)}Vi.has(I)||(c=f({rel:"preload",href:d==="image"&&p&&p.imageSrcSet?void 0:c,as:d},p),Vi.set(I,c),y.querySelector(R)!==null||d==="style"&&y.querySelector(wu(I))||d==="script"&&y.querySelector(ku(I))||(d=y.createElement("link"),Pn(d,"link",c),Cn(d),y.head.appendChild(d)))}}function $B(c,d){Sr.m(c,d);var p=Fl;if(p&&c){var y=d&&typeof d.as=="string"?d.as:"script",R='link[rel="modulepreload"][as="'+ji(y)+'"][href="'+ji(c)+'"]',I=R;switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":I=zl(c)}if(!Vi.has(I)&&(c=f({rel:"modulepreload",href:c},d),Vi.set(I,c),p.querySelector(R)===null)){switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(ku(I)))return}y=p.createElement("link"),Pn(y,"link",c),Cn(y),p.head.appendChild(y)}}}function qB(c,d,p){Sr.S(c,d,p);var y=Fl;if(y&&c){var R=ll(y).hoistableStyles,I=Ul(c);d=d||"default";var B=R.get(I);if(!B){var W={loading:0,preload:null};if(B=y.querySelector(wu(I)))W.loading=5;else{c=f({rel:"stylesheet",href:c,"data-precedence":d},p),(p=Vi.get(I))&&Ab(c,p);var Z=B=y.createElement("link");Cn(Z),Pn(Z,"link",c),Z._p=new Promise(function(ae,fe){Z.onload=ae,Z.onerror=fe}),Z.addEventListener("load",function(){W.loading|=1}),Z.addEventListener("error",function(){W.loading|=2}),W.loading|=4,vf(B,d,y)}B={type:"stylesheet",instance:B,count:1,state:W},R.set(I,B)}}}function VB(c,d){Sr.X(c,d);var p=Fl;if(p&&c){var y=ll(p).hoistableScripts,R=zl(c),I=y.get(R);I||(I=p.querySelector(ku(R)),I||(c=f({src:c,async:!0},d),(d=Vi.get(R))&&Mb(c,d),I=p.createElement("script"),Cn(I),Pn(I,"link",c),p.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},y.set(R,I))}}function WB(c,d){Sr.M(c,d);var p=Fl;if(p&&c){var y=ll(p).hoistableScripts,R=zl(c),I=y.get(R);I||(I=p.querySelector(ku(R)),I||(c=f({src:c,async:!0,type:"module"},d),(d=Vi.get(R))&&Mb(c,d),I=p.createElement("script"),Cn(I),Pn(I,"link",c),p.head.appendChild(I)),I={type:"script",instance:I,count:1,state:null},y.set(R,I))}}function V1(c,d,p,y){var R=(R=ce.current)?gf(R):null;if(!R)throw Error(i(446));switch(c){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(d=Ul(p.href),p=ll(R).hoistableStyles,y=p.get(d),y||(y={type:"style",instance:null,count:0,state:null},p.set(d,y)),y):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){c=Ul(p.href);var I=ll(R).hoistableStyles,B=I.get(c);if(B||(R=R.ownerDocument||R,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},I.set(c,B),(I=R.querySelector(wu(c)))&&!I._p&&(B.instance=I,B.state.loading=5),Vi.has(c)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},Vi.set(c,p),I||GB(R,c,p,B.state))),d&&y===null)throw Error(i(528,""));return B}if(d&&y!==null)throw Error(i(529,""));return null;case"script":return d=p.async,p=p.src,typeof p=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=zl(p),p=ll(R).hoistableScripts,y=p.get(d),y||(y={type:"script",instance:null,count:0,state:null},p.set(d,y)),y):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,c))}}function Ul(c){return'href="'+ji(c)+'"'}function wu(c){return'link[rel="stylesheet"]['+c+"]"}function W1(c){return f({},c,{"data-precedence":c.precedence,precedence:null})}function GB(c,d,p,y){c.querySelector('link[rel="preload"][as="style"]['+d+"]")?y.loading=1:(d=c.createElement("link"),y.preload=d,d.addEventListener("load",function(){return y.loading|=1}),d.addEventListener("error",function(){return y.loading|=2}),Pn(d,"link",p),Cn(d),c.head.appendChild(d))}function zl(c){return'[src="'+ji(c)+'"]'}function ku(c){return"script[async]"+c}function G1(c,d,p){if(d.count++,d.instance===null)switch(d.type){case"style":var y=c.querySelector('style[data-href~="'+ji(p.href)+'"]');if(y)return d.instance=y,Cn(y),y;var R=f({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return y=(c.ownerDocument||c).createElement("style"),Cn(y),Pn(y,"style",R),vf(y,p.precedence,c),d.instance=y;case"stylesheet":R=Ul(p.href);var I=c.querySelector(wu(R));if(I)return d.state.loading|=4,d.instance=I,Cn(I),I;y=W1(p),(R=Vi.get(R))&&Ab(y,R),I=(c.ownerDocument||c).createElement("link"),Cn(I);var B=I;return B._p=new Promise(function(W,Z){B.onload=W,B.onerror=Z}),Pn(I,"link",y),d.state.loading|=4,vf(I,p.precedence,c),d.instance=I;case"script":return I=zl(p.src),(R=c.querySelector(ku(I)))?(d.instance=R,Cn(R),R):(y=p,(R=Vi.get(I))&&(y=f({},p),Mb(y,R)),c=c.ownerDocument||c,R=c.createElement("script"),Cn(R),Pn(R,"link",y),c.head.appendChild(R),d.instance=R);case"void":return null;default:throw Error(i(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(y=d.instance,d.state.loading|=4,vf(y,p.precedence,c));return d.instance}function vf(c,d,p){for(var y=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),R=y.length?y[y.length-1]:null,I=R,B=0;B<y.length;B++){var W=y[B];if(W.dataset.precedence===d)I=W;else if(I!==R)break}I?I.parentNode.insertBefore(c,I.nextSibling):(d=p.nodeType===9?p.head:p,d.insertBefore(c,d.firstChild))}function Ab(c,d){c.crossOrigin==null&&(c.crossOrigin=d.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=d.referrerPolicy),c.title==null&&(c.title=d.title)}function Mb(c,d){c.crossOrigin==null&&(c.crossOrigin=d.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=d.referrerPolicy),c.integrity==null&&(c.integrity=d.integrity)}var bf=null;function K1(c,d,p){if(bf===null){var y=new Map,R=bf=new Map;R.set(p,y)}else R=bf,y=R.get(p),y||(y=new Map,R.set(p,y));if(y.has(c))return y;for(y.set(c,null),p=p.getElementsByTagName(c),R=0;R<p.length;R++){var I=p[R];if(!(I[zc]||I[An]||c==="link"&&I.getAttribute("rel")==="stylesheet")&&I.namespaceURI!=="http://www.w3.org/2000/svg"){var B=I.getAttribute(d)||"";B=c+B;var W=y.get(B);W?W.push(I):y.set(B,[I])}}return y}function Y1(c,d,p){c=c.ownerDocument||c,c.head.insertBefore(p,d==="title"?c.querySelector("head > title"):null)}function KB(c,d,p){if(p===1||d.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;return d.rel==="stylesheet"?(c=d.disabled,typeof d.precedence=="string"&&c==null):!0;case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function Q1(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function YB(c,d,p,y){if(p.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(p.state.loading&4)===0){if(p.instance===null){var R=Ul(y.href),I=d.querySelector(wu(R));if(I){d=I._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(c.count++,c=yf.bind(c),d.then(c,c)),p.state.loading|=4,p.instance=I,Cn(I);return}I=d.ownerDocument||d,y=W1(y),(R=Vi.get(R))&&Ab(y,R),I=I.createElement("link"),Cn(I);var B=I;B._p=new Promise(function(W,Z){B.onload=W,B.onerror=Z}),Pn(I,"link",y),p.instance=I}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(p,d),(d=p.state.preload)&&(p.state.loading&3)===0&&(c.count++,p=yf.bind(c),d.addEventListener("load",p),d.addEventListener("error",p))}}var Lb=0;function QB(c,d){return c.stylesheets&&c.count===0&&Sf(c,c.stylesheets),0<c.count||0<c.imgCount?function(p){var y=setTimeout(function(){if(c.stylesheets&&Sf(c,c.stylesheets),c.unsuspend){var I=c.unsuspend;c.unsuspend=null,I()}},6e4+d);0<c.imgBytes&&Lb===0&&(Lb=62500*MB());var R=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&Sf(c,c.stylesheets),c.unsuspend)){var I=c.unsuspend;c.unsuspend=null,I()}},(c.imgBytes>Lb?50:800)+d);return c.unsuspend=p,function(){c.unsuspend=null,clearTimeout(y),clearTimeout(R)}}:null}function yf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Sf(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var _f=null;function Sf(c,d){c.stylesheets=null,c.unsuspend!==null&&(c.count++,_f=new Map,d.forEach(JB,c),_f=null,yf.call(c))}function JB(c,d){if(!(d.state.loading&4)){var p=_f.get(c);if(p)var y=p.get(null);else{p=new Map,_f.set(c,p);for(var R=c.querySelectorAll("link[data-precedence],style[data-precedence]"),I=0;I<R.length;I++){var B=R[I];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(p.set(B.dataset.precedence,B),y=B)}y&&p.set(null,y)}R=d.instance,B=R.getAttribute("data-precedence"),I=p.get(B)||y,I===y&&p.set(null,R),p.set(B,R),this.count++,y=yf.bind(this),R.addEventListener("load",y),R.addEventListener("error",y),I?I.parentNode.insertBefore(R,I.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(R,c.firstChild)),d.state.loading|=4}}var Tu={$$typeof:x,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function XB(c,d,p,y,R,I,B,W,Z){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Le(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Le(0),this.hiddenUpdates=Le(null),this.identifierPrefix=y,this.onUncaughtError=R,this.onCaughtError=I,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Z,this.incompleteTransitions=new Map}function J1(c,d,p,y,R,I,B,W,Z,ae,fe,me){return c=new XB(c,d,p,B,Z,ae,fe,me,W),d=1,I===!0&&(d|=24),I=xi(3,null,null,d),c.current=I,I.stateNode=c,d=uv(),d.refCount++,c.pooledCache=d,d.refCount++,I.memoizedState={element:y,isDehydrated:p,cache:d},pv(I),c}function X1(c){return c?(c=bl,c):bl}function Z1(c,d,p,y,R,I){R=X1(R),y.context===null?y.context=R:y.pendingContext=R,y=Yr(d),y.payload={element:p},I=I===void 0?null:I,I!==null&&(y.callback=I),p=Qr(c,y,d),p!==null&&(di(p,c,d),su(p,c,d))}function eT(c,d){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var p=c.retryLane;c.retryLane=p!==0&&p<d?p:d}}function Ib(c,d){eT(c,d),(c=c.alternate)&&eT(c,d)}function tT(c){if(c.tag===13||c.tag===31){var d=Jo(c,67108864);d!==null&&di(d,c,67108864),Ib(c,67108864)}}function nT(c){if(c.tag===13||c.tag===31){var d=Ri();d=Eg(d);var p=Jo(c,d);p!==null&&di(p,c,d),Ib(c,d)}}var Cf=!0;function ZB(c,d,p,y){var R=$.T;$.T=null;var I=Y.p;try{Y.p=2,Pb(c,d,p,y)}finally{Y.p=I,$.T=R}}function e4(c,d,p,y){var R=$.T;$.T=null;var I=Y.p;try{Y.p=8,Pb(c,d,p,y)}finally{Y.p=I,$.T=R}}function Pb(c,d,p,y){if(Cf){var R=Db(y);if(R===null)yb(c,d,y,xf,p),sT(c,y);else if(n4(R,c,d,p,y))y.stopPropagation();else if(sT(c,y),d&4&&-1<t4.indexOf(c)){for(;R!==null;){var I=al(R);if(I!==null)switch(I.tag){case 3:if(I=I.stateNode,I.current.memoizedState.isDehydrated){var B=rs(I.pendingLanes);if(B!==0){var W=I;for(W.pendingLanes|=2,W.entangledLanes|=2;B;){var Z=1<<31-St(B);W.entanglements[1]|=Z,B&=~Z}Ds(I),(kt&6)===0&&(rf=Fe()+500,_u(0))}}break;case 31:case 13:W=Jo(I,2),W!==null&&di(W,I,2),af(),Ib(I,2)}if(I=Db(y),I===null&&yb(c,d,y,xf,p),I===R)break;R=I}R!==null&&y.stopPropagation()}else yb(c,d,y,null,p)}}function Db(c){return c=Ng(c),Ob(c)}var xf=null;function Ob(c){if(xf=null,c=ol(c),c!==null){var d=r(c);if(d===null)c=null;else{var p=d.tag;if(p===13){if(c=a(d),c!==null)return c;c=null}else if(p===31){if(c=o(d),c!==null)return c;c=null}else if(p===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;c=null}else d!==c&&(c=null)}}return xf=c,null}function iT(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_t()){case se:return 2;case ge:return 8;case Me:case je:return 32;case ze:return 268435456;default:return 32}default:return 32}}var Nb=!1,ao=null,lo=null,co=null,Eu=new Map,Ru=new Map,uo=[],t4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function sT(c,d){switch(c){case"focusin":case"focusout":ao=null;break;case"dragenter":case"dragleave":lo=null;break;case"mouseover":case"mouseout":co=null;break;case"pointerover":case"pointerout":Eu.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ru.delete(d.pointerId)}}function Au(c,d,p,y,R,I){return c===null||c.nativeEvent!==I?(c={blockedOn:d,domEventName:p,eventSystemFlags:y,nativeEvent:I,targetContainers:[R]},d!==null&&(d=al(d),d!==null&&tT(d)),c):(c.eventSystemFlags|=y,d=c.targetContainers,R!==null&&d.indexOf(R)===-1&&d.push(R),c)}function n4(c,d,p,y,R){switch(d){case"focusin":return ao=Au(ao,c,d,p,y,R),!0;case"dragenter":return lo=Au(lo,c,d,p,y,R),!0;case"mouseover":return co=Au(co,c,d,p,y,R),!0;case"pointerover":var I=R.pointerId;return Eu.set(I,Au(Eu.get(I)||null,c,d,p,y,R)),!0;case"gotpointercapture":return I=R.pointerId,Ru.set(I,Au(Ru.get(I)||null,c,d,p,y,R)),!0}return!1}function rT(c){var d=ol(c.target);if(d!==null){var p=r(d);if(p!==null){if(d=p.tag,d===13){if(d=a(p),d!==null){c.blockedOn=d,yx(c.priority,function(){nT(p)});return}}else if(d===31){if(d=o(p),d!==null){c.blockedOn=d,yx(c.priority,function(){nT(p)});return}}else if(d===3&&p.stateNode.current.memoizedState.isDehydrated){c.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}c.blockedOn=null}function wf(c){if(c.blockedOn!==null)return!1;for(var d=c.targetContainers;0<d.length;){var p=Db(c.nativeEvent);if(p===null){p=c.nativeEvent;var y=new p.constructor(p.type,p);Og=y,p.target.dispatchEvent(y),Og=null}else return d=al(p),d!==null&&tT(d),c.blockedOn=p,!1;d.shift()}return!0}function oT(c,d,p){wf(c)&&p.delete(d)}function i4(){Nb=!1,ao!==null&&wf(ao)&&(ao=null),lo!==null&&wf(lo)&&(lo=null),co!==null&&wf(co)&&(co=null),Eu.forEach(oT),Ru.forEach(oT)}function kf(c,d){c.blockedOn===d&&(c.blockedOn=null,Nb||(Nb=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,i4)))}var Tf=null;function aT(c){Tf!==c&&(Tf=c,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Tf===c&&(Tf=null);for(var d=0;d<c.length;d+=3){var p=c[d],y=c[d+1],R=c[d+2];if(typeof y!="function"){if(Ob(y||p)===null)continue;break}var I=al(p);I!==null&&(c.splice(d,3),d-=3,Dv(I,{pending:!0,data:R,method:p.method,action:y},y,R))}}))}function Hl(c){function d(Z){return kf(Z,c)}ao!==null&&kf(ao,c),lo!==null&&kf(lo,c),co!==null&&kf(co,c),Eu.forEach(d),Ru.forEach(d);for(var p=0;p<uo.length;p++){var y=uo[p];y.blockedOn===c&&(y.blockedOn=null)}for(;0<uo.length&&(p=uo[0],p.blockedOn===null);)rT(p),p.blockedOn===null&&uo.shift();if(p=(c.ownerDocument||c).$$reactFormReplay,p!=null)for(y=0;y<p.length;y+=3){var R=p[y],I=p[y+1],B=R[ri]||null;if(typeof I=="function")B||aT(p);else if(B){var W=null;if(I&&I.hasAttribute("formAction")){if(R=I,B=I[ri]||null)W=B.formAction;else if(Ob(R)!==null)continue}else W=B.action;typeof W=="function"?p[y+1]=W:(p.splice(y,3),y-=3),aT(p)}}}function lT(){function c(I){I.canIntercept&&I.info==="react-transition"&&I.intercept({handler:function(){return new Promise(function(B){return R=B})},focusReset:"manual",scroll:"manual"})}function d(){R!==null&&(R(),R=null),y||setTimeout(p,20)}function p(){if(!y&&!navigation.transition){var I=navigation.currentEntry;I&&I.url!=null&&navigation.navigate(I.url,{state:I.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var y=!1,R=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",d),navigation.addEventListener("navigateerror",d),setTimeout(p,100),function(){y=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",d),navigation.removeEventListener("navigateerror",d),R!==null&&(R(),R=null)}}}function jb(c){this._internalRoot=c}Ef.prototype.render=jb.prototype.render=function(c){var d=this._internalRoot;if(d===null)throw Error(i(409));var p=d.current,y=Ri();Z1(p,y,c,d,null,null)},Ef.prototype.unmount=jb.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var d=c.containerInfo;Z1(c.current,2,null,c,null,null),af(),d[rl]=null}};function Ef(c){this._internalRoot=c}Ef.prototype.unstable_scheduleHydration=function(c){if(c){var d=bx();c={blockedOn:null,target:c,priority:d};for(var p=0;p<uo.length&&d!==0&&d<uo[p].priority;p++);uo.splice(p,0,c),p===0&&rT(c)}};var cT=t.version;if(cT!=="19.2.4")throw Error(i(527,cT,"19.2.4"));Y.findDOMNode=function(c){var d=c._reactInternals;if(d===void 0)throw typeof c.render=="function"?Error(i(188)):(c=Object.keys(c).join(","),Error(i(268,c)));return c=u(d),c=c!==null?h(c):null,c=c===null?null:c.stateNode,c};var s4={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:$,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Rf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rf.isDisabled&&Rf.supportsFiber)try{Yt=Rf.inject(s4),zt=Rf}catch{}}return Lu.createRoot=function(c,d){if(!s(c))throw Error(i(299));var p=!1,y="",R=gk,I=vk,B=bk;return d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onUncaughtError!==void 0&&(R=d.onUncaughtError),d.onCaughtError!==void 0&&(I=d.onCaughtError),d.onRecoverableError!==void 0&&(B=d.onRecoverableError)),d=J1(c,1,!1,null,null,p,y,null,R,I,B,lT),c[rl]=d.current,bb(c),new jb(d)},Lu.hydrateRoot=function(c,d,p){if(!s(c))throw Error(i(299));var y=!1,R="",I=gk,B=vk,W=bk,Z=null;return p!=null&&(p.unstable_strictMode===!0&&(y=!0),p.identifierPrefix!==void 0&&(R=p.identifierPrefix),p.onUncaughtError!==void 0&&(I=p.onUncaughtError),p.onCaughtError!==void 0&&(B=p.onCaughtError),p.onRecoverableError!==void 0&&(W=p.onRecoverableError),p.formState!==void 0&&(Z=p.formState)),d=J1(c,1,!0,d,p??null,y,R,Z,I,B,W,lT),d.context=X1(null),p=d.current,y=Ri(),y=Eg(y),R=Yr(y),R.callback=null,Qr(p,R,y),p=y,d.current.lanes=p,Ze(d,p),Ds(d),c[rl]=d.current,bb(c),new Ef(d)},Lu.version="19.2.4",Lu}var yT;function p4(){if(yT)return Ub.exports;yT=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Ub.exports=f4(),Ub.exports}var m4=p4();const g4=Ga(m4);var Ac=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},v4={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},b4=class{#e=v4;#t=!1;setTimeoutProvider(e){this.#e=e}setTimeout(e,t){return this.#e.setTimeout(e,t)}clearTimeout(e){this.#e.clearTimeout(e)}setInterval(e,t){return this.#e.setInterval(e,t)}clearInterval(e){this.#e.clearInterval(e)}},ka=new b4;function y4(e){setTimeout(e,0)}var Na=typeof window>"u"||"Deno"in globalThis;function Xn(){}function _4(e,t){return typeof e=="function"?e(t):e}function D_(e){return typeof e=="number"&&e>=0&&e!==1/0}function IL(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Ro(e,t){return typeof e=="function"?e(t):e}function Yi(e,t){return typeof e=="function"?e(t):e}function _T(e,t){const{type:n="all",exact:i,fetchStatus:s,predicate:r,queryKey:a,stale:o}=e;if(a){if(i){if(t.queryHash!==oS(a,t.options))return!1}else if(!Sd(t.queryKey,a))return!1}if(n!=="all"){const l=t.isActive();if(n==="active"&&!l||n==="inactive"&&l)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||s&&s!==t.state.fetchStatus||r&&!r(t))}function ST(e,t){const{exact:n,status:i,predicate:s,mutationKey:r}=e;if(r){if(!t.options.mutationKey)return!1;if(n){if(ja(t.options.mutationKey)!==ja(r))return!1}else if(!Sd(t.options.mutationKey,r))return!1}return!(i&&t.state.status!==i||s&&!s(t))}function oS(e,t){return(t?.queryKeyHashFn||ja)(e)}function ja(e){return JSON.stringify(e,(t,n)=>O_(n)?Object.keys(n).sort().reduce((i,s)=>(i[s]=n[s],i),{}):n)}function Sd(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>Sd(e[n],t[n])):!1}var S4=Object.prototype.hasOwnProperty;function PL(e,t,n=0){if(e===t)return e;if(n>500)return t;const i=CT(e)&&CT(t);if(!i&&!(O_(e)&&O_(t)))return t;const r=(i?e:Object.keys(e)).length,a=i?t:Object.keys(t),o=a.length,l=i?new Array(o):{};let u=0;for(let h=0;h<o;h++){const f=i?h:a[h],m=e[f],g=t[f];if(m===g){l[f]=m,(i?h<r:S4.call(e,f))&&u++;continue}if(m===null||g===null||typeof m!="object"||typeof g!="object"){l[f]=g;continue}const C=PL(m,g,n+1);l[f]=C,C===m&&u++}return r===o&&u===r?e:l}function Up(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function CT(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function O_(e){if(!xT(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!xT(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function xT(e){return Object.prototype.toString.call(e)==="[object Object]"}function C4(e){return new Promise(t=>{ka.setTimeout(t,e)})}function N_(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?PL(e,t):t}function x4(e,t,n=0){const i=[...e,t];return n&&i.length>n?i.slice(1):i}function w4(e,t,n=0){const i=[t,...e];return n&&i.length>n?i.slice(0,-1):i}var aS=Symbol();function DL(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===aS?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function lS(e,t){return typeof e=="function"?e(...t):!!e}function k4(e,t,n){let i=!1,s;return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(s??=t(),i||(i=!0,s.aborted?n():s.addEventListener("abort",n,{once:!0})),s)}),e}var T4=class extends Ac{#e;#t;#n;constructor(){super(),this.#n=e=>{if(!Na&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#n=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},cS=new T4;function j_(){let e,t;const n=new Promise((s,r)=>{e=s,t=r});n.status="pending",n.catch(()=>{});function i(s){Object.assign(n,s),delete n.resolve,delete n.reject}return n.resolve=s=>{i({status:"fulfilled",value:s}),e(s)},n.reject=s=>{i({status:"rejected",reason:s}),t(s)},n}var E4=y4;function R4(){let e=[],t=0,n=o=>{o()},i=o=>{o()},s=E4;const r=o=>{t?e.push(o):s(()=>{n(o)})},a=()=>{const o=e;e=[],o.length&&s(()=>{i(()=>{o.forEach(l=>{n(l)})})})};return{batch:o=>{let l;t++;try{l=o()}finally{t--,t||a()}return l},batchCalls:o=>(...l)=>{r(()=>{o(...l)})},schedule:r,setNotifyFunction:o=>{n=o},setBatchNotifyFunction:o=>{i=o},setScheduler:o=>{s=o}}}var _n=R4(),A4=class extends Ac{#e=!0;#t;#n;constructor(){super(),this.#n=e=>{if(!Na&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#n=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(n=>{n(e)}))}isOnline(){return this.#e}},zp=new A4;function M4(e){return Math.min(1e3*2**e,3e4)}function OL(e){return(e??"online")==="online"?zp.isOnline():!0}var B_=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function NL(e){let t=!1,n=0,i;const s=j_(),r=()=>s.status!=="pending",a=S=>{if(!r()){const v=new B_(S);m(v),e.onCancel?.(v)}},o=()=>{t=!0},l=()=>{t=!1},u=()=>cS.isFocused()&&(e.networkMode==="always"||zp.isOnline())&&e.canRun(),h=()=>OL(e.networkMode)&&e.canRun(),f=S=>{r()||(i?.(),s.resolve(S))},m=S=>{r()||(i?.(),s.reject(S))},g=()=>new Promise(S=>{i=v=>{(r()||u())&&S(v)},e.onPause?.()}).then(()=>{i=void 0,r()||e.onContinue?.()}),C=()=>{if(r())return;let S;const v=n===0?e.initialPromise:void 0;try{S=v??e.fn()}catch(_){S=Promise.reject(_)}Promise.resolve(S).then(f).catch(_=>{if(r())return;const w=e.retry??(Na?0:3),x=e.retryDelay??M4,k=typeof x=="function"?x(n,_):x,A=w===!0||typeof w=="number"&&n<w||typeof w=="function"&&w(n,_);if(t||!A){m(_);return}n++,e.onFail?.(n,_),C4(k).then(()=>u()?void 0:g()).then(()=>{t?m(_):C()})})};return{promise:s,status:()=>s.status,cancel:a,continue:()=>(i?.(),s),cancelRetry:o,continueRetry:l,canStart:h,start:()=>(h()?C():g().then(C),s)}}var jL=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),D_(this.gcTime)&&(this.#e=ka.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Na?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ka.clearTimeout(this.#e),this.#e=void 0)}},L4=class extends jL{#e;#t;#n;#s;#i;#r;#a;constructor(e){super(),this.#a=!1,this.#r=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=kT(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(e){if(this.options={...this.#r,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=kT(this.options);t.data!==void 0&&(this.setState(wT(t.data,t.dataUpdatedAt)),this.#e=t)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,t){const n=N_(this.state.data,e,this.options);return this.#o({data:n,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),n}setState(e,t){this.#o({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#i?.promise;return this.#i?.cancel(e),t?t.then(Xn).catch(Xn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Yi(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===aS||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Ro(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!IL(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#i&&(this.#a?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#o({type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(e&&this.setOptions(e),!this.options.queryFn){const o=this.observers.find(l=>l.options.queryFn);o&&this.setOptions(o.options)}const n=new AbortController,i=o=>{Object.defineProperty(o,"signal",{enumerable:!0,get:()=>(this.#a=!0,n.signal)})},s=()=>{const o=DL(this.options,t),u=(()=>{const h={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(h),h})();return this.#a=!1,this.options.persister?this.options.persister(o,u,this):o(u)},a=(()=>{const o={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:s};return i(o),o})();this.options.behavior?.onFetch(a,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==a.fetchOptions?.meta)&&this.#o({type:"fetch",meta:a.fetchOptions?.meta}),this.#i=NL({initialPromise:t?.initialPromise,fn:a.fetchFn,onCancel:o=>{o instanceof B_&&o.revert&&this.setState({...this.#t,fetchStatus:"idle"}),n.abort()},onFail:(o,l)=>{this.#o({type:"failed",failureCount:o,error:l})},onPause:()=>{this.#o({type:"pause"})},onContinue:()=>{this.#o({type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0});try{const o=await this.#i.start();if(o===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(o),this.#n.config.onSuccess?.(o,this),this.#n.config.onSettled?.(o,this.state.error,this),o}catch(o){if(o instanceof B_){if(o.silent)return this.#i.promise;if(o.revert){if(this.state.data===void 0)throw o;return this.state.data}}throw this.#o({type:"error",error:o}),this.#n.config.onError?.(o,this),this.#n.config.onSettled?.(this.state.data,o,this),o}finally{this.scheduleGc()}}#o(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...BL(n.data,this.options),fetchMeta:e.meta??null};case"success":const i={...n,...wT(e.data,e.dataUpdatedAt),dataUpdateCount:n.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const s=e.error;return{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),_n.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function BL(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:OL(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function wT(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function kT(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,i=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var I4=class extends Ac{constructor(e,t){super(),this.options=t,this.#e=e,this.#o=null,this.#a=j_(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#n=void 0;#s=void 0;#i;#r;#a;#o;#m;#h;#f;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),TT(this.#t,this.options)?this.#d():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return F_(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return F_(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#_(),this.#S(),this.#t.removeObserver(this)}setOptions(e){const t=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Yi(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#C(),this.#t.setOptions(this.options),t._defaulted&&!Up(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const i=this.hasListeners();i&&ET(this.#t,n,this.options,t)&&this.#d(),this.updateResult(),i&&(this.#t!==n||Yi(this.options.enabled,this.#t)!==Yi(t.enabled,this.#t)||Ro(this.options.staleTime,this.#t)!==Ro(t.staleTime,this.#t))&&this.#g();const s=this.#v();i&&(this.#t!==n||Yi(this.options.enabled,this.#t)!==Yi(t.enabled,this.#t)||s!==this.#l)&&this.#b(s)}getOptimisticResult(e){const t=this.#e.getQueryCache().build(this.#e,e),n=this.createResult(t,e);return D4(this,n)&&(this.#s=n,this.#r=this.options,this.#i=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(e,t){return new Proxy(e,{get:(n,i)=>(this.trackProp(i),t?.(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,i))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#e.defaultQueryOptions(e),n=this.#e.getQueryCache().build(this.#e,t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return this.#d({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(e){this.#C();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch(Xn)),t}#g(){this.#_();const e=Ro(this.options.staleTime,this.#t);if(Na||this.#s.isStale||!D_(e))return;const n=IL(this.#s.dataUpdatedAt,e)+1;this.#c=ka.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#v(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#b(e){this.#S(),this.#l=e,!(Na||Yi(this.options.enabled,this.#t)===!1||!D_(this.#l)||this.#l===0)&&(this.#u=ka.setInterval(()=>{(this.options.refetchIntervalInBackground||cS.isFocused())&&this.#d()},this.#l))}#y(){this.#g(),this.#b(this.#v())}#_(){this.#c&&(ka.clearTimeout(this.#c),this.#c=void 0)}#S(){this.#u&&(ka.clearInterval(this.#u),this.#u=void 0)}createResult(e,t){const n=this.#t,i=this.options,s=this.#s,r=this.#i,a=this.#r,l=e!==n?e.state:this.#n,{state:u}=e;let h={...u},f=!1,m;if(t._optimisticResults){const E=this.hasListeners(),L=!E&&TT(e,t),D=E&&ET(e,n,t,i);(L||D)&&(h={...h,...BL(u.data,e.options)}),t._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:g,errorUpdatedAt:C,status:S}=h;m=h.data;let v=!1;if(t.placeholderData!==void 0&&m===void 0&&S==="pending"){let E;s?.isPlaceholderData&&t.placeholderData===a?.placeholderData?(E=s.data,v=!0):E=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,E!==void 0&&(S="success",m=N_(s?.data,E,t),f=!0)}if(t.select&&m!==void 0&&!v)if(s&&m===r?.data&&t.select===this.#m)m=this.#h;else try{this.#m=t.select,m=t.select(m),m=N_(s?.data,m,t),this.#h=m,this.#o=null}catch(E){this.#o=E}this.#o&&(g=this.#o,m=this.#h,C=Date.now(),S="error");const _=h.fetchStatus==="fetching",w=S==="pending",x=S==="error",k=w&&_,A=m!==void 0,M={status:S,fetchStatus:h.fetchStatus,isPending:w,isSuccess:S==="success",isError:x,isInitialLoading:k,isLoading:k,data:m,dataUpdatedAt:h.dataUpdatedAt,error:g,errorUpdatedAt:C,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>l.dataUpdateCount||h.errorUpdateCount>l.errorUpdateCount,isFetching:_,isRefetching:_&&!w,isLoadingError:x&&!A,isPaused:h.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:x&&A,isStale:uS(e,t),refetch:this.refetch,promise:this.#a,isEnabled:Yi(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const E=M.data!==void 0,L=M.status==="error"&&!E,D=U=>{L?U.reject(M.error):E&&U.resolve(M.data)},O=()=>{const U=this.#a=M.promise=j_();D(U)},j=this.#a;switch(j.status){case"pending":e.queryHash===n.queryHash&&D(j);break;case"fulfilled":(L||M.data!==j.value)&&O();break;case"rejected":(!L||M.error!==j.reason)&&O();break}}return M}updateResult(){const e=this.#s,t=this.createResult(this.#t,this.options);if(this.#i=this.#t.state,this.#r=this.options,this.#i.data!==void 0&&(this.#f=this.#t),Up(t,e))return;this.#s=t;const n=()=>{if(!e)return!0;const{notifyOnChangeProps:i}=this.options,s=typeof i=="function"?i():i;if(s==="all"||!s&&!this.#p.size)return!0;const r=new Set(s??this.#p);return this.options.throwOnError&&r.add("error"),Object.keys(this.#s).some(a=>{const o=a;return this.#s[o]!==e[o]&&r.has(o)})};this.#x({listeners:n()})}#C(){const e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;const t=this.#t;this.#t=e,this.#n=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#x(e){_n.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function P4(e,t){return Yi(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function TT(e,t){return P4(e,t)||e.state.data!==void 0&&F_(e,t,t.refetchOnMount)}function F_(e,t,n){if(Yi(t.enabled,e)!==!1&&Ro(t.staleTime,e)!=="static"){const i=typeof n=="function"?n(e):n;return i==="always"||i!==!1&&uS(e,t)}return!1}function ET(e,t,n,i){return(e!==t||Yi(i.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&uS(e,n)}function uS(e,t){return Yi(t.enabled,e)!==!1&&e.isStaleByTime(Ro(t.staleTime,e))}function D4(e,t){return!Up(e.getCurrentResult(),t)}function RT(e){return{onFetch:(t,n)=>{const i=t.options,s=t.fetchOptions?.meta?.fetchMore?.direction,r=t.state.data?.pages||[],a=t.state.data?.pageParams||[];let o={pages:[],pageParams:[]},l=0;const u=async()=>{let h=!1;const f=C=>{k4(C,()=>t.signal,()=>h=!0)},m=DL(t.options,t.fetchOptions),g=async(C,S,v)=>{if(h)return Promise.reject();if(S==null&&C.pages.length)return Promise.resolve(C);const w=(()=>{const T={client:t.client,queryKey:t.queryKey,pageParam:S,direction:v?"backward":"forward",meta:t.options.meta};return f(T),T})(),x=await m(w),{maxPages:k}=t.options,A=v?w4:x4;return{pages:A(C.pages,x,k),pageParams:A(C.pageParams,S,k)}};if(s&&r.length){const C=s==="backward",S=C?O4:AT,v={pages:r,pageParams:a},_=S(i,v);o=await g(v,_,C)}else{const C=e??r.length;do{const S=l===0?a[0]??i.initialPageParam:AT(i,o);if(l>0&&S==null)break;o=await g(o,S),l++}while(l<C)}return o};t.options.persister?t.fetchFn=()=>t.options.persister?.(u,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n):t.fetchFn=u}}}function AT(e,{pages:t,pageParams:n}){const i=t.length-1;return t.length>0?e.getNextPageParam(t[i],t,n[i],n):void 0}function O4(e,{pages:t,pageParams:n}){return t.length>0?e.getPreviousPageParam?.(t[0],t,n[0],n):void 0}var N4=class extends jL{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||FL(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(t=>t!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#i({type:"continue"})},n={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=NL({fn:()=>this.options.mutationFn?this.options.mutationFn(e,n):Promise.reject(new Error("No mutationFn found")),onFail:(r,a)=>{this.#i({type:"failed",failureCount:r,error:a})},onPause:()=>{this.#i({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",s=!this.#s.canStart();try{if(i)t();else{this.#i({type:"pending",variables:e,isPaused:s}),this.#n.config.onMutate&&await this.#n.config.onMutate(e,this,n);const a=await this.options.onMutate?.(e,n);a!==this.state.context&&this.#i({type:"pending",context:a,variables:e,isPaused:s})}const r=await this.#s.start();return await this.#n.config.onSuccess?.(r,e,this.state.context,this,n),await this.options.onSuccess?.(r,e,this.state.context,n),await this.#n.config.onSettled?.(r,null,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(r,null,e,this.state.context,n),this.#i({type:"success",data:r}),r}catch(r){try{await this.#n.config.onError?.(r,e,this.state.context,this,n)}catch(a){Promise.reject(a)}try{await this.options.onError?.(r,e,this.state.context,n)}catch(a){Promise.reject(a)}try{await this.#n.config.onSettled?.(void 0,r,this.state.variables,this.state.context,this,n)}catch(a){Promise.reject(a)}try{await this.options.onSettled?.(void 0,r,e,this.state.context,n)}catch(a){Promise.reject(a)}throw this.#i({type:"error",error:r}),r}finally{this.#n.runNext(this)}}#i(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),_n.batch(()=>{this.#t.forEach(n=>{n.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function FL(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var j4=class extends Ac{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(e,t,n){const i=new N4({client:e,mutationCache:this,mutationId:++this.#n,options:e.defaultMutationOptions(t),state:n});return this.add(i),i}add(e){this.#e.add(e);const t=Af(e);if(typeof t=="string"){const n=this.#t.get(t);n?n.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=Af(e);if(typeof t=="string"){const n=this.#t.get(t);if(n)if(n.length>1){const i=n.indexOf(e);i!==-1&&n.splice(i,1)}else n[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Af(e);if(typeof t=="string"){const i=this.#t.get(t)?.find(s=>s.state.status==="pending");return!i||i===e}else return!0}runNext(e){const t=Af(e);return typeof t=="string"?this.#t.get(t)?.find(i=>i!==e&&i.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){_n.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(n=>ST(t,n))}findAll(e={}){return this.getAll().filter(t=>ST(e,t))}notify(e){_n.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return _n.batch(()=>Promise.all(e.map(t=>t.continue().catch(Xn))))}};function Af(e){return e.options.scope?.id}var B4=class extends Ac{#e;#t=void 0;#n;#s;constructor(t,n){super(),this.#e=t,this.setOptions(n),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const n=this.options;this.options=this.#e.defaultMutationOptions(t),Up(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&ja(n.mutationKey)!==ja(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#r(t)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#i(),this.#r()}mutate(t,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(t)}#i(){const t=this.#n?.state??FL();this.#t={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#r(t){_n.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,i=this.#t.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(t?.type==="success"){try{this.#s.onSuccess?.(t.data,n,i,s)}catch(r){Promise.reject(r)}try{this.#s.onSettled?.(t.data,null,n,i,s)}catch(r){Promise.reject(r)}}else if(t?.type==="error"){try{this.#s.onError?.(t.error,n,i,s)}catch(r){Promise.reject(r)}try{this.#s.onSettled?.(void 0,t.error,n,i,s)}catch(r){Promise.reject(r)}}}this.listeners.forEach(n=>{n(this.#t)})})}},F4=class extends Ac{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,n){const i=t.queryKey,s=t.queryHash??oS(i,t);let r=this.get(s);return r||(r=new L4({client:e,queryKey:i,queryHash:s,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(i)}),this.add(r)),r}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){_n.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>_T(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>_T(e,n)):t}notify(e){_n.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){_n.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){_n.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},U4=class{#e;#t;#n;#s;#i;#r;#a;#o;constructor(e={}){this.#e=e.queryCache||new F4,this.#t=e.mutationCache||new j4,this.#n=e.defaultOptions||{},this.#s=new Map,this.#i=new Map,this.#r=0}mount(){this.#r++,this.#r===1&&(this.#a=cS.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#o=zp.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#r--,this.#r===0&&(this.#a?.(),this.#a=void 0,this.#o?.(),this.#o=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=this.#e.build(this,t),i=n.state.data;return i===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Ro(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(i))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:n})=>{const i=n.data;return[t,i]})}setQueryData(e,t,n){const i=this.defaultQueryOptions({queryKey:e}),r=this.#e.get(i.queryHash)?.state.data,a=_4(t,r);if(a!==void 0)return this.#e.build(this,i).setData(a,{...n,manual:!0})}setQueriesData(e,t,n){return _n.batch(()=>this.#e.findAll(e).map(({queryKey:i})=>[i,this.setQueryData(i,t,n)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;_n.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=this.#e;return _n.batch(()=>(n.findAll(e).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},i=_n.batch(()=>this.#e.findAll(e).map(s=>s.cancel(n)));return Promise.all(i).then(Xn).catch(Xn)}invalidateQueries(e,t={}){return _n.batch(()=>(this.#e.findAll(e).forEach(n=>{n.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},i=_n.batch(()=>this.#e.findAll(e).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let r=s.fetch(void 0,n);return n.throwOnError||(r=r.catch(Xn)),s.state.fetchStatus==="paused"?Promise.resolve():r}));return Promise.all(i).then(Xn)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=this.#e.build(this,t);return n.isStaleByTime(Ro(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Xn).catch(Xn)}fetchInfiniteQuery(e){return e.behavior=RT(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Xn).catch(Xn)}ensureInfiniteQueryData(e){return e.behavior=RT(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return zp.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(e){this.#n=e}setQueryDefaults(e,t){this.#s.set(ja(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#s.values()],n={};return t.forEach(i=>{Sd(e,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(e,t){this.#i.set(ja(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#i.values()],n={};return t.forEach(i=>{Sd(e,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#n.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=oS(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===aS&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#n.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},UL=P.createContext(void 0),Fr=e=>{const t=P.useContext(UL);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},z4=({client:e,children:t})=>(P.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),b.jsx(UL.Provider,{value:e,children:t})),zL=P.createContext(!1),H4=()=>P.useContext(zL);zL.Provider;function $4(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var q4=P.createContext($4()),V4=()=>P.useContext(q4),W4=(e,t,n)=>{const i=n?.state.error&&typeof e.throwOnError=="function"?lS(e.throwOnError,[n.state.error,n]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||i)&&(t.isReset()||(e.retryOnMount=!1))},G4=e=>{P.useEffect(()=>{e.clearReset()},[e])},K4=({result:e,errorResetBoundary:t,throwOnError:n,query:i,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&i&&(s&&e.data===void 0||lS(n,[e.error,i])),Y4=e=>{if(e.suspense){const n=s=>s==="static"?s:Math.max(s??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...s)=>n(i(...s)):n(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Q4=(e,t)=>e.isLoading&&e.isFetching&&!t,J4=(e,t)=>e?.suspense&&t.isPending,MT=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function X4(e,t,n){const i=H4(),s=V4(),r=Fr(),a=r.defaultQueryOptions(e);r.getDefaultOptions().queries?._experimental_beforeQuery?.(a);const o=r.getQueryCache().get(a.queryHash);a._optimisticResults=i?"isRestoring":"optimistic",Y4(a),W4(a,s,o),G4(s);const l=!r.getQueryCache().get(a.queryHash),[u]=P.useState(()=>new t(r,a)),h=u.getOptimisticResult(a),f=!i&&e.subscribed!==!1;if(P.useSyncExternalStore(P.useCallback(m=>{const g=f?u.subscribe(_n.batchCalls(m)):Xn;return u.updateResult(),g},[u,f]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),P.useEffect(()=>{u.setOptions(a)},[a,u]),J4(a,h))throw MT(a,u,s);if(K4({result:h,errorResetBoundary:s,throwOnError:a.throwOnError,query:o,suspense:a.suspense}))throw h.error;return r.getDefaultOptions().queries?._experimental_afterQuery?.(a,h),a.experimental_prefetchInRender&&!Na&&Q4(h,i)&&(l?MT(a,u,s):o?.promise)?.catch(Xn).finally(()=>{u.updateResult()}),a.notifyOnChangeProps?h:u.trackResult(h)}function Ws(e,t){return X4(e,I4)}function Tr(e,t){const n=Fr(),[i]=P.useState(()=>new B4(n,e));P.useEffect(()=>{i.setOptions(e)},[i,e]);const s=P.useSyncExternalStore(P.useCallback(a=>i.subscribe(_n.batchCalls(a)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),r=P.useCallback((a,o)=>{i.mutate(a,o).catch(Xn)},[i]);if(s.error&&lS(i.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:r,mutateAsync:s.mutate}}const Z4="modulepreload",eF=function(e){return"/"+e},LT={},Tt=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){let u=function(h){return Promise.all(h.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};var a=u;document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");s=u(n.map(h=>{if(h=eF(h),h in LT)return;LT[h]=!0;const f=h.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":Z4,f||(g.as="script"),g.crossOrigin="",g.href=h,l&&g.setAttribute("nonce",l),document.head.appendChild(g),f)return new Promise((C,S)=>{g.addEventListener("load",C),g.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${h}`)))})}))}function r(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&r(l.reason);return t().catch(r)})};var Gt=(e=>(e[e.None=0]="None",e[e.Mutable=1]="Mutable",e[e.Watching=2]="Watching",e[e.RecursedCheck=4]="RecursedCheck",e[e.Recursed=8]="Recursed",e[e.Dirty=16]="Dirty",e[e.Pending=32]="Pending",e))(Gt||{});function HL({update:e,notify:t,unwatched:n}){return{link:i,unlink:s,propagate:r,checkDirty:a,shallowPropagate:o};function i(u,h,f){const m=h.depsTail;if(m!==void 0&&m.dep===u)return;const g=m!==void 0?m.nextDep:h.deps;if(g!==void 0&&g.dep===u){g.version=f,h.depsTail=g;return}const C=u.subsTail;if(C!==void 0&&C.version===f&&C.sub===h)return;const S=h.depsTail=u.subsTail={version:f,dep:u,sub:h,prevDep:m,nextDep:g,prevSub:C,nextSub:void 0};g!==void 0&&(g.prevDep=S),m!==void 0?m.nextDep=S:h.deps=S,C!==void 0?C.nextSub=S:u.subs=S}function s(u,h=u.sub){const f=u.dep,m=u.prevDep,g=u.nextDep,C=u.nextSub,S=u.prevSub;return g!==void 0?g.prevDep=m:h.depsTail=m,m!==void 0?m.nextDep=g:h.deps=g,C!==void 0?C.prevSub=S:f.subsTail=S,S!==void 0?S.nextSub=C:(f.subs=C)===void 0&&n(f),g}function r(u){let h=u.nextSub,f;e:do{const m=u.sub;let g=m.flags;if(g&60?g&12?g&4?!(g&48)&&l(u,m)?(m.flags=g|40,g&=1):g=0:m.flags=g&-9|32:g=0:m.flags=g|32,g&2&&t(m),g&1){const C=m.subs;if(C!==void 0){const S=(u=C).nextSub;S!==void 0&&(f={value:h,prev:f},h=S);continue}}if((u=h)!==void 0){h=u.nextSub;continue}for(;f!==void 0;)if(u=f.value,f=f.prev,u!==void 0){h=u.nextSub;continue e}break}while(!0)}function a(u,h){let f,m=0,g=!1;e:do{const C=u.dep,S=C.flags;if(h.flags&16)g=!0;else if((S&17)===17){if(e(C)){const v=C.subs;v.nextSub!==void 0&&o(v),g=!0}}else if((S&33)===33){(u.nextSub!==void 0||u.prevSub!==void 0)&&(f={value:u,prev:f}),u=C.deps,h=C,++m;continue}if(!g){const v=u.nextDep;if(v!==void 0){u=v;continue}}for(;m--;){const v=h.subs,_=v.nextSub!==void 0;if(_?(u=f.value,f=f.prev):u=v,g){if(e(h)){_&&o(v),h=u.sub;continue}g=!1}else h.flags&=-33;h=u.sub;const w=u.nextDep;if(w!==void 0){u=w;continue e}}return g}while(!0)}function o(u){do{const h=u.sub,f=h.flags;(f&48)===32&&(h.flags=f|16,(f&6)===2&&t(h))}while((u=u.nextSub)!==void 0)}function l(u,h){let f=h.depsTail;for(;f!==void 0;){if(f===u)return!0;f=f.prevDep}return!1}}let dS=0,ua=0,nd=0;const Mr=[],{link:Xfe,unlink:$L,propagate:Zfe,checkDirty:tF,shallowPropagate:epe}=HL({update(e){return e.depsTail!==void 0?rF(e):oF(e)},notify(e){let t=nd,n=t;do if(Mr[t++]=e,e.flags&=-3,e=e.subs?.sub,e===void 0||!(e.flags&2))break;while(!0);for(nd=t;n<--t;){const i=Mr[n];Mr[n++]=Mr[t],Mr[t]=i}},unwatched(e){e.flags&1?e.depsTail!==void 0&&(e.depsTail=void 0,e.flags=17,Hm(e)):cF.call(e)}});function nF(){return dS}function iF(){++dS}function sF(){--dS||lF()}function rF(e){e.depsTail=void 0,e.flags=5;try{const t=e.value;return t!==(e.value=e.getter(t))}finally{e.flags&=-5,Hm(e)}}function oF(e){return e.flags=1,e.currentValue!==(e.currentValue=e.pendingValue)}function aF(e){const t=e.flags;if(t&16||t&32&&tF(e.deps,e)){e.depsTail=void 0,e.flags=6;try{e.fn()}finally{e.flags&=-5,Hm(e)}}else e.flags=2}function lF(){try{for(;ua<nd;){const e=Mr[ua];Mr[ua++]=void 0,aF(e)}}finally{for(;ua<nd;){const e=Mr[ua];Mr[ua++]=void 0,e.flags|=10}ua=0,nd=0}}function cF(){this.depsTail=void 0,this.flags=0,Hm(this);const e=this.subs;e!==void 0&&$L(e)}function Hm(e){const t=e.depsTail;let n=t!==void 0?t.nextDep:e.deps;for(;n!==void 0;)n=$L(n,e)}function qL(e,t,n){const i=typeof e=="object",s=i?e:void 0;return{next:(i?e.next:e)?.bind(s),error:(i?e.error:t)?.bind(s),complete:(i?e.complete:n)?.bind(s)}}const U_=[];let dp=0;const{link:IT,unlink:uF,propagate:dF,checkDirty:VL,shallowPropagate:PT}=HL({update(e){return e._update()},notify(e){U_[z_++]=e,e.flags&=~Gt.Watching},unwatched(e){e.depsTail!==void 0&&(e.depsTail=void 0,e.flags=Gt.Mutable|Gt.Dirty,Hp(e))}});let Mf=0,z_=0,Fs;function Hp(e){const t=e.depsTail;let n=t!==void 0?t.nextDep:e.deps;for(;n!==void 0;)n=uF(n,e)}function WL(){if(!(nF()>0)){for(;Mf<z_;){const e=U_[Mf];U_[Mf++]=void 0,e.notify()}Mf=0,z_=0}}function hF(e,t){const n=typeof e=="function",i=e,s={_snapshot:n?void 0:e,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:n?Gt.None:Gt.Mutable,get(){return Fs!==void 0&&IT(s,Fs,dp),s._snapshot},subscribe(r){const a=qL(r),o={current:!1},l=fF(()=>{s.get(),o.current?a.next?.(s._snapshot):o.current=!0});return{unsubscribe:()=>{l.stop()}}},_update(r){const a=Fs,o=Object.is;Fs=s,++dp,s.depsTail=void 0,n&&(s.flags=Gt.Mutable|Gt.RecursedCheck);try{const l=s._snapshot,u=typeof r=="function"?r(l):r===void 0&&n?i(l):r;return l===void 0||!o(l,u)?(s._snapshot=u,!0):!1}finally{Fs=a,n&&(s.flags&=~Gt.RecursedCheck),Hp(s)}}};return n?(s.flags=Gt.Mutable|Gt.Dirty,s.get=function(){const r=s.flags;if(r&Gt.Dirty||r&Gt.Pending&&VL(s.deps,s)){if(s._update()){const a=s.subs;a!==void 0&&PT(a)}}else r&Gt.Pending&&(s.flags=r&~Gt.Pending);return Fs!==void 0&&IT(s,Fs,dp),s._snapshot}):s.set=function(r){if(s._update(r)){const a=s.subs;a!==void 0&&(dF(a),PT(a),WL())}},s}function fF(e){const t=()=>{const i=Fs;Fs=n,++dp,n.depsTail=void 0,n.flags=Gt.Watching|Gt.RecursedCheck;try{return e()}finally{Fs=i,n.flags&=~Gt.RecursedCheck,Hp(n)}},n={deps:void 0,depsTail:void 0,subs:void 0,subsTail:void 0,flags:Gt.Watching|Gt.RecursedCheck,notify(){const i=this.flags;i&Gt.Dirty||i&Gt.Pending&&VL(this.deps,this)?t():this.flags=Gt.Watching},stop(){this.flags=Gt.None,this.depsTail=void 0,Hp(this)}};return t(),n}class pF{constructor(t){this.atom=hF(t)}setState(t){this.atom.set(t)}get state(){return this.atom.get()}get(){return this.state}subscribe(t){return this.atom.subscribe(qL(t))}}function mF(e){try{iF(),e()}finally{sF(),WL()}}const Ao="__TSR_index",DT="popstate",OT="beforeunload";function GL(e){let t=e.getLocation();const n=new Set,i=a=>{t=e.getLocation(),n.forEach(o=>o({location:t,action:a}))},s=a=>{e.notifyOnIndexChange??!0?i(a):t=e.getLocation()},r=async({task:a,navigateOpts:o,...l})=>{if(o?.ignoreBlocker??!1){a();return}const h=e.getBlockers?.()??[],f=l.type==="PUSH"||l.type==="REPLACE";if(typeof document<"u"&&h.length&&f)for(const m of h){const g=Cd(l.path,l.state);if(await m.blockerFn({currentLocation:t,nextLocation:g,action:l.type})){e.onBlocked?.();return}}a()};return{get location(){return t},get length(){return e.getLength()},subscribers:n,subscribe:a=>(n.add(a),()=>{n.delete(a)}),push:(a,o,l)=>{const u=t.state[Ao];o=H_(u+1,o),r({task:()=>{e.pushState(a,o),i({type:"PUSH"})},navigateOpts:l,type:"PUSH",path:a,state:o})},replace:(a,o,l)=>{const u=t.state[Ao];o=H_(u,o),r({task:()=>{e.replaceState(a,o),i({type:"REPLACE"})},navigateOpts:l,type:"REPLACE",path:a,state:o})},go:(a,o)=>{r({task:()=>{e.go(a),s({type:"GO",index:a})},navigateOpts:o,type:"GO"})},back:a=>{r({task:()=>{e.back(a?.ignoreBlocker??!1),s({type:"BACK"})},navigateOpts:a,type:"BACK"})},forward:a=>{r({task:()=>{e.forward(a?.ignoreBlocker??!1),s({type:"FORWARD"})},navigateOpts:a,type:"FORWARD"})},canGoBack:()=>t.state[Ao]!==0,createHref:a=>e.createHref(a),block:a=>{if(!e.setBlockers)return()=>{};const o=e.getBlockers?.()??[];return e.setBlockers([...o,a]),()=>{const l=e.getBlockers?.()??[];e.setBlockers?.(l.filter(u=>u!==a))}},flush:()=>e.flush?.(),destroy:()=>e.destroy?.(),notify:i}}function H_(e,t){t||(t={});const n=hS();return{...t,key:n,__TSR_key:n,[Ao]:e}}function gF(e){const t=typeof document<"u"?window:void 0,n=t.history.pushState,i=t.history.replaceState;let s=[];const r=()=>s,a=E=>s=E,o=(E=>E),l=(()=>Cd(`${t.location.pathname}${t.location.search}${t.location.hash}`,t.history.state));if(!t.history.state?.__TSR_key&&!t.history.state?.key){const E=hS();t.history.replaceState({[Ao]:0,key:E,__TSR_key:E},"")}let u=l(),h,f=!1,m=!1,g=!1,C=!1;const S=()=>u;let v,_;const w=()=>{v&&(M._ignoreSubscribers=!0,(v.isPush?t.history.pushState:t.history.replaceState)(v.state,"",v.href),M._ignoreSubscribers=!1,v=void 0,_=void 0,h=void 0)},x=(E,L,D)=>{const O=o(L);_||(h=u),u=Cd(L,D),v={href:O,state:D,isPush:v?.isPush||E==="push"},_||(_=Promise.resolve().then(()=>w()))},k=E=>{u=l(),M.notify({type:E})},A=async()=>{if(m){m=!1;return}const E=l(),L=E.state[Ao]-u.state[Ao],D=L===1,O=L===-1,j=!D&&!O||f;f=!1;const U=j?"GO":O?"BACK":"FORWARD",q=j?{type:"GO",index:L}:{type:O?"BACK":"FORWARD"};if(g)g=!1;else{const K=r();if(typeof document<"u"&&K.length){for(const $ of K)if(await $.blockerFn({currentLocation:u,nextLocation:E,action:U})){m=!0,t.history.go(1),M.notify(q);return}}}u=l(),M.notify(q)},T=E=>{if(C){C=!1;return}let L=!1;const D=r();if(typeof document<"u"&&D.length)for(const O of D){const j=O.enableBeforeUnload??!0;if(j===!0){L=!0;break}if(typeof j=="function"&&j()===!0){L=!0;break}}if(L)return E.preventDefault(),E.returnValue=""},M=GL({getLocation:S,getLength:()=>t.history.length,pushState:(E,L)=>x("push",E,L),replaceState:(E,L)=>x("replace",E,L),back:E=>(E&&(g=!0),C=!0,t.history.back()),forward:E=>{E&&(g=!0),C=!0,t.history.forward()},go:E=>{f=!0,t.history.go(E)},createHref:E=>o(E),flush:w,destroy:()=>{t.history.pushState=n,t.history.replaceState=i,t.removeEventListener(OT,T,{capture:!0}),t.removeEventListener(DT,A)},onBlocked:()=>{h&&u!==h&&(u=h)},getBlockers:r,setBlockers:a,notifyOnIndexChange:!1});return t.addEventListener(OT,T,{capture:!0}),t.addEventListener(DT,A),t.history.pushState=function(...E){const L=n.apply(t.history,E);return M._ignoreSubscribers||k("PUSH"),L},t.history.replaceState=function(...E){const L=i.apply(t.history,E);return M._ignoreSubscribers||k("REPLACE"),L},M}function vF(e={initialEntries:["/"]}){const t=e.initialEntries;let n=e.initialIndex?Math.min(Math.max(e.initialIndex,0),t.length-1):t.length-1;const i=t.map((l,u)=>H_(u,void 0)),s=()=>Cd(t[n],i[n]);let r=[];return GL({getLocation:s,getLength:()=>t.length,pushState:(l,u)=>{n<t.length-1&&(t.splice(n+1),i.splice(n+1)),i.push(u),t.push(l),n=Math.max(t.length-1,0)},replaceState:(l,u)=>{i[n]=u,t[n]=l},back:()=>{n=Math.max(n-1,0)},forward:()=>{n=Math.min(n+1,t.length-1)},go:l=>{n=Math.min(Math.max(n+l,0),t.length-1)},createHref:l=>l,getBlockers:()=>r,setBlockers:l=>r=l})}function bF(e){let t=e.replace(/[\x00-\x1f\x7f]/g,"");return t.startsWith("//")&&(t="/"+t.replace(/^\/+/,"")),t}function Cd(e,t){const n=bF(e),i=n.indexOf("#"),s=n.indexOf("?"),r=hS();return{href:n,pathname:n.substring(0,i>0?s>0?Math.min(i,s):i:s>0?s:n.length),hash:i>-1?n.substring(i):"",search:s>-1?n.slice(s,i===-1?void 0:i):"",state:t||{[Ao]:0,key:r,__TSR_key:r}}}function hS(){return(Math.random()+1).toString(36).substring(7)}const yF=!1;function id(e){let t;return mF(()=>{t=e()}),t}function xd(e){return e[e.length-1]}function _F(e){return typeof e=="function"}function wo(e,t){return _F(e)?e(t):e}const SF=Object.prototype.hasOwnProperty,NT=Object.prototype.propertyIsEnumerable;function Mi(e,t,n=0){if(e===t)return e;if(n>500)return t;const i=t,s=FT(e)&&FT(i);if(!s&&!($p(e)&&$p(i)))return i;const r=s?e:jT(e);if(!r)return i;const a=s?i:jT(i);if(!a)return i;const o=r.length,l=a.length,u=s?new Array(l):{};let h=0;for(let f=0;f<l;f++){const m=s?f:a[f],g=e[m],C=i[m];if(g===C){u[m]=g,(s?f<o:SF.call(e,m))&&h++;continue}if(g===null||C===null||typeof g!="object"||typeof C!="object"){u[m]=C;continue}const S=Mi(g,C,n+1);u[m]=S,S===g&&h++}return o===l&&h===o?e:u}function jT(e){const t=Object.getOwnPropertyNames(e);for(const s of t)if(!NT.call(e,s))return!1;const n=Object.getOwnPropertySymbols(e);if(n.length===0)return t;const i=t;for(const s of n){if(!NT.call(e,s))return!1;i.push(s)}return i}function $p(e){if(!BT(e))return!1;const t=e.constructor;if(typeof t>"u")return!0;const n=t.prototype;return!(!BT(n)||!n.hasOwnProperty("isPrototypeOf"))}function BT(e){return Object.prototype.toString.call(e)==="[object Object]"}function FT(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function La(e,t,n){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let i=0,s=e.length;i<s;i++)if(!La(e[i],t[i],n))return!1;return!0}if($p(e)&&$p(t)){const i=n?.ignoreUndefined??!0;if(n?.partial){for(const a in t)if((!i||t[a]!==void 0)&&!La(e[a],t[a],n))return!1;return!0}let s=0;if(!i)s=Object.keys(e).length;else for(const a in e)e[a]!==void 0&&s++;let r=0;for(const a in t)if((!i||t[a]!==void 0)&&(r++,r>s||!La(e[a],t[a],n)))return!1;return s===r}return!1}function _c(e){let t,n;const i=new Promise((s,r)=>{t=s,n=r});return i.status="pending",i.resolve=s=>{i.status="resolved",i.value=s,t(s),e?.(s)},i.reject=s=>{i.status="rejected",n(s)},i}function lc(e){return!!(e&&typeof e=="object"&&typeof e.then=="function")}function CF(e){return e.replace(/[\x00-\x1f\x7f]/g,"")}function UT(e){let t;try{t=decodeURI(e)}catch{t=e.replaceAll(/%[0-9A-F]{2}/gi,n=>{try{return decodeURI(n)}catch{return n}})}return CF(t)}const xF=["http:","https:","mailto:","tel:"];function qp(e,t){if(!e)return!1;try{const n=new URL(e);return!t.has(n.protocol)}catch{return!1}}function Iu(e){if(!e)return{path:e,handledProtocolRelativeURL:!1};if(!/[%\\\x00-\x1f\x7f]/.test(e)&&!e.startsWith("//"))return{path:e,handledProtocolRelativeURL:!1};const t=/%25|%5C/gi;let n=0,i="",s;for(;(s=t.exec(e))!==null;)i+=UT(e.slice(n,s.index))+s[0],n=t.lastIndex;i=i+UT(n?e.slice(n):e);let r=!1;return i.startsWith("//")&&(r=!0,i="/"+i.replace(/^\/+/,"")),{path:i,handledProtocolRelativeURL:r}}function wF(e){return/\s|[^\u0000-\u007F]/.test(e)?e.replace(/\s|[^\u0000-\u007F]/gu,encodeURIComponent):e}var kF="Invariant failed";function Br(e,t){if(!e)throw new Error(kF)}function Vp(e){const t=new Map;let n,i;const s=r=>{r.next&&(r.prev?(r.prev.next=r.next,r.next.prev=r.prev,r.next=void 0,i&&(i.next=r,r.prev=i)):(r.next.prev=void 0,n=r.next,r.next=void 0,i&&(r.prev=i,i.next=r)),i=r)};return{get(r){const a=t.get(r);if(a)return s(a),a.value},set(r,a){if(t.size>=e&&n){const l=n;t.delete(l.key),l.next&&(n=l.next,l.next.prev=void 0),l===i&&(i=void 0)}const o=t.get(r);if(o)o.value=a,s(o);else{const l={key:r,value:a,prev:i};i&&(i.next=l),i=l,n||(n=l),t.set(r,l)}},clear(){t.clear(),n=void 0,i=void 0}}}const Sc=0,Ba=1,Fa=2,wd=3,Ta=4,KL=5;function TF(e){const t=e.indexOf("{");if(t===-1)return null;const n=e.indexOf("}",t);return n===-1||t+1>=e.length?null:[t,n]}function fS(e,t,n=new Uint16Array(6)){const i=e.indexOf("/",t),s=i===-1?e.length:i,r=e.substring(t,s);if(!r||!r.includes("$"))return n[0]=Sc,n[1]=t,n[2]=t,n[3]=s,n[4]=s,n[5]=s,n;if(r==="$"){const o=e.length;return n[0]=Fa,n[1]=t,n[2]=t,n[3]=o,n[4]=o,n[5]=o,n}if(r.charCodeAt(0)===36)return n[0]=Ba,n[1]=t,n[2]=t+1,n[3]=s,n[4]=s,n[5]=s,n;const a=TF(r);if(a){const[o,l]=a,u=r.charCodeAt(o+1);if(u===45){if(o+2<r.length&&r.charCodeAt(o+2)===36){const h=o+3,f=l;if(h<f)return n[0]=wd,n[1]=t+o,n[2]=t+h,n[3]=t+f,n[4]=t+l+1,n[5]=s,n}}else if(u===36){const h=o+1,f=o+2;return f===l?(n[0]=Fa,n[1]=t+o,n[2]=t+h,n[3]=t+f,n[4]=t+l+1,n[5]=e.length,n):(n[0]=Ba,n[1]=t+o,n[2]=t+f,n[3]=t+l,n[4]=t+l+1,n[5]=s,n)}}return n[0]=Sc,n[1]=t,n[2]=t,n[3]=s,n[4]=s,n[5]=s,n}function $m(e,t,n,i,s,r,a){a?.(n);let o=i;{const l=n.fullPath??n.from,u=l.length,h=n.options?.caseSensitive??e,f=!!(n.options?.params?.parse&&n.options?.skipRouteOnParseError?.params);for(;o<u;){const g=fS(l,o,t);let C;const S=o,v=g[5];switch(o=v+1,r++,g[0]){case Sc:{const w=l.substring(g[2],g[3]);if(h){const x=s.static?.get(w);if(x)C=x;else{s.static??=new Map;const k=Ea(n.fullPath??n.from);k.parent=s,k.depth=r,C=k,s.static.set(w,k)}}else{const x=w.toLowerCase(),k=s.staticInsensitive?.get(x);if(k)C=k;else{s.staticInsensitive??=new Map;const A=Ea(n.fullPath??n.from);A.parent=s,A.depth=r,C=A,s.staticInsensitive.set(x,A)}}break}case Ba:{const w=l.substring(S,g[1]),x=l.substring(g[4],v),k=h&&!!(w||x),A=w?k?w:w.toLowerCase():void 0,T=x?k?x:x.toLowerCase():void 0,M=!f&&s.dynamic?.find(E=>!E.skipOnParamError&&E.caseSensitive===k&&E.prefix===A&&E.suffix===T);if(M)C=M;else{const E=Vb(Ba,n.fullPath??n.from,k,A,T);C=E,E.depth=r,E.parent=s,s.dynamic??=[],s.dynamic.push(E)}break}case wd:{const w=l.substring(S,g[1]),x=l.substring(g[4],v),k=h&&!!(w||x),A=w?k?w:w.toLowerCase():void 0,T=x?k?x:x.toLowerCase():void 0,M=!f&&s.optional?.find(E=>!E.skipOnParamError&&E.caseSensitive===k&&E.prefix===A&&E.suffix===T);if(M)C=M;else{const E=Vb(wd,n.fullPath??n.from,k,A,T);C=E,E.parent=s,E.depth=r,s.optional??=[],s.optional.push(E)}break}case Fa:{const w=l.substring(S,g[1]),x=l.substring(g[4],v),k=h&&!!(w||x),A=w?k?w:w.toLowerCase():void 0,T=x?k?x:x.toLowerCase():void 0,M=Vb(Fa,n.fullPath??n.from,k,A,T);C=M,M.parent=s,M.depth=r,s.wildcard??=[],s.wildcard.push(M)}}s=C}if(f&&n.children&&!n.isRoot&&n.id&&n.id.charCodeAt(n.id.lastIndexOf("/")+1)===95){const g=Ea(n.fullPath??n.from);g.kind=KL,g.parent=s,r++,g.depth=r,s.pathless??=[],s.pathless.push(g),s=g}const m=(n.path||!n.children)&&!n.isRoot;if(m&&l.endsWith("/")){const g=Ea(n.fullPath??n.from);g.kind=Ta,g.parent=s,r++,g.depth=r,s.index=g,s=g}s.parse=n.options?.params?.parse??null,s.skipOnParamError=f,s.parsingPriority=n.options?.skipRouteOnParseError?.priority??0,m&&!s.route&&(s.route=n,s.fullPath=n.fullPath??n.from)}if(n.children)for(const l of n.children)$m(e,t,l,o,s,r,a)}function qb(e,t){if(e.skipOnParamError&&!t.skipOnParamError)return-1;if(!e.skipOnParamError&&t.skipOnParamError)return 1;if(e.skipOnParamError&&t.skipOnParamError&&(e.parsingPriority||t.parsingPriority))return t.parsingPriority-e.parsingPriority;if(e.prefix&&t.prefix&&e.prefix!==t.prefix){if(e.prefix.startsWith(t.prefix))return-1;if(t.prefix.startsWith(e.prefix))return 1}if(e.suffix&&t.suffix&&e.suffix!==t.suffix){if(e.suffix.endsWith(t.suffix))return-1;if(t.suffix.endsWith(e.suffix))return 1}return e.prefix&&!t.prefix?-1:!e.prefix&&t.prefix?1:e.suffix&&!t.suffix?-1:!e.suffix&&t.suffix?1:e.caseSensitive&&!t.caseSensitive?-1:!e.caseSensitive&&t.caseSensitive?1:0}function Co(e){if(e.pathless)for(const t of e.pathless)Co(t);if(e.static)for(const t of e.static.values())Co(t);if(e.staticInsensitive)for(const t of e.staticInsensitive.values())Co(t);if(e.dynamic?.length){e.dynamic.sort(qb);for(const t of e.dynamic)Co(t)}if(e.optional?.length){e.optional.sort(qb);for(const t of e.optional)Co(t)}if(e.wildcard?.length){e.wildcard.sort(qb);for(const t of e.wildcard)Co(t)}}function Ea(e){return{kind:Sc,depth:0,pathless:null,index:null,static:null,staticInsensitive:null,dynamic:null,optional:null,wildcard:null,route:null,fullPath:e,parent:null,parse:null,skipOnParamError:!1,parsingPriority:0}}function Vb(e,t,n,i,s){return{kind:e,depth:0,pathless:null,index:null,static:null,staticInsensitive:null,dynamic:null,optional:null,wildcard:null,route:null,fullPath:t,parent:null,parse:null,skipOnParamError:!1,parsingPriority:0,caseSensitive:n,prefix:i,suffix:s}}function EF(e,t){const n=Ea("/"),i=new Uint16Array(6);for(const s of e)$m(!1,i,s,1,n,0);Co(n),t.masksTree=n,t.flatCache=Vp(1e3)}function RF(e,t){e||="/";const n=t.flatCache.get(e);if(n)return n;const i=pS(e,t.masksTree);return t.flatCache.set(e,i),i}function AF(e,t,n,i,s){e||="/",i||="/";const r=t?`case\0${e}`:e;let a=s.singleCache.get(r);if(!a){a=Ea("/");const o=new Uint16Array(6);$m(t,o,{from:e},1,a,0),s.singleCache.set(r,a)}return pS(i,a,n)}function MF(e,t,n=!1){const i=n?e:`nofuzz\0${e}`,s=t.matchCache.get(i);if(s!==void 0)return s;e||="/";let r;try{r=pS(e,t.segmentTree,n)}catch(a){if(a instanceof URIError)r=null;else throw a}return r&&(r.branch=PF(r.route)),t.matchCache.set(i,r),r}function LF(e){return e==="/"?e:e.replace(/\/{1,}$/,"")}function IF(e,t=!1,n){const i=Ea(e.fullPath),s=new Uint16Array(6),r={},a={};let o=0;return $m(t,s,e,1,i,0,u=>{if(n?.(u,o),Br(!(u.id in r),`Duplicate routes found with id: ${String(u.id)}`),r[u.id]=u,o!==0&&u.path){const h=LF(u.fullPath);(!a[h]||u.fullPath.endsWith("/"))&&(a[h]=u)}o++}),Co(i),{processedTree:{segmentTree:i,singleCache:Vp(1e3),matchCache:Vp(1e3),flatCache:null,masksTree:null},routesById:r,routesByPath:a}}function pS(e,t,n=!1){const i=e.split("/"),s=OF(e,i,t,n);if(!s)return null;const[r]=YL(e,i,s);return{route:s.node.route,rawParams:r,parsedParams:s.parsedParams}}function YL(e,t,n){const i=DF(n.node);let s=null;const r={};let a=n.extract?.part??0,o=n.extract?.node??0,l=n.extract?.path??0,u=n.extract?.segment??0;for(;o<i.length;a++,o++,l++,u++){const h=i[o];if(h.kind===Ta)break;if(h.kind===KL){u--,a--,l--;continue}const f=t[a],m=l;if(f&&(l+=f.length),h.kind===Ba){s??=n.node.fullPath.split("/");const g=s[u],C=h.prefix?.length??0;if(g.charCodeAt(C)===123){const v=h.suffix?.length??0,_=g.substring(C+2,g.length-v-1),w=f.substring(C,f.length-v);r[_]=decodeURIComponent(w)}else{const v=g.substring(1);r[v]=decodeURIComponent(f)}}else if(h.kind===wd){if(n.skipped&1<<o){a--,l=m-1;continue}s??=n.node.fullPath.split("/");const g=s[u],C=h.prefix?.length??0,S=h.suffix?.length??0,v=g.substring(C+3,g.length-S-1),_=h.suffix||h.prefix?f.substring(C,f.length-S):f;_&&(r[v]=decodeURIComponent(_))}else if(h.kind===Fa){const g=h,C=e.substring(m+(g.prefix?.length??0),e.length-(g.suffix?.length??0)),S=decodeURIComponent(C);r["*"]=S,r._splat=S;break}}return n.rawParams&&Object.assign(r,n.rawParams),[r,{part:a,node:o,path:l,segment:u}]}function PF(e){const t=[e];for(;e.parentRoute;)e=e.parentRoute,t.push(e);return t.reverse(),t}function DF(e){const t=Array(e.depth+1);do t[e.depth]=e,e=e.parent;while(e);return t}function OF(e,t,n,i){if(e==="/"&&n.index)return{node:n.index,skipped:0};const s=!xd(t),r=s&&e!=="/",a=t.length-(s?1:0),o=[{node:n,index:1,skipped:0,depth:1,statics:1,dynamics:0,optionals:0}];let l=null,u=null,h=null;for(;o.length;){const f=o.pop(),{node:m,index:g,skipped:C,depth:S,statics:v,dynamics:_,optionals:w}=f;let{extract:x,rawParams:k,parsedParams:A}=f;if(m.skipOnParamError){if(!Wb(e,t,f))continue;k=f.rawParams,x=f.extract,A=f.parsedParams}i&&m.route&&m.kind!==Ta&&Pu(u,f)&&(u=f);const T=g===a;if(T&&(m.route&&!r&&Pu(h,f)&&(h=f),!m.optional&&!m.wildcard&&!m.index&&!m.pathless))continue;const M=T?void 0:t[g];let E;if(T&&m.index){const L={node:m.index,index:g,skipped:C,depth:S+1,statics:v,dynamics:_,optionals:w,extract:x,rawParams:k,parsedParams:A};let D=!0;if(m.index.skipOnParamError&&(Wb(e,t,L)||(D=!1)),D){if(v===a&&!_&&!w&&!C)return L;Pu(h,L)&&(h=L)}}if(m.wildcard&&Pu(l,f))for(const L of m.wildcard){const{prefix:D,suffix:O}=L;if(D&&(T||!(L.caseSensitive?M:E??=M.toLowerCase()).startsWith(D)))continue;if(O){if(T)continue;const U=t.slice(g).join("/").slice(-O.length);if((L.caseSensitive?U:U.toLowerCase())!==O)continue}const j={node:L,index:a,skipped:C,depth:S,statics:v,dynamics:_,optionals:w,extract:x,rawParams:k,parsedParams:A};if(!(L.skipOnParamError&&!Wb(e,t,j))){l=j;break}}if(m.optional){const L=C|1<<S,D=S+1;for(let O=m.optional.length-1;O>=0;O--){const j=m.optional[O];o.push({node:j,index:g,skipped:L,depth:D,statics:v,dynamics:_,optionals:w,extract:x,rawParams:k,parsedParams:A})}if(!T)for(let O=m.optional.length-1;O>=0;O--){const j=m.optional[O],{prefix:U,suffix:q}=j;if(U||q){const K=j.caseSensitive?M:E??=M.toLowerCase();if(U&&!K.startsWith(U)||q&&!K.endsWith(q))continue}o.push({node:j,index:g+1,skipped:C,depth:D,statics:v,dynamics:_,optionals:w+1,extract:x,rawParams:k,parsedParams:A})}}if(!T&&m.dynamic&&M)for(let L=m.dynamic.length-1;L>=0;L--){const D=m.dynamic[L],{prefix:O,suffix:j}=D;if(O||j){const U=D.caseSensitive?M:E??=M.toLowerCase();if(O&&!U.startsWith(O)||j&&!U.endsWith(j))continue}o.push({node:D,index:g+1,skipped:C,depth:S+1,statics:v,dynamics:_+1,optionals:w,extract:x,rawParams:k,parsedParams:A})}if(!T&&m.staticInsensitive){const L=m.staticInsensitive.get(E??=M.toLowerCase());L&&o.push({node:L,index:g+1,skipped:C,depth:S+1,statics:v+1,dynamics:_,optionals:w,extract:x,rawParams:k,parsedParams:A})}if(!T&&m.static){const L=m.static.get(M);L&&o.push({node:L,index:g+1,skipped:C,depth:S+1,statics:v+1,dynamics:_,optionals:w,extract:x,rawParams:k,parsedParams:A})}if(m.pathless){const L=S+1;for(let D=m.pathless.length-1;D>=0;D--){const O=m.pathless[D];o.push({node:O,index:g,skipped:C,depth:L,statics:v,dynamics:_,optionals:w,extract:x,rawParams:k,parsedParams:A})}}}if(h&&l)return Pu(l,h)?h:l;if(h)return h;if(l)return l;if(i&&u){let f=u.index;for(let g=0;g<u.index;g++)f+=t[g].length;const m=f===e.length?"/":e.slice(f);return u.rawParams??={},u.rawParams["**"]=decodeURIComponent(m),u}return null}function Wb(e,t,n){try{const[i,s]=YL(e,t,n);n.rawParams=i,n.extract=s;const r=n.node.parse(i);return n.parsedParams=Object.assign({},n.parsedParams,r),!0}catch{return null}}function Pu(e,t){return e?t.statics>e.statics||t.statics===e.statics&&(t.dynamics>e.dynamics||t.dynamics===e.dynamics&&(t.optionals>e.optionals||t.optionals===e.optionals&&((t.node.kind===Ta)>(e.node.kind===Ta)||t.node.kind===Ta==(e.node.kind===Ta)&&t.depth>e.depth))):!0}function hp(e){return mS(e.filter(t=>t!==void 0).join("/"))}function mS(e){return e.replace(/\/{2,}/g,"/")}function QL(e){return e==="/"?e:e.replace(/^\/{1,}/,"")}function Mo(e){const t=e.length;return t>1&&e[t-1]==="/"?e.replace(/\/{1,}$/,""):e}function JL(e){return Mo(QL(e))}function Wp(e,t){return e?.endsWith("/")&&e!=="/"&&e!==`${t}/`?e.slice(0,-1):e}function NF(e,t,n){return Wp(e,n)===Wp(t,n)}function jF({base:e,to:t,trailingSlash:n="never",cache:i}){const s=t.startsWith("/"),r=!s&&t===".";let a;if(i){a=s?t:r?e:e+"\0"+t;const f=i.get(a);if(f)return f}let o;if(r)o=e.split("/");else if(s)o=t.split("/");else{for(o=e.split("/");o.length>1&&xd(o)==="";)o.pop();const f=t.split("/");for(let m=0,g=f.length;m<g;m++){const C=f[m];C===""?m?m===g-1&&o.push(C):o=[C]:C===".."?o.pop():C==="."||o.push(C)}}o.length>1&&(xd(o)===""?n==="never"&&o.pop():n==="always"&&o.push(""));let l,u="";for(let f=0;f<o.length;f++){f>0&&(u+="/");const m=o[f];if(!m)continue;l=fS(m,0,l);const g=l[0];if(g===Sc){u+=m;continue}const C=l[5],S=m.substring(0,l[1]),v=m.substring(l[4],C),_=m.substring(l[2],l[3]);g===Ba?u+=S||v?`${S}{$${_}}${v}`:`$${_}`:g===Fa?u+=S||v?`${S}{$}${v}`:"$":u+=`${S}{-$${_}}${v}`}u=mS(u);const h=u||"/";return a&&i&&i.set(a,h),h}function BF(e){const t=new Map(e.map(s=>[encodeURIComponent(s),s])),n=Array.from(t.keys()).map(s=>s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"),i=new RegExp(n,"g");return s=>s.replace(i,r=>t.get(r)??r)}function Gb(e,t,n){const i=t[e];return typeof i!="string"?i:e==="_splat"?/^[a-zA-Z0-9\-._~!/]*$/.test(i)?i:i.split("/").map(s=>HT(s,n)).join("/"):HT(i,n)}function zT({path:e,params:t,decoder:n,...i}){let s=!1;const r={};if(!e||e==="/")return{interpolatedPath:"/",usedParams:r,isMissingParams:s};if(!e.includes("$"))return{interpolatedPath:e,usedParams:r,isMissingParams:s};const a=e.length;let o=0,l,u="";for(;o<a;){const f=o;l=fS(e,f,l);const m=l[5];if(o=m+1,f===m)continue;const g=l[0];if(g===Sc){u+="/"+e.substring(f,m);continue}if(g===Fa){const C=t._splat;r._splat=C,r["*"]=C;const S=e.substring(f,l[1]),v=e.substring(l[4],m);if(!C){s=!0,(S||v)&&(u+="/"+S+v);continue}const _=Gb("_splat",t,n);u+="/"+S+_+v;continue}if(g===Ba){const C=e.substring(l[2],l[3]);!s&&!(C in t)&&(s=!0),r[C]=t[C];const S=e.substring(f,l[1]),v=e.substring(l[4],m),_=Gb(C,t,n)??"undefined";u+="/"+S+_+v;continue}if(g===wd){const C=e.substring(l[2],l[3]),S=t[C];if(S==null)continue;r[C]=S;const v=e.substring(f,l[1]),_=e.substring(l[4],m),w=Gb(C,t,n)??"";u+="/"+v+w+_;continue}}return e.endsWith("/")&&(u+="/"),{usedParams:r,interpolatedPath:u||"/",isMissingParams:s}}function HT(e,t){const n=encodeURIComponent(e);return t?.(n)??n}function Pi(e){return!!e?.isNotFound}function FF(){try{if(typeof window<"u"&&typeof window.sessionStorage=="object")return window.sessionStorage}catch{}}const $_="tsr-scroll-restoration-v1_3",UF=(e,t)=>{let n;return(...i)=>{n||(n=setTimeout(()=>{e(...i),n=null},t))}};function zF(){const e=FF();if(!e)return null;const t=e.getItem($_);let n=t?JSON.parse(t):{};return{state:n,set:i=>{n=wo(i,n)||n;try{e.setItem($_,JSON.stringify(n))}catch{console.warn("[ts-router] Could not persist scroll restoration state to sessionStorage.")}}}}const Lf=zF(),HF=e=>e.state.__TSR_key||e.href;function $F(e){const t=[];let n;for(;n=e.parentNode;)t.push(`${e.tagName}:nth-child(${Array.prototype.indexOf.call(n.children,e)+1})`),e=n;return`${t.reverse().join(" > ")}`.toLowerCase()}let Gp=!1;function qF({storageKey:e,key:t,behavior:n,shouldScrollRestoration:i,scrollToTopSelectors:s,location:r}){let a;try{a=JSON.parse(sessionStorage.getItem(e)||"{}")}catch(u){console.error(u);return}const o=t||window.history.state?.__TSR_key,l=a[o];Gp=!0;e:{if(i&&l&&Object.keys(l).length>0){for(const f in l){const m=l[f];if(f==="window")window.scrollTo({top:m.scrollY,left:m.scrollX,behavior:n});else if(f){const g=document.querySelector(f);g&&(g.scrollLeft=m.scrollX,g.scrollTop=m.scrollY)}}break e}const u=(r??window.location).hash.split("#",2)[1];if(u){const f=window.history.state?.__hashScrollIntoViewOptions??!0;if(f){const m=document.getElementById(u);m&&m.scrollIntoView(f)}break e}const h={top:0,left:0,behavior:n};if(window.scrollTo(h),s)for(const f of s){if(f==="window")continue;const m=typeof f=="function"?f():document.querySelector(f);m&&m.scrollTo(h)}}Gp=!1}function VF(e,t){if(!Lf||((e.options.scrollRestoration??!1)&&(e.isScrollRestoring=!0),e.isScrollRestorationSetup||!Lf))return;e.isScrollRestorationSetup=!0,Gp=!1;const i=e.options.getScrollRestorationKey||HF;window.history.scrollRestoration="manual";const s=r=>{if(Gp||!e.isScrollRestoring)return;let a="";if(r.target===document||r.target===window)a="window";else{const l=r.target.getAttribute("data-scroll-restoration-id");l?a=`[data-scroll-restoration-id="${l}"]`:a=$F(r.target)}const o=i(e.state.location);Lf.set(l=>{const u=l[o]||={},h=u[a]||={};if(a==="window")h.scrollX=window.scrollX||0,h.scrollY=window.scrollY||0;else if(a){const f=document.querySelector(a);f&&(h.scrollX=f.scrollLeft||0,h.scrollY=f.scrollTop||0)}return l})};typeof document<"u"&&document.addEventListener("scroll",UF(s,100),!0),e.subscribe("onRendered",r=>{const a=i(r.toLocation);if(!e.resetNextScroll){e.resetNextScroll=!0;return}typeof e.options.scrollRestoration=="function"&&!e.options.scrollRestoration({location:e.latestLocation})||(qF({storageKey:$_,key:a,behavior:e.options.scrollRestorationBehavior,shouldScrollRestoration:e.isScrollRestoring,scrollToTopSelectors:e.options.scrollToTopSelectors,location:e.history.location}),e.isScrollRestoring&&Lf.set(o=>(o[a]||={},o)))})}function WF(e){if(typeof document<"u"&&document.querySelector){const t=e.state.location.state.__hashScrollIntoViewOptions??!0;if(t&&e.state.location.hash!==""){const n=document.getElementById(e.state.location.hash);n&&n.scrollIntoView(t)}}}function GF(e,t=String){const n=new URLSearchParams;for(const i in e){const s=e[i];s!==void 0&&n.set(i,t(s))}return n.toString()}function Kb(e){return e?e==="false"?!1:e==="true"?!0:+e*0===0&&+e+""===e?+e:e:""}function KF(e){const t=new URLSearchParams(e),n={};for(const[i,s]of t.entries()){const r=n[i];r==null?n[i]=Kb(s):Array.isArray(r)?r.push(Kb(s)):n[i]=[r,Kb(s)]}return n}const YF=JF(JSON.parse),QF=XF(JSON.stringify,JSON.parse);function JF(e){return t=>{t[0]==="?"&&(t=t.substring(1));const n=KF(t);for(const i in n){const s=n[i];if(typeof s=="string")try{n[i]=e(s)}catch{}}return n}}function XF(e,t){const n=typeof t=="function";function i(s){if(typeof s=="object"&&s!==null)try{return e(s)}catch{}else if(n&&typeof s=="string")try{return t(s),e(s)}catch{}return s}return s=>{const r=GF(s,i);return r?`?${r}`:""}}const Qi="__root__";function ZF(e){if(e.statusCode=e.statusCode||e.code||307,!e._builtLocation&&!e.reloadDocument&&typeof e.href=="string")try{new URL(e.href),e.reloadDocument=!0}catch{}const t=new Headers(e.headers);e.href&&t.get("Location")===null&&t.set("Location",e.href);const n=new Response(null,{status:e.statusCode,headers:t});if(n.options=e,e.throw)throw n;return n}function es(e){return e instanceof Response&&!!e.options}const fp=e=>{if(!e.rendered)return e.rendered=!0,e.onReady?.()},qm=(e,t)=>!!(e.preload&&!e.router.state.matches.some(n=>n.id===t)),cc=(e,t,n=!0)=>{const i={...e.router.options.context??{}},s=n?t:t-1;for(let r=0;r<=s;r++){const a=e.matches[r];if(!a)continue;const o=e.router.getMatch(a.id);o&&Object.assign(i,o.__routeContext,o.__beforeLoadContext)}return i},XL=(e,t,n)=>{const i=e.router.routesById[t.routeId??""]??e.router.routeTree;!i.options.notFoundComponent&&e.router.options?.defaultNotFoundComponent&&(i.options.notFoundComponent=e.router.options.defaultNotFoundComponent);const s=n==="BEFORE_LOAD"&&i.parentRoute;s||Br(i.options.notFoundComponent);const r=e.matches.find(a=>a.routeId===i.id);Br(r,"Could not find match for route: "+i.id),e.updateMatch(r.id,a=>({...a,status:"notFound",error:t,isFetching:!1})),s&&(t.routeId=i.parentRoute.id,XL(e,t,n))},ko=(e,t,n,i)=>{if(!(!es(n)&&!Pi(n))){if(es(n)&&n.redirectHandled&&!n.options.reloadDocument)throw n;if(t){t._nonReactive.beforeLoadPromise?.resolve(),t._nonReactive.loaderPromise?.resolve(),t._nonReactive.beforeLoadPromise=void 0,t._nonReactive.loaderPromise=void 0;const s=es(n)?"redirected":"notFound";t._nonReactive.error=n,e.updateMatch(t.id,r=>({...r,status:s,context:cc(e,t.index),isFetching:!1,error:n})),Pi(n)&&!n.routeId&&(n.routeId=t.routeId),t._nonReactive.loadPromise?.resolve()}throw es(n)?(e.rendered=!0,n.options._fromLocation=e.location,n.redirectHandled=!0,n=e.router.resolveRedirect(n),n):(XL(e,n,i),n)}},ZL=(e,t)=>!!e.router.getMatch(t)._nonReactive.dehydrated,Du=(e,t,n,i)=>{const{id:s,routeId:r}=e.matches[t],a=e.router.looseRoutesById[r];if(n instanceof Promise)throw n;n.routerCode=i,e.firstBadMatchIndex??=t,ko(e,e.router.getMatch(s),n,i);try{a.options.onError?.(n)}catch(o){n=o,ko(e,e.router.getMatch(s),n,i)}e.updateMatch(s,o=>(o._nonReactive.beforeLoadPromise?.resolve(),o._nonReactive.beforeLoadPromise=void 0,o._nonReactive.loadPromise?.resolve(),{...o,error:n,status:"error",isFetching:!1,updatedAt:Date.now(),abortController:new AbortController}))},e2=(e,t,n,i)=>{if(i._nonReactive.pendingTimeout!==void 0)return;const s=n.options.pendingMs??e.router.options.defaultPendingMs;if(!!(e.onReady&&!qm(e,t)&&(n.options.loader||n.options.beforeLoad||i2(n))&&typeof s=="number"&&s!==1/0&&(n.options.pendingComponent??e.router.options?.defaultPendingComponent))){const a=setTimeout(()=>{fp(e)},s);i._nonReactive.pendingTimeout=a}},e6=(e,t,n)=>{const i=e.router.getMatch(t);if(!i._nonReactive.beforeLoadPromise&&!i._nonReactive.loaderPromise)return;e2(e,t,n,i);const s=()=>{const r=e.router.getMatch(t);r.preload&&(r.status==="redirected"||r.status==="notFound")&&ko(e,r,r.error)};return i._nonReactive.beforeLoadPromise?i._nonReactive.beforeLoadPromise.then(s):s()},t6=(e,t,n,i)=>{const s=e.router.getMatch(t),r=s._nonReactive.loadPromise;s._nonReactive.loadPromise=_c(()=>{r?.resolve()});const{paramsError:a,searchError:o}=s;a&&Du(e,n,a,"PARSE_PARAMS"),o&&Du(e,n,o,"VALIDATE_SEARCH"),e2(e,t,i,s);const l=new AbortController;let u=!1;const h=()=>{u||(u=!0,e.updateMatch(t,k=>({...k,isFetching:"beforeLoad",fetchCount:k.fetchCount+1,abortController:l})))},f=()=>{s._nonReactive.beforeLoadPromise?.resolve(),s._nonReactive.beforeLoadPromise=void 0,e.updateMatch(t,k=>({...k,isFetching:!1}))};if(!i.options.beforeLoad){id(()=>{h(),f()});return}s._nonReactive.beforeLoadPromise=_c();const m={...cc(e,n,!1),...s.__routeContext},{search:g,params:C,cause:S}=s,v=qm(e,t),_={search:g,abortController:l,params:C,preload:v,context:m,location:e.location,navigate:k=>e.router.navigate({...k,_fromLocation:e.location}),buildLocation:e.router.buildLocation,cause:v?"preload":S,matches:e.matches,routeId:i.id,...e.router.options.additionalContext},w=k=>{if(k===void 0){id(()=>{h(),f()});return}(es(k)||Pi(k))&&(h(),Du(e,n,k,"BEFORE_LOAD")),id(()=>{h(),e.updateMatch(t,A=>({...A,__beforeLoadContext:k})),f()})};let x;try{if(x=i.options.beforeLoad(_),lc(x))return h(),x.catch(k=>{Du(e,n,k,"BEFORE_LOAD")}).then(w)}catch(k){h(),Du(e,n,k,"BEFORE_LOAD")}w(x)},n6=(e,t)=>{const{id:n,routeId:i}=e.matches[t],s=e.router.looseRoutesById[i],r=()=>o(),a=()=>t6(e,n,t,s),o=()=>{if(ZL(e,n))return;const l=e6(e,n,s);return lc(l)?l.then(a):a()};return r()},i6=(e,t,n)=>{const i=e.router.getMatch(t);if(!i||!n.options.head&&!n.options.scripts&&!n.options.headers)return;const s={ssr:e.router.options.ssr,matches:e.matches,match:i,params:i.params,loaderData:i.loaderData};return Promise.all([n.options.head?.(s),n.options.scripts?.(s),n.options.headers?.(s)]).then(([r,a,o])=>{const l=r?.meta,u=r?.links,h=r?.scripts,f=r?.styles;return{meta:l,links:u,headScripts:h,headers:o,scripts:a,styles:f}})},t2=(e,t,n,i)=>{const s=e.matchPromises[n-1],{params:r,loaderDeps:a,abortController:o,cause:l}=e.router.getMatch(t),u=cc(e,n),h=qm(e,t);return{params:r,deps:a,preload:!!h,parentMatchPromise:s,abortController:o,context:u,location:e.location,navigate:f=>e.router.navigate({...f,_fromLocation:e.location}),cause:h?"preload":l,route:i,...e.router.options.additionalContext}},$T=async(e,t,n,i)=>{try{const s=e.router.getMatch(t);try{(!(yF??e.router.isServer)||s.ssr===!0)&&n2(i);const r=i.options.loader?.(t2(e,t,n,i)),a=i.options.loader&&lc(r);if((a||i._lazyPromise||i._componentsPromise||i.options.head||i.options.scripts||i.options.headers||s._nonReactive.minPendingPromise)&&e.updateMatch(t,u=>({...u,isFetching:"loader"})),i.options.loader){const u=a?await r:r;ko(e,e.router.getMatch(t),u),u!==void 0&&e.updateMatch(t,h=>({...h,loaderData:u}))}i._lazyPromise&&await i._lazyPromise;const l=s._nonReactive.minPendingPromise;l&&await l,i._componentsPromise&&await i._componentsPromise,e.updateMatch(t,u=>({...u,error:void 0,context:cc(e,n),status:"success",isFetching:!1,updatedAt:Date.now()}))}catch(r){let a=r;if(a?.name==="AbortError"){if(s.abortController.signal.aborted){s._nonReactive.loaderPromise?.resolve(),s._nonReactive.loaderPromise=void 0;return}e.updateMatch(t,l=>({...l,status:l.status==="pending"?"success":l.status,isFetching:!1,context:cc(e,n)}));return}const o=s._nonReactive.minPendingPromise;o&&await o,Pi(r)&&await i.options.notFoundComponent?.preload?.(),ko(e,e.router.getMatch(t),r);try{i.options.onError?.(r)}catch(l){a=l,ko(e,e.router.getMatch(t),l)}e.updateMatch(t,l=>({...l,error:a,context:cc(e,n),status:"error",isFetching:!1}))}}catch(s){const r=e.router.getMatch(t);r&&(r._nonReactive.loaderPromise=void 0),ko(e,r,s)}},s6=async(e,t)=>{async function n(h,f,m,g){const C=Date.now()-f.updatedAt,S=h?g.options.preloadStaleTime??e.router.options.defaultPreloadStaleTime??3e4:g.options.staleTime??e.router.options.defaultStaleTime??0,v=g.options.shouldReload,_=typeof v=="function"?v(t2(e,i,t,g)):v,{status:w,invalid:x}=m;r=w==="success"&&(x||(_??C>S)),h&&g.options.preload===!1||(r&&!e.sync?(a=!0,(async()=>{try{await $T(e,i,t,g);const k=e.router.getMatch(i);k._nonReactive.loaderPromise?.resolve(),k._nonReactive.loadPromise?.resolve(),k._nonReactive.loaderPromise=void 0}catch(k){es(k)&&await e.router.navigate(k.options)}})()):(w!=="success"||r&&e.sync)&&await $T(e,i,t,g))}const{id:i,routeId:s}=e.matches[t];let r=!1,a=!1;const o=e.router.looseRoutesById[s];if(!ZL(e,i)){const h=e.router.getMatch(i),f=qm(e,i);if(h._nonReactive.loaderPromise){if(h.status==="success"&&!e.sync&&!h.preload)return h;await h._nonReactive.loaderPromise;const m=e.router.getMatch(i),g=m._nonReactive.error||m.error;g&&ko(e,m,g),m.status==="pending"&&await n(f,h,m,o)}else{const m=f&&!e.router.state.matches.some(C=>C.id===i),g=e.router.getMatch(i);g._nonReactive.loaderPromise=_c(),m!==g.preload&&e.updateMatch(i,C=>({...C,preload:m})),await n(f,h,g,o)}}const l=e.router.getMatch(i);a||(l._nonReactive.loaderPromise?.resolve(),l._nonReactive.loadPromise?.resolve()),clearTimeout(l._nonReactive.pendingTimeout),l._nonReactive.pendingTimeout=void 0,a||(l._nonReactive.loaderPromise=void 0),l._nonReactive.dehydrated=void 0;const u=a?l.isFetching:!1;return u!==l.isFetching||l.invalid!==!1?(e.updateMatch(i,h=>({...h,isFetching:u,invalid:!1})),e.router.getMatch(i)):l};async function qT(e){const t=Object.assign(e,{matchPromises:[]});t.router.state.matches.some(n=>n._forcePending)&&fp(t);try{for(let o=0;o<t.matches.length;o++){const l=n6(t,o);lc(l)&&await l}const n=t.firstBadMatchIndex??t.matches.length;for(let o=0;o<n;o++)t.matchPromises.push(s6(t,o));const s=(await Promise.allSettled(t.matchPromises)).filter(o=>o.status==="rejected").map(o=>o.reason);let r;for(const o of s){if(es(o))throw o;!r&&Pi(o)&&(r=o)}for(const o of t.matches){const{id:l,routeId:u}=o,h=t.router.looseRoutesById[u];try{const f=i6(t,l,h);if(f){const m=await f;t.updateMatch(l,g=>({...g,...m}))}}catch(f){console.error(`Error executing head for route ${u}:`,f)}}if(r)throw r;const a=fp(t);lc(a)&&await a}catch(n){if(Pi(n)&&!t.preload){const i=fp(t);throw lc(i)&&await i,n}if(es(n))throw n}return t.matches}async function n2(e){if(!e._lazyLoaded&&e._lazyPromise===void 0&&(e.lazyFn?e._lazyPromise=e.lazyFn().then(t=>{const{id:n,...i}=t.options;Object.assign(e.options,i),e._lazyLoaded=!0,e._lazyPromise=void 0}):e._lazyLoaded=!0),!e._componentsLoaded&&e._componentsPromise===void 0){const t=()=>{const n=[];for(const i of s2){const s=e.options[i]?.preload;s&&n.push(s())}if(n.length)return Promise.all(n).then(()=>{e._componentsLoaded=!0,e._componentsPromise=void 0});e._componentsLoaded=!0,e._componentsPromise=void 0};e._componentsPromise=e._lazyPromise?e._lazyPromise.then(t):t()}return e._componentsPromise}function i2(e){for(const t of s2)if(e.options[t]?.preload)return!0;return!1}const s2=["component","errorComponent","pendingComponent","notFoundComponent"];function r6(e){return{input:({url:t})=>{for(const n of e)t=q_(n,t);return t},output:({url:t})=>{for(let n=e.length-1;n>=0;n--)t=r2(e[n],t);return t}}}function o6(e){const t=JL(e.basepath),n=`/${t}`,i=`${n}/`,s=e.caseSensitive?n:n.toLowerCase(),r=e.caseSensitive?i:i.toLowerCase();return{input:({url:a})=>{const o=e.caseSensitive?a.pathname:a.pathname.toLowerCase();return o===s?a.pathname="/":o.startsWith(r)&&(a.pathname=a.pathname.slice(n.length)),a},output:({url:a})=>(a.pathname=hp(["/",t,a.pathname]),a)}}function q_(e,t){const n=e?.input?.({url:t});if(n){if(typeof n=="string")return new URL(n);if(n instanceof URL)return n}return t}function r2(e,t){const n=e?.output?.({url:t});if(n){if(typeof n=="string")return new URL(n);if(n instanceof URL)return n}return t}function Ia(e){const t=e.resolvedLocation,n=e.location,i=t?.pathname!==n.pathname,s=t?.href!==n.href,r=t?.hash!==n.hash;return{fromLocation:t,toLocation:n,pathChanged:i,hrefChanged:s,hashChanged:r}}function a6(e){const t=e.filter(n=>n.status!=="redirected");return t.length===e.length?e:t}class l6{constructor(t){this.tempLocationKey=`${Math.round(Math.random()*1e7)}`,this.resetNextScroll=!0,this.shouldViewTransition=void 0,this.isViewTransitionTypesSupported=void 0,this.subscribers=new Set,this.isScrollRestoring=!1,this.isScrollRestorationSetup=!1,this.startTransition=n=>n(),this.update=n=>{n.notFoundRoute&&console.warn("The notFoundRoute API is deprecated and will be removed in the next major version. See https://tanstack.com/router/v1/docs/framework/react/guide/not-found-errors#migrating-from-notfoundroute for more info.");const i=this.options,s=this.basepath??i?.basepath??"/",r=this.basepath===void 0,a=i?.rewrite;if(this.options={...i,...n},this.isServer=this.options.isServer??typeof document>"u",this.protocolAllowlist=new Set(this.options.protocolAllowlist),this.options.pathParamsAllowedCharacters&&(this.pathParamsDecoder=BF(this.options.pathParamsAllowedCharacters)),(!this.history||this.options.history&&this.options.history!==this.history)&&(this.options.history?this.history=this.options.history:this.history=gF()),this.origin=this.options.origin,this.origin||(window?.origin&&window.origin!=="null"?this.origin=window.origin:this.origin="http://localhost"),this.history&&this.updateLatestLocation(),this.options.routeTree!==this.routeTree){this.routeTree=this.options.routeTree;let m;this.resolvePathCache=Vp(1e3),m=this.buildRouteTree(),this.setRoutes(m)}!this.__store&&this.latestLocation&&(this.__store=new pF(u6(this.latestLocation)),VF(this));let o=!1;const l=this.options.basepath??"/",u=this.options.rewrite;if(r||s!==l||a!==u){this.basepath=l;const m=[],g=JL(l);g&&g!=="/"&&m.push(o6({basepath:l})),u&&m.push(u),this.rewrite=m.length===0?void 0:m.length===1?m[0]:r6(m),this.history&&this.updateLatestLocation(),o=!0}o&&this.__store&&this.__store.setState(m=>({...m,location:this.latestLocation})),typeof window<"u"&&"CSS"in window&&typeof window.CSS?.supports=="function"&&(this.isViewTransitionTypesSupported=window.CSS.supports("selector(:active-view-transition-type(a)"))},this.updateLatestLocation=()=>{this.latestLocation=this.parseLocation(this.history.location,this.latestLocation)},this.buildRouteTree=()=>{const n=IF(this.routeTree,this.options.caseSensitive,(i,s)=>{i.init({originalIndex:s})});return this.options.routeMasks&&EF(this.options.routeMasks,n.processedTree),n},this.subscribe=(n,i)=>{const s={eventType:n,fn:i};return this.subscribers.add(s),()=>{this.subscribers.delete(s)}},this.emit=n=>{this.subscribers.forEach(i=>{i.eventType===n.type&&i.fn(n)})},this.parseLocation=(n,i)=>{const s=({pathname:l,search:u,hash:h,href:f,state:m})=>{if(!this.rewrite&&!/[ \x00-\x1f\x7f\u0080-\uffff]/.test(l)){const w=this.options.parseSearch(u),x=this.options.stringifySearch(w);return{href:l+x+h,publicHref:f,pathname:Iu(l).path,external:!1,searchStr:x,search:Mi(i?.search,w),hash:Iu(h.slice(1)).path,state:Mi(i?.state,m)}}const g=new URL(f,this.origin),C=q_(this.rewrite,g),S=this.options.parseSearch(C.search),v=this.options.stringifySearch(S);return C.search=v,{href:C.href.replace(C.origin,""),publicHref:f,pathname:Iu(C.pathname).path,external:!!this.rewrite&&C.origin!==this.origin,searchStr:v,search:Mi(i?.search,S),hash:Iu(C.hash.slice(1)).path,state:Mi(i?.state,m)}},r=s(n),{__tempLocation:a,__tempKey:o}=r.state;if(a&&(!o||o===this.tempLocationKey)){const l=s(a);return l.state.key=r.state.key,l.state.__TSR_key=r.state.__TSR_key,delete l.state.__tempLocation,{...l,maskedLocation:r}}return r},this.resolvePathWithBase=(n,i)=>jF({base:n,to:mS(i),trailingSlash:this.options.trailingSlash,cache:this.resolvePathCache}),this.matchRoutes=(n,i,s)=>typeof n=="string"?this.matchRoutesInternal({pathname:n,search:i},s):this.matchRoutesInternal(n,i),this.getMatchedRoutes=n=>d6({pathname:n,routesById:this.routesById,processedTree:this.processedTree}),this.cancelMatch=n=>{const i=this.getMatch(n);i&&(i.abortController.abort(),clearTimeout(i._nonReactive.pendingTimeout),i._nonReactive.pendingTimeout=void 0)},this.cancelMatches=()=>{const n=this.state.matches.filter(r=>r.status==="pending"),i=this.state.matches.filter(r=>r.isFetching==="loader");new Set([...this.state.pendingMatches??[],...n,...i]).forEach(r=>{this.cancelMatch(r.id)})},this.buildLocation=n=>{const i=(r={})=>{const a=r._fromLocation||this.pendingBuiltLocation||this.latestLocation,o=this.matchRoutesLightweight(a);r.from;const l=r.unsafeRelative==="path"?a.pathname:r.from??o.fullPath,u=this.resolvePathWithBase(l,"."),h=o.search,f={...o.params},m=r.to?this.resolvePathWithBase(u,`${r.to}`):this.resolvePathWithBase(u,"."),g=r.params===!1||r.params===null?{}:(r.params??!0)===!0?f:Object.assign(f,wo(r.params,f)),C=this.getMatchedRoutes(m);let S=C.matchedRoutes;if((!C.foundRoute||C.foundRoute.path!=="/"&&C.routeParams["**"])&&this.options.notFoundRoute&&(S=[...S,this.options.notFoundRoute]),Object.keys(g).length>0)for(const O of S){const j=O.options.params?.stringify??O.options.stringifyParams;if(j)try{Object.assign(g,j(g))}catch{}}const _=n.leaveParams?m:Iu(zT({path:m,params:g,decoder:this.pathParamsDecoder,server:this.isServer}).interpolatedPath).path;let w=h;if(n._includeValidateSearch&&this.options.search?.strict){const O={};S.forEach(j=>{if(j.options.validateSearch)try{Object.assign(O,pp(j.options.validateSearch,{...O,...w}))}catch{}}),w=O}w=h6({search:w,dest:r,destRoutes:S,_includeValidateSearch:n._includeValidateSearch}),w=Mi(h,w);const x=this.options.stringifySearch(w),k=r.hash===!0?a.hash:r.hash?wo(r.hash,a.hash):void 0,A=k?`#${k}`:"";let T=r.state===!0?a.state:r.state?wo(r.state,a.state):{};T=Mi(a.state,T);const M=`${_}${x}${A}`;let E,L,D=!1;if(this.rewrite){const O=new URL(M,this.origin),j=r2(this.rewrite,O);E=O.href.replace(O.origin,""),j.origin!==this.origin?(L=j.href,D=!0):L=j.pathname+j.search+j.hash}else E=wF(M),L=E;return{publicHref:L,href:E,pathname:_,search:w,searchStr:x,state:T,hash:k??"",external:D,unmaskOnReload:r.unmaskOnReload}},s=(r={},a)=>{const o=i(r);let l=a?i(a):void 0;if(!l){const u={};if(this.options.routeMasks){const h=RF(o.pathname,this.processedTree);if(h){Object.assign(u,h.rawParams);const{from:f,params:m,...g}=h.route,C=m===!1||m===null?{}:(m??!0)===!0?u:Object.assign(u,wo(m,u));a={from:n.from,...g,params:C},l=i(a)}}}return l&&(o.maskedLocation=l),o};return n.mask?s(n,{from:n.from,...n.mask}):s(n)},this.commitLocation=async({viewTransition:n,ignoreBlocker:i,...s})=>{const r=()=>{const l=["key","__TSR_key","__TSR_index","__hashScrollIntoViewOptions"];l.forEach(h=>{s.state[h]=this.latestLocation.state[h]});const u=La(s.state,this.latestLocation.state);return l.forEach(h=>{delete s.state[h]}),u},a=Mo(this.latestLocation.href)===Mo(s.href),o=this.commitLocationPromise;if(this.commitLocationPromise=_c(()=>{o?.resolve()}),a&&r())this.load();else{let{maskedLocation:l,hashScrollIntoView:u,...h}=s;l&&(h={...l,state:{...l.state,__tempKey:void 0,__tempLocation:{...h,search:h.searchStr,state:{...h.state,__tempKey:void 0,__tempLocation:void 0,__TSR_key:void 0,key:void 0}}}},(h.unmaskOnReload??this.options.unmaskOnReload??!1)&&(h.state.__tempKey=this.tempLocationKey)),h.state.__hashScrollIntoViewOptions=u??this.options.defaultHashScrollIntoView??!0,this.shouldViewTransition=n,this.history[s.replace?"replace":"push"](h.publicHref,h.state,{ignoreBlocker:i})}return this.resetNextScroll=s.resetScroll??!0,this.history.subscribers.size||this.load(),this.commitLocationPromise},this.buildAndCommitLocation=({replace:n,resetScroll:i,hashScrollIntoView:s,viewTransition:r,ignoreBlocker:a,href:o,...l}={})=>{if(o){const f=this.history.location.state.__TSR_index,m=Cd(o,{__TSR_index:n?f:f+1}),g=new URL(m.pathname,this.origin),C=q_(this.rewrite,g);l.to=C.pathname,l.search=this.options.parseSearch(m.search),l.hash=m.hash.slice(1)}const u=this.buildLocation({...l,_includeValidateSearch:!0});this.pendingBuiltLocation=u;const h=this.commitLocation({...u,viewTransition:r,replace:n,resetScroll:i,hashScrollIntoView:s,ignoreBlocker:a});return Promise.resolve().then(()=>{this.pendingBuiltLocation===u&&(this.pendingBuiltLocation=void 0)}),h},this.navigate=async({to:n,reloadDocument:i,href:s,publicHref:r,...a})=>{let o=!1;if(s)try{new URL(`${s}`),o=!0}catch{}if(o&&!i&&(i=!0),i){if(n!==void 0||!s){const u=this.buildLocation({to:n,...a});s=s??u.publicHref,r=r??u.publicHref}const l=!o&&r?r:s;if(qp(l,this.protocolAllowlist))return Promise.resolve();if(!a.ignoreBlocker){const h=this.history.getBlockers?.()??[];for(const f of h)if(f?.blockerFn&&await f.blockerFn({currentLocation:this.latestLocation,nextLocation:this.latestLocation,action:"PUSH"}))return Promise.resolve()}return a.replace?window.location.replace(l):window.location.href=l,Promise.resolve()}return this.buildAndCommitLocation({...a,href:s,to:n,_isNavigate:!0})},this.beforeLoad=()=>{this.cancelMatches(),this.updateLatestLocation();const n=this.matchRoutes(this.latestLocation);this.__store.setState(i=>({...i,status:"pending",statusCode:200,isLoading:!0,location:this.latestLocation,pendingMatches:n,cachedMatches:i.cachedMatches.filter(s=>!n.some(r=>r.id===s.id))}))},this.load=async n=>{let i,s,r;for(r=new Promise(o=>{this.startTransition(async()=>{try{this.beforeLoad();const l=this.latestLocation,u=this.state.resolvedLocation;this.state.redirect||this.emit({type:"onBeforeNavigate",...Ia({resolvedLocation:u,location:l})}),this.emit({type:"onBeforeLoad",...Ia({resolvedLocation:u,location:l})}),await qT({router:this,sync:n?.sync,matches:this.state.pendingMatches,location:l,updateMatch:this.updateMatch,onReady:async()=>{this.startTransition(()=>{this.startViewTransition(async()=>{let h=[],f=[],m=[];id(()=>{this.__store.setState(g=>{const C=g.matches,S=g.pendingMatches||g.matches;return h=C.filter(v=>!S.some(_=>_.id===v.id)),f=S.filter(v=>!C.some(_=>_.id===v.id)),m=S.filter(v=>C.some(_=>_.id===v.id)),{...g,isLoading:!1,loadedAt:Date.now(),matches:S,pendingMatches:void 0,cachedMatches:[...g.cachedMatches,...h.filter(v=>v.status!=="error"&&v.status!=="notFound"&&v.status!=="redirected")]}}),this.clearExpiredCache()}),[[h,"onLeave"],[f,"onEnter"],[m,"onStay"]].forEach(([g,C])=>{g.forEach(S=>{this.looseRoutesById[S.routeId].options[C]?.(S)})})})})}})}catch(l){es(l)?(i=l,this.navigate({...i.options,replace:!0,ignoreBlocker:!0})):Pi(l)&&(s=l),this.__store.setState(u=>({...u,statusCode:i?i.status:s?404:u.matches.some(h=>h.status==="error")?500:200,redirect:i}))}this.latestLoadPromise===r&&(this.commitLocationPromise?.resolve(),this.latestLoadPromise=void 0,this.commitLocationPromise=void 0),o()})}),this.latestLoadPromise=r,await r;this.latestLoadPromise&&r!==this.latestLoadPromise;)await this.latestLoadPromise;let a;this.hasNotFoundMatch()?a=404:this.__store.state.matches.some(o=>o.status==="error")&&(a=500),a!==void 0&&this.__store.setState(o=>({...o,statusCode:a}))},this.startViewTransition=n=>{const i=this.shouldViewTransition??this.options.defaultViewTransition;if(this.shouldViewTransition=void 0,i&&typeof document<"u"&&"startViewTransition"in document&&typeof document.startViewTransition=="function"){let s;if(typeof i=="object"&&this.isViewTransitionTypesSupported){const r=this.latestLocation,a=this.state.resolvedLocation,o=typeof i.types=="function"?i.types(Ia({resolvedLocation:a,location:r})):i.types;if(o===!1){n();return}s={update:n,types:o}}else s=n;document.startViewTransition(s)}else n()},this.updateMatch=(n,i)=>{this.startTransition(()=>{const s=this.state.pendingMatches?.some(r=>r.id===n)?"pendingMatches":this.state.matches.some(r=>r.id===n)?"matches":this.state.cachedMatches.some(r=>r.id===n)?"cachedMatches":"";s&&(s==="cachedMatches"?this.__store.setState(r=>({...r,cachedMatches:a6(r.cachedMatches.map(a=>a.id===n?i(a):a))})):this.__store.setState(r=>({...r,[s]:r[s]?.map(a=>a.id===n?i(a):a)})))})},this.getMatch=n=>{const i=s=>s.id===n;return this.state.cachedMatches.find(i)??this.state.pendingMatches?.find(i)??this.state.matches.find(i)},this.invalidate=n=>{const i=s=>n?.filter?.(s)??!0?{...s,invalid:!0,...n?.forcePending||s.status==="error"||s.status==="notFound"?{status:"pending",error:void 0}:void 0}:s;return this.__store.setState(s=>({...s,matches:s.matches.map(i),cachedMatches:s.cachedMatches.map(i),pendingMatches:s.pendingMatches?.map(i)})),this.shouldViewTransition=!1,this.load({sync:n?.sync})},this.getParsedLocationHref=n=>n.publicHref||"/",this.resolveRedirect=n=>{const i=n.headers.get("Location");if(!n.options.href||n.options._builtLocation){const s=n.options._builtLocation??this.buildLocation(n.options),r=this.getParsedLocationHref(s);n.options.href=r,n.headers.set("Location",r)}else if(i)try{const s=new URL(i);if(this.origin&&s.origin===this.origin){const r=s.pathname+s.search+s.hash;n.options.href=r,n.headers.set("Location",r)}}catch{}if(n.options.href&&!n.options._builtLocation&&qp(n.options.href,this.protocolAllowlist))throw new Error(`Redirect blocked: unsafe protocol in href "${n.options.href}". Allowed protocols: ${Array.from(this.protocolAllowlist).join(", ")}.`);return n.headers.get("Location")||n.headers.set("Location",n.options.href),n},this.clearCache=n=>{const i=n?.filter;i!==void 0?this.__store.setState(s=>({...s,cachedMatches:s.cachedMatches.filter(r=>!i(r))})):this.__store.setState(s=>({...s,cachedMatches:[]}))},this.clearExpiredCache=()=>{const n=i=>{const s=this.looseRoutesById[i.routeId];if(!s.options.loader)return!0;const r=(i.preload?s.options.preloadGcTime??this.options.defaultPreloadGcTime:s.options.gcTime??this.options.defaultGcTime)??300*1e3;return i.status==="error"?!0:Date.now()-i.updatedAt>=r};this.clearCache({filter:n})},this.loadRouteChunk=n2,this.preloadRoute=async n=>{const i=n._builtLocation??this.buildLocation(n);let s=this.matchRoutes(i,{throwOnError:!0,preload:!0,dest:n});const r=new Set([...this.state.matches,...this.state.pendingMatches??[]].map(o=>o.id)),a=new Set([...r,...this.state.cachedMatches.map(o=>o.id)]);id(()=>{s.forEach(o=>{a.has(o.id)||this.__store.setState(l=>({...l,cachedMatches:[...l.cachedMatches,o]}))})});try{return s=await qT({router:this,matches:s,location:i,preload:!0,updateMatch:(o,l)=>{r.has(o)?s=s.map(u=>u.id===o?l(u):u):this.updateMatch(o,l)}}),s}catch(o){if(es(o))return o.options.reloadDocument?void 0:await this.preloadRoute({...o.options,_fromLocation:i});Pi(o)||console.error(o);return}},this.matchRoute=(n,i)=>{const s={...n,to:n.to?this.resolvePathWithBase(n.from||"",n.to):void 0,params:n.params||{},leaveParams:!0},r=this.buildLocation(s);if(i?.pending&&this.state.status!=="pending")return!1;const o=(i?.pending===void 0?!this.state.isLoading:i.pending)?this.latestLocation:this.state.resolvedLocation||this.state.location,l=AF(r.pathname,i?.caseSensitive??!1,i?.fuzzy??!1,o.pathname,this.processedTree);return!l||n.params&&!La(l.rawParams,n.params,{partial:!0})?!1:i?.includeSearch??!0?La(o.search,r.search,{partial:!0})?l.rawParams:!1:l.rawParams},this.hasNotFoundMatch=()=>this.__store.state.matches.some(n=>n.status==="notFound"||n.globalNotFound),this.update({defaultPreloadDelay:50,defaultPendingMs:1e3,defaultPendingMinMs:500,context:void 0,...t,caseSensitive:t.caseSensitive??!1,notFoundMode:t.notFoundMode??"fuzzy",stringifySearch:t.stringifySearch??QF,parseSearch:t.parseSearch??YF,protocolAllowlist:t.protocolAllowlist??xF}),typeof document<"u"&&(self.__TSR_ROUTER__=this)}isShell(){return!!this.options.isShell}isPrerendering(){return!!this.options.isPrerendering}get state(){return this.__store.state}setRoutes({routesById:t,routesByPath:n,processedTree:i}){this.routesById=t,this.routesByPath=n,this.processedTree=i;const s=this.options.notFoundRoute;s&&(s.init({originalIndex:99999999999}),this.routesById[s.id]=s)}get looseRoutesById(){return this.routesById}getParentContext(t){return t?.id?t.context??this.options.context??void 0:this.options.context??void 0}matchRoutesInternal(t,n){const i=this.getMatchedRoutes(t.pathname),{foundRoute:s,routeParams:r,parsedParams:a}=i;let{matchedRoutes:o}=i,l=!1;(s?s.path!=="/"&&r["**"]:Mo(t.pathname))&&(this.options.notFoundRoute?o=[...o,this.options.notFoundRoute]:l=!0);const u=l?p6(this.options.notFoundMode,o):void 0,h=new Array(o.length),f=new Map(this.state.matches.map(m=>[m.routeId,m]));for(let m=0;m<o.length;m++){const g=o[m],C=h[m-1];let S,v,_;{const q=C?.search??t.search,K=C?._strictSearch??void 0;try{const $=pp(g.options.validateSearch,{...q})??void 0;S={...q,...$},v={...K,...$},_=void 0}catch($){let Y=$;if($ instanceof Kp||(Y=new Kp($.message,{cause:$})),n?.throwOnError)throw Y;S=q,v={},_=Y}}const w=g.options.loaderDeps?.({search:S})??"",x=w?JSON.stringify(w):"",{interpolatedPath:k,usedParams:A}=zT({path:g.fullPath,params:r,decoder:this.pathParamsDecoder,server:this.isServer}),T=g.id+k+x,M=this.getMatch(T),E=f.get(g.id),L=M?._strictParams??A;let D;if(!M)try{VT(g,A,a,L)}catch(q){if(Pi(q)||es(q)?D=q:D=new c6(q.message,{cause:q}),n?.throwOnError)throw D}Object.assign(r,L);const O=E?"stay":"enter";let j;if(M)j={...M,cause:O,params:E?.params??r,_strictParams:L,search:Mi(E?E.search:M.search,S),_strictSearch:v};else{const q=g.options.loader||g.options.beforeLoad||g.lazyFn||i2(g)?"pending":"success";j={id:T,ssr:g.options.ssr,index:m,routeId:g.id,params:E?.params??r,_strictParams:L,pathname:k,updatedAt:Date.now(),search:E?Mi(E.search,S):S,_strictSearch:v,searchError:void 0,status:q,isFetching:!1,error:void 0,paramsError:D,__routeContext:void 0,_nonReactive:{loadPromise:_c()},__beforeLoadContext:void 0,context:{},abortController:new AbortController,fetchCount:0,cause:O,loaderDeps:E?Mi(E.loaderDeps,w):w,invalid:!1,preload:!1,links:void 0,scripts:void 0,headScripts:void 0,meta:void 0,staticData:g.options.staticData||{},fullPath:g.fullPath}}n?.preload||(j.globalNotFound=u===g.id),j.searchError=_;const U=this.getParentContext(C);j.context={...U,...j.__routeContext,...j.__beforeLoadContext},h[m]=j}for(let m=0;m<h.length;m++){const g=h[m],C=this.looseRoutesById[g.routeId],S=this.getMatch(g.id),v=f.get(g.routeId);if(g.params=v?Mi(v.params,r):r,!S){const _=h[m-1],w=this.getParentContext(_);if(C.options.context){const x={deps:g.loaderDeps,params:g.params,context:w??{},location:t,navigate:k=>this.navigate({...k,_fromLocation:t}),buildLocation:this.buildLocation,cause:g.cause,abortController:g.abortController,preload:!!g.preload,matches:h,routeId:C.id};g.__routeContext=C.options.context(x)??void 0}g.context={...w,...g.__routeContext,...g.__beforeLoadContext}}}return h}matchRoutesLightweight(t){const{matchedRoutes:n,routeParams:i,parsedParams:s}=this.getMatchedRoutes(t.pathname),r=xd(n),a={...t.search};for(const h of n)try{Object.assign(a,pp(h.options.validateSearch,a))}catch{}const o=xd(this.state.matches),l=o&&o.routeId===r.id&&t.pathname===this.state.location.pathname;let u;if(l)u=o.params;else{const h={...i};for(const f of n)try{VT(f,i,s??{},h)}catch{}u=h}return{matchedRoutes:n,fullPath:r.fullPath,search:a,params:u}}}class Kp extends Error{}class c6 extends Error{}function u6(e){return{loadedAt:0,isLoading:!1,isTransitioning:!1,status:"idle",resolvedLocation:void 0,location:e,matches:[],pendingMatches:[],cachedMatches:[],statusCode:200}}function pp(e,t){if(e==null)return{};if("~standard"in e){const n=e["~standard"].validate(t);if(n instanceof Promise)throw new Kp("Async validation not supported");if(n.issues)throw new Kp(JSON.stringify(n.issues,void 0,2),{cause:n});return n.value}return"parse"in e?e.parse(t):typeof e=="function"?e(t):{}}function d6({pathname:e,routesById:t,processedTree:n}){const i={},s=Mo(e);let r,a;const o=MF(s,n,!0);return o&&(r=o.route,Object.assign(i,o.rawParams),a=Object.assign({},o.parsedParams)),{matchedRoutes:o?.branch||[t[Qi]],routeParams:i,foundRoute:r,parsedParams:a}}function h6({search:e,dest:t,destRoutes:n,_includeValidateSearch:i}){return f6(n)(e,t,i??!1)}function f6(e){const t={dest:null,_includeValidateSearch:!1,middlewares:[]};for(const s of e){if("search"in s.options)s.options.search?.middlewares&&t.middlewares.push(...s.options.search.middlewares);else if(s.options.preSearchFilters||s.options.postSearchFilters){const r=({search:a,next:o})=>{let l=a;"preSearchFilters"in s.options&&s.options.preSearchFilters&&(l=s.options.preSearchFilters.reduce((h,f)=>f(h),a));const u=o(l);return"postSearchFilters"in s.options&&s.options.postSearchFilters?s.options.postSearchFilters.reduce((h,f)=>f(h),u):u};t.middlewares.push(r)}if(s.options.validateSearch){const r=({search:a,next:o})=>{const l=o(a);if(!t._includeValidateSearch)return l;try{return{...l,...pp(s.options.validateSearch,l)??void 0}}catch{return l}};t.middlewares.push(r)}}const n=({search:s})=>{const r=t.dest;return r.search?r.search===!0?s:wo(r.search,s):{}};t.middlewares.push(n);const i=(s,r,a)=>{if(s>=a.length)return r;const o=a[s];return o({search:r,next:u=>i(s+1,u,a)})};return function(r,a,o){return t.dest=a,t._includeValidateSearch=o,i(0,r,t.middlewares)}}function p6(e,t){if(e!=="root")for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.children)return i.id}return Qi}function VT(e,t,n,i){const s=e.options.params?.parse??e.options.parseParams;if(s)if(e.options.skipRouteOnParseError)for(const r in t)r in n&&(i[r]=n[r]);else{const r=s(i);Object.assign(i,r)}}const m6="Error preloading route! ";class o2{constructor(t){if(this.init=n=>{this.originalIndex=n.originalIndex;const i=this.options,s=!i?.path&&!i?.id;this.parentRoute=this.options.getParentRoute?.(),s?this._path=Qi:this.parentRoute||Br(!1);let r=s?Qi:i?.path;r&&r!=="/"&&(r=QL(r));const a=i?.id||r;let o=s?Qi:hp([this.parentRoute.id===Qi?"":this.parentRoute.id,a]);r===Qi&&(r="/"),o!==Qi&&(o=hp(["/",o]));const l=o===Qi?"/":hp([this.parentRoute.fullPath,r]);this._path=r,this._id=o,this._fullPath=l,this._to=Mo(l)},this.addChildren=n=>this._addFileChildren(n),this._addFileChildren=n=>(Array.isArray(n)&&(this.children=n),typeof n=="object"&&n!==null&&(this.children=Object.values(n)),this),this._addFileTypes=()=>this,this.updateLoader=n=>(Object.assign(this.options,n),this),this.update=n=>(Object.assign(this.options,n),this),this.lazy=n=>(this.lazyFn=n,this),this.redirect=n=>ZF({from:this.fullPath,...n}),this.options=t||{},this.isRoot=!t?.getParentRoute,t?.id&&t?.path)throw new Error("Route cannot have both an 'id' and a 'path' option.")}get to(){return this._to}get id(){return this._id}get path(){return this._path}get fullPath(){return this._fullPath}}class g6 extends o2{constructor(t){super(t)}}const Yu=typeof window<"u"?P.useLayoutEffect:P.useEffect;function Yb(e){const t=P.useRef({value:e,prev:null}),n=t.current.value;return e!==n&&(t.current={value:e,prev:n}),t.current.prev}function v6(e,t,n={},i={}){P.useEffect(()=>{if(!e.current||i.disabled||typeof IntersectionObserver!="function")return;const s=new IntersectionObserver(([r])=>{t(r)},n);return s.observe(e.current),()=>{s.disconnect()}},[t,n,i.disabled,e])}function b6(e){const t=P.useRef(null);return P.useImperativeHandle(e,()=>t.current,[]),t}function gS(e){const t=e.errorComponent??vS;return b.jsx(y6,{getResetKey:e.getResetKey,onCatch:e.onCatch,children:({error:n,reset:i})=>n?P.createElement(t,{error:n,reset:i}):e.children})}class y6 extends P.Component{constructor(){super(...arguments),this.state={error:null}}static getDerivedStateFromProps(t){return{resetKey:t.getResetKey()}}static getDerivedStateFromError(t){return{error:t}}reset(){this.setState({error:null})}componentDidUpdate(t,n){n.error&&n.resetKey!==this.state.resetKey&&this.reset()}componentDidCatch(t,n){this.props.onCatch&&this.props.onCatch(t,n)}render(){return this.props.children({error:this.state.resetKey!==this.props.getResetKey()?null:this.state.error,reset:()=>{this.reset()}})}}function vS({error:e}){const[t,n]=P.useState(!1);return b.jsxs("div",{style:{padding:".5rem",maxWidth:"100%"},children:[b.jsxs("div",{style:{display:"flex",alignItems:"center",gap:".5rem"},children:[b.jsx("strong",{style:{fontSize:"1rem"},children:"Something went wrong!"}),b.jsx("button",{style:{appearance:"none",fontSize:".6em",border:"1px solid currentColor",padding:".1rem .2rem",fontWeight:"bold",borderRadius:".25rem"},onClick:()=>n(i=>!i),children:t?"Hide Error":"Show Error"})]}),b.jsx("div",{style:{height:".25rem"}}),t?b.jsx("div",{children:b.jsx("pre",{style:{fontSize:".7em",border:"1px solid red",borderRadius:".25rem",padding:".3rem",color:"red",overflow:"auto"},children:e.message?b.jsx("code",{children:e.message}):null})}):null]})}function _6({children:e,fallback:t=null}){return a2()?b.jsx(Un.Fragment,{children:e}):b.jsx(Un.Fragment,{children:t})}function a2(){return Un.useSyncExternalStore(S6,()=>!0,()=>!1)}function S6(){return()=>{}}var Qb={exports:{}},Jb={},Xb={exports:{}},Zb={};var WT;function C6(){if(WT)return Zb;WT=1;var e=Zd();function t(f,m){return f===m&&(f!==0||1/f===1/m)||f!==f&&m!==m}var n=typeof Object.is=="function"?Object.is:t,i=e.useState,s=e.useEffect,r=e.useLayoutEffect,a=e.useDebugValue;function o(f,m){var g=m(),C=i({inst:{value:g,getSnapshot:m}}),S=C[0].inst,v=C[1];return r(function(){S.value=g,S.getSnapshot=m,l(S)&&v({inst:S})},[f,g,m]),s(function(){return l(S)&&v({inst:S}),f(function(){l(S)&&v({inst:S})})},[f]),a(g),g}function l(f){var m=f.getSnapshot;f=f.value;try{var g=m();return!n(f,g)}catch{return!0}}function u(f,m){return m()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return Zb.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:h,Zb}var GT;function x6(){return GT||(GT=1,Xb.exports=C6()),Xb.exports}var KT;function w6(){if(KT)return Jb;KT=1;var e=Zd(),t=x6();function n(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var i=typeof Object.is=="function"?Object.is:n,s=t.useSyncExternalStore,r=e.useRef,a=e.useEffect,o=e.useMemo,l=e.useDebugValue;return Jb.useSyncExternalStoreWithSelector=function(u,h,f,m,g){var C=r(null);if(C.current===null){var S={hasValue:!1,value:null};C.current=S}else S=C.current;C=o(function(){function _(T){if(!w){if(w=!0,x=T,T=m(T),g!==void 0&&S.hasValue){var M=S.value;if(g(M,T))return k=M}return k=T}if(M=k,i(x,T))return M;var E=m(T);return g!==void 0&&g(M,E)?(x=T,M):(x=T,k=E)}var w=!1,x,k,A=f===void 0?null:f;return[function(){return _(h())},A===null?void 0:function(){return _(A())}]},[h,f,m,g]);var v=s(u,C[0],C[1]);return a(function(){S.hasValue=!0,S.value=v},[v]),l(v),v},Jb}var YT;function k6(){return YT||(YT=1,Qb.exports=w6()),Qb.exports}var T6=k6();function E6(e,t){return e===t}function R6(e,t,n=E6){const i=P.useCallback(a=>{if(!e)return()=>{};const{unsubscribe:o}=e.subscribe(a);return o},[e]),s=P.useCallback(()=>e?.get(),[e]);return T6.useSyncExternalStoreWithSelector(i,s,s,t,n)}const l2=P.createContext(null);function $n(e){const t=P.useContext(l2);return e?.warn,t}function gi(e){const t=$n({warn:e?.router===void 0}),n=e?.router||t,i=P.useRef(void 0);return R6(n.__store,s=>{if(e?.select){if(e.structuralSharing??n.options.defaultStructuralSharing){const r=Mi(i.current,e.select(s));return i.current=r,r}return e.select(s)}return s})}const Vm=P.createContext(void 0),A6=P.createContext(void 0);function Gs(e){const t=P.useContext(e.from?A6:Vm);return gi({select:i=>{const s=i.matches.find(r=>e.from?e.from===r.routeId:r.id===t);if(Br(!((e.shouldThrow??!0)&&!s),`Could not find ${e.from?`an active match from "${e.from}"`:"a nearest match!"}`),s!==void 0)return e.select?e.select(s):s},structuralSharing:e.structuralSharing})}function bS(e){return Gs({from:e.from,strict:e.strict,structuralSharing:e.structuralSharing,select:t=>e.select?e.select(t.loaderData):t.loaderData})}function yS(e){const{select:t,...n}=e;return Gs({...n,select:i=>t?t(i.loaderDeps):i.loaderDeps})}function jo(e){return Gs({from:e.from,shouldThrow:e.shouldThrow,structuralSharing:e.structuralSharing,strict:e.strict,select:t=>{const n=e.strict===!1?t.params:t._strictParams;return e.select?e.select(n):n}})}function eh(e){return Gs({from:e.from,strict:e.strict,shouldThrow:e.shouldThrow,structuralSharing:e.structuralSharing,select:t=>e.select?e.select(t.search):t.search})}function Ts(e){const t=$n();return P.useCallback(n=>t.navigate({...n,from:n.from??e?.from}),[e?.from,t])}function M6(e){const t=$n(),n=Ts(),i=P.useRef(null);return Yu(()=>{i.current!==e&&(n(e),i.current=e)},[t,e,n]),null}var _S=LL();const L6=Ga(_S);function I6(e,t){const n=$n(),i=b6(t),{activeProps:s,inactiveProps:r,activeOptions:a,to:o,preload:l,preloadDelay:u,hashScrollIntoView:h,replace:f,startTransition:m,resetScroll:g,viewTransition:C,children:S,target:v,disabled:_,style:w,className:x,onClick:k,onFocus:A,onMouseEnter:T,onMouseLeave:M,onTouchStart:E,ignoreBlocker:L,params:D,search:O,hash:j,state:U,mask:q,reloadDocument:K,unsafeRelative:$,from:Y,_fromLocation:Q,...F}=e,N=a2(),z=gi({select:se=>{const ge=se.matches[se.matches.length-1];return{search:ge?.search,hash:se.location.hash,path:ge?.pathname}},structuralSharing:!0}),G=e.from,H=P.useMemo(()=>({...e,from:G}),[n,z,G,e._fromLocation,e.hash,e.to,e.search,e.params,e.state,e.mask,e.unsafeRelative]),ee=P.useMemo(()=>n.buildLocation({...H}),[n,H]),ue=ee.maskedLocation?ee.maskedLocation.publicHref:ee.publicHref,ce=ee.maskedLocation?ee.maskedLocation.external:ee.external,J=P.useMemo(()=>B6(ue,ce,n.history,_),[_,ce,ue,n.history]),V=P.useMemo(()=>{if(J?.external)return qp(J.href,n.protocolAllowlist)?void 0:J.href;if(!F6(o)&&!(typeof o!="string"||o.indexOf(":")===-1))try{return new URL(o),qp(o,n.protocolAllowlist)?void 0:o}catch{}},[o,J,n.protocolAllowlist]),ne=gi({select:se=>{if(V)return!1;if(a?.exact){if(!NF(se.location.pathname,ee.pathname,n.basepath))return!1}else{const ge=Wp(se.location.pathname,n.basepath),Me=Wp(ee.pathname,n.basepath);if(!(ge.startsWith(Me)&&(ge.length===Me.length||ge[Me.length]==="/")))return!1}return(a?.includeSearch??!0)&&!La(se.location.search,ee.search,{partial:!a?.exact,ignoreUndefined:!a?.explicitUndefined})?!1:a?.includeHash?N&&se.location.hash===ee.hash:!0}}),he=ne?wo(s,{})??P6:ey,_e=ne?ey:wo(r,{})??ey,Ce=[x,he.className,_e.className].filter(Boolean).join(" "),we=(w||he.style||_e.style)&&{...w,...he.style,..._e.style},[Ee,qe]=P.useState(!1),yt=P.useRef(!1),Pe=e.reloadDocument||V?!1:l??n.options.defaultPreload,Ot=u??n.options.defaultPreloadDelay??0,Nt=P.useCallback(()=>{n.preloadRoute({...H,_builtLocation:ee}).catch(se=>{console.warn(se),console.warn(m6)})},[n,H,ee]),Qe=P.useCallback(se=>{se?.isIntersecting&&Nt()},[Nt]);v6(i,Qe,j6,{disabled:!!_||Pe!=="viewport"}),P.useEffect(()=>{yt.current||!_&&Pe==="render"&&(Nt(),yt.current=!0)},[_,Nt,Pe]);const Ge=se=>{const ge=se.currentTarget.getAttribute("target"),Me=v!==void 0?v:ge;if(!_&&!U6(se)&&!se.defaultPrevented&&(!Me||Me==="_self")&&se.button===0){se.preventDefault(),_S.flushSync(()=>{qe(!0)});const je=n.subscribe("onResolved",()=>{je(),qe(!1)});n.navigate({...H,replace:f,resetScroll:g,hashScrollIntoView:h,startTransition:m,viewTransition:C,ignoreBlocker:L})}};if(V)return{...F,ref:i,href:V,...S&&{children:S},...v&&{target:v},..._&&{disabled:_},...w&&{style:w},...x&&{className:x},...k&&{onClick:k},...A&&{onFocus:A},...T&&{onMouseEnter:T},...M&&{onMouseLeave:M},...E&&{onTouchStart:E}};const Ke=se=>{_||Pe&&Nt()},Te=Ke,Fe=se=>{if(!(_||!Pe))if(!Ot)Nt();else{const ge=se.target;if(Ou.has(ge))return;const Me=setTimeout(()=>{Ou.delete(ge),Nt()},Ot);Ou.set(ge,Me)}},_t=se=>{if(_||!Pe||!Ot)return;const ge=se.target,Me=Ou.get(ge);Me&&(clearTimeout(Me),Ou.delete(ge))};return{...F,...he,..._e,href:J?.href,ref:i,onClick:Nu([k,Ge]),onFocus:Nu([A,Ke]),onMouseEnter:Nu([T,Fe]),onMouseLeave:Nu([M,_t]),onTouchStart:Nu([E,Te]),disabled:!!_,target:v,...we&&{style:we},...Ce&&{className:Ce},..._&&D6,...ne&&O6,...N&&Ee&&N6}}const ey={},P6={className:"active"},D6={role:"link","aria-disabled":!0},O6={"data-status":"active","aria-current":"page"},N6={"data-transitioning":"transitioning"},Ou=new WeakMap,j6={rootMargin:"100px"},Nu=e=>t=>{for(const n of e)if(n){if(t.defaultPrevented)return;n(t)}};function B6(e,t,n,i){if(!i)return t?{href:e,external:!0}:{href:n.createHref(e)||"/",external:!1}}function F6(e){if(typeof e!="string")return!1;const t=e.charCodeAt(0);return t===47?e.charCodeAt(1)!==47:t===46}const c2=P.forwardRef((e,t)=>{const{_asChild:n,...i}=e,{type:s,...r}=I6(i,t),a=typeof i.children=="function"?i.children({isActive:r["data-status"]==="active"}):i.children;if(!n){const{disabled:o,...l}=r;return P.createElement("a",l,a)}return P.createElement(n,r,a)});function U6(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}class z6 extends o2{constructor(t){super(t),this.useMatch=n=>Gs({select:n?.select,from:this.id,structuralSharing:n?.structuralSharing}),this.useRouteContext=n=>Gs({...n,from:this.id,select:i=>n?.select?n.select(i.context):i.context}),this.useSearch=n=>eh({select:n?.select,structuralSharing:n?.structuralSharing,from:this.id}),this.useParams=n=>jo({select:n?.select,structuralSharing:n?.structuralSharing,from:this.id}),this.useLoaderDeps=n=>yS({...n,from:this.id}),this.useLoaderData=n=>bS({...n,from:this.id}),this.useNavigate=()=>Ts({from:this.fullPath}),this.Link=Un.forwardRef((n,i)=>b.jsx(c2,{ref:i,from:this.fullPath,...n})),this.$$typeof=Symbol.for("react.memo")}}function Xs(e){return new z6(e)}class H6 extends g6{constructor(t){super(t),this.useMatch=n=>Gs({select:n?.select,from:this.id,structuralSharing:n?.structuralSharing}),this.useRouteContext=n=>Gs({...n,from:this.id,select:i=>n?.select?n.select(i.context):i.context}),this.useSearch=n=>eh({select:n?.select,structuralSharing:n?.structuralSharing,from:this.id}),this.useParams=n=>jo({select:n?.select,structuralSharing:n?.structuralSharing,from:this.id}),this.useLoaderDeps=n=>yS({...n,from:this.id}),this.useLoaderData=n=>bS({...n,from:this.id}),this.useNavigate=()=>Ts({from:this.fullPath}),this.Link=Un.forwardRef((n,i)=>b.jsx(c2,{ref:i,from:this.fullPath,...n})),this.$$typeof=Symbol.for("react.memo")}}function $6(e){return new H6(e)}function QT(e){return typeof e=="object"?new JT(e,{silent:!0}).createRoute(e):new JT(e,{silent:!0}).createRoute}class JT{constructor(t,n){this.path=t,this.createRoute=i=>{this.silent;const s=Xs(i);return s.isRoot=!1,s},this.silent=n?.silent}}class XT{constructor(t){this.useMatch=n=>Gs({select:n?.select,from:this.options.id,structuralSharing:n?.structuralSharing}),this.useRouteContext=n=>Gs({from:this.options.id,select:i=>n?.select?n.select(i.context):i.context}),this.useSearch=n=>eh({select:n?.select,structuralSharing:n?.structuralSharing,from:this.options.id}),this.useParams=n=>jo({select:n?.select,structuralSharing:n?.structuralSharing,from:this.options.id}),this.useLoaderDeps=n=>yS({...n,from:this.options.id}),this.useLoaderData=n=>bS({...n,from:this.options.id}),this.useNavigate=()=>{const n=$n();return Ts({from:n.routesById[this.options.id].fullPath})},this.options=t,this.$$typeof=Symbol.for("react.memo")}}function ZT(e){return typeof e=="object"?new XT(e):t=>new XT({id:e,...t})}function q6(){const e=$n(),t=P.useRef({router:e,mounted:!1}),[n,i]=P.useState(!1),{hasPendingMatches:s,isLoading:r}=gi({select:f=>({isLoading:f.isLoading,hasPendingMatches:f.matches.some(m=>m.status==="pending")}),structuralSharing:!0}),a=Yb(r),o=r||n||s,l=Yb(o),u=r||s,h=Yb(u);return e.startTransition=f=>{i(!0),P.startTransition(()=>{f(),i(!1)})},P.useEffect(()=>{const f=e.history.subscribe(e.load),m=e.buildLocation({to:e.latestLocation.pathname,search:!0,params:!0,hash:!0,state:!0,_includeValidateSearch:!0});return Mo(e.latestLocation.publicHref)!==Mo(m.publicHref)&&e.commitLocation({...m,replace:!0}),()=>{f()}},[e,e.history]),Yu(()=>{if(typeof window<"u"&&e.ssr||t.current.router===e&&t.current.mounted)return;t.current={router:e,mounted:!0},(async()=>{try{await e.load()}catch(m){console.error(m)}})()},[e]),Yu(()=>{a&&!r&&e.emit({type:"onLoad",...Ia(e.state)})},[a,e,r]),Yu(()=>{h&&!u&&e.emit({type:"onBeforeRouteMount",...Ia(e.state)})},[u,h,e]),Yu(()=>{if(l&&!o){const f=Ia(e.state);e.emit({type:"onResolved",...f}),e.__store.setState(m=>({...m,status:"idle",resolvedLocation:m.location})),f.hrefChanged&&WF(e)}},[o,l,e]),null}function V6(e){const t=gi({select:n=>`not-found-${n.location.pathname}-${n.status}`});return b.jsx(gS,{getResetKey:()=>t,onCatch:(n,i)=>{if(Pi(n))e.onCatch?.(n,i);else throw n},errorComponent:({error:n})=>{if(Pi(n))return e.fallback?.(n);throw n},children:e.children})}function W6(){return b.jsx("p",{children:"Not Found"})}function Zl(e){return b.jsx(b.Fragment,{children:e.children})}function u2(e,t,n){return t.options.notFoundComponent?b.jsx(t.options.notFoundComponent,{...n}):e.options.defaultNotFoundComponent?b.jsx(e.options.defaultNotFoundComponent,{...n}):b.jsx(W6,{})}function G6(){return $n().isScrollRestoring,null}const d2=P.memo(function({matchId:t}){const n=$n(),i=gi({select:S=>{const v=S.matches.findIndex(w=>w.id===t),_=S.matches[v];return Br(_),{routeId:_.routeId,ssr:_.ssr,_displayPending:_._displayPending,resetKey:S.loadedAt,parentRouteId:S.matches[v-1]?.routeId}},structuralSharing:!0}),s=n.routesById[i.routeId],r=s.options.pendingComponent??n.options.defaultPendingComponent,a=r?b.jsx(r,{}):null,o=s.options.errorComponent??n.options.defaultErrorComponent,l=s.options.onCatch??n.options.defaultOnCatch,u=s.isRoot?s.options.notFoundComponent??n.options.notFoundRoute?.options.component:s.options.notFoundComponent,h=i.ssr===!1||i.ssr==="data-only",f=(!s.isRoot||s.options.wrapInSuspense||h)&&(s.options.wrapInSuspense??r??(s.options.errorComponent?.preload||h))?P.Suspense:Zl,m=o?gS:Zl,g=u?V6:Zl,C=s.isRoot?s.options.shellComponent??Zl:Zl;return b.jsxs(C,{children:[b.jsx(Vm.Provider,{value:t,children:b.jsx(f,{fallback:a,children:b.jsx(m,{getResetKey:()=>i.resetKey,errorComponent:o||vS,onCatch:(S,v)=>{if(Pi(S))throw S;l?.(S,v)},children:b.jsx(g,{fallback:S=>{if(!u||S.routeId&&S.routeId!==i.routeId||!S.routeId&&!s.isRoot)throw S;return P.createElement(u,S)},children:h||i._displayPending?b.jsx(_6,{fallback:a,children:b.jsx(eE,{matchId:t})}):b.jsx(eE,{matchId:t})})})})}),i.parentRouteId===Qi&&n.options.scrollRestoration?b.jsxs(b.Fragment,{children:[b.jsx(K6,{}),b.jsx(G6,{})]}):null]})});function K6(){const e=$n(),t=P.useRef(void 0);return b.jsx("script",{suppressHydrationWarning:!0,ref:n=>{n&&(t.current===void 0||t.current.href!==e.latestLocation.href)&&(e.emit({type:"onRendered",...Ia(e.state)}),t.current=e.latestLocation)}},e.latestLocation.state.__TSR_key)}const eE=P.memo(function({matchId:t}){const n=$n(),{match:i,key:s,routeId:r}=gi({select:l=>{const u=l.matches.find(C=>C.id===t),h=u.routeId,m=(n.routesById[h].options.remountDeps??n.options.defaultRemountDeps)?.({routeId:h,loaderDeps:u.loaderDeps,params:u._strictParams,search:u._strictSearch});return{key:m?JSON.stringify(m):void 0,routeId:h,match:{id:u.id,status:u.status,error:u.error,invalid:u.invalid,_forcePending:u._forcePending,_displayPending:u._displayPending}}},structuralSharing:!0}),a=n.routesById[r],o=P.useMemo(()=>{const l=a.options.component??n.options.defaultComponent;return l?b.jsx(l,{},s):b.jsx(Wm,{})},[s,a.options.component,n.options.defaultComponent]);if(i._displayPending)throw n.getMatch(i.id)?._nonReactive.displayPendingPromise;if(i._forcePending)throw n.getMatch(i.id)?._nonReactive.minPendingPromise;if(i.status==="pending"){const l=a.options.pendingMinMs??n.options.defaultPendingMinMs;if(l){const u=n.getMatch(i.id);if(u&&!u._nonReactive.minPendingPromise){const h=_c();u._nonReactive.minPendingPromise=h,setTimeout(()=>{h.resolve(),u._nonReactive.minPendingPromise=void 0},l)}}throw n.getMatch(i.id)?._nonReactive.loadPromise}if(i.status==="notFound")return Br(Pi(i.error)),u2(n,a,i.error);if(i.status==="redirected")throw Br(es(i.error)),n.getMatch(i.id)?._nonReactive.loadPromise;if(i.status==="error")throw i.error;return o}),Wm=P.memo(function(){const t=$n(),n=P.useContext(Vm),i=gi({select:u=>u.matches.find(h=>h.id===n)?.routeId}),s=t.routesById[i],r=gi({select:u=>{const f=u.matches.find(m=>m.id===n);return Br(f),f.globalNotFound}}),a=gi({select:u=>{const h=u.matches,f=h.findIndex(m=>m.id===n);return h[f+1]?.id}}),o=t.options.defaultPendingComponent?b.jsx(t.options.defaultPendingComponent,{}):null;if(r)return u2(t,s,void 0);if(!a)return null;const l=b.jsx(d2,{matchId:a});return i===Qi?b.jsx(P.Suspense,{fallback:o,children:l}):l});function Y6(){const e=$n(),n=e.routesById[Qi].options.pendingComponent??e.options.defaultPendingComponent,i=n?b.jsx(n,{}):null,s=typeof document<"u"&&e.ssr?Zl:P.Suspense,r=b.jsxs(s,{fallback:i,children:[b.jsx(q6,{}),b.jsx(Q6,{})]});return e.options.InnerWrap?b.jsx(e.options.InnerWrap,{children:r}):r}function Q6(){const e=$n(),t=gi({select:s=>s.matches[0]?.id}),n=gi({select:s=>s.loadedAt}),i=t?b.jsx(d2,{matchId:t}):null;return b.jsx(Vm.Provider,{value:t,children:e.options.disableGlobalCatchBoundary?i:b.jsx(gS,{getResetKey:()=>n,errorComponent:vS,onCatch:s=>{s.message||s.toString()},children:i})})}function h2(){const e=$n();return gi({select:t=>[t.location.href,t.resolvedLocation?.href,t.status],structuralSharing:!0}),P.useCallback(t=>{const{pending:n,caseSensitive:i,fuzzy:s,includeSearch:r,...a}=t;return e.matchRoute(a,{pending:n,caseSensitive:i,fuzzy:s,includeSearch:r})},[e])}const J6=e=>new X6(e);class X6 extends l6{constructor(t){super(t)}}typeof globalThis<"u"?(globalThis.createFileRoute=QT,globalThis.createLazyFileRoute=ZT):typeof window<"u"&&(window.createFileRoute=QT,window.createLazyFileRoute=ZT);function Z6({router:e,children:t,...n}){Object.keys(n).length>0&&e.update({...e.options,...n,context:{...e.options.context,...n.context}});const i=b.jsx(l2.Provider,{value:e,children:t});return e.options.Wrap?b.jsx(e.options.Wrap,{children:i}):i}function eU({router:e,...t}){return b.jsx(Z6,{router:e,...t,children:b.jsx(Y6,{})})}function kd(e){return gi({select:t=>e?.select?e.select(t.location):t.location})}function tU(){return[{value:.8,label:"80%"},{value:.9,label:"90%"},{value:1,label:"100%"},{value:1.1,label:"110%"},{value:1.2,label:"120%"}]}function mp(){return"codex-font-scale"}function Mc(){return typeof window<"u"&&typeof document<"u"}const nU=Mc()?P.useLayoutEffect:P.useEffect;function iU(e){if(!Mc())return null;try{return localStorage.getItem(e)}catch{return null}}function sU(e,t){if(Mc())try{localStorage.setItem(e,t)}catch{}}function rU(e){if(Mc())try{localStorage.removeItem(e)}catch{}}function f2(e){const t=Number(e);return t===.8||t===.9||t===1||t===1.1||t===1.2?t:1}function p2(e){Mc()&&document.documentElement.style.setProperty("--app-font-scale",String(e))}function m2(){return f2(iU(mp()))}function oU(){p2(m2())}function aU(){const[e,t]=P.useState(m2);nU(()=>{p2(e)},[e]),P.useEffect(()=>{if(!Mc())return;const i=s=>{if(s.key!==mp())return;const r=f2(s.newValue);t(r)};return window.addEventListener("storage",i),()=>window.removeEventListener("storage",i)},[]);const n=P.useCallback(i=>{t(i),i===1?rU(mp()):sU(mp(),String(i))},[]);return{fontScale:e,setFontScale:n}}function g2(){if(typeof window>"u")return!1;const e=window.location.hash.slice(1),t=new URLSearchParams(e);if(t.has("tgWebAppVersion")||t.has("tgWebAppData"))return!0;const n=window.location.search;return!!(n.includes("tgWebApp")||n.includes("initData"))}function $s(){return window.Telegram?.WebApp??null}function SS(){const e=$s();return e!==null&&!!e.initData}function lU(e=3e3){return new Promise(t=>{if(window.Telegram?.WebApp){t();return}let n=!1;const i=()=>{n||(n=!0,t())};setTimeout(i,e);const s=document.createElement("script");s.src="https://telegram.org/js/telegram-web-app.js",s.async=!0,s.onload=i,s.onerror=i,document.head.appendChild(s)})}const cU=new U4({defaultOptions:{queries:{staleTime:5e3,refetchOnWindowFocus:!1,retry:1},mutations:{retry:0}}});function CS(){const e=$s();return e?.colorScheme?e.colorScheme==="dark"?"dark":"light":typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function xS(e){document.documentElement.setAttribute("data-theme",e)}let Td=CS();const uU=new Set;xS(Td);function tE(){const e=CS();e!==Td&&(Td=e,xS(e),uU.forEach(t=>t()))}let nE=!1;function dU(){if(Td=CS(),xS(Td),!nE){nE=!0;const e=$s();e?.onEvent?e.onEvent("themeChanged",tE):typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",tE)}}function iE(e){try{const t=JSON.parse(e);return typeof t.error=="string"?t.error:void 0}catch{return}}class V_ extends Error{constructor(t,n,i,s){super(t),this.name="ApiError",this.status=n,this.code=i,this.body=s}}class Qu{constructor(t,n){this.token=t,this.baseUrl=n?.baseUrl??null,this.getToken=n?.getToken??null,this.onUnauthorized=n?.onUnauthorized??null}buildUrl(t){if(!this.baseUrl)return t;try{return new URL(t,this.baseUrl).toString()}catch{return t}}async request(t,n,i=0,s){const r=new Headers(n?.headers),a=this.getToken?this.getToken():null,o=s!==void 0?s??a??this.token:a??this.token;o&&r.set("authorization",`Bearer ${o}`),n?.body!==void 0&&!r.has("content-type")&&r.set("content-type","application/json");const l=await fetch(this.buildUrl(t),{...n,headers:r});if(l.status===401){if(i===0&&this.onUnauthorized){const u=await this.onUnauthorized();if(u)return this.token=u,await this.request(t,n,i+1,u)}throw new Error("Session expired. Please sign in again.")}if(!l.ok){const u=await l.text().catch(()=>"");throw new Error(`HTTP ${l.status} ${l.statusText}: ${u}`)}return await l.json()}async authenticate(t){const n=await fetch(this.buildUrl("/api/auth"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const i=await n.text().catch(()=>""),s=iE(i),r=i?`: ${i}`:"";throw new V_(`Auth failed: HTTP ${n.status} ${n.statusText}${r}`,n.status,s,i||void 0)}return await n.json()}async bind(t){const n=await fetch(this.buildUrl("/api/bind"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const i=await n.text().catch(()=>""),s=iE(i),r=i?`: ${i}`:"";throw new V_(`Bind failed: HTTP ${n.status} ${n.statusText}${r}`,n.status,s,i||void 0)}return await n.json()}async getSessions(){return await this.request("/api/sessions")}async getPushVapidPublicKey(){return await this.request("/api/push/vapid-public-key")}async subscribePushNotifications(t){await this.request("/api/push/subscribe",{method:"POST",body:JSON.stringify(t)})}async unsubscribePushNotifications(t){await this.request("/api/push/subscribe",{method:"DELETE",body:JSON.stringify(t)})}async setVisibility(t){await this.request("/api/visibility",{method:"POST",body:JSON.stringify(t)})}async getSession(t){return await this.request(`/api/sessions/${encodeURIComponent(t)}`)}async getMessages(t,n){const i=new URLSearchParams;n.beforeSeq!==void 0&&n.beforeSeq!==null&&i.set("beforeSeq",`${n.beforeSeq}`),n.limit!==void 0&&n.limit!==null&&i.set("limit",`${n.limit}`);const s=i.toString(),r=`/api/sessions/${encodeURIComponent(t)}/messages${s?`?${s}`:""}`;return await this.request(r)}async getGitStatus(t){return await this.request(`/api/sessions/${encodeURIComponent(t)}/git-status`)}async getGitDiffNumstat(t,n){const i=new URLSearchParams;return i.set("staged",n?"true":"false"),await this.request(`/api/sessions/${encodeURIComponent(t)}/git-diff-numstat?${i.toString()}`)}async getGitDiffFile(t,n,i){const s=new URLSearchParams;return s.set("path",n),i!==void 0&&s.set("staged",i?"true":"false"),await this.request(`/api/sessions/${encodeURIComponent(t)}/git-diff-file?${s.toString()}`)}async searchSessionFiles(t,n,i){const s=new URLSearchParams;n&&s.set("query",n),i!==void 0&&s.set("limit",`${i}`);const r=s.toString();return await this.request(`/api/sessions/${encodeURIComponent(t)}/files${r?`?${r}`:""}`)}async readSessionFile(t,n){const i=new URLSearchParams;return i.set("path",n),await this.request(`/api/sessions/${encodeURIComponent(t)}/file?${i.toString()}`)}async listSessionDirectory(t,n){const i=new URLSearchParams;n&&i.set("path",n);const s=i.toString();return await this.request(`/api/sessions/${encodeURIComponent(t)}/directory${s?`?${s}`:""}`)}async uploadFile(t,n,i,s){return await this.request(`/api/sessions/${encodeURIComponent(t)}/upload`,{method:"POST",body:JSON.stringify({filename:n,content:i,mimeType:s})})}async deleteUploadFile(t,n){return await this.request(`/api/sessions/${encodeURIComponent(t)}/upload/delete`,{method:"POST",body:JSON.stringify({path:n})})}async resumeSession(t){return(await this.request(`/api/sessions/${encodeURIComponent(t)}/resume`,{method:"POST"})).sessionId}async sendMessage(t,n,i,s){await this.request(`/api/sessions/${encodeURIComponent(t)}/messages`,{method:"POST",body:JSON.stringify({text:n,localId:i??void 0,attachments:s??void 0})})}async abortSession(t){await this.request(`/api/sessions/${encodeURIComponent(t)}/abort`,{method:"POST",body:JSON.stringify({})})}async archiveSession(t){await this.request(`/api/sessions/${encodeURIComponent(t)}/archive`,{method:"POST",body:JSON.stringify({})})}async switchSession(t){await this.request(`/api/sessions/${encodeURIComponent(t)}/switch`,{method:"POST",body:JSON.stringify({})})}async setPermissionMode(t,n){await this.request(`/api/sessions/${encodeURIComponent(t)}/permission-mode`,{method:"POST",body:JSON.stringify({mode:n})})}async setModelMode(t,n){await this.request(`/api/sessions/${encodeURIComponent(t)}/model`,{method:"POST",body:JSON.stringify({model:n})})}async approvePermission(t,n,i){const s=typeof i=="string"||i===void 0?{mode:i}:i;await this.request(`/api/sessions/${encodeURIComponent(t)}/permissions/${encodeURIComponent(n)}/approve`,{method:"POST",body:JSON.stringify(s)})}async denyPermission(t,n,i){await this.request(`/api/sessions/${encodeURIComponent(t)}/permissions/${encodeURIComponent(n)}/deny`,{method:"POST",body:JSON.stringify(i??{})})}async getMachines(){return await this.request("/api/machines")}async checkMachinePathsExists(t,n){return await this.request(`/api/machines/${encodeURIComponent(t)}/paths/exists`,{method:"POST",body:JSON.stringify({paths:n})})}async spawnSession(t,n,i,s,r,a,o){return await this.request(`/api/machines/${encodeURIComponent(t)}/spawn`,{method:"POST",body:JSON.stringify({directory:n,agent:i,model:s,yolo:r,sessionType:a,worktreeName:o})})}async getSlashCommands(t){return await this.request(`/api/sessions/${encodeURIComponent(t)}/slash-commands`)}async getSkills(t){return await this.request(`/api/sessions/${encodeURIComponent(t)}/skills`)}async renameSession(t,n){await this.request(`/api/sessions/${encodeURIComponent(t)}`,{method:"PATCH",body:JSON.stringify({name:n})})}async deleteSession(t){await this.request(`/api/sessions/${encodeURIComponent(t)}`,{method:"DELETE"})}async fetchVoiceToken(t){return await this.request("/api/voice/token",{method:"POST",body:JSON.stringify(t||{})})}}function sE(e){const t=e.split(".");if(t.length<2)return null;const n=t[1]??"",i=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(Math.ceil(n.length/4)*4,"=");try{const s=globalThis.atob(i),r=JSON.parse(s);return typeof r.exp!="number"?null:r.exp*1e3}catch{return null}}function rE(e){return e.type==="telegram"?{initData:e.initData}:{accessToken:e.token}}function oE(e){return e instanceof V_&&e.status===401&&e.code==="not_bound"}function hU(e,t){const[n,i]=P.useState(null),[s,r]=P.useState(null),[a,o]=P.useState(!1),[l,u]=P.useState(null),[h,f]=P.useState(!1),m=P.useRef(null),g=P.useRef(null),C=P.useRef(0),S=P.useRef(e);S.current=e,g.current=n;const v=P.useCallback(async x=>{const k=S.current,A=g.current;if(!k)return null;const T=A?sE(A):null,M=x?.minTtlMs??0,E=Date.now(),L=T?T-E:null,D=L!==null&&L<=M;if(!x?.force&&L!==null&&L>M||!x?.force&&!D&&E-C.current<15e3)return A;if(m.current)return await m.current;const j=(async()=>{C.current=E;try{const q=await new Qu("",{baseUrl:t}).authenticate(rE(k));return g.current=q.token,i(q.token),r(q.user),u(null),f(!1),q.token}catch(U){if(k.type==="telegram"&&oE(U))return g.current=null,i(null),r(null),u(null),f(!0),null;const q=T?Date.now()>=T:!1;if(x?.hardFail||q){g.current=null,i(null),r(null);const K=k.type==="telegram"?"Session expired. Reopen the Mini App from Telegram.":"Session expired. Please login again.";u(K)}return null}})();m.current=j;try{return await j}finally{m.current===j&&(m.current=null)}},[t]),_=P.useCallback(async x=>{const k=S.current;if(!k||k.type!=="telegram"){u("Binding is only supported in Telegram.");return}o(!0),u(null);try{const T=await new Qu("",{baseUrl:t}).bind({initData:k.initData,accessToken:x});g.current=T.token,i(T.token),r(T.user),f(!1)}catch(A){throw u(A instanceof Error?A.message:"Binding failed"),A}finally{o(!1)}},[t]),w=P.useMemo(()=>n?new Qu(n,{baseUrl:t,getToken:()=>g.current,onUnauthorized:()=>v({force:!0})}):null,[t,v,n]);return P.useEffect(()=>{let x=!1;async function k(){if(!e){f(!1);return}o(!0),u(null),f(!1);try{const T=await new Qu("",{baseUrl:t}).authenticate(rE(e));if(x)return;i(T.token),r(T.user),f(!1)}catch(A){if(x)return;if(e.type==="telegram"&&oE(A)){i(null),r(null),u(null),f(!0);return}f(!1),u(A instanceof Error?A.message:"Auth failed")}finally{x||o(!1)}}return k(),()=>{x=!0}},[e,t]),P.useEffect(()=>{g.current=null,m.current=null,C.current=0,i(null),r(null),u(null),f(!1)},[t]),P.useEffect(()=>{if(!n||!e)return;const x=sE(n);if(!x)return;let k=!1,A=null;const T=E=>{A&&clearTimeout(A),A=setTimeout(()=>{M()},Math.max(0,E))},M=async()=>{if(k)return;const E=await v({force:!0});k||!E&&Date.now()<x&&T(15e3)};return T(x-6e4-Date.now()),()=>{k=!0,A&&clearTimeout(A)}},[e,v,n]),P.useEffect(()=>{if(!e)return;const x=()=>{v({minTtlMs:6e4})},k=()=>{document.visibilityState==="visible"&&x()};return window.addEventListener("focus",x),document.addEventListener("visibilitychange",k),()=>{window.removeEventListener("focus",x),document.removeEventListener("visibilitychange",k)}},[e,v]),{token:n,user:s,api:w,isLoading:a,error:l,needsBinding:h,bind:_}}const fU="codex_access_token::";function aE(){const e=$s();if(e?.initData)return e.initData;const t=new URLSearchParams(window.location.search),n=t.get("tgWebAppData");return n||t.get("initData")||null}function pU(){return typeof window>"u"?null:new URLSearchParams(window.location.search).get("token")}function mU(e){return`${fU}${e}`}function gU(e){try{return localStorage.getItem(e)}catch{return null}}function lE(e,t){try{localStorage.setItem(e,t)}catch{}}function vU(e){try{localStorage.removeItem(e)}catch{}}function bU(e){const[t,n]=P.useState(null),[i,s]=P.useState(!0),[r,a]=P.useState(!1),o=P.useRef(0),l=P.useMemo(()=>mU(e),[e]);P.useEffect(()=>{o.current=0,n(null),a(!1),s(!0);const f=aE();if(f){n({type:"telegram",initData:f}),a(!0),s(!1);return}const m=pU();if(m){lE(l,m),n({type:"accessToken",token:m});try{const _=new URL(window.location.href);_.searchParams.delete("token"),window.history.replaceState(null,"",_.toString())}catch{}s(!1);return}const g=gU(l);if(g){n({type:"accessToken",token:g}),s(!1);return}if(!g2()){s(!1);return}const C=20,v=setInterval(()=>{o.current+=1;const _=aE();_?(n({type:"telegram",initData:_}),a(!0),s(!1),clearInterval(v)):o.current>=C&&(s(!1),clearInterval(v))},250);return()=>{clearInterval(v)}},[l]);const u=P.useCallback(f=>{lE(l,f),n({type:"accessToken",token:f})},[l]),h=P.useCallback(()=>{vU(l),n(null)},[l]);return{authSource:t,isLoading:i,isTelegram:r,setAccessToken:u,clearAuth:h}}const Yp="codex_hub_url";function wS(e){const t=e.trim();if(!t)return{ok:!1,error:"Enter a hub URL like https://example.com"};let n;try{n=new URL(t)}catch{return{ok:!1,error:"Enter a valid URL including http:// or https://"}}return n.protocol!=="http:"&&n.protocol!=="https:"?{ok:!1,error:"Hub URL must start with http:// or https://"}:{ok:!0,value:n.origin}}function yU(){if(typeof window>"u")return null;const t=new URLSearchParams(window.location.search).get("hub");if(t){const n=wS(t);return n.ok?n.value:null}return null}function _U(){try{const e=localStorage.getItem(Yp);if(!e)return null;const t=wS(e);return t.ok?t.value:(localStorage.removeItem(Yp),null)}catch{return null}}function cE(e){try{localStorage.setItem(Yp,e)}catch{}}function SU(){try{localStorage.removeItem(Yp)}catch{}}function CU(){const[e,t]=P.useState(()=>{const a=yU();return a?(cE(a),a):_U()}),n=typeof window<"u"?window.location.origin:"",i=P.useMemo(()=>e??n,[e,n]),s=P.useCallback(a=>{const o=wS(a);return o.ok&&(cE(o.value),t(o.value)),o},[]),r=P.useCallback(()=>{SU(),t(null)},[]);return{serverUrl:e,baseUrl:i,setServerUrl:s,clearServerUrl:r}}function Se(e){return!!e&&typeof e=="object"}function Xi(e){return typeof e=="string"?e:null}function ps(e){return typeof e=="number"&&Number.isFinite(e)?e:null}function To(e){if(typeof e=="string")return e;try{const t=JSON.stringify(e,null,2);return typeof t=="string"?t:String(e)}catch{return String(e)}}function If(e){return Se(e)?typeof e.role=="string"&&"content"in e:!1}function v2(e){if(If(e))return e;if(!Se(e))return null;const t=e.message;if(If(t))return t;const n=e.data;if(Se(n)&&If(n.message))return n.message;const i=e.payload;return Se(i)&&If(i.message)?i.message:null}const xU=["default","acceptEdits","bypassPermissions","plan"],wU=["default","read-only","safe-yolo","yolo"],kU=["default","read-only","safe-yolo","yolo"],TU=["default","yolo"],Pf=["default","sonnet","opus"],EU={default:"Default",acceptEdits:"Accept Edits",plan:"Plan Mode",bypassPermissions:"Yolo","read-only":"Read Only","safe-yolo":"Safe Yolo",yolo:"Yolo"},RU={default:"neutral",acceptEdits:"warning",plan:"info",bypassPermissions:"danger","read-only":"warning","safe-yolo":"warning",yolo:"danger"},AU={default:"Default",sonnet:"Sonnet",opus:"Opus"};function b2(e){return EU[e]}function y2(e){return RU[e]}function _2(e){return e==="codex"?wU:e==="gemini"?kU:e==="opencode"?TU:xU}function MU(e){return _2(e).map(t=>({mode:t,label:b2(t),tone:y2(t)}))}function S2(e,t){return _2(t).includes(e)}const LU=1,Vt={sessions:["sessions"],session:e=>["session",e],messages:e=>["messages",e],machines:["machines"],gitStatus:e=>["git-status",e],sessionFiles:(e,t)=>["session-files",e,t],sessionDirectory:(e,t)=>["session-directory",e,t],sessionFile:(e,t)=>["session-file",e,t],gitFileDiff:(e,t,n)=>["git-file-diff",e,t,n?"staged":"unstaged"],slashCommands:e=>["slash-commands",e],skills:e=>["skills",e]};function IU(e){if(!Se(e))return;const t=ps(e.date),n=e.result;if(t===null||n!=="approved"&&n!=="denied")return;const i=Xi(e.mode)??void 0,s=Array.isArray(e.allowedTools)?e.allowedTools.filter(o=>typeof o=="string"):void 0,r=e.decision;return{date:t,result:n,mode:i,allowedTools:s,decision:r==="approved"||r==="approved_for_session"||r==="denied"||r==="abort"?r:void 0}}function PU(e){return!Se(e)||typeof e.type!="string"?null:e}function DU(e,t,n,i,s){const r=Xi(i.uuid)??e,a=Xi(i.parentUuid)??null,o=!!i.isSidechain,l=Se(i.message)?i.message:null;if(!l)return null;const u=l.content,h=[];if(typeof u=="string")h.push({type:"text",text:u,uuid:r,parentUUID:a});else if(Array.isArray(u)){for(const C of u)if(!(!Se(C)||typeof C.type!="string")){if(C.type==="text"&&typeof C.text=="string"){h.push({type:"text",text:C.text,uuid:r,parentUUID:a});continue}if(C.type==="thinking"&&typeof C.thinking=="string"){h.push({type:"reasoning",text:C.thinking,uuid:r,parentUUID:a});continue}if(C.type==="tool_use"&&typeof C.id=="string"){const S=Xi(C.name)??"Tool",v="input"in C?C.input:void 0,_=Se(v)&&typeof v.description=="string"?v.description:null;h.push({type:"tool-call",id:C.id,name:S,input:v,description:_,uuid:r,parentUUID:a})}}}const f=Se(l.usage)?l.usage:null,m=f?ps(f.input_tokens):null,g=f?ps(f.output_tokens):null;return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:o,content:h,meta:s,usage:m!==null&&g!==null?{input_tokens:m,output_tokens:g,cache_creation_input_tokens:ps(f?.cache_creation_input_tokens)??void 0,cache_read_input_tokens:ps(f?.cache_read_input_tokens)??void 0,service_tier:Xi(f?.service_tier)??void 0}:void 0}}function OU(e,t,n,i,s){const r=Xi(i.uuid)??e,a=Xi(i.parentUuid)??null,o=!!i.isSidechain,l=Se(i.message)?i.message:null;if(!l)return null;const u=l.content;if(o&&typeof u=="string")return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!0,content:[{type:"sidechain",uuid:r,prompt:u}]};if(typeof u=="string")return{id:e,localId:t,createdAt:n,role:"user",isSidechain:!1,content:{type:"text",text:u},meta:s};const h=[];if(Array.isArray(u)){for(const f of u)if(!(!Se(f)||typeof f.type!="string")){if(f.type==="text"&&typeof f.text=="string"){h.push({type:"text",text:f.text,uuid:r,parentUUID:a});continue}if(f.type==="tool_result"&&typeof f.tool_use_id=="string"){const m=!!f.is_error,g="content"in f?f.content:void 0,C="toolUseResult"in i?i.toolUseResult:null,S=IU(f.permissions);h.push({type:"tool-result",tool_use_id:f.tool_use_id,content:C??g,is_error:m,uuid:r,parentUUID:a,permissions:S})}}}return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:o,content:h,meta:s}}function NU(e){if(!Se(e)||e.type!=="output")return!1;const t=Se(e.data)?e.data:null;return t?!!t.isMeta||!!t.isCompactSummary:!1}function jU(e){return Se(e)&&e.type==="codex"}function BU(e,t,n,i,s){if(!Se(i)||typeof i.type!="string")return null;if(i.type==="output"){const r=Se(i.data)?i.data:null;if(!r||typeof r.type!="string"||r.isMeta||r.isCompactSummary)return null;if(r.type==="assistant")return DU(e,t,n,r,s);if(r.type==="user")return OU(e,t,n,r,s);if(r.type==="summary"&&typeof r.summary=="string")return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"summary",summary:r.summary}],meta:s};if(r.type==="system"&&r.subtype==="api_error")return{id:e,localId:t,createdAt:n,role:"event",content:{type:"api-error",retryAttempt:ps(r.retryAttempt)??0,maxRetries:ps(r.maxRetries)??0,error:r.error},isSidechain:!1,meta:s};if(r.type==="system"&&r.subtype==="turn_duration")return{id:e,localId:t,createdAt:n,role:"event",content:{type:"turn-duration",durationMs:ps(r.durationMs)??0},isSidechain:!1,meta:s};if(r.type==="system"&&r.subtype==="microcompact_boundary"){const a=Se(r.microcompactMetadata)?r.microcompactMetadata:null;return{id:e,localId:t,createdAt:n,role:"event",content:{type:"microcompact",trigger:Xi(a?.trigger)??"auto",preTokens:ps(a?.preTokens)??0,tokensSaved:ps(a?.tokensSaved)??0},isSidechain:!1,meta:s}}if(r.type==="system"&&r.subtype==="compact_boundary"){const a=Se(r.compactMetadata)?r.compactMetadata:null;return{id:e,localId:t,createdAt:n,role:"event",content:{type:"compact",trigger:Xi(a?.trigger)??"auto",preTokens:ps(a?.preTokens)??0},isSidechain:!1,meta:s}}return null}if(i.type==="event"){const r=PU(i.data);return r?{id:e,localId:t,createdAt:n,role:"event",content:r,isSidechain:!1,meta:s}:null}if(i.type==="codex"){const r=Se(i.data)?i.data:null;if(!r||typeof r.type!="string")return null;if(r.type==="message"&&typeof r.message=="string")return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"text",text:r.message,uuid:e,parentUUID:null}],meta:s};if(r.type==="reasoning"&&typeof r.message=="string")return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"reasoning",text:r.message,uuid:e,parentUUID:null}],meta:s};if(r.type==="tool-call"&&typeof r.callId=="string"){const a=Xi(r.id)??e;return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"tool-call",id:r.callId,name:Xi(r.name)??"unknown",input:r.input,description:null,uuid:a,parentUUID:null}],meta:s}}if(r.type==="tool-call-result"&&typeof r.callId=="string"){const a=Xi(r.id)??e;return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"tool-result",tool_use_id:r.callId,content:r.output,is_error:!1,uuid:a,parentUUID:null}],meta:s}}}return null}function FU(e){if(!Array.isArray(e))return;const t=[];for(const n of e)Se(n)&&typeof n.id=="string"&&typeof n.filename=="string"&&typeof n.mimeType=="string"&&typeof n.size=="number"&&typeof n.path=="string"&&t.push({id:n.id,filename:n.filename,mimeType:n.mimeType,size:n.size,path:n.path,previewUrl:typeof n.previewUrl=="string"?n.previewUrl:void 0});return t.length>0?t:void 0}function UU(e,t,n,i,s){if(typeof i=="string")return{id:e,localId:t,createdAt:n,role:"user",content:{type:"text",text:i},isSidechain:!1,meta:s};if(Se(i)&&i.type==="text"&&typeof i.text=="string"){const r=FU(i.attachments);return{id:e,localId:t,createdAt:n,role:"user",content:{type:"text",text:i.text,attachments:r},isSidechain:!1,meta:s}}return null}function C2(e){const t=v2(e.content);if(!t)return{id:e.id,localId:e.localId,createdAt:e.createdAt,role:"agent",isSidechain:!1,content:[{type:"text",text:To(e.content),uuid:e.id,parentUUID:null}],status:e.status,originalText:e.originalText};if(t.role==="user"){const n=UU(e.id,e.localId,e.createdAt,t.content,t.meta);return n?{...n,status:e.status,originalText:e.originalText}:{id:e.id,localId:e.localId,createdAt:e.createdAt,role:"user",isSidechain:!1,content:{type:"text",text:To(t.content)},meta:t.meta,status:e.status,originalText:e.originalText}}if(t.role==="agent"){if(NU(t.content))return null;const n=BU(e.id,e.localId,e.createdAt,t.content,t.meta);return!n&&jU(t.content)?null:n?{...n,status:e.status,originalText:e.originalText}:{id:e.id,localId:e.localId,createdAt:e.createdAt,role:"agent",isSidechain:!1,content:[{type:"text",text:To(t.content),uuid:e.id,parentUUID:null}],meta:t.meta,status:e.status,originalText:e.originalText}}return{id:e.id,localId:e.localId,createdAt:e.createdAt,role:"agent",isSidechain:!1,content:[{type:"text",text:To(t.content),uuid:e.id,parentUUID:null}],meta:t.meta,status:e.status,originalText:e.originalText}}function zU(e){return typeof crypto<"u"&&"randomUUID"in crypto?`${e}-${crypto.randomUUID()}`:`${e}-${Date.now()}-${Math.random()}`}function HU(e){const t=e.content;return t&&typeof t=="object"&&"role"in t?t.role==="user":!1}function Df(e){return!!(e.localId&&e.id===e.localId)}function ty(e,t){const n=typeof e.seq=="number"?e.seq:null,i=typeof t.seq=="number"?t.seq:null;return n!==null&&i!==null&&n!==i?n-i:e.createdAt!==t.createdAt?e.createdAt-t.createdAt:e.id.localeCompare(t.id)}function Lc(e,t){if(e.length===0)return[...t].sort(ty);if(t.length===0)return[...e].sort(ty);const n=new Map;for(const l of e)n.set(l.id,l);for(const l of t)n.set(l.id,l);let i=Array.from(n.values());const s=new Set;for(const l of t)l.localId&&!Df(l)&&s.add(l.localId);s.size>0&&(i=i.filter(l=>!l.localId||!s.has(l.localId)?!0:!Df(l)));const r=i.filter(l=>Df(l)),a=i.filter(l=>!Df(l)),o=[...a];for(const l of r)l.status==="sent"&&a.some(h=>HU(h)&&Math.abs(h.createdAt-l.createdAt)<1e4)||o.push(l);return o.sort(ty),o}const ny=400,uE=200,x2=50,w2="New messages arrived while you were away. Scroll to bottom to refresh.",Ed=new Map,Ju=new Map,Qp=new Map;function $U(e){const t=Qp.get(e);if(t)return t;const n=new Map;return Qp.set(e,n),n}function k2(e){Qp.delete(e)}function qU(e,t){const n=$U(e),i=n.get(t.id);if(i&&i.source===t)return i.visible;const s=C2(t)!==null;return n.set(t.id,{source:t,visible:s}),s}function kS(e,t){let n=0;for(const i of t)qU(e,i)&&(n+=1);return n}function VU(e,t){const n=Qp.get(e);if(!n)return;const i=new Set(t.map(s=>s.id));for(const s of n.keys())i.has(s)||n.delete(s)}function TS(e){return{sessionId:e,messages:[],pending:[],pendingCount:0,pendingVisibleCount:0,pendingOverflowVisibleCount:0,hasMore:!1,oldestSeq:null,newestSeq:null,isLoading:!1,isLoadingMore:!1,warning:null,atBottom:!0,messagesVersion:0,pendingOverflowCount:0}}function Ic(e){const t=Ed.get(e);if(t)return t;const n=TS(e);return Ed.set(e,n),n}function WU(e){const t=Ju.get(e);if(t)for(const n of t)n()}function ES(e,t){Ed.set(e,t),WU(e)}function Ss(e,t){const n=Ic(e),i=t(n);i!==n&&ES(e,i)}function GU(e){let t=null,n=null;for(const i of e)typeof i.seq=="number"&&((t===null||i.seq<t)&&(t=i.seq),(n===null||i.seq>n)&&(n=i.seq));return{oldestSeq:t,newestSeq:n}}function pi(e,t){const n=t.messages??e.messages,i=t.pending??e.pending,s=t.pendingOverflowCount??e.pendingOverflowCount,r=t.pendingOverflowVisibleCount??e.pendingOverflowVisibleCount;let a=t.pendingVisibleCount??e.pendingVisibleCount;const o=i!==e.pending;o&&t.pendingVisibleCount===void 0&&(a=kS(e.sessionId,i)),o&&VU(e.sessionId,i);const l=a+r,{oldestSeq:u,newestSeq:h}=GU(n),f=n===e.messages?e.messagesVersion:e.messagesVersion+1;return{...e,messages:n,pending:i,pendingOverflowCount:s,pendingVisibleCount:a,pendingOverflowVisibleCount:r,pendingCount:l,oldestSeq:u,newestSeq:h,hasMore:t.hasMore!==void 0?t.hasMore:e.hasMore,isLoading:t.isLoading!==void 0?t.isLoading:e.isLoading,isLoadingMore:t.isLoadingMore!==void 0?t.isLoadingMore:e.isLoadingMore,warning:t.warning!==void 0?t.warning:e.warning,atBottom:t.atBottom!==void 0?t.atBottom:e.atBottom,messagesVersion:f}}function th(e,t){return e.length<=ny?e:t==="prepend"?e.slice(0,ny):e.slice(e.length-ny)}function KU(e,t){if(t.length<=uE)return{pending:t,dropped:0,droppedVisible:0};const n=t.length-uE,i=t.slice(0,n),s=t.slice(n),r=kS(e,i);return{pending:s,dropped:i.length,droppedVisible:r}}function RS(e,t){if(e.length===0||t.length===0)return e;const n=new Set(t.map(i=>i.id));return e.filter(i=>!n.has(i.id))}function YU(e){return!!(e.localId&&e.id===e.localId)}function T2(e,t){if(t.length===0)return{pending:e.pending,pendingVisibleCount:e.pendingVisibleCount,pendingOverflowCount:e.pendingOverflowCount,pendingOverflowVisibleCount:e.pendingOverflowVisibleCount,warning:e.warning};const n=Lc(e.pending,t),i=RS(n,e.messages),{pending:s,dropped:r,droppedVisible:a}=KU(e.sessionId,i),o=kS(e.sessionId,s),l=e.pendingOverflowCount+r,u=e.pendingOverflowVisibleCount+a,h=a>0&&!e.warning?w2:e.warning;return{pending:s,pendingVisibleCount:o,pendingOverflowCount:l,pendingOverflowVisibleCount:u,warning:h}}function E2(e){return Ic(e)}function QU(e,t){const n=Ju.get(e)??new Set;return n.add(t),Ju.set(e,n),()=>{const i=Ju.get(e);i&&(i.delete(t),i.size===0&&(Ju.delete(e),Ed.delete(e),k2(e)))}}function AS(e){k2(e),Ed.has(e)&&ES(e,TS(e))}function JU(e,t){if(!e||!t||e===t)return;const n=Ic(e),i=TS(t),s=pi(i,{messages:[...n.messages],pending:[...n.pending],pendingOverflowCount:n.pendingOverflowCount,pendingOverflowVisibleCount:n.pendingOverflowVisibleCount,hasMore:n.hasMore,warning:n.warning,atBottom:n.atBottom,isLoading:!1,isLoadingMore:!1});ES(t,s)}async function sd(e,t){if(!Ic(t).isLoading){Ss(t,i=>pi(i,{isLoading:!0,warning:null}));try{const i=await e.getMessages(t,{limit:x2,beforeSeq:null});Ss(t,s=>{if(s.atBottom){const a=Lc(s.messages,[...s.pending,...i.messages]),o=th(a,"append");return pi(s,{messages:o,pending:[],pendingOverflowCount:0,pendingVisibleCount:0,pendingOverflowVisibleCount:0,hasMore:i.page.hasMore,isLoading:!1,warning:null})}const r=T2(s,i.messages);return pi(s,{pending:r.pending,pendingVisibleCount:r.pendingVisibleCount,pendingOverflowCount:r.pendingOverflowCount,pendingOverflowVisibleCount:r.pendingOverflowVisibleCount,isLoading:!1,warning:r.warning})})}catch(i){const s=i instanceof Error?i.message:"Failed to load messages";Ss(t,r=>pi(r,{isLoading:!1,warning:s}))}}}async function XU(e,t){const n=Ic(t);if(!(n.isLoadingMore||!n.hasMore)&&n.oldestSeq!==null){Ss(t,i=>pi(i,{isLoadingMore:!0}));try{const i=await e.getMessages(t,{limit:x2,beforeSeq:n.oldestSeq});Ss(t,s=>{const r=Lc(i.messages,s.messages),a=th(r,"prepend");return pi(s,{messages:a,hasMore:i.page.hasMore,isLoadingMore:!1})})}catch(i){const s=i instanceof Error?i.message:"Failed to load messages";Ss(t,r=>pi(r,{isLoadingMore:!1,warning:s}))}}}function ZU(e,t){t.length!==0&&Ss(e,n=>{if(n.atBottom){const s=Lc(n.messages,t),r=th(s,"append"),a=RS(n.pending,r);return pi(n,{messages:r,pending:a})}const i=T2(n,t);return pi(n,{pending:i.pending,pendingVisibleCount:i.pendingVisibleCount,pendingOverflowCount:i.pendingOverflowCount,pendingOverflowVisibleCount:i.pendingOverflowVisibleCount,warning:i.warning})})}function e8(e){const t=Ic(e);if(t.pending.length===0&&t.pendingOverflowVisibleCount===0)return!1;const n=t.pendingOverflowVisibleCount>0;return Ss(e,i=>{const s=Lc(i.messages,i.pending),r=th(s,"append");return pi(i,{messages:r,pending:[],pendingOverflowCount:0,pendingVisibleCount:0,pendingOverflowVisibleCount:0,warning:n?i.warning??w2:i.warning})}),n}function t8(e,t){Ss(e,n=>n.atBottom===t?n:pi(n,{atBottom:t}))}function n8(e,t){Ss(e,n=>{const i=Lc(n.messages,[t]),s=th(i,"append"),r=RS(n.pending,s);return pi(n,{messages:s,pending:r,atBottom:!0})})}function iy(e,t,n){t&&Ss(e,i=>{let s=!1;const r=l=>l.map(u=>u.localId!==t||!YU(u)||u.status===n?u:(s=!0,{...u,status:n})),a=r(i.messages),o=r(i.pending);return s?pi(i,{messages:a,pending:o}):i})}function i8(){return typeof document>"u"?"hidden":document.visibilityState==="visible"?"visible":"hidden"}function s8(e,t,n,i){const s=new URLSearchParams;s.set("token",t),s.set("visibility",i),n.all&&s.set("all","true"),n.sessionId&&s.set("sessionId",n.sessionId),n.machineId&&s.set("machineId",n.machineId);const r=`/api/events?${s.toString()}`;try{return new URL(r,e).toString()}catch{return r}}function r8(e){const t=Fr(),n=P.useRef(e.onEvent),i=P.useRef(e.onConnect),s=P.useRef(e.onDisconnect),r=P.useRef(e.onError),a=P.useRef(e.onToast),o=P.useRef(null),[l,u]=P.useState(null);P.useEffect(()=>{n.current=e.onEvent},[e.onEvent]),P.useEffect(()=>{r.current=e.onError},[e.onError]),P.useEffect(()=>{i.current=e.onConnect},[e.onConnect]),P.useEffect(()=>{s.current=e.onDisconnect},[e.onDisconnect]),P.useEffect(()=>{a.current=e.onToast},[e.onToast]);const h=e.subscription??{},f=P.useMemo(()=>`${h.all?"1":"0"}|${h.sessionId??""}|${h.machineId??""}`,[h.all,h.sessionId,h.machineId]);return P.useEffect(()=>{if(!e.enabled){o.current?.close(),o.current=null,u(null);return}u(null);const m=s8(e.baseUrl,e.token,{...h,sessionId:h.sessionId??void 0},i8()),g=new EventSource(m);o.current=g;const C=v=>{if(v.type==="connection-changed"){const _=v.data;if(_&&typeof _=="object"&&"subscriptionId"in _){const w=_.subscriptionId;typeof w=="string"&&w.length>0&&u(w)}}if(v.type==="toast"){a.current?.(v);return}v.type==="message-received"&&ZU(v.sessionId,[v.message]),(v.type==="session-added"||v.type==="session-updated"||v.type==="session-removed")&&(t.invalidateQueries({queryKey:Vt.sessions}),"sessionId"in v&&(v.type==="session-removed"?(t.removeQueries({queryKey:Vt.session(v.sessionId)}),AS(v.sessionId)):t.invalidateQueries({queryKey:Vt.session(v.sessionId)}))),v.type==="machine-updated"&&t.invalidateQueries({queryKey:Vt.machines}),n.current(v)},S=v=>{if(typeof v.data!="string")return;let _;try{_=JSON.parse(v.data)}catch{return}Se(_)&&typeof _.type=="string"&&C(_)};return g.onmessage=S,g.onopen=()=>{i.current?.()},g.onerror=v=>{r.current?.(v);const _=g.readyState===EventSource.CLOSED?"closed":"error";s.current?.(_)},()=>{g.close(),o.current===g&&(o.current=null),u(null)}},[e.baseUrl,e.enabled,e.token,f,t]),{subscriptionId:l}}let sy=null;const o8=1e4,a8=3e4,l8=300;function c8(){const[e,t]=P.useState(!1),n=P.useRef(null),i=P.useRef(null);P.useEffect(()=>{const l=()=>{document.visibilityState==="hidden"&&(sy=Date.now())};return document.addEventListener("visibilitychange",l),()=>document.removeEventListener("visibilitychange",l)},[]);const s=P.useCallback(()=>{n.current&&(clearTimeout(n.current),n.current=null),i.current&&(clearTimeout(i.current),i.current=null)},[]),r=P.useCallback(()=>{s(),n.current=setTimeout(()=>{t(!0),i.current=setTimeout(()=>{t(!1)},o8)},l8)},[s]),a=P.useCallback(l=>{if(l?.force){r();return}sy&&Date.now()-sy<a8&&r()},[r]),o=P.useCallback(()=>{s(),t(!1)},[s]);return P.useEffect(()=>()=>{s()},[s]),{isSyncing:e,startSync:a,endSync:o}}function u8(){return typeof document>"u"?"hidden":document.visibilityState==="visible"?"visible":"hidden"}function d8(e){const t=P.useRef(null),n=P.useRef(null),i=P.useRef(null),s=P.useRef(!1),r=P.useRef(null),a=()=>{r.current&&(clearTimeout(r.current),r.current=null)};P.useEffect(()=>{if(e.enabled===!1){a();return}if(!e.api||!e.subscriptionId){t.current=null,n.current=e.subscriptionId??null,i.current=null,a();return}const o=e.api,l=e.subscriptionId;n.current!==l&&(n.current=l,t.current=null,i.current=null,a());const u=()=>{if(n.current!==l)return;const f=i.current;if(!f||s.current||r.current)return;if(t.current===f){i.current=null;return}s.current=!0;let m=!1;const g=l;o.setVisibility({subscriptionId:l,visibility:f}).then(()=>{n.current===g&&(t.current=f,i.current=null,a())}).catch(C=>{n.current===g&&(m=!0,console.error("Failed to update visibility:",C),r.current||(r.current=setTimeout(()=>{r.current=null,u()},2e3)))}).finally(()=>{s.current=!1,!(m||r.current)&&i.current&&i.current!==t.current&&u()})},h=()=>{const f=u8();i.current=f,u()};return h(),document.addEventListener("visibilitychange",h),()=>{document.removeEventListener("visibilitychange",h),a(),s.current=!1}},[e.api,e.enabled,e.subscriptionId])}const R2=P.createContext(null);function h8(e){return b.jsx(R2.Provider,{value:e.value,children:e.children})}function Pc(){const e=P.useContext(R2);if(!e)throw new Error("AppContext is not available");return e}function Ka(){const e=Ts(),t=$n(),n=kd({select:s=>s.pathname}),i=kd({select:s=>s.search});return P.useCallback(()=>{if(n==="/sessions/new"){e({to:"/sessions"});return}if(n==="/settings"){e({to:"/sessions"});return}if(n.match(/^\/sessions\/[^/]+\/file$/)){const s=n.replace(/\/file$/,"/files"),a=(i&&typeof i=="object"&&"tab"in i?i.tab:void 0)==="directories"?{tab:"directories"}:{};e({to:s,search:a});return}if(n.startsWith("/sessions/")){const s=n.replace(/\/[^/]+$/,"")||"/sessions";e({to:s});return}t.history.back()},[e,n,t,i])}const f8={loading:"Loading",authorizing:"Authorizing","loading.session":"Loading session","loading.git":"Loading Git status","loading.files":"Loading files","loading.messages":"Loading messages","loading.machines":"Loading machines","login.title":"Codex","login.subtitle":"Vibe Coding Anytime, Anywhere","login.bind.title":"Bind Telegram","login.submit":"Sign In","login.bind.submit":"Bind","login.submitting":"Signing in","login.bind.submitting":"Binding","login.placeholder":"Access token","login.error.enterToken":"Please enter an access token","login.error.bindingUnavailable":"Binding is unavailable.","login.error.loginUnavailable":"Login is unavailable.","login.error.bindFailed":"Binding failed","login.error.authFailed":"Authentication failed","login.help":"Needs help?","login.server.default":"(Default)","login.server.custom":"(Custom)","login.server.title":"Hub URL","login.server.description":"Set hub origin for API and live updates.","login.server.current":"Current:","login.server.origin":"Hub origin","login.server.placeholder":"https://codex.example.com","login.server.hint":"Use http(s) only. Any path is ignored.","login.server.required":"Hub URL required. Please set it before signing in.","login.server.useSameOrigin":"Use same origin","login.server.save":"Save hub","login.footer":"Designed with","login.footer.for":"for Vibe Coding","login.footer.copyright":"","sessions.count":"{n} sessions in {m} projects","sessions.new":"New Session","session.item.path":"path","session.item.agent":"agent","session.item.model":"model","session.item.modelMode":"mode","session.item.worktree":"worktree","session.item.pending":"pending","session.item.thinking":"thinking","session.time.justNow":"just now","session.time.minutesAgo":"{n}m ago","session.time.hoursAgo":"{n}h ago","session.time.daysAgo":"{n}d ago","session.title":"Files","session.more":"More actions","session.action.rename":"Rename","session.action.archive":"Archive","session.action.delete":"Delete","session.action.copy":"Copy","dialog.rename.title":"Rename Session","dialog.rename.placeholder":"Session name","dialog.rename.save":"Save","dialog.rename.saving":"Saving","dialog.rename.error":"Failed to rename. Please try again.","dialog.archive.title":"Archive Session","dialog.archive.description":'Are you sure you want to archive "{name}"? This will disconnect active session.',"dialog.archive.confirm":"Archive","dialog.archive.confirming":"Archiving","dialog.delete.title":"Delete Session","dialog.delete.description":'Are you sure you want to delete "{name}"? This action cannot be undone.',"dialog.delete.confirm":"Delete","dialog.delete.confirming":"Deleting","dialog.error.default":"Operation failed. Please try again.","button.cancel":"Cancel","button.save":"Save","button.confirm":"Confirm","button.close":"Close","button.dismiss":"Dismiss","button.copy":"Copy","button.paste":"Paste","newSession.machine":"Machine","newSession.directory":"Directory","newSession.placeholder":"/path/to/project","newSession.recent":"Recent paths","newSession.type":"Session type","newSession.type.simple":"Simple","newSession.type.simple.desc":"Use selected directory as-is","newSession.type.worktree":"Worktree","newSession.type.worktree.desc":"Create a new worktree next to repo","newSession.type.worktree.placeholder":"feature-x (default 1228-xxxx)","newSession.agent":"Agent","newSession.model":"Model","newSession.model.optional":"optional","newSession.yolo":"YOLO mode","newSession.yolo.title":"Bypass approvals and sandbox","newSession.yolo.desc":"Uses dangerous agent flags when spawning.","newSession.create":"Create","newSession.creating":"Creating","spawn.title":"Create Session","spawn.sessionType":"Session type","spawn.useAsIs":"Use selected directory as-is","spawn.createWorktree":"Create a new worktree next to repo","spawn.worktreePlaceholder":"feature-x (default 1228-xxxx)","spawn.cancel":"Cancel","spawn.create":"Create Session","spawn.creating":"Creating","machine.unknown":"Unknown platform","chat.placeholder":"Type a message","chat.send":"Send","chat.abort":"Abort","chat.settings":"Settings","chat.terminal":"Terminal","chat.switchRemote":"Switch to remote mode","terminal.commandName":"Command","terminal.commandMessage":"Command message","terminal.commandArgs":"Command args","terminal.stdout":"Stdout","terminal.stderr":"Stderr","terminal.paste.fallbackTitle":"Paste input","terminal.paste.fallbackDescription":"Clipboard read is unavailable. Paste your text below.","terminal.paste.placeholder":"Paste terminal input here","code.copy":"Copy","diff.title":"Diff","diff.view":"View","tool.askQuestion":"Other","tool.edit":"Edit","tool.multiedit":"Multi-edit","tool.write":"Write","tool.todo":"Todo","tool.confirm":"Confirm","tool.deny":"Deny","tool.abort":"Abort","tool.allow":"Allow","tool.allowAll":"Allow all edits","tool.denyAll":"Deny all edits","tool.approved":"Approved","tool.rejected":"Rejected","tool.cancel":"Cancel","tool.exitPlan":"Exit Plan Mode","tool.patch":"Patch","tool.input":"Input","tool.result":"Result","tool.questionsAnswers":"Questions & Answers","tool.submit":"Submit","tool.submitting":"Submitting","tool.prev":" Prev","tool.next":"Next ","tool.yes":"Yes","tool.yesForSession":"Yes for session","tool.allowForSession":"Allow for session","tool.abortLabel":"Abort","tool.other":"Other","tool.otherDescription":"Type your own answer","tool.question":"Question","tool.selectOption":"Please select at least one option or type an answer.","tool.waitingForApproval":"Waiting for approval","tool.canceled":"Canceled","tool.approvedForSession":"Approved for session","tool.aborted":"Aborted","tool.approvedAllowAllEdits":"Approved: Allow all edits","tool.requestFailed":"Request failed","tool.askUserQuestion.fallback":"AskUserQuestion payload is not in the expected format. Type your answer:","tool.askUserQuestion.placeholder":"Type your answer","tool.askUserQuestion.otherPlaceholder":"Or type your own answer","tool.requestUserInput.textPlaceholder":"Type your answer","tool.requestUserInput.noteLabel":"Additional note (optional)","tool.requestUserInput.notePlaceholder":"Add a note","composer.settings":"Settings","composer.terminal":"Terminal","composer.abort":"Abort","composer.switchRemote":"Switch to remote mode","composer.attach":"Attach file","composer.send":"Send","composer.stop":"Stop","composer.voice":"Voice assistant","voice.connecting":"Connecting...","voice.active":"Active","voice.muted":"Muted","voice.error":"Error","voice.mute":"Mute","voice.unmute":"Unmute","voice.end":"End","voice.error.micPermission":"Microphone permission denied","voice.error.network":"Network error","voice.error.notInitialized":"Voice session not initialized","voice.error.startFailed":"Failed to start voice session","voice.error.notAllowed":"Voice not allowed","voice.error.connection":"Connection error","voice.dismiss":"Dismiss","offline.title":"Offline","offline.message":"You are currently offline. Some features may be limited.","syncing.title":"Syncing","syncing.message":"Your data is being synchronized.","reconnecting.message":"Reconnecting...","send.blocked.title":"Cannot send message","send.blocked.noConnection":"Not connected to server","install.title":"Install Codex","install.description":"Add Codex to your home screen for quick access.","install.button":"Install","language.title":"Language","language.english":"English","language.chinese":"","settings.title":"Settings","settings.language.title":"Language","settings.language.label":"Language","settings.display.title":"Display","settings.display.fontSize":"Font Size","settings.voice.title":"Voice Assistant","settings.voice.language":"Voice Language","settings.voice.autoDetect":"Auto-detect","settings.about.title":"About","settings.about.website":"Website","settings.about.appVersion":"App Version","settings.about.protocolVersion":"Protocol Version","misc.noMachines":"No machines available","misc.machine":"Machine","misc.permissionMode":"Permission Mode","misc.model":"Model","misc.loading":"Loading","misc.loadOlder":"Load older","misc.newMessage":"{n} new message{s}","misc.loadingMessages":"Loading messages","misc.typeMessage":"Type 'continue' to resume...","misc.typeAMessage":"Type a message...","misc.offline":"offline","misc.permissionRequired":"permission required","misc.percentLeft":"{percent}% left","misc.online":"online"},p8={loading:"",authorizing:"","loading.session":"","loading.git":" Git ","loading.files":"","loading.messages":"","loading.machines":"","login.title":"Codex","login.subtitle":"Vibe Coding","login.bind.title":" Telegram","login.submit":"","login.bind.submit":"","login.submitting":"","login.bind.submitting":"","login.placeholder":"","login.error.enterToken":"","login.error.bindingUnavailable":"","login.error.loginUnavailable":"","login.error.bindFailed":"","login.error.authFailed":"","login.help":"","login.server.default":"()","login.server.custom":"()","login.server.title":"","login.server.description":" Codex  API ","login.server.current":"","login.server.origin":"","login.server.placeholder":"https://codex.example.com","login.server.hint":" http(s) ","login.server.required":"","login.server.useSameOrigin":"","login.server.save":"","login.footer":"","login.footer.for":"Vibe Coding","login.footer.copyright":"","sessions.count":"{n} {m} ","sessions.new":"","session.item.path":"","session.item.agent":"","session.item.model":"","session.item.modelMode":"","session.item.worktree":"","session.item.pending":"","session.item.thinking":"","session.time.justNow":"","session.time.minutesAgo":"{n} ","session.time.hoursAgo":"{n} ","session.time.daysAgo":"{n} ","session.title":"","session.more":"","session.action.rename":"","session.action.archive":"","session.action.delete":"","session.action.copy":"","dialog.rename.title":"","dialog.rename.placeholder":"","dialog.rename.save":"","dialog.rename.saving":"","dialog.rename.error":"","dialog.archive.title":"","dialog.archive.description":' "{name}" ',"dialog.archive.confirm":"","dialog.archive.confirming":"","dialog.delete.title":"","dialog.delete.description":' "{name}" ',"dialog.delete.confirm":"","dialog.delete.confirming":"","dialog.error.default":"","button.cancel":"","button.save":"","button.confirm":"","button.close":"","button.dismiss":"","button.copy":"","button.paste":"","newSession.machine":"","newSession.directory":"","newSession.placeholder":"/path/to/project","newSession.recent":"","newSession.type":"","newSession.type.simple":"","newSession.type.simple.desc":"","newSession.type.worktree":"","newSession.type.worktree.desc":"","newSession.type.worktree.placeholder":"feature-x ( 1228-xxxx)","newSession.agent":"","newSession.model":"","newSession.model.optional":"","newSession.yolo":"YOLO ","newSession.yolo.title":"","newSession.yolo.desc":"","newSession.create":"","newSession.creating":"","spawn.title":"","spawn.sessionType":"","spawn.useAsIs":"","spawn.createWorktree":"","spawn.worktreePlaceholder":"feature-x ( 1228-xxxx)","spawn.cancel":"","spawn.create":"","spawn.creating":"","machine.unknown":"","chat.placeholder":"","chat.send":"","chat.abort":"","chat.settings":"","chat.terminal":"","chat.switchRemote":"","terminal.commandName":"","terminal.commandMessage":"","terminal.commandArgs":"","terminal.stdout":"","terminal.stderr":"","terminal.paste.fallbackTitle":"","terminal.paste.fallbackDescription":"","terminal.paste.placeholder":"","code.copy":"","diff.title":"","diff.view":"","tool.askQuestion":"","tool.edit":"","tool.multiedit":"","tool.write":"","tool.todo":"","tool.confirm":"","tool.deny":"","tool.abort":"","tool.allow":"","tool.allowAll":"","tool.denyAll":"","tool.approved":"","tool.rejected":"","tool.cancel":"","tool.exitPlan":"","tool.patch":"","tool.input":"","tool.result":"","tool.questionsAnswers":"","tool.submit":"","tool.submitting":"","tool.prev":" ","tool.next":" ","tool.yes":"","tool.yesForSession":"","tool.allowForSession":"","tool.abortLabel":"","tool.other":"","tool.otherDescription":"","tool.question":"","tool.selectOption":"","tool.waitingForApproval":"","tool.canceled":"","tool.approvedForSession":"","tool.aborted":"","tool.approvedAllowAllEdits":"","tool.requestFailed":"","tool.askUserQuestion.fallback":"AskUserQuestion ","tool.askUserQuestion.placeholder":"","tool.askUserQuestion.otherPlaceholder":"","tool.requestUserInput.textPlaceholder":"","tool.requestUserInput.noteLabel":"","tool.requestUserInput.notePlaceholder":"","composer.settings":"","composer.terminal":"","composer.abort":"","composer.switchRemote":"","composer.attach":"","composer.send":"","composer.stop":"","composer.voice":"","voice.connecting":"...","voice.active":"","voice.muted":"","voice.error":"","voice.mute":"","voice.unmute":"","voice.end":"","voice.error.micPermission":"","voice.error.network":"","voice.error.notInitialized":"","voice.error.startFailed":"","voice.error.notAllowed":"","voice.error.connection":"","voice.dismiss":"","offline.title":"","offline.message":"","syncing.title":"","syncing.message":"","reconnecting.message":"...","send.blocked.title":"","send.blocked.noConnection":"","install.title":" Codex","install.description":" Codex ","install.button":"","language.title":"","language.english":"English","language.chinese":"","settings.title":"","settings.language.title":"","settings.language.label":"","settings.display.title":"","settings.display.fontSize":"","settings.voice.title":"","settings.voice.language":"","settings.voice.autoDetect":"","settings.about.title":"","settings.about.website":"","settings.about.appVersion":"","settings.about.protocolVersion":"","misc.noMachines":"","misc.machine":"","misc.permissionMode":"","misc.model":"","misc.loading":"","misc.loadOlder":"","misc.newMessage":"{n} ","misc.loadingMessages":"","misc.typeMessage":" 'continue' ...","misc.typeAMessage":"...","misc.offline":"","misc.permissionRequired":"","misc.percentLeft":" {percent}%","misc.online":""},A2=P.createContext(null),ry={en:f8,"zh-CN":p8};function m8(e,t){return t?e.replace(/\{(\w+)\}/g,(n,i)=>{const s=t[i];return s!==void 0?String(s):n}):e}function g8({children:e}){const[t,n]=P.useState(()=>{const r=localStorage.getItem("codex-lang");return r==="en"||r==="zh-CN"?r:"en"}),i=P.useCallback(r=>{n(r),localStorage.setItem("codex-lang",r),document.documentElement.lang=r},[]),s=P.useCallback((r,a)=>{const l=(ry[t]??ry.en)[r],u=ry.en[r]??r;return m8(l??u,a)},[t]);return P.useEffect(()=>{document.documentElement.lang=t},[t]),b.jsx(A2.Provider,{value:{t:s,locale:t,setLocale:i},children:e})}function ot(){const e=P.useContext(A2);if(!e)throw new Error("useTranslation must be used within I18nProvider");return e}let Ua=null,Rd=!1,Ad=null;async function v8(e,t,n){if(!Ua){console.warn("[Voice] No voice session registered");return}try{Ad=e,await Ua.startSession({sessionId:e,initialContext:t,language:n}),Rd=!0}catch(i){console.error("[Voice] Failed to start realtime session:",i),Ad=null,Rd=!1}}async function b8(){if(Ua)try{await Ua.endSession(),Ad=null,Rd=!1}catch(e){console.error("[Voice] Failed to stop realtime session:",e)}}function y8(){Ad=null,Rd=!1}function _8(e){Ua&&console.warn("[Voice] Voice session already registered, replacing with new one"),Ua=e}function M2(){return Rd}function L2(){return Ua}function dE(){return Ad}let ba=null;function I2(e){ba=e}const S8={messageCodingAgent:async e=>{const t=e;if(!t.message||typeof t.message!="string"||t.message.trim()==="")return console.error("[Voice] Invalid message parameter:",e),"error (invalid message parameter)";const n=t.message.trim(),i=dE();return i?ba?(ba.sendMessage(i,n),"sent [DO NOT say anything else, simply say 'sent']"):(console.error("[Voice] Session store not registered"),"error (session store not available)"):(console.error("[Voice] No active session"),"error (no active session)")},processPermissionRequest:async e=>{const t=e;if(!t.decision||t.decision!=="allow"&&t.decision!=="deny")return console.error("[Voice] Invalid decision parameter:",e),"error (invalid decision parameter, expected 'allow' or 'deny')";const n=t.decision,i=dE();if(!i)return console.error("[Voice] No active session"),"error (no active session)";if(!ba)return console.error("[Voice] Session store not registered"),"error (session store not available)";const r=ba.getSession(i)?.agentState?.requests;if(!r||Object.keys(r).length===0)return console.error("[Voice] No active permission request"),"error (no active permission request)";const a=Object.keys(r)[0];try{return n==="allow"?await ba.approvePermission(i,a):await ba.denyPermission(i,a),"done [DO NOT say anything else, simply say 'done']"}catch(o){return console.error("[Voice] Failed to process permission:",o),`error (failed to ${n} permission)`}}};var hE={};function C8(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var x8=Object.defineProperty,w8=(e,t,n)=>t in e?x8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fE=(e,t,n)=>w8(e,typeof t!="symbol"?t+"":t,n);let ni=class{constructor(){fE(this,"_locking"),fE(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const n=new Promise(s=>t=()=>{this._locks-=1,s()}),i=this._locking.then(()=>t);return this._locking=this._locking.then(()=>n),i}};function tn(e,t){if(!e)throw new Error(t)}const k8=34028234663852886e22,T8=-34028234663852886e22,E8=4294967295,R8=2147483647,A8=-2147483648;function gp(e){if(typeof e!="number")throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>R8||e<A8)throw new Error("invalid int 32: "+e)}function W_(e){if(typeof e!="number")throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>E8||e<0)throw new Error("invalid uint 32: "+e)}function P2(e){if(typeof e!="number")throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>k8||e<T8))throw new Error("invalid float 32: "+e)}const D2=Symbol("@bufbuild/protobuf/enum-type");function M8(e){const t=e[D2];return tn(t,"missing enum type on enum object"),t}function O2(e,t,n,i){e[D2]=N2(t,n.map(s=>({no:s.no,name:s.name,localName:e[s.no]})))}function N2(e,t,n){const i=Object.create(null),s=Object.create(null),r=[];for(const a of t){const o=j2(a);r.push(o),i[a.name]=o,s[a.no]=o}return{typeName:e,values:r,findName(a){return i[a]},findNumber(a){return s[a]}}}function L8(e,t,n){const i={};for(const s of t){const r=j2(s);i[r.localName]=r.no,i[r.no]=r.localName}return O2(i,e,t),i}function j2(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class MS{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,n){const i=this.getType(),s=i.runtime.bin,r=s.makeReadOptions(n);return s.readMessage(this,r.readerFactory(t),t.byteLength,r),this}fromJson(t,n){const i=this.getType(),s=i.runtime.json,r=s.makeReadOptions(n);return s.readMessage(i,t,r,this),this}fromJsonString(t,n){let i;try{i=JSON.parse(t)}catch(s){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(s instanceof Error?s.message:String(s)))}return this.fromJson(i,n)}toBinary(t){const n=this.getType(),i=n.runtime.bin,s=i.makeWriteOptions(t),r=s.writerFactory();return i.writeMessage(this,r,s),r.finish()}toJson(t){const n=this.getType(),i=n.runtime.json,s=i.makeWriteOptions(t);return i.writeMessage(this,s)}toJsonString(t){var n;const i=this.toJson(t);return JSON.stringify(i,null,(n=t?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function I8(e,t,n,i){var s;const r=(s=i?.localName)!==null&&s!==void 0?s:t.substring(t.lastIndexOf(".")+1),a={[r]:function(o){e.util.initFields(this),e.util.initPartial(o,this)}}[r];return Object.setPrototypeOf(a.prototype,new MS),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary(o,l){return new a().fromBinary(o,l)},fromJson(o,l){return new a().fromJson(o,l)},fromJsonString(o,l){return new a().fromJsonString(o,l)},equals(o,l){return e.util.equals(a,o,l)}}),a}function P8(){let e=0,t=0;for(let i=0;i<28;i+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<i,(s&128)==0)return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(n&15)<<28,t=(n&112)>>4,(n&128)==0)return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let s=this.buf[this.pos++];if(t|=(s&127)<<i,(s&128)==0)return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function oy(e,t,n){for(let r=0;r<28;r=r+7){const a=e>>>r,o=!(!(a>>>7)&&t==0),l=(o?a|128:a)&255;if(n.push(l),!o)return}const i=e>>>28&15|(t&7)<<4,s=t>>3!=0;if(n.push((s?i|128:i)&255),!!s){for(let r=3;r<31;r=r+7){const a=t>>>r,o=!!(a>>>7),l=(o?a|128:a)&255;if(n.push(l),!o)return}n.push(t>>>31&1)}}const vp=4294967296;function pE(e){const t=e[0]==="-";t&&(e=e.slice(1));const n=1e6;let i=0,s=0;function r(a,o){const l=Number(e.slice(a,o));s*=n,i=i*n+l,i>=vp&&(s=s+(i/vp|0),i=i%vp)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),t?F2(i,s):LS(i,s)}function D8(e,t){let n=LS(e,t);const i=n.hi&2147483648;i&&(n=F2(n.lo,n.hi));const s=B2(n.lo,n.hi);return i?"-"+s:s}function B2(e,t){if({lo:e,hi:t}=O8(e,t),t<=2097151)return String(vp*t+e);const n=e&16777215,i=(e>>>24|t<<8)&16777215,s=t>>16&65535;let r=n+i*6777216+s*6710656,a=i+s*8147497,o=s*2;const l=1e7;return r>=l&&(a+=Math.floor(r/l),r%=l),a>=l&&(o+=Math.floor(a/l),a%=l),o.toString()+mE(a)+mE(r)}function O8(e,t){return{lo:e>>>0,hi:t>>>0}}function LS(e,t){return{lo:e|0,hi:t|0}}function F2(e,t){return t=~t,e?e=~e+1:t+=1,LS(e,t)}const mE=e=>{const t=String(e);return"0000000".slice(t.length)+t};function gE(e,t){if(e>=0){for(;e>127;)t.push(e&127|128),e=e>>>7;t.push(e)}else{for(let n=0;n<9;n++)t.push(e&127|128),e=e>>7;t.push(1)}}function N8(){let e=this.buf[this.pos++],t=e&127;if((e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<7,(e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<14,(e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<21,(e&128)==0)return this.assertBounds(),t;e=this.buf[this.pos++],t|=(e&15)<<28;for(let n=5;(e&128)!==0&&n<10;n++)e=this.buf[this.pos++];if((e&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function j8(){const e=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof e.getBigInt64=="function"&&typeof e.getBigUint64=="function"&&typeof e.setBigInt64=="function"&&typeof e.setBigUint64=="function"&&(typeof process!="object"||typeof hE!="object"||hE.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),a=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const u=typeof l=="bigint"?l:BigInt(l);if(u>r||u<s)throw new Error("int64 invalid: ".concat(l));return u},uParse(l){const u=typeof l=="bigint"?l:BigInt(l);if(u>o||u<a)throw new Error("uint64 invalid: ".concat(l));return u},enc(l){return e.setBigInt64(0,this.parse(l),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(l){return e.setBigInt64(0,this.uParse(l),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec(l,u){return e.setInt32(0,l,!0),e.setInt32(4,u,!0),e.getBigInt64(0,!0)},uDec(l,u){return e.setInt32(0,l,!0),e.setInt32(4,u,!0),e.getBigUint64(0,!0)}}}const n=s=>tn(/^-?[0-9]+$/.test(s),"int64 invalid: ".concat(s)),i=s=>tn(/^[0-9]+$/.test(s),"uint64 invalid: ".concat(s));return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),n(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),i(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),n(s),pE(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),i(s),pE(s)},dec(s,r){return D8(s,r)},uDec(s,r){return B2(s,r)}}}const Kt=j8();var be;(function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"})(be||(be={}));var Do;(function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"})(Do||(Do={}));function fo(e,t,n){if(t===n)return!0;if(e==be.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array)||t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}switch(e){case be.UINT64:case be.FIXED64:case be.INT64:case be.SFIXED64:case be.SINT64:return t==n}return!1}function Cc(e,t){switch(e){case be.BOOL:return!1;case be.UINT64:case be.FIXED64:case be.INT64:case be.SFIXED64:case be.SINT64:return t==0?Kt.zero:"0";case be.DOUBLE:case be.FLOAT:return 0;case be.BYTES:return new Uint8Array(0);case be.STRING:return"";default:return 0}}function U2(e,t){switch(e){case be.BOOL:return t===!1;case be.STRING:return t==="";case be.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var cn;(function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"})(cn||(cn={}));class B8{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let s=0;s<this.chunks.length;s++)t+=this.chunks[s].length;let n=new Uint8Array(t),i=0;for(let s=0;s<this.chunks.length;s++)n.set(this.chunks[s],i),i+=this.chunks[s].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,n){return this.uint32((t<<3|n)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(W_(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return gp(t),gE(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let n=this.textEncoder.encode(t);return this.uint32(n.byteLength),this.raw(n)}float(t){P2(t);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,t,!0),this.raw(n)}double(t){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,t,!0),this.raw(n)}fixed32(t){W_(t);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t,!0),this.raw(n)}sfixed32(t){gp(t);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,t,!0),this.raw(n)}sint32(t){return gp(t),t=(t<<1^t>>31)>>>0,gE(t,this.buf),this}sfixed64(t){let n=new Uint8Array(8),i=new DataView(n.buffer),s=Kt.enc(t);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(n)}fixed64(t){let n=new Uint8Array(8),i=new DataView(n.buffer),s=Kt.uEnc(t);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(n)}int64(t){let n=Kt.enc(t);return oy(n.lo,n.hi,this.buf),this}sint64(t){let n=Kt.enc(t),i=n.hi>>31,s=n.lo<<1^i,r=(n.hi<<1|n.lo>>>31)^i;return oy(s,r,this.buf),this}uint64(t){let n=Kt.uEnc(t);return oy(n.lo,n.hi,this.buf),this}}class F8{constructor(t,n){this.varint64=P8,this.uint32=N8,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=n??new TextDecoder}tag(){let t=this.uint32(),n=t>>>3,i=t&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(t,n){let i=this.pos;switch(t){case cn.Varint:for(;this.buf[this.pos++]&128;);break;case cn.Bit64:this.pos+=4;case cn.Bit32:this.pos+=4;break;case cn.LengthDelimited:let s=this.uint32();this.pos+=s;break;case cn.StartGroup:for(;;){const[r,a]=this.tag();if(a===cn.EndGroup){if(n!==void 0&&r!==n)throw new Error("invalid end group tag");break}this.skip(a,r)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return Kt.dec(...this.varint64())}uint64(){return Kt.uDec(...this.varint64())}sint64(){let[t,n]=this.varint64(),i=-(t&1);return t=(t>>>1|(n&1)<<31)^i,n=n>>>1^i,Kt.dec(t,n)}bool(){let[t,n]=this.varint64();return t!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Kt.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Kt.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),n=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(n,n+t)}string(){return this.textDecoder.decode(this.bytes())}}function U8(e,t,n,i){let s;return{typeName:t,extendee:n,get field(){if(!s){const r=typeof i=="function"?i():i;r.name=t.split(".").pop(),r.jsonName="[".concat(t,"]"),s=e.util.newFieldList([r]).list()[0]}return s},runtime:e}}function z2(e){const t=e.field.localName,n=Object.create(null);return n[t]=z8(e),[n,()=>n[t]]}function z8(e){const t=e.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return Cc(t.T,t.L);case"message":const n=t.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function H8(e,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(n=>n.no===t.no)}let Lr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Gm=[];for(let e=0;e<Lr.length;e++)Gm[Lr[e].charCodeAt(0)]=e;Gm[45]=Lr.indexOf("+");Gm[95]=Lr.indexOf("/");const H2={dec(e){let t=e.length*3/4;e[e.length-2]=="="?t-=2:e[e.length-1]=="="&&(t-=1);let n=new Uint8Array(t),i=0,s=0,r,a=0;for(let o=0;o<e.length;o++){if(r=Gm[e.charCodeAt(o)],r===void 0)switch(e[o]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:a=r,s=1;break;case 1:n[i++]=a<<2|(r&48)>>4,a=r,s=2;break;case 2:n[i++]=(a&15)<<4|(r&60)>>2,a=r,s=3;break;case 3:n[i++]=(a&3)<<6|r,s=0;break}}if(s==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(e){let t="",n=0,i,s=0;for(let r=0;r<e.length;r++)switch(i=e[r],n){case 0:t+=Lr[i>>2],s=(i&3)<<4,n=1;break;case 1:t+=Lr[s|i>>4],s=(i&15)<<2,n=2;break;case 2:t+=Lr[s|i>>6],t+=Lr[i&63],n=0;break}return n&&(t+=Lr[s],t+="=",n==1&&(t+="=")),t}};function $8(e,t,n){q2(t,e);const i=t.runtime.bin.makeReadOptions(n),s=H8(e.getType().runtime.bin.listUnknownFields(e),t.field),[r,a]=z2(t);for(const o of s)t.runtime.bin.readField(r,i.readerFactory(o.data),t.field,o.wireType,i);return a()}function q8(e,t,n,i){q2(t,e);const s=t.runtime.bin.makeReadOptions(i),r=t.runtime.bin.makeWriteOptions(i);if($2(e,t)){const u=e.getType().runtime.bin.listUnknownFields(e).filter(h=>h.no!=t.field.no);e.getType().runtime.bin.discardUnknownFields(e);for(const h of u)e.getType().runtime.bin.onUnknownField(e,h.no,h.wireType,h.data)}const a=r.writerFactory();let o=t.field;!o.opt&&!o.repeated&&(o.kind=="enum"||o.kind=="scalar")&&(o=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(o,n,a,r);const l=s.readerFactory(a.finish());for(;l.pos<l.len;){const[u,h]=l.tag(),f=l.skip(h,u);e.getType().runtime.bin.onUnknownField(e,u,h,f)}}function $2(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(i=>i.no==t.field.no)}function q2(e,t){tn(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function V2(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?t[n]!==void 0:e.kind=="enum"?t[n]!==e.T.values[0].no:!U2(e.T,t[n]);case"message":return t[n]!==void 0;case"map":return Object.keys(t[n]).length>0}}function vE(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?Cc(e.T,e.L):void 0;break;case"message":t[n]=void 0;break}}function Ir(e,t){if(e===null||typeof e!="object"||!Object.getOwnPropertyNames(MS.prototype).every(i=>i in e&&typeof e[i]=="function"))return!1;const n=e.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:t===void 0?!0:n.typeName==t.typeName}function W2(e,t){return Ir(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}be.DOUBLE,be.FLOAT,be.INT64,be.UINT64,be.INT32,be.UINT32,be.BOOL,be.STRING,be.BYTES;const bE={ignoreUnknownFields:!1},yE={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function V8(e){return e?Object.assign(Object.assign({},bE),e):bE}function W8(e){return e?Object.assign(Object.assign({},yE),e):yE}const Jp=Symbol(),bp=Symbol();function G8(){return{makeReadOptions:V8,makeWriteOptions:W8,readMessage(e,t,n,i){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(Us(t)));i=i??new e;const s=new Map,r=n.typeRegistry;for(const[a,o]of Object.entries(t)){const l=e.fields.findJsonName(a);if(l){if(l.oneof){if(o===null&&l.kind=="scalar")continue;const u=s.get(l.oneof);if(u!==void 0)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(u,'", "').concat(a,'"'));s.set(l.oneof,a)}_E(i,o,l,n,e)}else{let u=!1;if(r?.findExtension&&a.startsWith("[")&&a.endsWith("]")){const h=r.findExtension(a.substring(1,a.length-1));if(h&&h.extendee.typeName==e.typeName){u=!0;const[f,m]=z2(h);_E(f,o,h.field,n,h),q8(i,h,m(),n)}}if(!u&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let s;try{for(s of n.fields.byNumber()){if(!V2(s,e)){if(s.req)throw"required field not set";if(!t.emitDefaultValues||!Y8(s))continue}const a=s.oneof?e[s.oneof.localName].value:e[s.localName],o=SE(s,a,t);o!==void 0&&(i[t.useProtoFieldName?s.name:s.jsonName]=o)}const r=t.typeRegistry;if(r?.findExtensionFor)for(const a of n.runtime.bin.listUnknownFields(e)){const o=r.findExtensionFor(n.typeName,a.no);if(o&&$2(e,o)){const l=$8(e,o,t),u=SE(o.field,l,t);u!==void 0&&(i[o.field.jsonName]=u)}}}catch(r){const a=s?"cannot encode field ".concat(n.typeName,".").concat(s.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),o=r instanceof Error?r.message:String(r);throw new Error(a+(o.length>0?": ".concat(o):""))}return i},readScalar(e,t,n){return rd(e,t,n??Do.BIGINT,!0)},writeScalar(e,t,n){if(t!==void 0&&(n||U2(e,t)))return yp(e,t)},debug:Us}}function Us(e){if(e===null)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function _E(e,t,n,i,s){let r=n.localName;if(n.repeated){if(tn(n.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Us(t)));const a=e[r];for(const o of t){if(o===null)throw new Error("cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Us(o)));switch(n.kind){case"message":a.push(n.T.fromJson(o,i));break;case"enum":const l=ay(n.T,o,i.ignoreUnknownFields,!0);l!==bp&&a.push(l);break;case"scalar":try{a.push(rd(n.T,o,n.L,!0))}catch(u){let h="cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Us(o));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}break}}}else if(n.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Us(t)));const a=e[r];for(const[o,l]of Object.entries(t)){if(l===null)throw new Error("cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: map value null"));let u;try{u=K8(n.K,o)}catch(h){let f="cannot decode map key for field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Us(t));throw h instanceof Error&&h.message.length>0&&(f+=": ".concat(h.message)),new Error(f)}switch(n.V.kind){case"message":a[u]=n.V.T.fromJson(l,i);break;case"enum":const h=ay(n.V.T,l,i.ignoreUnknownFields,!0);h!==bp&&(a[u]=h);break;case"scalar":try{a[u]=rd(n.V.T,l,Do.BIGINT,!0)}catch(f){let m="cannot decode map value for field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Us(t));throw f instanceof Error&&f.message.length>0&&(m+=": ".concat(f.message)),new Error(m)}break}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:r},r="value"),n.kind){case"message":const a=n.T;if(t===null&&a.typeName!="google.protobuf.Value")return;let o=e[r];Ir(o)?o.fromJson(t,i):(e[r]=o=a.fromJson(t,i),a.fieldWrapper&&!n.oneof&&(e[r]=a.fieldWrapper.unwrapField(o)));break;case"enum":const l=ay(n.T,t,i.ignoreUnknownFields,!1);switch(l){case Jp:vE(n,e);break;case bp:break;default:e[r]=l;break}break;case"scalar":try{const u=rd(n.T,t,n.L,!1);u===Jp?vE(n,e):e[r]=u}catch(u){let h="cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Us(t));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}break}}function K8(e,t){if(e===be.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return rd(e,t,Do.BIGINT,!0).toString()}function rd(e,t,n,i){if(t===null)return i?Cc(e,n):Jp;switch(e){case be.DOUBLE:case be.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const s=Number(t);if(Number.isNaN(s)||!Number.isFinite(s))break;return e==be.FLOAT&&P2(s),s;case be.INT32:case be.FIXED32:case be.SFIXED32:case be.SINT32:case be.UINT32:let r;if(typeof t=="number"?r=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),r===void 0)break;return e==be.UINT32||e==be.FIXED32?W_(r):gp(r),r;case be.INT64:case be.SFIXED64:case be.SINT64:if(typeof t!="number"&&typeof t!="string")break;const a=Kt.parse(t);return n?a.toString():a;case be.FIXED64:case be.UINT64:if(typeof t!="number"&&typeof t!="string")break;const o=Kt.uParse(t);return n?o.toString():o;case be.BOOL:if(typeof t!="boolean")break;return t;case be.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case be.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return H2.dec(t)}throw new Error}function ay(e,t,n,i){if(t===null)return e.typeName=="google.protobuf.NullValue"?0:i?e.values[0].no:Jp;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const s=e.findName(t);if(s!==void 0)return s.no;if(n)return bp;break}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(Us(t)))}function Y8(e){return e.repeated||e.kind=="map"?!0:!(e.oneof||e.kind=="message"||e.opt||e.req)}function SE(e,t,n){if(e.kind=="map"){tn(typeof t=="object"&&t!=null);const i={},s=Object.entries(t);switch(e.V.kind){case"scalar":for(const[a,o]of s)i[a.toString()]=yp(e.V.T,o);break;case"message":for(const[a,o]of s)i[a.toString()]=o.toJson(n);break;case"enum":const r=e.V.T;for(const[a,o]of s)i[a.toString()]=ly(r,o,n.enumAsInteger);break}return n.emitDefaultValues||s.length>0?i:void 0}if(e.repeated){tn(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let s=0;s<t.length;s++)i.push(yp(e.T,t[s]));break;case"enum":for(let s=0;s<t.length;s++)i.push(ly(e.T,t[s],n.enumAsInteger));break;case"message":for(let s=0;s<t.length;s++)i.push(t[s].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return yp(e.T,t);case"enum":return ly(e.T,t,n.enumAsInteger);case"message":return W2(e.T,t).toJson(n)}}function ly(e,t,n){var i;if(tn(typeof t=="number"),e.typeName=="google.protobuf.NullValue")return null;if(n)return t;const s=e.findNumber(t);return(i=s?.name)!==null&&i!==void 0?i:t}function yp(e,t){switch(e){case be.INT32:case be.SFIXED32:case be.SINT32:case be.FIXED32:case be.UINT32:return tn(typeof t=="number"),t;case be.FLOAT:case be.DOUBLE:return tn(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case be.STRING:return tn(typeof t=="string"),t;case be.BOOL:return tn(typeof t=="boolean"),t;case be.UINT64:case be.FIXED64:case be.INT64:case be.SFIXED64:case be.SINT64:return tn(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case be.BYTES:return tn(t instanceof Uint8Array),H2.enc(t)}}const $l=Symbol("@bufbuild/protobuf/unknown-fields"),CE={readUnknownFields:!0,readerFactory:e=>new F8(e)},xE={writeUnknownFields:!0,writerFactory:()=>new B8};function Q8(e){return e?Object.assign(Object.assign({},CE),e):CE}function J8(e){return e?Object.assign(Object.assign({},xE),e):xE}function X8(){return{makeReadOptions:Q8,makeWriteOptions:J8,listUnknownFields(e){var t;return(t=e[$l])!==null&&t!==void 0?t:[]},discardUnknownFields(e){delete e[$l]},writeUnknownFields(e,t){const i=e[$l];if(i)for(const s of i)t.tag(s.no,s.wireType).raw(s.data)},onUnknownField(e,t,n,i){const s=e;Array.isArray(s[$l])||(s[$l]=[]),s[$l].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,s){const r=e.getType(),a=s?t.len:t.pos+n;let o,l;for(;t.pos<a&&([o,l]=t.tag(),!(s===!0&&l==cn.EndGroup));){const u=r.fields.find(o);if(!u){const h=t.skip(l,o);i.readUnknownFields&&this.onUnknownField(e,o,l,h);continue}wE(e,t,u,l,i)}if(s&&(l!=cn.EndGroup||o!==n))throw new Error("invalid end group tag")},readField:wE,writeMessage(e,t,n){const i=e.getType();for(const s of i.fields.byNumber()){if(!V2(s,e)){if(s.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(s.name," to binary: required field not set"));continue}const r=s.oneof?e[s.oneof.localName].value:e[s.localName];kE(s,r,t,n)}return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){t!==void 0&&kE(e,t,n,i)}}}function wE(e,t,n,i,s){let{repeated:r,localName:a}=n;switch(n.oneof&&(e=e[n.oneof.localName],e.case!=a&&delete e.value,e.case=a,a="value"),n.kind){case"scalar":case"enum":const o=n.kind=="enum"?be.INT32:n.T;let l=Xp;if(n.kind=="scalar"&&n.L>0&&(l=ez),r){let m=e[a];if(i==cn.LengthDelimited&&o!=be.STRING&&o!=be.BYTES){let C=t.uint32()+t.pos;for(;t.pos<C;)m.push(l(t,o))}else m.push(l(t,o))}else e[a]=l(t,o);break;case"message":const u=n.T;r?e[a].push(_p(t,new u,s,n)):Ir(e[a])?_p(t,e[a],s,n):(e[a]=_p(t,new u,s,n),u.fieldWrapper&&!n.oneof&&!n.repeated&&(e[a]=u.fieldWrapper.unwrapField(e[a])));break;case"map":let[h,f]=Z8(n,t,s);e[a][h]=f;break}}function _p(e,t,n,i){const s=t.getType().runtime.bin,r=i?.delimited;return s.readMessage(t,e,r?i.no:e.uint32(),n,r),t}function Z8(e,t,n){const i=t.uint32(),s=t.pos+i;let r,a;for(;t.pos<s;){const[o]=t.tag();switch(o){case 1:r=Xp(t,e.K);break;case 2:switch(e.V.kind){case"scalar":a=Xp(t,e.V.T);break;case"enum":a=t.int32();break;case"message":a=_p(t,new e.V.T,n,void 0);break}break}}if(r===void 0&&(r=Cc(e.K,Do.BIGINT)),typeof r!="string"&&typeof r!="number"&&(r=r.toString()),a===void 0)switch(e.V.kind){case"scalar":a=Cc(e.V.T,Do.BIGINT);break;case"enum":a=e.V.T.values[0].no;break;case"message":a=new e.V.T;break}return[r,a]}function ez(e,t){const n=Xp(e,t);return typeof n=="bigint"?n.toString():n}function Xp(e,t){switch(t){case be.STRING:return e.string();case be.BOOL:return e.bool();case be.DOUBLE:return e.double();case be.FLOAT:return e.float();case be.INT32:return e.int32();case be.INT64:return e.int64();case be.UINT64:return e.uint64();case be.FIXED64:return e.fixed64();case be.BYTES:return e.bytes();case be.FIXED32:return e.fixed32();case be.SFIXED32:return e.sfixed32();case be.SFIXED64:return e.sfixed64();case be.SINT64:return e.sint64();case be.UINT32:return e.uint32();case be.SINT32:return e.sint32()}}function kE(e,t,n,i){tn(t!==void 0);const s=e.repeated;switch(e.kind){case"scalar":case"enum":let r=e.kind=="enum"?be.INT32:e.T;if(s)if(tn(Array.isArray(t)),e.packed)nz(n,r,e.no,t);else for(const a of t)od(n,r,e.no,a);else od(n,r,e.no,t);break;case"message":if(s){tn(Array.isArray(t));for(const a of t)TE(n,i,e,a)}else TE(n,i,e,t);break;case"map":tn(typeof t=="object"&&t!=null);for(const[a,o]of Object.entries(t))tz(n,i,e,a,o);break}}function tz(e,t,n,i,s){e.tag(n.no,cn.LengthDelimited),e.fork();let r=i;switch(n.K){case be.INT32:case be.FIXED32:case be.UINT32:case be.SFIXED32:case be.SINT32:r=Number.parseInt(i);break;case be.BOOL:tn(i=="true"||i=="false"),r=i=="true";break}switch(od(e,n.K,1,r),n.V.kind){case"scalar":od(e,n.V.T,2,s);break;case"enum":od(e,be.INT32,2,s);break;case"message":tn(s!==void 0),e.tag(2,cn.LengthDelimited).bytes(s.toBinary(t));break}e.join()}function TE(e,t,n,i){const s=W2(n.T,i);n.delimited?e.tag(n.no,cn.StartGroup).raw(s.toBinary(t)).tag(n.no,cn.EndGroup):e.tag(n.no,cn.LengthDelimited).bytes(s.toBinary(t))}function od(e,t,n,i){tn(i!==void 0);let[s,r]=G2(t);e.tag(n,s)[r](i)}function nz(e,t,n,i){if(!i.length)return;e.tag(n,cn.LengthDelimited).fork();let[,s]=G2(t);for(let r=0;r<i.length;r++)e[s](i[r]);e.join()}function G2(e){let t=cn.Varint;switch(e){case be.BYTES:case be.STRING:t=cn.LengthDelimited;break;case be.DOUBLE:case be.FIXED64:case be.SFIXED64:t=cn.Bit64;break;case be.FIXED32:case be.SFIXED32:case be.FLOAT:t=cn.Bit32;break}const n=be[e].toLowerCase();return[t,n]}function iz(){return{setEnumType:O2,initPartial(e,t){if(e===void 0)return;const n=t.getType();for(const i of n.fields.byMember()){const s=i.localName,r=t,a=e;if(a[s]!=null)switch(i.kind){case"oneof":const o=a[s].case;if(o===void 0)continue;const l=i.findField(o);let u=a[s].value;l&&l.kind=="message"&&!Ir(u,l.T)?u=new l.T(u):l&&l.kind==="scalar"&&l.T===be.BYTES&&(u=ju(u)),r[s]={case:o,value:u};break;case"scalar":case"enum":let h=a[s];i.T===be.BYTES&&(h=i.repeated?h.map(ju):ju(h)),r[s]=h;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===be.BYTES)for(const[g,C]of Object.entries(a[s]))r[s][g]=ju(C);else Object.assign(r[s],a[s]);break;case"message":const m=i.V.T;for(const g of Object.keys(a[s])){let C=a[s][g];m.fieldWrapper||(C=new m(C)),r[s][g]=C}break}break;case"message":const f=i.T;if(i.repeated)r[s]=a[s].map(m=>Ir(m,f)?m:new f(m));else{const m=a[s];f.fieldWrapper?f.typeName==="google.protobuf.BytesValue"?r[s]=ju(m):r[s]=m:r[s]=Ir(m,f)?m:new f(m)}break}}},equals(e,t,n){return t===n?!0:!t||!n?!1:e.fields.byMember().every(i=>{const s=t[i.localName],r=n[i.localName];if(i.repeated){if(s.length!==r.length)return!1;switch(i.kind){case"message":return s.every((a,o)=>i.T.equals(a,r[o]));case"scalar":return s.every((a,o)=>fo(i.T,a,r[o]));case"enum":return s.every((a,o)=>fo(be.INT32,a,r[o]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let a=s,o=r;return i.T.fieldWrapper&&(a!==void 0&&!Ir(a)&&(a=i.T.fieldWrapper.wrapField(a)),o!==void 0&&!Ir(o)&&(o=i.T.fieldWrapper.wrapField(o))),i.T.equals(a,o);case"enum":return fo(be.INT32,s,r);case"scalar":return fo(i.T,s,r);case"oneof":if(s.case!==r.case)return!1;const l=i.findField(s.case);if(l===void 0)return!0;switch(l.kind){case"message":return l.T.equals(s.value,r.value);case"enum":return fo(be.INT32,s.value,r.value);case"scalar":return fo(l.T,s.value,r.value)}throw new Error("oneof cannot contain ".concat(l.kind));case"map":const u=Object.keys(s).concat(Object.keys(r));switch(i.V.kind){case"message":const h=i.V.T;return u.every(m=>h.equals(s[m],r[m]));case"enum":return u.every(m=>fo(be.INT32,s[m],r[m]));case"scalar":const f=i.V.T;return u.every(m=>fo(f,s[m],r[m]))}break}})},clone(e){const t=e.getType(),n=new t,i=n;for(const s of t.fields.byMember()){const r=e[s.localName];let a;if(s.repeated)a=r.map(Of);else if(s.kind=="map"){a=i[s.localName];for(const[o,l]of Object.entries(r))a[o]=Of(l)}else s.kind=="oneof"?a=s.findField(r.case)?{case:r.case,value:Of(r.value)}:{case:void 0}:a=Of(r);i[s.localName]=a}for(const s of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,s.no,s.wireType,s.data);return n}}}function Of(e){if(e===void 0)return e;if(Ir(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function ju(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function sz(e,t,n){return{syntax:e,json:G8(),bin:X8(),util:Object.assign(Object.assign({},iz()),{newFieldList:t,initFields:n}),makeMessageType(i,s,r){return I8(this,i,s,r)},makeEnum:L8,makeEnumType:N2,getEnumType:M8,makeExtension(i,s,r){return U8(this,i,s,r)}}}class rz{constructor(t,n){this._fields=t,this._normalizer=n}findJsonName(t){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[t]}find(t){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,n)=>t.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,t.push(n)):t.push(i)}return this.members}}function K2(e,t){const n=Y2(e);return t?n:dz(uz(n))}function oz(e){return K2(e,!1)}const az=Y2;function Y2(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let s=e.charAt(i);switch(s){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(s),t=!1;break;default:t&&(t=!1,s=s.toUpperCase()),n.push(s);break}}return n.join("")}const lz=new Set(["constructor","toString","toJSON","valueOf"]),cz=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Q2=e=>"".concat(e,"$"),uz=e=>cz.has(e)?Q2(e):e,dz=e=>lz.has(e)?Q2(e):e;class hz{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=oz(t)}addField(t){tn(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[t]}}function fz(e,t){var n,i,s,r,a,o;const l=[];let u;for(const h of typeof e=="function"?e():e){const f=h;if(f.localName=K2(h.name,h.oneof!==void 0),f.jsonName=(n=h.jsonName)!==null&&n!==void 0?n:az(h.name),f.repeated=(i=h.repeated)!==null&&i!==void 0?i:!1,h.kind=="scalar"&&(f.L=(s=h.L)!==null&&s!==void 0?s:Do.BIGINT),f.delimited=(r=h.delimited)!==null&&r!==void 0?r:!1,f.req=(a=h.req)!==null&&a!==void 0?a:!1,f.opt=(o=h.opt)!==null&&o!==void 0?o:!1,h.packed===void 0&&(f.packed=h.kind=="enum"||h.kind=="scalar"&&h.T!=be.BYTES&&h.T!=be.STRING),h.oneof!==void 0){const m=typeof h.oneof=="string"?h.oneof:h.oneof.name;(!u||u.name!=m)&&(u=new hz(m)),f.oneof=u,u.addField(f)}l.push(f)}return l}const re=sz("proto3",e=>new rz(e,t=>fz(t)),e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated){i[n]=[];continue}switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Cc(t.T,t.L);break}}});class fi extends MS{constructor(t){super(),this.seconds=Kt.zero,this.nanos=0,re.util.initPartial(t,this)}fromJson(t,n){if(typeof t!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(re.json.debug(t)));const i=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const s=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Kt.parse(s/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(t){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?i="."+s.substring(0,3)+"Z":s.substring(6)==="000"?i="."+s.substring(0,6)+"Z":i="."+s+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return fi.fromDate(new Date)}static fromDate(t){const n=t.getTime();return new fi({seconds:Kt.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(t,n){return new fi().fromBinary(t,n)}static fromJson(t,n){return new fi().fromJson(t,n)}static fromJsonString(t,n){return new fi().fromJsonString(t,n)}static equals(t,n){return re.util.equals(fi,t,n)}}fi.runtime=re;fi.typeName="google.protobuf.Timestamp";fi.fields=re.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const pz=re.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:fi},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:mz,repeated:!0},{no:5,name:"events",kind:"message",T:vz,repeated:!0}]),mz=re.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:gz,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),gz=re.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:fi},{no:3,name:"value",kind:"scalar",T:2}]),vz=re.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:fi},{no:7,name:"normalized_end_timestamp",kind:"message",T:fi,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),J2=re.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),ms=re.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),gn=re.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),IS=re.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Xu=re.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Md=re.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),ys=re.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ya=re.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),bz=re.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),wn=re.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Km=re.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Zp,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:uI}]),Zp=re.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),yz=re.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:re.getEnumType(gn),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),za=re.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:re.getEnumType(uc)},{no:4,name:"tracks",kind:"message",T:sc,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:yz},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:re.getEnumType(Ld)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:re.getEnumType(ys)},{no:18,name:"kind_details",kind:"enum",T:re.getEnumType(_z),repeated:!0},{no:19,name:"data_tracks",kind:"message",T:PS,repeated:!0}]),uc=re.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ld=re.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"},{no:8,name:"BRIDGE"}]),_z=re.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"},{no:2,name:"CONNECTOR_WHATSAPP"},{no:3,name:"CONNECTOR_TWILIO"},{no:4,name:"BRIDGE_RTSP"}]),un=re.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Sz=re.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Lo,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:re.getEnumType(X2)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),sc=re.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:re.getEnumType(ms)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:re.getEnumType(gn)},{no:10,name:"layers",kind:"message",T:Lo,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Sz,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:re.getEnumType(un)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:uI},{no:19,name:"audio_features",kind:"enum",T:re.getEnumType(wn),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:re.getEnumType(J2)}]),PS=re.makeMessageType("livekit.DataTrackInfo",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"sid",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"encryption",kind:"enum",T:re.getEnumType(un)}]),Cz=re.makeMessageType("livekit.DataTrackSubscriptionOptions",()=>[{no:1,name:"target_fps",kind:"scalar",T:13,opt:!0}]),Lo=re.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:re.getEnumType(IS)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9},{no:8,name:"repair_ssrc",kind:"scalar",T:13}]),X2=re.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Zn=re.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:re.getEnumType(at)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:DS,oneof:"value"},{no:3,name:"speaker",kind:"message",T:xz,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:nI,oneof:"value"},{no:7,name:"transcription",kind:"message",T:wz,oneof:"value"},{no:8,name:"metrics",kind:"message",T:pz,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:em,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:OS,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:NS,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:jS,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:tm,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:nm,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:im,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Z2,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),at=re.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Z2=re.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:re.getEnumType(un)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),eI=re.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:DS,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:em,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:OS,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:NS,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:jS,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:tm,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:nm,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:im,oneof:"value"}]),xz=re.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:tI,repeated:!0}]),tI=re.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),DS=re.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),nI=re.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),wz=re.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:kz,repeated:!0}]),kz=re.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),em=re.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),OS=re.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),NS=re.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),jS=re.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:iI,oneof:"value"}]),iI=re.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),sI=re.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),rI=re.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:re.getEnumType(oI)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),oI=re.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),aI=re.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:re.getEnumType(lI)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),lI=re.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),cI=re.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:EE},{no:2,name:"screen",kind:"message",T:EE},{no:3,name:"resume_connection",kind:"enum",T:re.getEnumType(Md)},{no:4,name:"disabled_codecs",kind:"message",T:Tz},{no:5,name:"force_relay",kind:"enum",T:re.getEnumType(Md)}]),EE=re.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:re.getEnumType(Md)}]),Tz=re.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Zp,repeated:!0},{no:2,name:"publish",kind:"message",T:Zp,repeated:!0}]),uI=re.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),G_=re.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),dI=re.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:re.getEnumType(G_)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),hI=re.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),tm=re.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:re.getEnumType(un)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:dI,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:hI,oneof:"content_header"}],{localName:"DataStream_Header"}),nm=re.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),im=re.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),Ez=re.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),gs=re.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),K_=re.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Rz=re.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Az=re.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Oo,oneof:"message"},{no:2,name:"answer",kind:"message",T:Oo,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Ym,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Id,oneof:"message"},{no:5,name:"mute",kind:"message",T:Qm,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Jm,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:gI,oneof:"message"},{no:8,name:"leave",kind:"message",T:Xm,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:bI,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:SI,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:HS,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Os,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:US,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:wI,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:FS,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:vI,oneof:"message"},{no:19,name:"publish_data_track_request",kind:"message",T:fI,oneof:"message"},{no:20,name:"unpublish_data_track_request",kind:"message",T:mI,oneof:"message"},{no:21,name:"update_data_subscription",kind:"message",T:jz,oneof:"message"}]),RE=re.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:Pz,oneof:"message"},{no:2,name:"answer",kind:"message",T:Oo,oneof:"message"},{no:3,name:"offer",kind:"message",T:Oo,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Ym,oneof:"message"},{no:5,name:"update",kind:"message",T:Nz,oneof:"message"},{no:6,name:"track_published",kind:"message",T:BS,oneof:"message"},{no:8,name:"leave",kind:"message",T:Xm,oneof:"message"},{no:9,name:"mute",kind:"message",T:Qm,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Fz,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Uz,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Hz,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:qz,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Wz,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Kz,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Oz,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Dz,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Qz,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Zz,oneof:"message"},{no:22,name:"request_response",kind:"message",T:e7,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:t7,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Yz,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:r7,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:Gz,oneof:"message"},{no:27,name:"publish_data_track_response",kind:"message",T:pI,oneof:"message"},{no:28,name:"unpublish_data_track_response",kind:"message",T:Mz,oneof:"message"},{no:29,name:"data_track_subscriber_handles",kind:"message",T:Lz,oneof:"message"}]),Y_=re.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Lo,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:re.getEnumType(X2)}]),Id=re.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:re.getEnumType(ms)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:re.getEnumType(gn)},{no:9,name:"layers",kind:"message",T:Lo,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Y_,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:re.getEnumType(un)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:re.getEnumType(J2)},{no:17,name:"audio_features",kind:"enum",T:re.getEnumType(wn),repeated:!0}]),fI=re.makeMessageType("livekit.PublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"encryption",kind:"enum",T:re.getEnumType(un)}]),pI=re.makeMessageType("livekit.PublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:PS}]),mI=re.makeMessageType("livekit.UnpublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13}]),Mz=re.makeMessageType("livekit.UnpublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:PS}]),Lz=re.makeMessageType("livekit.DataTrackSubscriberHandles",()=>[{no:1,name:"sub_handles",kind:"map",K:13,V:{kind:"message",T:Iz}}]),Iz=re.makeMessageType("livekit.DataTrackSubscriberHandles.PublishedDataTrack",()=>[{no:1,name:"publisher_identity",kind:"scalar",T:9},{no:2,name:"publisher_sid",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9}],{localName:"DataTrackSubscriberHandles_PublishedDataTrack"}),Ym=re.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:re.getEnumType(gs)},{no:3,name:"final",kind:"scalar",T:8}]),Qm=re.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),Pz=re.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Km},{no:2,name:"participant",kind:"message",T:za},{no:3,name:"other_participants",kind:"message",T:za,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:yI,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:cI},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:rI},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Zp,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Dz=re.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:yI,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:cI},{no:3,name:"server_info",kind:"message",T:rI},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),BS=re.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:sc}]),Oz=re.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Oo=re.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Nz=re.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:za,repeated:!0}]),Jm=re.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:sI,repeated:!0}]),jz=re.makeMessageType("livekit.UpdateDataSubscription",()=>[{no:1,name:"updates",kind:"message",T:Bz,repeated:!0}]),Bz=re.makeMessageType("livekit.UpdateDataSubscription.Update",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"options",kind:"message",T:Cz}],{localName:"UpdateDataSubscription_Update"}),gI=re.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:re.getEnumType(IS)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),FS=re.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:re.getEnumType(wn),repeated:!0}]),vI=re.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Xm=re.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:re.getEnumType(ys)},{no:3,name:"action",kind:"enum",T:re.getEnumType(dc)},{no:4,name:"regions",kind:"message",T:Jz}]),dc=re.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),bI=re.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Lo,repeated:!0}]),US=re.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),yI=re.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Fz=re.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:tI,repeated:!0}]),Uz=re.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Km}]),zz=re.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:re.getEnumType(Xu)},{no:3,name:"score",kind:"scalar",T:2}]),Hz=re.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:zz,repeated:!0}]),$z=re.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:re.getEnumType(K_)}]),qz=re.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:$z,repeated:!0}]),zS=re.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:re.getEnumType(IS)},{no:2,name:"enabled",kind:"scalar",T:8}]),Vz=re.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:zS,repeated:!0}]),Wz=re.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:zS,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Vz,repeated:!0}]),Gz=re.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:Ez,repeated:!0}]),_I=re.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),SI=re.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:_I,repeated:!0}]),Kz=re.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Yz=re.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Km},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:za},{no:4,name:"other_participants",kind:"message",T:za,repeated:!0}]),HS=re.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Oo},{no:2,name:"subscription",kind:"message",T:Jm},{no:3,name:"publish_tracks",kind:"message",T:BS,repeated:!0},{no:4,name:"data_channels",kind:"message",T:xI,repeated:!0},{no:5,name:"offer",kind:"message",T:Oo},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:CI,repeated:!0},{no:8,name:"publish_data_tracks",kind:"message",T:pI,repeated:!0}]),CI=re.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),xI=re.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:re.getEnumType(gs)}]),Os=re.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:re.getEnumType(Rz),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),wI=re.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Qz=re.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Jz=re.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Xz,repeated:!0}]),Xz=re.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),Zz=re.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:re.getEnumType(bz)}]),e7=re.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:re.getEnumType($S)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Ym,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Id,oneof:"request"},{no:6,name:"mute",kind:"message",T:Qm,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:US,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:FS,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:vI,oneof:"request"},{no:10,name:"publish_data_track",kind:"message",T:fI,oneof:"request"},{no:11,name:"unpublish_data_track",kind:"message",T:mI,oneof:"request"}]),$S=re.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"},{no:7,name:"INVALID_HANDLE"},{no:8,name:"INVALID_NAME"},{no:9,name:"DUPLICATE_HANDLE"},{no:10,name:"DUPLICATE_NAME"}]),t7=re.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),kI=re.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8},{no:5,name:"auto_subscribe_data_track",kind:"scalar",T:8,opt:!0}]),n7=re.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:aI},{no:2,name:"connection_settings",kind:"message",T:kI},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Id,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Oo},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:re.getEnumType(ya)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:HS}]),i7=re.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:re.getEnumType(s7)},{no:2,name:"join_request",kind:"scalar",T:12}]),s7=re.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),r7=re.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function o7(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Sp={exports:{}},a7=Sp.exports,AE;function l7(){return AE||(AE=1,(function(e){(function(t,n){e.exports?e.exports=n():t.log=n()})(a7,function(){var t=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),s=["trace","debug","info","warn","error"],r={},a=null;function o(S,v){var _=S[v];if(typeof _.bind=="function")return _.bind(S);try{return Function.prototype.bind.call(_,S)}catch{return function(){return Function.prototype.apply.apply(_,[S,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(S){return S==="debug"&&(S="log"),typeof console===n?!1:S==="trace"&&i?l:console[S]!==void 0?o(console,S):console.log!==void 0?o(console,"log"):t}function h(){for(var S=this.getLevel(),v=0;v<s.length;v++){var _=s[v];this[_]=v<S?t:this.methodFactory(_,S,this.name)}if(this.log=this.debug,typeof console===n&&S<this.levels.SILENT)return"No console available for logging"}function f(S){return function(){typeof console!==n&&(h.call(this),this[S].apply(this,arguments))}}function m(S,v,_){return u(S)||f.apply(this,arguments)}function g(S,v){var _=this,w,x,k,A="loglevel";typeof S=="string"?A+=":"+S:typeof S=="symbol"&&(A=void 0);function T(O){var j=(s[O]||"silent").toUpperCase();if(!(typeof window===n||!A)){try{window.localStorage[A]=j;return}catch{}try{window.document.cookie=encodeURIComponent(A)+"="+j+";"}catch{}}}function M(){var O;if(!(typeof window===n||!A)){try{O=window.localStorage[A]}catch{}if(typeof O===n)try{var j=window.document.cookie,U=encodeURIComponent(A),q=j.indexOf(U+"=");q!==-1&&(O=/^([^;]+)/.exec(j.slice(q+U.length+1))[1])}catch{}return _.levels[O]===void 0&&(O=void 0),O}}function E(){if(!(typeof window===n||!A)){try{window.localStorage.removeItem(A)}catch{}try{window.document.cookie=encodeURIComponent(A)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function L(O){var j=O;if(typeof j=="string"&&_.levels[j.toUpperCase()]!==void 0&&(j=_.levels[j.toUpperCase()]),typeof j=="number"&&j>=0&&j<=_.levels.SILENT)return j;throw new TypeError("log.setLevel() called with invalid level: "+O)}_.name=S,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=v||m,_.getLevel=function(){return k??x??w},_.setLevel=function(O,j){return k=L(O),j!==!1&&T(k),h.call(_)},_.setDefaultLevel=function(O){x=L(O),M()||_.setLevel(O,!1)},_.resetLevel=function(){k=null,E(),h.call(_)},_.enableAll=function(O){_.setLevel(_.levels.TRACE,O)},_.disableAll=function(O){_.setLevel(_.levels.SILENT,O)},_.rebuild=function(){if(a!==_&&(w=L(a.getLevel())),h.call(_),a===_)for(var O in r)r[O].rebuild()},w=L(a?a.getLevel():"WARN");var D=M();D!=null&&(k=L(D)),h.call(_)}a=new g,a.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var _=r[v];return _||(_=r[v]=new g(v,a.methodFactory)),_};var C=typeof window!==n?window.log:void 0;return a.noConflict=function(){return typeof window!==n&&window.log===a&&(window.log=C),a},a.getLoggers=function(){return r},a.default=a,a})})(Sp)),Sp.exports}var Zm=l7(),Q_;(function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"})(Q_||(Q_={}));var is;(function(e){e.Default="livekit",e.Room="livekit-room",e.TokenSource="livekit-token-source",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee",e.DataTracks="livekit-data-tracks"})(is||(is={}));let it=Zm.getLogger("livekit");Object.values(is).map(e=>Zm.getLogger(e));it.setDefaultLevel(Q_.info);function Ks(e){const t=Zm.getLogger(e);return t.setDefaultLevel(it.getLevel()),t}const c7=Zm.getLogger("lk-e2ee"),Bu=7e3,u7=[0,300,4*300,9*300,16*300,Bu,Bu,Bu,Bu,Bu];class d7{constructor(t){this._retryDelays=t!==void 0?[...t]:u7}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[t.retryCount];return t.retryCount<=1?n:n+Math.random()*1e3}}function h7(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n}function X(e,t,n,i){function s(r){return r instanceof n?r:new n(function(a){a(r)})}return new(n||(n=Promise))(function(r,a){function o(h){try{u(i.next(h))}catch(f){a(f)}}function l(h){try{u(i.throw(h))}catch(f){a(f)}}function u(h){h.done?r(h.value):s(h.value).then(o,l)}u((i=i.apply(e,t||[])).next())})}function ME(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pr(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof ME=="function"?ME(e):e[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(r){n[r]=e[r]&&function(a){return new Promise(function(o,l){a=e[r](a),s(o,l,a.done,a.value)})}}function s(r,a,o,l){Promise.resolve(l).then(function(u){r({value:u,done:o})},a)}}var Nf={exports:{}},LE;function f7(){if(LE)return Nf.exports;LE=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(A,T,M){return Function.prototype.apply.call(A,T,M)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(A){return Object.getOwnPropertyNames(A).concat(Object.getOwnPropertySymbols(A))}:n=function(A){return Object.getOwnPropertyNames(A)};function i(k){console&&console.warn&&console.warn(k)}var s=Number.isNaN||function(A){return A!==A};function r(){r.init.call(this)}Nf.exports=r,Nf.exports.once=_,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function o(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(k){if(typeof k!="number"||k<0||s(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");a=k}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(A){if(typeof A!="number"||A<0||s(A))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+A+".");return this._maxListeners=A,this};function l(k){return k._maxListeners===void 0?r.defaultMaxListeners:k._maxListeners}r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(A){for(var T=[],M=1;M<arguments.length;M++)T.push(arguments[M]);var E=A==="error",L=this._events;if(L!==void 0)E=E&&L.error===void 0;else if(!E)return!1;if(E){var D;if(T.length>0&&(D=T[0]),D instanceof Error)throw D;var O=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw O.context=D,O}var j=L[A];if(j===void 0)return!1;if(typeof j=="function")t(j,this,T);else for(var U=j.length,q=C(j,U),M=0;M<U;++M)t(q[M],this,T);return!0};function u(k,A,T,M){var E,L,D;if(o(T),L=k._events,L===void 0?(L=k._events=Object.create(null),k._eventsCount=0):(L.newListener!==void 0&&(k.emit("newListener",A,T.listener?T.listener:T),L=k._events),D=L[A]),D===void 0)D=L[A]=T,++k._eventsCount;else if(typeof D=="function"?D=L[A]=M?[T,D]:[D,T]:M?D.unshift(T):D.push(T),E=l(k),E>0&&D.length>E&&!D.warned){D.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=k,O.type=A,O.count=D.length,i(O)}return k}r.prototype.addListener=function(A,T){return u(this,A,T,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(A,T){return u(this,A,T,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(k,A,T){var M={fired:!1,wrapFn:void 0,target:k,type:A,listener:T},E=h.bind(M);return E.listener=T,M.wrapFn=E,E}r.prototype.once=function(A,T){return o(T),this.on(A,f(this,A,T)),this},r.prototype.prependOnceListener=function(A,T){return o(T),this.prependListener(A,f(this,A,T)),this},r.prototype.removeListener=function(A,T){var M,E,L,D,O;if(o(T),E=this._events,E===void 0)return this;if(M=E[A],M===void 0)return this;if(M===T||M.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete E[A],E.removeListener&&this.emit("removeListener",A,M.listener||T));else if(typeof M!="function"){for(L=-1,D=M.length-1;D>=0;D--)if(M[D]===T||M[D].listener===T){O=M[D].listener,L=D;break}if(L<0)return this;L===0?M.shift():S(M,L),M.length===1&&(E[A]=M[0]),E.removeListener!==void 0&&this.emit("removeListener",A,O||T)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(A){var T,M,E;if(M=this._events,M===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[A]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete M[A]),this;if(arguments.length===0){var L=Object.keys(M),D;for(E=0;E<L.length;++E)D=L[E],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=M[A],typeof T=="function")this.removeListener(A,T);else if(T!==void 0)for(E=T.length-1;E>=0;E--)this.removeListener(A,T[E]);return this};function m(k,A,T){var M=k._events;if(M===void 0)return[];var E=M[A];return E===void 0?[]:typeof E=="function"?T?[E.listener||E]:[E]:T?v(E):C(E,E.length)}r.prototype.listeners=function(A){return m(this,A,!0)},r.prototype.rawListeners=function(A){return m(this,A,!1)},r.listenerCount=function(k,A){return typeof k.listenerCount=="function"?k.listenerCount(A):g.call(k,A)},r.prototype.listenerCount=g;function g(k){var A=this._events;if(A!==void 0){var T=A[k];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function C(k,A){for(var T=new Array(A),M=0;M<A;++M)T[M]=k[M];return T}function S(k,A){for(;A+1<k.length;A++)k[A]=k[A+1];k.pop()}function v(k){for(var A=new Array(k.length),T=0;T<A.length;++T)A[T]=k[T].listener||k[T];return A}function _(k,A){return new Promise(function(T,M){function E(D){k.removeListener(A,L),M(D)}function L(){typeof k.removeListener=="function"&&k.removeListener("error",E),T([].slice.call(arguments))}x(k,A,L,{once:!0}),A!=="error"&&w(k,E,{once:!0})})}function w(k,A,T){typeof k.on=="function"&&x(k,"error",A,T)}function x(k,A,T,M){if(typeof k.on=="function")M.once?k.once(A,T):k.on(A,T);else if(typeof k.addEventListener=="function")k.addEventListener(A,function E(L){M.once&&k.removeEventListener(A,E),T(L)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}return Nf.exports}var Zs=f7();let TI=!0,EI=!0;function Zu(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function Ya(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(a,o){if(a!==t)return s.apply(this,arguments);const l=u=>{const h=n(u);h&&(o.handleEvent?o.handleEvent(h):o(h))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(o,l),s.apply(this,[a,l])};const r=i.removeEventListener;i.removeEventListener=function(a,o){if(a!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(o))return r.apply(this,arguments);const l=this._eventMap[t].get(o);return this._eventMap[t].delete(o),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[a,l])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function p7(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(TI=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function m7(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(EI=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function RI(){if(typeof window=="object"){if(TI)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function qS(e,t){EI&&console.warn(e+" is deprecated, please use "+t+" instead.")}function g7(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(Zu(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(Zu(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(Zu(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=Zu(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function IE(e){return Object.prototype.toString.call(e)==="[object Object]"}function AI(e){return IE(e)?Object.keys(e).reduce(function(t,n){const i=IE(e[n]),s=i?AI(e[n]):e[n],r=i&&!Object.keys(s).length;return s===void 0||r?t:Object.assign(t,{[n]:s})},{}):e}function J_(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?J_(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(s=>{J_(e,e.get(s),n)})}))}function PE(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const r=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&r.push(a)}),r.forEach(a=>{e.forEach(o=>{o.type===i&&o.trackId===a.id&&J_(e,o,s)})}),s}const DE=RI;function MI(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const l={};return Object.keys(o).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const h=typeof o[u]=="object"?o[u]:{ideal:o[u]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const f=function(m,g){return m?m+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(h.ideal!==void 0){l.optional=l.optional||[];let m={};typeof h.ideal=="number"?(m[f("min",u)]=h.ideal,l.optional.push(m),m={},m[f("max",u)]=h.ideal,l.optional.push(m)):(m[f("",u)]=h.ideal,l.optional.push(m))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",u)]=h.exact):["min","max"].forEach(m=>{h[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(m,u)]=h[m])})}),o.advanced&&(l.optional=(l.optional||[]).concat(o.advanced)),l},s=function(o,l){if(t.version>=61)return l(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const u=function(h,f,m){f in h&&!(m in h)&&(h[m]=h[f],delete h[f])};o=JSON.parse(JSON.stringify(o)),u(o.audio,"autoGainControl","googAutoGainControl"),u(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=i(o.audio)}if(o&&typeof o.video=="object"){let u=o.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const h=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete o.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(m=>{m=m.filter(C=>C.kind==="videoinput");let g=m.find(C=>f.some(S=>C.label.toLowerCase().includes(S)));return!g&&m.length&&f.includes("back")&&(g=m[m.length-1]),g&&(o.video.deviceId=u.exact?{exact:g.deviceId}:{ideal:g.deviceId}),o.video=i(o.video),DE("chrome: "+JSON.stringify(o)),l(o)})}o.video=i(o.video)}return DE("chrome: "+JSON.stringify(o)),l(o)},r=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,l,u){s(o,h=>{n.webkitGetUserMedia(h,l,f=>{u&&u(r(f))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return s(l,u=>o(u).then(h=>{if(u.audio&&!h.getAudioTracks().length||u.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return h},h=>Promise.reject(r(h))))}}}function LI(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function II(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;e.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(o=>o.track&&o.track.id===s.track.id):r={track:s.track};const a=new Event("track");a.track=s.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[i.stream],this.dispatchEvent(a)}),i.stream.getTracks().forEach(s=>{let r;e.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(o=>o.track&&o.track.id===s.id):r={track:s};const a=new Event("track");a.track=s,a.receiver=r,a.transceiver={receiver:r},a.streams=[i.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ya(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function PI(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,l){let u=s.apply(this,arguments);return u||(u=t(this,o),this._senders.push(u)),u};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){r.apply(this,arguments);const l=this._senders.indexOf(o);l!==-1&&this._senders.splice(l,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(a=>{const o=this._senders.find(l=>l.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function DI(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(a=>a._pc=this),r});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(a=>PE(a,r.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(r=>r._pc=this),s}),Ya(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>PE(r,s.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let s,r,a;return this.getSenders().forEach(o=>{o.track===i&&(s?a=!0:s=o)}),this.getReceivers().forEach(o=>(o.track===i&&(r?a=!0:r=o),o.track===i)),a||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function OI(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(l)===-1&&this._shimmedLocalStreams[o.id].push(l):this._shimmedLocalStreams[o.id]=[o,l],l};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(u=>o.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const l=this._shimmedLocalStreams[o].indexOf(a);l!==-1&&this._shimmedLocalStreams[o].splice(l,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),s.apply(this,arguments)}}function NI(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return OI(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const h=n.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(f=>this._reverseStreams[f.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(f=>{if(this.getSenders().find(g=>g.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const f=new e.MediaStream(h.getTracks());this._streams[h.id]=f,this._reverseStreams[f.id]=h,h=f}i.apply(this,[h])};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(S=>S===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[f.id];if(C)C.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new e.MediaStream([h]);this._streams[f.id]=S,this._reverseStreams[S.id]=f,this.addStream(S)}return this.getSenders().find(S=>S.track===h)};function r(u,h){let f=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const g=u._reverseStreams[m],C=u._streams[g.id];f=f.replace(new RegExp(C.id,"g"),g.id)}),new RTCSessionDescription({type:h.type,sdp:f})}function a(u,h){let f=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const g=u._reverseStreams[m],C=u._streams[g.id];f=f.replace(new RegExp(g.id,"g"),C.id)}),new RTCSessionDescription({type:h.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const h=e.RTCPeerConnection.prototype[u],f={[u](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[C=>{const S=r(this,C);m[0].apply(null,[S])},C=>{m[1]&&m[1].apply(null,C)},arguments[2]]):h.apply(this,arguments).then(C=>r(this,C))}};e.RTCPeerConnection.prototype[u]=f[u]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:r(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(h._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(S=>h.track===S)&&(m=this._streams[g])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function X_(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=s[n]})}function jI(e,t){Ya(e,"negotiationneeded",n=>{const i=n.target;if(!((t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var OE=Object.freeze({__proto__:null,fixNegotiationNeeded:jI,shimAddTrackRemoveTrack:NI,shimAddTrackRemoveTrackWithNative:OI,shimGetSendersWithDtmf:PI,shimGetUserMedia:MI,shimMediaStream:LI,shimOnTrack:II,shimPeerConnection:X_,shimSenderReceiverGetStats:DI});function BI(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(s,r,a){qS("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(r,a)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(a,o,l){o in a&&!(l in a)&&(a[l]=a[o],delete a[o])},r=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a.audio,"autoGainControl","mozAutoGainControl"),s(a.audio,"noiseSuppression","mozNoiseSuppression")),r(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const o=a.apply(this,arguments);return s(o,"mozAutoGainControl","autoGainControl"),s(o,"mozNoiseSuppression","noiseSuppression"),o}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o,"autoGainControl","mozAutoGainControl"),s(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function v7(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function FI(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Z_(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=e.RTCPeerConnection.prototype[s],a={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=a[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,a,o]=arguments;return i.apply(this,[r||null]).then(l=>{if(t.version<53&&!a)try{l.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((h,f)=>{l.set(f,Object.assign({},h,{type:n[h.type]||h.type}))})}return l}).then(a,o)}}function UI(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function zI(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Ya(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function HI(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){qS("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function $I(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function qI(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(s){const{sender:a}=r,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=i,a.sendEncodings=i,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return r})}function VI(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function WI(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function GI(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var NE=Object.freeze({__proto__:null,shimAddTransceiver:qI,shimCreateAnswer:GI,shimCreateOffer:WI,shimGetDisplayMedia:v7,shimGetParameters:VI,shimGetUserMedia:BI,shimOnTrack:FI,shimPeerConnection:Z_,shimRTCDataChannel:$I,shimReceiverGetStats:zI,shimRemoveStream:HI,shimSenderGetStats:UI});function KI(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>t.call(this,s,i)),i.getVideoTracks().forEach(s=>t.call(this,s,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return r&&r.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const s=n.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function YI(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const a=new Event("addstream");a.stream=r,i.dispatchEvent(a)})}),t.apply(i,arguments)}}}function QI(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(u,h){const f=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[f]);return h?(m.then(u,h),Promise.resolve()):m},t.createAnswer=function(u,h){const f=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[f]);return h?(m.then(u,h),Promise.resolve()):m};let o=function(l,u,h){const f=s.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f};t.setLocalDescription=o,o=function(l,u,h){const f=r.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f},t.setRemoteDescription=o,o=function(l,u,h){const f=a.apply(this,[l]);return h?(f.then(u,h),Promise.resolve()):f},t.addIceCandidate=o}function JI(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=s=>i(XI(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,s,r){t.mediaDevices.getUserMedia(i).then(s,r)}).bind(t))}function XI(e){return e&&e.video!==void 0?Object.assign({},e,{video:AI(e.video)}):e}function ZI(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let a=0;a<i.iceServers.length;a++){let o=i.iceServers[a];o.urls===void 0&&o.url?(qS("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,r.push(o)):r.push(i.iceServers[a])}i.iceServers=r}return new t(i,s)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function eP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function tP(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function nP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var jE=Object.freeze({__proto__:null,shimAudioContext:nP,shimCallbacksAPI:QI,shimConstraints:XI,shimCreateOfferLegacy:tP,shimGetUserMedia:JI,shimLocalStreamsAPI:KI,shimRTCIceServerUrls:ZI,shimRemoteStreamsAPI:YI,shimTrackEventTransceiver:eP}),cy={exports:{}},BE;function b7(){return BE||(BE=1,(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((s,r)=>(r>0?"m="+s:s).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(s=>s.indexOf(i)===0)},t.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]===void 0&&(s[i[r]]=i[r+1]);break}return s},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const s=n.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const r=n.type;return i.push("typ"),i.push(r),r!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let s;const r=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<r.length;a++)s=r[a].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(n){let i="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const r=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?r.push(a+"="+n.parameters[a]):r.push(a)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(r=>{i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,i),10)},r=n.indexOf(":",i);return r>-1?(s.attribute=n.substring(i+1,r),s.value=n.substring(r+1)):s.attribute=n.substring(i+1),s},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let s="a=setup:"+i+`\r
`;return n.fingerprints.forEach(r=>{s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const s=t.matchPrefix(n+i,"a=ice-ufrag:")[0],r=t.matchPrefix(n+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(n)[0].split(" ");i.profile=r[2];for(let o=3;o<r.length;o++){const l=r[o],u=t.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(u){const h=t.parseRtpMap(u),f=t.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=f.length?t.parseFmtp(f[0]):{},h.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase());break}}}t.matchPrefix(n,"a=extmap:").forEach(o=>{i.headerExtensions.push(t.parseExtmap(o))});const a=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(o=>{a.forEach(l=>{o.rtcpFeedback.find(h=>h.type===l.type&&h.parameter===l.parameter)||o.rtcpFeedback.push(l)})}),i},t.writeRtpDescription=function(n,i){let s="";s+="m="+n+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{s+=t.writeRtpMap(a),s+=t.writeFmtp(a),s+=t.writeRtcpFb(a)});let r=0;return i.codecs.forEach(a=>{a.maxptime>r&&(r=a.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{s+=t.writeExtmap(a)}),s},t.parseRtpEncodingParameters=function(n){const i=[],s=t.parseRtpParameters(n),r=s.fecMechanisms.indexOf("RED")!==-1,a=s.fecMechanisms.indexOf("ULPFEC")!==-1,o=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),l=o.length>0&&o[0].ssrc;let u;const h=t.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(C=>parseInt(C,10)));h.length>0&&h[0].length>1&&h[0][0]===l&&(u=h[0][1]),s.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let g={ssrc:l,codecPayloadType:parseInt(m.parameters.apt,10)};l&&u&&(g.rtx={ssrc:u}),i.push(g),r&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},i.push(g))}}),i.length===0&&l&&i.push({ssrc:l});let f=t.matchPrefix(n,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-2e3*8:f=void 0,i.forEach(m=>{m.maxBitrate=f})),i},t.parseRtcpParameters=function(n){const i={},s=t.matchPrefix(n,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const r=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;const a=t.matchPrefix(n,"a=rtcp-mux");return i.mux=a.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const s=t.matchPrefix(n,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const r=t.matchPrefix(n,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},t.parseSctpDescription=function(n){const i=t.parseMLine(n),s=t.matchPrefix(n,"a=max-message-size:");let r;s.length>0&&(r=parseInt(s[0].substring(19),10)),isNaN(r)&&(r=65536);const a=t.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};const o=t.matchPrefix(n,"a=sctpmap:");if(o.length>0){const l=o[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},t.writeSctpDescription=function(n,i){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,s){let r;const a=i!==void 0?i:2;return n?r=n:r=t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+r+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const s=t.splitLines(n);for(let r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const s=t.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},t.parseOLine=function(n){const s=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(cy)),cy.exports}var iP=b7(),hc=o7(iP),y7=C8({__proto__:null,default:hc},[iP]);function Cp(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const s=new t(i),r=hc.parseCandidate(i.candidate);for(const a in r)a in s||Object.defineProperty(s,a,{value:r[a]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,Ya(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function e0(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ya(e,"icecandidate",t=>{if(t.candidate){const n=hc.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function xp(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(o){if(!o||!o.sdp)return!1;const l=hc.splitSections(o.sdp);return l.shift(),l.some(u=>{const h=hc.parseMLine(u);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(o){const l=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!==u?-1:u},s=function(o){let l=65536;return t.browser==="firefox"&&(t.version<57?o===-1?l=16384:l=2147483637:t.version<60?l=t.version===57?65535:65536:l=2147483637),l},r=function(o,l){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const h=hc.matchPrefix(o.sdp,"a=max-message-size:");return h.length>0?u=parseInt(h[0].substring(19),10):t.browser==="firefox"&&l!==-1&&(u=2147483637),u},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),u=s(l),h=r(arguments[0],l);let f;u===0&&h===0?f=Number.POSITIVE_INFINITY:u===0||h===0?f=Math.max(u,h):f=Math.min(u,h);const m={};Object.defineProperty(m,"maxMessageSize",{get(){return f}}),this._sctp=m}return a.apply(this,arguments)}}function wp(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,s){const r=i.send;i.send=function(){const o=arguments[0],l=o.length||o.size||o.byteLength;if(i.readyState==="open"&&s.sctp&&l>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return t(s,this),s},Ya(e,"datachannel",i=>(t(i.channel,i.target),i))}function t0(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const a=new Event("connectionstatechange",s);r.dispatchEvent(a)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function n0(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&s instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return n.apply(this,arguments)}}function kp(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Tp(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var _7=Object.freeze({__proto__:null,removeExtmapAllowMixed:n0,shimAddIceCandidateNullOrEmpty:kp,shimConnectionState:t0,shimMaxMessageSize:xp,shimParameterlessSetLocalDescription:Tp,shimRTCIceCandidate:Cp,shimRTCIceCandidateRelayProtocol:e0,shimSendThrowTypeError:wp});function S7(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=RI,i=g7(e),s={browserDetails:i,commonShim:_7,extractVersion:Zu,disableLog:p7,disableWarnings:m7,sdp:y7};switch(i.browser){case"chrome":if(!OE||!X_||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=OE,kp(e,i),Tp(e),MI(e,i),LI(e),X_(e,i),II(e),NI(e,i),PI(e),DI(e),jI(e,i),Cp(e),e0(e),t0(e),xp(e,i),wp(e),n0(e,i);break;case"firefox":if(!NE||!Z_||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=NE,kp(e,i),Tp(e),BI(e,i),Z_(e,i),FI(e),HI(e),UI(e),zI(e),$I(e),qI(e),VI(e),WI(e),GI(e),Cp(e),t0(e),xp(e,i),wp(e);break;case"safari":if(!jE||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=jE,kp(e,i),Tp(e),ZI(e),tP(e),QI(e),KI(e),YI(e),eP(e),JI(e),nP(e),Cp(e),e0(e),xp(e,i),wp(e),n0(e,i);break;default:n("Unsupported browser!");break}return s}S7({window:typeof window>"u"?void 0:window});var i0,sP;class zn extends(sP=Promise){constructor(t){super(t)}catch(t){return super.catch(t)}static reject(t){return super.reject(t)}static all(t){return super.all(t)}static race(t){return super.race(t)}}i0=zn;zn.resolve=e=>Reflect.get(sP,"resolve",i0).call(i0,e);const C7=/version\/(\d+(\.?_?\d+)+)/i;let uy;function vi(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(uy===void 0||t){const i=x7.find(s=>{let{test:r}=s;return r.test(n)});uy=i?.describe(n)}return uy}const x7=[{test:/firefox|iceweasel|fxios/i,describe(e){return{name:"Firefox",version:Ep(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:dy(e)}}},{test:/chrom|crios|crmo/i,describe(e){return{name:"Chrome",version:Ep(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:dy(e)}}},{test:/safari|applewebkit/i,describe(e){return{name:"Safari",version:Ep(C7,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:dy(e)}}}];function Ep(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function dy(e){return e.includes("mac os")?Ep(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}var w7="2.17.2";const k7=w7,T7=16;class Bo extends Error{constructor(t,n,i){super(n||"an error has occurred"),this.name="LiveKitError",this.code=t,typeof i?.cause<"u"&&(this.cause=i?.cause)}}class VS extends Bo{}var Ft;(function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout",e[e.WebSocket=6]="WebSocket",e[e.ServiceNotFound=7]="ServiceNotFound"})(Ft||(Ft={}));class We extends VS{constructor(t,n,i,s){super(1,t),this.name="ConnectionError",this.status=i,this.reason=n,this.context=s,this.reasonName=Ft[n]}static notAllowed(t,n,i){return new We(t,Ft.NotAllowed,n,i)}static timeout(t){return new We(t,Ft.Timeout)}static leaveRequest(t,n){return new We(t,Ft.LeaveRequest,void 0,n)}static internal(t,n){return new We(t,Ft.InternalError,void 0,n)}static cancelled(t){return new We(t,Ft.Cancelled)}static serverUnreachable(t,n){return new We(t,Ft.ServerUnreachable,n)}static websocket(t,n,i){return new We(t,Ft.WebSocket,n,i)}static serviceNotFound(t,n){return new We(t,Ft.ServiceNotFound,void 0,n)}}class WS extends Bo{constructor(t){super(21,t??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Dr extends Bo{constructor(t){super(20,t??"track is invalid"),this.name="TrackInvalidError"}}class E7 extends Bo{constructor(t){super(10,t??"unsupported server"),this.name="UnsupportedServer"}}class ln extends Bo{constructor(t){super(12,t??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Pa extends Bo{constructor(t){super(13,t??"unable to negotiate"),this.name="NegotiationError"}}class FE extends Bo{constructor(t,n){super(15,t),this.name="PublishTrackError",this.status=n}}class UE extends VS{constructor(t,n){super(15,t),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:$S[n]}}var Jn;(function(e){e[e.AlreadyOpened=0]="AlreadyOpened",e[e.AbnormalEnd=1]="AbnormalEnd",e[e.DecodeFailed=2]="DecodeFailed",e[e.LengthExceeded=3]="LengthExceeded",e[e.Incomplete=4]="Incomplete",e[e.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",e[e.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Jn||(Jn={}));class Ki extends VS{constructor(t,n){super(16,t),this.name="DataStreamError",this.reason=n,this.reasonName=Jn[n]}}class ql extends Bo{constructor(t){super(18,t),this.name="SignalReconnectError"}}var sm;(function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"})(sm||(sm={}));(function(e){function t(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?e.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?e.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?e.DeviceInUse:e.Other}e.getFailure=t})(sm||(sm={}));class Dn{}Dn.setTimeout=function(){return setTimeout(...arguments)};Dn.setInterval=function(){return setInterval(...arguments)};Dn.clearTimeout=function(){return clearTimeout(...arguments)};Dn.clearInterval=function(){return clearInterval(...arguments)};var ye;(function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.Moved="moved",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.ParticipantActive="participantActive",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"})(ye||(ye={}));var Ae;(function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackCpuConstrained="localTrackCpuConstrained",e.LocalSenderCreated="localSenderCreated",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.TrackCpuConstrained="trackCpuConstrained",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage",e.Active="active"})(Ae||(Ae={}));var Re;(function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected",e.RoomMoved="roomMoved"})(Re||(Re={}));var ke;(function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.CpuConstrained="cpuConstrained",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate",e.PreConnectBufferFlushed="preConnectBufferFlushed"})(ke||(ke={}));function R7(e){return typeof e>"u"?e:typeof structuredClone=="function"?typeof e=="object"&&e!==null?structuredClone(Object.assign({},e)):structuredClone(e):JSON.parse(JSON.stringify(e))}class Dt{constructor(t,n,i,s,r){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(n!==void 0&&i!==void 0)this.width=t,this.height=n,this.aspectRatio=t/n,this.encoding={maxBitrate:i,maxFramerate:s,priority:r};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const A7=["vp8","h264"],M7=["vp8","h264","vp9","av1","h265"];function L7(e){return!!A7.find(t=>t===e)}const I7=L7;var zE;(function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"})(zE||(zE={}));var s0;(function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}})(s0||(s0={}));const Pd={h90:new Dt(160,90,9e4,20),h180:new Dt(320,180,16e4,20),h216:new Dt(384,216,18e4,20),h360:new Dt(640,360,45e4,20),h540:new Dt(960,540,8e5,25),h720:new Dt(1280,720,17e5,30),h1080:new Dt(1920,1080,3e6,30),h1440:new Dt(2560,1440,5e6,30),h2160:new Dt(3840,2160,8e6,30)},r0={h120:new Dt(160,120,7e4,20),h180:new Dt(240,180,125e3,20),h240:new Dt(320,240,14e4,20),h360:new Dt(480,360,33e4,20),h480:new Dt(640,480,5e5,20),h540:new Dt(720,540,6e5,25),h720:new Dt(960,720,13e5,30),h1080:new Dt(1440,1080,23e5,30),h1440:new Dt(1920,1440,38e5,30)},GS={h360fps3:new Dt(640,360,2e5,3,"medium"),h360fps15:new Dt(640,360,4e5,15,"medium"),h720fps5:new Dt(1280,720,8e5,5,"medium"),h720fps15:new Dt(1280,720,15e5,15,"medium"),h720fps30:new Dt(1280,720,2e6,30,"medium"),h1080fps15:new Dt(1920,1080,25e5,15,"medium"),h1080fps30:new Dt(1920,1080,5e6,30,"medium"),original:new Dt(0,0,7e6,30,"medium")};function rP(e,t,n){var i,s,r,a;const{optionsWithoutProcessor:o,audioProcessor:l,videoProcessor:u}=lP(e??{}),h=t?.processor,f=n?.processor,m=o??{};return m.audio===!0&&(m.audio={}),m.video===!0&&(m.video={}),m.audio&&(o0(m.audio,t),(i=(r=m.audio).deviceId)!==null&&i!==void 0||(r.deviceId={ideal:"default"}),(l||h)&&(m.audio.processor=l??h)),m.video&&(o0(m.video,n),(s=(a=m.video).deviceId)!==null&&s!==void 0||(a.deviceId={ideal:"default"}),(u||f)&&(m.video.processor=u??f)),m}function o0(e,t){return Object.keys(t).forEach(n=>{e[n]===void 0&&(e[n]=t[n])}),e}function KS(e){var t,n,i,s;const r={};if(e.video)if(typeof e.video=="object"){const a={},o=a,l=e.video;Object.keys(l).forEach(u=>{u==="resolution"?o0(o,l.resolution):o[u]=l[u]}),r.video=a,(t=(i=r.video).deviceId)!==null&&t!==void 0||(i.deviceId={ideal:"default"})}else r.video=e.video?{deviceId:{ideal:"default"}}:!1;else r.video=!1;return e.audio?typeof e.audio=="object"?(r.audio=e.audio,(n=(s=r.audio).deviceId)!==null&&n!==void 0||(s.deviceId={ideal:"default"})):r.audio={deviceId:{ideal:"default"}}:r.audio=!1,r}function oP(e){return X(this,arguments,void 0,function(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=aP();if(i){const s=i.createAnalyser();s.fftSize=2048;const r=s.frequencyBinCount,a=new Uint8Array(r);i.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(s),yield On(n),s.getByteTimeDomainData(a);const l=a.some(u=>u!==128&&u!==0);return i.close(),!l}return!1})()})}function aP(){var e;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((e=window.document)===null||e===void 0)&&e.body)){const i=()=>X(this,void 0,void 0,function*(){var s;try{n.state==="suspended"&&(yield n.resume())}catch(r){console.warn("Error trying to auto-resume audio context",r)}finally{(s=window.document.body)===null||s===void 0||s.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var s;n.state==="closed"&&((s=window.document.body)===null||s===void 0||s.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function P7(e){return e==="audioinput"?ve.Source.Microphone:e==="videoinput"?ve.Source.Camera:ve.Source.Unknown}function a0(e){return e===ve.Source.Microphone?"audioinput":e===ve.Source.Camera?"videoinput":void 0}function D7(e){var t,n;let i=(t=e.video)!==null&&t!==void 0?t:!0;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i=typeof i=="boolean"?{}:i,$a()?i=Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:(n=e.audio)!==null&&n!==void 0?n:!1,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function ad(e){return e.split("/")[1].toLowerCase()}function O7(e){const t=[];return e.forEach(n=>{n.track!==void 0&&t.push(new BS({cid:n.track.mediaStreamID,track:n.trackInfo}))}),t}function ut(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?ut(e.track):{})}}function N7(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function j7(e,t){var n;e===void 0&&(e={}),t===void 0&&(t={});const i=[...Object.keys(t),...Object.keys(e)],s={};for(const r of i)e[r]!==t[r]&&(s[r]=(n=t[r])!==null&&n!==void 0?n:"");return s}function lP(e){const t=Object.assign({},e);let n,i;return typeof t.audio=="object"&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),typeof t.video=="object"&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:R7(t)}}function B7(e){switch(e){case gn.CAMERA:return ve.Source.Camera;case gn.MICROPHONE:return ve.Source.Microphone;case gn.SCREEN_SHARE:return ve.Source.ScreenShare;case gn.SCREEN_SHARE_AUDIO:return ve.Source.ScreenShareAudio;default:return ve.Source.Unknown}}function HE(e,t){return e.width*e.height<t.width*t.height}function F7(e,t){var n;return(n=e.layers)===null||n===void 0?void 0:n.find(i=>i.quality===t)}const U7=5e3,Fu=[];var Li;(function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"})(Li||(Li={}));class ve extends Zs.EventEmitter{get streamState(){return this._streamState}setStreamState(t){this._streamState=t}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var s;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=ve.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=it,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),U7):this.handleAppVisibilityChanged()},this.log=Ks((s=i.loggerName)!==null&&s!==void 0?s:is.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=ve.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),ut(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===ve.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===ve.Kind.Video&&this.addAppVisibilityListener(),t||(n==="audio"&&(Fu.forEach(r=>{r.parentElement===null&&!t&&(t=r)}),t&&Fu.splice(Fu.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),rc(this.mediaStreamTrack,t);const i=t.srcObject.getTracks(),s=i.some(r=>r.kind==="audio");return t.play().then(()=>{this.emit(s?ke.AudioPlaybackStarted:ke.VideoPlaybackStarted)}).catch(r=>{r.name==="NotAllowedError"?this.emit(s?ke.AudioPlaybackFailed:ke.VideoPlaybackFailed,r):r.name==="AbortError"?it.debug("".concat(s?"audio":"video"," playback aborted, likely due to new play request")):it.warn("could not playback ".concat(s?"audio":"video"),r),s&&t&&i.some(a=>a.kind==="video")&&r.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(ke.ElementAttached,t),t}detach(t){try{if(t){fc(this.mediaStreamTrack,t);const i=this.attachedElements.indexOf(t);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(t),this.emit(ke.ElementDetached,t)),t}const n=[];return this.attachedElements.forEach(i=>{fc(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(ke.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=Ks(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let n=!0;t.pause(),Fu.forEach(i=>{i.parentElement||(n=!1)}),n&&Fu.push(t)}}handleAppVisibilityChanged(){return X(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===ve.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){mi()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){mi()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function rc(e,t){let n;t.srcObject instanceof MediaStream?n=t.srcObject:n=new MediaStream;let i;e.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(e)||(i.forEach(s=>{n.removeTrack(s)}),n.addTrack(e)),(!$a()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=n.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,($a()||Ha())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function fc(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}(function(e){let t;(function(u){u.Audio="audio",u.Video="video",u.Unknown="unknown"})(t=e.Kind||(e.Kind={}));let n;(function(u){u.Camera="camera",u.Microphone="microphone",u.ScreenShare="screen_share",u.ScreenShareAudio="screen_share_audio",u.Unknown="unknown"})(n=e.Source||(e.Source={}));let i;(function(u){u.Active="active",u.Paused="paused",u.Unknown="unknown"})(i=e.StreamState||(e.StreamState={}));function s(u){switch(u){case t.Audio:return ms.AUDIO;case t.Video:return ms.VIDEO;default:return ms.DATA}}e.kindToProto=s;function r(u){switch(u){case ms.AUDIO:return t.Audio;case ms.VIDEO:return t.Video;default:return t.Unknown}}e.kindFromProto=r;function a(u){switch(u){case n.Camera:return gn.CAMERA;case n.Microphone:return gn.MICROPHONE;case n.ScreenShare:return gn.SCREEN_SHARE;case n.ScreenShareAudio:return gn.SCREEN_SHARE_AUDIO;default:return gn.UNKNOWN}}e.sourceToProto=a;function o(u){switch(u){case gn.CAMERA:return n.Camera;case gn.MICROPHONE:return n.Microphone;case gn.SCREEN_SHARE:return n.ScreenShare;case gn.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}e.sourceFromProto=o;function l(u){switch(u){case K_.ACTIVE:return i.Active;case K_.PAUSED:return i.Paused;default:return i.Unknown}}e.streamStateFromProto=l})(ve||(ve={}));const z7="|",$E="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function H7(e){const t=e.split(z7);return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}function On(e){return new zn(t=>Dn.setTimeout(t,e))}function l0(){return"addTransceiver"in RTCPeerConnection.prototype}function c0(){return"addTrack"in RTCPeerConnection.prototype}function $7(){if(!("getCapabilities"in RTCRtpSender)||$a()||Ha())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e){for(const n of e.codecs)if(n.mimeType.toLowerCase()==="video/av1"){t=!0;break}}return t}function q7(){if(!("getCapabilities"in RTCRtpSender)||Ha())return!1;if($a()){const n=vi();if(n?.version&&Qs(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&Qs(n.osVersion,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e){for(const n of e.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){t=!0;break}}return t}function vs(e){return e==="av1"||e==="vp9"}function u0(e){return!document||Dd()?!1:(e||(e=document.createElement("audio")),"setSinkId"in e)}function V7(){return typeof RTCPeerConnection>"u"?!1:l0()||c0()}function Ha(){var e;return((e=vi())===null||e===void 0?void 0:e.name)==="Firefox"}function qE(){const e=vi();return!!e&&e.name==="Chrome"&&e.os!=="iOS"}function $a(){var e;return((e=vi())===null||e===void 0?void 0:e.name)==="Safari"}function Dd(){const e=vi();return e?.name==="Safari"||e?.os==="iOS"}function W7(){const e=vi();return e?.name==="Safari"&&e.version.startsWith("17.")||e?.os==="iOS"&&!!e?.osVersion&&Qs(e.osVersion,"17")>=0}function G7(e){return e||(e=vi()),e?.name==="Safari"&&Qs(e.version,"18.3")>0||e?.os==="iOS"&&!!e?.osVersion&&Qs(e.osVersion,"18.3")>0}function cP(){var e,t;return mi()?(t=(e=navigator.userAgentData)===null||e===void 0?void 0:e.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function K7(){const e=vi(),t="17.2";if(e)return e.name!=="Safari"&&e.os!=="iOS"||e.os==="iOS"&&e.osVersion&&Qs(e.osVersion,t)>=0?!0:e.name==="Safari"&&Qs(e.version,t)>=0}function mi(){return typeof document<"u"}function Ys(){return navigator.product=="ReactNative"}function xc(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function hy(e){return xc(e)?e.hostname.split(".")[0]:null}function uP(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function dP(){if(!Ys())return;let e=uP();if(e)return e.platform}function VE(){if(mi())return window.devicePixelRatio;if(Ys()){let e=uP();if(e)return e.devicePixelRatio}return 1}function Qs(e,t){const n=e.split("."),i=t.split("."),s=Math.min(n.length,i.length);for(let r=0;r<s;++r){const a=parseInt(n[r],10),o=parseInt(i[r],10);if(a>o)return 1;if(a<o)return-1;if(r===s-1&&a===o)return 0}return e===""&&t!==""?-1:t===""?1:n.length==i.length?0:n.length<i.length?-1:1}function Y7(e){for(const t of e)t.target.handleResize(t)}function Q7(e){for(const t of e)t.target.handleVisibilityChanged(t)}let fy=null;const WE=()=>(fy||(fy=new ResizeObserver(Y7)),fy);let py=null;const GE=()=>(py||(py=new IntersectionObserver(Q7,{root:null,rootMargin:"0px"})),py);function J7(){var e;const t=new aI({sdk:lI.JS,protocol:T7,version:k7});return Ys()&&(t.os=(e=dP())!==null&&e!==void 0?e:""),t}function KE(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=document.createElement("canvas");s.width=e,s.height=t;const r=s.getContext("2d");r?.fillRect(0,0,s.width,s.height),i&&r&&(r.beginPath(),r.arc(e/2,t/2,50,0,Math.PI*2,!0),r.closePath(),r.fillStyle="grey",r.fill());const a=s.captureStream(),[o]=a.getTracks();if(!o)throw Error("Could not get empty media stream video track");return o.enabled=n,o}let Uu;function my(){if(!Uu){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[Uu]=i.stream.getAudioTracks(),!Uu)throw Error("Could not get empty media stream audio track");Uu.enabled=!1}return Uu.clone()}class ts{get isResolved(){return this._isResolved}constructor(t,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,s)=>X(this,void 0,void 0,function*(){this.resolve=i,this.reject=s,t&&(yield t(i,s))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function X7(e){return M7.includes(e)}function Da(e){if(typeof e=="string"||typeof e=="number")return e;if(Array.isArray(e))return e[0];if(e.exact!==void 0)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal!==void 0)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function Z7(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}function Od(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function eH(e,t){return e.segments.map(n=>{let{id:i,text:s,language:r,startTime:a,endTime:o,final:l}=n;var u;const h=(u=t.get(i))!==null&&u!==void 0?u:Date.now(),f=Date.now();return l?t.delete(i):t.set(i,h),{id:i,text:s,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(o.toString()),final:l,language:r,firstReceivedTime:h,lastReceivedTime:f}})}function tH(e){const{id:t,timestamp:n,message:i,editTimestamp:s}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:s?Number.parseInt(s.toString()):void 0,message:i}}function YE(e){switch(e.reason){case Ft.LeaveRequest:return e.context;case Ft.Cancelled:return ys.CLIENT_INITIATED;case Ft.NotAllowed:return ys.USER_REJECTED;case Ft.ServerUnreachable:return ys.JOIN_FAILURE;default:return ys.UNKNOWN_REASON}}function Rp(e){return e!==void 0?Number(e):void 0}function _a(e){return e!==void 0?BigInt(e):void 0}function pc(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function qs(e){return!!e&&e.kind==ve.Kind.Audio}function Fo(e){return!!e&&e.kind==ve.Kind.Video}function po(e){return pc(e)&&Fo(e)}function kr(e){return pc(e)&&qs(e)}function d0(e){return!!e&&!e.isLocal}function nH(e){return!!e&&!e.isLocal}function gy(e){return d0(e)&&Fo(e)}function iH(e){return e.isLocal}function sH(e,t){const n=[];let i=new TextEncoder().encode(e);for(;i.length>t;){let s=t;for(;s>0;){const r=i[s];if(r!==void 0&&(r&192)!==128)break;s--}n.push(i.slice(0,s)),i=i.slice(s)}return i.length>0&&n.push(i),n}function rH(e){var t;const n=e.get("Cache-Control");if(n){const i=(t=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||t===void 0?void 0:t[1];if(i)return parseInt(i,10)}}function oH(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=aH(e,t);return n?i:YS(i,"v1")}function aH(e,t){const n=new URL(Z7(e));return t.forEach((i,s)=>{n.searchParams.set(s,i)}),YS(n,"rtc")}function lH(e){const t=new URL(Od(e));return YS(t,"validate")}function hP(e){return e.endsWith("/")?e:"".concat(e,"/")}function YS(e,t){return e.pathname="".concat(hP(e.pathname)).concat(t),e}function QE(e){if(typeof e=="string")return RE.fromJson(JSON.parse(e),{ignoreUnknownFields:!0});if(e instanceof ArrayBuffer)return RE.fromBinary(new Uint8Array(e));throw new Error("could not decode websocket message: ".concat(typeof e))}function cH(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(e instanceof AbortSignal))return t;const n=e.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:t;default:return"toString"in n?n.toString():t}}const uH=10,zu="lk_e2ee",dH="LKFrameEncryptionKey",hH={sharedKey:!1,ratchetSalt:dH,ratchetWindowSize:8,failureTolerance:uH,keyringSize:16};var Io;(function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"})(Io||(Io={}));var JE;(function(e){e.KeyRatcheted="keyRatcheted"})(JE||(JE={}));var Eo;(function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"})(Eo||(Eo={}));var XE;(function(e){e.Error="cryptorError"})(XE||(XE={}));function fH(){return pH()||h0()}function h0(){return typeof window.RTCRtpScriptTransform<"u"}function pH(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function mH(e){var t,n,i,s,r;if(((t=e.value)===null||t===void 0?void 0:t.case)!=="sipDtmf"&&((n=e.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=e.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((s=e.value)===null||s===void 0?void 0:s.case)!=="transcription"&&((r=e.value)===null||r===void 0?void 0:r.case)!=="encryptedPacket")return new eI({value:e.value})}class npe extends Zs.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,s)=>{it.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:s})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},hH),t),this.on(Io.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,n,i){const s={key:t,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),s),this.emit(Io.SetKey,s)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,n){this.emit(Io.RatchetRequest,t,n)}}var ZE;(function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"})(ZE||(ZE={}));class gH extends Zs.EventEmitter{constructor(t,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var s,r;const{kind:a,data:o}=i.data;switch(a){case"error":if(it.error(o.error.message),o.uuid){const h=this.decryptDataRequests.get(o.uuid);if(h?.reject){h.reject(o.error);break}const f=this.encryptDataRequests.get(o.uuid);if(f?.reject){f.reject(o.error);break}}this.emit(Eo.EncryptionError,o.error,o.participantIdentity);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(h=>{this.postKey(h)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(h=>{this.postKey(h)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity))this.emit(Eo.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const h=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(o.participantIdentity);if(!h)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Eo.ParticipantEncryptionStatusChanged,o.enabled,h)}break;case"ratchetKey":this.keyProvider.emit(Io.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break;case"decryptDataResponse":const l=this.decryptDataRequests.get(o.uuid);l?.resolve&&l.resolve(o);break;case"encryptDataResponse":const u=this.encryptDataRequests.get(o.uuid);u?.resolve&&u.resolve(o);break}},this.onWorkerError=i=>{it.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Eo.EncryptionError,i.error,void 0)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(t){if(!fH())throw new WS("tried to setup end-to-end encryption on an unsupported browser");if(it.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:c7.getLevel()}};this.worker&&(it.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(t,n){it.debug("set e2ee to ".concat(t," for participant ").concat(n)),this.postEnable(t,n)}setSifTrailer(t){!t||t.length===0?it.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on(Re.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(t,n){t.on(ye.TrackPublished,(i,s)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==un.NONE,s.identity)),t.on(ye.ConnectionStateChanged,i=>{i===wt.Connected&&t.remoteParticipants.forEach(s=>{s.trackPublications.forEach(r=>{this.setParticipantCryptorEnabled(r.trackInfo.encryption!==un.NONE,s.identity)})})}).on(ye.TrackUnsubscribed,(i,s,r)=>{var a;const o={kind:"removeTransform",data:{participantIdentity:r.identity,trackId:i.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(o)}).on(ye.TrackSubscribed,(i,s,r)=>{this.setupE2EEReceiver(i,r.identity,s.trackInfo)}).on(ye.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),t.localParticipant.on(Ae.LocalSenderCreated,(i,s)=>X(this,void 0,void 0,function*(){this.setupE2EESender(s,i)})),t.localParticipant.on(Ae.LocalTrackPublished,i=>{if(!Fo(i.track)||!Dd())return;const s={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:ad(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(s)}),n.on(Io.SetKey,i=>this.postKey(i)).on(Io.RatchetRequest,(i,s)=>this.postRatchetRequest(i,s))}encryptData(t){return X(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:t,participantIdentity:this.room.localParticipant.identity}},s=new ts;return s.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,s),this.worker.postMessage(i),s.promise})}handleEncryptedData(t,n,i,s){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const r=crypto.randomUUID(),a={kind:"decryptDataRequest",data:{uuid:r,payload:t,iv:n,participantIdentity:i,keyIndex:s}},o=new ts;return o.onFinally=()=>{this.decryptDataRequests.delete(r)},this.decryptDataRequests.set(r,o),this.worker.postMessage(a),o.promise}postRatchetRequest(t,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:n}};this.worker.postMessage(i)}postKey(t){let{key:n,participantIdentity:i,keyIndex:s}=t;var r;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity),key:n,keyIndex:s}};this.worker.postMessage(a)}postEnable(t,n){if(this.worker){const i={kind:"enable",data:{enabled:t,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(n)}setupE2EEReceiver(t,n,i){if(t.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,n,t.kind==="video"?ad(i.mimeType):void 0)}}setupE2EESender(t,n){if(!pc(t)||!n){n||it.warn("early return because sender is not ready");return}this.handleSender(n,t.mediaStreamID,void 0)}handleReceiver(t,n,i,s){return X(this,void 0,void 0,function*(){if(this.worker){if(h0()&&!qE()){const r={kind:"decode",participantIdentity:i,trackId:n,codec:s};t.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(zu in t&&s){const l={kind:"updateCodec",data:{trackId:n,codec:s,participantIdentity:i}};this.worker.postMessage(l);return}let r=t.writableStream,a=t.readableStream;if(!r||!a){const l=t.createEncodedStreams();t.writableStream=l.writable,r=l.writable,t.readableStream=l.readable,a=l.readable}const o={kind:"decode",data:{readableStream:a,writableStream:r,trackId:n,codec:s,participantIdentity:i,isReuse:zu in t}};this.worker.postMessage(o,[a,r])}t[zu]=!0}})}handleSender(t,n,i){var s;if(!(zu in t||!this.worker)){if(!(!((s=this.room)===null||s===void 0)&&s.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(h0()&&!qE()){it.info("initialize script transform");const r={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};t.transform=new RTCRtpScriptTransform(this.worker,r)}else{it.info("initialize encoded streams");const r=t.createEncodedStreams(),a={kind:"encode",data:{readableStream:r.readable,writableStream:r.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(a,[r.readable,r.writable])}t[zu]=!0}}}const vH=500,bH=15e3;class mc{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new mc),this._instance}addFailedConnectionAttempt(t){var n;const i=new URL(t),s=hy(i);if(!s)return;let r=(n=this.failedConnectionAttempts.get(s))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(s,r+1),this.backOffPromises.set(s,On(Math.min(vH*Math.pow(2,r),bH)))}getBackOffPromise(t){const n=new URL(t),i=n&&hy(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(t){const n=new URL(t),i=n&&hy(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}mc._instance=null;const vy="default";class kn{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new kn),this.instance}get previousDevices(){return this._previousDevices}getDevices(t){return X(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var r;if(((r=kn.userMediaPromiseMap)===null||r===void 0?void 0:r.size)>0){it.debug("awaiting getUserMedia promise");try{n?yield kn.userMediaPromiseMap.get(n):yield Promise.all(kn.userMediaPromiseMap.values())}catch{it.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(s&&!($a()&&i.hasDeviceInUse(n))&&(a.filter(l=>l.kind===n).length===0||a.some(l=>{const u=l.label==="",h=n?l.kind===n:!0;return u&&h}))){const l={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},u=yield navigator.mediaDevices.getUserMedia(l);a=yield navigator.mediaDevices.enumerateDevices(),u.getTracks().forEach(h=>{h.stop()})}return i._previousDevices=a,n&&(a=a.filter(o=>o.kind===n)),a})()})}normalizeDeviceId(t,n,i){return X(this,void 0,void 0,function*(){if(n!==vy)return n;const s=yield this.getDevices(t),r=s.find(o=>o.deviceId===vy);if(!r){it.warn("could not reliably determine default device");return}const a=s.find(o=>o.deviceId!==vy&&o.groupId===(i??r.groupId));if(!a){it.warn("could not reliably determine default device");return}return a?.deviceId})}hasDeviceInUse(t){return t?kn.userMediaPromiseMap.has(t):kn.userMediaPromiseMap.size>0}}kn.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];kn.userMediaPromiseMap=new Map;var ld;(function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"})(ld||(ld={}));class yH{constructor(){this.pendingTasks=new Map,this.taskMutex=new ni,this.nextTaskIndex=0}run(t){return X(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:ld.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=ld.RUNNING,yield t()}finally{n.status=ld.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return X(this,void 0,void 0,function*(){return this.run(()=>X(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class _H{get readyState(){return this.ws.readyState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,s;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=t;const r=new WebSocket(t,(s=n.protocols)!==null&&s!==void 0?s:[]);r.binaryType="arraybuffer",this.ws=r;const a=function(){let{closeCode:o,reason:l}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r.close(o,l)};this.opened=new zn((o,l)=>{const u=()=>{l(We.websocket("Encountered websocket error during connection establishment"))};r.onopen=()=>{o({readable:new ReadableStream({start(h){r.onmessage=f=>{let{data:m}=f;return h.enqueue(m)},r.onerror=f=>h.error(f)},cancel:a}),writable:new WritableStream({write(h){r.send(h)},abort(){r.close()},close:a}),protocol:r.protocol,extensions:r.extensions}),r.removeEventListener("error",u)},r.addEventListener("error",u)}),this.closed=new zn((o,l)=>{const u=()=>X(this,void 0,void 0,function*(){const h=new zn(m=>{r.readyState!==WebSocket.CLOSED&&r.addEventListener("close",g=>{m(g)},{once:!0})}),f=yield zn.race([On(250),h]);f?o(f):l(We.websocket("Encountered unspecified websocket error without a timely close event"))});r.onclose=h=>{let{code:f,reason:m}=h;o({closeCode:f,reason:m}),r.removeEventListener("error",u)},r.addEventListener("error",u)}),n.signal&&(n.signal.onabort=()=>r.close()),this.close=a}}const SH=["syncState","trickle","offer","answer","simulate","leave"];function CH(e){const t=SH.indexOf(e.case)>=0;return it.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}var Bt;(function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"})(Bt||(Bt={}));const xH=250;class QS{get currentState(){return this.state}get isDisconnected(){return this.state===Bt.DISCONNECTING||this.state===Bt.DISCONNECTED}get isEstablishingConnection(){return this.state===Bt.CONNECTING||this.state===Bt.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=Bt.DISCONNECTED,this.log=it,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Ks((i=n.loggerName)!==null&&i!==void 0?i:is.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=t,this.requestQueue=new yH,this.queuedRequests=[],this.closingLock=new ni,this.connectionLock=new ni,this.state=Bt.DISCONNECTED}get logContext(){var t,n;return(n=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&n!==void 0?n:{}}join(t,n,i,s){return X(this,arguments,void 0,function(r,a,o,l){var u=this;let h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){return u.state=Bt.CONNECTING,u.options=o,yield u.connect(r,a,o,l,h)})()})}reconnect(t,n,i,s){return X(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Bt.RECONNECTING,this.clearPingInterval(),yield this.connect(t,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:s}),void 0,this.useV0SignalPath)})}connect(t,n,i,s){return X(this,arguments,void 0,function(r,a,o,l){var u=this;let h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){const f=yield u.connectionLock.lock();u.connectOptions=o,u.useV0SignalPath=h;const m=J7(),g=h?wH(a,m,o):kH(a,m,o),C=oH(r,g,h).toString(),S=lH(C).toString();return new Promise((v,_)=>X(u,void 0,void 0,function*(){var w,x;try{let k=!1;const A=D=>X(this,void 0,void 0,function*(){if(k)return;k=!0;const O=D instanceof Event?D.currentTarget:D,j=cH(O,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(j)).catch(U=>{this.log.error(U),this.close()}):this.close(),T(),_(We.cancelled(j))});l?.addEventListener("abort",A);const T=()=>{clearTimeout(M),l?.removeEventListener("abort",A)},M=setTimeout(()=>{A(We.timeout("room connection has timed out (signal)"))},o.websocketTimeout),E=(D,O)=>{this.handleSignalConnected(D,M,O)},L=new URL(C);L.searchParams.has("access_token")&&L.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(L),Object.assign({reconnect:o.reconnect,reconnectReason:o.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new _H(C);try{this.ws.closed.then($=>{var Y;this.isEstablishingConnection&&_(We.internal("Websocket got closed during a (re)connection attempt: ".concat($.reason))),$.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:$.reason,code:$.closeCode,wasClean:$.closeCode===1e3,state:this.state})),this.state===Bt.CONNECTED&&this.handleOnClose((Y=$.reason)!==null&&Y!==void 0?Y:"Unexpected WS error"))}).catch($=>{this.isEstablishingConnection&&_(We.internal("Websocket error during a (re)connection attempt: ".concat($)))});const D=yield this.ws.opened.catch($=>X(this,void 0,void 0,function*(){if(this.state!==Bt.CONNECTED){this.state=Bt.DISCONNECTED,clearTimeout(M);const Y=yield this.handleConnectionError($,S);_(Y);return}this.handleWSError($),_($)}));if(clearTimeout(M),!D)return;const O=D.readable.getReader();this.streamWriter=D.writable.getWriter();const j=yield O.read();if(O.releaseLock(),!j.value)throw We.internal("no message received as first message");const U=QE(j.value),q=this.validateFirstMessage(U,(w=o.reconnect)!==null&&w!==void 0?w:!1);if(!q.isValid){_(q.error);return}((x=U.message)===null||x===void 0?void 0:x.case)==="join"&&(this.pingTimeoutDuration=U.message.value.pingTimeout,this.pingIntervalDuration=U.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const K=q.shouldProcessFirstMessage?U:void 0;E(D,K),v(q.response)}catch(D){_(D)}finally{T()}}finally{f()}}))})()})}startReadingLoop(t,n){return X(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield On(this.signalLatency));const{done:i,value:s}=yield t.read();if(i)break;const r=QE(s);this.handleSignalResponse(r)}})}close(){return X(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Bt.DISCONNECTING||Bt.DISCONNECTED].includes(t.state)){t.log.debug("ignoring signal close as it's already in disconnecting state");return}const s=yield t.closingLock.lock();try{if(t.clearPingInterval(),n&&(t.state=Bt.DISCONNECTING),t.ws){t.ws.close({closeCode:1e3,reason:i});const r=t.ws.closed;t.ws=void 0,t.streamWriter=void 0,yield Promise.race([r,On(xH)])}}catch(r){t.log.debug("websocket error while closing",Object.assign(Object.assign({},t.logContext),{error:r}))}finally{n&&(t.state=Bt.DISCONNECTED),s()}})()})}sendOffer(t,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:oc(t,n)})}sendAnswer(t,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:oc(t,n)})}sendIceCandidate(t,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new Ym({candidateInit:JSON.stringify(t),target:n})})}sendMuteTrack(t,n){return this.sendRequest({case:"mute",value:new Qm({sid:t,muted:n})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,n){return X(this,arguments,void 0,function(i,s){var r=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const o=r.getNextRequestId();return yield r.sendRequest({case:"updateMetadata",value:new US({requestId:o,metadata:i,name:s,attributes:a})}),o})()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,n){return this.sendRequest({case:"updateLayers",value:new bI({trackSid:t,layers:n})})}sendUpdateSubscriptionPermissions(t,n){return this.sendRequest({case:"subscriptionPermission",value:new SI({allParticipants:t,trackPermissions:n})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Kt.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new wI({timestamp:Kt.parse(Date.now()),rtt:Kt.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,n){return this.sendRequest({case:"updateAudioTrack",value:new FS({trackSid:t,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Xm({reason:ys.CLIENT_INITIATED,action:dc.DISCONNECT})})}sendRequest(t){return X(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!s&&!CH(n)&&i.state===Bt.RECONNECTING){i.queuedRequests.push(()=>X(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(s||(yield i.requestQueue.flush()),i.signalLatency&&(yield On(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n?.case),i.logContext);return}const a=new Az({message:n});try{i.useJSON?yield i.streamWriter.write(a.toJsonString()):yield i.streamWriter.write(a.toBinary())}catch(o){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:o}))}})()})}handleSignalResponse(t){var n,i;const s=t.message;if(s==null){this.log.debug("received unsupported message",this.logContext);return}let r=!1;if(s.case==="answer"){const a=eR(s.value);this.onAnswer&&this.onAnswer(a,s.value.id,s.value.midToTrackId)}else if(s.case==="offer"){const a=eR(s.value);this.onOffer&&this.onOffer(a,s.value.id,s.value.midToTrackId)}else if(s.case==="trickle"){const a=JSON.parse(s.value.candidateInit);this.onTrickle&&this.onTrickle(a,s.value.target)}else s.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=s.value.participants)!==null&&n!==void 0?n:[]):s.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(s.value):s.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=s.value.speakers)!==null&&i!==void 0?i:[]):s.case==="leave"?this.onLeave&&this.onLeave(s.value):s.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(s.value.sid,s.value.muted):s.case==="roomUpdate"?this.onRoomUpdate&&s.value.room&&this.onRoomUpdate(s.value.room):s.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(s.value):s.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(s.value):s.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(s.value):s.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(s.value):s.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(s.value):s.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(s.value):s.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(s.value):s.case==="pong"||(s.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(s.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):s.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(s.value):s.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(s.value.trackSid):s.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(s.value.token),this.onRoomMoved&&this.onRoomMoved(s.value)):s.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(s.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:s.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return X(this,void 0,void 0,function*(){if(this.state===Bt.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,t),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),n&&n(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Dn.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Dn.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Dn.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Dn.clearInterval(this.pingInterval)}handleSignalConnected(t,n,i){this.state=Bt.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(t.readable.getReader(),i)}validateFirstMessage(t,n){var i,s,r,a,o;return((i=t.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:t.message.value}:this.state===Bt.RECONNECTING&&((s=t.message)===null||s===void 0?void 0:s.case)!=="leave"?((r=t.message)===null||r===void 0?void 0:r.case)==="reconnect"?{isValid:!0,response:t.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((a=t.message)===null||a===void 0?void 0:a.case)==="leave"?{isValid:!1,error:We.leaveRequest("Received leave request while trying to (re)connect",t.message.value.reason)}:n?{isValid:!1,error:We.internal("Unexpected first message")}:{isValid:!1,error:We.internal("did not receive join response, got ".concat((o=t.message)===null||o===void 0?void 0:o.case," instead"))}}handleConnectionError(t,n){return X(this,void 0,void 0,function*(){try{const i=yield fetch(n);switch(i.status){case 404:return We.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const s=yield i.text();return We.notAllowed(s,i.status);default:break}return t instanceof We?t:We.internal("Encountered unknown websocket error during connection: ".concat(t),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof We?i:We.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function eR(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type;break}return t}function oc(e,t){return new Oo({sdp:e.sdp,type:e.type,id:t})}function wH(e,t,n){var i;const s=new URLSearchParams;return s.set("access_token",e),n.reconnect&&(s.set("reconnect","1"),n.sid&&s.set("sid",n.sid)),s.set("auto_subscribe",n.autoSubscribe?"1":"0"),s.set("sdk",Ys()?"reactnative":"js"),s.set("version",t.version),s.set("protocol",t.protocol.toString()),t.deviceModel&&s.set("device_model",t.deviceModel),t.os&&s.set("os",t.os),t.osVersion&&s.set("os_version",t.osVersion),t.browser&&s.set("browser",t.browser),t.browserVersion&&s.set("browser_version",t.browserVersion),n.adaptiveStream&&s.set("adaptive_stream","1"),n.reconnectReason&&s.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&s.set("network",navigator.connection.type),s}function kH(e,t,n){const i=new URLSearchParams;i.set("access_token",e);const s=new n7({clientInfo:t,connectionSettings:new kI({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(s.reconnectReason=n.reconnectReason);const r=new i7({joinRequest:s.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(r.toBinary()))),i}class tR{constructor(){this.buffer=[],this._totalSize=0}push(t){this.buffer.push(t),this._totalSize+=t.data.byteLength}pop(){const t=this.buffer.shift();return t&&(this._totalSize-=t.data.byteLength),t}getAll(){return this.buffer.slice()}popToSequence(t){for(;this.buffer.length>0&&this.buffer[0].sequence<=t;)this.pop()}alignBufferedAmount(t){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=t)break;this.pop()}}get length(){return this.buffer.length}}class TH{constructor(t){this._map=new Map,this._lastCleanup=0,this.ttl=t}set(t,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const s=i+this.ttl;return this._map.set(t,{value:n,expiresAt:s}),this}get(t){const n=this._map.get(t);if(n){if(n.expiresAt<Date.now()){this._map.delete(t);return}return n.value}}has(t){const n=this._map.get(t);return n?n.expiresAt<Date.now()?(this._map.delete(t),!1):!0:!1}delete(t){return this._map.delete(t)}clear(){this._map.clear()}cleanup(){const t=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<t&&this._map.delete(n);this._lastCleanup=t}get size(){return this.cleanup(),this._map.size}forEach(t){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&t(i.value,n,this.asValueMap())}map(t){this.cleanup();const n=[],i=this.asValueMap();for(const[s,r]of i.entries())n.push(t(r,s,i));return n}asValueMap(){const t=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&t.set(n,i.value);return t}}var us={},by={},yy={exports:{}},nR;function JS(){if(nR)return yy.exports;nR=1;var e=yy.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var n="candidate:%s %d %s %d %s %d typ %s";return n+=t.raddr!=null?" raddr %s rport %d":"%v%v",n+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(n+=" generation %d"),n+=t["network-id"]!=null?" network-id %d":"%v",n+=t["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var n="ssrc:%d";return t.attribute!=null&&(n+=" %s",t.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var n="mediaclk:";return n+=t.id!=null?"id=%s %s":"%v%s",n+=t.mediaClockValue!=null?"=%s":"",n+=t.rateNumerator!=null?" rate=%s":"",n+=t.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){var n=e[t];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),yy.exports}var iR;function EH(){return iR||(iR=1,(function(e){var t=function(o){return String(Number(o))===o?Number(o):o},n=function(o,l,u,h){if(h&&!u)l[h]=t(o[1]);else for(var f=0;f<u.length;f+=1)o[f+1]!=null&&(l[u[f]]=t(o[f+1]))},i=function(o,l,u){var h=o.name&&o.names;o.push&&!l[o.push]?l[o.push]=[]:h&&!l[o.name]&&(l[o.name]={});var f=o.push?{}:h?l[o.name]:l;n(u.match(o.reg),f,o.names,o.name),o.push&&l[o.push].push(f)},s=JS(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(o){var l={},u=[],h=l;return o.split(/(\r\n|\r|\n)/).filter(r).forEach(function(f){var m=f[0],g=f.slice(2);m==="m"&&(u.push({rtp:[],fmtp:[]}),h=u[u.length-1]);for(var C=0;C<(s[m]||[]).length;C+=1){var S=s[m][C];if(S.reg.test(g))return i(S,h,g)}}),l.media=u,l};var a=function(o,l){var u=l.split(/=(.+)/,2);return u.length===2?o[u[0]]=t(u[1]):u.length===1&&l.length>1&&(o[u[0]]=void 0),o};e.parseParams=function(o){return o.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(o){return o.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(o){for(var l=[],u=o.split(" ").map(t),h=0;h<u.length;h+=3)l.push({component:u[h],ip:u[h+1],port:u[h+2]});return l},e.parseImageAttributes=function(o){return o.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(o){return o.split(";").map(function(l){return l.split(",").map(function(u){var h,f=!1;return u[0]!=="~"?h=t(u):(h=t(u.substring(1,u.length)),f=!0),{scid:h,paused:f}})})}})(by)),by}var _y,sR;function RH(){if(sR)return _y;sR=1;var e=JS(),t=/%[sdv%]/g,n=function(a){var o=1,l=arguments,u=l.length;return a.replace(t,function(h){if(o>=u)return h;var f=l[o];switch(o+=1,h){case"%%":return"%";case"%s":return String(f);case"%d":return Number(f);case"%v":return""}})},i=function(a,o,l){var u=o.format instanceof Function?o.format(o.push?l:l[o.name]):o.format,h=[a+"="+u];if(o.names)for(var f=0;f<o.names.length;f+=1){var m=o.names[f];o.name?h.push(l[o.name][m]):h.push(l[o.names[f]])}else h.push(l[o.name]);return n.apply(null,h)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],r=["i","c","b","a"];return _y=function(a,o){o=o||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(f){f.payloads==null&&(f.payloads="")});var l=o.outerOrder||s,u=o.innerOrder||r,h=[];return l.forEach(function(f){e[f].forEach(function(m){m.name in a&&a[m.name]!=null?h.push(i(f,m,a)):m.push in a&&a[m.push]!=null&&a[m.push].forEach(function(g){h.push(i(f,m,g))})})}),a.media.forEach(function(f){h.push(i("m",e.m[0],f)),u.forEach(function(m){e[m].forEach(function(g){g.name in f&&f[g.name]!=null?h.push(i(m,g,f)):g.push in f&&f[g.push]!=null&&f[g.push].forEach(function(C){h.push(i(m,g,C))})})})}),h.join(`\r
`)+`\r
`},_y}var rR;function AH(){if(rR)return us;rR=1;var e=EH(),t=RH(),n=JS();return us.grammar=n,us.write=t,us.parse=e.parse,us.parseParams=e.parseParams,us.parseFmtpConfig=e.parseFmtpConfig,us.parsePayloads=e.parsePayloads,us.parseRemoteCandidates=e.parseRemoteCandidates,us.parseImageAttributes=e.parseImageAttributes,us.parseSimulcastStreamList=e.parseSimulcastStreamList,us}var bo=AH();function XS(e,t,n){var i,s,r;t===void 0&&(t=50),n===void 0&&(n={});var a=(i=n.isImmediate)!=null&&i,o=(s=n.callback)!=null&&s,l=n.maxWait,u=Date.now(),h=[];function f(){if(l!==void 0){var g=Date.now()-u;if(g+t>=l)return l-g}return t}var m=function(){var g=[].slice.call(arguments),C=this;return new Promise(function(S,v){var _=a&&r===void 0;if(r!==void 0&&clearTimeout(r),r=setTimeout(function(){if(r=void 0,u=Date.now(),!a){var x=e.apply(C,g);o&&o(x),h.forEach(function(k){return(0,k.resolve)(x)}),h=[]}},f()),_){var w=e.apply(C,g);return o&&o(w),S(w)}h.push({resolve:S,reject:v})})};return m.cancel=function(g){r!==void 0&&clearTimeout(r),h.forEach(function(C){return(0,C.reject)(g)}),h=[]},m}const MH=.7,LH=20,Oa={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class oR extends Zs.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=it,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=XS(s=>X(this,void 0,void 0,function*(){this.emit(Oa.NegotiationStarted);try{yield this.createAndSendOffer()}catch(r){if(s)s(r);else throw r}}),LH),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Ks((i=n.loggerName)!==null&&i!==void 0?i:is.PCTransport),this.loggerOptions=n,this.config=t,this._pc=this.createPC(),this.offerLock=new ni}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},t.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},t.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,t.connectionState)},t.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},t.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},t}get logContext(){var t,n;return Object.assign({},(n=(t=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return X(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t,n){return X(this,void 0,void 0,function*(){var i;if(t.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let s;if(t.type==="offer"){let{stereoMids:r,nackMids:a}=IH(t);this.remoteStereoMids=r,this.remoteNackMids=a}else if(t.type==="answer"){const r=bo.parse((i=t.sdp)!==null&&i!==void 0?i:"");r.media.forEach(a=>{const o=ZS(a.mid);a.type==="audio"&&this.trackBitrates.some(l=>{if(!l.transceiver||o!=l.transceiver.mid)return!1;let u=0;if(a.rtp.some(f=>f.codec.toUpperCase()===l.codec.toUpperCase()?(u=f.payload,!0):!1),u===0)return!0;let h=!1;for(const f of a.fmtp)if(f.payload===u){f.config=f.config.split(";").filter(m=>!m.includes("maxaveragebitrate")).join(";"),l.maxbr>0&&(f.config+=";maxaveragebitrate=".concat(l.maxbr*1e3)),h=!0;break}return h||l.maxbr>0&&a.fmtp.push({payload:u,config:"maxaveragebitrate=".concat(l.maxbr*1e3)}),!0})}),s=bo.write(r)}return yield this.setMungedSDP(t,s,!0),this.pendingCandidates.forEach(r=>{this.pc.addIceCandidate(r)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(Oa.NegotiationComplete),t.sdp&&bo.parse(t.sdp).media.forEach(a=>{a.type==="video"&&this.emit(Oa.RTPVideoPayloadTypes,a.rtp)})),!0})}createAndSendOffer(t){return X(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(t?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const o=this._pc.remoteDescription;if(t?.iceRestart&&o)yield this._pc.setRemoteDescription(o);else{this.renegotiate=!0,this.log.debug("requesting renegotiation",Object.assign({},this.logContext));return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const s=this.latestOfferId+1;this.latestOfferId=s;const r=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const a=bo.parse((n=r.sdp)!==null&&n!==void 0?n:"");if(a.media.forEach(o=>{lR(o),o.type==="audio"?aR(o,["all"],[]):o.type==="video"&&this.trackBitrates.some(l=>{if(!o.msid||!l.cid||!o.msid.includes(l.cid))return!1;let u=0;if(o.rtp.some(f=>f.codec.toUpperCase()===l.codec.toUpperCase()?(u=f.payload,!0):!1),u===0||(vs(l.codec)&&!$a()&&this.ensureVideoDDExtensionForSVC(o,a),!vs(l.codec)))return!0;const h=Math.round(l.maxbr*MH);for(const f of o.fmtp)if(f.payload===u){f.config.includes("x-google-start-bitrate")||(f.config+=";x-google-start-bitrate=".concat(h));break}return!0})}),this.latestOfferId>s){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:s}));return}yield this.setMungedSDP(r,bo.write(a)),this.onOffer(r,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return X(this,void 0,void 0,function*(){var t;const n=yield this.pc.createAnswer(),i=bo.parse((t=n.sdp)!==null&&t!==void 0?t:"");return i.media.forEach(s=>{lR(s),s.type==="audio"&&aR(s,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,bo.write(i)),n})}createDataChannel(t,n){return this.pc.createDataChannel(t,n)}addTransceiver(t,n){return this.pc.addTransceiver(t,n)}addTransceiverOfKind(t,n){return this.pc.addTransceiver(t,n)}addTrack(t){if(!this._pc)throw new ln("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var n;if(!this._pc)throw new ln("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(t)}getConnectionState(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return X(this,void 0,void 0,function*(){var t;if(!this._pc)return;let n="";const i=new Map,s=new Map;if((yield this._pc.getStats()).forEach(o=>{switch(o.type){case"transport":n=o.selectedCandidatePairId;break;case"candidate-pair":n===""&&o.selected&&(n=o.id),i.set(o.id,o);break;case"remote-candidate":s.set(o.id,"".concat(o.address,":").concat(o.port));break}}),n==="")return;const a=(t=i.get(n))===null||t===void 0?void 0:t.remoteCandidateId;if(a!==void 0)return s.get(a)})}setMungedSDP(t,n,i){return X(this,void 0,void 0,function*(){if(n){const s=t.sdp;t.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(r){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:r,sdp:n})),t.sdp=s}}try{i?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(s){let r="unknown error";s instanceof Error?r=s.message:typeof s=="string"&&(r=s);const a={error:r,sdp:t.sdp};throw!i&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new Pa(r)}})}ensureVideoDDExtensionForSVC(t,n){var i,s;if(!((i=t.ext)===null||i===void 0?void 0:i.some(a=>a.uri===$E))){if(this.ddExtID===0){let a=0;n.media.forEach(o=>{var l;o.type==="video"&&((l=o.ext)===null||l===void 0||l.forEach(u=>{u.value>a&&(a=u.value)}))}),this.ddExtID=a+1}(s=t.ext)===null||s===void 0||s.push({value:this.ddExtID,uri:$E})}}}function aR(e,t,n){const i=ZS(e.mid);let s=0;e.rtp.some(r=>r.codec==="opus"?(s=r.payload,!0):!1),s>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(i)&&!e.rtcpFb.some(r=>r.payload===s&&r.type==="nack")&&e.rtcpFb.push({payload:s,type:"nack"}),(t.includes(i)||t.length===1&&t[0]==="all")&&e.fmtp.some(r=>r.payload===s?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function IH(e){var t;const n=[],i=[],s=bo.parse((t=e.sdp)!==null&&t!==void 0?t:"");let r=0;return s.media.forEach(a=>{var o;const l=ZS(a.mid);a.type==="audio"&&(a.rtp.some(u=>u.codec==="opus"?(r=u.payload,!0):!1),!((o=a.rtcpFb)===null||o===void 0)&&o.some(u=>u.payload===r&&u.type==="nack")&&i.push(l),a.fmtp.some(u=>u.payload===r?(u.config.includes("sprop-stereo=1")&&n.push(l),!0):!1))}),{stereoMids:n,nackMids:i}}function lR(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(e.connection.version===4&&t||e.connection.version===6&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}function ZS(e){return typeof e=="number"?e.toFixed(0):e}const f0="vp8",PH={audioPreset:s0.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:GS.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:f0,backupCodec:!0,preConnectBuffer:!1},fP={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},pP={deviceId:{ideal:"default"},resolution:Pd.h720.resolution},DH={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new d7,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},eC={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Qt;(function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"})(Qt||(Qt={}));class OH{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(t,n,i){var s;this.peerConnectionTimeout=eC.peerConnectionTimeout,this.log=it,this.updateState=()=>{var r,a;const o=this.state,l=this.requiredTransports.map(u=>u.getConnectionState());l.every(u=>u==="connected")?this.state=Qt.CONNECTED:l.some(u=>u==="failed")?this.state=Qt.FAILED:l.some(u=>u==="connecting")?this.state=Qt.CONNECTING:l.every(u=>u==="closed")?this.state=Qt.CLOSED:l.some(u=>u==="closed")?this.state=Qt.CLOSING:l.every(u=>u==="new")&&(this.state=Qt.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(Qt[o]," to ").concat(Qt[this.state]),this.logContext),(r=this.onStateChange)===null||r===void 0||r.call(this,this.state,this.publisher.getConnectionState(),(a=this.subscriber)===null||a===void 0?void 0:a.getConnectionState()))},this.log=Ks((s=i.loggerName)!==null&&s!==void 0?s:is.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new oR(t,i),this._mode=n,n!=="publisher-only"&&(this.subscriber=new oR(t,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=r=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,r,gs.SUBSCRIBER)},this.subscriber.onDataChannel=r=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,r)},this.subscriber.onTrack=r=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,r)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=r=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,r,gs.PUBLISHER)},this.publisher.onTrack=r=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,r)},this.publisher.onOffer=(r,a)=>{var o;(o=this.onPublisherOffer)===null||o===void 0||o.call(this,r,a)},this.state=Qt.NEW,this.connectionLock=new ni,this.remoteOfferLock=new ni}get logContext(){var t,n;return Object.assign({},(n=(t=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t,n){return this.publisher.setRemoteDescription(t,n)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return X(this,void 0,void 0,function*(){var t;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(s){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:s}))}}yield Promise.all([this.publisher.close(),(t=this.subscriber)===null||t===void 0?void 0:t.close()]),this.updateState()})}triggerIceRestart(){return X(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,n){return X(this,void 0,void 0,function*(){var i;n===gs.PUBLISHER?yield this.publisher.addIceCandidate(t):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t,n){return X(this,void 0,void 0,function*(){var i,s,r;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const a=yield this.remoteOfferLock.lock();try{return(yield(s=this.subscriber)===null||s===void 0?void 0:s.setRemoteDescription(t,n))?yield(r=this.subscriber)===null||r===void 0?void 0:r.createAndSetAnswer():void 0}finally{a()}})}updateConfiguration(t,n){var i;this.publisher.setConfiguration(t),(i=this.subscriber)===null||i===void 0||i.setConfiguration(t),n&&this.triggerIceRestart()}ensurePCTransportConnection(t,n){return X(this,void 0,void 0,function*(){var i;const s=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(r=>this.ensureTransportConnected(r,t,n)))}finally{s()}})}negotiate(t){return X(this,void 0,void 0,function*(){return new zn((n,i)=>X(this,void 0,void 0,function*(){let s=setTimeout(()=>{i(new Pa("negotiation timed out"))},this.peerConnectionTimeout);const r=()=>{clearTimeout(s),this.publisher.off(Oa.NegotiationStarted,o),t.signal.removeEventListener("abort",a)},a=()=>{r(),i(new Pa("negotiation aborted"))},o=()=>{t.signal.aborted||(clearTimeout(s),s=setTimeout(()=>{r(),i(new Pa("negotiation timed out"))},this.peerConnectionTimeout))};t.signal.addEventListener("abort",a),this.publisher.on(Oa.NegotiationStarted,o),this.publisher.once(Oa.NegotiationComplete,()=>{r(),n()}),yield this.publisher.negotiate(l=>{r(),l instanceof Error?i(l):i(new Error(String(l)))})}))})}addPublisherTransceiver(t,n){return this.publisher.addTransceiver(t,n)}addPublisherTransceiverOfKind(t,n){return this.publisher.addTransceiverOfKind(t,n)}getMidForReceiver(t){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(s=>s.receiver===t);return i?.mid}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,n){return this.publisher.createDataChannel(t,n)}getConnectedAddress(t){return t===gs.PUBLISHER?this.publisher.getConnectedAddress():t===gs.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&t.push(this.subscriber),t}ensureTransportConnected(t,n){return X(this,arguments,void 0,function(i,s){var r=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((l,u)=>X(r,void 0,void 0,function*(){const h=()=>{this.log.warn("abort transport connection",this.logContext),Dn.clearTimeout(f),u(We.cancelled("room connection has been cancelled"))};s?.signal.aborted&&h(),s?.signal.addEventListener("abort",h);const f=Dn.setTimeout(()=>{s?.signal.removeEventListener("abort",h),u(We.internal("could not establish pc connection"))},a);for(;this.state!==Qt.CONNECTED;)if(yield On(50),s?.signal.aborted){u(We.cancelled("room connection has been cancelled"));return}Dn.clearTimeout(f),s?.signal.removeEventListener("abort",h),l()}))})()})}}const mP=5e3,NH=3e4;class bt{static fetchRegionSettings(t,n,i){return X(this,void 0,void 0,function*(){const s=yield bt.fetchLock.lock();try{const r=yield fetch("".concat(jH(t),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(r.ok){const a=rH(r.headers),o=a?a*1e3:mP;return{regionSettings:yield r.json(),updatedAtInMs:Date.now(),maxAgeInMs:o}}else throw r.status===401?We.notAllowed("Could not fetch region settings: ".concat(r.statusText),r.status):We.internal("Could not fetch region settings: ".concat(r.statusText))}catch(r){throw r instanceof We?r:i?.aborted?We.cancelled("Region fetching was aborted"):We.serverUnreachable("Could not fetch region settings, ".concat(r instanceof Error?"".concat(r.name,": ").concat(r.message):r))}finally{s()}})}static scheduleRefetch(t,n,i){return X(this,void 0,void 0,function*(){const s=bt.settingsTimeouts.get(t.hostname);clearTimeout(s),bt.settingsTimeouts.set(t.hostname,setTimeout(()=>X(this,void 0,void 0,function*(){try{const r=yield bt.fetchRegionSettings(t,n);bt.updateCachedRegionSettings(t,n,r)}catch(r){if(r instanceof We&&r.reason===Ft.NotAllowed){it.debug("token is not valid, cancelling auto region refresh");return}it.debug("auto refetching of region settings failed",{error:r}),bt.scheduleRefetch(t,n,i)}}),i))})}static updateCachedRegionSettings(t,n,i){bt.cache.set(t.hostname,i),bt.scheduleRefetch(t,n,i.maxAgeInMs)}static stopRefetch(t){const n=bt.settingsTimeouts.get(t);n&&(clearTimeout(n),bt.settingsTimeouts.delete(t))}static scheduleCleanup(t){let n=bt.connectionTrackers.get(t);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=bt.connectionTrackers.get(t);i&&i.connectionCount===0&&(it.debug("stopping region refetch after disconnect delay",{hostname:t}),bt.stopRefetch(t)),i&&(i.cleanupTimeout=void 0)},NH))}static cancelCleanup(t){const n=bt.connectionTrackers.get(t);n?.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const t=this.serverUrl.hostname;let n=bt.connectionTrackers.get(t);n||(n={connectionCount:0},bt.connectionTrackers.set(t,n)),n.connectionCount++,bt.cancelCleanup(t)}notifyDisconnected(){const t=this.serverUrl.hostname,n=bt.connectionTrackers.get(t);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&bt.scheduleCleanup(t))}constructor(t,n){this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=n}updateToken(t){this.token=t}isCloud(){return xc(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(t){return X(this,void 0,void 0,function*(){return bt.fetchRegionSettings(this.serverUrl,this.token,t)})}getNextBestRegionUrl(t){return X(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=bt.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(t),bt.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(s=>!this.attemptedRegions.find(r=>r.url===s.url));if(i.length>0){const s=i[0];return this.attemptedRegions.push(s),it.debug("next region: ".concat(s.region)),s.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(t){bt.updateCachedRegionSettings(this.serverUrl,this.token,t)}}bt.cache=new Map;bt.settingsTimeouts=new Map;bt.connectionTrackers=new Map;bt.fetchLock=new ni;function jH(e){return"".concat(e.protocol.replace("ws","http"),"//").concat(e.host,"/settings")}class nn extends Error{constructor(t,n,i){super(n),this.code=t,this.message=cR(n,nn.MAX_MESSAGE_BYTES),this.data=i?cR(i,nn.MAX_DATA_BYTES):void 0}static fromProto(t){return new nn(t.code,t.message,t.data)}toProto(){return new iI({code:this.code,message:this.message,data:this.data})}static builtIn(t,n){return new nn(nn.ErrorCode[t],nn.ErrorMessage[t],n)}}nn.MAX_MESSAGE_BYTES=256;nn.MAX_DATA_BYTES=15360;nn.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};nn.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const gP=15360;function tC(e){return new TextEncoder().encode(e).length}function cR(e,t){if(tC(e)<=t)return e;let n=0,i=e.length;const s=new TextEncoder;for(;n<i;){const r=Math.floor((n+i+1)/2);s.encode(e.slice(0,r)).length<=t?n=r:i=r-1}return e.slice(0,n)}const nC=2e3;function eg(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),n===void 0||i===void 0||e.timestamp===void 0||t.timestamp===void 0?0:(n-i)*8*1e3/(e.timestamp-t.timestamp)}const iC=typeof MediaRecorder<"u";class BH{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const FH=iC?MediaRecorder:BH;class UH extends FH{constructor(t,n){if(!iC)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([t.mediaStreamTrack]),n);let i,s;const r=()=>s===void 0,a=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",o),s?.close(),s=void 0},o=l=>{s?.error(l),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",o),s=void 0};this.byteStream=new ReadableStream({start:l=>{s=l,i=u=>X(this,void 0,void 0,function*(){let h;if(u.data.arrayBuffer){const f=yield u.data.arrayBuffer();h=new Uint8Array(f)}else if(u.data.byteArray)h=u.data.byteArray;else throw new Error("no data available!");r()||l.enqueue(h)}),this.addEventListener("dataavailable",i)},cancel:()=>{a()}}),this.addEventListener("stop",a),this.addEventListener("error",o)}}function zH(){return iC}const HH=1e3,$H=1e4;class vP extends ve{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(t,n,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=arguments.length>4?arguments[4]:void 0;super(t,n,r),this.manuallyStopped=!1,this.pendingDeviceChange=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=XS(()=>X(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>X(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ke.Ended,this)},this.reacquireTrack=!1,this.providedByUser=s,this.muteLock=new ni,this.pauseUpstreamLock=new ni,this.trackChangeLock=new ni,this.trackChangeLock.lock().then(a=>X(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(t,!0)}finally{a()}})),this._constraints=t.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==ve.Kind.Video)return;const{width:t,height:n}=this._mediaStreamTrack.getSettings();if(t&&n)return{width:t,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,n;return(n=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(t,n){return X(this,void 0,void 0,function*(){var i;if(t===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(r=>{fc(this._mediaStreamTrack,r)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let s;if(this.processor&&t){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(rc(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),s=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(s??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(r=>{rc(s??t,r)}))})}waitForDimensions(){return X(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:HH;return(function*(){var i;if(t.kind===ve.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=vi())===null||i===void 0?void 0:i.os)==="iOS"&&(yield On(10));const s=Date.now();for(;Date.now()-s<n;){const r=t.dimensions;if(r)return r;yield On(50)}throw new Dr("unable to get track dimensions after timeout")})()})}setDeviceId(t){return X(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===Da(t)?!0:(this._constraints.deviceId=t,this.isMuted?(this.pendingDeviceChange=!0,!0):(yield this.restartTrack(),Da(t)===this._mediaStreamTrack.getSettings().deviceId))})}getDeviceId(){return X(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(t.source===ve.Source.ScreenShare)return;const{deviceId:i,groupId:s}=t._mediaStreamTrack.getSettings(),r=t.kind===ve.Kind.Audio?"audioinput":"videoinput";return n?kn.getInstance().normalizeDeviceId(r,i,s):i})()})}mute(){return X(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return X(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,n){return X(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Dr("unable to replace an unpublished track");let s,r;return typeof n=="boolean"?s=n:n!==void 0&&(s=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=s??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),r&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(t){return X(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{t||(t=this._constraints);const{deviceId:i,facingMode:s}=t,r=h7(t,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const a={audio:!1,video:!1};this.kind===ve.Kind.Video?a.video=i||s?{deviceId:i,facingMode:s}:!0:a.audio=i?Object.assign({deviceId:i},r):!0,this.attachedElements.forEach(u=>{fc(this.mediaStreamTrack,u)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(a)).getTracks()[0];return this.kind===ve.Kind.Video&&(yield l.applyConstraints(r)),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=t,this.pendingDeviceChange=!1,this.emit(ke.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?ke.Muted:ke.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),cP()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return X(this,void 0,void 0,function*(){var t;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ke.UpstreamPaused,this);const i=vi();if(i?.name==="Safari"&&Qs(i.version,"12.0")<0)throw new WS("pauseUpstream is not supported on Safari < 12.");((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return X(this,void 0,void 0,function*(){var t;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ke.UpstreamResumed,this),((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return X(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return X(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var r;const a=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const o=document.createElement(i.kind),l={kind:i.kind,track:i._mediaStreamTrack,element:o,audioContext:i.audioContext};if(yield n.init(l),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(rc(i._mediaStreamTrack,o),o.muted=!0,o.play().catch(u=>{u instanceof DOMException&&u.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:u})),setTimeout(()=>{o.play().catch(h=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:h}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:u}))}),i.processor=n,i.processorElement=o,i.processor.processedTrack){for(const u of i.attachedElements)u!==i.processorElement&&s&&(fc(i._mediaStreamTrack,u),rc(i.processor.processedTrack,u));yield(r=i.sender)===null||r===void 0?void 0:r.replaceTrack(i.processor.processedTrack)}i.emit(ke.TrackProcessorUpdate,i.processor)}finally{a()}})()})}getProcessor(){return this.processor}stopProcessor(){return X(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield t.trackChangeLock.lock();try{yield t.internalStopProcessor(n)}finally{i()}})()})}internalStopProcessor(){return X(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,s;t.processor&&(t.log.debug("stopping processor",t.logContext),(i=t.processor.processedTrack)===null||i===void 0||i.stop(),yield t.processor.destroy(),t.processor=void 0,n||((s=t.processorElement)===null||s===void 0||s.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(ke.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!zH()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new UH(this,{mimeType:n})}this.localTrackRecorder.start(t),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},$H)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.byteStream}getPreConnectBufferMimeType(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.mimeType}}class rm extends vP{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(t,ve.Kind.Audio,n,i,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>X(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(o){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:o}));return}a&&this.prevStats&&(this._currentBitrate=eg(a,this.prevStats)),this.prevStats=a}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ke.AudioTrackFeatureUpdate,this,wn.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ke.AudioTrackFeatureUpdate,this,wn.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=s,this.checkForSilence()}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ve.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{n()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===ve.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||this.pendingDeviceChange)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}restartTrack(t){return X(this,void 0,void 0,function*(){let n;if(t){const i=KS({audio:t});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(t){const n=Object.create(null,{restart:{get:()=>super.restart}});return X(this,void 0,void 0,function*(){const i=yield n.restart.call(this,t);return this.checkForSilence(),i})}startMonitor(){mi()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},nC)))}setProcessor(t){return X(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!Ys()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const s={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(s),this.processor=t,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ke.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return X(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(s=>{s.type==="outbound-rtp"&&(i={type:"audio",streamId:s.id,packetsSent:s.packetsSent,packetsLost:s.packetsLost,bytesSent:s.bytesSent,timestamp:s.timestamp,roundTripTime:s.roundTripTime,jitter:s.jitter})}),i})}checkForSilence(){return X(this,void 0,void 0,function*(){const t=yield oP(this);return t&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ke.AudioSilenceDetected)),t})}}function qH(e,t,n){switch(e.kind){case"audio":return new rm(e,t,!1,void 0,n);case"video":return new om(e,t,!1,n);default:throw new Dr("unsupported track type: ".concat(e.kind))}}const VH=Object.values(Pd),WH=Object.values(r0),GH=Object.values(GS),KH=[Pd.h180,Pd.h360],YH=[r0.h180,r0.h360],QH=e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map(n=>{var i,s;return new Dt(Math.floor(e.width/n.scaleResolutionDownBy),Math.floor(e.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=e.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((s=n.fps)!==null&&s!==void 0?s:30))))),n.fps,e.encoding.priority)}),p0=["q","h","f"];function m0(e,t,n,i){var s,r;let a=i?.videoEncoding;e&&(a=i?.screenShareEncoding);const o=i?.simulcast,l=i?.scalabilityMode,u=i?.videoCodec;if(!a&&!o&&!l||!t||!n)return[{}];a||(a=XH(e,t,n,u),it.debug("using video encoding",a));const h=a.maxFramerate,f=new Dt(t,n,a.maxBitrate,a.maxFramerate,a.priority);if(l&&vs(u)){const C=new bP(l),S=[];if(C.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const v=vi();if(Dd()||Ys()||v?.name==="Chrome"&&Qs(v?.version,"113")<0){const _=C.suffix=="h"?2:3,w=G7(v);for(let x=0;x<C.spatial;x+=1)S.push({rid:p0[2-x],maxBitrate:a.maxBitrate/Math.pow(_,x),maxFramerate:f.encoding.maxFramerate,scaleResolutionDownBy:w?Math.pow(2,x):void 0});S[0].scalabilityMode=l}else S.push({maxBitrate:a.maxBitrate,maxFramerate:f.encoding.maxFramerate,scalabilityMode:l});return f.encoding.priority&&(S[0].priority=f.encoding.priority,S[0].networkPriority=f.encoding.priority),it.debug("using svc encoding",{encodings:S}),S}if(!o)return[a];let m=[];e?m=(s=dR(i?.screenShareSimulcastLayers))!==null&&s!==void 0?s:uR(e,f):m=(r=dR(i?.videoSimulcastLayers))!==null&&r!==void 0?r:uR(e,f);let g;if(m.length>0){const C=m[0];m.length>1&&([,g]=m);const S=Math.max(t,n);if(S>=960&&g)return Sy(t,n,[C,g,f],h);if(S>=480)return Sy(t,n,[C,f],h)}return Sy(t,n,[f])}function JH(e,t,n){var i,s,r,a;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&it.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const o=e.mediaStreamTrack.getSettings(),l=(i=o.width)!==null&&i!==void 0?i:(s=e.dimensions)===null||s===void 0?void 0:s.width,u=(r=o.height)!==null&&r!==void 0?r:(a=e.dimensions)===null||a===void 0?void 0:a.height;return e.source===ve.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),m0(e.source===ve.Source.ScreenShare,l,u,n)}function XH(e,t,n,i){const s=ZH(e,t,n);let{encoding:r}=s[0];const a=Math.max(t,n);for(let o=0;o<s.length;o+=1){const l=s[o];if(r=l.encoding,l.width>=a)break}if(i)switch(i){case"av1":case"h265":r=Object.assign({},r),r.maxBitrate=r.maxBitrate*.7;break;case"vp9":r=Object.assign({},r),r.maxBitrate=r.maxBitrate*.85;break}return r}function ZH(e,t,n){if(e)return GH;const i=t>n?t/n:n/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?VH:WH}function uR(e,t){if(e)return QH(t);const{width:n,height:i}=t,s=n>i?n/i:i/n;return Math.abs(s-16/9)<Math.abs(s-4/3)?KH:YH}function Sy(e,t,n,i){const s=[];if(n.forEach((r,a)=>{if(a>=p0.length)return;const o=Math.min(e,t),u={rid:p0[a],scaleResolutionDownBy:Math.max(1,o/Math.min(r.width,r.height)),maxBitrate:r.encoding.maxBitrate},h=i&&r.encoding.maxFramerate?Math.min(i,r.encoding.maxFramerate):r.encoding.maxFramerate;h&&(u.maxFramerate=h);const f=Ha()||a===0;r.encoding.priority&&f&&(u.priority=r.encoding.priority,u.networkPriority=r.encoding.priority),s.push(u)}),Ys()&&dP()==="ios"){let r;s.forEach(o=>{r?o.maxFramerate&&o.maxFramerate>r&&(r=o.maxFramerate):r=o.maxFramerate});let a=!0;s.forEach(o=>{var l;o.maxFramerate!=r&&(a&&(a=!1,it.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),it.info('Setting framerate of encoding "'.concat((l=o.rid)!==null&&l!==void 0?l:"",'" to ').concat(r)),o.maxFramerate=r)})}return s}function dR(e){if(e)return e.sort((t,n)=>{const{encoding:i}=t,{encoding:s}=n;return i.maxBitrate>s.maxBitrate?1:i.maxBitrate<s.maxBitrate?-1:i.maxBitrate===s.maxBitrate&&i.maxFramerate&&s.maxFramerate?i.maxFramerate>s.maxFramerate?1:-1:0})}class bP{constructor(t){const n=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function e$(e){return e.source===ve.Source.ScreenShare||e.constraints.height&&Da(e.constraints.height)>=1080?"maintain-resolution":"balanced"}const t$=5e3;class om extends vP{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0;super(t,ve.Kind.Video,n,i,s),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>X(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let r;try{r=yield this.getSenderStats()}catch(l){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const a=new Map(r.map(l=>[l.rid,l])),o=r.some(l=>l.qualityLimitationReason==="cpu");if(o!==this.isCpuConstrained&&(this.isCpuConstrained=o,this.isCpuConstrained&&this.emit(ke.CpuConstrained)),this.prevStats){let l=0;a.forEach((u,h)=>{var f;const m=(f=this.prevStats)===null||f===void 0?void 0:f.get(h);l+=eg(u,m)}),this._currentBitrate=l}this.prevStats=a}),this.senderLock=new ni}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var n;if(this.signalClient=t,!mi())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},nC))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return X(this,void 0,void 0,function*(){var n,i,s,r,a;yield t.pauseUpstream.call(this);try{for(var o=!0,l=Pr(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;o=!0)r=u.value,o=!1,yield(a=r.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(h){i={error:h}}finally{try{!o&&!n&&(s=l.return)&&(yield s.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return X(this,void 0,void 0,function*(){var n,i,s,r,a;yield t.resumeUpstream.call(this);try{for(var o=!0,l=Pr(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;o=!0){r=u.value,o=!1;const h=r;yield(a=h.sender)===null||a===void 0?void 0:a.replaceTrack(h.mediaStreamTrack)}}catch(h){i={error:h}}finally{try{!o&&!n&&(s=l.return)&&(yield s.call(l))}finally{if(i)throw i.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ve.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{n()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===ve.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(t){super.setTrackMuted(t);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!t}getSenderStats(){return X(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(s=>{var r;if(s.type==="outbound-rtp"){const a={type:"video",streamId:s.id,frameHeight:s.frameHeight,frameWidth:s.frameWidth,framesPerSecond:s.framesPerSecond,framesSent:s.framesSent,firCount:s.firCount,pliCount:s.pliCount,nackCount:s.nackCount,packetsSent:s.packetsSent,bytesSent:s.bytesSent,qualityLimitationReason:s.qualityLimitationReason,qualityLimitationDurations:s.qualityLimitationDurations,qualityLimitationResolutionChanges:s.qualityLimitationResolutionChanges,rid:(r=s.rid)!==null&&r!==void 0?r:s.id,retransmittedPacketsSent:s.retransmittedPacketsSent,targetBitrate:s.targetBitrate,timestamp:s.timestamp},o=i.get(s.remoteId);o&&(a.jitter=o.jitter,a.packetsLost=o.packetsLost,a.roundTripTime=o.roundTripTime),n.push(a)}}),n.sort((s,r)=>{var a,o;return((a=r.frameWidth)!==null&&a!==void 0?a:0)-((o=s.frameWidth)!==null&&o!==void 0?o:0)}),n})}setPublishingQuality(t){const n=[];for(let i=Li.LOW;i<=Li.HIGH;i+=1)n.push(new zS({quality:i,enabled:i<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(vs(this.codec),n)}restartTrack(t){return X(this,void 0,void 0,function*(){var n,i,s,r,a;let o;if(t){const f=KS({video:t});typeof f.video!="boolean"&&(o=f.video)}yield this.restart(o),this.isCpuConstrained=!1;try{for(var l=!0,u=Pr(this.simulcastCodecs.values()),h;h=yield u.next(),n=h.done,!n;l=!0){r=h.value,l=!1;const f=r;f.sender&&((a=f.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(f.mediaStreamTrack=this.mediaStreamTrack.clone(),yield f.sender.replaceTrack(f.mediaStreamTrack))}}catch(f){i={error:f}}finally{try{!l&&!n&&(s=u.return)&&(yield s.call(u))}finally{if(i)throw i.error}}})}setProcessor(t){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return X(this,arguments,void 0,function(i){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var a,o,l,u,h,f;if(yield n.setProcessor.call(s,i,r),!((h=s.processor)===null||h===void 0)&&h.processedTrack)try{for(var m=!0,g=Pr(s.simulcastCodecs.values()),C;C=yield g.next(),a=C.done,!a;m=!0)u=C.value,m=!1,yield(f=u.sender)===null||f===void 0?void 0:f.replaceTrack(s.processor.processedTrack)}catch(S){o={error:S}}finally{try{!m&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}})()})}setDegradationPreference(t){return X(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const n=this.sender.getParameters();n.degradationPreference=t,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(t,n){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(t,i),i}setSimulcastTrackSender(t,n){const i=this.simulcastCodecs.get(t);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},t$))}setPublishingCodecs(t){return X(this,void 0,void 0,function*(){var n,i,s,r,a,o,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(vs(t[0].codec),t[0].qualities),[];this.subscribedCodecs=t;const u=[];try{for(n=!0,i=Pr(t);s=yield i.next(),r=s.done,!r;n=!0){l=s.value,n=!1;const h=l;if(!this.codec||this.codec===h.codec)yield this.setPublishingLayers(vs(h.codec),h.qualities);else{const f=this.simulcastCodecs.get(h.codec);if(this.log.debug("try setPublishingCodec for ".concat(h.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:f})),!f||!f.sender){for(const m of h.qualities)if(m.enabled){u.push(h.codec);break}}else f.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(h.codec),this.logContext),yield hR(f.sender,f.encodings,h.qualities,this.senderLock,vs(h.codec),this.log,this.logContext))}}}catch(h){a={error:h}}finally{try{!n&&!r&&(o=i.return)&&(yield o.call(i))}finally{if(a)throw a.error}}return u})}setPublishingLayers(t,n){return X(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield hR(this.sender,this.encodings,n,this.senderLock,t,this.log,this.logContext))})}prioritizePerformance(){return X(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const t=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,s)=>{var r;return Object.assign(Object.assign({},i),{active:s===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((r=this.mediaStreamTrack.getSettings().height)!==null&&r!==void 0?r:360)/360)),scalabilityMode:s===0&&vs(this.codec)?"L1T3":void 0,maxFramerate:s===0?15:0,maxBitrate:s===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{t()}})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),cP()&&this.isInBackground&&this.source===ve.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function hR(e,t,n,i,s,r,a){return X(this,void 0,void 0,function*(){const o=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:e,qualities:n,senderEncodings:t}));try{const l=e.getParameters(),{encodings:u}=l;if(!u)return;if(u.length!==t.length){r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:u,senderEncodings:t}));return}let h=!1;!1&&u[0].scalabilityMode||(s&&n.some(g=>g.enabled)&&n.forEach(g=>g.enabled=!0),u.forEach((m,g)=>{var C;let S=(C=m.rid)!==null&&C!==void 0?C:"";S===""&&(S="q");const v=yP(S),_=n.find(w=>w.quality===v);_&&m.active!==_.enabled&&(h=!0,m.active=_.enabled,r.debug("setting layer ".concat(_.quality," to ").concat(m.active?"enabled":"disabled"),a),Ha()&&(_.enabled?(m.scaleResolutionDownBy=t[g].scaleResolutionDownBy,m.maxBitrate=t[g].maxBitrate,m.maxFrameRate=t[g].maxFrameRate):(m.scaleResolutionDownBy=4,m.maxBitrate=10,m.maxFrameRate=2)))})),h&&(l.encodings=u,r.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:l.encodings})),yield e.setParameters(l))}finally{o()}})}function yP(e){switch(e){case"f":return Li.HIGH;case"h":return Li.MEDIUM;case"q":return Li.LOW;default:return Li.HIGH}}function fR(e,t,n,i){if(!n)return[new Lo({quality:Li.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const s=n[0].scalabilityMode,r=new bP(s),a=[],o=r.suffix=="h"?1.5:2,l=r.suffix=="h"?2:3;for(let u=0;u<r.spatial;u+=1)a.push(new Lo({quality:Math.min(Li.HIGH,r.spatial-1)-u,width:Math.ceil(e/Math.pow(o,u)),height:Math.ceil(t/Math.pow(o,u)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(l,u)):0,ssrc:0}));return a}return n.map(s=>{var r,a,o;const l=(r=s.scaleResolutionDownBy)!==null&&r!==void 0?r:1;let u=yP((a=s.rid)!==null&&a!==void 0?a:"");return new Lo({quality:u,width:Math.ceil(e/l),height:Math.ceil(t/l),bitrate:(o=s.maxBitrate)!==null&&o!==void 0?o:0,ssrc:0})})}const pR="_lossy",mR="_reliable",n$=2*1e3,Cy="leave-reconnect",i$=3e4,s$=8*1024,r$=256*1024;var Gi;(function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"})(Gi||(Gi={}));class o$ extends Zs.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var n;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=eC.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Gi.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=it,this.reliableDataSequence=1,this.reliableMessageBuffer=new tR,this.reliableReceivedState=new TH(i$),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>X(this,[i],void 0,function(s){var r=this;let{channel:a}=s;return(function*(){if(a){if(a.label===mR)r.reliableDCSub=a;else if(a.label===pR)r.lossyDCSub=a;else return;r.log.debug("on data channel ".concat(a.id,", ").concat(a.label),r.logContext),a.onmessage=r.handleDataMessage}})()}),this.handleDataMessage=i=>X(this,void 0,void 0,function*(){var s,r,a,o,l;const u=yield this.dataProcessLock.lock();try{let h;if(i.data instanceof ArrayBuffer)h=i.data;else if(i.data instanceof Blob)h=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const f=Zn.fromBinary(new Uint8Array(h));if(f.sequence>0&&f.participantSid!==""){const m=this.reliableReceivedState.get(f.participantSid);if(m&&f.sequence<=m)return;this.reliableReceivedState.set(f.participantSid,f.sequence)}if(((s=f.value)===null||s===void 0?void 0:s.case)==="speaker")this.emit(Re.ActiveSpeakersUpdate,f.value.value.speakers);else if(((r=f.value)===null||r===void 0?void 0:r.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const m=yield(a=this.e2eeManager)===null||a===void 0?void 0:a.handleEncryptedData(f.value.value.encryptedValue,f.value.value.iv,f.participantIdentity,f.value.value.keyIndex),g=eI.fromBinary(m.payload),C=new Zn({value:g.value,participantIdentity:f.participantIdentity,participantSid:f.participantSid});((o=C.value)===null||o===void 0?void 0:o.case)==="user"&&gR(C,C.value.value),this.emit(Re.DataPacketReceived,C,f.value.value.encryptionType)}else((l=f.value)===null||l===void 0?void 0:l.case)==="user"&&gR(f,f.value.value),this.emit(Re.DataPacketReceived,f,un.NONE)}finally{u()}}),this.handleDataError=i=>{const r=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:a}=i.error;this.log.error("DataChannel error on ".concat(r,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(r),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const r=i.currentTarget.maxRetransmits===0?at.LOSSY:at.RELIABLE;this.updateAndEmitDCBufferStatus(r)},this.handleDisconnect=(i,s)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const r=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(Re.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let o=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(o===null){r(a);return}i===Cy&&(o=0),this.log.debug("reconnecting in ".concat(o,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Dn.setTimeout(()=>this.attemptReconnect(s).finally(()=>this.reconnectTimeout=void 0),o)},this.waitForRestarted=()=>new Promise((i,s)=>{this.pcState===Gi.Connected&&i();const r=()=>{this.off(Re.Disconnected,a),i()},a=()=>{this.off(Re.Restarted,r),s()};this.once(Re.Restarted,r),this.once(Re.Disconnected,a)}),this.updateAndEmitDCBufferStatus=i=>{if(i===at.RELIABLE){const r=this.dataChannelForKind(i);r&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount)}const s=this.isBufferStatusLow(i);typeof s<"u"&&s!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,s),this.emit(Re.DCBufferStatusChanged,s,i))},this.isBufferStatusLow=i=>{const s=this.dataChannelForKind(i);if(s)return s.bufferedAmount<=s.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>X(this,void 0,void 0,function*(){!this.url||!(yield fetch(Od(this.url),{method:"HEAD"}).then(s=>s.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Bt.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Bt.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(ya.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>X(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Od(this.url),{method:"HEAD"}),On(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Ks((n=t.loggerName)!==null&&n!==void 0?n:is.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new QS(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new ni,this.dataProcessLock=new ni,this.dcBufferStatus=new Map([[at.LOSSY,!0],[at.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(Re.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(Re.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(Re.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(Re.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(Re.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(Re.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(Re.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(Re.SignalRequestResponse,i)}get logContext(){var t,n,i,s,r,a;return{room:(n=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||n===void 0?void 0:n.name,roomID:(s=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||s===void 0?void 0:s.sid,participant:(a=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.participant)===null||a===void 0?void 0:a.identity,pID:this.participantSid}}join(t,n,i,s){return X(this,arguments,void 0,function(r,a,o,l){var u=this;let h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){u.url=r,u.token=a,u.signalOpts=o,u.maxJoinAttempts=o.maxRetries;try{u.joinAttempts+=1,u.setupSignalClientCallbacks();const f=yield u.client.join(r,a,o,l,h);return u._isClosed=!1,u.latestJoinResponse=f,u.subscriberPrimary=f.subscriberPrimary,u.pcManager||(yield u.configure(f,!h)),(!u.subscriberPrimary||f.fastPublish)&&u.negotiate().catch(m=>{it.error(m,u.logContext)}),u.registerOnLineListener(),u.clientConfiguration=f.clientConfiguration,u.emit(Re.SignalConnected,f),f}catch(f){if(f instanceof We){if(f.reason===Ft.ServerUnreachable){if(u.log.warn("Couldn't connect to server, attempt ".concat(u.joinAttempts," of ").concat(u.maxJoinAttempts),u.logContext),u.joinAttempts<u.maxJoinAttempts)return u.join(r,a,o,l,h)}else if(f.reason===Ft.ServiceNotFound)return u.log.warn("Initial connection failed: ".concat(f.message,"  Retrying")),u.join(r,a,o,l,!0)}throw f}})()})}close(){return X(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(Re.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return X(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new tR,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return X(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new Dr("a track with the same ID has already been published");return new Promise((n,i)=>{const s=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],i(We.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:r=>{clearTimeout(s),n(r)},reject:()=>{clearTimeout(s),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:n}=this.pendingTrackResolvers[t.track.id];n&&n(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(t,n){this.client.sendMuteTrack(t,n)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return X(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t,n){return X(this,void 0,void 0,function*(){var i,s;if(this.pcManager&&this.pcManager.currentState!==Qt.NEW)return;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid;const r=this.makeRTCConfiguration(t);this.pcManager=new OH(r,n?"publisher-only":t.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(Re.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(a,o)=>{this.client.sendIceCandidate(a,o)},this.pcManager.onPublisherOffer=(a,o)=>{this.client.sendOffer(a,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(a,o,l)=>X(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(a),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),a===Qt.CONNECTED){const f=this.pcState===Gi.New;this.pcState=Gi.Connected,f&&this.emit(Re.Connected,t)}else a===Qt.FAILED&&(this.pcState===Gi.Connected||this.pcState===Gi.Reconnecting)&&(this.pcState=Gi.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?ya.RR_SUBSCRIBER_FAILED:ya.RR_PUBLISHER_FAILED));const u=this.client.isDisconnected||this.client.currentState===Bt.RECONNECTING,h=[Qt.FAILED,Qt.CLOSING,Qt.CLOSED].includes(a);u&&h&&!this._isClosed&&this.emit(Re.Offline)}),this.pcManager.onTrack=a=>{a.streams.length!==0&&this.emit(Re.MediaTrackAdded,a.track,a.streams[0],a.receiver)},a$((s=t.serverInfo)===null||s===void 0?void 0:s.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(t,n,i)=>X(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(t,n))}),this.client.onTrickle=(t,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:n})),this.pcManager.addIceCandidate(t,n))},this.client.onOffer=(t,n,i)=>X(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const s=yield this.pcManager.createSubscriberAnswerFromOffer(t,n);s&&this.client.sendAnswer(s,n)}),this.client.onLocalTrackPublished=t=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(n=t.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:i}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],i(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(Re.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(Re.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{var n;this.token=t,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(t)},this.client.onRemoteMuteChanged=(t,n)=>{this.emit(Re.RemoteMute,t,n)},this.client.onSubscribedQualityUpdate=t=>{this.emit(Re.SubscribedQualityUpdate,t)},this.client.onRoomMoved=t=>{var n;this.participantSid=(n=t.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=t.room),this.emit(Re.RoomMoved,t)},this.client.onMediaSectionsRequirement=t=>{var n,i;const s={direction:"recvonly"};for(let r=0;r<t.numAudios;r++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",s);for(let r=0;r<t.numVideos;r++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",s);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",ya.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t?.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:mP,regionSettings:t.regions})),t.action){case dc.DISCONNECT:this.emit(Re.Disconnected,t?.reason),this.close();break;case dc.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Cy);break;case dc.RESUME:this.handleDisconnect(Cy)}}}makeRTCConfiguration(t){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),t.iceServers&&!i.iceServers){const s=[];t.iceServers.forEach(r=>{const a={urls:r.urls};r.username&&(a.username=r.username),r.credential&&(a.credential=r.credential),s.push(a)}),i.iceServers=s}return t.clientConfiguration&&t.clientConfiguration.forceRelay===Md.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(pR,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(mR,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const t=this.dataChannelForKind(at.LOSSY);if(t){const n=this.lossyDataStatByterate/10;t.bufferedAmountLowThreshold=Math.min(Math.max(n,s$),r$)}},1e3))}createSender(t,n,i){return X(this,void 0,void 0,function*(){if(l0())return yield this.createTransceiverRTCRtpSender(t,n,i);if(c0())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new ln("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,n,i,s){return X(this,void 0,void 0,function*(){if(l0())return this.createSimulcastTransceiverSender(t,n,i,s);if(c0())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new ln("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,n,i){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new ln("publisher is closed");const s=[];t.mediaStream&&s.push(t.mediaStream),Fo(t)&&(t.codec=n.videoCodec);const r={direction:"sendonly",streams:s};return i&&(r.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r)).sender})}createSimulcastTransceiverSender(t,n,i,s){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new ln("publisher is closed");const r={direction:"sendonly"};s&&(r.sendEncodings=s);const a=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,r);if(i.videoCodec)return t.setSimulcastTrackSender(i.videoCodec,a.sender),a.sender})}createRTCRtpSender(t){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new ln("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return X(this,void 0,void 0,function*(){var n,i,s;if(!this._isClosed){if(this.attemptingReconnect){it.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Md.DISABLED||((s=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&s!==void 0?s:Qt.NEW)===Qt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(r){this.reconnectAttempts+=1;let a=!0;r instanceof ln?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:r})),a=!1):r instanceof ql||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",ya.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Re.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(t){return X(this,void 0,void 0,function*(){var n,i,s;try{if(!this.url||!this.token)throw new ln("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Re.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let r;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ql;r=yield this.join(t??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(a){throw a instanceof We&&a.reason===Ft.NotAllowed?new ln("could not reconnect, token might be expired"):new ql}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Re.SignalRestarted,r),yield this.waitForPCReconnected(),this.client.currentState!==Bt.CONNECTED)throw new ql("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(Re.Restarted)}catch(r){const a=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(s=this.regionUrlProvider)===null||s===void 0||s.resetAttempts(),r}})}resumeConnection(t){return X(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new ln("could not reconnect, url or token not saved");if(!this.pcManager)throw new ln("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Re.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(s){let r="";throw s instanceof Error&&(r=s.message,this.log.error(s.message,Object.assign(Object.assign({},this.logContext),{error:s}))),s instanceof We&&s.reason===Ft.NotAllowed?new ln("could not reconnect, token might be expired"):s instanceof We&&s.reason===Ft.LeaveRequest?s:new ql(r)}if(this.emit(Re.SignalResumed),i){const s=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(s),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Bt.CONNECTED)throw new ql("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(Re.Resumed)})}waitForPCInitialConnection(t,n){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new ln("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,t)})}waitForPCReconnected(){return X(this,void 0,void 0,function*(){this.pcState=Gi.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield On(n$),!this.pcManager)throw new ln("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Gi.Connected}catch(t){throw this.pcState=Gi.Disconnected,We.internal("could not establish PC connection, ".concat(t.message))}})}publishRpcResponse(t,n,i,s){return X(this,void 0,void 0,function*(){const r=new Zn({destinationIdentities:[t],kind:at.RELIABLE,value:{case:"rpcResponse",value:new jS({requestId:n,value:s?{case:"error",value:s.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(r,at.RELIABLE)})}publishRpcAck(t,n){return X(this,void 0,void 0,function*(){const i=new Zn({destinationIdentities:[t],kind:at.RELIABLE,value:{case:"rpcAck",value:new NS({requestId:n})}});yield this.sendDataPacket(i,at.RELIABLE)})}sendDataPacket(t,n){return X(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const r=mH(t);if(r){const a=yield this.e2eeManager.encryptData(r.toBinary());t.value={case:"encryptedPacket",value:new Z2({encryptedValue:a.payload,iv:a.iv,keyIndex:a.keyIndex})}}}n===at.RELIABLE&&(t.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=t.toBinary(),s=this.dataChannelForKind(n);if(s){if(n===at.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:t.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;s.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(t){return X(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(at.RELIABLE);const n=this.dataChannelForKind(at.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(t),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(at.RELIABLE)})}waitForBufferStatusLow(t){return new zn((n,i)=>X(this,void 0,void 0,function*(){if(this.isBufferStatusLow(t))n();else{const s=()=>i(new ln("engine closed"));for(this.once(Re.Closing,s);!this.dcBufferStatus.get(t);)yield On(10);this.off(Re.Closing,s),n()}}))}ensureDataTransportConnected(t){return X(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var r;if(!i.pcManager)throw new ln("PC manager is closed");const a=s?i.pcManager.subscriber:i.pcManager.publisher,o=s?"Subscriber":"Publisher";if(!a)throw We.internal("".concat(o," connection not set"));let l=!1;!s&&!i.dataChannelForKind(n,s)&&(i.createDataChannels(),l=!0),!l&&!s&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&i.negotiate().catch(f=>{it.error(f,i.logContext)});const u=i.dataChannelForKind(n,s);if(u?.readyState==="open")return;const h=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<h;){if(a.isICEConnected&&((r=i.dataChannelForKind(n,s))===null||r===void 0?void 0:r.readyState)==="open")return;yield On(50)}throw We.internal("could not establish ".concat(o," connection, state: ").concat(a.getICEConnectionState()))})()})}ensurePublisherConnected(t){return X(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||![Qt.CONNECTING,Qt.CONNECTED].includes(this.pcManager.currentState)||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return X(this,void 0,void 0,function*(){return new zn((t,n)=>X(this,void 0,void 0,function*(){if(!this.pcManager){n(new Pa("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,s=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&n(new Pa("cannot negotiate on closed engine")),this.on(Re.Closing,s),this.on(Re.Restarting,s),this.pcManager.publisher.once(Oa.RTPVideoPayloadTypes,r=>{const a=new Map;r.forEach(o=>{const l=o.codec.toLowerCase();X7(l)&&a.set(o.payload,l)}),this.emit(Re.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(i),t()}catch(r){if(i.signal.aborted){t();return}r instanceof Pa&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ya.RR_UNKNOWN),r instanceof Error?n(r):n(new Error(String(r)))}finally{this.off(Re.Closing,s),this.off(Re.Restarting,s)}}))})}dataChannelForKind(t,n){if(n){if(t===at.LOSSY)return this.lossyDCSub;if(t===at.RELIABLE)return this.reliableDCSub}else{if(t===at.LOSSY)return this.lossyDC;if(t===at.RELIABLE)return this.reliableDC}}sendSyncState(t,n){var i,s,r,a;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const o=this.pcManager.publisher.getLocalDescription(),l=this.pcManager.publisher.getRemoteDescription(),u=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),h=(s=this.pcManager.subscriber)===null||s===void 0?void 0:s.getLocalDescription(),f=(a=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&a!==void 0?a:!0,m=new Array,g=new Array;t.forEach(C=>{C.isDesired!==f&&m.push(C.trackSid),C.isEnabled||g.push(C.trackSid)}),this.client.sendSyncState(new HS({answer:this.pcManager.mode==="publisher-only"?l?oc({sdp:l.sdp,type:l.type}):void 0:h?oc({sdp:h.sdp,type:h.type}):void 0,offer:this.pcManager.mode==="publisher-only"?o?oc({sdp:o.sdp,type:o.type}):void 0:u?oc({sdp:u.sdp,type:u.type}):void 0,subscription:new Jm({trackSids:m,subscribe:!f,participantTracks:[]}),publishTracks:O7(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:g,datachannelReceiveStates:this.reliableReceivedState.map((C,S)=>new CI({publisherSid:S,lastSeq:C}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],n=(i,s)=>{i?.id!==void 0&&i.id!==null&&t.push(new xI({label:i.label,id:i.id,target:s}))};return n(this.dataChannelForKind(at.LOSSY),gs.PUBLISHER),n(this.dataChannelForKind(at.RELIABLE),gs.PUBLISHER),n(this.dataChannelForKind(at.LOSSY,!0),gs.SUBSCRIBER),n(this.dataChannelForKind(at.RELIABLE,!0),gs.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&Dn.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){mi()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){mi()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(t){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(t);if(i){const s=Object.entries(this.midToTrackId).find(r=>{let[a]=r;return a===i});if(s)return s[1]}}}function a$(e){return e!==void 0&&e>13}function gR(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=e.destinationIdentities.length!==0?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}class _P{get info(){return this._info}validateBytesReceived(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(t&&this.bytesReceived<this.totalByteSize)throw new Ki("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Jn.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Ki("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Jn.LengthExceeded)}}constructor(t,n,i,s){this.reader=n,this.totalByteSize=i,this._info=t,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=s}}class l$ extends _P{handleChunkReceived(t){var n;this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const t=this.reader.getReader();let n=new ts,i=null,s=null;if(this.signal){const a=this.signal;s=()=>{var o;(o=n.reject)===null||o===void 0||o.call(n,a.reason)},a.addEventListener("abort",s),i=a}const r=()=>{t.releaseLock(),i&&s&&i.removeEventListener("abort",s),this.signal=void 0};return{next:()=>X(this,void 0,void 0,function*(){var a,o;try{const{done:l,value:u}=yield Promise.race([t.read(),n.promise,(o=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&o!==void 0?o:new Promise(()=>{})]);return l?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(u),{done:!1,value:u.content})}catch(l){throw r(),l}}),return(){return X(this,void 0,void 0,function*(){return r(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return X(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,s,r,a;let o=new Set;const l=n.signal?t.withAbortSignal(n.signal):t;try{for(var u=!0,h=Pr(l),f;f=yield h.next(),i=f.done,!i;u=!0){a=f.value,u=!1;const m=a;o.add(m)}}catch(m){s={error:m}}finally{try{!u&&!i&&(r=h.return)&&(yield r.call(h))}finally{if(s)throw s.error}}return Array.from(o)})()})}}class c$ extends _P{constructor(t,n,i,s){super(t,n,i,s),this.receivedChunks=new Map}handleChunkReceived(t){var n;const i=Rp(t.chunkIndex),s=this.receivedChunks.get(i);if(s&&s.version>t.version)return;this.receivedChunks.set(i,t),this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const t=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new ts,s=null,r=null;if(this.signal){const o=this.signal;r=()=>{var l;(l=i.reject)===null||l===void 0||l.call(i,o.reason)},o.addEventListener("abort",r),s=o}const a=()=>{t.releaseLock(),s&&r&&s.removeEventListener("abort",r),this.signal=void 0};return{next:()=>X(this,void 0,void 0,function*(){var o,l;try{const{done:u,value:h}=yield Promise.race([t.read(),i.promise,(l=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);if(u)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(h);let f;try{f=n.decode(h.content)}catch(m){throw new Ki("Cannot decode datastream chunk ".concat(h.chunkIndex," as text: ").concat(m),Jn.DecodeFailed)}return{done:!1,value:f}}}catch(u){throw a(),u}}),return(){return X(this,void 0,void 0,function*(){return a(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return X(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,s,r,a;let o="";const l=n.signal?t.withAbortSignal(n.signal):t;try{for(var u=!0,h=Pr(l),f;f=yield h.next(),i=f.done,!i;u=!0)a=f.value,u=!1,o+=a}catch(m){s={error:m}}finally{try{!u&&!i&&(r=h.return)&&(yield r.call(h))}finally{if(s)throw s.error}}return o})()})}}class u${constructor(){this.log=it,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(t,n){if(this.textStreamHandlers.has(t))throw new Ki('A text stream handler for topic "'.concat(t,'" has already been set.'),Jn.HandlerAlreadyRegistered);this.textStreamHandlers.set(t,n)}unregisterTextStreamHandler(t){this.textStreamHandlers.delete(t)}registerByteStreamHandler(t,n){if(this.byteStreamHandlers.has(t))throw new Ki('A byte stream handler for topic "'.concat(t,'" has already been set.'),Jn.HandlerAlreadyRegistered);this.byteStreamHandlers.set(t,n)}unregisterByteStreamHandler(t){this.byteStreamHandlers.delete(t)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(t){var n,i,s,r;const a=Array.from(this.textStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===t),o=Array.from(this.byteStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===t);if(a.length>0||o.length>0){const l=new Ki("Participant ".concat(t," unexpectedly disconnected in the middle of sending data"),Jn.AbnormalEnd);for(const[u,h]of o)(i=(n=h.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,l),this.byteStreamControllers.delete(u);for(const[u,h]of a)(r=(s=h.outOfBandFailureRejectingFuture).reject)===null||r===void 0||r.call(s,l),this.textStreamControllers.delete(u)}}handleDataStreamPacket(t,n){return X(this,void 0,void 0,function*(){switch(t.value.case){case"streamHeader":return this.handleStreamHeader(t.value.value,t.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(t.value.value,n);case"streamTrailer":return this.handleStreamTrailer(t.value.value,n);default:throw new Error('DataPacket of value "'.concat(t.value.case,'" is not data stream related!'))}})}handleStreamHeader(t,n,i){return X(this,void 0,void 0,function*(){var s;if(t.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(t.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",t.topic);return}let a;const o=new ts;o.promise.catch(h=>{this.log.error(h)});const l={id:t.streamId,name:(s=t.contentHeader.value.name)!==null&&s!==void 0?s:"unknown",mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:Rp(t.timestamp),attributes:t.attributes,encryptionType:i},u=new ReadableStream({start:h=>{if(a=h,this.textStreamControllers.has(t.streamId))throw new Ki("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Jn.AlreadyOpened);this.byteStreamControllers.set(t.streamId,{info:l,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:o})}});r(new l$(l,u,Rp(t.totalLength),o),{identity:n})}else if(t.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(t.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",t.topic);return}let a;const o=new ts;o.promise.catch(h=>{this.log.error(h)});const l={id:t.streamId,mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:Number(t.timestamp),attributes:t.attributes,encryptionType:i,attachedStreamIds:t.contentHeader.value.attachedStreamIds},u=new ReadableStream({start:h=>{if(a=h,this.textStreamControllers.has(t.streamId))throw new Ki("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Jn.AlreadyOpened);this.textStreamControllers.set(t.streamId,{info:l,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:o})}});r(new c$(l,u,Rp(t.totalLength),o),{identity:n})}})}handleStreamChunk(t,n){const i=this.byteStreamControllers.get(t.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Ki("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Jn.EncryptionTypeMismatch)),this.byteStreamControllers.delete(t.streamId)):t.content.length>0&&i.controller.enqueue(t));const s=this.textStreamControllers.get(t.streamId);s&&(s.info.encryptionType!==n?(s.controller.error(new Ki("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(n,", got ").concat(s.info.encryptionType),Jn.EncryptionTypeMismatch)),this.textStreamControllers.delete(t.streamId)):t.content.length>0&&s.controller.enqueue(t))}handleStreamTrailer(t,n){const i=this.textStreamControllers.get(t.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Ki("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Jn.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),t.attributes),i.controller.close(),this.textStreamControllers.delete(t.streamId)));const s=this.byteStreamControllers.get(t.streamId);s&&(s.info.encryptionType!==n?s.controller.error(new Ki("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(n,", got ").concat(s.info.encryptionType),Jn.EncryptionTypeMismatch)):(s.info.attributes=Object.assign(Object.assign({},s.info.attributes),t.attributes),s.controller.close()),this.byteStreamControllers.delete(t.streamId))}}class SP{constructor(t,n,i){this.writableStream=t,this.defaultWriter=t.getWriter(),this.onClose=i,this.info=n}write(t){return this.defaultWriter.write(t)}close(){return X(this,void 0,void 0,function*(){var t;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(t=this.onClose)===null||t===void 0||t.call(this)})}}class d$ extends SP{}class h$ extends SP{}const vR=15e3;class f${constructor(t,n){this.engine=t,this.log=n}setupEngine(t){this.engine=t}sendText(t,n){return X(this,void 0,void 0,function*(){var i;const s=crypto.randomUUID(),a=new TextEncoder().encode(t).byteLength,o=(i=n?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),l=new Array(o?o.length+1:1).fill(0),u=(f,m)=>{var g;l[m]=f;const C=l.reduce((S,v)=>S+v,0);(g=n?.onProgress)===null||g===void 0||g.call(n,C)},h=yield this.streamText({streamId:s,totalSize:a,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:o,attributes:n?.attributes});return yield h.write(t),u(1,0),yield h.close(),n?.attachments&&o&&(yield Promise.all(n.attachments.map((f,m)=>X(this,void 0,void 0,function*(){return this._sendFile(o[m],f,{topic:n.topic,mimeType:f.type,onProgress:g=>{u(g,m+1)}})})))),h.info})}streamText(t){return X(this,void 0,void 0,function*(){var n,i,s;const r=(n=t?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),a={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=t?.topic)!==null&&i!==void 0?i:"",size:t?.totalSize,attributes:t?.attributes,encryptionType:!((s=this.engine.e2eeManager)===null||s===void 0)&&s.isDataChannelEncryptionEnabled?un.GCM:un.NONE,attachedStreamIds:t?.attachedStreamIds},o=new tm({streamId:r,mimeType:a.mimeType,topic:a.topic,timestamp:_a(a.timestamp),totalLength:_a(t?.totalSize),attributes:a.attributes,contentHeader:{case:"textHeader",value:new dI({version:t?.version,attachedStreamIds:a.attachedStreamIds,replyToStreamId:t?.replyToStreamId,operationType:t?.type==="update"?G_.UPDATE:G_.CREATE})}}),l=t?.destinationIdentities,u=new Zn({destinationIdentities:l,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(u,at.RELIABLE);let h=0;const f=this.engine,m=new WritableStream({write(S){return X(this,void 0,void 0,function*(){for(const v of sH(S,vR)){const _=new nm({content:v,streamId:r,chunkIndex:_a(h)}),w=new Zn({destinationIdentities:l,value:{case:"streamChunk",value:_}});yield f.sendDataPacket(w,at.RELIABLE),h+=1}})},close(){return X(this,void 0,void 0,function*(){const S=new im({streamId:r}),v=new Zn({destinationIdentities:l,value:{case:"streamTrailer",value:S}});yield f.sendDataPacket(v,at.RELIABLE)})},abort(S){console.log("Sink error:",S)}});let g=()=>X(this,void 0,void 0,function*(){yield C.close()});f.once(Re.Closing,g);const C=new d$(m,a,()=>this.engine.off(Re.Closing,g));return C})}sendFile(t,n){return X(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,t,n),{id:i}})}_sendFile(t,n,i){return X(this,void 0,void 0,function*(){var s;const r=yield this.streamBytes({streamId:t,totalSize:n.size,name:n.name,mimeType:(s=i?.mimeType)!==null&&s!==void 0?s:n.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),a=n.stream().getReader();for(;;){const{done:o,value:l}=yield a.read();if(o)break;yield r.write(l)}return yield r.close(),r.info})}streamBytes(t){return X(this,void 0,void 0,function*(){var n,i,s,r,a,o;const l=(n=t?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),u=t?.destinationIdentities,h={id:l,mimeType:(i=t?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(s=t?.topic)!==null&&s!==void 0?s:"",timestamp:Date.now(),attributes:t?.attributes,size:t?.totalSize,name:(r=t?.name)!==null&&r!==void 0?r:"unknown",encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?un.GCM:un.NONE},f=new tm({totalLength:_a((o=h.size)!==null&&o!==void 0?o:0),mimeType:h.mimeType,streamId:l,topic:h.topic,timestamp:_a(Date.now()),attributes:h.attributes,contentHeader:{case:"byteHeader",value:new hI({name:h.name})}}),m=new Zn({destinationIdentities:u,value:{case:"streamHeader",value:f}});yield this.engine.sendDataPacket(m,at.RELIABLE);let g=0;const C=new ni,S=this.engine,v=this.log,_=new WritableStream({write(x){return X(this,void 0,void 0,function*(){const k=yield C.lock();let A=0;try{for(;A<x.byteLength;){const T=x.slice(A,A+vR),M=new Zn({destinationIdentities:u,value:{case:"streamChunk",value:new nm({content:T,streamId:l,chunkIndex:_a(g)})}});yield S.sendDataPacket(M,at.RELIABLE),g+=1,A+=T.byteLength}}finally{k()}})},close(){return X(this,void 0,void 0,function*(){const x=new im({streamId:l}),k=new Zn({destinationIdentities:u,value:{case:"streamTrailer",value:x}});yield S.sendDataPacket(k,at.RELIABLE)})},abort(x){v.error("Sink error:",x)}});return new h$(_,h)})}}class CP extends ve{constructor(t,n,i,s,r){super(t,i,r),this.sid=n,this.receiver=s}get isLocal(){return!1}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?ke.Muted:ke.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const n=i=>{i.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ke.Ended,this))};t.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return X(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),nC)),N7()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>t());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:s,rtpTimestamp:r}=i;r&&this.rtpTimestamp!==r&&(this.emit(ke.TimeSyncUpdate,{timestamp:s,rtpTimestamp:r}),this.rtpTimestamp=r)}};t()}}class p$ extends CP{constructor(t,n,i,s,r,a){super(t,n,ve.Kind.Audio,i,a),this.monitorReceiver=()=>X(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=eg(o,this.prevStats)),this.prevStats=o}),this.audioContext=s,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(t){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(t,0,.1):i.volume=t;Ys()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(Ys())return 1;let t=0;return this.attachedElements.forEach(n=>{n.volume>t&&(t=n.volume)}),t}setSinkId(t){return X(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(n=>{if(u0(n))return n.setSinkId(t)}))})}attach(t){const n=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&u0(t)&&t.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let n;return t?(n=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,n){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(s=>{i.connect(s),i=s}),this.gainNode=t.createGain(),i.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(ke.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(s=>{this.emit(ke.AudioPlaybackFailed,s)})}disconnectWebAudio(){var t,n;(t=this.gainNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return X(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let n;return t.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const xy=100;class m$ extends CP{constructor(t,n,i,s,r){super(t,n,ve.Kind.Video,i,r),this.elementInfos=[],this.monitorReceiver=()=>X(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=eg(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=XS(()=>{this.updateDimensions()},xy),this.adaptiveStreamSettings=s}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(t){super.setStreamState(t),this.log.debug("setStreamState",t),this.isAdaptiveStream&&t===ve.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(n=>{t?fc(this._mediaStreamTrack,n):rc(this._mediaStreamTrack,n)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===t)===void 0){const n=new g$(t);this.observeElementInfo(n)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===t);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let n=[];if(t)return this.stopObservingElement(t),super.detach(t);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return X(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let n,i="",s=new Map;return t.forEach(r=>{r.type==="inbound-rtp"?(i=r.codecId,n={type:"video",streamId:r.id,framesDecoded:r.framesDecoded,framesDropped:r.framesDropped,framesReceived:r.framesReceived,packetsReceived:r.packetsReceived,packetsLost:r.packetsLost,frameWidth:r.frameWidth,frameHeight:r.frameHeight,pliCount:r.pliCount,firCount:r.firCount,nackCount:r.nackCount,jitter:r.jitter,timestamp:r.timestamp,bytesReceived:r.bytesReceived,decoderImplementation:r.decoderImplementation}):r.type==="codec"&&s.set(r.id,r)}),n&&i!==""&&s.get(i)&&(n.mimeType=s.get(i).mimeType),n})}stopObservingElement(t){const n=this.elementInfos.filter(i=>i.element===t);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(t){var n,i;const s=this.elementInfos.reduce((l,u)=>Math.max(l,u.visibilityChangedAt||0),0),r=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,a=this.elementInfos.some(l=>l.pictureInPicture),o=this.elementInfos.some(l=>l.visible)&&!r||a;if(!(this.lastVisible===o&&!t)){if(!o&&Date.now()-s<xy){Dn.setTimeout(()=>{this.updateVisibility()},xy);return}this.lastVisible=o,this.emit(ke.VisibilityChanged,o,this)}}updateDimensions(){var t,n;let i=0,s=0;const r=this.getPixelDensity();for(const a of this.elementInfos){const o=a.width()*r,l=a.height()*r;o+l>i+s&&(i=o,s=l)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===s||(this.lastDimensions={width:i,height:s},this.emit(ke.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const n=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return n==="screen"?VE():n||(VE()>2?2:1)}}class g${get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,n){this.onVisibilityChanged=i=>{var s;const{target:r,isIntersecting:a}=i;r===this.element&&(this.isIntersecting=a,this.isPiP=Hu(this.element),this.visibilityChangedAt=Date.now(),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this))},this.onEnterPiP=()=>{var i,s,r;(s=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||s===void 0||s.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Hu(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Hu(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=t,this.isIntersecting=n??g0(t),this.isPiP=mi()&&Hu(t),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var t,n,i;this.isIntersecting=g0(this.element),this.isPiP=Hu(this.element),this.element.handleResize=()=>{var s;(s=this.handleResize)===null||s===void 0||s.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,GE().observe(this.element),WE().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(t=window.documentPictureInPicture)===null||t===void 0||t.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var t,n,i,s,r;(t=GE())===null||t===void 0||t.unobserve(this.element),(n=WE())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(r=(s=window.documentPictureInPicture)===null||s===void 0?void 0:s.window)===null||r===void 0||r.removeEventListener("pagehide",this.onLeavePiP)}}function Hu(e){var t,n;return document.pictureInPictureElement===e?!0:!((t=window.documentPictureInPicture)===null||t===void 0)&&t.window?g0(e,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function g0(e,t){const n=t||window;let i=e.offsetTop,s=e.offsetLeft;const r=e.offsetWidth,a=e.offsetHeight,{hidden:o}=e,{display:l}=getComputedStyle(e);for(;e.offsetParent;)e=e.offsetParent,i+=e.offsetTop,s+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&s<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&s+r>n.pageXOffset&&!o&&l!=="none"}class Rr extends Zs.EventEmitter{constructor(t,n,i,s){var r;super(),this.metadataMuted=!1,this.encryption=un.NONE,this.log=it,this.handleMuted=()=>{this.emit(ke.Muted)},this.handleUnmuted=()=>{this.emit(ke.Unmuted)},this.log=Ks((r=s?.loggerName)!==null&&r!==void 0?r:is.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=n,this.trackName=i,this.source=ve.Source.Unknown}setTrack(t){this.track&&(this.track.off(ke.Muted,this.handleMuted),this.track.off(ke.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(ke.Muted,this.handleMuted),t.on(ke.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),ut(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==un.NONE}get audioTrack(){if(qs(this.track))return this.track}get videoTrack(){if(Fo(this.track))return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=ve.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===ve.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(e){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(e.SubscriptionStatus||(e.SubscriptionStatus={})),(function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"})(e.PermissionStatus||(e.PermissionStatus={}))})(Rr||(Rr={}));class v0 extends Rr{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,n,i,s){super(t,n.sid,n.name,s),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ke.Ended)},this.handleCpuConstrained=()=>{this.track&&Fo(this.track)&&this.emit(ke.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(t){this.track&&(this.track.off(ke.Ended,this.handleTrackEnded),this.track.off(ke.CpuConstrained,this.handleCpuConstrained)),super.setTrack(t),t&&(t.on(ke.Ended,this.handleTrackEnded),t.on(ke.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return X(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return X(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return X(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return X(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(qs(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(wn.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(wn.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(wn.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(wn.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||i.add(wn.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(wn.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function tg(e,t){return X(this,void 0,void 0,function*(){e??(e={});let n=!1;const{audioProcessor:i,videoProcessor:s,optionsWithoutProcessor:r}=lP(e);let a=r.audio,o=r.video;if(i&&typeof r.audio=="object"&&(r.audio.processor=i),s&&typeof r.video=="object"&&(r.video.processor=s),e.audio&&typeof r.audio=="object"&&typeof r.audio.deviceId=="string"){const f=r.audio.deviceId;r.audio.deviceId={exact:f},n=!0,a=Object.assign(Object.assign({},r.audio),{deviceId:{ideal:f}})}if(r.video&&typeof r.video=="object"&&typeof r.video.deviceId=="string"){const f=r.video.deviceId;r.video.deviceId={exact:f},n=!0,o=Object.assign(Object.assign({},r.video),{deviceId:{ideal:f}})}r.audio===!0?r.audio={deviceId:"default"}:typeof r.audio=="object"&&r.audio!==null&&(r.audio=Object.assign(Object.assign({},r.audio),{deviceId:r.audio.deviceId||"default"})),r.video===!0?r.video={deviceId:"default"}:typeof r.video=="object"&&!r.video.deviceId&&(r.video.deviceId="default");const l=rP(r,fP,pP),u=KS(l),h=navigator.mediaDevices.getUserMedia(u);r.audio&&(kn.userMediaPromiseMap.set("audioinput",h),h.catch(()=>kn.userMediaPromiseMap.delete("audioinput"))),r.video&&(kn.userMediaPromiseMap.set("videoinput",h),h.catch(()=>kn.userMediaPromiseMap.delete("videoinput")));try{const f=yield h;return yield Promise.all(f.getTracks().map(m=>X(this,void 0,void 0,function*(){const g=m.kind==="audio";let C=g?l.audio:l.video;(typeof C=="boolean"||!C)&&(C={});let S;const v=g?u.audio:u.video;typeof v!="boolean"&&(S=v);const _=m.getSettings().deviceId;S?.deviceId&&Da(S.deviceId)!==_?S.deviceId=_:S||(S={deviceId:_});const w=qH(m,S,t);return w.kind===ve.Kind.Video?w.source=ve.Source.Camera:w.kind===ve.Kind.Audio&&(w.source=ve.Source.Microphone),w.mediaStream=f,qs(w)&&i?yield w.setProcessor(i):Fo(w)&&s&&(yield w.setProcessor(s)),w})))}catch(f){if(!n)throw f;return tg(Object.assign(Object.assign({},e),{audio:a,video:o}),t)}})}function v$(e){return X(this,void 0,void 0,function*(){return(yield tg({audio:!1,video:!0}))[0]})}function xP(e){return X(this,void 0,void 0,function*(){return(yield tg({audio:e??!0,video:!1}))[0]})}var xo;(function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"})(xo||(xo={}));function b$(e){switch(e){case Xu.EXCELLENT:return xo.Excellent;case Xu.GOOD:return xo.Good;case Xu.POOR:return xo.Poor;case Xu.LOST:return xo.Lost;default:return xo.Unknown}}class wP extends Zs.EventEmitter{get logContext(){var t,n;return Object.assign({},(n=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||n===void 0?void 0:n.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===Ld.AGENT}get isActive(){var t;return((t=this.participantInfo)===null||t===void 0?void 0:t.state)===uc.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,n,i,s,r,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Ld.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=xo.Unknown,this.log=it,this.log=Ks((l=a?.loggerName)!==null&&l!==void 0?l:is.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=t,this.identity=n,this.name=i,this.metadata=s,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes=r??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,n]of this.trackPublications)if(n.source===t)return n}getTrackPublicationByName(t){for(const[,n]of this.trackPublications)if(n.trackName===t)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new ts,this.once(Ae.Active,()=>{var t,n;(n=(t=this.activeFuture)===null||t===void 0?void 0:t.resolve)===null||n===void 0||n.call(t),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const n=this.getTrackPublication(ve.Source.Camera);return!(!((t=n?.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const n=this.getTrackPublication(ve.Source.Microphone);return!(!((t=n?.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(ve.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){var n;return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.state===uc.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==uc.ACTIVE&&this.emit(Ae.Active),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,!0)}_setMetadata(t){const n=this.metadata!==t,i=this.metadata;this.metadata=t,n&&this.emit(Ae.ParticipantMetadataChanged,i)}_setName(t){const n=this.name!==t;this.name=t,n&&this.emit(Ae.ParticipantNameChanged,t)}_setAttributes(t){const n=j7(this.attributes,t);this._attributes=t,Object.keys(n).length>0&&this.emit(Ae.AttributesChanged,n)}setPermissions(t){var n,i,s,r,a,o;const l=this.permissions,u=t.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||t.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||t.canPublishData!==((s=this.permissions)===null||s===void 0?void 0:s.canPublishData)||t.hidden!==((r=this.permissions)===null||r===void 0?void 0:r.hidden)||t.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((h,f)=>{var m;return h!==((m=this.permissions)===null||m===void 0?void 0:m.canPublishSources[f])})||t.canSubscribeMetrics!==((o=this.permissions)===null||o===void 0?void 0:o.canSubscribeMetrics);return this.permissions=t,u&&this.emit(Ae.ParticipantPermissionsChanged,l),u}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(Ae.IsSpeakingChanged,t))}setConnectionQuality(t){const n=this._connectionQuality;this._connectionQuality=b$(t),n!==this._connectionQuality&&this.emit(Ae.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var t,n;this.activeFuture&&((n=(t=this.activeFuture).reject)===null||n===void 0||n.call(t,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(n=>qs(n.track)&&n.track.setAudioContext(t))}addTrackPublication(t){t.on(ke.Muted,()=>{this.emit(Ae.TrackMuted,t)}),t.on(ke.Unmuted,()=>{this.emit(Ae.TrackUnmuted,t)});const n=t;switch(n.track&&(n.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case ve.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case ve.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function y$(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new _I({participantIdentity:(t=e.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(n=e.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=e.allowAll)!==null&&i!==void 0?i:!1,trackSids:e.allowedTrackSids||[]})}class _$ extends wP{constructor(t,n,i,s,r,a){super(t,n,void 0,void 0,void 0,{loggerName:s.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=un.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new ts)},this.handleReconnected=()=>{var o,l;(l=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||l===void 0||l.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var o,l,u,h,f,m;this.reconnectFuture&&(this.reconnectFuture.promise.catch(g=>this.log.warn(g.message,this.logContext)),(l=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||l===void 0||l.call(o,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((h=(u=this.signalConnectedFuture).reject)===null||h===void 0||h.call(u,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(m=(f=this.activeAgentFuture)===null||f===void 0?void 0:f.reject)===null||m===void 0||m.call(f,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=o=>{var l,u;o.participant&&this.updateInfo(o.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new ts),(u=(l=this.signalConnectedFuture).resolve)===null||u===void 0||u.call(l)},this.handleSignalRequestResponse=o=>{const{requestId:l,reason:u,message:h}=o,f=this.pendingSignalRequests.get(l);f&&(u!==$S.OK&&f.reject(new UE(h,u)),this.pendingSignalRequests.delete(l))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let l=o.value.value,u=null,h=null;l.value.case==="payload"?u=l.value.value:l.value.case==="error"&&(h=nn.fromProto(l.value.value)),this.handleIncomingRpcResponse(l.requestId,u,h);break;case"rpcAck":let f=o.value.value;this.handleIncomingRpcAck(f.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>y$(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,l)=>{if(l===void 0&&(l=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),ut(o)));return}this.engine.updateMuteStatus(o.sid,l)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),ut(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),ut(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const l=this.audioTrackPublications.get(o.sid);if(!l){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(l.trackSid,l.getTrackFeatures())},this.onTrackCpuConstrained=(o,l)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),ut(l))),this.emit(Ae.LocalTrackCpuConstrained,o,l)},this.handleSubscribedQualityUpdate=o=>X(this,void 0,void 0,function*(){var l,u,h,f,m;if(!(!((m=this.roomOptions)===null||m===void 0)&&m.dynacast))return;const g=this.videoTrackPublications.get(o.trackSid);if(!g){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(!g.videoTrack)return;const C=yield g.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var S=!0,v=Pr(C),_;_=yield v.next(),l=_.done,!l;S=!0){f=_.value,S=!1;const w=f;I7(w)&&(this.log.debug("publish ".concat(w," for ").concat(g.videoTrack.sid),Object.assign(Object.assign({},this.logContext),ut(g))),yield this.publishAdditionalCodecForTrack(g.videoTrack,w,g.options))}}catch(w){u={error:w}}finally{try{!S&&!l&&(h=v.return)&&(yield h.call(v))}finally{if(u)throw u.error}}}),this.handleLocalTrackUnpublished=o=>{const l=this.trackPublications.get(o.trackSid);if(!l){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(l.track)},this.handleTrackEnded=o=>X(this,void 0,void 0,function*(){if(o.source===ve.Source.ScreenShare||o.source===ve.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),ut(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(kr(o)||po(o))try{if(mi())try{const l=yield navigator?.permissions.query({name:o.source===ve.Source.Camera?"camera":"microphone"});if(l&&l.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),ut(o))),l.onchange=()=>{l.state!=="denied"&&(o.isMuted||o.restartTrack(),l.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),ut(o))),kr(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),ut(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=s,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=r,this.roomOutgoingDataStreamManager=a}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==un.NONE}getTrackPublication(t){const n=super.getTrackPublication(t);if(n)return n}getTrackPublicationByName(t){const n=super.getTrackPublicationByName(t);if(n)return n}setupEngine(t){var n;this.engine=t,this.engine.on(Re.RemoteMute,(i,s)=>{const r=this.trackPublications.get(i);!r||!r.track||(s?r.mute():r.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(Re.Connected,this.handleReconnected).on(Re.SignalConnected,this.handleSignalConnected).on(Re.SignalRestarted,this.handleReconnected).on(Re.SignalResumed,this.handleReconnected).on(Re.Restarting,this.handleReconnecting).on(Re.Resuming,this.handleReconnecting).on(Re.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Re.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Re.Closing,this.handleClosing).on(Re.SignalRequestResponse,this.handleSignalRequestResponse).on(Re.DataPacketReceived,this.handleDataPacket)}setMetadata(t){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return X(this,arguments,void 0,function(n){var i=this;let{metadata:s,name:r,attributes:a}=n;return(function*(){return new zn((o,l)=>X(i,void 0,void 0,function*(){var u,h;try{let f=!1;const m=yield this.engine.client.sendUpdateLocalMetadata((u=s??this.metadata)!==null&&u!==void 0?u:"",(h=r??this.name)!==null&&h!==void 0?h:"",a),g=performance.now();for(this.pendingSignalRequests.set(m,{resolve:o,reject:C=>{l(C),f=!0},values:{name:r,metadata:s,attributes:a}});performance.now()-g<5e3&&!f;){if((!r||this.name===r)&&(!s||this.metadata===s)&&(!a||Object.entries(a).every(C=>{let[S,v]=C;return this.attributes[S]===v||v===""&&!this.attributes[S]}))){this.pendingSignalRequests.delete(m),o();return}yield On(50)}l(new UE("Request to update local metadata timed out","TimeoutError"))}catch(f){f instanceof Error?l(f):l(new Error(String(f)))}}))})()})}setCameraEnabled(t,n,i){return this.setTrackEnabled(ve.Source.Camera,t,n,i)}setMicrophoneEnabled(t,n,i){return this.setTrackEnabled(ve.Source.Microphone,t,n,i)}setScreenShareEnabled(t,n,i){return this.setTrackEnabled(ve.Source.ScreenShare,t,n,i)}setE2EEEnabled(t){return X(this,void 0,void 0,function*(){this.encryptionType=t?un.GCM:un.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,n,i,s){return X(this,void 0,void 0,function*(){var r,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:n})),this.republishPromise&&(yield this.republishPromise);let o=this.getTrackPublication(t);if(n)if(o)yield o.unmute();else{let l;if(this.pendingPublishing.has(t)){const u=yield this.waitForPendingPublicationOfSource(t);return u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),yield u?.unmute(),u}this.pendingPublishing.add(t);try{switch(t){case ve.Source.Camera:l=yield this.createTracks({video:(r=i)!==null&&r!==void 0?r:!0});break;case ve.Source.Microphone:l=yield this.createTracks({audio:(a=i)!==null&&a!==void 0?a:!0});break;case ve.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Dr(t)}}catch(u){throw l?.forEach(h=>{h.stop()}),u instanceof Error&&this.emit(Ae.MediaDevicesError,u,a0(t)),this.pendingPublishing.delete(t),u}for(const u of l){const h=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);t===ve.Source.Microphone&&qs(u)&&h.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),u.startPreConnectBuffer())}try{const u=[];for(const f of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),ut(f))),u.push(this.publishTrack(f,s));[o]=yield Promise.all(u)}catch(u){throw l?.forEach(h=>{h.stop()}),u}finally{this.pendingPublishing.delete(t)}}else if(!o?.track&&this.pendingPublishing.has(t)&&(o=yield this.waitForPendingPublicationOfSource(t),o||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}))),o&&o.track)if(t===ve.Source.ScreenShare){o=yield this.unpublishTrack(o.track);const l=this.getTrackPublication(ve.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield o.mute();return o})}enableCameraAndMicrophone(){return X(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(ve.Source.Camera)||this.pendingPublishing.has(ve.Source.Microphone))){this.pendingPublishing.add(ve.Source.Camera),this.pendingPublishing.add(ve.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(ve.Source.Camera),this.pendingPublishing.delete(ve.Source.Microphone)}}})}createTracks(t){return X(this,void 0,void 0,function*(){var n,i;t??(t={});const s=rP(t,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield tg(s,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(o=>(qs(o)&&(this.microphoneError=void 0,o.setAudioContext(this.audioContext),o.source=ve.Source.Microphone,this.emit(Ae.AudioStreamAcquired)),Fo(o)&&(this.cameraError=void 0,o.source=ve.Source.Camera),o))}catch(r){throw r instanceof Error&&(t.audio&&(this.microphoneError=r),t.video&&(this.cameraError=r)),r}})}createScreenTracks(t){return X(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new WS("getDisplayMedia not supported");t.resolution===void 0&&!W7()&&(t.resolution=GS.h1080fps30.resolution);const n=D7(t),i=yield navigator.mediaDevices.getDisplayMedia(n),s=i.getVideoTracks();if(s.length===0)throw new Dr("no video track found");const r=new om(s[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=ve.Source.ScreenShare,t.contentHint&&(r.mediaStreamTrack.contentHint=t.contentHint);const a=[r];if(i.getAudioTracks().length>0){this.emit(Ae.AudioStreamAcquired);const o=new rm(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=ve.Source.ScreenShareAudio,a.push(o)}return a})}publishTrack(t,n){return X(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(t,n)})}publishOrRepublishTrack(t,n){return X(this,arguments,void 0,function(i,s){var r=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var o,l,u,h;kr(i)&&i.setAudioContext(r.audioContext),yield(o=r.reconnectFuture)===null||o===void 0?void 0:o.promise,r.republishPromise&&!a&&(yield r.republishPromise),pc(i)&&r.pendingPublishPromises.has(i)&&(yield r.pendingPublishPromises.get(i));let f;if(i instanceof MediaStreamTrack)f=i.getConstraints();else{f=i.constraints;let _;switch(i.source){case ve.Source.Microphone:_="audioinput";break;case ve.Source.Camera:_="videoinput"}_&&r.activeDeviceMap.has(_)&&(f=Object.assign(Object.assign({},f),{deviceId:r.activeDeviceMap.get(_)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new rm(i,f,!0,r.audioContext,{loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});break;case"video":i=new om(i,f,!0,{loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});break;default:throw new Dr("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});let m;if(r.trackPublications.forEach(_=>{_.track&&_.track===i&&(m=_)}),m)return r.log.warn("track has already been published, skipping",Object.assign(Object.assign({},r.logContext),ut(m))),m;const g=Object.assign(Object.assign({},r.roomOptions.publishDefaults),s),C="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,S=(l=g.forceStereo)!==null&&l!==void 0?l:C;S&&(g.dtx===void 0&&r.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},r.logContext),ut(i))),g.red===void 0&&r.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(u=g.dtx)!==null&&u!==void 0||(g.dtx=!1),(h=g.red)!==null&&h!==void 0||(g.red=!1)),!K7()&&r.roomOptions.e2ee&&(r.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},r.logContext)),g.simulcast=!1),g.source&&(i.source=g.source);const v=new Promise((_,w)=>X(r,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Bt.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:ut(i)}));let x=!1;const k=setTimeout(()=>{x=!0,i.stop(),w(new FE("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(k),x)return;const A=yield this.publish(i,g,S);_(A)}else try{const x=yield this.publish(i,g,S);_(x)}catch(x){w(x)}}catch(x){w(x)}}));r.pendingPublishPromises.set(i,v);try{return yield v}catch(_){throw _}finally{r.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new ts),this.signalConnectedFuture.promise}hasPermissionsToPublish(t){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),ut(t))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(s=>B7(s)).includes(t.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),ut(t))),!1)}publish(t,n,i){return X(this,void 0,void 0,function*(){var s,r,a,o,l,u,h,f,m,g;if(!this.hasPermissionsToPublish(t))throw new FE("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(L=>pc(t)&&L.source===t.source)&&t.source!==ve.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),ut(t))),n.stopMicTrackOnMute&&qs(t)&&(t.stopOnMute=!0),t.source===ve.Source.ScreenShare&&Ha()&&(n.simulcast=!1),n.videoCodec==="av1"&&!$7()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!q7()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=f0),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(L=>n.videoCodec===ad(L.mime))||(n.videoCodec=ad(this.enabledPublishVideoCodecs[0].mime)));const S=n.videoCodec;t.on(ke.Muted,this.onTrackMuted),t.on(ke.Unmuted,this.onTrackUnmuted),t.on(ke.Ended,this.handleTrackEnded),t.on(ke.UpstreamPaused,this.onTrackUpstreamPaused),t.on(ke.UpstreamResumed,this.onTrackUpstreamResumed),t.on(ke.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const v=[],_=!(!((s=n.dtx)!==null&&s!==void 0)||s),w=t.getSourceTrackSettings();w.autoGainControl&&v.push(wn.TF_AUTO_GAIN_CONTROL),w.echoCancellation&&v.push(wn.TF_ECHO_CANCELLATION),w.noiseSuppression&&v.push(wn.TF_NOISE_SUPPRESSION),w.channelCount&&w.channelCount>1&&v.push(wn.TF_STEREO),_&&v.push(wn.TF_NO_DTX),kr(t)&&t.hasPreConnectBuffer&&v.push(wn.TF_PRECONNECT_BUFFER);const x=new Id({cid:t.mediaStreamTrack.id,name:n.name,type:ve.kindToProto(t.kind),muted:t.isMuted,source:ve.sourceToProto(t.source),disableDtx:_,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((r=n.red)!==null&&r!==void 0)||r),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:v});let k;if(t.kind===ve.Kind.Video){let L={width:0,height:0};try{L=yield t.waitForDimensions()}catch{const O=(o=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&o!==void 0?o:Pd.h720.resolution;L={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),ut(t)),{dims:L}))}x.width=L.width,x.height=L.height,po(t)&&(vs(S)&&(t.source===ve.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),ut(t))))),n.scalabilityMode=(l=n.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),x.simulcastCodecs=[new Y_({codec:S,cid:t.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:f0}),n.backupCodec&&S!==n.backupCodec.codec&&x.encryption===un.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),x.simulcastCodecs.push(new Y_({codec:n.backupCodec.codec,cid:""})))),k=m0(t.source===ve.Source.ScreenShare,x.width,x.height,n),x.layers=fR(x.width,x.height,k,vs(n.videoCodec))}else t.kind===ve.Kind.Audio&&(k=[{maxBitrate:(u=n.audioPreset)===null||u===void 0?void 0:u.maxBitrate,priority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high",networkPriority:(g=(m=n.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&g!==void 0?g:"high"}]);if(!this.engine||this.engine.isClosed)throw new ln("cannot publish track when not connected");const A=()=>X(this,void 0,void 0,function*(){var L,D,O;if(!this.engine.pcManager)throw new ln("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,n,k),this.emit(Ae.LocalSenderCreated,t.sender,t),po(t)&&((L=n.degradationPreference)!==null&&L!==void 0||(n.degradationPreference=e$(t)),t.setDegradationPreference(n.degradationPreference)),k)if(Ha()&&t.kind===ve.Kind.Audio){let j;for(const U of this.engine.pcManager.publisher.getTransceivers())if(U.sender===t.sender){j=U;break}j&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:j,codec:"opus",maxbr:!((D=k[0])===null||D===void 0)&&D.maxBitrate?k[0].maxBitrate/1e3:0})}else t.codec&&vs(t.codec)&&(!((O=k[0])===null||O===void 0)&&O.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:x.cid,codec:t.codec,maxbr:k[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;const M=new Promise((L,D)=>X(this,void 0,void 0,function*(){var O;try{T=yield this.engine.addTrack(x),L(T)}catch(j){t.sender&&(!((O=this.engine.pcManager)===null||O===void 0)&&O.publisher)&&(this.engine.pcManager.publisher.removeTrack(t.sender),yield this.engine.negotiate().catch(U=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),ut(t)),{error:U}))})),D(j)}}));if(this.enabledPublishVideoCodecs.length>0)T=(yield Promise.all([M,A()]))[0];else{T=yield M;let L;if(T.codecs.forEach(D=>{L===void 0&&(L=D.mimeType)}),L&&t.kind===ve.Kind.Video){const D=ad(L);D!==S&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),ut(t)),{codec:D})),n.videoCodec=D,k=m0(t.source===ve.Source.ScreenShare,x.width,x.height,n))}yield A()}const E=new v0(t.kind,T,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(E.on(ke.CpuConstrained,L=>this.onTrackCpuConstrained(L,E)),E.options=n,t.sid=T.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:k,trackInfo:T})),po(t)?t.startMonitor(this.engine.client):kr(t)&&t.startMonitor(),this.addTrackPublication(E),this.emit(Ae.LocalTrackPublished,E),kr(t)&&T.audioFeatures.includes(wn.TF_PRECONNECT_BUFFER)){const L=t.getPreConnectBuffer(),D=t.getPreConnectBufferMimeType();this.on(Ae.LocalTrackSubscribed,O=>{if(O.trackSid===T.sid){if(!t.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),ut(t))),t.stopPreConnectBuffer()}}),L&&new Promise((j,U)=>X(this,void 0,void 0,function*(){var q,K,$,Y,Q,F;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),ut(t)));const H=setTimeout(()=>{U(new Error("agent not active within 10 seconds"))},1e4),ee=yield this.waitUntilActiveAgentPresent();clearTimeout(H),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),ut(t)));const ue=yield this.streamBytes({name:"preconnect-buffer",mimeType:D,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[ee.identity],attributes:{trackId:E.trackSid,sampleRate:String((Q=w.sampleRate)!==null&&Q!==void 0?Q:"48000"),channels:String((F=w.channelCount)!==null&&F!==void 0?F:"1")}});try{for(var N=!0,z=Pr(L),G;G=yield z.next(),q=G.done,!q;N=!0){Y=G.value,N=!1;const ce=Y;yield ue.write(ce)}}catch(ce){K={error:ce}}finally{try{!N&&!q&&($=z.return)&&(yield $.call(z))}finally{if(K)throw K.error}}yield ue.close(),j()}catch(H){U(H)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),ut(t)))}).catch(j=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),ut(t)),{error:j}))})}return E})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,n,i){return X(this,void 0,void 0,function*(){var s;if(this.encryptionType!==un.NONE)return;let r;if(this.trackPublications.forEach(g=>{g.track&&g.track===t&&(r=g)}),!r)throw new Dr("track is not published");if(!po(t))throw new Dr("track is not a video track");const a=Object.assign(Object.assign({},(s=this.roomOptions)===null||s===void 0?void 0:s.publishDefaults),i),o=JH(t,n,a);if(!o){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),ut(t)));return}const l=t.addSimulcastTrack(n,o);if(!l)return;const u=new Id({cid:l.mediaStreamTrack.id,type:ve.kindToProto(t.kind),muted:t.isMuted,source:ve.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:a.videoCodec,cid:l.mediaStreamTrack.id}]});if(u.layers=fR(u.width,u.height,o),!this.engine||this.engine.isClosed)throw new ln("cannot publish track when not connected");const h=()=>X(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(t,l,a,o),yield this.engine.negotiate()}),m=(yield Promise.all([this.engine.addTrack(u),h()]))[0];this.log.debug("published ".concat(n," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:o,trackInfo:m}))})}unpublishTrack(t,n){return X(this,void 0,void 0,function*(){var i,s;if(pc(t)){const u=this.pendingPublishPromises.get(t);u&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),ut(t))),yield u)}const r=this.getPublicationForTrack(t),a=r?ut(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!r||!r.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}t=r.track,t.off(ke.Muted,this.onTrackMuted),t.off(ke.Unmuted,this.onTrackUnmuted),t.off(ke.Ended,this.handleTrackEnded),t.off(ke.UpstreamPaused,this.onTrackUpstreamPaused),t.off(ke.UpstreamResumed,this.onTrackUpstreamResumed),t.off(ke.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(s=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&s!==void 0?s:!0),n?t.stop():t.stopMonitor();let o=!1;const l=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Qt.FAILED&&l)try{for(const u of this.engine.pcManager.publisher.getTransceivers())u.sender===l&&(u.direction="inactive",o=!0);if(this.engine.removeTrack(l)&&(o=!0),po(t)){for(const[,u]of t.simulcastCodecs)u.sender&&(this.engine.removeTrack(u.sender)&&(o=!0),u.sender=void 0);t.simulcastCodecs.clear()}}catch(u){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:u}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case ve.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case ve.Kind.Video:this.videoTrackPublications.delete(r.trackSid);break}return this.emit(Ae.LocalTrackUnpublished,r),r.setTrack(void 0),o&&(yield this.engine.negotiate()),r})}unpublishTracks(t){return X(this,void 0,void 0,function*(){return(yield Promise.all(t.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(t){return X(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new zn((r,a)=>X(i,void 0,void 0,function*(){try{const o=[];this.trackPublications.forEach(l=>{l.track&&(n&&(l.options=Object.assign(Object.assign({},l.options),n)),o.push(l))}),yield Promise.all(o.map(l=>X(this,void 0,void 0,function*(){const u=l.track;yield this.unpublishTrack(u,!1),s&&!u.isMuted&&u.source!==ve.Source.ScreenShare&&u.source!==ve.Source.ScreenShareAudio&&(kr(u)||po(u))&&!u.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield u.restartTrack()),yield this.publishOrRepublishTrack(u,l.options,!0)}))),r()}catch(o){o instanceof Error?a(o):a(new Error(String(o)))}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(t){return X(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const r=s.reliable?at.RELIABLE:at.LOSSY,a=s.destinationIdentities,o=s.topic;let l=new DS({participantIdentity:i.identity,payload:n,destinationIdentities:a,topic:o});const u=new Zn({kind:r,value:{case:"user",value:l}});yield i.engine.sendDataPacket(u,r)})()})}publishDtmf(t,n){return X(this,void 0,void 0,function*(){const i=new Zn({kind:at.RELIABLE,value:{case:"sipDtmf",value:new nI({code:t,digit:n})}});yield this.engine.sendDataPacket(i,at.RELIABLE)})}sendChatMessage(t,n){return X(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:t,timestamp:Date.now(),attachedFiles:n?.attachments},s=new Zn({value:{case:"chatMessage",value:new em(Object.assign(Object.assign({},i),{timestamp:Kt.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(s,at.RELIABLE),this.emit(Ae.ChatMessage,i),i})}editChatMessage(t,n){return X(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:t,editTimestamp:Date.now()}),s=new Zn({value:{case:"chatMessage",value:new em(Object.assign(Object.assign({},i),{timestamp:Kt.parse(i.timestamp),editTimestamp:Kt.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(s,at.RELIABLE),this.emit(Ae.ChatMessage,i),i})}sendText(t,n){return X(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(t,n)})}streamText(t){return X(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(t)})}sendFile(t,n){return X(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(t,n)})}streamBytes(t){return X(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(t)})}performRpc(t){let{destinationIdentity:n,method:i,payload:s,responseTimeout:r=15e3}=t;const a=7e3,o=a+1e3;return new zn((l,u)=>X(this,void 0,void 0,function*(){var h,f,m,g;if(tC(s)>gP){u(nn.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((f=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||f===void 0)&&f.version&&Qs((g=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){u(nn.builtIn("UNSUPPORTED_SERVER"));return}const C=Math.max(r,o),S=crypto.randomUUID();yield this.publishRpcRequest(n,S,i,s,C);const v=setTimeout(()=>{this.pendingAcks.delete(S),u(nn.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(S),clearTimeout(_)},a);this.pendingAcks.set(S,{resolve:()=>{clearTimeout(v)},participantIdentity:n});const _=setTimeout(()=>{this.pendingResponses.delete(S),u(nn.builtIn("RESPONSE_TIMEOUT"))},r);this.pendingResponses.set(S,{resolve:(w,x)=>{clearTimeout(_),this.pendingAcks.has(S)&&(this.log.warn("RPC response received before ack",S),this.pendingAcks.delete(S),clearTimeout(v)),x?u(x):l(w??"")},participantIdentity:n})}))}registerRpcMethod(t,n){this.rpcHandlers.has(t)&&this.log.warn("you're overriding the RPC handler for method ".concat(t,", in the future this will throw an error")),this.rpcHandlers.set(t,n)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setTrackSubscriptionPermissions(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(t){const n=this.pendingAcks.get(t);n?(n.resolve(),this.pendingAcks.delete(t)):console.error("Ack received for unexpected RPC request",t)}handleIncomingRpcResponse(t,n,i){const s=this.pendingResponses.get(t);s?(s.resolve(n,i),this.pendingResponses.delete(t)):console.error("Response received for unexpected RPC request",t)}publishRpcRequest(t,n,i,s,r){return X(this,void 0,void 0,function*(){const a=new Zn({destinationIdentities:[t],kind:at.RELIABLE,value:{case:"rpcRequest",value:new OS({id:n,method:i,payload:s,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(a,at.RELIABLE)})}handleParticipantDisconnected(t){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===t&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:s}]of this.pendingResponses)i===t&&(s(null,nn.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(t){this.enabledPublishVideoCodecs=t.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(t){return super.updateInfo(t)?(t.tracks.forEach(n=>{var i,s;const r=this.trackPublications.get(n.sid);if(r){const a=r.isMuted||((s=(i=r.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&s!==void 0?s:!1);a!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),ut(r)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(n.sid,a))}}),!0):!1}setActiveAgent(t){var n,i,s,r;this.firstActiveAgent=t,t&&!this.firstActiveAgent&&(this.firstActiveAgent=t),t?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,t):(r=(s=this.activeAgentFuture)===null||s===void 0?void 0:s.reject)===null||r===void 0||r.call(s,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new ts),this.activeAgentFuture.promise)}getPublicationForTrack(t){let n;return this.trackPublications.forEach(i=>{const s=i.track;s&&(t instanceof MediaStreamTrack?(kr(s)||po(s))&&s.mediaStreamTrack===t&&(n=i):t===s&&(n=i))}),n}waitForPendingPublicationOfSource(t){return X(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const s=Array.from(this.pendingPublishPromises.entries()).find(r=>{let[a]=r;return a.source===t});if(s)return s[1];yield On(20)}})}}class S$ extends Rr{constructor(t,n,i,s){super(t,n.sid,n.name,s),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=r=>{this.setTrack(void 0),this.emit(ke.Ended,r)},this.handleVisibilityChange=r=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(r),this.logContext),this.visible=r,this.emitTrackUpdate()},this.handleVideoDimensionsChange=r=>{this.log.debug("adaptivestream video dimensions ".concat(r.width,"x").concat(r.height),this.logContext),this.videoDimensionsAdaptiveStream=r,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const s=new Jm({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new sI({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ke.UpdateSubscription,s),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Rr.SubscriptionStatus.Unsubscribed:super.isSubscribed?Rr.SubscriptionStatus.Subscribed:Rr.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Rr.PermissionStatus.Allowed:Rr.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(t){!this.isManualOperationAllowed()||this.requestedDisabled===!t||(this.requestedDisabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.requestedMaxQuality===t||(this.requestedMaxQuality=t,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===t.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===t.height||(gy(this.track)&&(this.requestedVideoDimensions=t),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&gy(this.track)&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){var t;return(t=this.requestedMaxQuality)!==null&&t!==void 0?t:Li.HIGH}setTrack(t){const n=this.subscriptionStatus,i=this.permissionStatus,s=this.track;s!==t&&(s&&(s.off(ke.VideoDimensionsChanged,this.handleVideoDimensionsChange),s.off(ke.VisibilityChanged,this.handleVisibilityChange),s.off(ke.Ended,this.handleEnded),s.detach(),s.stopMonitor(),this.emit(ke.Unsubscribed,s)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(ke.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(ke.VisibilityChanged,this.handleVisibilityChange),t.on(ke.Ended,this.handleEnded),this.emit(ke.Subscribed,t)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(t){this.emit(ke.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const n=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):n!==t.muted&&this.emit(t.muted?ke.Muted:ke.Unmuted)}emitSubscriptionUpdateIfChanged(t){const n=this.subscriptionStatus;t!==n&&this.emit(ke.SubscriptionStatusChanged,n,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(ke.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return gy(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new gI({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===ve.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)HE(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=F7(this.trackInfo,this.requestedMaxQuality);i&&HE(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(t.width=Math.ceil(n.width),t.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),t.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Li.HIGH})),t.quality=Li.HIGH)}this.emit(ke.UpdateSettings,t)}}class am extends wP{static fromParticipantInfo(t,n,i){return new am(t,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,n,i,s,r,a,o){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Ld.STANDARD;super(n,i||"",s,r,a,o,l),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(ke.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),ut(t)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),t.on(ke.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),t.on(ke.SubscriptionPermissionChanged,n=>{this.emit(Ae.TrackSubscriptionPermissionChanged,t,n)}),t.on(ke.SubscriptionStatusChanged,n=>{this.emit(Ae.TrackSubscriptionStatusChanged,t,n)}),t.on(ke.Subscribed,n=>{this.emit(Ae.TrackSubscribed,n,t)}),t.on(ke.Unsubscribed,n=>{this.emit(Ae.TrackUnsubscribed,n,t)}),t.on(ke.SubscriptionFailed,n=>{this.emit(Ae.TrackSubscriptionFailed,t.trackSid,n)})}getTrackPublication(t){const n=super.getTrackPublication(t);if(n)return n}getTrackPublicationByName(t){const n=super.getTrackPublicationByName(t);if(n)return n}setVolume(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ve.Source.Microphone;this.volumeMap.set(n,t);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ve.Source.Microphone;const n=this.getTrackPublication(t);return n&&n.track?n.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,n,i,s,r,a){let o=this.getTrackPublicationBySid(n);if(o||n.startsWith("TR")||this.trackPublications.forEach(h=>{!o&&t.kind===h.kind.toString()&&(o=h)}),!o){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(Ae.TrackSubscriptionFailed,n);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,n,i,s,r,a-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),ut(o))),this.emit(Ae.TrackSubscriptionFailed,n);return}const l=t.kind==="video";let u;return l?u=new m$(t,n,s,r):u=new p$(t,n,s,this.audioContext,this.audioOutput),u.source=o.source,u.isMuted=o.isMuted,u.setMediaStream(i),u.start(),o.setTrack(u),this.volumeMap.has(o.source)&&d0(u)&&qs(u)&&u.setVolume(this.volumeMap.get(o.source)),o}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const n=new Map,i=new Map;return t.tracks.forEach(s=>{var r,a;let o=this.getTrackPublicationBySid(s.sid);if(o)o.updateInfo(s);else{const l=ve.kindFromProto(s.type);if(!l)return;o=new S$(l,s,(r=this.signalClient.connectOptions)===null||r===void 0?void 0:r.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),o.updateInfo(s),i.set(s.sid,o);const u=Array.from(this.trackPublications.values()).find(h=>h.source===o?.source);u&&o.source!==ve.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:ut(u),newTrack:ut(o)})),this.addTrackPublication(o)}n.set(s.sid,o)}),this.trackPublications.forEach(s=>{n.has(s.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),ut(s))),this.unpublishTrack(s.trackSid,!0))}),i.forEach(s=>{this.emit(Ae.TrackPublished,s)}),!0}unpublishTrack(t,n){const i=this.trackPublications.get(t);if(!i)return;const{track:s}=i;switch(s&&(s.stop(),i.setTrack(void 0)),this.trackPublications.delete(t),i.kind){case ve.Kind.Audio:this.audioTrackPublications.delete(t);break;case ve.Kind.Video:this.videoTrackPublications.delete(t);break}n&&this.emit(Ae.TrackUnpublished,i)}setAudioOutput(t){return X(this,void 0,void 0,function*(){this.audioOutput=t;const n=[];this.audioTrackPublications.forEach(i=>{var s;qs(i.track)&&d0(i.track)&&n.push(i.track.setSinkId((s=t.deviceId)!==null&&s!==void 0?s:"default"))}),yield Promise.all(n)})}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:i})),super.emit(t,...i)}}var wt;(function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"})(wt||(wt={}));const C$=4*1e3;class wc extends Zs.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(t){var n,i,s,r,a;if(super(),n=this,this.state=wt.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=it,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,l,u)=>X(this,void 0,void 0,function*(){var h;if(!V7())throw Ys()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const f=yield this.disconnectLock.lock();if(this.state===wt.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),f(),Promise.resolve();if(this.connectFuture)return f(),this.connectFuture.promise;this.setAndEmitConnectionState(wt.Connecting),((h=this.regionUrlProvider)===null||h===void 0?void 0:h.getServerUrl().toString())!==hP(o)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),xc(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new bt(o,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(C=>{var S;(S=this.regionUrlProvider)===null||S===void 0||S.setServerReportedRegions(C)}).catch(C=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:C}))}));const m=(C,S,v)=>X(this,void 0,void 0,function*(){var _,w;this.abortController&&this.abortController.abort();const x=new AbortController;this.abortController=x,f?.();try{if(yield mc.getInstance().getBackOffPromise(o),x.signal.aborted)throw We.cancelled("Connection attempt aborted");yield this.attemptConnection(v??o,l,u,x),this.abortController=void 0,C()}catch(k){if(this.regionUrlProvider&&k instanceof We&&k.reason!==Ft.Cancelled&&k.reason!==Ft.NotAllowed){let A=null;try{this.log.debug("Fetching next region"),A=yield this.regionUrlProvider.getNextBestRegionUrl((_=this.abortController)===null||_===void 0?void 0:_.signal)}catch(T){if(T instanceof We&&(T.status===401||T.reason===Ft.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),S(T);return}}[Ft.InternalError,Ft.ServerUnreachable,Ft.Timeout].includes(k.reason)&&(this.log.debug("Adding failed connection attempt to back off"),mc.getInstance().addFailedConnectionAttempt(o)),A&&!(!((w=this.abortController)===null||w===void 0)&&w.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(k.message,". Retrying with another region: ").concat(A),this.logContext),this.recreateEngine(),yield m(C,S,A)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,YE(k)),S(k))}else{let A=ys.UNKNOWN_REASON;k instanceof We&&(A=YE(k)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,A),S(k)}}}),g=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new ts((C,S)=>{m(C,S,g)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,l,u,h,f,m)=>X(this,void 0,void 0,function*(){var g,C,S;const v=yield u.join(o,l,{autoSubscribe:h.autoSubscribe,adaptiveStream:typeof f.adaptiveStream=="object"?!0:f.adaptiveStream,maxRetries:h.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:h.websocketTimeout},m.signal,!f.singlePeerConnection);let _=v.serverInfo;if(_||(_={version:v.serverVersion,region:v.serverRegion}),this.serverInfo=_,this.log.debug("connected to Livekit Server ".concat(Object.entries(_).map(w=>{let[x,k]=w;return"".concat(x,": ").concat(k)}).join(", ")),{room:(g=v.room)===null||g===void 0?void 0:g.name,roomSid:(C=v.room)===null||C===void 0?void 0:C.sid,identity:(S=v.participant)===null||S===void 0?void 0:S.identity}),!_.version)throw new E7("unknown server version");return _.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),f.dynacast=!1),v}),this.applyJoinResponse=o=>{const l=o.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(u){this.log.error(u instanceof Error?u.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:u}))}this.handleParticipantUpdates([l,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,l,u,h)=>X(this,void 0,void 0,function*(){var f,m;this.state===wt.Reconnecting||this.isResuming||!((f=this.engine)===null||f===void 0)&&f.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((m=this.regionUrlProvider)===null||m===void 0)&&m.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},eC),u),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const g=yield this.connectSignal(o,l,this.engine,this.connOptions,this.options,h);this.applyJoinResponse(g),this.setupLocalParticipantEvents(),this.emit(ye.SignalConnected)}catch(g){yield this.engine.close(),this.recreateEngine();const C=h.signal.aborted?We.cancelled("Signal connection aborted"):We.serverUnreachable("could not establish signal connection");throw g instanceof Error&&(C.message="".concat(C.message,": ").concat(g.message)),g instanceof We&&(C.reason=g.reason,C.status=g.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:g})),C}if(h.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),We.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,h)}catch(g){throw yield this.engine.close(),this.recreateEngine(),g}mi()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),mi()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(wt.Connected),this.emit(ye.Connected),mc.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];return X(n,[...l],void 0,function(){var h=this;let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var m,g,C;const S=yield h.disconnectLock.lock();try{if(h.state===wt.Disconnected){h.log.debug("already disconnected",h.logContext);return}if(h.log.info("disconnect from room",Object.assign({},h.logContext)),h.state===wt.Connecting||h.state===wt.Reconnecting||h.isResuming){const v="Abort connection attempt due to user initiated disconnect";h.log.warn(v,h.logContext),(m=h.abortController)===null||m===void 0||m.abort(v),(C=(g=h.connectFuture)===null||g===void 0?void 0:g.reject)===null||C===void 0||C.call(g,We.cancelled("Client initiated disconnect")),h.connectFuture=void 0}h.engine&&(h.engine.client.isDisconnected||(yield h.engine.client.sendLeave()),yield h.engine.close()),h.handleDisconnect(f,ys.CLIENT_INITIATED),h.engine=void 0}finally{S()}})()})},this.onPageLeave=()=>X(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>X(this,void 0,void 0,function*(){const o=[],l=vi();if(l&&l.os==="iOS"){const u="livekit-dummy-audio-el";let h=document.getElementById(u);if(!h){h=document.createElement("audio"),h.id=u,h.autoplay=!0,h.hidden=!0;const f=my();f.enabled=!0;const m=new MediaStream([f]);h.srcObject=m,document.addEventListener("visibilitychange",()=>{h&&(h.srcObject=document.hidden?null:m,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(h),this.once(ye.Disconnected,()=>{h?.remove(),h=null})}o.push(h)}this.remoteParticipants.forEach(u=>{u.audioTrackPublications.forEach(h=>{h.track&&h.track.attachedElements.forEach(f=>{o.push(f)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(u=>(u.muted=!1,u.play()))]),this.handleAudioPlaybackStarted()}catch(u){throw this.handleAudioPlaybackFailed(u),u}}),this.startVideo=()=>X(this,void 0,void 0,function*(){const o=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(u=>{var h;(h=u.track)===null||h===void 0||h.attachedElements.forEach(f=>{o.includes(f)||o.push(f)})});yield Promise.all(o.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(wt.Reconnecting)&&this.emit(ye.Reconnecting)},this.handleSignalRestarted=o=>X(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(wt.Connected),this.emit(ye.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(l=>{var u;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(u=this.sidToIdentity.get(l.sid))!==null&&u!==void 0?u:"");let h=this.remoteParticipants.get(l.identity);l.state===uc.DISCONNECTED?this.handleParticipantDisconnected(l.identity,h):h=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=o=>{const l=[],u={};o.forEach(h=>{if(u[h.sid]=!0,h.sid===this.localParticipant.sid)this.localParticipant.audioLevel=h.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const f=this.getRemoteParticipantBySid(h.sid);f&&(f.audioLevel=h.level,f.setIsSpeaking(!0),l.push(f))}}),u[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(h=>{u[h.sid]||(h.audioLevel=0,h.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(ye.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=o=>{const l=new Map;this.activeSpeakers.forEach(h=>{const f=this.remoteParticipants.get(h.identity);f&&f.sid!==h.sid||l.set(h.sid,h)}),o.forEach(h=>{let f=this.getRemoteParticipantBySid(h.sid);h.sid===this.localParticipant.sid&&(f=this.localParticipant),f&&(f.audioLevel=h.level,f.setIsSpeaking(h.active),h.active?l.set(h.sid,f):l.delete(h.sid))});const u=Array.from(l.values());u.sort((h,f)=>f.audioLevel-h.audioLevel),this.activeSpeakers=u,this.emitWhenConnected(ye.ActiveSpeakersChanged,u)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(l=>{const u=this.getRemoteParticipantBySid(l.participantSid);if(!u)return;const h=u.getTrackPublicationBySid(l.trackSid);if(!h||!h.track)return;const f=ve.streamStateFromProto(l.state);h.track.setStreamState(f),f!==h.track.streamState&&(u.emit(Ae.TrackStreamStateChanged,h,h.track.streamState),this.emitWhenConnected(ye.TrackStreamStateChanged,h,h.track.streamState,u))})},this.handleSubscriptionPermissionUpdate=o=>{const l=this.getRemoteParticipantBySid(o.participantSid);if(!l)return;const u=l.getTrackPublicationBySid(o.trackSid);u&&u.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const l=Array.from(this.remoteParticipants.values()).find(h=>h.trackPublications.has(o.trackSid));if(!l)return;const u=l.getTrackPublicationBySid(o.trackSid);u&&u.setSubscriptionError(o.err)},this.handleDataPacket=(o,l)=>{const u=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(u,o.value.value,o.kind,l);else if(o.value.case==="transcription")this.handleTranscription(u,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(u,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(u,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,u);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,l);else if(o.value.case==="rpcRequest"){const h=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,h.id,h.method,h.payload,h.responseTimeoutMs,h.version)}},this.handleUserPacket=(o,l,u,h)=>{this.emit(ye.DataReceived,l.payload,o,u,l.topic,h),o?.emit(Ae.DataReceived,l.payload,u,h)},this.handleSipDtmf=(o,l)=>{this.emit(ye.SipDTMFReceived,l,o),o?.emit(Ae.SipDTMFReceived,l)},this.handleTranscription=(o,l)=>{const u=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),h=u?.trackPublications.get(l.trackId),f=eH(l,this.transcriptionReceivedTimes);h?.emit(ke.TranscriptionReceived,f),u?.emit(Ae.TranscriptionReceived,f,h),this.emit(ye.TranscriptionReceived,f,u,h)},this.handleChatMessage=(o,l)=>{const u=tH(l);this.emit(ye.ChatMessage,u,o)},this.handleMetrics=(o,l)=>{this.emit(ye.MetricsReceived,o,l)},this.handleDataStream=(o,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(ye.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(ye.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(ye.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(ye.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>X(this,void 0,void 0,function*(){var o;((o=vi())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(ye.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const l=this.roomInfo;this.roomInfo=o,l&&l.metadata!==o.metadata&&this.emitWhenConnected(ye.RoomMetadataChanged,o.metadata),l?.activeRecording!==o.activeRecording&&this.emitWhenConnected(ye.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const u=this.getRemoteParticipantBySid(l.participantSid);u&&u.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(ye.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(ye.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(ye.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(ye.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(ye.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var l;(l=o?.onPublish)===null||l===void 0||l.call(o,this)},this.onLocalTrackPublished=o=>X(this,void 0,void 0,function*(){var l,u,h,f,m,g;(l=o.track)===null||l===void 0||l.on(ke.TrackProcessorUpdate,this.onTrackProcessorUpdate),(u=o.track)===null||u===void 0||u.on(ke.Restarted,this.onLocalTrackRestarted),(m=(f=(h=o.track)===null||h===void 0?void 0:h.getProcessor())===null||f===void 0?void 0:f.onPublish)===null||m===void 0||m.call(f,this),this.emit(ye.LocalTrackPublished,o,this.localParticipant),kr(o.track)&&(yield o.track.checkForSilence())&&this.emit(ye.LocalAudioSilenceDetected,o);const C=yield(g=o.track)===null||g===void 0?void 0:g.getDeviceId(!1),S=a0(o.source);S&&C&&C!==this.localParticipant.activeDeviceMap.get(S)&&(this.localParticipant.activeDeviceMap.set(S,C),this.emit(ye.ActiveDeviceChanged,S,C))}),this.onLocalTrackUnpublished=o=>{var l,u;(l=o.track)===null||l===void 0||l.off(ke.TrackProcessorUpdate,this.onTrackProcessorUpdate),(u=o.track)===null||u===void 0||u.off(ke.Restarted,this.onLocalTrackRestarted),this.emit(ye.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>X(this,void 0,void 0,function*(){const l=yield o.getDeviceId(!1),u=a0(o.source);u&&l&&l!==this.localParticipant.activeDeviceMap.get(u)&&(this.log.debug("local track restarted, setting ".concat(u," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(u,l),this.emit(ye.ActiveDeviceChanged,u,l))}),this.onLocalConnectionQualityChanged=o=>{this.emit(ye.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,l)=>{this.emit(ye.MediaDevicesError,o,l)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(ye.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(ye.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},DH),t),this.log=Ks((i=this.options.loggerName)!==null&&i!==void 0?i:is.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},fP),t?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},pP),t?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},PH),t?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new u$,this.outgoingDataStreamManager=new f$(this.engine,this.log),this.disconnectLock=new ni,this.localParticipant=new _$("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Da(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Da(this.options.audioCaptureDefaults.deviceId)),!((s=this.options.audioOutput)===null||s===void 0)&&s.deviceId&&this.switchActiveDevice("audiooutput",Da(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),mi()){const o=new AbortController;(a=(r=navigator.mediaDevices)===null||r===void 0?void 0:r.addEventListener)===null||a===void 0||a.call(r,"devicechange",this.handleDeviceChange,{signal:o.signal}),wc.cleanupRegistry&&wc.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(t,n){return this.incomingDataStreamManager.registerTextStreamHandler(t,n)}unregisterTextStreamHandler(t){return this.incomingDataStreamManager.unregisterTextStreamHandler(t)}registerByteStreamHandler(t,n){return this.incomingDataStreamManager.registerByteStreamHandler(t,n)}unregisterByteStreamHandler(t){return this.incomingDataStreamManager.unregisterByteStreamHandler(t)}registerRpcMethod(t,n){if(this.rpcHandlers.has(t))throw Error("RPC handler already registered for method ".concat(t,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(t,n)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setE2EEEnabled(t){return X(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new gH(i,n),this.e2eeManager.on(Eo.ParticipantEncryptionStatusChanged,(s,r)=>{iH(r)&&(this.isE2EEEnabled=s),this.emit(ye.ParticipantEncryptionStatusChanged,s,r)}),this.e2eeManager.on(Eo.EncryptionError,(s,r)=>{const a=r?this.getParticipantByIdentity(r):void 0;this.emit(ye.EncryptionError,s,a)}),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,n;return(n=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return this.state===wt.Disconnected?zn.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?zn.resolve(this.roomInfo.sid):new zn((t,n)=>{const i=s=>{s.sid!==""&&(this.engine.off(Re.RoomUpdate,i),t(s.sid))};this.engine.on(Re.RoomUpdate,i),this.once(ye.Disconnected,()=>{this.engine.off(Re.RoomUpdate,i),n(new ln("Room disconnected before room server id was available"))})})}get name(){var t,n;return(n=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&n!==void 0?n:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,n;return(n=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var t,n;return(n=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new o$(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(Re.ParticipantUpdate,this.handleParticipantUpdates).on(Re.RoomUpdate,this.handleRoomUpdate).on(Re.SpeakersChanged,this.handleSpeakersChanged).on(Re.StreamStateChanged,this.handleStreamStateUpdate).on(Re.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Re.SubscriptionError,this.handleSubscriptionError).on(Re.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Re.MediaTrackAdded,(t,n,i)=>{this.onTrackAdded(t,n,i)}).on(Re.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(Re.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Re.DataPacketReceived,this.handleDataPacket).on(Re.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(wt.SignalReconnecting)&&this.emit(ye.SignalReconnecting)}).on(Re.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(wt.Connected)&&this.emit(ye.Reconnected)}).on(Re.SignalResumed,()=>{this.bufferedEvents=[],(this.state===wt.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(Re.Restarting,this.handleRestarting).on(Re.SignalRestarted,this.handleSignalRestarted).on(Re.Offline,()=>{this.setAndEmitConnectionState(wt.Reconnecting)&&this.emit(ye.Reconnecting)}).on(Re.DCBufferStatusChanged,(t,n)=>{this.emit(ye.DCBufferStatusChanged,t,n)}).on(Re.LocalTrackSubscribed,t=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:s}=i;return s===t});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(Ae.LocalTrackSubscribed,n),this.emitWhenConnected(ye.LocalTrackSubscribed,n,this.localParticipant)}).on(Re.RoomMoved,t=>{this.log.debug("room moved",t),t.room&&this.handleRoomUpdate(t.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(ye.Moved,t.room.name),t.participant?this.handleParticipantUpdates([t.participant,...t.otherParticipants]):this.handleParticipantUpdates(t.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return kn.getInstance().getDevices(t,n)}prepareConnection(t,n){return X(this,void 0,void 0,function*(){if(this.state===wt.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(xc(new URL(t))&&n){this.regionUrlProvider=new bt(t,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===wt.Disconnected&&(this.regionUrl=i,yield fetch(Od(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Od(t),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,n){return X(this,void 0,void 0,function*(){let i=()=>X(this,void 0,void 0,function*(){}),s;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":s=new Os({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":s=new Os({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":s=new Os({scenario:{case:"serverLeave",value:!0}});break;case"migration":s=new Os({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>X(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),s=new Os({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>X(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),s=new Os({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":s=new Os({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),i=()=>X(this,void 0,void 0,function*(){const r=this.engine.client.onLeave;r&&r(new Xm({reason:ys.CLIENT_INITIATED,action:dc.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");s=new Os({scenario:{case:"subscriberBandwidth",value:_a(n)}});break;case"leave-full-reconnect":s=new Os({scenario:{case:"leaveRequestFullReconnect",value:!0}})}s&&(yield this.engine.client.sendSimulateScenario(s),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,n){return X(this,arguments,void 0,function(i,s){var r=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var o,l,u,h,f,m,g;let C=!0,S=!1;const v=a?{exact:s}:s;if(i==="audioinput"){S=r.localParticipant.audioTrackPublications.size===0;const _=(o=r.getActiveDevice(i))!==null&&o!==void 0?o:r.options.audioCaptureDefaults.deviceId;r.options.audioCaptureDefaults.deviceId=v;const w=Array.from(r.localParticipant.audioTrackPublications.values()).filter(k=>k.source===ve.Source.Microphone);try{C=(yield Promise.all(w.map(k=>{var A;return(A=k.audioTrack)===null||A===void 0?void 0:A.setDeviceId(v)}))).every(k=>k===!0)}catch(k){throw r.options.audioCaptureDefaults.deviceId=_,k}const x=w.some(k=>{var A,T;return(T=(A=k.track)===null||A===void 0?void 0:A.isMuted)!==null&&T!==void 0?T:!1});C&&x&&(S=!0)}else if(i==="videoinput"){S=r.localParticipant.videoTrackPublications.size===0;const _=(l=r.getActiveDevice(i))!==null&&l!==void 0?l:r.options.videoCaptureDefaults.deviceId;r.options.videoCaptureDefaults.deviceId=v;const w=Array.from(r.localParticipant.videoTrackPublications.values()).filter(k=>k.source===ve.Source.Camera);try{C=(yield Promise.all(w.map(k=>{var A;return(A=k.videoTrack)===null||A===void 0?void 0:A.setDeviceId(v)}))).every(k=>k===!0)}catch(k){throw r.options.videoCaptureDefaults.deviceId=_,k}const x=w.some(k=>{var A,T;return(T=(A=k.track)===null||A===void 0?void 0:A.isMuted)!==null&&T!==void 0?T:!1});C&&x&&(S=!0)}else if(i==="audiooutput"){if(S=!0,!u0()&&!r.options.webAudioMix||r.options.webAudioMix&&r.audioContext&&!("setSinkId"in r.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");r.options.webAudioMix&&(s=(u=yield kn.getInstance().normalizeDeviceId("audiooutput",s))!==null&&u!==void 0?u:""),(h=(g=r.options).audioOutput)!==null&&h!==void 0||(g.audioOutput={});const _=(f=r.getActiveDevice(i))!==null&&f!==void 0?f:r.options.audioOutput.deviceId;r.options.audioOutput.deviceId=s;try{r.options.webAudioMix&&((m=r.audioContext)===null||m===void 0||m.setSinkId(s)),yield Promise.all(Array.from(r.remoteParticipants.values()).map(w=>w.setAudioOutput({deviceId:s})))}catch(w){throw r.options.audioOutput.deviceId=_,w}}return S&&(r.localParticipant.activeDeviceMap.set(i,s),r.emit(ye.ActiveDeviceChanged,i,s)),C})()})}setupLocalParticipantEvents(){this.localParticipant.on(Ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Ae.AttributesChanged,this.onLocalAttributesChanged).on(Ae.TrackMuted,this.onLocalTrackMuted).on(Ae.TrackUnmuted,this.onLocalTrackUnmuted).on(Ae.LocalTrackPublished,this.onLocalTrackPublished).on(Ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Ae.MediaDevicesError,this.onMediaDevicesError).on(Ae.AudioStreamAcquired,this.startAudio).on(Ae.ChatMessage,this.onLocalChatMessageSent).on(Ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,n,i){if(this.state===wt.Connecting||this.state===wt.Reconnecting){const f=()=>{this.log.debug("deferring on track for later",{mediaTrackId:t.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(g=>g.id)}),this.onTrackAdded(t,n,i),m()},m=()=>{this.off(ye.Reconnected,f),this.off(ye.Connected,f),this.off(ye.Disconnected,m)};this.once(ye.Reconnected,f),this.once(ye.Connected,f),this.once(ye.Disconnected,m);return}if(this.state===wt.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(t.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const s=H7(n.id),r=s[0];let a=s[1],o=t.id;if(a&&a.startsWith("TR")&&(o=a),r===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(f=>f.sid===r);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);return}if(!o.startsWith("TR")){const f=this.engine.getTrackIdForReceiver(i);if(!f){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(r),this.logContext);return}o=f}o.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(r,", streamId: ").concat(a,", trackId: ").concat(o),Object.assign(Object.assign({},this.logContext),{rpID:r,streamId:a,trackId:o}));let u;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?u=this.options.adaptiveStream:u={});const h=l.addSubscribedMediaTrack(t,o,n,i,u);h?.isEncrypted&&!this.e2eeManager&&this.emit(ye.EncryptionError,new Error("Encrypted ".concat(h.source," track received from participant ").concat(l.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i,s;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==wt.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(a=>{r.unpublishTrack(a.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var a,o,l;r.track&&this.localParticipant.unpublishTrack(r.track,t),t?((a=r.track)===null||a===void 0||a.detach(),(o=r.track)===null||o===void 0||o.stop()):(l=r.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(Ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Ae.AttributesChanged,this.onLocalAttributesChanged).off(Ae.TrackMuted,this.onLocalTrackMuted).off(Ae.TrackUnmuted,this.onLocalTrackUnmuted).off(Ae.LocalTrackPublished,this.onLocalTrackPublished).off(Ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Ae.MediaDevicesError,this.onMediaDevicesError).off(Ae.AudioStreamAcquired,this.startAudio).off(Ae.ChatMessage,this.onLocalChatMessageSent).off(Ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),mi()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(s=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||s===void 0||s.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(wt.Disconnected),this.emit(ye.Disconnected,n)}}}handleParticipantDisconnected(t,n){var i;this.remoteParticipants.delete(t),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(t),n.trackPublications.forEach(s=>{n.unpublishTrack(s.trackSid,!0)}),this.emit(ye.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(t,n,i,s,r,a){return X(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(t,n),a!==1){yield this.engine.publishRpcResponse(t,n,null,nn.builtIn("UNSUPPORTED_VERSION"));return}const o=this.rpcHandlers.get(i);if(!o){yield this.engine.publishRpcResponse(t,n,null,nn.builtIn("UNSUPPORTED_METHOD"));return}let l=null,u=null;try{const h=yield o({requestId:n,callerIdentity:t,payload:s,responseTimeout:r});tC(h)>gP?(l=nn.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):u=h}catch(h){h instanceof nn?l=h:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),h),l=nn.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(t,n,u,l)})}selectDefaultDevices(){return X(this,void 0,void 0,function*(){var t,n,i;const s=kn.getInstance().previousDevices,r=yield kn.getInstance().getDevices(void 0,!1),a=vi();if(a?.name==="Chrome"&&a.os!=="iOS")for(let l of r){const u=s.find(h=>h.deviceId===l.deviceId);u&&u.label!==""&&u.kind===l.kind&&u.label!==l.label&&this.getActiveDevice(l.kind)==="default"&&this.emit(ye.ActiveDeviceChanged,l.kind,l.deviceId)}const o=["audiooutput","audioinput","videoinput"];for(let l of o){const u=P7(l),h=this.localParticipant.getTrackPublication(u);if(h&&(!((t=h.track)===null||t===void 0)&&t.isUserProvided))continue;const f=r.filter(g=>g.kind===l),m=this.getActiveDevice(l);if(m===((n=s.filter(g=>g.kind===l)[0])===null||n===void 0?void 0:n.deviceId)&&f.length>0&&((i=f[0])===null||i===void 0?void 0:i.deviceId)!==m){yield this.switchActiveDevice(l,f[0].deviceId);continue}l==="audioinput"&&!Dd()||l==="videoinput"||f.length>0&&!f.find(g=>g.deviceId===this.getActiveDevice(l))&&(l!=="audiooutput"||!Dd())&&(yield this.switchActiveDevice(l,f[0].deviceId))}})}acquireAudioContext(){return X(this,void 0,void 0,function*(){var t,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=aP())!==null&&t!==void 0?t:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(s=>s.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),On(200)])}catch(s){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:s}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(ye.AudioPlaybackStatusChanged,i))})}createParticipant(t,n){var i;let s;return n?s=am.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):s=new am(this.engine.client,"",t,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&s.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&s.setAudioOutput(this.options.audioOutput).catch(r=>this.log.warn("Could not set audio output: ".concat(r.message),this.logContext)),s}getOrCreateParticipant(t,n){if(this.remoteParticipants.has(t)){const s=this.remoteParticipants.get(t);return n&&s.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),s}const i=this.createParticipant(t,n);return this.remoteParticipants.set(t,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(ye.ParticipantConnected,i),i.on(Ae.TrackPublished,s=>{this.emitWhenConnected(ye.TrackPublished,s,i)}).on(Ae.TrackSubscribed,(s,r)=>{s.kind===ve.Kind.Audio?(s.on(ke.AudioPlaybackStarted,this.handleAudioPlaybackStarted),s.on(ke.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):s.kind===ve.Kind.Video&&(s.on(ke.VideoPlaybackFailed,this.handleVideoPlaybackFailed),s.on(ke.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(ye.TrackSubscribed,s,r,i)}).on(Ae.TrackUnpublished,s=>{this.emit(ye.TrackUnpublished,s,i)}).on(Ae.TrackUnsubscribed,(s,r)=>{this.emit(ye.TrackUnsubscribed,s,r,i)}).on(Ae.TrackMuted,s=>{this.emitWhenConnected(ye.TrackMuted,s,i)}).on(Ae.TrackUnmuted,s=>{this.emitWhenConnected(ye.TrackUnmuted,s,i)}).on(Ae.ParticipantMetadataChanged,s=>{this.emitWhenConnected(ye.ParticipantMetadataChanged,s,i)}).on(Ae.ParticipantNameChanged,s=>{this.emitWhenConnected(ye.ParticipantNameChanged,s,i)}).on(Ae.AttributesChanged,s=>{this.emitWhenConnected(ye.ParticipantAttributesChanged,s,i)}).on(Ae.ConnectionQualityChanged,s=>{this.emitWhenConnected(ye.ConnectionQualityChanged,s,i)}).on(Ae.ParticipantPermissionsChanged,s=>{this.emitWhenConnected(ye.ParticipantPermissionsChanged,s,i)}).on(Ae.TrackSubscriptionStatusChanged,(s,r)=>{this.emitWhenConnected(ye.TrackSubscriptionStatusChanged,s,r,i)}).on(Ae.TrackSubscriptionFailed,(s,r)=>{this.emit(ye.TrackSubscriptionFailed,s,i,r)}).on(Ae.TrackSubscriptionPermissionChanged,(s,r)=>{this.emitWhenConnected(ye.TrackSubscriptionPermissionChanged,s,r,i)}).on(Ae.Active,()=>{this.emitWhenConnected(ye.ParticipantActive,i),i.kind===Ld.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((i,s)=>(i.push(...s.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,n)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const n of t.videoTrackPublications.values())n.isSubscribed&&nH(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(t){const n=this.sidToIdentity.get(t);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=Dn.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:this.engine?{closed:this.engine.isClosed,transportsConnectedOrConnecting:this.engine.verifyTransport()}:void 0})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,ys.STATE_MISMATCH))):t=0},C$)}clearConnectionReconcile(){this.connectionReconcileInterval&&Dn.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(ye.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[n,i]=t;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];if(this.state===wt.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,i]);else if(this.state===wt.Connected)return this.emit(t,...i);return!1}simulateParticipants(t){return X(this,void 0,void 0,function*(){var n,i,s,r;const a=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Km({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Kt.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new za({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(ye.SignalConnected),this.emit(ye.Connected),this.setAndEmitConnectionState(wt.Connected),a.video){const l=new v0(ve.Kind.Video,new sc({source:gn.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ms.AUDIO,name:"video-dummy"}),new om(a.useRealTracks&&(!((n=window.navigator.mediaDevices)===null||n===void 0)&&n.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:KE(160*((i=o.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(Ae.LocalTrackPublished,l)}if(a.audio){const l=new v0(ve.Kind.Audio,new sc({source:gn.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ms.AUDIO}),new rm(a.useRealTracks&&(!((s=navigator.mediaDevices)===null||s===void 0)&&s.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:my(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(Ae.LocalTrackPublished,l)}for(let l=0;l<o.count-1;l+=1){let u=new za({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(l),state:uc.ACTIVE,tracks:[],joinedAt:Kt.parse(Date.now())});const h=this.getOrCreateParticipant(u.identity,u);if(o.video){const f=KE(160*((r=o.aspectRatios[l%o.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),m=new sc({source:gn.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ms.AUDIO});h.addSubscribedMediaTrack(f,m.sid,new MediaStream([f]),new RTCRtpReceiver),u.tracks=[...u.tracks,m]}if(o.audio){const f=my(),m=new sc({source:gn.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ms.AUDIO});h.addSubscribedMediaTrack(f,m.sid,new MediaStream([f]),new RTCRtpReceiver),u.tracks=[...u.tracks,m]}h.updateInfo(u)}})}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];if(t!==ye.ActiveSpeakersChanged&&t!==ye.TranscriptionReceived){const r=kP(i).filter(a=>a!==void 0);(t===ye.TrackSubscribed||t===ye.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:r})),this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:r}))}return super.emit(t,...i)}}wc.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(e=>{e()});function kP(e){return e.map(t=>{if(t)return Array.isArray(t)?kP(t):typeof t=="object"?"logContext"in t?t.logContext:void 0:t})}var bR;(function(e){e[e.TooShort=0]="TooShort",e[e.HeaderOverrun=1]="HeaderOverrun",e[e.MissingExtWords=2]="MissingExtWords",e[e.UnsupportedVersion=3]="UnsupportedVersion",e[e.InvalidHandle=4]="InvalidHandle",e[e.MalformedExt=5]="MalformedExt"})(bR||(bR={}));var yR;(function(e){e[e.TooSmallForHeader=0]="TooSmallForHeader",e[e.TooSmallForPayload=1]="TooSmallForPayload"})(yR||(yR={}));var lm;(function(e){e[e.UserTimestamp=2]="UserTimestamp",e[e.E2ee=1]="E2ee"})(lm||(lm={}));lm.UserTimestamp;lm.E2ee;var _R;(function(e){e[e.Reserved=0]="Reserved",e[e.TooLarge=1]="TooLarge"})(_R||(_R={}));var SR;(function(e){e[e.Start=0]="Start",e[e.Inter=1]="Inter",e[e.Final=2]="Final",e[e.Single=3]="Single"})(SR||(SR={}));var CR;(function(e){e[e.MtuTooShort=0]="MtuTooShort"})(CR||(CR={}));Ks(is.DataTracks);var xR;(function(e){e[e.Interrupted=0]="Interrupted",e[e.UnknownFrame=1]="UnknownFrame",e[e.BufferFull=2]="BufferFull",e[e.Incomplete=3]="Incomplete"})(xR||(xR={}));var fs;(function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"})(fs||(fs={}));class Uo extends Zs.EventEmitter{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=fs.IDLE,this.logs=[],this.options={},this.url=t,this.token=n,this.name=this.constructor.name,this.room=new wc(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(t){return X(this,void 0,void 0,function*(){if(this.status!==fs.IDLE)throw Error("check is running already");this.setStatus(fs.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==fs.SKIPPED&&this.setStatus(this.isSuccess()?fs.SUCCESS:fs.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(t){return X(this,void 0,void 0,function*(){return this.room.state===wt.Connected?this.room:(t||(t=this.url),yield this.room.connect(t,this.token,this.connectOptions),this.room)})}disconnect(){return X(this,void 0,void 0,function*(){this.room&&this.room.state!==wt.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(fs.SKIPPED)}switchProtocol(t){return X(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(ye.Reconnecting,()=>{n=!0}),this.room.once(ye.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(t)),yield new Promise(r=>setTimeout(r,1e3)),!n)return;const s=Date.now()+1e4;for(;Date.now()<s;){if(i)return;yield On(100)}throw new Error("Could not reconnect using ".concat(t," protocol after 10 seconds"))})}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class x$ extends Uo{get description(){return"Cloud regions"}perform(){return X(this,void 0,void 0,function*(){const t=new bt(this.url,this.token);if(!t.isCloud()){this.skip();return}const n=[],i=new Set;for(let r=0;r<3;r++){const a=yield t.getNextBestRegionUrl();if(!a)break;if(i.has(a))continue;i.add(a);const o=yield this.checkCloudRegion(a);this.appendMessage("".concat(o.region," RTT: ").concat(o.rtt,"ms, duration: ").concat(o.duration,"ms")),n.push(o)}n.sort((r,a)=>(r.duration-a.duration)*.5+(r.rtt-a.rtt)*.5);const s=n[0];this.bestStats=s,this.appendMessage("best Cloud region: ".concat(s.region))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkCloudRegion(t){return X(this,void 0,void 0,function*(){var n,i;yield this.connect(t),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const s=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!s)throw new Error("Region not found");const r=yield this.room.localParticipant.streamText({topic:"test"}),a=1e3,l=1e6/a,u="A".repeat(a),h=Date.now();for(let C=0;C<l;C++)yield r.write(u);yield r.close();const f=Date.now(),m=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),g={region:s,rtt:1e4,duration:f-h};return m?.forEach(C=>{C.type==="candidate-pair"&&C.nominated&&(g.rtt=C.currentRoundTripTime*1e3)}),yield this.disconnect(),g})}}const wy=1e4;class w$ extends Uo{get description(){return"Connection via UDP vs TCP"}perform(){return X(this,void 0,void 0,function*(){const t=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=t,t.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(t.packetsLost-n.packetsLost)/t.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(wy/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(wy/1e3)*100).toFixed(2),"%"))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkConnectionProtocol(t){return X(this,void 0,void 0,function*(){yield this.connect(),t==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let s=0;const r=()=>{s=(s+1)%360,i.fillStyle="hsl(".concat(s,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(r)};r();const o=n.captureStream(30).getVideoTracks()[0],u=(yield this.room.localParticipant.publishTrack(o,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,h={protocol:t,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},f=setInterval(()=>X(this,void 0,void 0,function*(){const m=yield u.getRTCStatsReport();m?.forEach(g=>{g.type==="outbound-rtp"?(h.packetsSent=g.packetsSent,h.qualityLimitationDurations=g.qualityLimitationDurations,h.bitrateTotal+=g.targetBitrate,h.count++):g.type==="remote-inbound-rtp"&&(h.packetsLost=g.packetsLost,h.rttTotal+=g.roundTripTime,h.jitterTotal+=g.jitter)})}),1e3);return yield new Promise(m=>setTimeout(m,wy)),clearInterval(f),o.stop(),n.remove(),yield this.disconnect(),h})}}class k$ extends Uo{get description(){return"Can publish audio"}perform(){return X(this,void 0,void 0,function*(){var t;const n=yield this.connect(),i=yield xP();if(yield oP(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,3e3));const r=yield(t=i.sender)===null||t===void 0?void 0:t.getStats();if(!r)throw new Error("Could not get RTCStats");let a=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="audio"||!o.kind&&o.mediaType==="audio")&&(a=o.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class T$ extends Uo{get description(){return"Can publish video"}perform(){return X(this,void 0,void 0,function*(){var t;const n=yield this.connect(),i=yield v$();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,5e3));const s=yield(t=i.sender)===null||t===void 0?void 0:t.getStats();if(!s)throw new Error("Could not get RTCStats");let r=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="video"||!a.kind&&a.mediaType==="video")&&(r+=a.packetsSent)}),r===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," video packets"))})}checkForVideo(t){return X(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(t.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(s=>{i.onplay=()=>{setTimeout(()=>{var r,a,o,l;const u=document.createElement("canvas"),h=t.getSettings(),f=(a=(r=h.width)!==null&&r!==void 0?r:i.videoWidth)!==null&&a!==void 0?a:1280,m=(l=(o=h.height)!==null&&o!==void 0?o:i.videoHeight)!==null&&l!==void 0?l:720;u.width=f,u.height=m;const g=u.getContext("2d");g.drawImage(i,0,0);const S=g.getImageData(0,0,u.width,u.height).data;let v=!0;for(let _=0;_<S.length;_+=4)if(S[_]!==0||S[_+1]!==0||S[_+2]!==0){v=!1;break}v?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),s()},1e3)},i.play()}),n.getTracks().forEach(s=>s.stop()),i.remove()})}}class E$ extends Uo{get description(){return"Resuming connection after interruption"}perform(){return X(this,void 0,void 0,function*(){var t;const n=yield this.connect();let i=!1,s=!1,r;const a=new Promise(u=>{setTimeout(u,5e3),r=u}),o=()=>{i=!0};n.on(ye.SignalReconnecting,o).on(ye.Reconnecting,o).on(ye.Reconnected,()=>{s=!0,r(!0)}),(t=n.engine.client.ws)===null||t===void 0||t.close();const l=n.engine.client.onClose;if(l&&l(""),yield a,i){if(!s||n.state!==wt.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class R$ extends Uo{get description(){return"Can connect via TURN"}perform(){return X(this,void 0,void 0,function*(){var t,n,i;xc(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(t=yield new bt(this.url,this.token).getNextBestRegionUrl())!==null&&t!==void 0?t:this.url);const s=new QS,r=yield s.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let a=!1,o=!1,l=!1;for(let u of r.iceServers)for(let h of u.urls)h.startsWith("turn:")?(o=!0,l=!0):h.startsWith("turns:")&&(o=!0,l=!0,a=!0),h.startsWith("stun:")&&(l=!0);l?o&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield s.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(u=>setTimeout(u,0)))})}}class A$ extends Uo{get description(){return"Establishing WebRTC connection"}perform(){return X(this,void 0,void 0,function*(){let t=!1,n=!1;this.room.on(ye.SignalConnected,()=>{var i;const s=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,a)=>{if(r.candidate){const o=new RTCIceCandidate(r);let l="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(M$(o.address)?l+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(t=!0,l+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(l)}s&&s(r,a)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),it.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}t||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function M$(e){const t=e.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const n=parseInt(t[1],10);if(n>=16&&n<=31)return!0}}return!1}class L$ extends Uo{get description(){return"Connecting to signal connection via WebSocket"}perform(){return X(this,void 0,void 0,function*(){var t,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let s=new QS,r;try{r=yield s.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(a){if(xc(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(a.message,". Retrying with region fallback"));const l=yield new bt(this.url,this.token).getNextBestRegionUrl();l&&(r=yield s.join(l,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}r?(this.appendMessage("Connected to server, version ".concat(r.serverVersion,".")),((t=r.serverInfo)===null||t===void 0?void 0:t.edition)===oI.Cloud&&(!((n=r.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=r.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield s.close()})}}class ipe extends Zs.EventEmitter{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=n,this.options=i}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:fs.IDLE,name:"",description:""}),t}updateCheck(t,n){this.checkResults.set(t,n),this.emit("checkUpdate",t,n)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==fs.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return X(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new t(this.url,this.token,this.options),s=a=>{this.updateCheck(n,a)};i.on("update",s);const r=yield i.run();return i.off("update",s),r})}checkWebsocket(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(L$)})}checkWebRTC(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(A$)})}checkTURN(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(R$)})}checkReconnect(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(E$)})}checkPublishAudio(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(k$)})}checkPublishVideo(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(T$)})}checkConnectionProtocol(){return X(this,void 0,void 0,function*(){const t=yield this.createAndRunCheck(w$);if(t.data&&"protocol"in t.data){const n=t.data;this.options.protocol=n.protocol}return t})}checkCloudRegion(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(x$)})}}function ft(e,t,n){return(t=P$(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I$(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function P$(e){var t=I$(e,"string");return typeof t=="symbol"?t:t+""}new TextEncoder;new TextDecoder;class si extends Error{constructor(t,n){var i;super(t,n),ft(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}ft(si,"code","ERR_JOSE_GENERIC");class D$ extends si{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:i,reason:s,payload:n}}),ft(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),ft(this,"claim",void 0),ft(this,"reason",void 0),ft(this,"payload",void 0),this.claim=i,this.reason=s,this.payload=n}}ft(D$,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class O$ extends si{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:i,reason:s,payload:n}}),ft(this,"code","ERR_JWT_EXPIRED"),ft(this,"claim",void 0),ft(this,"reason",void 0),ft(this,"payload",void 0),this.claim=i,this.reason=s,this.payload=n}}ft(O$,"code","ERR_JWT_EXPIRED");class N$ extends si{constructor(){super(...arguments),ft(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}ft(N$,"code","ERR_JOSE_ALG_NOT_ALLOWED");class j$ extends si{constructor(){super(...arguments),ft(this,"code","ERR_JOSE_NOT_SUPPORTED")}}ft(j$,"code","ERR_JOSE_NOT_SUPPORTED");class B$ extends si{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(t,n),ft(this,"code","ERR_JWE_DECRYPTION_FAILED")}}ft(B$,"code","ERR_JWE_DECRYPTION_FAILED");class F$ extends si{constructor(){super(...arguments),ft(this,"code","ERR_JWE_INVALID")}}ft(F$,"code","ERR_JWE_INVALID");class U$ extends si{constructor(){super(...arguments),ft(this,"code","ERR_JWS_INVALID")}}ft(U$,"code","ERR_JWS_INVALID");class z$ extends si{constructor(){super(...arguments),ft(this,"code","ERR_JWT_INVALID")}}ft(z$,"code","ERR_JWT_INVALID");class H$ extends si{constructor(){super(...arguments),ft(this,"code","ERR_JWK_INVALID")}}ft(H$,"code","ERR_JWK_INVALID");class $$ extends si{constructor(){super(...arguments),ft(this,"code","ERR_JWKS_INVALID")}}ft($$,"code","ERR_JWKS_INVALID");class q$ extends si{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(t,n),ft(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}ft(q$,"code","ERR_JWKS_NO_MATCHING_KEY");class V$ extends si{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(t,n),ft(this,Symbol.asyncIterator,void 0),ft(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}ft(V$,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class W$ extends si{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(t,n),ft(this,"code","ERR_JWKS_TIMEOUT")}}ft(W$,"code","ERR_JWKS_TIMEOUT");class G$ extends si{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(t,n),ft(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}ft(G$,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function Or(){return Or=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Or.apply(null,arguments)}const wR=new Uint8Array(0);let Nd=class{static getFullOptions(t){return Or({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},t)}constructor(t,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(s){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(s))},this.onMessage=async function(s){switch(s.type){case"interruption":return void i.handleInterruption(s);case"agent_response":return void i.handleAgentResponse(s);case"user_transcript":return void i.handleUserTranscript(s);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(s);case"client_tool_call":try{await i.handleClientToolCall(s)}catch(r){i.onError(`Unexpected error in client tool call handling: ${r instanceof Error?r.message:String(r)}`,{clientToolName:s.client_tool_call.tool_name,toolCallId:s.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(s);case"vad_score":return void i.handleVadScore(s);case"ping":return void i.connection.sendMessage({type:"pong",event_id:s.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(s);case"mcp_connection_status":return void i.handleMCPConnectionStatus(s);case"agent_tool_request":return void i.handleAgentToolRequest(s);case"agent_tool_response":return void i.handleAgentToolResponse(s);case"conversation_initiation_metadata":return void i.handleConversationMetadata(s);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(s);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(s);case"error":return void i.handleErrorEvent(s);default:return void(i.options.onDebug&&i.options.onDebug(s))}},this.setVolume=({volume:s})=>{this.volume=s},this.options=t,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(s=>this.updateMode(s)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(t){t!==this.mode&&(this.mode=t,this.options.onModeChange&&this.options.onModeChange({mode:t}))}updateStatus(t){t!==this.status&&(this.status=t,this.options.onStatusChange&&this.options.onStatusChange({status:t}))}updateCanSendFeedback(){const t=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==t&&(this.canSendFeedback=t,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:t}))}handleInterruption(t){t.interruption_event&&(this.lastInterruptTimestamp=t.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:t.interruption_event.event_id}))}handleAgentResponse(t){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:t.agent_response_event.agent_response})}handleUserTranscript(t){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:t.user_transcription_event.user_transcript})}handleTentativeAgentResponse(t){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:t.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(t){this.options.onVadScore&&this.options.onVadScore({vadScore:t.vad_score_event.vad_score})}async handleClientToolCall(t){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,t.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[t.client_tool_call.tool_name](t.client_tool_call.parameters))!=null?n:"Client tool execution successful.",s=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:s,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i?.message}`,{clientToolName:t.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i?.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(t.client_tool_call);this.onError(`Client tool with name ${t.client_tool_call.tool_name} is not defined on client`,{clientToolName:t.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:`Client tool with name ${t.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(t){}handleMCPToolCall(t){this.options.onMCPToolCall&&this.options.onMCPToolCall(t.mcp_tool_call)}handleMCPConnectionStatus(t){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(t.mcp_connection_status)}handleAgentToolRequest(t){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(t.agent_tool_request)}handleAgentToolResponse(t){t.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(t.agent_tool_response)}handleConversationMetadata(t){this.options.onConversationMetadata&&this.options.onConversationMetadata(t.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(t){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(t.asr_initiation_metadata_event)}handleAgentChatResponsePart(t){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(t.text_response_part)}handleErrorEvent(t){const n=t.error_event.error_type,i=t.error_event.message||t.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:t.error_event.code,debugMessage:t.error_event.debug_message,details:t.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(t,n){console.error(t,n),this.options.onError&&this.options.onError(t,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(t){this.connection.setMicMuted(t)}getInputByteFrequencyData(){return wR}getOutputByteFrequencyData(){return wR}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(t){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:t?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(t){this.connection.sendMessage({type:"contextual_update",text:t})}sendUserMessage(t){this.connection.sendMessage({type:"user_message",text:t})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(t,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:t,is_approved:n})}},TP=class{constructor(t={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=t.onDebug}debug(t){this.onDebug&&this.onDebug(t)}onMessage(t){this.onMessageCallback=t;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(t)})}onDisconnect(t){this.onDisconnectCallback=t;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{t(n)})}onModeChange(t){this.onModeChangeCallback=t}updateMode(t){var n;(n=this.onModeChangeCallback)==null||n.call(this,t)}disconnect(t){var n;this.disconnectionDetails||(this.disconnectionDetails=t,(n=this.onDisconnectCallback)==null||n.call(this,t))}handleMessage(t){this.onMessageCallback?this.onMessageCallback(t):this.queue.push(t)}};function cm(e){const[t,n]=e.split("_");if(!["pcm","ulaw"].includes(t))throw new Error(`Invalid format: ${e}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:t,sampleRate:i}}const EP="0.13.1";function b0(e){return!!e.type}const RP="conversation_initiation_client_data";function AP(e){var t;const n={type:RP};var i,s,r,a,o,l,u,h;return e.overrides&&(n.conversation_config_override={agent:{prompt:(i=e.overrides.agent)==null?void 0:i.prompt,first_message:(s=e.overrides.agent)==null?void 0:s.firstMessage,language:(r=e.overrides.agent)==null?void 0:r.language},tts:{voice_id:(a=e.overrides.tts)==null?void 0:a.voiceId,speed:(o=e.overrides.tts)==null?void 0:o.speed,stability:(l=e.overrides.tts)==null?void 0:l.stability,similarity_boost:(u=e.overrides.tts)==null?void 0:u.similarityBoost},conversation:{text_only:(h=e.overrides.conversation)==null?void 0:h.textOnly}}),e.customLlmExtraBody&&(n.custom_llm_extra_body=e.customLlmExtraBody),e.dynamicVariables&&(n.dynamic_variables=e.dynamicVariables),e.userId&&(n.user_id=e.userId),(t=e.overrides)!=null&&t.client&&(n.source_info={source:e.overrides.client.source,version:e.overrides.client.version}),n}let kR=class extends Error{constructor(t,n){super(t),this.closeCode=void 0,this.closeReason=void 0,this.name="SessionConnectionError",this.closeCode=n?.closeCode,this.closeReason=n?.closeReason}},y0=class MP extends TP{constructor(t,n,i,s){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=t,this.conversationId=n,this.inputFormat=i,this.outputFormat=s,this.socket.addEventListener("error",r=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:r}),0)}),this.socket.addEventListener("close",r=>{this.disconnect(r.code===1e3?{reason:"agent",context:r,closeCode:r.code,closeReason:r.reason||void 0}:{reason:"error",message:r.reason||"The connection was closed by the server.",context:r,closeCode:r.code,closeReason:r.reason||void 0})}),this.socket.addEventListener("message",r=>{try{const a=JSON.parse(r.data);if(!b0(a))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:r.data});this.handleMessage(a)}catch(a){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:a instanceof Error?a.message:String(a),data:r.data})}})}static async create(t){let n=null;try{var i,s,r;const o=(i=t.origin)!=null?i:"wss://api.elevenlabs.io";let l;const u=((s=t.overrides)==null||(s=s.client)==null?void 0:s.version)||EP,h=((r=t.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk";if(t.signedUrl){const w=t.signedUrl.includes("?")?"&":"?";l=`${t.signedUrl}${w}source=${h}&version=${u}`}else l=`${o}/v1/convai/conversation?agent_id=${t.agentId}&source=${h}&version=${u}`;const f=["convai"];t.authorization&&f.push(`bearer.${t.authorization}`),n=new WebSocket(l,f);const m=await new Promise((w,x)=>{n.addEventListener("open",()=>{var k;const A=AP(t);(k=n)==null||k.send(JSON.stringify(A))},{once:!0}),n.addEventListener("error",k=>{setTimeout(()=>x(new kR("The connection was closed due to a socket error.")),0)}),n.addEventListener("close",k=>{x(new kR(k.reason||(k.code===1e3?"Connection closed normally before session could be established.":"Connection closed unexpectedly before session could be established."),{closeCode:k.code,closeReason:k.reason||void 0}))}),n.addEventListener("message",k=>{const A=JSON.parse(k.data);b0(A)&&(A.type==="conversation_initiation_metadata"?w(A.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:g,agent_output_audio_format:C,user_input_audio_format:S}=m,v=cm(S??"pcm_16000"),_=cm(C);return new MP(n,g,v,_)}catch(o){var a;throw(a=n)==null||a.close(),o}}close(){this.socket.close(1e3,"User ended conversation")}sendMessage(t){this.socket.send(JSON.stringify(t))}async setMicMuted(t){console.warn(`WebSocket connection setMicMuted called with ${t}, but this is handled by VoiceConversation`)}};function LP(e){const t=new Uint8Array(e);return window.btoa(String.fromCharCode(...t))}function K$(e){const t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let s=0;s<n;s++)i[s]=t.charCodeAt(s);return i.buffer}const jf=new Map;function IP(e,t){return async(n,i)=>{const s=jf.get(e);if(s)return n.addModule(s);if(i)try{return await n.addModule(i),void jf.set(e,i)}catch(o){throw new Error(`Failed to load the ${e} worklet module from path: ${i}. Error: ${o}`)}const r=new Blob([t],{type:"application/javascript"}),a=URL.createObjectURL(r);try{return await n.addModule(a),void jf.set(e,a)}catch{URL.revokeObjectURL(a)}try{const o=`data:application/javascript;base64,${btoa(t)}`;await n.addModule(o),jf.set(e,o)}catch{throw new Error(`Failed to load the ${e} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const PP=IP("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);let Sa=class DP extends TP{constructor(t,n,i,s,r={}){super(r),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=t,this.conversationId=n,this.inputFormat=i,this.outputFormat=s,this.setupRoomEventListeners()}static async create(t){let n;if("conversationToken"in t&&t.conversationToken)n=t.conversationToken;else{if(!("agentId"in t)||!t.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,s,r;const u=((i=t.overrides)==null||(i=i.client)==null?void 0:i.version)||EP,h=((s=t.overrides)==null||(s=s.client)==null?void 0:s.source)||"js_sdk",f=`${a=(r=t.origin)!=null?r:"https://api.elevenlabs.io",a.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${t.agentId}&source=${h}&version=${u}`,m=await fetch(f);if(!m.ok)throw new Error(`ElevenLabs API returned ${m.status} ${m.statusText}`);if(n=(await m.json()).token,!n)throw new Error("No conversation token received from API")}catch(u){let h=u instanceof Error?u.message:String(u);throw u instanceof Error&&u.message.includes("401")&&(h="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${t.agentId}: ${h}`)}}var a;const o=new wc;try{const u=`room_${Date.now()}`,h=cm("pcm_48000"),f=cm("pcm_48000"),m=new DP(o,u,h,f,t),g=t.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var l;await o.connect(g,n),await new Promise(S=>{if(m.isConnected)S();else{const v=()=>{o.off(ye.Connected,v),S()};o.on(ye.Connected,v)}}),o.name&&(m.conversationId=((l=o.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:l[0])||o.name),t.textOnly||await o.localParticipant.setMicrophoneEnabled(!0);const C=AP(t);return m.debug({type:RP,message:C}),await m.sendMessage(C),m}catch(u){throw await o.disconnect(),u}}setupRoomEventListeners(){var t=this;this.room.on(ye.Connected,async function(){t.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(ye.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n?.toString()})})}),this.room.on(ye.ConnectionStateChanged,n=>{n===wt.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(ye.DataReceived,(n,i)=>{try{const s=JSON.parse(new TextDecoder().decode(n));if(s.type==="audio")return;b0(s)?this.handleMessage(s):console.warn("Invalid socket event received:",s)}catch(s){console.warn("Failed to parse incoming data message:",s),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(ye.TrackSubscribed,async function(n,i,s){if(n.kind===ve.Kind.Audio&&s.identity.includes("agent")){const r=n,a=r.attach();if(a.autoplay=!0,a.controls=!1,t.outputDeviceId&&a.setSinkId)try{await a.setSinkId(t.outputDeviceId)}catch(o){console.warn("Failed to set output device for new audio element:",o)}a.style.display="none",document.body.appendChild(a),t.audioElements.push(a),t.audioElements.length===1&&(t.onDebug==null||t.onDebug({type:"audio_element_ready"})),await t.setupAudioCapture(r)}}),this.room.on(ye.ActiveSpeakersChanged,async function(n){t.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(ye.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(t=>{t.track&&t.track.stop()})}catch(t){console.warn("Error stopping local tracks:",t)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(t=>{console.warn("Error closing audio capture context:",t)}),this.audioCaptureContext=null),this.audioElements.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(t){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in t))try{const n=new TextEncoder().encode(JSON.stringify(t));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:t,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(t){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(ve.Source.Microphone);if(n!=null&&n.track)try{t?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!t)}else await this.room.localParticipant.setMicrophoneEnabled(!t)}async setupAudioCapture(t){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([t.mediaStreamTrack]),s=n.createMediaStreamSource(i);s.connect(this.outputAnalyser),await PP(n.audioWorklet);const r=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(r),r.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),r.port.onmessage=a=>{const[o,l]=a.data;if(l>.01){const u=LP(o.buffer),h=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:u,event_id:h}})}},s.connect(r)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(t){this.audioElements.forEach(n=>{n.volume=t})}async setAudioOutputDevice(t){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(t)}catch(s){throw console.error("Failed to set sink ID for audio element:",s),s}});await Promise.all(n),this.outputDeviceId=t}async setAudioInputDevice(t){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(ve.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:t},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},s=await xP(i);await this.room.localParticipant.publishTrack(s,{name:"microphone",source:ve.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}};async function OP(e){const t=(function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"})(e);switch(t){case"websocket":return y0.create(e);case"webrtc":return Sa.create(e);default:throw new Error(`Unknown connection type: ${t}`)}}function _0(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function NP(e={default:0,android:3e3}){let t=e.default;var n;if(/android/i.test(navigator.userAgent))t=(n=e.android)!=null?n:t;else if(_0()){var i;t=(i=e.ios)!=null?i:t}t>0&&await new Promise(s=>setTimeout(s,t))}let Y$=class jP extends Nd{static async startSession(t){const n=Nd.getFullOptions(t);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await NP(n.connectionDelay),i=await OP(t),new jP(n,i)}catch(r){var s;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(s=i)==null||s.close(),r}}};const TR={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};let ER=class Ap{static async create({sampleRate:t,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:s,workletPaths:r,libsampleratePath:a,onError:o}){let l=null,u=null;try{const m=Or({sampleRate:{ideal:t}},TR);if(_0()&&i){const x=(await window.navigator.mediaDevices.enumerateDevices()).find(k=>k.kind==="audioinput"&&["airpod","headphone","earphone"].find(A=>k.label.toLowerCase().includes(A)));x&&(m.deviceId={ideal:x.deviceId})}s&&(m.deviceId=Ap.getDeviceIdConstraint(s));const g=navigator.mediaDevices.getSupportedConstraints().sampleRate;l=new window.AudioContext(g?{sampleRate:t}:{});const C=l.createAnalyser();if(!g){const x=a||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await l.audioWorklet.addModule(x)}await PP(l.audioWorklet,r?.rawAudioProcessor);const S=Or({voiceIsolation:!0},m);u=await navigator.mediaDevices.getUserMedia({audio:S});const v=l.createMediaStreamSource(u),_=new AudioWorkletNode(l,"rawAudioProcessor");_.port.postMessage({type:"setFormat",format:n,sampleRate:t}),v.connect(C),C.connect(_),await l.resume();const w=await navigator.permissions.query({name:"microphone"});return new Ap(l,C,_,u,v,w,o)}catch(m){var h,f;throw(h=u)==null||h.getTracks().forEach(g=>{g.stop()}),(f=l)==null||f.close(),m}}static getDeviceIdConstraint(t){if(t)return _0()?{ideal:t}:{exact:t}}constructor(t,n,i,s,r,a,o=console.error){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.permissions=void 0,this.onError=void 0,this.settingInput=!1,this.handlePermissionsChange=()=>{if(this.permissions.state==="denied")this.onError("Microphone permission denied");else if(!this.settingInput){var l;const[u]=this.inputStream.getAudioTracks(),{deviceId:h}=(l=u?.getSettings())!=null?l:{};this.setInputDevice(h).catch(f=>{this.onError("Failed to reset input device after permission change:",f)})}},this.context=t,this.analyser=n,this.worklet=i,this.inputStream=s,this.mediaStreamSource=r,this.permissions=a,this.onError=o,this.permissions.addEventListener("change",this.handlePermissionsChange)}forgetInputStreamAndSource(){for(const t of this.inputStream.getTracks())t.stop();this.mediaStreamSource.disconnect()}async close(){this.forgetInputStreamAndSource(),this.permissions.removeEventListener("change",this.handlePermissionsChange),await this.context.close()}setMuted(t){this.worklet.port.postMessage({type:"setMuted",isMuted:t})}async setInputDevice(t){try{if(this.settingInput)throw new Error("Input device is already being set");this.settingInput=!0;const n=Or({},TR);t&&(n.deviceId=Ap.getDeviceIdConstraint(t));const i=Or({voiceIsolation:!0},n),s=await navigator.mediaDevices.getUserMedia({audio:i});this.forgetInputStreamAndSource(),this.inputStream=s,this.mediaStreamSource=this.context.createMediaStreamSource(s),this.mediaStreamSource.connect(this.analyser)}catch(n){throw this.onError("Failed to switch input device:",n),n}finally{this.settingInput=!1}}};const Q$=IP("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);let RR=class BP{static async create({sampleRate:t,format:n,outputDeviceId:i,workletPaths:s}){let r=null,a=null;try{r=new AudioContext({sampleRate:t});const u=r.createAnalyser(),h=r.createGain();a=new Audio,a.src="",a.load(),a.autoplay=!0,a.style.display="none",document.body.appendChild(a);const f=r.createMediaStreamDestination();a.srcObject=f.stream,h.connect(u),u.connect(f),await Q$(r.audioWorklet,s?.audioConcatProcessor);const m=new AudioWorkletNode(r,"audioConcatProcessor");return m.port.postMessage({type:"setFormat",format:n}),m.connect(h),await r.resume(),i&&a.setSinkId&&await a.setSinkId(i),new BP(r,u,h,m,a)}catch(u){var o,l;throw(o=a)!=null&&o.parentNode&&a.parentNode.removeChild(a),(l=a)==null||l.pause(),r&&r.state!=="closed"&&await r.close(),u}}constructor(t,n,i,s,r){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=t,this.analyser=n,this.gain=i,this.worklet=s,this.audioElement=r}async setOutputDevice(t){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(t||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}},J$=class Mp extends Nd{static async requestWakeLock(){if("wakeLock"in navigator)try{return await navigator.wakeLock.request("screen")}catch{}return null}static async startSession(t){var n;const i=Nd.getFullOptions(t);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let s=null,r=null,a=null,o=null,l=null;((n=t.useWakeLock)==null||n)&&(l=await Mp.requestWakeLock());try{var u;return o=await navigator.mediaDevices.getUserMedia({audio:!0}),await NP(i.connectionDelay),r=await OP(t),[s,a]=await Promise.all([ER.create(Or({},r.inputFormat,{preferHeadphonesForIosDevices:t.preferHeadphonesForIosDevices,inputDeviceId:t.inputDeviceId,workletPaths:t.workletPaths,libsampleratePath:t.libsampleratePath})),RR.create(Or({},r.outputFormat,{outputDeviceId:t.outputDeviceId,workletPaths:t.workletPaths}))]),(u=o)==null||u.getTracks().forEach(S=>{S.stop()}),o=null,new Mp(i,r,s,a,l)}catch(S){var h,f,m,g;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(h=o)==null||h.getTracks().forEach(v=>{v.stop()}),(f=r)==null||f.close(),await((m=s)==null?void 0:m.close()),await((g=a)==null?void 0:g.close());try{var C;await((C=l)==null?void 0:C.release()),l=null}catch{}throw S}}constructor(t,n,i,s,r){super(t,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.visibilityChangeHandler=null,this.onInputWorkletMessage=a=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:LP(a.data[0].buffer)})},this.onOutputWorkletMessage=({data:a})=>{a.type==="process"&&this.updateMode(a.finished?"listening":"speaking")},this.addAudioBase64Chunk=a=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:K$(a)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=a=>{if(a.length===0)return 0;let o=0;for(let l=0;l<a.length;l++)o+=a[l]/255;return o/=a.length,o<0?0:o>1?1:o},this.setVolume=({volume:a})=>{const o=Number.isFinite(a)?Math.min(1,Math.max(0,a)):1;this.volume=o,this.connection instanceof Sa?this.connection.setAudioVolume(o):this.output.gain.gain.value=o},this.input=i,this.output=s,this.wakeLock=r,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage,r&&(this.visibilityChangeHandler=()=>{var a;document.visibilityState==="visible"&&(a=this.wakeLock)!=null&&a.released&&Mp.requestWakeLock().then(o=>{this.wakeLock=o})},document.addEventListener("visibilitychange",this.visibilityChangeHandler))}async handleEndSession(){await super.handleEndSession(),this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler);try{var t;await((t=this.wakeLock)==null?void 0:t.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(t){super.handleInterruption(t),this.fadeOutAudio()}handleAudio(t){var n,i;super.handleAudio(t),t.audio_event.alignment&&this.options.onAudioAlignment&&this.options.onAudioAlignment(t.audio_event.alignment),this.lastInterruptTimestamp<=t.audio_event.event_id&&(t.audio_event.audio_base_64&&((n=(i=this.options).onAudio)==null||n.call(i,t.audio_event.audio_base_64),this.connection instanceof Sa||this.addAudioBase64Chunk(t.audio_event.audio_base_64)),this.currentEventId=t.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(t){this.connection instanceof Sa?this.connection.setMicMuted(t):this.input.setMuted(t)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof Sa?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:t,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:s}){try{if(this.connection instanceof y0)try{return await this.input.setInputDevice(s),this.input}catch(a){console.warn("Failed to change device on existing input, recreating:",a)}this.connection instanceof Sa&&await this.connection.setAudioInputDevice(s||""),await this.input.close();const r=await ER.create({sampleRate:t??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:s,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath,onError:this.options.onError});return this.input=r,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(r){throw console.error("Error changing input device",r),r}}async changeOutputDevice({sampleRate:t,format:n,outputDeviceId:i}){try{if(this.connection instanceof y0)try{return await this.output.setOutputDevice(i),this.output}catch(r){console.warn("Failed to change device on existing output, recreating:",r)}this.connection instanceof Sa&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const s=await RR.create({sampleRate:t??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=s,this.output}catch(s){throw console.error("Error changing output device",s),s}}};var AR;(function(e){e.SESSION_STARTED="session_started",e.PARTIAL_TRANSCRIPT="partial_transcript",e.COMMITTED_TRANSCRIPT="committed_transcript",e.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",e.AUTH_ERROR="auth_error",e.ERROR="error",e.OPEN="open",e.CLOSE="close",e.QUOTA_EXCEEDED="quota_exceeded",e.COMMIT_THROTTLED="commit_throttled",e.TRANSCRIBER_ERROR="transcriber_error",e.UNACCEPTED_TERMS="unaccepted_terms",e.RATE_LIMITED="rate_limited",e.INPUT_ERROR="input_error",e.QUEUE_OVERFLOW="queue_overflow",e.RESOURCE_EXHAUSTED="resource_exhausted",e.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",e.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",e.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(AR||(AR={}));var MR,LR;(function(e){e.PCM_8000="pcm_8000",e.PCM_16000="pcm_16000",e.PCM_22050="pcm_22050",e.PCM_24000="pcm_24000",e.PCM_44100="pcm_44100",e.PCM_48000="pcm_48000",e.ULAW_8000="ulaw_8000"})(MR||(MR={})),(function(e){e.MANUAL="manual",e.VAD="vad"})(LR||(LR={}));let X$=class extends Nd{static startSession(t){return t.textOnly?Y$.startSession(t):J$.startSession(t)}};function cd(){return cd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},cd.apply(null,arguments)}const Z$=["micMuted","volume","serverLocation"];function e9(e="us"){switch(e){case"eu-residency":case"in-residency":case"us":case"global":return e;default:return console.warn(`[ConversationalAI] Invalid server-location: ${e}. Defaulting to "us"`),"us"}}function t9(e){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[e]}function n9(e){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[e]}function i9(e={}){const{micMuted:t,volume:n,serverLocation:i}=e,s=(function(v,_){if(v==null)return{};var w={};for(var x in v)if({}.hasOwnProperty.call(v,x)){if(_.indexOf(x)!==-1)continue;w[x]=v[x]}return w})(e,Z$),r=P.useRef(null),a=P.useRef(null),o=P.useRef(!1),[l,u]=P.useState("disconnected"),[h,f]=P.useState(!1),[m,g]=P.useState("listening"),C=P.useRef(t),S=P.useRef(n);return C.current=t,S.current=n,P.useEffect(()=>{var v;t!==void 0&&(r==null||(v=r.current)==null||v.setMicMuted(t))},[t]),P.useEffect(()=>{var v;n!==void 0&&(r==null||(v=r.current)==null||v.setVolume({volume:n}))},[n]),P.useEffect(()=>()=>{var v;o.current=!0,a.current?a.current.then(_=>_.endSession()):(v=r.current)==null||v.endSession()},[]),{startSession:async v=>{var _;if((_=r.current)!=null&&_.isOpen())return r.current.getId();if(a.current)return(await a.current).getId();o.current=!1;try{var w,x,k,A,T,M,E,L,D,O;const j=e9(v?.serverLocation||i),U=t9(j),q=n9(j);if(a.current=X$.startSession(cd({},s??{},v??{},{origin:U,livekitUrl:v?.livekitUrl||s?.livekitUrl||q,overrides:cd({},(w=s?.overrides)!=null?w:{},(x=v?.overrides)!=null?x:{},{client:cd({},(k=s==null||(A=s.overrides)==null?void 0:A.client)!=null?k:{},(T=v==null||(M=v.overrides)==null?void 0:M.client)!=null?T:{},{source:(v==null||(E=v.overrides)==null||(E=E.client)==null?void 0:E.source)||(s==null||(L=s.overrides)==null||(L=L.client)==null?void 0:L.source)||"react_sdk",version:(v==null||(D=v.overrides)==null||(D=D.client)==null?void 0:D.version)||(s==null||(O=s.overrides)==null||(O=O.client)==null?void 0:O.version)||"0.13.1"})}),onConnect:v?.onConnect||s?.onConnect,onDisconnect:v?.onDisconnect||s?.onDisconnect,onError:v?.onError||s?.onError,onMessage:v?.onMessage||s?.onMessage,onAudio:v?.onAudio||s?.onAudio,onDebug:v?.onDebug||s?.onDebug,onUnhandledClientToolCall:v?.onUnhandledClientToolCall||s?.onUnhandledClientToolCall,onVadScore:v?.onVadScore||s?.onVadScore,onInterruption:v?.onInterruption||s?.onInterruption,onAgentToolRequest:v?.onAgentToolRequest||s?.onAgentToolRequest,onAgentToolResponse:v?.onAgentToolResponse||s?.onAgentToolResponse,onConversationMetadata:v?.onConversationMetadata||s?.onConversationMetadata,onMCPToolCall:v?.onMCPToolCall||s?.onMCPToolCall,onMCPConnectionStatus:v?.onMCPConnectionStatus||s?.onMCPConnectionStatus,onAsrInitiationMetadata:v?.onAsrInitiationMetadata||s?.onAsrInitiationMetadata,onAgentChatResponsePart:v?.onAgentChatResponsePart||s?.onAgentChatResponsePart,onAudioAlignment:v?.onAudioAlignment||s?.onAudioAlignment,onModeChange:({mode:K})=>{var $;g(K),($=v?.onModeChange||s?.onModeChange)==null||$({mode:K})},onStatusChange:({status:K})=>{var $;u(K),($=v?.onStatusChange||s?.onStatusChange)==null||$({status:K})},onCanSendFeedbackChange:({canSendFeedback:K})=>{var $;f(K),($=v?.onCanSendFeedbackChange||s?.onCanSendFeedbackChange)==null||$({canSendFeedback:K})}})),r.current=await a.current,o.current)throw await r.current.endSession(),r.current=null,a.current=null,new Error("Session cancelled during connection");return C.current!==void 0&&r.current.setMicMuted(C.current),S.current!==void 0&&r.current.setVolume({volume:S.current}),r.current.getId()}finally{a.current=null}},endSession:async()=>{o.current=!0;const v=a.current,_=r.current;r.current=null,v?await(await v).endSession():await _?.endSession()},setVolume:({volume:v})=>{var _;(_=r.current)==null||_.setVolume({volume:v})},getInputByteFrequencyData:()=>{var v;return(v=r.current)==null?void 0:v.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var v;return(v=r.current)==null?void 0:v.getOutputByteFrequencyData()},getInputVolume:()=>{var v,_;return(v=(_=r.current)==null?void 0:_.getInputVolume())!=null?v:0},getOutputVolume:()=>{var v,_;return(v=(_=r.current)==null?void 0:_.getOutputVolume())!=null?v:0},sendFeedback:v=>{var _;(_=r.current)==null||_.sendFeedback(v)},getId:()=>{var v;return(v=r.current)==null?void 0:v.getId()},sendContextualUpdate:v=>{var _;(_=r.current)==null||_.sendContextualUpdate(v)},sendUserMessage:v=>{var _;(_=r.current)==null||_.sendUserMessage(v)},sendUserActivity:()=>{var v;(v=r.current)==null||v.sendUserActivity()},sendMCPToolApprovalResult:(v,_)=>{var w;(w=r.current)==null||w.sendMCPToolApprovalResult(v,_)},changeInputDevice:async v=>{if(r.current&&"changeInputDevice"in r.current)return await r.current.changeInputDevice(v);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async v=>{if(r.current&&"changeOutputDevice"in r.current)return await r.current.changeOutputDevice(v);throw new Error("Device switching is only available for voice conversations")},status:l,canSendFeedback:h,micMuted:t,isSpeaking:m==="speaking"}}async function s9(e,t){try{return await e.fetchVoiceToken(t)}catch(n){return{allowed:!1,error:n instanceof Error?n.message:"Network error"}}}const r9=!1;let js=null,Er=null;class o9{constructor(t){this.api=t}async startSession(t){if(!js){const s=new Error("Realtime voice session not initialized");throw console.warn("[Voice] Realtime voice session not initialized"),Er?.("error","Voice session not initialized"),s}Er?.("connecting");let n=null;try{n=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(s){throw console.error("[Voice] Failed to get microphone permission:",s),Er?.("error","Microphone permission denied"),s}finally{n?.getTracks().forEach(s=>s.stop())}let i;try{i=await s9(this.api)}catch(s){throw console.error("[Voice] Failed to fetch voice token:",s),Er?.("error","Network error"),s}if(!i.allowed||!i.token){const s=new Error(i.error??"Voice not allowed or no token");throw console.error("[Voice] Voice not allowed or no token:",i.error),Er?.("error",i.error??"Voice not allowed"),s}try{const s=await js.startSession({conversationToken:i.token,connectionType:"webrtc",dynamicVariables:{sessionId:t.sessionId,initialConversationContext:t.initialContext||""},overrides:{agent:{language:t.language}}})}catch(s){throw console.error("[Voice] Failed to start realtime session:",s),Er?.("error","Failed to start voice session"),s}}async endSession(){if(js)try{await js.endSession(),Er?.("disconnected")}catch(t){console.error("[Voice] Failed to end realtime session:",t)}}sendTextMessage(t){if(!js){console.warn("[Voice] Realtime voice session not initialized");return}js.sendUserMessage(t)}sendContextualUpdate(t){if(!js){console.warn("[Voice] Realtime voice session not initialized");return}js.sendContextualUpdate(t)}}function a9({api:e,micMuted:t=!1,onStatusChange:n,getSession:i,sendMessage:s,approvePermission:r,denyPermission:a}){const o=P.useRef(!1),[l,u]=P.useState(t);P.useEffect(()=>{u(t)},[t]),P.useEffect(()=>(Er=n||null,()=>{Er=null}),[n]),P.useEffect(()=>{i&&s&&r&&a&&I2({getSession:w=>i(w),sendMessage:s,approvePermission:r,denyPermission:a})},[i,s,r,a]);const h=P.useCallback(()=>{n?.("connected")},[n]),f=P.useCallback(()=>{y8(),n?.("disconnected")},[n]),m=P.useCallback(w=>{const x=w instanceof Error?w.message:"Connection error";n?.("error",x)},[n]),g=P.useCallback(w=>{},[]),C=P.useCallback(w=>{},[]),S=P.useCallback(w=>{},[]),v=P.useCallback(w=>{},[]);P.useEffect(()=>{},[l]);const _=i9({clientTools:S8,micMuted:l,onConnect:h,onDisconnect:f,onMessage:g,onError:m,onStatusChange:C,onModeChange:S,onDebug:v});return P.useEffect(()=>{if(js=_,!o.current)try{_8(new o9(e)),o.current=!0}catch(w){console.error("[Voice] Failed to register voice session:",w)}return()=>{js=null}},[_,e]),null}function l9(e){return Array.isArray(e)}function c9(e){return e==="agent"||e==="assistant"?"assistant":e==="user"?"user":null}function u9(e){const t=v2(e.content);return t?{role:c9(t.role),content:t.content}:{role:null,content:e.content}}function d9(e){if(!Se(e)||e.type!=="output")return{roleOverride:null,content:e};const t=Se(e.data)?e.data:null;if(!t||typeof t.type!="string")return{roleOverride:null,content:e};const n=Se(t.message)?t.message:null;if(!n)return{roleOverride:null,content:e};const i=n.content;return typeof i>"u"?{roleOverride:null,content:e}:{roleOverride:t.type==="assistant"?"assistant":t.type==="user"?"user":null,content:i}}function ky(e,t){return e==="assistant"?`Claude Code: 
<text>${t}</text>`:`User sent message: 
<text>${t}</text>`}function h9(e,t,n,i){return`Claude Code is requesting permission to use ${n} (session ${e}):
<request_id>${t}</request_id>
<tool_name>${n}</tool_name>
<tool_args>${JSON.stringify(i)}</tool_args>`}function FP(e){const t=[],{role:n,content:i}=u9(e),{roleOverride:s,content:r}=d9(i),a=s??n;if(!l9(r))return typeof r=="string"?ky(a,r):Se(r)&&r.type==="text"&&typeof r.text=="string"?ky(a,r.text):null;const o=r.some(u=>u.type==="tool_use"),l=a==="assistant"?!0:a==="user"?!1:o||r.some(u=>u.type==="text"&&r.length!==1);for(const u of r)if(u.type==="text"&&u.text)t.push(ky(l?"assistant":"user",u.text));else if(u.type==="tool_use"){const h=u.name||"unknown";t.push(`Claude Code is using ${h}`)}return t.length===0?null:t.join(`

`)}function f9(e,t){const n=[...t].sort((i,s)=>(i.seq??0)-(s.seq??0)).map(FP).filter(Boolean);return n.length===0?null:"New messages in session: "+e+`

`+n.join(`

`)}function p9(e,t){const i=t.slice(-50).map(FP).filter(Boolean);return"History of messages in session: "+e+`

`+i.join(`

`)}function UP(e,t){if(!e)return"Session not available";const n=e.metadata?.summary?.text,i=e.metadata?.path,s=[];return s.push(`# Session ID: ${e.id}`),s.push(`# Project path: ${i}`),s.push(`# Session summary:
${n}`),e.metadata?.summary?.text&&(s.push("## Session Summary"),s.push(e.metadata.summary.text),s.push("")),s.push("## Our interaction history so far"),s.push(""),s.push(p9(e.id,t)),s.join(`

`)}function m9(e,t){return`Session became focused: ${e}`}function g9(e){return`Claude Code done working in session: ${e}. The previous message(s) are the summary of the work done. Report this to the human immediately.`}const ud=new Set;let Ty=null,sC=null,rC=null;function v9(e,t){sC=e,rC=t}function S0(e){if(!e)return;const t=L2();!t||!M2()||t.sendContextualUpdate(e)}function IR(e){if(!e)return;const t=L2();!t||!M2()||t.sendTextMessage(e)}function Bf(e){if(ud.has(e))return;ud.add(e);const t=sC?.(e)??null;if(!t)return;const n=rC?.(e)??[],i=UP(t,n);S0(i)}const dd={onSessionOnline(e,t){},onSessionOffline(e,t){},onSessionFocus(e,t){Ty!==e&&(Ty=e,Bf(e),S0(m9(e)))},onPermissionRequested(e,t,n,i){Bf(e),IR(h9(e,t,n,i))},onMessages(e,t){Bf(e),S0(f9(e,t))},onVoiceStarted(e){ud.clear();const t=sC?.(e)??null,n=rC?.(e)??[];let i=`THIS IS AN ACTIVE SESSION: 

`+UP(t,n);return ud.add(e),i},onReady(e){Bf(e),IR(g9(e))},onVoiceStopped(){ud.clear(),Ty=null}},zP=[{code:null,name:"Auto-detect",nativeName:"Auto-detect"},{code:"en-US",name:"English",nativeName:"English",region:"United States",elevenLabsCode:"en"},{code:"en-GB",name:"English",nativeName:"English",region:"United Kingdom",elevenLabsCode:"en"},{code:"en-AU",name:"English",nativeName:"English",region:"Australia",elevenLabsCode:"en"},{code:"en-CA",name:"English",nativeName:"English",region:"Canada",elevenLabsCode:"en"},{code:"es-ES",name:"Spanish",nativeName:"Espaol",region:"Spain",elevenLabsCode:"es"},{code:"es-MX",name:"Spanish",nativeName:"Espaol",region:"Mexico",elevenLabsCode:"es"},{code:"es-AR",name:"Spanish",nativeName:"Espaol",region:"Argentina",elevenLabsCode:"es"},{code:"fr-FR",name:"French",nativeName:"Franais",region:"France",elevenLabsCode:"fr"},{code:"fr-CA",name:"French",nativeName:"Franais",region:"Canada",elevenLabsCode:"fr"},{code:"de-DE",name:"German",nativeName:"Deutsch",region:"Germany",elevenLabsCode:"de"},{code:"de-AT",name:"German",nativeName:"Deutsch",region:"Austria",elevenLabsCode:"de"},{code:"it-IT",name:"Italian",nativeName:"Italiano",elevenLabsCode:"it"},{code:"pt-BR",name:"Portuguese",nativeName:"Portugus",region:"Brazil",elevenLabsCode:"pt-br"},{code:"pt-PT",name:"Portuguese",nativeName:"Portugus",region:"Portugal",elevenLabsCode:"pt"},{code:"ru-RU",name:"Russian",nativeName:"",elevenLabsCode:"ru"},{code:"zh-CN",name:"Chinese",nativeName:"",region:"Simplified",elevenLabsCode:"zh"},{code:"zh-TW",name:"Chinese",nativeName:"",region:"Traditional",elevenLabsCode:"zh"},{code:"ja-JP",name:"Japanese",nativeName:"",elevenLabsCode:"ja"},{code:"ko-KR",name:"Korean",nativeName:"",elevenLabsCode:"ko"},{code:"ar-SA",name:"Arabic",nativeName:"",elevenLabsCode:"ar"},{code:"hi-IN",name:"Hindi",nativeName:"",elevenLabsCode:"hi"},{code:"nl-NL",name:"Dutch",nativeName:"Nederlands",elevenLabsCode:"nl"},{code:"sv-SE",name:"Swedish",nativeName:"Svenska",elevenLabsCode:"sv"},{code:"no-NO",name:"Norwegian",nativeName:"Norsk",elevenLabsCode:"no"},{code:"da-DK",name:"Danish",nativeName:"Dansk",elevenLabsCode:"da"},{code:"fi-FI",name:"Finnish",nativeName:"Suomi",elevenLabsCode:"fi"},{code:"pl-PL",name:"Polish",nativeName:"Polski",elevenLabsCode:"pl"},{code:"tr-TR",name:"Turkish",nativeName:"Trke",elevenLabsCode:"tr"},{code:"he-IL",name:"Hebrew",nativeName:""},{code:"th-TH",name:"Thai",nativeName:""},{code:"vi-VN",name:"Vietnamese",nativeName:"Ting Vit",elevenLabsCode:"vi"},{code:"id-ID",name:"Indonesian",nativeName:"Bahasa Indonesia",elevenLabsCode:"id"},{code:"ms-MY",name:"Malay",nativeName:"Bahasa Melayu",elevenLabsCode:"ms"},{code:"tl-PH",name:"Tagalog",nativeName:"Tagalog",elevenLabsCode:"tl"},{code:"uk-UA",name:"Ukrainian",nativeName:"",elevenLabsCode:"uk"},{code:"cs-CZ",name:"Czech",nativeName:"etina",elevenLabsCode:"cs"},{code:"hu-HU",name:"Hungarian",nativeName:"Magyar",elevenLabsCode:"hu"},{code:"ro-RO",name:"Romanian",nativeName:"Romn",elevenLabsCode:"ro"},{code:"bg-BG",name:"Bulgarian",nativeName:"",elevenLabsCode:"bg"},{code:"el-GR",name:"Greek",nativeName:"",elevenLabsCode:"el"},{code:"hr-HR",name:"Croatian",nativeName:"Hrvatski",elevenLabsCode:"hr"},{code:"sk-SK",name:"Slovak",nativeName:"Slovenina",elevenLabsCode:"sk"},{code:"sl-SI",name:"Slovenian",nativeName:"Slovenina"},{code:"et-EE",name:"Estonian",nativeName:"Eesti"},{code:"lv-LV",name:"Latvian",nativeName:"Latvieu"},{code:"lt-LT",name:"Lithuanian",nativeName:"Lietuvi"}],PR=e=>{const t=[];return e.name!==e.nativeName?t.push(`${e.name} (${e.nativeName})`):t.push(e.name),e.region&&t.push(e.region),t.join(" - ")},b9=e=>zP.find(t=>t.code===e),y9=e=>e?b9(e)?.elevenLabsCode:void 0,_9=()=>zP.filter(e=>e.code===null||e.elevenLabsCode!==void 0),HP=P.createContext(null);function S9({children:e}){const[t,n]=P.useState("disconnected"),[i,s]=P.useState(null),[r,a]=P.useState(!1),[o,l]=P.useState(null),u=P.useCallback((g,C)=>{n(g),g==="error"?s(C??null):g==="connected"&&s(null)},[]),h=P.useCallback(()=>{a(g=>!g)},[]),f=P.useCallback(async g=>{l(g);const C=dd.onVoiceStarted(g),S=localStorage.getItem("codex-voice-lang"),v=y9(S);await v8(g,C,v)},[]),m=P.useCallback(async()=>{dd.onVoiceStopped(),await b8(),l(null),n("disconnected"),s(null)},[]);return b.jsx(HP.Provider,{value:{status:t,errorMessage:i,micMuted:r,currentSessionId:o,setStatus:u,setMicMuted:a,toggleMic:h,startVoice:f,stopVoice:m},children:e})}function $P(){return P.useContext(HP)}function C9(e){return!1}function x9(){return C9()}const w9=[{value:"en",label:"English"},{value:"zh-CN",label:""}];function k9(){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("path",{d:"m5 8 6 6"}),b.jsx("path",{d:"m4 14 6-6 2-3"}),b.jsx("path",{d:"M2 5h12"}),b.jsx("path",{d:"M7 2h1"}),b.jsx("path",{d:"m22 22-5-10-5 10"}),b.jsx("path",{d:"M14 18h6"})]})}function T9(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:b.jsx("polyline",{points:"20 6 9 17 4 12"})})}function E9(){const{locale:e,setLocale:t,t:n}=ot(),[i,s]=P.useState(!1),r=P.useRef(null),a=o=>{t(o),s(!1)};return P.useEffect(()=>{if(!i)return;const o=l=>{r.current&&!r.current.contains(l.target)&&s(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[i]),P.useEffect(()=>{if(!i)return;const o=l=>{l.key==="Escape"&&s(!1)};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[i]),b.jsxs("div",{ref:r,className:"relative",children:[b.jsx("button",{type:"button",onClick:()=>s(!i),className:"flex items-center justify-center h-8 w-8 rounded-md text-[var(--app-hint)] hover:text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)] transition-colors",title:n("language.title"),"aria-label":n("language.title"),"aria-expanded":i,"aria-haspopup":"listbox",children:b.jsx(k9,{})}),i&&b.jsx("div",{className:"absolute right-0 top-full mt-1 min-w-[140px] rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] shadow-lg overflow-hidden z-50",role:"listbox","aria-label":n("language.title"),children:w9.map(o=>{const l=e===o.value;return b.jsxs("button",{type:"button",role:"option","aria-selected":l,onClick:()=>a(o.value),className:`flex items-center justify-between w-full px-3 py-2 text-sm text-left transition-colors ${l?"text-[var(--app-link)] bg-[var(--app-subtle-bg)]":"text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)]"}`,children:[b.jsx("span",{children:o.label}),l&&b.jsx("span",{className:"ml-2 text-[var(--app-link)]",children:b.jsx(T9,{})})]},o.value)})})]})}function qP(e){var t,n,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=qP(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function VP(){for(var e,t,n=0,i="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=qP(e))&&(i&&(i+=" "),i+=t);return i}const R9=(e,t)=>{const n=new Array(e.length+t.length);for(let i=0;i<e.length;i++)n[i]=e[i];for(let i=0;i<t.length;i++)n[e.length+i]=t[i];return n},A9=(e,t)=>({classGroupId:e,validator:t}),WP=(e=new Map,t=null,n)=>({nextPart:e,validators:t,classGroupId:n}),um="-",DR=[],M9="arbitrary..",L9=e=>{const t=P9(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=e;return{getClassGroupId:a=>{if(a.startsWith("[")&&a.endsWith("]"))return I9(a);const o=a.split(um),l=o[0]===""&&o.length>1?1:0;return GP(o,l,t)},getConflictingClassGroupIds:(a,o)=>{if(o){const l=i[a],u=n[a];return l?u?R9(u,l):l:u||DR}return n[a]||DR}}},GP=(e,t,n)=>{if(e.length-t===0)return n.classGroupId;const s=e[t],r=n.nextPart.get(s);if(r){const u=GP(e,t+1,r);if(u)return u}const a=n.validators;if(a===null)return;const o=t===0?e.join(um):e.slice(t).join(um),l=a.length;for(let u=0;u<l;u++){const h=a[u];if(h.validator(o))return h.classGroupId}},I9=e=>e.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const t=e.slice(1,-1),n=t.indexOf(":"),i=t.slice(0,n);return i?M9+i:void 0})(),P9=e=>{const{theme:t,classGroups:n}=e;return D9(n,t)},D9=(e,t)=>{const n=WP();for(const i in e){const s=e[i];oC(s,n,i,t)}return n},oC=(e,t,n,i)=>{const s=e.length;for(let r=0;r<s;r++){const a=e[r];O9(a,t,n,i)}},O9=(e,t,n,i)=>{if(typeof e=="string"){N9(e,t,n);return}if(typeof e=="function"){j9(e,t,n,i);return}B9(e,t,n,i)},N9=(e,t,n)=>{const i=e===""?t:KP(t,e);i.classGroupId=n},j9=(e,t,n,i)=>{if(F9(e)){oC(e(i),t,n,i);return}t.validators===null&&(t.validators=[]),t.validators.push(A9(n,e))},B9=(e,t,n,i)=>{const s=Object.entries(e),r=s.length;for(let a=0;a<r;a++){const[o,l]=s[a];oC(l,KP(t,o),n,i)}},KP=(e,t)=>{let n=e;const i=t.split(um),s=i.length;for(let r=0;r<s;r++){const a=i[r];let o=n.nextPart.get(a);o||(o=WP(),n.nextPart.set(a,o)),n=o}return n},F9=e=>"isThemeGetter"in e&&e.isThemeGetter===!0,U9=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=Object.create(null),i=Object.create(null);const s=(r,a)=>{n[r]=a,t++,t>e&&(t=0,i=n,n=Object.create(null))};return{get(r){let a=n[r];if(a!==void 0)return a;if((a=i[r])!==void 0)return s(r,a),a},set(r,a){r in n?n[r]=a:s(r,a)}}},C0="!",OR=":",z9=[],NR=(e,t,n,i,s)=>({modifiers:e,hasImportantModifier:t,baseClassName:n,maybePostfixModifierPosition:i,isExternal:s}),H9=e=>{const{prefix:t,experimentalParseClassName:n}=e;let i=s=>{const r=[];let a=0,o=0,l=0,u;const h=s.length;for(let S=0;S<h;S++){const v=s[S];if(a===0&&o===0){if(v===OR){r.push(s.slice(l,S)),l=S+1;continue}if(v==="/"){u=S;continue}}v==="["?a++:v==="]"?a--:v==="("?o++:v===")"&&o--}const f=r.length===0?s:s.slice(l);let m=f,g=!1;f.endsWith(C0)?(m=f.slice(0,-1),g=!0):f.startsWith(C0)&&(m=f.slice(1),g=!0);const C=u&&u>l?u-l:void 0;return NR(r,g,m,C)};if(t){const s=t+OR,r=i;i=a=>a.startsWith(s)?r(a.slice(s.length)):NR(z9,!1,a,void 0,!0)}if(n){const s=i;i=r=>n({className:r,parseClassName:s})}return i},$9=e=>{const t=new Map;return e.orderSensitiveModifiers.forEach((n,i)=>{t.set(n,1e6+i)}),n=>{const i=[];let s=[];for(let r=0;r<n.length;r++){const a=n[r],o=a[0]==="[",l=t.has(a);o||l?(s.length>0&&(s.sort(),i.push(...s),s=[]),i.push(a)):s.push(a)}return s.length>0&&(s.sort(),i.push(...s)),i}},q9=e=>({cache:U9(e.cacheSize),parseClassName:H9(e),sortModifiers:$9(e),...L9(e)}),V9=/\s+/,W9=(e,t)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:s,sortModifiers:r}=t,a=[],o=e.trim().split(V9);let l="";for(let u=o.length-1;u>=0;u-=1){const h=o[u],{isExternal:f,modifiers:m,hasImportantModifier:g,baseClassName:C,maybePostfixModifierPosition:S}=n(h);if(f){l=h+(l.length>0?" "+l:l);continue}let v=!!S,_=i(v?C.substring(0,S):C);if(!_){if(!v){l=h+(l.length>0?" "+l:l);continue}if(_=i(C),!_){l=h+(l.length>0?" "+l:l);continue}v=!1}const w=m.length===0?"":m.length===1?m[0]:r(m).join(":"),x=g?w+C0:w,k=x+_;if(a.indexOf(k)>-1)continue;a.push(k);const A=s(_,v);for(let T=0;T<A.length;++T){const M=A[T];a.push(x+M)}l=h+(l.length>0?" "+l:l)}return l},G9=(...e)=>{let t=0,n,i,s="";for(;t<e.length;)(n=e[t++])&&(i=YP(n))&&(s&&(s+=" "),s+=i);return s},YP=e=>{if(typeof e=="string")return e;let t,n="";for(let i=0;i<e.length;i++)e[i]&&(t=YP(e[i]))&&(n&&(n+=" "),n+=t);return n},K9=(e,...t)=>{let n,i,s,r;const a=l=>{const u=t.reduce((h,f)=>f(h),e());return n=q9(u),i=n.cache.get,s=n.cache.set,r=o,o(l)},o=l=>{const u=i(l);if(u)return u;const h=W9(l,n);return s(l,h),h};return r=a,(...l)=>r(G9(...l))},Y9=[],bn=e=>{const t=n=>n[e]||Y9;return t.isThemeGetter=!0,t},QP=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,JP=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Q9=/^\d+(?:\.\d+)?\/\d+(?:\.\d+)?$/,J9=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,X9=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Z9=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,eq=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,tq=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,mo=e=>Q9.test(e),rt=e=>!!e&&!Number.isNaN(Number(e)),go=e=>!!e&&Number.isInteger(Number(e)),Ey=e=>e.endsWith("%")&&rt(e.slice(0,-1)),Cr=e=>J9.test(e),XP=()=>!0,nq=e=>X9.test(e)&&!Z9.test(e),aC=()=>!1,iq=e=>eq.test(e),sq=e=>tq.test(e),rq=e=>!De(e)&&!Oe(e),oq=e=>zo(e,tD,aC),De=e=>QP.test(e),da=e=>zo(e,nD,nq),jR=e=>zo(e,pq,rt),aq=e=>zo(e,sD,XP),lq=e=>zo(e,iD,aC),BR=e=>zo(e,ZP,aC),cq=e=>zo(e,eD,sq),Ff=e=>zo(e,rD,iq),Oe=e=>JP.test(e),$u=e=>Qa(e,nD),uq=e=>Qa(e,iD),FR=e=>Qa(e,ZP),dq=e=>Qa(e,tD),hq=e=>Qa(e,eD),Uf=e=>Qa(e,rD,!0),fq=e=>Qa(e,sD,!0),zo=(e,t,n)=>{const i=QP.exec(e);return i?i[1]?t(i[1]):n(i[2]):!1},Qa=(e,t,n=!1)=>{const i=JP.exec(e);return i?i[1]?t(i[1]):n:!1},ZP=e=>e==="position"||e==="percentage",eD=e=>e==="image"||e==="url",tD=e=>e==="length"||e==="size"||e==="bg-size",nD=e=>e==="length",pq=e=>e==="number",iD=e=>e==="family-name",sD=e=>e==="number"||e==="weight",rD=e=>e==="shadow",mq=()=>{const e=bn("color"),t=bn("font"),n=bn("text"),i=bn("font-weight"),s=bn("tracking"),r=bn("leading"),a=bn("breakpoint"),o=bn("container"),l=bn("spacing"),u=bn("radius"),h=bn("shadow"),f=bn("inset-shadow"),m=bn("text-shadow"),g=bn("drop-shadow"),C=bn("blur"),S=bn("perspective"),v=bn("aspect"),_=bn("ease"),w=bn("animate"),x=()=>["auto","avoid","all","avoid-page","page","left","right","column"],k=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],A=()=>[...k(),Oe,De],T=()=>["auto","hidden","clip","visible","scroll"],M=()=>["auto","contain","none"],E=()=>[Oe,De,l],L=()=>[mo,"full","auto",...E()],D=()=>[go,"none","subgrid",Oe,De],O=()=>["auto",{span:["full",go,Oe,De]},go,Oe,De],j=()=>[go,"auto",Oe,De],U=()=>["auto","min","max","fr",Oe,De],q=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],K=()=>["start","end","center","stretch","center-safe","end-safe"],$=()=>["auto",...E()],Y=()=>[mo,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...E()],Q=()=>[mo,"screen","full","dvw","lvw","svw","min","max","fit",...E()],F=()=>[mo,"screen","full","lh","dvh","lvh","svh","min","max","fit",...E()],N=()=>[e,Oe,De],z=()=>[...k(),FR,BR,{position:[Oe,De]}],G=()=>["no-repeat",{repeat:["","x","y","space","round"]}],H=()=>["auto","cover","contain",dq,oq,{size:[Oe,De]}],ee=()=>[Ey,$u,da],ue=()=>["","none","full",u,Oe,De],ce=()=>["",rt,$u,da],J=()=>["solid","dashed","dotted","double"],V=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ne=()=>[rt,Ey,FR,BR],he=()=>["","none",C,Oe,De],_e=()=>["none",rt,Oe,De],Ce=()=>["none",rt,Oe,De],we=()=>[rt,Oe,De],Ee=()=>[mo,"full",...E()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Cr],breakpoint:[Cr],color:[XP],container:[Cr],"drop-shadow":[Cr],ease:["in","out","in-out"],font:[rq],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Cr],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Cr],shadow:[Cr],spacing:["px",rt],text:[Cr],"text-shadow":[Cr],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",mo,De,Oe,v]}],container:["container"],columns:[{columns:[rt,De,Oe,o]}],"break-after":[{"break-after":x()}],"break-before":[{"break-before":x()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:A()}],overflow:[{overflow:T()}],"overflow-x":[{"overflow-x":T()}],"overflow-y":[{"overflow-y":T()}],overscroll:[{overscroll:M()}],"overscroll-x":[{"overscroll-x":M()}],"overscroll-y":[{"overscroll-y":M()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:L()}],"inset-x":[{"inset-x":L()}],"inset-y":[{"inset-y":L()}],start:[{"inset-s":L(),start:L()}],end:[{"inset-e":L(),end:L()}],"inset-bs":[{"inset-bs":L()}],"inset-be":[{"inset-be":L()}],top:[{top:L()}],right:[{right:L()}],bottom:[{bottom:L()}],left:[{left:L()}],visibility:["visible","invisible","collapse"],z:[{z:[go,"auto",Oe,De]}],basis:[{basis:[mo,"full","auto",o,...E()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[rt,mo,"auto","initial","none",De]}],grow:[{grow:["",rt,Oe,De]}],shrink:[{shrink:["",rt,Oe,De]}],order:[{order:[go,"first","last","none",Oe,De]}],"grid-cols":[{"grid-cols":D()}],"col-start-end":[{col:O()}],"col-start":[{"col-start":j()}],"col-end":[{"col-end":j()}],"grid-rows":[{"grid-rows":D()}],"row-start-end":[{row:O()}],"row-start":[{"row-start":j()}],"row-end":[{"row-end":j()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":U()}],"auto-rows":[{"auto-rows":U()}],gap:[{gap:E()}],"gap-x":[{"gap-x":E()}],"gap-y":[{"gap-y":E()}],"justify-content":[{justify:[...q(),"normal"]}],"justify-items":[{"justify-items":[...K(),"normal"]}],"justify-self":[{"justify-self":["auto",...K()]}],"align-content":[{content:["normal",...q()]}],"align-items":[{items:[...K(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...K(),{baseline:["","last"]}]}],"place-content":[{"place-content":q()}],"place-items":[{"place-items":[...K(),"baseline"]}],"place-self":[{"place-self":["auto",...K()]}],p:[{p:E()}],px:[{px:E()}],py:[{py:E()}],ps:[{ps:E()}],pe:[{pe:E()}],pbs:[{pbs:E()}],pbe:[{pbe:E()}],pt:[{pt:E()}],pr:[{pr:E()}],pb:[{pb:E()}],pl:[{pl:E()}],m:[{m:$()}],mx:[{mx:$()}],my:[{my:$()}],ms:[{ms:$()}],me:[{me:$()}],mbs:[{mbs:$()}],mbe:[{mbe:$()}],mt:[{mt:$()}],mr:[{mr:$()}],mb:[{mb:$()}],ml:[{ml:$()}],"space-x":[{"space-x":E()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":E()}],"space-y-reverse":["space-y-reverse"],size:[{size:Y()}],"inline-size":[{inline:["auto",...Q()]}],"min-inline-size":[{"min-inline":["auto",...Q()]}],"max-inline-size":[{"max-inline":["none",...Q()]}],"block-size":[{block:["auto",...F()]}],"min-block-size":[{"min-block":["auto",...F()]}],"max-block-size":[{"max-block":["none",...F()]}],w:[{w:[o,"screen",...Y()]}],"min-w":[{"min-w":[o,"screen","none",...Y()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...Y()]}],h:[{h:["screen","lh",...Y()]}],"min-h":[{"min-h":["screen","lh","none",...Y()]}],"max-h":[{"max-h":["screen","lh",...Y()]}],"font-size":[{text:["base",n,$u,da]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[i,fq,aq]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Ey,De]}],"font-family":[{font:[uq,lq,t]}],"font-features":[{"font-features":[De]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,Oe,De]}],"line-clamp":[{"line-clamp":[rt,"none",Oe,jR]}],leading:[{leading:[r,...E()]}],"list-image":[{"list-image":["none",Oe,De]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Oe,De]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:N()}],"text-color":[{text:N()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...J(),"wavy"]}],"text-decoration-thickness":[{decoration:[rt,"from-font","auto",Oe,da]}],"text-decoration-color":[{decoration:N()}],"underline-offset":[{"underline-offset":[rt,"auto",Oe,De]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:E()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Oe,De]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Oe,De]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:z()}],"bg-repeat":[{bg:G()}],"bg-size":[{bg:H()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},go,Oe,De],radial:["",Oe,De],conic:[go,Oe,De]},hq,cq]}],"bg-color":[{bg:N()}],"gradient-from-pos":[{from:ee()}],"gradient-via-pos":[{via:ee()}],"gradient-to-pos":[{to:ee()}],"gradient-from":[{from:N()}],"gradient-via":[{via:N()}],"gradient-to":[{to:N()}],rounded:[{rounded:ue()}],"rounded-s":[{"rounded-s":ue()}],"rounded-e":[{"rounded-e":ue()}],"rounded-t":[{"rounded-t":ue()}],"rounded-r":[{"rounded-r":ue()}],"rounded-b":[{"rounded-b":ue()}],"rounded-l":[{"rounded-l":ue()}],"rounded-ss":[{"rounded-ss":ue()}],"rounded-se":[{"rounded-se":ue()}],"rounded-ee":[{"rounded-ee":ue()}],"rounded-es":[{"rounded-es":ue()}],"rounded-tl":[{"rounded-tl":ue()}],"rounded-tr":[{"rounded-tr":ue()}],"rounded-br":[{"rounded-br":ue()}],"rounded-bl":[{"rounded-bl":ue()}],"border-w":[{border:ce()}],"border-w-x":[{"border-x":ce()}],"border-w-y":[{"border-y":ce()}],"border-w-s":[{"border-s":ce()}],"border-w-e":[{"border-e":ce()}],"border-w-bs":[{"border-bs":ce()}],"border-w-be":[{"border-be":ce()}],"border-w-t":[{"border-t":ce()}],"border-w-r":[{"border-r":ce()}],"border-w-b":[{"border-b":ce()}],"border-w-l":[{"border-l":ce()}],"divide-x":[{"divide-x":ce()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ce()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...J(),"hidden","none"]}],"divide-style":[{divide:[...J(),"hidden","none"]}],"border-color":[{border:N()}],"border-color-x":[{"border-x":N()}],"border-color-y":[{"border-y":N()}],"border-color-s":[{"border-s":N()}],"border-color-e":[{"border-e":N()}],"border-color-bs":[{"border-bs":N()}],"border-color-be":[{"border-be":N()}],"border-color-t":[{"border-t":N()}],"border-color-r":[{"border-r":N()}],"border-color-b":[{"border-b":N()}],"border-color-l":[{"border-l":N()}],"divide-color":[{divide:N()}],"outline-style":[{outline:[...J(),"none","hidden"]}],"outline-offset":[{"outline-offset":[rt,Oe,De]}],"outline-w":[{outline:["",rt,$u,da]}],"outline-color":[{outline:N()}],shadow:[{shadow:["","none",h,Uf,Ff]}],"shadow-color":[{shadow:N()}],"inset-shadow":[{"inset-shadow":["none",f,Uf,Ff]}],"inset-shadow-color":[{"inset-shadow":N()}],"ring-w":[{ring:ce()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:N()}],"ring-offset-w":[{"ring-offset":[rt,da]}],"ring-offset-color":[{"ring-offset":N()}],"inset-ring-w":[{"inset-ring":ce()}],"inset-ring-color":[{"inset-ring":N()}],"text-shadow":[{"text-shadow":["none",m,Uf,Ff]}],"text-shadow-color":[{"text-shadow":N()}],opacity:[{opacity:[rt,Oe,De]}],"mix-blend":[{"mix-blend":[...V(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":V()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[rt]}],"mask-image-linear-from-pos":[{"mask-linear-from":ne()}],"mask-image-linear-to-pos":[{"mask-linear-to":ne()}],"mask-image-linear-from-color":[{"mask-linear-from":N()}],"mask-image-linear-to-color":[{"mask-linear-to":N()}],"mask-image-t-from-pos":[{"mask-t-from":ne()}],"mask-image-t-to-pos":[{"mask-t-to":ne()}],"mask-image-t-from-color":[{"mask-t-from":N()}],"mask-image-t-to-color":[{"mask-t-to":N()}],"mask-image-r-from-pos":[{"mask-r-from":ne()}],"mask-image-r-to-pos":[{"mask-r-to":ne()}],"mask-image-r-from-color":[{"mask-r-from":N()}],"mask-image-r-to-color":[{"mask-r-to":N()}],"mask-image-b-from-pos":[{"mask-b-from":ne()}],"mask-image-b-to-pos":[{"mask-b-to":ne()}],"mask-image-b-from-color":[{"mask-b-from":N()}],"mask-image-b-to-color":[{"mask-b-to":N()}],"mask-image-l-from-pos":[{"mask-l-from":ne()}],"mask-image-l-to-pos":[{"mask-l-to":ne()}],"mask-image-l-from-color":[{"mask-l-from":N()}],"mask-image-l-to-color":[{"mask-l-to":N()}],"mask-image-x-from-pos":[{"mask-x-from":ne()}],"mask-image-x-to-pos":[{"mask-x-to":ne()}],"mask-image-x-from-color":[{"mask-x-from":N()}],"mask-image-x-to-color":[{"mask-x-to":N()}],"mask-image-y-from-pos":[{"mask-y-from":ne()}],"mask-image-y-to-pos":[{"mask-y-to":ne()}],"mask-image-y-from-color":[{"mask-y-from":N()}],"mask-image-y-to-color":[{"mask-y-to":N()}],"mask-image-radial":[{"mask-radial":[Oe,De]}],"mask-image-radial-from-pos":[{"mask-radial-from":ne()}],"mask-image-radial-to-pos":[{"mask-radial-to":ne()}],"mask-image-radial-from-color":[{"mask-radial-from":N()}],"mask-image-radial-to-color":[{"mask-radial-to":N()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":k()}],"mask-image-conic-pos":[{"mask-conic":[rt]}],"mask-image-conic-from-pos":[{"mask-conic-from":ne()}],"mask-image-conic-to-pos":[{"mask-conic-to":ne()}],"mask-image-conic-from-color":[{"mask-conic-from":N()}],"mask-image-conic-to-color":[{"mask-conic-to":N()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:z()}],"mask-repeat":[{mask:G()}],"mask-size":[{mask:H()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Oe,De]}],filter:[{filter:["","none",Oe,De]}],blur:[{blur:he()}],brightness:[{brightness:[rt,Oe,De]}],contrast:[{contrast:[rt,Oe,De]}],"drop-shadow":[{"drop-shadow":["","none",g,Uf,Ff]}],"drop-shadow-color":[{"drop-shadow":N()}],grayscale:[{grayscale:["",rt,Oe,De]}],"hue-rotate":[{"hue-rotate":[rt,Oe,De]}],invert:[{invert:["",rt,Oe,De]}],saturate:[{saturate:[rt,Oe,De]}],sepia:[{sepia:["",rt,Oe,De]}],"backdrop-filter":[{"backdrop-filter":["","none",Oe,De]}],"backdrop-blur":[{"backdrop-blur":he()}],"backdrop-brightness":[{"backdrop-brightness":[rt,Oe,De]}],"backdrop-contrast":[{"backdrop-contrast":[rt,Oe,De]}],"backdrop-grayscale":[{"backdrop-grayscale":["",rt,Oe,De]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[rt,Oe,De]}],"backdrop-invert":[{"backdrop-invert":["",rt,Oe,De]}],"backdrop-opacity":[{"backdrop-opacity":[rt,Oe,De]}],"backdrop-saturate":[{"backdrop-saturate":[rt,Oe,De]}],"backdrop-sepia":[{"backdrop-sepia":["",rt,Oe,De]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":E()}],"border-spacing-x":[{"border-spacing-x":E()}],"border-spacing-y":[{"border-spacing-y":E()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Oe,De]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[rt,"initial",Oe,De]}],ease:[{ease:["linear","initial",_,Oe,De]}],delay:[{delay:[rt,Oe,De]}],animate:[{animate:["none",w,Oe,De]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[S,Oe,De]}],"perspective-origin":[{"perspective-origin":A()}],rotate:[{rotate:_e()}],"rotate-x":[{"rotate-x":_e()}],"rotate-y":[{"rotate-y":_e()}],"rotate-z":[{"rotate-z":_e()}],scale:[{scale:Ce()}],"scale-x":[{"scale-x":Ce()}],"scale-y":[{"scale-y":Ce()}],"scale-z":[{"scale-z":Ce()}],"scale-3d":["scale-3d"],skew:[{skew:we()}],"skew-x":[{"skew-x":we()}],"skew-y":[{"skew-y":we()}],transform:[{transform:[Oe,De,"","none","gpu","cpu"]}],"transform-origin":[{origin:A()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ee()}],"translate-x":[{"translate-x":Ee()}],"translate-y":[{"translate-y":Ee()}],"translate-z":[{"translate-z":Ee()}],"translate-none":["translate-none"],accent:[{accent:N()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:N()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Oe,De]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":E()}],"scroll-mx":[{"scroll-mx":E()}],"scroll-my":[{"scroll-my":E()}],"scroll-ms":[{"scroll-ms":E()}],"scroll-me":[{"scroll-me":E()}],"scroll-mbs":[{"scroll-mbs":E()}],"scroll-mbe":[{"scroll-mbe":E()}],"scroll-mt":[{"scroll-mt":E()}],"scroll-mr":[{"scroll-mr":E()}],"scroll-mb":[{"scroll-mb":E()}],"scroll-ml":[{"scroll-ml":E()}],"scroll-p":[{"scroll-p":E()}],"scroll-px":[{"scroll-px":E()}],"scroll-py":[{"scroll-py":E()}],"scroll-ps":[{"scroll-ps":E()}],"scroll-pe":[{"scroll-pe":E()}],"scroll-pbs":[{"scroll-pbs":E()}],"scroll-pbe":[{"scroll-pbe":E()}],"scroll-pt":[{"scroll-pt":E()}],"scroll-pr":[{"scroll-pr":E()}],"scroll-pb":[{"scroll-pb":E()}],"scroll-pl":[{"scroll-pl":E()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Oe,De]}],fill:[{fill:["none",...N()]}],"stroke-w":[{stroke:[rt,$u,da,jR]}],stroke:[{stroke:["none",...N()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","inset-bs","inset-be","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pbs","pbe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mbs","mbe","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-bs","border-w-be","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-bs","border-color-be","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mbs","scroll-mbe","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pbs","scroll-pbe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},gq=K9(mq);function Be(...e){return gq(VP(e))}function oD(e){try{const t=atob(e),n=Uint8Array.from(t,s=>s.charCodeAt(0));return{text:new TextDecoder("utf-8").decode(n),ok:!0}}catch{return{text:"",ok:!1}}}function zf(e){const t=new TextEncoder().encode(e),n=Array.from(t,i=>String.fromCharCode(i)).join("");return btoa(n)}function Ur({size:e="md",className:t,label:n}){const{t:i}=ot(),s={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"},r=n===void 0?i("loading"):n,a=r===null?{"aria-hidden":!0}:{role:"status","aria-label":r};return b.jsxs("svg",{className:Be(s[e],"animate-spin text-[var(--app-hint)]",t),viewBox:"0 0 24 24",fill:"none",...a,children:[b.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"2.5",opacity:"0.25"}),b.jsx("path",{d:"M21 12a9 9 0 0 0-9-9",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",opacity:"0.75"})]})}function UR(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Dc(...e){return t=>{let n=!1;const i=e.map(s=>{const r=UR(s,t);return!n&&typeof r=="function"&&(n=!0),r});if(n)return()=>{for(let s=0;s<i.length;s++){const r=i[s];typeof r=="function"?r():UR(e[s],null)}}}}function Es(...e){return P.useCallback(Dc(...e),e)}var vq=Symbol.for("react.lazy"),dm=rS[" use ".trim().toString()];function bq(e){return typeof e=="object"&&e!==null&&"then"in e}function aD(e){return e!=null&&typeof e=="object"&&"$$typeof"in e&&e.$$typeof===vq&&"_payload"in e&&bq(e._payload)}function lD(e){const t=yq(e),n=P.forwardRef((i,s)=>{let{children:r,...a}=i;aD(r)&&typeof dm=="function"&&(r=dm(r._payload));const o=P.Children.toArray(r),l=o.find(Sq);if(l){const u=l.props.children,h=o.map(f=>f===l?P.Children.count(u)>1?P.Children.only(null):P.isValidElement(u)?u.props.children:null:f);return b.jsx(t,{...a,ref:s,children:P.isValidElement(u)?P.cloneElement(u,void 0,h):null})}return b.jsx(t,{...a,ref:s,children:r})});return n.displayName=`${e}.Slot`,n}var lC=lD("Slot");function yq(e){const t=P.forwardRef((n,i)=>{let{children:s,...r}=n;if(aD(s)&&typeof dm=="function"&&(s=dm(s._payload)),P.isValidElement(s)){const a=xq(s),o=Cq(r,s.props);return s.type!==P.Fragment&&(o.ref=i?Dc(i,a):a),P.cloneElement(s,o)}return P.Children.count(s)>1?P.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var _q=Symbol("radix.slottable");function Sq(e){return P.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===_q}function Cq(e,t){const n={...t};for(const i in t){const s=e[i],r=t[i];/^on[A-Z]/.test(i)?s&&r?n[i]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(n[i]=s):i==="style"?n[i]={...s,...r}:i==="className"&&(n[i]=[s,r].filter(Boolean).join(" "))}return{...e,...n}}function xq(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}const zR=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,HR=VP,cC=(e,t)=>n=>{var i;if(t?.variants==null)return HR(e,n?.class,n?.className);const{variants:s,defaultVariants:r}=t,a=Object.keys(s).map(u=>{const h=n?.[u],f=r?.[u];if(h===null)return null;const m=zR(h)||zR(f);return s[u][m]}),o=n&&Object.entries(n).reduce((u,h)=>{let[f,m]=h;return m===void 0||(u[f]=m),u},{}),l=t==null||(i=t.compoundVariants)===null||i===void 0?void 0:i.reduce((u,h)=>{let{class:f,className:m,...g}=h;return Object.entries(g).every(C=>{let[S,v]=C;return Array.isArray(v)?v.includes({...r,...o}[S]):{...r,...o}[S]===v})?[...u,f,m]:u},[]);return HR(e,a,l,n?.class,n?.className)},wq=cC("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)] disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-[var(--app-button)] text-[var(--app-button-text)] hover:opacity-90",secondary:"bg-[var(--app-secondary-bg)] text-[var(--app-fg)] hover:opacity-90",outline:"border border-[var(--app-border)] bg-transparent hover:bg-[var(--app-subtle-bg)]",destructive:"bg-red-600 text-white hover:bg-red-600/90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8"}},defaultVariants:{variant:"default",size:"default"}}),Rn=P.forwardRef(({className:e,variant:t,size:n,asChild:i=!1,...s},r)=>{const a=i?lC:"button";return b.jsx(a,{className:Be(wq({variant:t,size:n,className:e})),ref:r,...s})});Rn.displayName="Button";function Di(e,t,{checkForDefaultPrevented:n=!0}={}){return function(s){if(e?.(s),n===!1||!s.defaultPrevented)return t?.(s)}}function kq(e,t){const n=P.createContext(t),i=r=>{const{children:a,...o}=r,l=P.useMemo(()=>o,Object.values(o));return b.jsx(n.Provider,{value:l,children:a})};i.displayName=e+"Provider";function s(r){const a=P.useContext(n);if(a)return a;if(t!==void 0)return t;throw new Error(`\`${r}\` must be used within \`${e}\``)}return[i,s]}function Tq(e,t=[]){let n=[];function i(r,a){const o=P.createContext(a),l=n.length;n=[...n,a];const u=f=>{const{scope:m,children:g,...C}=f,S=m?.[e]?.[l]||o,v=P.useMemo(()=>C,Object.values(C));return b.jsx(S.Provider,{value:v,children:g})};u.displayName=r+"Provider";function h(f,m){const g=m?.[e]?.[l]||o,C=P.useContext(g);if(C)return C;if(a!==void 0)return a;throw new Error(`\`${f}\` must be used within \`${r}\``)}return[u,h]}const s=()=>{const r=n.map(a=>P.createContext(a));return function(o){const l=o?.[e]||r;return P.useMemo(()=>({[`__scope${e}`]:{...o,[e]:l}}),[o,l])}};return s.scopeName=e,[i,Eq(s,...t)]}function Eq(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const i=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(r){const a=i.reduce((o,{useScope:l,scopeName:u})=>{const f=l(r)[`__scope${u}`];return{...o,...f}},{});return P.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}var jd=globalThis?.document?P.useLayoutEffect:()=>{},Rq=rS[" useId ".trim().toString()]||(()=>{}),Aq=0;function Ry(e){const[t,n]=P.useState(Rq());return jd(()=>{n(i=>i??String(Aq++))},[e]),e||(t?`radix-${t}`:"")}var Mq=rS[" useInsertionEffect ".trim().toString()]||jd;function Lq({prop:e,defaultProp:t,onChange:n=()=>{},caller:i}){const[s,r,a]=Iq({defaultProp:t,onChange:n}),o=e!==void 0,l=o?e:s;{const h=P.useRef(e!==void 0);P.useEffect(()=>{const f=h.current;f!==o&&console.warn(`${i} is changing from ${f?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=o},[o,i])}const u=P.useCallback(h=>{if(o){const f=Pq(h)?h(e):h;f!==e&&a.current?.(f)}else r(h)},[o,e,r,a]);return[l,u]}function Iq({defaultProp:e,onChange:t}){const[n,i]=P.useState(e),s=P.useRef(n),r=P.useRef(t);return Mq(()=>{r.current=t},[t]),P.useEffect(()=>{s.current!==n&&(r.current?.(n),s.current=n)},[n,s]),[n,i,r]}function Pq(e){return typeof e=="function"}function Dq(e){const t=Oq(e),n=P.forwardRef((i,s)=>{const{children:r,...a}=i,o=P.Children.toArray(r),l=o.find(jq);if(l){const u=l.props.children,h=o.map(f=>f===l?P.Children.count(u)>1?P.Children.only(null):P.isValidElement(u)?u.props.children:null:f);return b.jsx(t,{...a,ref:s,children:P.isValidElement(u)?P.cloneElement(u,void 0,h):null})}return b.jsx(t,{...a,ref:s,children:r})});return n.displayName=`${e}.Slot`,n}function Oq(e){const t=P.forwardRef((n,i)=>{const{children:s,...r}=n;if(P.isValidElement(s)){const a=Fq(s),o=Bq(r,s.props);return s.type!==P.Fragment&&(o.ref=i?Dc(i,a):a),P.cloneElement(s,o)}return P.Children.count(s)>1?P.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Nq=Symbol("radix.slottable");function jq(e){return P.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Nq}function Bq(e,t){const n={...t};for(const i in t){const s=e[i],r=t[i];/^on[A-Z]/.test(i)?s&&r?n[i]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(n[i]=s):i==="style"?n[i]={...s,...r}:i==="className"&&(n[i]=[s,r].filter(Boolean).join(" "))}return{...e,...n}}function Fq(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Uq=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],cD=Uq.reduce((e,t)=>{const n=Dq(`Primitive.${t}`),i=P.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(l,{...o,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{});function zq(e,t){e&&_S.flushSync(()=>e.dispatchEvent(t))}function xs(e){const t=P.useRef(e);return P.useEffect(()=>{t.current=e}),P.useMemo(()=>(...n)=>t.current?.(...n),[])}function uD(e,t=globalThis?.document){const n=xs(e);P.useEffect(()=>{const i=s=>{s.key==="Escape"&&n(s)};return t.addEventListener("keydown",i,{capture:!0}),()=>t.removeEventListener("keydown",i,{capture:!0})},[n,t])}var Hq="DismissableLayer",x0="dismissableLayer.update",$q="dismissableLayer.pointerDownOutside",qq="dismissableLayer.focusOutside",$R,dD=P.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),hD=P.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:r,onInteractOutside:a,onDismiss:o,...l}=e,u=P.useContext(dD),[h,f]=P.useState(null),m=h?.ownerDocument??globalThis?.document,[,g]=P.useState({}),C=Es(t,M=>f(M)),S=Array.from(u.layers),[v]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),_=S.indexOf(v),w=h?S.indexOf(h):-1,x=u.layersWithOutsidePointerEventsDisabled.size>0,k=w>=_,A=Gq(M=>{const E=M.target,L=[...u.branches].some(D=>D.contains(E));!k||L||(s?.(M),a?.(M),M.defaultPrevented||o?.())},m),T=Kq(M=>{const E=M.target;[...u.branches].some(D=>D.contains(E))||(r?.(M),a?.(M),M.defaultPrevented||o?.())},m);return uD(M=>{w===u.layers.size-1&&(i?.(M),!M.defaultPrevented&&o&&(M.preventDefault(),o()))},m),P.useEffect(()=>{if(h)return n&&(u.layersWithOutsidePointerEventsDisabled.size===0&&($R=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),qR(),()=>{n&&u.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=$R)}},[h,m,n,u]),P.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),qR())},[h,u]),P.useEffect(()=>{const M=()=>g({});return document.addEventListener(x0,M),()=>document.removeEventListener(x0,M)},[]),b.jsx(cD.div,{...l,ref:C,style:{pointerEvents:x?k?"auto":"none":void 0,...e.style},onFocusCapture:Di(e.onFocusCapture,T.onFocusCapture),onBlurCapture:Di(e.onBlurCapture,T.onBlurCapture),onPointerDownCapture:Di(e.onPointerDownCapture,A.onPointerDownCapture)})});hD.displayName=Hq;var Vq="DismissableLayerBranch",Wq=P.forwardRef((e,t)=>{const n=P.useContext(dD),i=P.useRef(null),s=Es(t,i);return P.useEffect(()=>{const r=i.current;if(r)return n.branches.add(r),()=>{n.branches.delete(r)}},[n.branches]),b.jsx(cD.div,{...e,ref:s})});Wq.displayName=Vq;function Gq(e,t=globalThis?.document){const n=xs(e),i=P.useRef(!1),s=P.useRef(()=>{});return P.useEffect(()=>{const r=o=>{if(o.target&&!i.current){let l=function(){fD($q,n,u,{discrete:!0})};const u={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=l,t.addEventListener("click",s.current,{once:!0})):l()}else t.removeEventListener("click",s.current);i.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",r),t.removeEventListener("click",s.current)}},[t,n]),{onPointerDownCapture:()=>i.current=!0}}function Kq(e,t=globalThis?.document){const n=xs(e),i=P.useRef(!1);return P.useEffect(()=>{const s=r=>{r.target&&!i.current&&fD(qq,n,{originalEvent:r},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function qR(){const e=new CustomEvent(x0);document.dispatchEvent(e)}function fD(e,t,n,{discrete:i}){const s=n.originalEvent.target,r=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&s.addEventListener(e,t,{once:!0}),i?zq(s,r):s.dispatchEvent(r)}function Yq(e){const t=Qq(e),n=P.forwardRef((i,s)=>{const{children:r,...a}=i,o=P.Children.toArray(r),l=o.find(Xq);if(l){const u=l.props.children,h=o.map(f=>f===l?P.Children.count(u)>1?P.Children.only(null):P.isValidElement(u)?u.props.children:null:f);return b.jsx(t,{...a,ref:s,children:P.isValidElement(u)?P.cloneElement(u,void 0,h):null})}return b.jsx(t,{...a,ref:s,children:r})});return n.displayName=`${e}.Slot`,n}function Qq(e){const t=P.forwardRef((n,i)=>{const{children:s,...r}=n;if(P.isValidElement(s)){const a=eV(s),o=Zq(r,s.props);return s.type!==P.Fragment&&(o.ref=i?Dc(i,a):a),P.cloneElement(s,o)}return P.Children.count(s)>1?P.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Jq=Symbol("radix.slottable");function Xq(e){return P.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Jq}function Zq(e,t){const n={...t};for(const i in t){const s=e[i],r=t[i];/^on[A-Z]/.test(i)?s&&r?n[i]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(n[i]=s):i==="style"?n[i]={...s,...r}:i==="className"&&(n[i]=[s,r].filter(Boolean).join(" "))}return{...e,...n}}function eV(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var tV=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nV=tV.reduce((e,t)=>{const n=Yq(`Primitive.${t}`),i=P.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(l,{...o,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{}),Ay="focusScope.autoFocusOnMount",My="focusScope.autoFocusOnUnmount",VR={bubbles:!1,cancelable:!0},iV="FocusScope",pD=P.forwardRef((e,t)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:s,onUnmountAutoFocus:r,...a}=e,[o,l]=P.useState(null),u=xs(s),h=xs(r),f=P.useRef(null),m=Es(t,S=>l(S)),g=P.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;P.useEffect(()=>{if(i){let S=function(x){if(g.paused||!o)return;const k=x.target;o.contains(k)?f.current=k:yo(f.current,{select:!0})},v=function(x){if(g.paused||!o)return;const k=x.relatedTarget;k!==null&&(o.contains(k)||yo(f.current,{select:!0}))},_=function(x){if(document.activeElement===document.body)for(const A of x)A.removedNodes.length>0&&yo(o)};document.addEventListener("focusin",S),document.addEventListener("focusout",v);const w=new MutationObserver(_);return o&&w.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",S),document.removeEventListener("focusout",v),w.disconnect()}}},[i,o,g.paused]),P.useEffect(()=>{if(o){GR.add(g);const S=document.activeElement;if(!o.contains(S)){const _=new CustomEvent(Ay,VR);o.addEventListener(Ay,u),o.dispatchEvent(_),_.defaultPrevented||(sV(cV(mD(o)),{select:!0}),document.activeElement===S&&yo(o))}return()=>{o.removeEventListener(Ay,u),setTimeout(()=>{const _=new CustomEvent(My,VR);o.addEventListener(My,h),o.dispatchEvent(_),_.defaultPrevented||yo(S??document.body,{select:!0}),o.removeEventListener(My,h),GR.remove(g)},0)}}},[o,u,h,g]);const C=P.useCallback(S=>{if(!n&&!i||g.paused)return;const v=S.key==="Tab"&&!S.altKey&&!S.ctrlKey&&!S.metaKey,_=document.activeElement;if(v&&_){const w=S.currentTarget,[x,k]=rV(w);x&&k?!S.shiftKey&&_===k?(S.preventDefault(),n&&yo(x,{select:!0})):S.shiftKey&&_===x&&(S.preventDefault(),n&&yo(k,{select:!0})):_===w&&S.preventDefault()}},[n,i,g.paused]);return b.jsx(nV.div,{tabIndex:-1,...a,ref:m,onKeyDown:C})});pD.displayName=iV;function sV(e,{select:t=!1}={}){const n=document.activeElement;for(const i of e)if(yo(i,{select:t}),document.activeElement!==n)return}function rV(e){const t=mD(e),n=WR(t,e),i=WR(t.reverse(),e);return[n,i]}function mD(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const s=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||s?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function WR(e,t){for(const n of e)if(!oV(n,{upTo:t}))return n}function oV(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function aV(e){return e instanceof HTMLInputElement&&"select"in e}function yo(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&aV(e)&&t&&e.select()}}var GR=lV();function lV(){let e=[];return{add(t){const n=e[0];t!==n&&n?.pause(),e=KR(e,t),e.unshift(t)},remove(t){e=KR(e,t),e[0]?.resume()}}}function KR(e,t){const n=[...e],i=n.indexOf(t);return i!==-1&&n.splice(i,1),n}function cV(e){return e.filter(t=>t.tagName!=="A")}function uV(e){const t=dV(e),n=P.forwardRef((i,s)=>{const{children:r,...a}=i,o=P.Children.toArray(r),l=o.find(fV);if(l){const u=l.props.children,h=o.map(f=>f===l?P.Children.count(u)>1?P.Children.only(null):P.isValidElement(u)?u.props.children:null:f);return b.jsx(t,{...a,ref:s,children:P.isValidElement(u)?P.cloneElement(u,void 0,h):null})}return b.jsx(t,{...a,ref:s,children:r})});return n.displayName=`${e}.Slot`,n}function dV(e){const t=P.forwardRef((n,i)=>{const{children:s,...r}=n;if(P.isValidElement(s)){const a=mV(s),o=pV(r,s.props);return s.type!==P.Fragment&&(o.ref=i?Dc(i,a):a),P.cloneElement(s,o)}return P.Children.count(s)>1?P.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var hV=Symbol("radix.slottable");function fV(e){return P.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===hV}function pV(e,t){const n={...t};for(const i in t){const s=e[i],r=t[i];/^on[A-Z]/.test(i)?s&&r?n[i]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(n[i]=s):i==="style"?n[i]={...s,...r}:i==="className"&&(n[i]=[s,r].filter(Boolean).join(" "))}return{...e,...n}}function mV(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var gV=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],vV=gV.reduce((e,t)=>{const n=uV(`Primitive.${t}`),i=P.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(l,{...o,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{}),bV="Portal",gD=P.forwardRef((e,t)=>{const{container:n,...i}=e,[s,r]=P.useState(!1);jd(()=>r(!0),[]);const a=n||s&&globalThis?.document?.body;return a?L6.createPortal(b.jsx(vV.div,{...i,ref:t}),a):null});gD.displayName=bV;function yV(e,t){return P.useReducer((n,i)=>t[n][i]??n,e)}var ng=e=>{const{present:t,children:n}=e,i=_V(t),s=typeof n=="function"?n({present:i.isPresent}):P.Children.only(n),r=Es(i.ref,SV(s));return typeof n=="function"||i.isPresent?P.cloneElement(s,{ref:r}):null};ng.displayName="Presence";function _V(e){const[t,n]=P.useState(),i=P.useRef(null),s=P.useRef(e),r=P.useRef("none"),a=e?"mounted":"unmounted",[o,l]=yV(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return P.useEffect(()=>{const u=Hf(i.current);r.current=o==="mounted"?u:"none"},[o]),jd(()=>{const u=i.current,h=s.current;if(h!==e){const m=r.current,g=Hf(u);e?l("MOUNT"):g==="none"||u?.display==="none"?l("UNMOUNT"):l(h&&m!==g?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,l]),jd(()=>{if(t){let u;const h=t.ownerDocument.defaultView??window,f=g=>{const S=Hf(i.current).includes(CSS.escape(g.animationName));if(g.target===t&&S&&(l("ANIMATION_END"),!s.current)){const v=t.style.animationFillMode;t.style.animationFillMode="forwards",u=h.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=v)})}},m=g=>{g.target===t&&(r.current=Hf(i.current))};return t.addEventListener("animationstart",m),t.addEventListener("animationcancel",f),t.addEventListener("animationend",f),()=>{h.clearTimeout(u),t.removeEventListener("animationstart",m),t.removeEventListener("animationcancel",f),t.removeEventListener("animationend",f)}}else l("ANIMATION_END")},[t,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:P.useCallback(u=>{i.current=u?getComputedStyle(u):null,n(u)},[])}}function Hf(e){return e?.animationName||"none"}function SV(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function vD(e){const t=CV(e),n=P.forwardRef((i,s)=>{const{children:r,...a}=i,o=P.Children.toArray(r),l=o.find(wV);if(l){const u=l.props.children,h=o.map(f=>f===l?P.Children.count(u)>1?P.Children.only(null):P.isValidElement(u)?u.props.children:null:f);return b.jsx(t,{...a,ref:s,children:P.isValidElement(u)?P.cloneElement(u,void 0,h):null})}return b.jsx(t,{...a,ref:s,children:r})});return n.displayName=`${e}.Slot`,n}function CV(e){const t=P.forwardRef((n,i)=>{const{children:s,...r}=n;if(P.isValidElement(s)){const a=TV(s),o=kV(r,s.props);return s.type!==P.Fragment&&(o.ref=i?Dc(i,a):a),P.cloneElement(s,o)}return P.Children.count(s)>1?P.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var xV=Symbol("radix.slottable");function wV(e){return P.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===xV}function kV(e,t){const n={...t};for(const i in t){const s=e[i],r=t[i];/^on[A-Z]/.test(i)?s&&r?n[i]=(...o)=>{const l=r(...o);return s(...o),l}:s&&(n[i]=s):i==="style"?n[i]={...s,...r}:i==="className"&&(n[i]=[s,r].filter(Boolean).join(" "))}return{...e,...n}}function TV(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var EV=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nh=EV.reduce((e,t)=>{const n=vD(`Primitive.${t}`),i=P.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(l,{...o,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{}),Ly=0;function RV(){P.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??YR()),document.body.insertAdjacentElement("beforeend",e[1]??YR()),Ly++,()=>{Ly===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),Ly--}},[])}function YR(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var zs=function(){return zs=Object.assign||function(t){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},zs.apply(this,arguments)};function bD(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n}function AV(e,t,n){if(n||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var Lp="right-scroll-bar-position",Ip="width-before-scroll-bar",MV="with-scroll-bars-hidden",LV="--removed-body-scroll-bar-size";function Iy(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function IV(e,t){var n=P.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(i){var s=n.value;s!==i&&(n.value=i,n.callback(i,s))}}}})[0];return n.callback=t,n.facade}var PV=typeof window<"u"?P.useLayoutEffect:P.useEffect,QR=new WeakMap;function DV(e,t){var n=IV(null,function(i){return e.forEach(function(s){return Iy(s,i)})});return PV(function(){var i=QR.get(n);if(i){var s=new Set(i),r=new Set(e),a=n.current;s.forEach(function(o){r.has(o)||Iy(o,null)}),r.forEach(function(o){s.has(o)||Iy(o,a)})}QR.set(n,e)},[e]),n}function OV(e){return e}function NV(e,t){t===void 0&&(t=OV);var n=[],i=!1,s={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(r){var a=t(r,i);return n.push(a),function(){n=n.filter(function(o){return o!==a})}},assignSyncMedium:function(r){for(i=!0;n.length;){var a=n;n=[],a.forEach(r)}n={push:function(o){return r(o)},filter:function(){return n}}},assignMedium:function(r){i=!0;var a=[];if(n.length){var o=n;n=[],o.forEach(r),a=n}var l=function(){var h=a;a=[],h.forEach(r)},u=function(){return Promise.resolve().then(l)};u(),n={push:function(h){a.push(h),u()},filter:function(h){return a=a.filter(h),n}}}};return s}function jV(e){e===void 0&&(e={});var t=NV(null);return t.options=zs({async:!0,ssr:!1},e),t}var yD=function(e){var t=e.sideCar,n=bD(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=t.read();if(!i)throw new Error("Sidecar medium not found");return P.createElement(i,zs({},n))};yD.isSideCarExport=!0;function BV(e,t){return e.useMedium(t),yD}var _D=jV(),Py=function(){},ig=P.forwardRef(function(e,t){var n=P.useRef(null),i=P.useState({onScrollCapture:Py,onWheelCapture:Py,onTouchMoveCapture:Py}),s=i[0],r=i[1],a=e.forwardProps,o=e.children,l=e.className,u=e.removeScrollBar,h=e.enabled,f=e.shards,m=e.sideCar,g=e.noRelative,C=e.noIsolation,S=e.inert,v=e.allowPinchZoom,_=e.as,w=_===void 0?"div":_,x=e.gapMode,k=bD(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),A=m,T=DV([n,t]),M=zs(zs({},k),s);return P.createElement(P.Fragment,null,h&&P.createElement(A,{sideCar:_D,removeScrollBar:u,shards:f,noRelative:g,noIsolation:C,inert:S,setCallbacks:r,allowPinchZoom:!!v,lockRef:n,gapMode:x}),a?P.cloneElement(P.Children.only(o),zs(zs({},M),{ref:T})):P.createElement(w,zs({},M,{className:l,ref:T}),o))});ig.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};ig.classNames={fullWidth:Ip,zeroRight:Lp};var FV=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function UV(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=FV();return t&&e.setAttribute("nonce",t),e}function zV(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function HV(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var $V=function(){var e=0,t=null;return{add:function(n){e==0&&(t=UV())&&(zV(t,n),HV(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},qV=function(){var e=$V();return function(t,n){P.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},SD=function(){var e=qV(),t=function(n){var i=n.styles,s=n.dynamic;return e(i,s),null};return t},VV={left:0,top:0,right:0,gap:0},Dy=function(e){return parseInt(e||"",10)||0},WV=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],i=t[e==="padding"?"paddingTop":"marginTop"],s=t[e==="padding"?"paddingRight":"marginRight"];return[Dy(n),Dy(i),Dy(s)]},GV=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return VV;var t=WV(e),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,i-n+t[2]-t[0])}},KV=SD(),gc="data-scroll-locked",YV=function(e,t,n,i){var s=e.left,r=e.top,a=e.right,o=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(MV,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(o,"px ").concat(i,`;
  }
  body[`).concat(gc,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(r,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(o,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Lp,` {
    right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(Ip,` {
    margin-right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(Lp," .").concat(Lp,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(Ip," .").concat(Ip,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(gc,`] {
    `).concat(LV,": ").concat(o,`px;
  }
`)},JR=function(){var e=parseInt(document.body.getAttribute(gc)||"0",10);return isFinite(e)?e:0},QV=function(){P.useEffect(function(){return document.body.setAttribute(gc,(JR()+1).toString()),function(){var e=JR()-1;e<=0?document.body.removeAttribute(gc):document.body.setAttribute(gc,e.toString())}},[])},JV=function(e){var t=e.noRelative,n=e.noImportant,i=e.gapMode,s=i===void 0?"margin":i;QV();var r=P.useMemo(function(){return GV(s)},[s]);return P.createElement(KV,{styles:YV(r,!t,s,n?"":"!important")})},w0=!1;if(typeof window<"u")try{var $f=Object.defineProperty({},"passive",{get:function(){return w0=!0,!0}});window.addEventListener("test",$f,$f),window.removeEventListener("test",$f,$f)}catch{w0=!1}var Vl=w0?{passive:!1}:!1,XV=function(e){return e.tagName==="TEXTAREA"},CD=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!XV(e)&&n[t]==="visible")},ZV=function(e){return CD(e,"overflowY")},eW=function(e){return CD(e,"overflowX")},XR=function(e,t){var n=t.ownerDocument,i=t;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var s=xD(e,i);if(s){var r=wD(e,i),a=r[1],o=r[2];if(a>o)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},tW=function(e){var t=e.scrollTop,n=e.scrollHeight,i=e.clientHeight;return[t,n,i]},nW=function(e){var t=e.scrollLeft,n=e.scrollWidth,i=e.clientWidth;return[t,n,i]},xD=function(e,t){return e==="v"?ZV(t):eW(t)},wD=function(e,t){return e==="v"?tW(t):nW(t)},iW=function(e,t){return e==="h"&&t==="rtl"?-1:1},sW=function(e,t,n,i,s){var r=iW(e,window.getComputedStyle(t).direction),a=r*i,o=n.target,l=t.contains(o),u=!1,h=a>0,f=0,m=0;do{if(!o)break;var g=wD(e,o),C=g[0],S=g[1],v=g[2],_=S-v-r*C;(C||_)&&xD(e,o)&&(f+=_,m+=C);var w=o.parentNode;o=w&&w.nodeType===Node.DOCUMENT_FRAGMENT_NODE?w.host:w}while(!l&&o!==document.body||l&&(t.contains(o)||t===o));return(h&&Math.abs(f)<1||!h&&Math.abs(m)<1)&&(u=!0),u},qf=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},ZR=function(e){return[e.deltaX,e.deltaY]},eA=function(e){return e&&"current"in e?e.current:e},rW=function(e,t){return e[0]===t[0]&&e[1]===t[1]},oW=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},aW=0,Wl=[];function lW(e){var t=P.useRef([]),n=P.useRef([0,0]),i=P.useRef(),s=P.useState(aW++)[0],r=P.useState(SD)[0],a=P.useRef(e);P.useEffect(function(){a.current=e},[e]),P.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var S=AV([e.lockRef.current],(e.shards||[]).map(eA),!0).filter(Boolean);return S.forEach(function(v){return v.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),S.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var o=P.useCallback(function(S,v){if("touches"in S&&S.touches.length===2||S.type==="wheel"&&S.ctrlKey)return!a.current.allowPinchZoom;var _=qf(S),w=n.current,x="deltaX"in S?S.deltaX:w[0]-_[0],k="deltaY"in S?S.deltaY:w[1]-_[1],A,T=S.target,M=Math.abs(x)>Math.abs(k)?"h":"v";if("touches"in S&&M==="h"&&T.type==="range")return!1;var E=window.getSelection(),L=E&&E.anchorNode,D=L?L===T||L.contains(T):!1;if(D)return!1;var O=XR(M,T);if(!O)return!0;if(O?A=M:(A=M==="v"?"h":"v",O=XR(M,T)),!O)return!1;if(!i.current&&"changedTouches"in S&&(x||k)&&(i.current=A),!A)return!0;var j=i.current||A;return sW(j,v,S,j==="h"?x:k)},[]),l=P.useCallback(function(S){var v=S;if(!(!Wl.length||Wl[Wl.length-1]!==r)){var _="deltaY"in v?ZR(v):qf(v),w=t.current.filter(function(A){return A.name===v.type&&(A.target===v.target||v.target===A.shadowParent)&&rW(A.delta,_)})[0];if(w&&w.should){v.cancelable&&v.preventDefault();return}if(!w){var x=(a.current.shards||[]).map(eA).filter(Boolean).filter(function(A){return A.contains(v.target)}),k=x.length>0?o(v,x[0]):!a.current.noIsolation;k&&v.cancelable&&v.preventDefault()}}},[]),u=P.useCallback(function(S,v,_,w){var x={name:S,delta:v,target:_,should:w,shadowParent:cW(_)};t.current.push(x),setTimeout(function(){t.current=t.current.filter(function(k){return k!==x})},1)},[]),h=P.useCallback(function(S){n.current=qf(S),i.current=void 0},[]),f=P.useCallback(function(S){u(S.type,ZR(S),S.target,o(S,e.lockRef.current))},[]),m=P.useCallback(function(S){u(S.type,qf(S),S.target,o(S,e.lockRef.current))},[]);P.useEffect(function(){return Wl.push(r),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:m}),document.addEventListener("wheel",l,Vl),document.addEventListener("touchmove",l,Vl),document.addEventListener("touchstart",h,Vl),function(){Wl=Wl.filter(function(S){return S!==r}),document.removeEventListener("wheel",l,Vl),document.removeEventListener("touchmove",l,Vl),document.removeEventListener("touchstart",h,Vl)}},[]);var g=e.removeScrollBar,C=e.inert;return P.createElement(P.Fragment,null,C?P.createElement(r,{styles:oW(s)}):null,g?P.createElement(JV,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function cW(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const uW=BV(_D,lW);var kD=P.forwardRef(function(e,t){return P.createElement(ig,zs({},e,{ref:t,sideCar:uW}))});kD.classNames=ig.classNames;var dW=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Gl=new WeakMap,Vf=new WeakMap,Wf={},Oy=0,TD=function(e){return e&&(e.host||TD(e.parentNode))},hW=function(e,t){return t.map(function(n){if(e.contains(n))return n;var i=TD(n);return i&&e.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},fW=function(e,t,n,i){var s=hW(t,Array.isArray(e)?e:[e]);Wf[n]||(Wf[n]=new WeakMap);var r=Wf[n],a=[],o=new Set,l=new Set(s),u=function(f){!f||o.has(f)||(o.add(f),u(f.parentNode))};s.forEach(u);var h=function(f){!f||l.has(f)||Array.prototype.forEach.call(f.children,function(m){if(o.has(m))h(m);else try{var g=m.getAttribute(i),C=g!==null&&g!=="false",S=(Gl.get(m)||0)+1,v=(r.get(m)||0)+1;Gl.set(m,S),r.set(m,v),a.push(m),S===1&&C&&Vf.set(m,!0),v===1&&m.setAttribute(n,"true"),C||m.setAttribute(i,"true")}catch(_){console.error("aria-hidden: cannot operate on ",m,_)}})};return h(t),o.clear(),Oy++,function(){a.forEach(function(f){var m=Gl.get(f)-1,g=r.get(f)-1;Gl.set(f,m),r.set(f,g),m||(Vf.has(f)||f.removeAttribute(i),Vf.delete(f)),g||f.removeAttribute(n)}),Oy--,Oy||(Gl=new WeakMap,Gl=new WeakMap,Vf=new WeakMap,Wf={})}},pW=function(e,t,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(e)?e:[e]),s=dW(e);return s?(i.push.apply(i,Array.from(s.querySelectorAll("[aria-live], script"))),fW(i,s,n,"aria-hidden")):function(){return null}},sg="Dialog",[ED]=Tq(sg),[mW,Rs]=ED(sg),RD=e=>{const{__scopeDialog:t,children:n,open:i,defaultOpen:s,onOpenChange:r,modal:a=!0}=e,o=P.useRef(null),l=P.useRef(null),[u,h]=Lq({prop:i,defaultProp:s??!1,onChange:r,caller:sg});return b.jsx(mW,{scope:t,triggerRef:o,contentRef:l,contentId:Ry(),titleId:Ry(),descriptionId:Ry(),open:u,onOpenChange:h,onOpenToggle:P.useCallback(()=>h(f=>!f),[h]),modal:a,children:n})};RD.displayName=sg;var AD="DialogTrigger",MD=P.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=Rs(AD,n),r=Es(t,s.triggerRef);return b.jsx(nh.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":hC(s.open),...i,ref:r,onClick:Di(e.onClick,s.onOpenToggle)})});MD.displayName=AD;var uC="DialogPortal",[gW,LD]=ED(uC,{forceMount:void 0}),ID=e=>{const{__scopeDialog:t,forceMount:n,children:i,container:s}=e,r=Rs(uC,t);return b.jsx(gW,{scope:t,forceMount:n,children:P.Children.map(i,a=>b.jsx(ng,{present:n||r.open,children:b.jsx(gD,{asChild:!0,container:s,children:a})}))})};ID.displayName=uC;var hm="DialogOverlay",PD=P.forwardRef((e,t)=>{const n=LD(hm,e.__scopeDialog),{forceMount:i=n.forceMount,...s}=e,r=Rs(hm,e.__scopeDialog);return r.modal?b.jsx(ng,{present:i||r.open,children:b.jsx(bW,{...s,ref:t})}):null});PD.displayName=hm;var vW=vD("DialogOverlay.RemoveScroll"),bW=P.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=Rs(hm,n);return b.jsx(kD,{as:vW,allowPinchZoom:!0,shards:[s.contentRef],children:b.jsx(nh.div,{"data-state":hC(s.open),...i,ref:t,style:{pointerEvents:"auto",...i.style}})})}),qa="DialogContent",DD=P.forwardRef((e,t)=>{const n=LD(qa,e.__scopeDialog),{forceMount:i=n.forceMount,...s}=e,r=Rs(qa,e.__scopeDialog);return b.jsx(ng,{present:i||r.open,children:r.modal?b.jsx(yW,{...s,ref:t}):b.jsx(_W,{...s,ref:t})})});DD.displayName=qa;var yW=P.forwardRef((e,t)=>{const n=Rs(qa,e.__scopeDialog),i=P.useRef(null),s=Es(t,n.contentRef,i);return P.useEffect(()=>{const r=i.current;if(r)return pW(r)},[]),b.jsx(OD,{...e,ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Di(e.onCloseAutoFocus,r=>{r.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Di(e.onPointerDownOutside,r=>{const a=r.detail.originalEvent,o=a.button===0&&a.ctrlKey===!0;(a.button===2||o)&&r.preventDefault()}),onFocusOutside:Di(e.onFocusOutside,r=>r.preventDefault())})}),_W=P.forwardRef((e,t)=>{const n=Rs(qa,e.__scopeDialog),i=P.useRef(!1),s=P.useRef(!1);return b.jsx(OD,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{e.onCloseAutoFocus?.(r),r.defaultPrevented||(i.current||n.triggerRef.current?.focus(),r.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:r=>{e.onInteractOutside?.(r),r.defaultPrevented||(i.current=!0,r.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const a=r.target;n.triggerRef.current?.contains(a)&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&s.current&&r.preventDefault()}})}),OD=P.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:r,...a}=e,o=Rs(qa,n),l=P.useRef(null),u=Es(t,l);return RV(),b.jsxs(b.Fragment,{children:[b.jsx(pD,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:r,children:b.jsx(hD,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":hC(o.open),...a,ref:u,onDismiss:()=>o.onOpenChange(!1)})}),b.jsxs(b.Fragment,{children:[b.jsx(CW,{titleId:o.titleId}),b.jsx(wW,{contentRef:l,descriptionId:o.descriptionId})]})]})}),dC="DialogTitle",ND=P.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=Rs(dC,n);return b.jsx(nh.h2,{id:s.titleId,...i,ref:t})});ND.displayName=dC;var jD="DialogDescription",BD=P.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=Rs(jD,n);return b.jsx(nh.p,{id:s.descriptionId,...i,ref:t})});BD.displayName=jD;var FD="DialogClose",SW=P.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=Rs(FD,n);return b.jsx(nh.button,{type:"button",...i,ref:t,onClick:Di(e.onClick,()=>s.onOpenChange(!1))})});SW.displayName=FD;function hC(e){return e?"open":"closed"}var UD="DialogTitleWarning",[lpe,zD]=kq(UD,{contentName:qa,titleName:dC,docsSlug:"dialog"}),CW=({titleId:e})=>{const t=zD(UD),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return P.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},xW="DialogDescriptionWarning",wW=({contentRef:e,descriptionId:t})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${zD(xW).contentName}}.`;return P.useEffect(()=>{const s=e.current?.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(i))},[i,e,t]),null},kW=RD,TW=MD,EW=ID,RW=PD,AW=DD,MW=ND,LW=BD;const Ja=kW,rg=TW,Ho=P.forwardRef(({className:e,...t},n)=>b.jsxs(EW,{children:[b.jsx(RW,{className:"fixed inset-0 z-50 bg-black/50"}),b.jsx(AW,{ref:n,className:Be("fixed left-1/2 top-1/2 z-50 w-[calc(100vw-24px)] max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-xl bg-[var(--app-secondary-bg)] p-4 shadow-2xl",e),...t})]}));Ho.displayName="DialogContent";const Xa=({className:e,...t})=>b.jsx("div",{className:Be("flex flex-col space-y-1.5 text-center sm:text-left",e),...t}),$o=P.forwardRef(({className:e,...t},n)=>b.jsx(MW,{ref:n,className:Be("text-base font-semibold leading-none tracking-tight",e),...t}));$o.displayName="DialogTitle";const ih=P.forwardRef(({className:e,...t},n)=>b.jsx(LW,{ref:n,className:Be("text-sm text-[var(--app-hint)]",e),...t}));ih.displayName="DialogDescription";function Ny(e){const{t}=ot(),n=e.mode==="bind",[i,s]=P.useState(""),[r,a]=P.useState(!1),[o,l]=P.useState(null),[u,h]=P.useState(!1),[f,m]=P.useState(e.serverUrl??""),[g,C]=P.useState(null),S=P.useCallback(async E=>{E.preventDefault();const L=i.trim();if(!L){l(t("login.error.enterToken"));return}if(!n&&e.requireServerUrl&&!e.serverUrl){C(t("login.server.required")),h(!0);return}a(!0),l(null);try{if(n){if(!e.onBind){l(t("login.error.bindingUnavailable"));return}await e.onBind(L)}else{if(await new Qu("",{baseUrl:e.baseUrl}).authenticate({accessToken:L}),!e.onLogin){l(t("login.error.loginUnavailable"));return}e.onLogin(L)}}catch(D){const O=t(n?"login.error.bindFailed":"login.error.authFailed");l(D instanceof Error?D.message:O)}finally{a(!1)}},[i,e,t,n]);P.useEffect(()=>{u&&m(e.serverUrl??"")},[u,e.serverUrl]);const v=P.useCallback(E=>{E.preventDefault();const L=e.setServerUrl(f);if(!L.ok){C(L.error);return}C(null),m(L.value),h(!1)},[e,f]),_=P.useCallback(()=>{e.clearServerUrl(),m(""),C(null),h(!1)},[e]),w=P.useCallback(E=>{h(E),E||C(null)},[]),x=o||e.error,k=e.serverUrl??`${e.baseUrl} ${t("login.server.default")}`,A=t(n?"login.bind.title":"login.title"),T=t("login.subtitle"),M=t(n?"login.bind.submit":"login.submit");return b.jsxs("div",{className:"relative h-full flex items-center justify-center p-4",children:[b.jsx("div",{className:"absolute top-4 right-4",children:b.jsx(E9,{})}),b.jsxs("div",{className:"w-full max-w-sm space-y-6",children:[b.jsxs("div",{className:"text-center space-y-2",children:[b.jsx("div",{className:"text-2xl font-semibold",children:A}),b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:T})]}),b.jsxs("form",{onSubmit:S,className:"space-y-4",children:[b.jsx("div",{children:b.jsx("input",{type:"password",value:i,onChange:E=>s(E.target.value),placeholder:t("login.placeholder"),autoComplete:"current-password",disabled:r,className:"w-full px-3 py-2.5 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"})}),x&&b.jsx("div",{className:"text-sm text-red-500 text-center",children:x}),b.jsx("button",{type:"submit",disabled:r||!i.trim(),"aria-busy":r,className:"w-full py-2.5 rounded-lg bg-[var(--app-button)] text-[var(--app-button-text)] font-medium disabled:opacity-50 hover:opacity-90 transition-opacity inline-flex items-center justify-center gap-2",children:r?b.jsxs(b.Fragment,{children:[b.jsx(Ur,{size:"sm",label:null,className:"text-[var(--app-button-text)]"}),t(n?"login.bind.submitting":"login.submitting")]}):M})]}),!n&&b.jsxs("div",{className:"flex items-center justify-between text-xs text-[var(--app-hint)]",children:[b.jsx("a",{href:"https://developers.openai.com/codex",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-[var(--app-fg)]",children:t("login.help")}),b.jsxs(Ja,{open:u,onOpenChange:w,children:[b.jsx(rg,{asChild:!0,children:b.jsxs("button",{type:"button",className:"underline hover:text-[var(--app-fg)]",children:["Hub ",e.serverUrl?`${t("login.server.custom")}`:`${t("login.server.default")}`]})}),b.jsxs(Ho,{className:"max-w-md",children:[b.jsxs(Xa,{children:[b.jsx($o,{children:t("login.server.title")}),b.jsx(ih,{children:t("login.server.description")})]}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{className:"text-xs text-[var(--app-hint)]",children:[t("login.server.current")," ",k]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-xs font-medium",children:t("login.server.origin")}),b.jsx("input",{type:"url",value:f,onChange:E=>{m(E.target.value),C(null)},placeholder:t("login.server.placeholder"),className:"w-full px-3 py-2.5 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent"}),b.jsx("div",{className:"text-[11px] text-[var(--app-hint)]",children:t("login.server.hint")})]}),g&&b.jsx("div",{className:"text-sm text-red-500",children:g}),b.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.serverUrl&&b.jsx(Rn,{type:"button",variant:"outline",onClick:_,children:t("login.server.useSameOrigin")}),b.jsx(Rn,{type:"submit",children:t("login.server.save")})]})]})]})]})]})]}),b.jsxs("div",{className:"absolute bottom-4 left-0 right-0 text-center text-xs text-[var(--app-hint)] space-y-1",children:[b.jsxs("div",{children:[t("login.footer")," ",b.jsx("span",{className:"text-red-500",children:""})," ",t("login.footer.for")]}),b.jsxs("div",{children:[t("login.footer.copyright")," ",new Date().getFullYear()," Codex"]})]})]})}const HD="pwa_install_dismissed";function IW(){if(typeof window>"u")return!1;const e=window.navigator.userAgent,t=/iPad|iPhone|iPod/.test(e),n=/WebKit/.test(e),i=/CriOS/.test(e),s=/FxiOS/.test(e);return t&&n&&!i&&!s}function PW(){try{return localStorage.getItem(HD)==="true"}catch{return!1}}function DW(){try{localStorage.setItem(HD,"true")}catch{}}function $D(){const[e,t]=P.useState("idle"),[n,i]=P.useState(null),[s,r]=P.useState(()=>PW()),a=typeof window<"u"&&IW(),o=typeof window<"u"&&(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0);P.useEffect(()=>{if(o){t("installed");return}const h=m=>{m.preventDefault(),i(m),t("available")},f=()=>{t("installed"),i(null)};return window.addEventListener("beforeinstallprompt",h),window.addEventListener("appinstalled",f),()=>{window.removeEventListener("beforeinstallprompt",h),window.removeEventListener("appinstalled",f)}},[o]);const l=P.useCallback(async()=>{if(!n)return!1;const h=n;i(null),t("installing");try{await h.prompt();const{outcome:f}=await h.userChoice;return f==="accepted"?(t("installed"),!0):(t("idle"),!1)}catch{return t("idle"),!1}},[n]),u=P.useCallback(()=>{r(!0),DW()},[]);return{installState:e,canInstall:e==="available"&&!s,canInstallIOS:a&&!o&&!s,isStandalone:o,isIOS:a,promptInstall:l,dismissInstall:u}}const jy={light:10,medium:20,heavy:30,rigid:15,soft:10,success:20,warning:[20,50,20],error:[30,50,30],selection:5};function By(e){navigator.vibrate?.(e)}const OW={impact:e=>{const t=$s();t?.HapticFeedback?t.HapticFeedback.impactOccurred(e):By(jy[e])},notification:e=>{const t=$s();t?.HapticFeedback?t.HapticFeedback.notificationOccurred(e):By(jy[e])},selection:()=>{const e=$s();e?.HapticFeedback?e.HapticFeedback.selectionChanged():By(jy.selection)}};function er(){const e=P.useMemo(()=>SS(),[]),t=P.useMemo(()=>typeof window<"u"&&window.matchMedia("(pointer: coarse)").matches,[]);return{isTelegram:e,isTouch:t,haptic:OW}}function sh(e,t,n=1.5){return b.jsx("svg",{className:t.className??"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",children:e})}function Fy(e){return sh(b.jsx("path",{d:"M6 18 18 6M6 6l12 12"}),e,2)}function NW(e){return sh(b.jsx("path",{d:"M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3v12"}),e)}function jW(e){return sh(b.jsx("path",{d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),e)}function fm(e){return sh(b.jsxs(b.Fragment,{children:[b.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),b.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),e,2)}function pm(e){return sh(b.jsx("polyline",{points:"20 6 9 17 4 12"}),e,2)}function BW(){const{t:e}=ot(),{canInstall:t,canInstallIOS:n,promptInstall:i,dismissInstall:s,isStandalone:r}=$D(),{isTelegram:a,haptic:o}=er(),[l,u]=P.useState(!1);if(a||r)return null;if(n)return l?b.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end justify-center",children:b.jsxs("div",{className:"w-full max-w-lg bg-[var(--app-bg)] rounded-t-2xl p-5 pb-8 space-y-4 animate-slide-up",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("h3",{className:"text-base font-semibold text-[var(--app-fg)]",children:e("install.title")}),b.jsx("button",{onClick:()=>u(!1),className:"p-1 -mr-1 text-[var(--app-hint)] active:opacity-60","aria-label":"Close",children:b.jsx(Fy,{className:"w-5 h-5"})})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-start gap-3",children:[b.jsx("div",{className:"shrink-0 w-8 h-8 rounded-full bg-[var(--app-fg)] text-[var(--app-bg)] flex items-center justify-center text-sm font-medium",children:"1"}),b.jsx("div",{className:"flex-1 pt-1",children:b.jsxs("p",{className:"text-sm text-[var(--app-fg)]",children:["Tap the ",b.jsx(NW,{className:"inline w-5 h-5 align-text-bottom"})," Share button in the toolbar"]})})]}),b.jsxs("div",{className:"flex items-start gap-3",children:[b.jsx("div",{className:"shrink-0 w-8 h-8 rounded-full bg-[var(--app-fg)] text-[var(--app-bg)] flex items-center justify-center text-sm font-medium",children:"2"}),b.jsx("div",{className:"flex-1 pt-1",children:b.jsxs("p",{className:"text-sm text-[var(--app-fg)]",children:["Scroll down and tap ",b.jsx(jW,{className:"inline w-5 h-5 align-text-bottom"})," ",b.jsx("strong",{children:"Add to Home Screen"})]})})]}),b.jsxs("div",{className:"flex items-start gap-3",children:[b.jsx("div",{className:"shrink-0 w-8 h-8 rounded-full bg-[var(--app-fg)] text-[var(--app-bg)] flex items-center justify-center text-sm font-medium",children:"3"}),b.jsx("div",{className:"flex-1 pt-1",children:b.jsxs("p",{className:"text-sm text-[var(--app-fg)]",children:["Tap ",b.jsx("strong",{children:"Add"})," in the top right corner"]})})]})]}),b.jsx("button",{onClick:()=>{u(!1),s()},className:"w-full py-3 text-sm text-[var(--app-hint)] active:opacity-60",children:e("button.dismiss")})]})}):b.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-[var(--app-secondary-bg)] border border-[var(--app-border)] rounded-lg p-4 shadow-lg z-50",children:b.jsxs("div",{className:"flex items-center justify-between gap-3",children:[b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("p",{className:"text-sm font-medium text-[var(--app-fg)]",children:e("install.title")}),b.jsx("p",{className:"text-xs text-[var(--app-hint)] mt-0.5",children:e("install.description")})]}),b.jsx("button",{onClick:()=>{o.impact("light"),u(!0)},className:"shrink-0 px-4 py-2 bg-[var(--app-fg)] text-[var(--app-bg)] rounded-lg text-sm font-medium active:opacity-80",children:e("install.button")}),b.jsx("button",{onClick:()=>{o.impact("light"),s()},className:"shrink-0 p-2 text-[var(--app-hint)] active:opacity-60","aria-label":"Dismiss",children:b.jsx(Fy,{className:"w-4 h-4"})})]})});if(!t)return null;const h=async()=>{o.impact("light"),await i()&&o.notification("success")};return b.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-[var(--app-secondary-bg)] border border-[var(--app-border)] rounded-lg p-4 shadow-lg z-50",children:b.jsxs("div",{className:"flex items-center justify-between gap-3",children:[b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("p",{className:"text-sm font-medium text-[var(--app-fg)]",children:e("install.title")}),b.jsx("p",{className:"text-xs text-[var(--app-hint)] mt-0.5",children:e("install.description")})]}),b.jsx("button",{onClick:h,className:"shrink-0 px-4 py-2 bg-[var(--app-fg)] text-[var(--app-bg)] rounded-lg text-sm font-medium active:opacity-80",children:e("install.button")}),b.jsx("button",{onClick:()=>{o.impact("light"),s()},className:"shrink-0 p-2 text-[var(--app-hint)] active:opacity-60","aria-label":"Dismiss",children:b.jsx(Fy,{className:"w-4 h-4"})})]})})}function FW(e){return window.addEventListener("online",e),window.addEventListener("offline",e),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}}function UW(){return navigator.onLine}function zW(){return!0}function fC(){return P.useSyncExternalStore(FW,UW,zW)}function HW(){const{t:e}=ot();return fC()?null:b.jsx("div",{className:"fixed top-0 left-0 right-0 bg-amber-500 text-white text-center py-2 text-sm font-medium z-50",children:e("offline.message")})}function $W({isSyncing:e}){const{t}=ot(),n=fC();return!e||!n?null:b.jsxs("div",{className:"fixed top-0 left-0 right-0 bg-[var(--app-banner-bg)] text-[var(--app-banner-text)] text-center py-2 text-sm font-medium z-50 flex items-center justify-center gap-2 border-b border-[var(--app-divider)]",children:[b.jsx(Ur,{size:"sm",label:null,className:"text-[var(--app-banner-text)]"}),t("syncing.title")]})}function qW({isReconnecting:e}){const{t}=ot(),n=fC();return!e||!n?null:b.jsxs("div",{className:"fixed top-0 left-0 right-0 bg-amber-500 text-white text-center py-2 text-sm font-medium z-50 flex items-center justify-center gap-2",children:[b.jsx("span",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),t("reconnecting.message")]})}function VW(){const e=$P(),t=e&&e.status==="error"&&e.errorMessage;return P.useEffect(()=>{if(!t||!e)return;const n=setTimeout(()=>{e.setStatus("disconnected")},3e3);return()=>clearTimeout(n)},[t,e]),t?b.jsx("div",{className:"fixed top-0 left-0 right-0 bg-red-500 text-white text-center py-2 text-sm font-medium z-50 flex items-center justify-center border-b border-red-600",children:e.errorMessage}):null}function mm({label:e,className:t,spinnerSize:n="md"}){const{t:i}=ot(),s=e??i("loading");return b.jsxs("div",{className:Be("inline-flex items-center gap-2 text-[var(--app-hint)]",t),role:"status","aria-live":"polite",children:[b.jsx(Ur,{size:n,label:null}),b.jsx("span",{children:s})]})}const WW=cC("pointer-events-auto w-full max-w-sm rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] text-[var(--app-fg)] shadow-lg",{variants:{variant:{default:"border-[var(--app-border)] bg-[var(--app-bg)]"}},defaultVariants:{variant:"default"}});function GW({title:e,body:t,onClose:n,className:i,variant:s,...r}){const a=o=>{o.stopPropagation(),n?.()};return b.jsx("div",{className:Be(WW({variant:s}),i),role:"status",...r,children:b.jsxs("div",{className:"flex items-start gap-3 p-3",children:[b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"text-sm font-semibold leading-5",children:e}),b.jsx("div",{className:"mt-1 text-xs text-[var(--app-hint)]",children:t})]}),n?b.jsx("button",{type:"button",className:"text-xs text-[var(--app-hint)] hover:text-[var(--app-fg)]",onClick:a,"aria-label":"Dismiss",children:"x"}):null]})})}const qD=P.createContext(null),KW=6e3;function YW(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`toast_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}function QW({children:e}){const[t,n]=P.useState([]),i=P.useRef(new Map);P.useEffect(()=>()=>{for(const o of i.current.values())clearTimeout(o);i.current.clear()},[]);const s=P.useCallback(o=>{n(u=>u.filter(h=>h.id!==o));const l=i.current.get(o);l&&(clearTimeout(l),i.current.delete(o))},[]),r=P.useCallback(o=>{const l=YW();n(h=>[...h,{id:l,...o}]);const u=setTimeout(()=>{s(l)},KW);i.current.set(l,u)},[s]),a=P.useMemo(()=>({toasts:t,addToast:r,removeToast:s}),[t,r,s]);return b.jsx(qD.Provider,{value:a,children:e})}function pC(){const e=P.useContext(qD);if(!e)throw new Error("useToast must be used within ToastProvider");return e}function JW(){const e=Ts(),{toasts:t,removeToast:n}=pC();return t.length===0?null:b.jsx("div",{className:"pointer-events-none fixed inset-x-0 top-[calc(env(safe-area-inset-top)+1rem)] z-50 flex flex-col items-center gap-2 px-3","aria-live":"polite",children:t.map(i=>b.jsx(GW,{title:i.title,body:i.body,className:"cursor-pointer",onClick:()=>{if(n(i.id),i.sessionId){e({to:"/sessions/$sessionId",params:{sessionId:i.sessionId}});return}i.url&&e({to:i.url})},onClose:()=>n(i.id)},i.id))})}const Uy=x9();function XW(){return b.jsx(QW,{children:b.jsx(ZW,{})})}function ZW(){const{t:e}=ot(),{serverUrl:t,baseUrl:n,setServerUrl:i,clearServerUrl:s}=CU(),{authSource:r,isLoading:a,setAccessToken:o}=bU(n),{token:l,api:u,isLoading:h,error:f,needsBinding:m,bind:g}=hU(r,n),C=Ka(),S=kd({select:N=>N.pathname}),v=h2(),_=$n(),{addToast:w}=pC();P.useEffect(()=>{const N=$s();N?.ready(),N?.expand(),dU()},[]),P.useEffect(()=>{const N=H=>{H.preventDefault()},z=H=>{H.ctrlKey&&H.preventDefault()},G=H=>{(H.ctrlKey||H.metaKey)&&(H.key==="+"||H.key==="-"||H.key==="="||H.key==="0")&&H.preventDefault()};return document.addEventListener("gesturestart",N,{passive:!1}),document.addEventListener("gesturechange",N,{passive:!1}),document.addEventListener("gestureend",N,{passive:!1}),window.addEventListener("wheel",z,{passive:!1}),window.addEventListener("keydown",G),()=>{document.removeEventListener("gesturestart",N),document.removeEventListener("gesturechange",N),document.removeEventListener("gestureend",N),window.removeEventListener("wheel",z),window.removeEventListener("keydown",G)}},[]),P.useEffect(()=>{const z=$s()?.BackButton;if(z){if(S==="/"||S==="/sessions"){z.offClick(C),z.hide();return}return z.show(),z.onClick(C),()=>{z.offClick(C),z.hide()}}},[C,S]);const x=Fr(),k=v({to:"/sessions/$sessionId"}),A=k&&k.sessionId!=="new"?k.sessionId:null,{isSyncing:T,startSync:M,endSync:E}=c8(),[L,D]=P.useState(!1),O=P.useRef(0),j=P.useRef(!0),U=P.useRef(n);P.useEffect(()=>{U.current!==n&&(U.current=n,j.current=!0,O.current=0,x.clear())},[n,x]),P.useEffect(()=>{if(!l||!u)return;const{pathname:N,search:z,hash:G,state:H}=_.history.location,ee=new URLSearchParams(z);if(!ee.has("server")&&!ee.has("hub")&&!ee.has("token"))return;ee.delete("server"),ee.delete("hub"),ee.delete("token");const ue=ee.toString(),ce=`${N}${ue?`?${ue}`:""}${G}`;_.history.replace(ce,H)},[l,u,_]);const q=P.useCallback(()=>{D(!1);const N=++O.current;j.current?(j.current=!1,M({force:!0})):M();const z=[x.invalidateQueries({queryKey:Vt.sessions}),...A?[x.invalidateQueries({queryKey:Vt.session(A)})]:[]],G=A&&u?sd(u,A):Promise.resolve();Promise.all([...z,G]).catch(H=>{console.error("Failed to invalidate queries on SSE connect:",H)}).finally(()=>{O.current===N&&E()})},[u,x,A,M,E]),K=P.useCallback(()=>{j.current||D(!0)},[]),$=P.useCallback(()=>{},[]),Y=P.useCallback(N=>{w({title:N.data.title,body:N.data.body,sessionId:N.data.sessionId,url:N.data.url})},[w]),Q=P.useMemo(()=>A?{sessionId:A}:{all:!0},[A]),{subscriptionId:F}=r8({enabled:!!(u&&l),token:l??"",baseUrl:n,subscription:Q,onConnect:q,onDisconnect:K,onEvent:$,onToast:Y});return d8({api:u,subscriptionId:F,enabled:!!(u&&l)}),a?b.jsx("div",{className:"h-full flex items-center justify-center p-4",children:b.jsx(mm,{label:e("loading"),className:"text-sm"})}):r?m?b.jsx(Ny,{mode:"bind",onBind:g,baseUrl:n,serverUrl:t,setServerUrl:i,clearServerUrl:s,requireServerUrl:Uy,error:f??void 0}):h||r&&!l&&!f?b.jsx("div",{className:"h-full flex items-center justify-center p-4",children:b.jsx(mm,{label:e("authorizing"),className:"text-sm"})}):f||!l||!u?r.type==="accessToken"?b.jsx(Ny,{onLogin:o,baseUrl:n,serverUrl:t,setServerUrl:i,clearServerUrl:s,requireServerUrl:Uy,error:f??e("login.error.authFailed")}):b.jsxs("div",{className:"p-4 space-y-3",children:[b.jsx("div",{className:"text-base font-semibold",children:e("login.title")}),b.jsx("div",{className:"text-sm text-red-600",children:f??e("login.error.authFailed")}),b.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:`Open this page from Telegram using the bot's "Open App" button (not "Open in browser").`})]}):b.jsx(h8,{value:{api:u,token:l,baseUrl:n},children:b.jsxs(S9,{children:[b.jsx($W,{isSyncing:T}),b.jsx(qW,{isReconnecting:L&&!T}),b.jsx(VW,{}),b.jsx(HW,{}),b.jsx("div",{className:"h-full flex flex-col",children:b.jsx(Wm,{})}),b.jsx(JW,{}),b.jsx(BW,{})]})}):b.jsx(Ny,{onLogin:o,baseUrl:n,serverUrl:t,setServerUrl:i,clearServerUrl:s,requireServerUrl:Uy})}const eG=e=>Array.from(e).map(n=>n.getModelContext()).sort((n,i)=>(i.priority??0)-(n.priority??0)).reduce((n,i)=>{if(i.system&&(n.system?n.system+=`

${i.system}`:n.system=i.system),i.tools)for(const[s,r]of Object.entries(i.tools)){const a=n.tools?.[s];if(a&&a!==r)throw new Error(`You tried to define a tool with the name ${s}, but it already exists.`);n.tools||(n.tools={}),n.tools[s]=r}return i.config&&(n.config={...n.config,...i.config}),i.callSettings&&(n.callSettings={...n.callSettings,...i.callSettings}),n},{});class mC{_providers=new Set;getModelContext(){return eG(this._providers)}registerModelContextProvider(t){this._providers.add(t);const n=t.subscribe?.(()=>{this.notifySubscribers()});return this.notifySubscribers(),()=>{this._providers.delete(t),n?.(),this.notifySubscribers()}}_subscribers=new Set;notifySubscribers(){for(const t of this._subscribers)t()}subscribe(t){return this._subscribers.add(t),()=>this._subscribers.delete(t)}}class VD{_contextProvider=new mC;registerModelContextProvider(t){return this._contextProvider.registerModelContextProvider(t)}getModelContextProvider(){return this._contextProvider}}class tG{_subscribers=new Set;subscribe(t){return this._subscribers.add(t),()=>this._subscribers.delete(t)}waitForUpdate(){return new Promise(t=>{const n=this.subscribe(()=>{n(),t()})})}_notifySubscribers(){const t=[];for(const n of this._subscribers)try{n()}catch(i){t.push(i)}if(t.length>0)throw t.length===1?t[0]:new AggregateError(t)}}const nG=e=>e.status.type==="complete";class WD extends tG{isEditing=!0;get attachmentAccept(){return this.getAttachmentAdapter()?.accept??"*"}_attachments=[];get attachments(){return this._attachments}setAttachments(t){this._attachments=t,this._notifySubscribers()}get isEmpty(){return!this.text.trim()&&!this.attachments.length}_text="";get text(){return this._text}_role="user";get role(){return this._role}_runConfig={};get runConfig(){return this._runConfig}setText(t){if(this._text!==t){if(this._text=t,this._dictation){this._dictationBaseText=t,this._currentInterimText="";const{status:n,inputDisabled:i}=this._dictation;this._dictation=i?{status:n,inputDisabled:i}:{status:n}}this._notifySubscribers()}}setRole(t){this._role!==t&&(this._role=t,this._notifySubscribers())}setRunConfig(t){this._runConfig!==t&&(this._runConfig=t,this._notifySubscribers())}_emptyTextAndAttachments(){this._attachments=[],this._text="",this._notifySubscribers()}async _onClearAttachments(){const t=this.getAttachmentAdapter();t&&await Promise.all(this._attachments.map(n=>t.remove(n)))}async reset(){if(this._attachments.length===0&&this._text===""&&this._role==="user"&&Object.keys(this._runConfig).length===0)return;this._role="user",this._runConfig={};const t=this._onClearAttachments();this._emptyTextAndAttachments(),await t}async clearAttachments(){const t=this._onClearAttachments();this.setAttachments([]),await t}async send(){this._dictationSession&&(this._dictationSession.cancel(),this._cleanupDictation());const t=this.getAttachmentAdapter(),n=t&&this.attachments.length>0?Promise.all(this.attachments.map(async r=>nG(r)?r:await t.send(r))):[],i=this.text;this._emptyTextAndAttachments();const s={createdAt:new Date,role:this.role,content:i?[{type:"text",text:i}]:[],attachments:await n,runConfig:this.runConfig,metadata:{custom:{}}};this.handleSend(s),this._notifyEventSubscribers("send")}cancel(){this.handleCancel()}async addAttachment(t){const n=this.getAttachmentAdapter();if(!n)throw new Error("Attachments are not supported");const i=r=>{const a=this._attachments.findIndex(o=>o.id===r.id);a!==-1?this._attachments=[...this._attachments.slice(0,a),r,...this._attachments.slice(a+1)]:this._attachments=[...this._attachments,r],this._notifySubscribers()},s=n.add({file:t});if(Symbol.asyncIterator in s)for await(const r of s)i(r);else i(await s);this._notifyEventSubscribers("attachment-add"),this._notifySubscribers()}async removeAttachment(t){const n=this.getAttachmentAdapter();if(!n)throw new Error("Attachments are not supported");const i=this._attachments.findIndex(r=>r.id===t);if(i===-1)throw new Error("Attachment not found");const s=this._attachments[i];await n.remove(s),this._attachments=[...this._attachments.slice(0,i),...this._attachments.slice(i+1)],this._notifySubscribers()}_dictation;_dictationSession;_dictationUnsubscribes=[];_dictationBaseText="";_currentInterimText="";_dictationSessionIdCounter=0;_activeDictationSessionId;_isCleaningDictation=!1;get dictation(){return this._dictation}_isActiveSession(t,n){return this._activeDictationSessionId===t&&this._dictationSession===n}startDictation(){const t=this.getDictationAdapter();if(!t)throw new Error("Dictation adapter not configured");if(this._dictationSession){for(const h of this._dictationUnsubscribes)h();this._dictationUnsubscribes=[],this._dictationSession.stop().catch(()=>{}),this._dictationSession=void 0}const n=t.disableInputDuringDictation??!1;this._dictationBaseText=this._text,this._currentInterimText="";const i=t.listen();this._dictationSession=i;const s=++this._dictationSessionIdCounter;this._activeDictationSessionId=s,this._dictation={status:i.status,inputDisabled:n},this._notifySubscribers();const r=i.onSpeech(u=>{if(!this._isActiveSession(s,i))return;const h=u.isFinal!==!1,m=this._dictationBaseText&&!this._dictationBaseText.endsWith(" ")&&u.transcript?" ":"";if(h){if(this._dictationBaseText=this._dictationBaseText+m+u.transcript,this._currentInterimText="",this._text=this._dictationBaseText,this._dictation){const{transcript:g,...C}=this._dictation;this._dictation=C}this._notifySubscribers()}else this._currentInterimText=m+u.transcript,this._text=this._dictationBaseText+this._currentInterimText,this._dictation&&(this._dictation={...this._dictation,transcript:u.transcript}),this._notifySubscribers()});this._dictationUnsubscribes.push(r);const a=i.onSpeechStart(()=>{this._isActiveSession(s,i)&&(this._dictation={status:{type:"running"},inputDisabled:n,...this._dictation?.transcript&&{transcript:this._dictation.transcript}},this._notifySubscribers())});this._dictationUnsubscribes.push(a);const o=i.onSpeechEnd(()=>{this._cleanupDictation({sessionId:s})});this._dictationUnsubscribes.push(o);const l=setInterval(()=>{this._isActiveSession(s,i)&&i.status.type==="ended"&&this._cleanupDictation({sessionId:s})},100);this._dictationUnsubscribes.push(()=>clearInterval(l))}stopDictation(){if(!this._dictationSession)return;const t=this._dictationSession,n=this._activeDictationSessionId;t.stop().finally(()=>{this._cleanupDictation({sessionId:n})})}_cleanupDictation(t){if(!(t?.sessionId!==void 0&&t.sessionId!==this._activeDictationSessionId||this._isCleaningDictation)){this._isCleaningDictation=!0;try{for(const i of this._dictationUnsubscribes)i();this._dictationUnsubscribes=[],this._dictationSession=void 0,this._activeDictationSessionId=void 0,this._dictation=void 0,this._dictationBaseText="",this._currentInterimText="",this._notifySubscribers()}finally{this._isCleaningDictation=!1}}}_eventSubscribers=new Map;_notifyEventSubscribers(t){const n=this._eventSubscribers.get(t);if(n)for(const i of n)i()}unstable_on(t,n){const i=this._eventSubscribers.get(t);return i?i.add(n):this._eventSubscribers.set(t,new Set([n])),()=>{const s=this._eventSubscribers.get(t);s&&s.delete(n)}}}class GD extends WD{runtime;_canCancel=!1;get canCancel(){return this._canCancel}get attachments(){return super.attachments}getAttachmentAdapter(){return this.runtime.adapters?.attachments}getDictationAdapter(){return this.runtime.adapters?.dictation}constructor(t){super(),this.runtime=t,this.connect()}connect(){return this.runtime.subscribe(()=>{this.canCancel!==this.runtime.capabilities.cancel&&(this._canCancel=this.runtime.capabilities.cancel,this._notifySubscribers())})}async handleSend(t){this.runtime.append({...t,parentId:this.runtime.messages.at(-1)?.id??null,sourceId:null})}async handleCancel(){this.runtime.cancelRun()}}let iG=(e,t=21)=>(n=t)=>{let i="",s=n|0;for(;s--;)i+=e[Math.random()*e.length|0];return i};const og=iG("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),sG="__optimistic__",rG=()=>`${sG}${og()}`,Oc=Symbol("autoStatus"),oG=Object.freeze(Object.assign({type:"running"},{[Oc]:!0})),aG=Object.freeze(Object.assign({type:"complete",reason:"unknown"},{[Oc]:!0})),lG=Object.freeze(Object.assign({type:"requires-action",reason:"tool-calls"},{[Oc]:!0})),cG=Object.freeze(Object.assign({type:"requires-action",reason:"interrupt"},{[Oc]:!0})),KD=e=>e[Oc]===!0,ag=(e,t,n,i,s)=>e&&s?Object.assign({type:"incomplete",reason:"error",error:s},{[Oc]:!0}):e&&t?oG:n?cG:i?lG:aG;var ha={exports:{}},tA;function uG(){if(tA)return ha.exports;tA=1;const e=typeof Buffer<"u",t=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,n=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function i(o,l,u){u==null&&l!==null&&typeof l=="object"&&(u=l,l=void 0),e&&Buffer.isBuffer(o)&&(o=o.toString()),o&&o.charCodeAt(0)===65279&&(o=o.slice(1));const h=JSON.parse(o,l);if(h===null||typeof h!="object")return h;const f=u&&u.protoAction||"error",m=u&&u.constructorAction||"error";if(f==="ignore"&&m==="ignore")return h;if(f!=="ignore"&&m!=="ignore"){if(t.test(o)===!1&&n.test(o)===!1)return h}else if(f!=="ignore"&&m==="ignore"){if(t.test(o)===!1)return h}else if(n.test(o)===!1)return h;return s(h,{protoAction:f,constructorAction:m,safe:u&&u.safe})}function s(o,{protoAction:l="error",constructorAction:u="error",safe:h}={}){let f=[o];for(;f.length;){const m=f;f=[];for(const g of m){if(l!=="ignore"&&Object.prototype.hasOwnProperty.call(g,"__proto__")){if(h===!0)return null;if(l==="error")throw new SyntaxError("Object contains forbidden prototype property");delete g.__proto__}if(u!=="ignore"&&Object.prototype.hasOwnProperty.call(g,"constructor")&&g.constructor!==null&&typeof g.constructor=="object"&&Object.prototype.hasOwnProperty.call(g.constructor,"prototype")){if(h===!0)return null;if(u==="error")throw new SyntaxError("Object contains forbidden prototype property");delete g.constructor}for(const C in g){const S=g[C];S&&typeof S=="object"&&f.push(S)}}}return o}function r(o,l,u){const{stackTraceLimit:h}=Error;Error.stackTraceLimit=0;try{return i(o,l,u)}finally{Error.stackTraceLimit=h}}function a(o,l){const{stackTraceLimit:u}=Error;Error.stackTraceLimit=0;try{return i(o,l,{safe:!0})}catch{return}finally{Error.stackTraceLimit=u}}return ha.exports=r,ha.exports.default=r,ha.exports.parse=r,ha.exports.safeParse=a,ha.exports.scan=s,ha.exports}var dG=uG();const nA=Ga(dG);function hG(e){const t=["ROOT"];let n=-1,i=null;const s=[];let r;function a(){r!==void 0&&(s.push(JSON.parse(`"${r}"`)),r=void 0)}function o(f,m,g){switch(f){case'"':{n=m,t.pop(),t.push(g),t.push("INSIDE_STRING"),a();break}case"f":case"t":case"n":{n=m,i=m,t.pop(),t.push(g),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(g),t.push("INSIDE_NUMBER"),a();break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=m,t.pop(),t.push(g),t.push("INSIDE_NUMBER"),a();break}case"{":{n=m,t.pop(),t.push(g),t.push("INSIDE_OBJECT_START"),a();break}case"[":{n=m,t.pop(),t.push(g),t.push("INSIDE_ARRAY_START"),a();break}}}function l(f,m){switch(f){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=m,t.pop(),r=s.pop();break}}}function u(f,m){switch(f){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA"),r=(Number(r)+1).toString();break}case"]":{n=m,t.pop(),r=s.pop();break}}}for(let f=0;f<e.length;f++){const m=e[f];switch(t[t.length-1]){case"ROOT":o(m,f,"FINISH");break;case"INSIDE_OBJECT_START":{switch(m){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY"),r="";break}case"}":{n=f,t.pop(),r=s.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{m==='"'&&(t.pop(),t.push("INSIDE_OBJECT_KEY"),r="");break}case"INSIDE_OBJECT_KEY":{switch(m){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}case"\\":{t.push("INSIDE_STRING_ESCAPE"),r+=m;break}default:{r+=m;break}}break}case"INSIDE_OBJECT_AFTER_KEY":{m===":"&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break}case"INSIDE_OBJECT_BEFORE_VALUE":{o(m,f,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{l(m,f);break}case"INSIDE_STRING":{switch(m){case'"':{t.pop(),n=f,r=s.pop();break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:n=f}break}case"INSIDE_ARRAY_START":{m==="]"?(n=f,t.pop(),r=s.pop()):(n=f,r="0",o(m,f,"INSIDE_ARRAY_AFTER_VALUE"));break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(m){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA"),r=(Number(r)+1).toString();break}case"]":{n=f,t.pop(),r=s.pop();break}default:{n=f;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{o(m,f,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),t[t.length-1]==="INSIDE_STRING"?n=f:t[t.length-1]==="INSIDE_OBJECT_KEY"&&(r+=m);break}case"INSIDE_NUMBER":{switch(m){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=f;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),r=s.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(m,f),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&l(m,f);break}case"}":{t.pop(),r=s.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&l(m,f);break}case"]":{t.pop(),r=s.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(m,f);break}default:{t.pop(),r=s.pop();break}}break}case"INSIDE_LITERAL":{const C=e.substring(i,f+1);!"false".startsWith(C)&&!"true".startsWith(C)&&!"null".startsWith(C)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?l(m,f):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(m,f)):n=f;break}}}let h=e.slice(0,n+1);for(let f=t.length-1;f>=0;f--)switch(t[f]){case"INSIDE_STRING":{h+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{h+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{h+="]";break}case"INSIDE_LITERAL":{const g=e.substring(i,e.length);"true".startsWith(g)?h+="true".slice(g.length):"false".startsWith(g)?h+="false".slice(g.length):"null".startsWith(g)&&(h+="null".slice(g.length))}}return[h,s]}const zy=Symbol("aui.parse-partial-json-object.meta"),fG=e=>{if(e.length===0)return{[zy]:{state:"partial",partialPath:[]}};try{const t=nA.parse(e);if(typeof t!="object"||t===null)throw new Error("argsText is expected to be an object");return t[zy]={state:"complete",partialPath:[]},t}catch{try{const[t,n]=hG(e),i=nA.parse(t);if(typeof i!="object"||i===null)throw new Error("argsText is expected to be an object");return i[zy]={state:"partial",partialPath:n},i}catch{return}}},rh=(e,t,n)=>{const{role:i,id:s,createdAt:r,attachments:a,status:o,metadata:l}=e,u={id:s??t,createdAt:r??new Date},h=typeof e.content=="string"?[{type:"text",text:e.content}]:e.content,f=({image:m,...g})=>{const C=/^data:image\/(png|jpeg|jpg|gif|webp);base64,/.test(m),S=/^https?:\/\//.test(m);return C||S?{...g,image:m}:(console.warn("Invalid image data format detected"),null)};if(i!=="user"&&a?.length)throw new Error("attachments are only supported for user messages");if(i!=="assistant"&&o)throw new Error("status is only supported for assistant messages");if(i!=="assistant"&&l?.steps)throw new Error("metadata.steps is only supported for assistant messages");switch(i){case"assistant":return{...u,role:i,content:h.map(m=>{const g=m.type;switch(g){case"text":case"reasoning":return m.text.trim().length===0?null:m;case"file":case"source":return m;case"image":return f(m);case"data":return m;case"tool-call":{const{parentId:C,messages:S,...v}=m,_={...v,toolCallId:m.toolCallId??`tool-${og()}`,...C!==void 0&&{parentId:C},...S!==void 0&&{messages:S}};return m.args?{..._,args:m.args,argsText:m.argsText??JSON.stringify(m.args)}:{..._,args:fG(m.argsText??"")??{},argsText:m.argsText??""}}default:{const C=g;throw new Error(`Unsupported assistant message part type: ${C}`)}}}).filter(m=>!!m),status:o??n,metadata:{unstable_state:l?.unstable_state??null,unstable_annotations:l?.unstable_annotations??[],unstable_data:l?.unstable_data??[],custom:l?.custom??{},steps:l?.steps??[],...l?.submittedFeedback&&{submittedFeedback:l.submittedFeedback}}};case"user":return{...u,role:i,content:h.map(m=>{const g=m.type;switch(g){case"text":case"image":case"audio":case"file":return m;default:{const C=g;throw new Error(`Unsupported user message part type: ${C}`)}}}),attachments:a??[],metadata:{custom:l?.custom??{}}};case"system":if(h.length!==1||h[0].type!=="text")throw new Error("System messages must have exactly one text message part.");return{...u,role:i,content:h,metadata:{custom:l?.custom??{}}};default:{const m=i;throw new Error(`Unknown message role: ${m}`)}}},gC={fromArray:e=>{const t=e.map(n=>rh(n,og(),ag(!1,!1,!1,!1,void 0)));return{messages:t.map((n,i)=>({parentId:i>0?t[i-1].id:null,message:n}))}}},Pp=e=>e.next?Pp(e.next):"current"in e?e:null;class pG{func;_value=null;constructor(t){this.func=t}get value(){return this._value===null&&(this._value=this.func()),this._value}dirty(){this._value=null}}class vC{messages=new Map;head=null;root={children:[],next:null};updateLevels(t,n){t.level=n;for(const i of t.children){const s=this.messages.get(i);s&&this.updateLevels(s,n+1)}}performOp(t,n,i){const s=n.prev??this.root,r=t??this.root;if(!(i==="relink"&&s===r)){if(i!=="link"&&(s.children=s.children.filter(a=>a!==n.current.id),s.next===n)){const a=s.children.at(-1),o=a?this.messages.get(a):null;if(o===void 0)throw new Error("MessageRepository(performOp/cut): Fallback sibling message not found. This is likely an internal bug in assistant-ui.");s.next=o}if(i!=="cut"){for(let o=t;o;o=o.prev)if(o.current.id===n.current.id)throw new Error("MessageRepository(performOp/link): A message with the same id already exists in the parent tree. This error occurs if the same message id is found multiple times. This is likely an internal bug in assistant-ui.");r.children=[...r.children,n.current.id],(Pp(n)===this.head||r.next===null)&&(r.next=n),n.prev=t;const a=t?t.level+1:0;this.updateLevels(n,a)}}}_messages=new pG(()=>{const t=new Array((this.head?.level??-1)+1);for(let n=this.head;n;n=n.prev)t[n.level]=n.current;return t});get headId(){return this.head?.current.id??null}getMessages(t){if(t===void 0||t===this.head?.current.id)return this._messages.value;const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(getMessages): Head message not found. This is likely an internal bug in assistant-ui.");const i=new Array(n.level+1);for(let s=n;s;s=s.prev)i[s.level]=s.current;return i}addOrUpdateMessage(t,n){const i=this.messages.get(n.id),s=t?this.messages.get(t):null;if(s===void 0)throw new Error("MessageRepository(addOrUpdateMessage): Parent message not found. This is likely an internal bug in assistant-ui.");if(i){i.current=n,this.performOp(s,i,"relink"),this._messages.dirty();return}const r={prev:s,current:n,next:null,children:[],level:s?s.level+1:0};this.messages.set(n.id,r),this.performOp(s,r,"link"),this.head===s&&(this.head=r),this._messages.dirty()}getMessage(t){const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(updateMessage): Message not found. This is likely an internal bug in assistant-ui.");return{parentId:n.prev?.current.id??null,message:n.current,index:n.level}}appendOptimisticMessage(t,n){let i;do i=rG();while(this.messages.has(i));return this.addOrUpdateMessage(t,rh(n,i,{type:"running"})),i}deleteMessage(t,n){const i=this.messages.get(t);if(!i)throw new Error("MessageRepository(deleteMessage): Message not found. This is likely an internal bug in assistant-ui.");const s=n===void 0?i.prev:n===null?null:this.messages.get(n);if(s===void 0)throw new Error("MessageRepository(deleteMessage): Replacement not found. This is likely an internal bug in assistant-ui.");for(const r of i.children){const a=this.messages.get(r);if(!a)throw new Error("MessageRepository(deleteMessage): Child message not found. This is likely an internal bug in assistant-ui.");this.performOp(s,a,"relink")}this.performOp(null,i,"cut"),this.messages.delete(t),this.head===i&&(this.head=Pp(s??this.root)),this._messages.dirty()}getBranches(t){const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(getBranches): Message not found. This is likely an internal bug in assistant-ui.");const{children:i}=n.prev??this.root;return i}switchToBranch(t){const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(switchToBranch): Branch not found. This is likely an internal bug in assistant-ui.");const i=n.prev??this.root;i.next=n,this.head=Pp(n),this._messages.dirty()}resetHead(t){if(t===null){this.clear();return}const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(resetHead): Branch not found. This is likely an internal bug in assistant-ui.");if(n.children.length>0){const i=s=>{for(const r of s.children){const a=this.messages.get(r);a&&(i(a),this.messages.delete(r))}};i(n),n.children=[],n.next=null}this.head=n;for(let i=n;i;i=i.prev)i.prev&&(i.prev.next=i);this._messages.dirty()}clear(){this.messages.clear(),this.head=null,this.root={children:[],next:null},this._messages.dirty()}export(){const t=[];for(const[,n]of this.messages)t.push({message:n.current,parentId:n.prev?.current.id??null});return{headId:this.head?.current.id??null,messages:t}}import({headId:t,messages:n}){for(const{message:i,parentId:s}of n)this.addOrUpdateMessage(s,i);this.resetHead(t??n.at(-1)?.message.id??null)}}class lg{_subscriptions=new Set;_connection;get isConnected(){return!!this._connection}notifySubscribers(){for(const t of this._subscriptions)t()}_updateConnection(){if(this._subscriptions.size>0){if(this._connection)return;this._connection=this._connect()}else this._connection?.(),this._connection=void 0}subscribe(t){return this._subscriptions.add(t),this._updateConnection(),()=>{this._subscriptions.delete(t),this._updateConnection()}}}const ws=Symbol("skip-update");class bC extends lg{binding;get path(){return this.binding.path}constructor(t){super(),this.binding=t}_previousStateDirty=!0;_previousState;getState=()=>{if(!this.isConnected||this._previousStateDirty){const t=this.binding.getState();t!==ws&&(this._previousState=t),this._previousStateDirty=!1}if(this._previousState===void 0)throw new Error("Entry not available in the store");return this._previousState};_connect(){const t=()=>{this._previousStateDirty=!0,this.notifySubscribers()};return this.binding.subscribe(t)}}class Gf{_core;_threadListBinding;get path(){return this._core.path}constructor(t,n){this._core=t,this._threadListBinding=n,this.__internal_bindMethods()}__internal_bindMethods(){this.switchTo=this.switchTo.bind(this),this.rename=this.rename.bind(this),this.archive=this.archive.bind(this),this.unarchive=this.unarchive.bind(this),this.delete=this.delete.bind(this),this.initialize=this.initialize.bind(this),this.generateTitle=this.generateTitle.bind(this),this.subscribe=this.subscribe.bind(this),this.unstable_on=this.unstable_on.bind(this),this.getState=this.getState.bind(this),this.detach=this.detach.bind(this)}getState(){return this._core.getState()}switchTo(){const t=this._core.getState();return this._threadListBinding.switchToThread(t.id)}rename(t){const n=this._core.getState();return this._threadListBinding.rename(n.id,t)}archive(){const t=this._core.getState();return this._threadListBinding.archive(t.id)}unarchive(){const t=this._core.getState();return this._threadListBinding.unarchive(t.id)}delete(){const t=this._core.getState();return this._threadListBinding.delete(t.id)}initialize(){const t=this._core.getState();return this._threadListBinding.initialize(t.id)}generateTitle(){const t=this._core.getState();return this._threadListBinding.generateTitle(t.id)}unstable_on(t,n){let i=this._core.getState().isMain,s=this._core.getState().id;return this.subscribe(()=>{const r=this._core.getState(),a=r.isMain,o=r.id;i===a&&s===o||(i=a,s=o,!(t==="switched-to"&&!a)&&(t==="switched-away"&&a||n()))})}subscribe(t){return this._core.subscribe(t)}detach(){const t=this._core.getState();this._threadListBinding.detach(t.id)}__internal_getRuntime(){return this}}function mG(e,t){if(e===void 0&&t===void 0)return!0;if(e===void 0||t===void 0)return!1;for(const n of Object.keys(e)){const i=e[n],s=t[n];if(!Object.is(i,s))return!1}return!0}class _s extends lg{binding;get path(){return this.binding.path}constructor(t){super(),this.binding=t;const n=t.getState();if(n===ws)throw new Error("Entry not available in the store");this._previousState=n}_previousState;getState=()=>(this.isConnected||this._syncState(),this._previousState);_syncState(){const t=this.binding.getState();return t===ws||mG(t,this._previousState)?!1:(this._previousState=t,!0)}_connect(){const t=()=>{this._syncState()&&this.notifySubscribers()};return this.binding.subscribe(t)}}const ei=Symbol("innerMessage"),Hy=Symbol("innerMessages"),gG=e=>e[ei],vG=[],bG=e=>{const t="messages"in e?e.messages:e,n=t[Hy]||t[ei];return n?Array.isArray(n)?n:(t[Hy]=[n],t[Hy]):vG},Bd=e=>e.content.filter(n=>n.type==="text").map(n=>n.text).join(`

`);class YD{_core;get path(){return this._core.path}constructor(t){this._core=t,this.__internal_bindMethods()}__internal_bindMethods(){this.getState=this.getState.bind(this),this.remove=this.remove.bind(this),this.subscribe=this.subscribe.bind(this)}getState(){return this._core.getState()}subscribe(t){return this._core.subscribe(t)}}class QD extends YD{_composerApi;constructor(t,n){super(t),this._composerApi=n}remove(){const t=this._composerApi.getState();if(!t)throw new Error("Composer is not available");return t.removeAttachment(this.getState().id)}}class yG extends QD{get source(){return"thread-composer"}}class _G extends QD{get source(){return"edit-composer"}}class SG extends YD{get source(){return"message"}constructor(t){super(t)}remove(){throw new Error("Message attachments cannot be removed")}}class JD extends lg{config;constructor(t){super(),this.config=t}getState(){return this.config.binding.getState()}outerSubscribe(t){return this.config.binding.subscribe(t)}_connect(){const t=()=>{this.notifySubscribers()};let n=this.config.binding.getState(),i=n?.unstable_on(this.config.event,t);const s=()=>{const a=this.config.binding.getState();a!==n&&(n=a,i?.(),i=this.config.binding.getState()?.unstable_on(this.config.event,t))},r=this.outerSubscribe(s);return()=>{r?.(),i?.()}}}const XD=Object.freeze([]),ZD=Object.freeze({}),CG=e=>Object.freeze({type:"thread",isEditing:e?.isEditing??!1,canCancel:e?.canCancel??!1,isEmpty:e?.isEmpty??!0,attachments:e?.attachments??XD,text:e?.text??"",role:e?.role??"user",runConfig:e?.runConfig??ZD,attachmentAccept:e?.attachmentAccept??"",dictation:e?.dictation,value:e?.text??""}),xG=e=>Object.freeze({type:"edit",isEditing:e?.isEditing??!1,canCancel:e?.canCancel??!1,isEmpty:e?.isEmpty??!0,text:e?.text??"",role:e?.role??"user",attachments:e?.attachments??XD,runConfig:e?.runConfig??ZD,attachmentAccept:e?.attachmentAccept??"",dictation:e?.dictation,value:e?.text??""});class eO{_core;get path(){return this._core.path}constructor(t){this._core=t}__internal_bindMethods(){this.setText=this.setText.bind(this),this.setRunConfig=this.setRunConfig.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.addAttachment=this.addAttachment.bind(this),this.reset=this.reset.bind(this),this.clearAttachments=this.clearAttachments.bind(this),this.send=this.send.bind(this),this.cancel=this.cancel.bind(this),this.setRole=this.setRole.bind(this),this.getAttachmentByIndex=this.getAttachmentByIndex.bind(this),this.startDictation=this.startDictation.bind(this),this.stopDictation=this.stopDictation.bind(this),this.unstable_on=this.unstable_on.bind(this)}setText(t){const n=this._core.getState();if(!n)throw new Error("Composer is not available");n.setText(t)}setRunConfig(t){const n=this._core.getState();if(!n)throw new Error("Composer is not available");n.setRunConfig(t)}addAttachment(t){const n=this._core.getState();if(!n)throw new Error("Composer is not available");return n.addAttachment(t)}reset(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");return t.reset()}clearAttachments(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");return t.clearAttachments()}send(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.send()}cancel(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.cancel()}setRole(t){const n=this._core.getState();if(!n)throw new Error("Composer is not available");n.setRole(t)}startDictation(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.startDictation()}stopDictation(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.stopDictation()}subscribe(t){return this._core.subscribe(t)}_eventSubscriptionSubjects=new Map;unstable_on(t,n){let i=this._eventSubscriptionSubjects.get(t);return i||(i=new JD({event:t,binding:this._core}),this._eventSubscriptionSubjects.set(t,i)),i.subscribe(n)}}class wG extends eO{get path(){return this._core.path}get type(){return"thread"}_getState;constructor(t){const n=new bC({path:t.path,getState:()=>CG(t.getState()),subscribe:i=>t.subscribe(i)});super({path:t.path,getState:()=>t.getState(),subscribe:i=>n.subscribe(i)}),this._getState=n.getState.bind(n),this.__internal_bindMethods()}getState(){return this._getState()}getAttachmentByIndex(t){return new yG(new _s({path:{...this.path,attachmentSource:"thread-composer",attachmentSelector:{type:"index",index:t},ref:`${this.path.ref}.attachments[${t}]`},getState:()=>{const i=this.getState().attachments[t];return i?{...i,source:"thread-composer"}:ws},subscribe:n=>this._core.subscribe(n)}),this._core)}}class kG extends eO{_beginEdit;get path(){return this._core.path}get type(){return"edit"}_getState;constructor(t,n){const i=new bC({path:t.path,getState:()=>xG(t.getState()),subscribe:s=>t.subscribe(s)});super({path:t.path,getState:()=>t.getState(),subscribe:s=>i.subscribe(s)}),this._beginEdit=n,this._getState=i.getState.bind(i),this.__internal_bindMethods()}__internal_bindMethods(){super.__internal_bindMethods(),this.beginEdit=this.beginEdit.bind(this)}getState(){return this._getState()}beginEdit(){this._beginEdit()}getAttachmentByIndex(t){return new _G(new _s({path:{...this.path,attachmentSource:"edit-composer",attachmentSelector:{type:"index",index:t},ref:`${this.path.ref}.attachments[${t}]`},getState:()=>{const i=this.getState().attachments[t];return i?{...i,source:"edit-composer"}:ws},subscribe:n=>this._core.subscribe(n)}),this._core)}}const iA=Symbol.for("aui.tool-response");class gm{get[iA](){return!0}artifact;result;isError;constructor(t){t.artifact!==void 0&&(this.artifact=t.artifact),this.result=t.result,this.isError=t.isError??!1}static[Symbol.hasInstance](t){return typeof t=="object"&&t!==null&&iA in t}static toResponse(t){return t instanceof gm?t:new gm({result:t===void 0?"<no result>":t})}}class sA{contentBinding;messageApi;threadApi;get path(){return this.contentBinding.path}constructor(t,n,i){this.contentBinding=t,this.messageApi=n,this.threadApi=i,this.__internal_bindMethods()}__internal_bindMethods(){this.addToolResult=this.addToolResult.bind(this),this.resumeToolCall=this.resumeToolCall.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this)}getState(){return this.contentBinding.getState()}addToolResult(t){const n=this.contentBinding.getState();if(!n)throw new Error("Message part is not available");if(n.type!=="tool-call")throw new Error("Tried to add tool result to non-tool message part");if(!this.messageApi)throw new Error("Message API is not available. This is likely a bug in assistant-ui.");if(!this.threadApi)throw new Error("Thread API is not available");const i=this.messageApi.getState();if(!i)throw new Error("Message is not available");const s=n.toolName,r=n.toolCallId,a=gm.toResponse(t);this.threadApi.getState().addToolResult({messageId:i.id,toolName:s,toolCallId:r,result:a.result,artifact:a.artifact,isError:a.isError})}resumeToolCall(t){const n=this.contentBinding.getState();if(!n)throw new Error("Message part is not available");if(n.type!=="tool-call")throw new Error("Tried to resume tool call on non-tool message part");if(!this.threadApi)throw new Error("Thread API is not available");const i=n.toolCallId;this.threadApi.getState().resumeToolCall({toolCallId:i,payload:t})}subscribe(t){return this.contentBinding.subscribe(t)}}class vm extends lg{binding;get path(){return this.binding.path}constructor(t){super(),this.binding=t}getState(){return this.binding.getState()}outerSubscribe(t){return this.binding.subscribe(t)}_connect(){const t=()=>{this.notifySubscribers()};let n=this.binding.getState(),i=n?.subscribe(t);const s=()=>{const a=this.binding.getState();a!==n&&(n=a,i?.(),i=this.binding.getState()?.subscribe(t),t())},r=this.outerSubscribe(s);return()=>{r?.(),i?.()}}}const Kf=Object.freeze({type:"complete"}),TG=(e,t,n)=>{if(e.role!=="assistant")return Kf;if(n.type==="tool-call")return n.result?Kf:e.status;const i=t===Math.max(0,e.content.length-1);return e.status.type==="requires-action"?Kf:i?e.status:Kf},rA=(e,t)=>{const n=e.content[t];if(!n)return ws;const i=TG(e,t,n);return Object.freeze({...n,[ei]:n[ei],status:i})};class EG{_core;_threadBinding;get path(){return this._core.path}constructor(t,n){this._core=t,this._threadBinding=n,this.composer=new kG(new vm({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.composer`,composerSource:"edit"},getState:this._getEditComposerRuntimeCore,subscribe:i=>this._threadBinding.subscribe(i)}),()=>this._threadBinding.getState().beginEdit(this._core.getState().id)),this.__internal_bindMethods()}__internal_bindMethods(){this.reload=this.reload.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.getMessagePartByIndex=this.getMessagePartByIndex.bind(this),this.getMessagePartByToolCallId=this.getMessagePartByToolCallId.bind(this),this.getAttachmentByIndex=this.getAttachmentByIndex.bind(this),this.unstable_getCopyText=this.unstable_getCopyText.bind(this),this.speak=this.speak.bind(this),this.stopSpeaking=this.stopSpeaking.bind(this),this.submitFeedback=this.submitFeedback.bind(this),this.switchToBranch=this.switchToBranch.bind(this)}composer;_getEditComposerRuntimeCore=()=>this._threadBinding.getState().getEditComposer(this._core.getState().id);getState(){return this._core.getState()}reload(t={}){const n=this._getEditComposerRuntimeCore(),i=n??this._threadBinding.getState().composer,s=n??i,{runConfig:r=s.runConfig}=t,a=this._core.getState();if(a.role!=="assistant")throw new Error("Can only reload assistant messages");this._threadBinding.getState().startRun({parentId:a.parentId,sourceId:a.id,runConfig:r})}speak(){const t=this._core.getState();return this._threadBinding.getState().speak(t.id)}stopSpeaking(){const t=this._core.getState();if(this._threadBinding.getState().speech?.messageId===t.id)this._threadBinding.getState().stopSpeaking();else throw new Error("Message is not being spoken")}submitFeedback({type:t}){const n=this._core.getState();this._threadBinding.getState().submitFeedback({messageId:n.id,type:t})}switchToBranch({position:t,branchId:n}){const i=this._core.getState();if(n&&t)throw new Error("May not specify both branchId and position");if(!n&&!t)throw new Error("Must specify either branchId or position");const r=this._threadBinding.getState().getBranches(i.id);let a=n;if(t==="previous"?a=r[i.branchNumber-2]:t==="next"&&(a=r[i.branchNumber]),!a)throw new Error("Branch not found");this._threadBinding.getState().switchToBranch(a)}unstable_getCopyText(){return Bd(this.getState())}subscribe(t){return this._core.subscribe(t)}getMessagePartByIndex(t){if(t<0)throw new Error("Message part index must be >= 0");return new sA(new _s({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.content[${t}]`,messagePartSelector:{type:"index",index:t}},getState:()=>rA(this.getState(),t),subscribe:n=>this._core.subscribe(n)}),this._core,this._threadBinding)}getMessagePartByToolCallId(t){return new sA(new _s({path:{...this.path,ref:this.path.ref+`${this.path.ref}.content[toolCallId=${JSON.stringify(t)}]`,messagePartSelector:{type:"toolCallId",toolCallId:t}},getState:()=>{const n=this._core.getState(),i=n.content.findIndex(s=>s.type==="tool-call"&&s.toolCallId===t);return i===-1?ws:rA(n,i)},subscribe:n=>this._core.subscribe(n)}),this._core,this._threadBinding)}getAttachmentByIndex(t){return new SG(new _s({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.attachments[${t}]`,attachmentSource:"message",attachmentSelector:{type:"index",index:t}},getState:()=>{const i=this.getState().attachments?.[t];return i?{...i,source:"message"}:ws},subscribe:n=>this._core.subscribe(n)}))}}const RG=e=>({parentId:e.parentId??null,sourceId:e.sourceId??null,runConfig:e.runConfig??{},...e.stream?{stream:e.stream}:{}}),AG=e=>({parentId:e.parentId??null,sourceId:e.sourceId??null,runConfig:e.runConfig??{}}),MG=(e,t)=>typeof t=="string"?{createdAt:new Date,parentId:e.at(-1)?.id??null,sourceId:null,runConfig:{},role:"user",content:[{type:"text",text:t}],attachments:[],metadata:{custom:{}}}:{createdAt:t.createdAt??new Date,parentId:t.parentId??e.at(-1)?.id??null,sourceId:t.sourceId??null,role:t.role??"user",content:t.content,attachments:t.attachments??[],metadata:t.metadata??{custom:{}},runConfig:t.runConfig??{},startRun:t.startRun},LG=(e,t)=>{const n=e.messages.at(-1);return Object.freeze({threadId:t.id,metadata:t,capabilities:e.capabilities,isDisabled:e.isDisabled,isLoading:e.isLoading,isRunning:n?.role!=="assistant"?!1:n.status.type==="running",messages:e.messages,state:e.state,suggestions:e.suggestions,extras:e.extras,speech:e.speech})};class tO{get path(){return this._threadBinding.path}get __internal_threadBinding(){return this._threadBinding}_threadBinding;constructor(t,n){const i=new _s({path:t.path,getState:()=>LG(t.getState(),n.getState()),subscribe:s=>{const r=t.subscribe(s),a=n.subscribe(s);return()=>{r(),a()}}});this._threadBinding={path:t.path,getState:()=>t.getState(),getStateState:()=>i.getState(),outerSubscribe:s=>t.outerSubscribe(s),subscribe:s=>t.subscribe(s)},this.composer=new wG(new vm({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.composer`,composerSource:"thread"},getState:()=>this._threadBinding.getState().composer,subscribe:s=>this._threadBinding.subscribe(s)})),this.__internal_bindMethods()}__internal_bindMethods(){this.append=this.append.bind(this),this.unstable_resumeRun=this.unstable_resumeRun.bind(this),this.unstable_loadExternalState=this.unstable_loadExternalState.bind(this),this.startRun=this.startRun.bind(this),this.cancelRun=this.cancelRun.bind(this),this.stopSpeaking=this.stopSpeaking.bind(this),this.export=this.export.bind(this),this.import=this.import.bind(this),this.reset=this.reset.bind(this),this.getMessageByIndex=this.getMessageByIndex.bind(this),this.getMessageById=this.getMessageById.bind(this),this.subscribe=this.subscribe.bind(this),this.unstable_on=this.unstable_on.bind(this),this.getModelContext=this.getModelContext.bind(this),this.getModelConfig=this.getModelConfig.bind(this),this.getState=this.getState.bind(this)}composer;getState(){return this._threadBinding.getStateState()}append(t){this._threadBinding.getState().append(MG(this._threadBinding.getState().messages,t))}subscribe(t){return this._threadBinding.subscribe(t)}getModelContext(){return this._threadBinding.getState().getModelContext()}getModelConfig(){return this.getModelContext()}startRun(t){const n=t===null||typeof t=="string"?{parentId:t}:t;return this._threadBinding.getState().startRun(AG(n))}unstable_resumeRun(t){return this._threadBinding.getState().resumeRun(RG(t))}unstable_loadExternalState(t){this._threadBinding.getState().unstable_loadExternalState(t)}cancelRun(){this._threadBinding.getState().cancelRun()}stopSpeaking(){return this._threadBinding.getState().stopSpeaking()}export(){return this._threadBinding.getState().export()}import(t){this._threadBinding.getState().import(t)}reset(t){this._threadBinding.getState().reset(t)}getMessageByIndex(t){if(t<0)throw new Error("Message index must be >= 0");return this._getMessageRuntime({...this.path,ref:`${this.path.ref}${this.path.ref}.messages[${t}]`,messageSelector:{type:"index",index:t}},()=>{const n=this._threadBinding.getState().messages,i=n[t];if(i)return{message:i,parentId:n[t-1]?.id??null,index:t}})}getMessageById(t){return this._getMessageRuntime({...this.path,ref:this.path.ref+`${this.path.ref}.messages[messageId=${JSON.stringify(t)}]`,messageSelector:{type:"messageId",messageId:t}},()=>this._threadBinding.getState().getMessageById(t))}_getMessageRuntime(t,n){return new EG(new _s({path:t,getState:()=>{const{message:i,parentId:s,index:r}=n()??{},{messages:a,speech:o}=this._threadBinding.getState();if(!i||s===void 0||r===void 0)return ws;const u=this._threadBinding.getState().getBranches(i.id),h=i.metadata.submittedFeedback;return{...i,[ei]:i[ei],index:r,isLast:a.at(-1)?.id===i.id,parentId:s,branchNumber:u.indexOf(i.id)+1,branchCount:u.length,speech:o?.messageId===i.id?o:void 0,submittedFeedback:h}},subscribe:i=>this._threadBinding.subscribe(i)}),this._threadBinding)}_eventSubscriptionSubjects=new Map;unstable_on(t,n){let i=this._eventSubscriptionSubjects.get(t);return i||(i=new JD({event:t,binding:this._threadBinding}),this._eventSubscriptionSubjects.set(t,i)),i.subscribe(n)}}const IG=e=>({mainThreadId:e.mainThreadId,newThread:e.newThreadId,threads:e.threadIds,archivedThreads:e.archivedThreadIds,isLoading:e.isLoading,threadItems:e.threadData}),Yf=(e,t)=>{if(t===void 0)return ws;const n=e.getItemById(t);return n?{id:n.id,threadId:n.id,remoteId:n.remoteId,externalId:n.externalId,title:n.title,status:n.status,isMain:n.id===e.mainThreadId}:ws};class PG{_core;_runtimeFactory;_getState;constructor(t,n=tO){this._core=t,this._runtimeFactory=n;const i=new bC({path:{},getState:()=>IG(t),subscribe:s=>t.subscribe(s)});this._getState=i.getState.bind(i),this._mainThreadListItemRuntime=new Gf(new _s({path:{ref:"threadItems[main]",threadSelector:{type:"main"}},getState:()=>Yf(this._core,this._core.mainThreadId),subscribe:s=>this._core.subscribe(s)}),this._core),this.main=new n(new vm({path:{ref:"threads.main",threadSelector:{type:"main"}},getState:()=>t.getMainThreadRuntimeCore(),subscribe:s=>t.subscribe(s)}),this._mainThreadListItemRuntime),this.__internal_bindMethods()}__internal_bindMethods(){this.switchToThread=this.switchToThread.bind(this),this.switchToNewThread=this.switchToNewThread.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.getById=this.getById.bind(this),this.getItemById=this.getItemById.bind(this),this.getItemByIndex=this.getItemByIndex.bind(this),this.getArchivedItemByIndex=this.getArchivedItemByIndex.bind(this)}switchToThread(t){return this._core.switchToThread(t)}switchToNewThread(){return this._core.switchToNewThread()}getState(){return this._getState()}subscribe(t){return this._core.subscribe(t)}_mainThreadListItemRuntime;main;get mainItem(){return this._mainThreadListItemRuntime}getById(t){return new this._runtimeFactory(new vm({path:{ref:`threads[threadId=${JSON.stringify(t)}]`,threadSelector:{type:"threadId",threadId:t}},getState:()=>this._core.getThreadRuntimeCore(t),subscribe:n=>this._core.subscribe(n)}),this.mainItem)}getItemByIndex(t){return new Gf(new _s({path:{ref:`threadItems[${t}]`,threadSelector:{type:"index",index:t}},getState:()=>Yf(this._core,this._core.threadIds[t]),subscribe:n=>this._core.subscribe(n)}),this._core)}getArchivedItemByIndex(t){return new Gf(new _s({path:{ref:`archivedThreadItems[${t}]`,threadSelector:{type:"archiveIndex",index:t}},getState:()=>Yf(this._core,this._core.archivedThreadIds[t]),subscribe:n=>this._core.subscribe(n)}),this._core)}getItemById(t){return new Gf(new _s({path:{ref:`threadItems[threadId=${t}]`,threadSelector:{type:"threadId",threadId:t}},getState:()=>Yf(this._core,t),subscribe:n=>this._core.subscribe(n)}),this._core)}}const DG=P.createContext(null),OG=()=>P.useContext(DG),fa=Object.freeze([]),Ra="DEFAULT_THREAD_ID",NG=Object.freeze([Ra]),nO=Object.freeze({id:Ra,remoteId:void 0,externalId:void 0,status:"regular"}),jG=Promise.resolve(),oA=Object.freeze({[Ra]:nO});class BG{adapter;threadFactory;_mainThreadId=Ra;_threads=NG;_archivedThreads=fa;_threadData=oA;get isLoading(){return this.adapter.isLoading??!1}get newThreadId(){}get threadIds(){return this._threads}get archivedThreadIds(){return this._archivedThreads}get threadData(){return this._threadData}getLoadThreadsPromise(){return jG}_mainThread;get mainThreadId(){return this._mainThreadId}constructor(t={},n){this.adapter=t,this.threadFactory=n,this._mainThread=this.threadFactory(),this.__internal_setAdapter(t,!0)}getMainThreadRuntimeCore(){return this._mainThread}getThreadRuntimeCore(){throw new Error("Method not implemented.")}getItemById(t){for(const n of this.adapter.threads??[])if(n.id===t)return n;for(const n of this.adapter.archivedThreads??[])if(n.id===t)return n;if(t===Ra)return nO}__internal_setAdapter(t,n=!1){const i=this.adapter;this.adapter=t;const s=t.threadId??Ra,r=t.threads??fa,a=t.archivedThreads??fa,o=i.threadId??Ra,l=i.threads??fa,u=i.archivedThreads??fa;!n&&o===s&&l===r&&u===a||(this._threadData={...oA,...Object.fromEntries(t.threads?.map(h=>[h.id,{...h,remoteId:h.remoteId,externalId:h.externalId,status:"regular"}])??[]),...Object.fromEntries(t.archivedThreads?.map(h=>[h.id,{...h,remoteId:h.remoteId,externalId:h.externalId,status:"archived"}])??[])},l!==r&&(this._threads=this.adapter.threads?.map(h=>h.id)??fa),u!==a&&(this._archivedThreads=this.adapter.archivedThreads?.map(h=>h.id)??fa),o!==s&&(this._mainThreadId=s,this._mainThread=this.threadFactory()),this._notifySubscribers())}async switchToThread(t){if(this._mainThreadId===t)return;const n=this.adapter.onSwitchToThread;if(!n)throw new Error("External store adapter does not support switching to thread");n(t)}async switchToNewThread(){const t=this.adapter.onSwitchToNewThread;if(!t)throw new Error("External store adapter does not support switching to new thread");t()}async rename(t,n){const i=this.adapter.onRename;if(!i)throw new Error("External store adapter does not support renaming");i(t,n)}async detach(){}async archive(t){const n=this.adapter.onArchive;if(!n)throw new Error("External store adapter does not support archiving");n(t)}async unarchive(t){const n=this.adapter.onUnarchive;if(!n)throw new Error("External store adapter does not support unarchiving");n(t)}async delete(t){const n=this.adapter.onDelete;if(!n)throw new Error("External store adapter does not support deleting");n(t)}initialize(t){return Promise.resolve({remoteId:t,externalId:void 0})}generateTitle(){throw new Error("Method not implemented.")}_subscriptions=new Set;subscribe(t){return this._subscriptions.add(t),()=>this._subscriptions.delete(t)}_notifySubscribers(){for(const t of this._subscriptions)t()}}class k0{cache=new WeakMap;convertMessages(t,n){return t.map((i,s)=>{const r=this.cache.get(i),a=n(r,i,s);return this.cache.set(i,a),a})}}class FG extends WD{runtime;endEditCallback;get canCancel(){return!0}getAttachmentAdapter(){return this.runtime.adapters?.attachments}getDictationAdapter(){return this.runtime.adapters?.dictation}_nonTextParts;_previousText;_parentId;_sourceId;constructor(t,n,{parentId:i,message:s}){super(),this.runtime=t,this.endEditCallback=n,this._parentId=i,this._sourceId=s.id,this._previousText=Bd(s),this.setText(this._previousText),this.setRole(s.role),this.setAttachments(s.attachments??[]),this._nonTextParts=s.content.filter(r=>r.type!=="text"),this.setRunConfig({...t.composer.runConfig})}async handleSend(t){Bd(t)!==this._previousText&&this.runtime.append({...t,content:[...t.content,...this._nonTextParts],parentId:this._parentId,sourceId:this._sourceId}),this.handleCancel()}handleCancel(){this.endEditCallback(),this._notifySubscribers()}}class UG{_contextProvider;_subscriptions=new Set;_isInitialized=!1;repository=new vC;get messages(){return this.repository.getMessages()}get state(){let t;for(const n of this.messages)if(n.role==="assistant"){t=n;break}return t?.metadata.unstable_state??null}composer=new GD(this);constructor(t){this._contextProvider=t}getModelContext(){return this._contextProvider.getModelContext()}_editComposers=new Map;getEditComposer(t){return this._editComposers.get(t)}beginEdit(t){if(this._editComposers.has(t))throw new Error("Edit already in progress");this._editComposers.set(t,new FG(this,()=>this._editComposers.delete(t),this.repository.getMessage(t))),this._notifySubscribers()}getMessageById(t){try{return this.repository.getMessage(t)}catch{return}}getBranches(t){return this.repository.getBranches(t)}switchToBranch(t){this.repository.switchToBranch(t),this._notifySubscribers()}_notifySubscribers(){for(const t of this._subscriptions)t()}_notifyEventSubscribers(t){const n=this._eventSubscribers.get(t);if(n)for(const i of n)i()}subscribe(t){return this._subscriptions.add(t),()=>this._subscriptions.delete(t)}submitFeedback({messageId:t,type:n}){const i=this.adapters?.feedback;if(!i)throw new Error("Feedback adapter not configured");const{message:s,parentId:r}=this.repository.getMessage(t);if(i.submit({message:s,type:n}),s.role==="assistant"){const a={...s,metadata:{...s.metadata,submittedFeedback:{type:n}}};this.repository.addOrUpdateMessage(r,a)}this._notifySubscribers()}_stopSpeaking;speech;speak(t){const n=this.adapters?.speech;if(!n)throw new Error("Speech adapter not configured");const{message:i}=this.repository.getMessage(t);this._stopSpeaking?.();const s=n.speak(Bd(i)),r=s.subscribe(()=>{s.status.type==="ended"?(this._stopSpeaking=void 0,this.speech=void 0):this.speech={messageId:t,status:s.status},this._notifySubscribers()});this.speech={messageId:t,status:s.status},this._notifySubscribers(),this._stopSpeaking=()=>{s.cancel(),r(),this.speech=void 0,this._stopSpeaking=void 0}}stopSpeaking(){if(!this._stopSpeaking)throw new Error("No message is being spoken");this._stopSpeaking(),this._notifySubscribers()}ensureInitialized(){this._isInitialized||(this._isInitialized=!0,this._notifyEventSubscribers("initialize"))}export(){return this.repository.export()}import(t){this.ensureInitialized(),this.repository.clear(),this.repository.import(t),this._notifySubscribers()}reset(t){this.import(gC.fromArray(t??[]))}_eventSubscribers=new Map;unstable_on(t,n){if(t==="model-context-update")return this._contextProvider.subscribe?.(n)??(()=>{});const i=this._eventSubscribers.get(t);return i?i.add(n):this._eventSubscribers.set(t,new Set([n])),()=>{this._eventSubscribers.get(t).delete(n)}}}const zG=Object.freeze([]),HG=(e,t)=>e&&t[t.length-1]?.role!=="assistant";class $G extends UG{_assistantOptimisticId=null;_capabilities={switchToBranch:!1,switchBranchDuringRun:!1,edit:!1,reload:!1,cancel:!1,unstable_copy:!1,speech:!1,dictation:!1,attachments:!1,feedback:!1};get capabilities(){return this._capabilities}_messages;isDisabled;get isLoading(){return this._store.isLoading??!1}get messages(){return this._messages}get state(){return this._store.state??super.state}get adapters(){return this._store.adapters}suggestions=[];extras=void 0;_converter=new k0;_store;beginEdit(t){if(!this._store.onEdit)throw new Error("Runtime does not support editing.");super.beginEdit(t)}constructor(t,n){super(t),this.__internal_setAdapter(n)}__internal_setAdapter(t){if(this._store===t)return;const n=t.isRunning??!1;this.isDisabled=t.isDisabled??!1;const i=this._store;this._store=t,this.extras=t.extras,this.suggestions=t.suggestions??zG,this._capabilities={switchToBranch:this._store.setMessages!==void 0,switchBranchDuringRun:!1,edit:this._store.onEdit!==void 0,reload:this._store.onReload!==void 0,cancel:this._store.onCancel!==void 0,speech:this._store.adapters?.speech!==void 0,dictation:this._store.adapters?.dictation!==void 0,unstable_copy:this._store.unstable_capabilities?.copy!==!1,attachments:!!this._store.adapters?.attachments,feedback:!!this._store.adapters?.feedback};let s;if(t.messageRepository){if(i&&i.isRunning===t.isRunning&&i.messageRepository===t.messageRepository){this._notifySubscribers();return}this.repository.clear(),this._assistantOptimisticId=null,this.repository.import(t.messageRepository),s=this.repository.getMessages()}else if(t.messages){if(i){if(i.convertMessage!==t.convertMessage)this._converter=new k0;else if(i.isRunning===t.isRunning&&i.messages===t.messages){this._notifySubscribers();return}}s=t.convertMessage?this._converter.convertMessages(t.messages,(r,a,o)=>{if(!t.convertMessage)return a;const l=o===(t.messages?.length??0)-1,u=ag(l,n,!1,!1,void 0);if(r&&(r.role!=="assistant"||!KD(r.status)||r.status===u))return r;const h=t.convertMessage(a,o),f=rh(h,o.toString(),u);return f[ei]=a,f}):t.messages;for(let r=0;r<s.length;r++){const a=s[r],o=s[r-1];this.repository.addOrUpdateMessage(o?.id??null,a)}}else throw new Error("ExternalStoreAdapter must provide either 'messages' or 'messageRepository'");s.length>0&&this.ensureInitialized(),(i?.isRunning??!1)!==(t.isRunning??!1)&&(t.isRunning?this._notifyEventSubscribers("run-start"):this._notifyEventSubscribers("run-end")),this._assistantOptimisticId&&(this.repository.deleteMessage(this._assistantOptimisticId),this._assistantOptimisticId=null),HG(n,s)&&(this._assistantOptimisticId=this.repository.appendOptimisticMessage(s.at(-1)?.id??null,{role:"assistant",content:[]})),this.repository.resetHead(this._assistantOptimisticId??s.at(-1)?.id??null),this._messages=this.repository.getMessages(),this._notifySubscribers()}switchToBranch(t){if(!this._store.setMessages)throw new Error("Runtime does not support switching branches.");this._store.isRunning||(this.repository.switchToBranch(t),this.updateMessages(this.repository.getMessages()))}async append(t){if(t.parentId!==(this.messages.at(-1)?.id??null)){if(!this._store.onEdit)throw new Error("Runtime does not support editing messages.");await this._store.onEdit(t)}else await this._store.onNew(t)}async startRun(t){if(!this._store.onReload)throw new Error("Runtime does not support reloading messages.");await this._store.onReload(t.parentId,t)}async resumeRun(t){if(!this._store.onResume)throw new Error("Runtime does not support resuming runs.");await this._store.onResume(t)}unstable_loadExternalState(t){if(!this._store.onLoadExternalState)throw new Error("Runtime does not support importing states.");this._store.onLoadExternalState(t)}cancelRun(){if(!this._store.onCancel)throw new Error("Runtime does not support cancelling runs.");this._store.onCancel(),this._assistantOptimisticId&&(this.repository.deleteMessage(this._assistantOptimisticId),this._assistantOptimisticId=null);let t=this.repository.getMessages();const n=t[t.length-1];n?.role==="user"&&n.id===t.at(-1)?.id?(this.repository.deleteMessage(n.id),this.composer.text.trim()||this.composer.setText(Bd(n)),t=this.repository.getMessages()):this._notifySubscribers(),setTimeout(()=>{this.updateMessages(t)},0)}addToolResult(t){if(!this._store.onAddToolResult&&!this._store.onAddToolResult)throw new Error("Runtime does not support tool results.");this._store.onAddToolResult?.(t)}resumeToolCall(t){if(!this._store.onResumeToolCall)throw new Error("Runtime does not support resuming tool calls.");this._store.onResumeToolCall(t)}reset(t){const n=new vC;n.import(gC.fromArray(t??[])),this.updateMessages(n.getMessages())}import(t){this._assistantOptimisticId=null,super.import(t),this._store.onImport&&this._store.onImport(this.repository.getMessages())}updateMessages=t=>{this._store.convertMessage!==void 0?this._store.setMessages?.(t.flatMap(gG).filter(i=>i!=null)):this._store.setMessages?.(t)}}const aA=e=>e.adapters?.threadList??{};class qG extends VD{threads;constructor(t){super(),this.threads=new BG(aA(t),()=>new $G(this._contextProvider,t))}setAdapter(t){this.threads.__internal_setAdapter(aA(t)),this.threads.getMainThreadRuntimeCore().__internal_setAdapter(t)}}const VG=e=>{const[t]=P.useState(()=>new qG(e));P.useEffect(()=>{t.setAdapter(e)});const{modelContext:n}=OG()??{};return P.useEffect(()=>{if(n)return t.registerModelContextProvider(n)},[n,t]),P.useMemo(()=>new wO(t),[t])};function WG(e,t){e.commitTasks.forEach(n=>{const i=n.cellIndex,s=t.cells[i];if(s.type!=="effect")throw new Error("Cannot find effect cell");let r=!0;if(s.deps!==void 0&&n.deps!==void 0&&(r=s.deps.length!==n.deps.length||s.deps.some((a,o)=>!Object.is(a,n.deps[o]))),r){if(s.mounted){if(typeof s.deps!=typeof n.deps)throw new Error("tapEffect called with and without dependencies across re-renders");try{s.mounted&&s.cleanup&&s.cleanup()}finally{s.mounted=!1}}const a=n.effect();if(a!==void 0&&typeof a!="function")throw new Error(`An effect function must either return a cleanup function or nothing. Received: ${typeof a}`);s.mounted=!0,s.cleanup=typeof a=="function"?a:void 0,s.deps=n.deps}})}function GG(e){let t=null;for(let n=e.cells.length-1;n>=0;n--){const i=e.cells[n];if(i?.type==="effect"&&i.mounted&&i.cleanup)try{i.cleanup()}catch(s){t==null&&(t=s)}finally{i.mounted=!1}}if(t!=null)throw t}let hd=null;function KG(e,t){e.currentIndex=0;const n=hd;hd=e;try{if(t(),e.isFirstRender=!1,e.cells.length!==e.currentIndex)throw new Error(`Rendered ${e.currentIndex} hooks but expected ${e.cells.length}. Hooks must be called in the exact same order in every render.`)}finally{hd=n}}function yC(){if(!hd)throw new Error("No resource fiber available");return hd}function iO(e,t){const n=e[sO];if(!n)throw new Error("ResourceElement.type is not a valid Resource");return n(t)}const sO=Symbol("fnSymbol");function cg(e,t){return{resource:e,scheduleRerender:t,cells:[],currentIndex:0,renderContext:void 0,isFirstRender:!0,isMounted:!1,isNeverMounted:!0}}function Fd(e){e.isMounted=!1,GG(e)}function Ud(e,t){const n={commitTasks:[],props:t,state:void 0};return KG(e,()=>{e.renderContext=n;try{n.state=iO(e.resource,t)}finally{e.renderContext=void 0}}),n}function zd(e,t){e.isMounted=!0,e.isNeverMounted=!1,WG(t,e)}const YG=globalThis.__ASSISTANT_UI_DISABLE_LAYOUT_EFFECT__===!0,lA=YG?P.useEffect:P.useLayoutEffect;function _C(e){const[,t]=P.useState({}),n=P.useMemo(()=>cg(e.type,()=>t({})),[e.type]),i=Ud(n,e.props);return lA(()=>()=>Fd(n),[n]),lA(()=>{zd(n,i)}),i.state}const ug=e=>typeof e=="string"?{scope:e.split(".")[0],event:e}:{scope:e.scope,event:e.event},fd=(e,t,n)=>t===e;let Kl;const $y=()=>{if(Kl)return Kl;const e=()=>({apis:new Map,nextId:0,listeners:new Set});if(typeof window>"u")return Kl=e(),Kl;const t=window.__ASSISTANT_UI_DEVTOOLS_HOOK__;if(t)return Kl=t,t;const n=e();return window.__ASSISTANT_UI_DEVTOOLS_HOOK__=n,Kl=n,n};class xa{static MAX_EVENT_LOGS_PER_API=200;static register(t){const n=$y();for(const o of n.apis.values())if(o.api===t)return()=>{};const i=n.nextId++,s={api:t,logs:[]},r=t.on?.("*",o=>{const l=n.apis.get(i);l&&(l.logs.push({time:new Date,event:o.event,data:o.payload}),l.logs.length>xa.MAX_EVENT_LOGS_PER_API&&(l.logs=l.logs.slice(-200)),xa.notifyListeners(i))}),a=t.subscribe?.(()=>{xa.notifyListeners(i)});return n.apis.set(i,s),xa.notifyListeners(i),()=>{const o=$y();o.apis.get(i)&&(r?.(),a?.(),o.apis.delete(i),xa.notifyListeners(i))}}static notifyListeners(t){$y().listeners.forEach(i=>i(t))}}function Xt(e){const t=n=>({type:t,props:n});return t[sO]=e,t}const QG=e=>{if(e.renderContext)throw new Error("Resource updated during render");if(e.isMounted)e.scheduleRerender();else if(e.isNeverMounted)throw new Error("Resource updated before mount")};function JG(e){const t=yC(),n=t.currentIndex++;if(!t.isFirstRender&&n>=t.cells.length)throw new Error("Rendered more hooks than during the previous render. Hooks must be called in the exact same order in every render.");if(!t.cells[n]){const r={type:"state",value:typeof e=="function"?e():e,set:a=>{const o=r.value,l=typeof a=="function"?a(o):a;Object.is(o,l)||(r.value=l,QG(t))}};t.cells[n]=r}const i=t.cells[n];if(i.type!=="state")throw new Error("Hook order changed between renders");return i}function Js(e){const t=JG(e);return[t.value,t.set]}function XG(){const e=yC(),t=e.currentIndex++;if(!e.isFirstRender&&t>=e.cells.length)throw new Error("Rendered more hooks than during the previous render. Hooks must be called in the exact same order in every render.");if(!e.cells[t]){const i={type:"effect",mounted:!1};e.cells[t]=i}if(e.cells[t].type!=="effect")throw new Error("Hook order changed between renders");return t}function ii(e,t){const n=yC(),i=XG();n.renderContext.commitTasks.push({effect:e,deps:t,cellIndex:i})}function kc(e){const[t]=Js(()=>({current:e}));return t}const ZG=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0},Et=(e,t)=>{const n=kc();return n.current||(n.current={value:e(),deps:t}),ZG(n.current.deps,t)||(n.current.value=e(),n.current.deps=t),n.current.value},eK=(e,t)=>Et(()=>e,t);function pd(e,t){const[n,i]=Js({}),s=Et(()=>cg(e.type,()=>i({})),[e.type]),r=t?Et(()=>e.props,t):e.props,a=Et(()=>Ud(s,r),[s,r,n]);return ii(()=>()=>Fd(s),[s]),ii(()=>{zd(s,a)},[s,a]),a.state}function tr(e){return iO(e.type,e.props)}function rO(e,t,n){const[i,s]=Js(0),r=eK(()=>s(u=>u+1),[]),[a]=Js(()=>new Map),o=Et(()=>t,n),l=Et(()=>{const u={remove:[],add:[],commit:[],return:{}};for(const h in e){const f=e[h],m=o(f,h);let g=a.get(h);(!g||g.resource!==m.type)&&(g&&u.remove.push(h),g=cg(m.type,r),u.add.push([h,g]));const C=Ud(g,m.props);u.commit.push([h,C]),u.return[h]=C.state}if(a.size>u.commit.length-u.add.length+u.remove.length)for(const h of a.keys())h in e||u.remove.push(h);return u},[e,o,i]);return ii(()=>()=>{for(const u of a.keys())Fd(a.get(u)),a.delete(u)},[]),ii(()=>{for(const u of l.remove)Fd(a.get(u)),a.delete(u);for(const[u,h]of l.add)a.set(u,h);for(const[u,h]of l.commit)zd(a.get(u),h)},[l]),l.return}const tK=50;let Hs={schedulers:new Set([]),isScheduled:!1};class nK{_task;_isDirty=!1;constructor(t){this._task=t}get isDirty(){return this._isDirty}markDirty(){this._isDirty=!0,Hs.schedulers.add(this),iK()}runTask(){this._isDirty=!1,this._task()}}const iK=()=>{Hs.isScheduled||(Hs.isScheduled=!0,queueMicrotask(oO))},oO=()=>{try{const e=[];let t=0;for(const n of Hs.schedulers)if(Hs.schedulers.delete(n),!!n.isDirty){if(t++,t>tK)throw new Error("Maximum update depth exceeded. This can happen when a resource repeatedly calls setState inside tapEffect.");try{n.runTask()}catch(i){e.push(i)}}if(e.length>0)throw e.length===1?e[0]:new AggregateError(e,"Errors occurred during flushSync")}finally{Hs.schedulers.clear(),Hs.isScheduled=!1}},T0=e=>{const t=Hs;Hs={schedulers:new Set([]),isScheduled:!0};try{const n=e();return oO(),n}finally{Hs=t}},sK=Xt(e=>{const[,t]=Js(e.element),n=pd(e.element),i=kc(new Set).current,s=kc(n);return ii(()=>{n!==s.current&&(s.current=n,i.forEach(a=>a()))}),Et(()=>({getState:()=>s.current,subscribe:a=>(i.add(a),()=>i.delete(a)),render:a=>{const o=e.element!==a;e.element=a,e.onRender(o)&&t(a)},unmount:e.onUnmount}),[])}),rK=(e,{mount:t=!0}={})=>{let n=t,i;const s={element:e,onRender:o=>n?o:(n=!0,T0(()=>{o&&(i=Ud(a,s)),!r.isDirty&&zd(a,i)}),!1),onUnmount:()=>{if(!n)throw new Error("Resource not mounted");n=!1,Fd(a)}},r=new nK(()=>{i=Ud(a,s),!(r.isDirty||!n)&&zd(a,i)}),a=cg(sK,()=>r.markDirty());return T0(()=>{r.markDirty()}),i.state},md=Symbol("tap.Context"),aO=e=>({[md]:e}),lO=(e,t,n)=>{const i=e[md];e[md]=t;try{return n()}finally{e[md]=i}},cO=e=>e[md],cA=e=>{let t;const n=new Set,i=(u,h)=>{const f=typeof u=="function"?u(t):u;if(!Object.is(f,t)){const m=t;t=h??(typeof f!="object"||f===null)?f:Object.assign({},t,f),n.forEach(g=>g(t,m))}},s=()=>t,o={setState:i,getState:s,getInitialState:()=>l,subscribe:u=>(n.add(u),()=>n.delete(u))},l=t=e(i,s,o);return o},oK=(e=>e?cA(e):cA),aK=e=>e;function lK(e,t=aK){const n=Un.useSyncExternalStore(e.subscribe,Un.useCallback(()=>t(e.getState()),[e,t]),Un.useCallback(()=>t(e.getInitialState()),[e,t]));return Un.useDebugValue(n),n}const uA=e=>{const t=oK(e),n=i=>lK(t,i);return Object.assign(n,t),n},uO=(e=>e?uA(e):uA),dO=Xt(e=>{const t=Et(()=>rK(e,{mount:!1}),[e.type]);return ii(()=>{t.render(e)}),t});class cK{ref;constructor(t){this.ref=t}get(t,n){return this.ref.current[n]}ownKeys(){return Object.keys(this.ref.current)}has(t,n){return n in this.ref.current}getOwnPropertyDescriptor(t,n){return Object.getOwnPropertyDescriptor(this.ref.current,n)}set(){return!1}setPrototypeOf(){return!1}defineProperty(){return!1}deleteProperty(){return!1}preventExtensions(){return!1}}const As=(e,t)=>{const n=kc(e);ii(()=>{n.current=e});const i=Et(()=>new Proxy({},new cK(n)),[]),s=t?.key,r=e.getState();return Et(()=>({key:s,state:r,api:i}),[r,s])},Hd=Xt(e=>{const t=kc(e.get);return ii(()=>{t.current=e.get}),Et(()=>Bn({source:e.source,query:e.query,get:()=>t.current()}),[e.source,JSON.stringify(e.query)])}),uK=Xt(e=>{const t=pd(e.scopeElement);return Et(()=>[e.fieldName,t],[e.fieldName,t])}),dK=Xt(e=>{const{on:t,subscribe:n,...i}=e,s=kc({on:t,subscribe:n});ii(()=>{s.current={on:t,subscribe:n}});const r=rO(i,(a,o)=>uK({fieldName:o,scopeElement:a}),[]);return Et(()=>{const a=Object.fromEntries(Object.values(r)),{on:o,subscribe:l}=s.current;return o&&(a.on=(u,h)=>o(u,h)),l&&(a.subscribe=u=>l(u)),a},[r])}),hO=aO(null),hK=(e,t)=>lO(hO,e,t),fO=()=>{const e=cO(hO);if(!e)throw new Error("Model context is not available in this context");return e},fK=Xt(({toolkit:e})=>{const[t,n]=Js(()=>({tools:{}})),i=fO();ii(()=>{if(!e)return;const r=[];for(const[l,u]of Object.entries(e))u.render&&r.push(s(l,u.render));const a=Object.entries(e).reduce((l,[u,h])=>{const{render:f,...m}=h;return l[u]=m,l},{}),o={getModelContext:()=>({tools:a})};return r.push(i.register(o)),()=>{r.forEach(l=>l())}},[e,i]);const s=(r,a)=>(n(o=>({...o,tools:{...o.tools,[r]:[...o.tools[r]??[],a]}})),()=>{n(o=>({...o,tools:{...o.tools,[r]:o.tools[r]?.filter(l=>l!==a)??[]}}))});return As({getState:()=>t,setToolUI:s})}),pK=Xt(()=>Et(()=>{const t=new Map;return{on:(n,i)=>{t.has(n)||t.set(n,new Set);const s=t.get(n);return s.add(i),()=>{s.delete(i),s.size===0&&t.delete(n)}},emit:(n,i)=>{const s=t.get(n),r=t.get("*");!s&&!r||queueMicrotask(()=>{if(s)for(const a of s)a(i);if(r)for(const a of r)a({event:n,payload:i})})}}},[])),pO=aO(null),mK=(e,t)=>lO(pO,e,t),SC=()=>{const e=cO(pO);if(!e)throw new Error("Events context is not available");return e},gK=Xt(()=>{const[e]=Js(()=>({})),t=new mC;return As({getState:()=>e,getModelContext:()=>t.getModelContext(),subscribe:n=>t.subscribe(n),register:n=>t.registerModelContextProvider(n)})}),vK=Xt(({threads:e,modelContext:t,tools:n})=>{const i=tr(pK()),{threads:s,tools:r,modelContext:a}=mK(i,()=>{const l=pd(t??gK(),[t]);return hK(l.api,()=>({modelContext:l,tools:pd(n??fK({}),[n]),threads:pd(e,[e])}))}),o=Et(()=>({threads:s.state,tools:r.state,modelContext:a.state}),[s.state,r.state,a.state]);return As({getState:()=>o,threads:s.api,tools:r.api,modelContext:a.api,on:i.on})}),bK=e=>{const t=()=>e.getState().api.threads.item("main");return{threads:Bn({source:"root",query:{},get:()=>e.getState().api.threads}),tools:Bn({source:"root",query:{},get:()=>e.getState().api.tools}),modelContext:Bn({source:"root",query:{},get:()=>e.getState().api.modelContext}),thread:Bn({source:"threads",query:{type:"main"},get:()=>e.getState().api.threads.thread("main")}),threadListItem:Bn({source:"threads",query:{type:"main"},get:()=>t()}),composer:Bn({source:"thread",query:{},get:()=>e.getState().api.threads.thread("main").composer}),on(n,i){const{event:s,scope:r}=ug(n);if(r==="*")return e.getState().api.on(s,i);if(fd("thread",r)||fd("thread-list-item",r)||fd("composer",r))return e.getState().api.on(s,a=>{a.threadId===t().getState().id&&i(a)});throw new Error(`Event scope is not available in this component: ${r}`)},subscribe:e.subscribe}},yK=e=>{const t=CC(),n=_C(dO(vK(e))),i=P.useMemo(()=>bK(n),[n]);return P.useMemo(()=>gO(t,i),[t,i])},Bn=e=>{const t=e.get;return t.source=e.source,t.query=e.query,t},bm=()=>()=>{},mO=P.createContext({threads:Bn({source:null,query:{},get:()=>{throw new Error("Threads is only available inside <AssistantProvider />")}}),tools:Bn({source:null,query:{},get:()=>{throw new Error("Tools is only available inside <AssistantProvider />")}}),modelContext:Bn({source:null,query:{},get:()=>{throw new Error("ModelContext is only available inside <AssistantProvider />")}}),threadListItem:Bn({source:null,query:{},get:()=>{throw new Error("ThreadListItem is only available inside <AssistantProvider />")}}),thread:Bn({source:null,query:{},get:()=>{throw new Error("Thread is only available inside <AssistantProvider />")}}),composer:Bn({source:null,query:{},get:()=>{throw new Error("Composer is only available inside <AssistantProvider />")}}),message:Bn({source:null,query:{},get:()=>{throw new Error("Message is only available inside <ThreadPrimitive.Messages />")}}),part:Bn({source:null,query:{},get:()=>{throw new Error("Part is only available inside <MessagePrimitive.Parts />")}}),attachment:Bn({source:null,query:{},get:()=>{throw new Error("Attachment is only available inside <MessagePrimitive.Attachments /> or <ComposerPrimitive.Attachments />")}}),subscribe:bm,on:e=>{const{scope:t}=ug(e);throw new Error(`Event scope is not available in this component: ${t}`)}}),CC=()=>P.useContext(mO),dg=e=>{const t=CC(),n=_C(dK(e));return P.useMemo(()=>gO(t,n),[t,n])},_K=e=>yK(e);function qn(e){return e?_K(e):CC()}const SK=(e,t)=>e===bm?t:t===bm?e:(...n)=>{const i=e(...n),s=t(...n);return()=>{i(),s()}},gO=(e,t)=>{const n=t.subscribe;return{...e,...t,subscribe:SK(e.subscribe,n??bm)}},oh=({api:e,children:t,devToolsVisible:n=!0})=>(P.useEffect(()=>{if(!(!n||!e.subscribe))return xa.register(e)},[e,n]),b.jsx(mO.Provider,{value:e,children:t}));class dA{#e;constructor(t){this.#e=t}get threads(){return this.#e.threads().getState()}get tools(){return this.#e.tools().getState()}get threadListItem(){return this.#e.threadListItem().getState()}get thread(){return this.#e.thread().getState()}get composer(){return this.#e.composer().getState()}get message(){return this.#e.message().getState()}get part(){return this.#e.part().getState()}get attachment(){return this.#e.attachment().getState()}}const st=e=>{const t=qn(),n=P.useMemo(()=>new dA(t),[t]),i=P.useSyncExternalStore(t.subscribe,()=>e(n),()=>e(n));if(P.useDebugValue(i),i instanceof dA)throw new Error("You tried to return the entire AssistantState. This is not supported due to technical limitations.");return i},qy=(e,t)=>{const n=qn(),i=P.useRef(t);P.useEffect(()=>{i.current=t});const{scope:s,event:r}=ug(e);P.useEffect(()=>n.on({scope:s,event:r},a=>i.current(a)),[n,s,r])};function CK(e,t){function n(i){const s=P.useContext(e);if(!i?.optional&&!s)throw new Error(`This component must be used within ${t}.`);return s}return n}function vO(e,t){function n(s){const r=e(s);return r?r[t]:null}function i(s){let r=!1,a;typeof s=="function"?a=s:s&&typeof s=="object"&&(r=!!s.optional,a=s.selector);const o=n({optional:r});return o?a?o(a):o():null}return{[t]:i,[`${t}Store`]:n}}const bO=P.createContext(null),xK=CK(bO,"ThreadPrimitive.Viewport"),{useThreadViewport:ym,useThreadViewportStore:xC}=vO(xK,"useThreadViewport"),wK=e=>{const t=e;t.__isBound||(t.__internal_bindMethods?.(),t.__isBound=!0)};function kK(e,t=TK){wK(e);const n=P.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getState()));return P.useDebugValue(n),n}const TK=e=>e;function yO(e){function t(n){let i=!1,s;typeof n=="function"?s=n:n&&(i=!!n.optional,s=n.selector);const r=e({optional:i});return r?kK(r,s):null}return t}function EK(e){const t=qn(),n=st(()=>t.attachment.source?t.attachment().__internal_getRuntime?.()??null:null);if(!n&&!e?.optional)throw new Error("AttachmentRuntime is not available");return n}function RK(e){const t=EK(e);if(!t)return null;if(t.source!=="thread-composer")throw new Error("This component must be used within a thread's ComposerPrimitive.Attachments component.");return t}const AK=yO(RK);function MK(e){const t=qn(),n=st(()=>t.message.source?t.message().__internal_getRuntime?.()??null:null);if(!n&&!e?.optional)throw new Error("MessageRuntime is not available");return n}const LK=yO(MK),IK=e=>{const t={role:"assistant",content:[]};for(const n of e)if(n.role==="tool"){const i=t.content.findIndex(s=>s.type==="tool-call"&&s.toolCallId===n.toolCallId);if(i!==-1){const s=t.content[i];if(n.toolName!==void 0&&s.toolName!==n.toolName)throw new Error(`Tool call name ${n.toolCallId} ${n.toolName} does not match existing tool call ${s.toolName}`);t.content[i]={...s,[ei]:[...s[ei]??[],n],result:n.result,artifact:n.artifact,isError:n.isError,messages:n.messages}}else throw new Error(`Tool call ${n.toolCallId} ${n.toolName} not found in assistant message`)}else{const i=n.role,s=(typeof n.content=="string"?[{type:"text",text:n.content}]:n.content).map(r=>({...r,[ei]:[n]}));switch(i){case"system":case"user":return{...n,content:s};case"assistant":t.content.length===0&&(t.id=n.id,t.createdAt??=n.createdAt,t.status??=n.status,n.attachments&&(t.attachments=[...t.attachments??[],...n.attachments]),n.metadata&&(t.metadata??={},n.metadata.unstable_state&&(t.metadata.unstable_state=n.metadata.unstable_state),n.metadata.unstable_annotations&&(t.metadata.unstable_annotations=[...t.metadata.unstable_annotations??[],...n.metadata.unstable_annotations]),n.metadata.unstable_data&&(t.metadata.unstable_data=[...t.metadata.unstable_data??[],...n.metadata.unstable_data]),n.metadata.steps&&(t.metadata.steps=[...t.metadata.steps??[],...n.metadata.steps]),n.metadata.custom&&(t.metadata.custom={...t.metadata.custom??{},...n.metadata.custom}),n.metadata.submittedFeedback&&(t.metadata.submittedFeedback=n.metadata.submittedFeedback)));for(const r of s){if(r.type==="reasoning"&&"parentId"in r&&r.parentId){const a=t.content.findIndex(o=>o.type==="reasoning"&&"parentId"in o&&o.parentId===r.parentId);if(a!==-1){const o=t.content[a];t.content[a]={...o,text:`${o.text}

${r.text}`,[ei]:[...o[ei]??[],...r[ei]??[]]};continue}}t.content.push(r)}break;default:{const r=i;throw new Error(`Unknown message role: ${r}`)}}}return t},PK=(e,t)=>{const n=[];let i=!1,s=!1,r=[],a=[];const o=()=>{a.length&&n.push({inputs:r,outputs:a}),r=[],a=[],i=!1,s=!1};for(const l of e)for(const u of l.outputs)(s&&u.role!=="tool"||!i||u.role==="user"||u.role==="system")&&o(),i=u.role==="assistant"||u.role==="tool",r.at(-1)!==l.input&&r.push(l.input),a.push(u),u.role==="assistant"&&(u.convertConfig?.joinStrategy==="none"||t==="none")&&(s=!0);return o(),n},DK=({callback:e,messages:t,isRunning:n,joinStrategy:i,metadata:s})=>{const r=P.useMemo(()=>({metadata:s??{},callback:e,callbackCache:new WeakMap,chunkCache:new WeakMap,converterCache:new k0}),[e,s]);return P.useMemo(()=>{const a=[];for(const u of t){let h=r.callbackCache.get(u);if(!h){const f=r.callback(u,r.metadata),m=Array.isArray(f)?f:[f];h={input:u,outputs:m},r.callbackCache.set(u,h)}a.push(h)}const o=PK(a,i).map(u=>{const h=u.outputs[0];if(!h)return u;const f=r.chunkCache.get(h);return f&&hA(f.outputs,u.outputs)?f:(r.chunkCache.set(h,u),u)}),l=r.converterCache.convertMessages(o,(u,h,f)=>{const m=f===o.length-1,g=IK(h.outputs),C=typeof g.content=="object"&&g.content.some(w=>w.type==="tool-call"&&w.result===void 0),S=typeof g.content=="object"&&g.content.some(w=>w.type==="tool-call"&&w.result===void 0),v=ag(m,n,C,S,m?r.metadata.error:void 0);if(u&&(u.role!=="assistant"||!KD(u.status)||u.status===v)){const w=bG(u);if(hA(w,h.inputs))return u}const _=rh(g,f.toString(),v);return _[ei]=h.inputs,_});return l[ei]=t,l},[r,t,n,i])},hA=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},Za=e=>{const[,t]=Js(e.getState);return ii(()=>(t(e.getState()),e.subscribe(()=>{t(e.getState())})),[e]),e.getState()},OK=Xt(({runtime:e})=>{const t=Za(e),n=SC();return ii(()=>{const i=[],s=["switched-to","switched-away"];for(const r of s){const a=e.unstable_on(r,()=>{n.emit(`thread-list-item.${r}`,{threadId:e.getState().id})});i.push(a)}return()=>{for(const r of i)r()}},[e,n]),As({getState:()=>t,switchTo:e.switchTo,rename:e.rename,archive:e.archive,unarchive:e.unarchive,delete:e.delete,generateTitle:e.generateTitle,initialize:e.initialize,detach:e.detach,__internal_getRuntime:()=>e},{key:t.id})}),$d=e=>{const t=Et(()=>Object.fromEntries(e),[e]),n=rO(t,r=>r,[]),i=Et(()=>Object.keys(n),[n]);return{state:Et(()=>{const r=new Array(i.length);for(let a=0;a<i.length;a++)r[a]=n[i[a]].state;return r},[i,n]),api:r=>{const a="index"in r?n[i[r.index]]?.api:n[r.key]?.api;if(!a)throw new Error(`tapLookupResources: Resource not found for lookup: ${JSON.stringify(r)}`);return a}}},_O=Xt(({runtime:e})=>{const t=Za(e);return As({getState:()=>t,remove:e.remove,__internal_getRuntime:()=>e},{key:t.id})}),NK=Xt(({runtime:e,index:t})=>{const n=Et(()=>e.getAttachmentByIndex(t),[e,t]);return tr(_O({runtime:n}))}),SO=Xt(({threadIdRef:e,messageIdRef:t,runtime:n})=>{const i=Za(n),s=SC();ii(()=>{const o=[],l=["send","attachment-add"];for(const u of l){const h=n.unstable_on(u,()=>{s.emit(`composer.${u}`,{threadId:e.current,...t&&{messageId:t.current}})});o.push(h)}return()=>{for(const u of o)u()}},[n,s,e,t]);const r=$d(i.attachments.map((o,l)=>[o.id,NK({runtime:n,index:l})])),a=Et(()=>({text:i.text,role:i.role,attachments:r.state,runConfig:i.runConfig,isEditing:i.isEditing,canCancel:i.canCancel,attachmentAccept:i.attachmentAccept,isEmpty:i.isEmpty,type:i.type??"thread",dictation:i.dictation}),[i,r.state]);return As({getState:()=>a,setText:n.setText,setRole:n.setRole,setRunConfig:n.setRunConfig,addAttachment:n.addAttachment,reset:n.reset,clearAttachments:n.clearAttachments,send:n.send,cancel:n.cancel,beginEdit:n.beginEdit??(()=>{throw new Error("beginEdit is not supported in this runtime")}),startDictation:n.startDictation,stopDictation:n.stopDictation,attachment:o=>"id"in o?r.api({key:o.id}):r.api(o),__internal_getRuntime:()=>n})}),jK=Xt(({runtime:e})=>{const t=Za(e);return As({getState:()=>t,addToolResult:i=>e.addToolResult(i),resumeToolCall:i=>e.resumeToolCall(i),__internal_getRuntime:()=>e},{key:t.type==="tool-call"?`toolCallId-${t.toolCallId}`:void 0})}),BK=Xt(({runtime:e,index:t})=>{const n=Et(()=>e.getAttachmentByIndex(t),[e,t]);return tr(_O({runtime:n}))}),FK=Xt(({runtime:e,index:t})=>{const n=Et(()=>e.getMessagePartByIndex(t),[e,t]);return tr(jK({runtime:n}))}),UK=Xt(({runtime:e,threadIdRef:t})=>{const n=Za(e),[i,s]=Js(!1),[r,a]=Js(!1),o=Et(()=>({get current(){return e.getState().id}}),[e]),l=tr(SO({runtime:e.composer,threadIdRef:t,messageIdRef:o})),u=$d(n.content.map((m,g)=>["toolCallId"in m&&m.toolCallId!=null?`toolCallId-${m.toolCallId}`:`index-${g}`,FK({runtime:e,index:g})])),h=$d(n.attachments?.map((m,g)=>[m.id,BK({runtime:e,index:g})])??[]),f=Et(()=>({...n,parts:u.state,composer:l.state,isCopied:i,isHovering:r}),[n,u.state,l.state,i,r]);return As({getState:()=>f,composer:l.api,reload:m=>e.reload(m),speak:()=>e.speak(),stopSpeaking:()=>e.stopSpeaking(),submitFeedback:m=>e.submitFeedback(m),switchToBranch:m=>e.switchToBranch(m),getCopyText:()=>e.unstable_getCopyText(),part:m=>"index"in m?u.api({index:m.index}):u.api({key:`toolCallId-${m.toolCallId}`}),attachment:m=>"id"in m?h.api({key:m.id}):h.api(m),setIsCopied:s,setIsHovering:a,__internal_getRuntime:()=>e},{key:n.id})}),zK=Xt(({runtime:e,id:t,threadIdRef:n})=>{const i=Et(()=>e.getMessageById(t),[e,t]);return tr(UK({runtime:i,threadIdRef:n}))}),HK=Xt(({runtime:e})=>{const t=Za(e),n=SC();ii(()=>{const o=[],l=["run-start","run-end","initialize","model-context-update"];for(const u of l){const h=e.unstable_on(u,()=>{const f=e.getState()?.threadId||"unknown";n.emit(`thread.${u}`,{threadId:f})});o.push(h)}return()=>{for(const u of o)u()}},[e]);const i=Et(()=>({get current(){return e.getState().threadId}}),[e]),s=tr(SO({runtime:e.composer,threadIdRef:i})),r=$d(t.messages.map(o=>[o.id,zK({runtime:e,id:o.id,threadIdRef:i})])),a=Et(()=>({isEmpty:r.state.length===0&&!t.isLoading,isDisabled:t.isDisabled,isLoading:t.isLoading,isRunning:t.isRunning,capabilities:t.capabilities,state:t.state,suggestions:t.suggestions,extras:t.extras,speech:t.speech,composer:s.state,messages:r.state}),[t,r,s.state]);return As({getState:()=>a,composer:s.api,append:e.append,startRun:e.startRun,unstable_resumeRun:e.unstable_resumeRun,cancelRun:e.cancelRun,getModelContext:e.getModelContext,export:e.export,import:e.import,reset:e.reset,stopSpeaking:e.stopSpeaking,startVoice:async()=>{throw new Error("startVoice is not supported in this runtime")},stopVoice:async()=>{throw new Error("stopVoice is not supported in this runtime")},message:o=>"id"in o?r.api({key:o.id}):r.api(o),__internal_getRuntime:()=>e})}),$K=Xt(({runtime:e,id:t})=>{const n=Et(()=>e.getItemById(t),[e,t]);return tr(OK({runtime:n}))}),qK=Xt(({runtime:e,__internal_assistantRuntime:t})=>{const n=Za(e),i=tr(HK({runtime:e.main})),s=$d(Object.keys(n.threadItems).map(a=>[a,$K({runtime:e,id:a})])),r=Et(()=>({mainThreadId:n.mainThreadId,newThreadId:n.newThread??null,isLoading:n.isLoading,threadIds:n.threads,archivedThreadIds:n.archivedThreads,threadItems:s.state,main:i.state}),[n,s.state,i.state]);return As({getState:()=>r,thread:()=>i.api,item:a=>{if(a==="main")return s.api({key:r.mainThreadId});if("id"in a)return s.api({key:a.id});const{index:o,archived:l=!1}=a,u=l?r.archivedThreadIds[o]:r.threadIds[o];return s.api({key:u})},switchToThread:a=>{e.switchToThread(a)},switchToNewThread:()=>{e.switchToNewThread()},__internal_getAssistantRuntime:()=>t})}),VK=Xt(e=>{const t=fO();return ii(()=>e.registerModelContextProvider(t),[e,t]),tr(qK({runtime:e.threads,__internal_assistantRuntime:e}))}),Vy=e=>{const t=new Map,n=()=>{let i=0;for(const s of t.values())i+=s;e(i)};return{register:()=>{const i=Symbol();return t.set(i,0),{setHeight:s=>{t.get(i)!==s&&(t.set(i,s),n())},unregister:()=>{t.delete(i),n()}}}}},WK=(e={})=>{const t=new Set,n=Vy(a=>{r.setState({height:{...r.getState().height,viewport:a}})}),i=Vy(a=>{r.setState({height:{...r.getState().height,inset:a}})}),s=Vy(a=>{r.setState({height:{...r.getState().height,userMessage:a}})}),r=uO(()=>({isAtBottom:!0,scrollToBottom:({behavior:a="auto"}={})=>{for(const o of t)o({behavior:a})},onScrollToBottom:a=>(t.add(a),()=>{t.delete(a)}),turnAnchor:e.turnAnchor??"bottom",height:{viewport:0,inset:0,userMessage:0},registerViewport:n.register,registerContentInset:i.register,registerUserMessageHeight:s.register}));return r},qd=e=>e,GK=e=>{const t=xC({optional:!0}),[n]=P.useState(()=>WK(e));return P.useEffect(()=>t?.getState().onScrollToBottom(()=>{n.getState().scrollToBottom()}),[t,n]),P.useEffect(()=>{if(t)return n.subscribe(i=>{t.getState().isAtBottom!==i.isAtBottom&&qd(t).setState({isAtBottom:i.isAtBottom})})},[n,t]),P.useEffect(()=>{const i={turnAnchor:e.turnAnchor??"bottom"};n.getState().turnAnchor!==i.turnAnchor&&qd(n).setState(i)},[n,e.turnAnchor]),n},CO=({children:e,options:t={}})=>{const n=GK(t),[i]=P.useState(()=>({useThreadViewport:n}));return b.jsx(bO.Provider,{value:i,children:e})},KK=e=>e._core?.RenderComponent,YK=({children:e,runtime:t})=>{const n=qn({threads:VK(t)}),i=KK(t);return b.jsxs(oh,{api:n,children:[i&&b.jsx(i,{}),b.jsx(CO,{children:e})]})},QK=P.memo(YK),JK=({index:e,children:t})=>{const n=qn(),i=dg({message:Hd({source:"thread",query:{type:"index",index:e},get:()=>n.thread().message({index:e})}),composer:Hd({source:"message",query:{},get:()=>n.thread().message({index:e}).composer}),on(s,r){const a=()=>n.thread().message({index:e}),{event:o,scope:l}=ug(s);return!fd("composer",l)&&!fd("message",l)?n.on(s,r):n.on({scope:"thread",event:o},u=>{u.messageId===a().getState().id&&r(u)})}});return b.jsx(oh,{api:i,children:t})},XK=({index:e,children:t})=>{const n=qn(),i=dg({part:Hd({source:"message",query:{type:"index",index:e},get:()=>n.message().part({index:e})})});return b.jsx(oh,{api:i,children:t})},ZK=({index:e,children:t})=>{const n=qn(),i=dg({attachment:Hd({source:"composer",query:{type:"index",index:e},get:()=>n.composer().attachment({index:e})})});return b.jsx(oh,{api:i,children:t})},eY=Xt(({text:e,isRunning:t})=>{const n=Et(()=>({type:"text",text:e,status:t?{type:"running"}:{type:"complete"}}),[e,t]);return As({getState:()=>n,addToolResult:()=>{throw new Error("Not supported")},resumeToolCall:()=>{throw new Error("Not supported")}})}),xO=({text:e,isRunning:t=!1,children:n})=>{const i=_C(dO(eY({text:e,isRunning:t}))),s=dg({part:Hd({source:"root",query:{},get:()=>i.getState().api}),subscribe:i.subscribe});return b.jsx(oh,{api:s,children:n})};class wO{_core;threads;get threadList(){return this.threads}_thread;constructor(t){this._core=t,this.threads=new PG(t.threads),this._thread=this.threads.main,this.__internal_bindMethods()}__internal_bindMethods(){this.switchToNewThread=this.switchToNewThread.bind(this),this.switchToThread=this.switchToThread.bind(this),this.registerModelContextProvider=this.registerModelContextProvider.bind(this),this.registerModelConfigProvider=this.registerModelConfigProvider.bind(this),this.reset=this.reset.bind(this)}get thread(){return this._thread}switchToNewThread(){return this._core.threads.switchToNewThread()}switchToThread(t){return this._core.threads.switchToThread(t)}registerModelContextProvider(t){return this._core.registerModelContextProvider(t)}registerModelConfigProvider(t){return this.registerModelContextProvider(t)}reset({initialMessages:t}={}){return this._core.threads.getMainThreadRuntimeCore().import(gC.fromArray(t??[]))}}const kO=P.createContext(null),tY=e=>({useSmoothStatus:uO(()=>e)}),nY=({children:e})=>{const t=TO({optional:!0}),n=qn(),[i]=P.useState(()=>tY(n.part().getState().status));return t?e:b.jsx(kO.Provider,{value:i,children:e})},iY=e=>{const t=P.forwardRef((n,i)=>b.jsx(nY,{children:b.jsx(e,{...n,ref:i})}));return t.displayName=e.displayName,t};function TO(e){const t=P.useContext(kO);if(!e?.optional&&!t)throw new Error("This component must be used within a SmoothContextProvider.");return t}const{useSmoothStatus:sY,useSmoothStatusStore:rY}=vO(TO,"useSmoothStatus");class oY{currentText;setText;animationFrameId=null;lastUpdateTime=Date.now();targetText="";constructor(t,n){this.currentText=t,this.setText=n}start(){this.animationFrameId===null&&(this.lastUpdateTime=Date.now(),this.animate())}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}animate=()=>{const t=Date.now();let i=t-this.lastUpdateTime;const s=this.targetText.length-this.currentText.length,r=Math.min(5,250/s);let a=0;for(;i>=r&&a<s;)a++,i-=r;a!==s?this.animationFrameId=requestAnimationFrame(this.animate):this.animationFrameId=null,a!==0&&(this.currentText=this.targetText.slice(0,this.currentText.length+a),this.lastUpdateTime=t-i,this.setText(this.currentText))}}const Wy=Object.freeze({type:"running"}),EO=(e,t=!1)=>{const{text:n}=e,i=st(({message:h})=>h.id),s=P.useRef(i),[r,a]=P.useState(n),o=rY({optional:!0}),l=xs(h=>{if(a(h),o){const f=r!==h||e.status.type==="running"?Wy:e.status;qd(o).setState(f,!0)}});P.useEffect(()=>{if(o){const h=t&&(r!==n||e.status.type==="running")?Wy:e.status;qd(o).setState(h,!0)}},[o,t,n,r,e.status]);const[u]=P.useState(new oY(n,l));return P.useEffect(()=>{if(!t){u.stop();return}if(s.current!==i||!n.startsWith(u.targetText)){s.current=i,l(n),u.currentText=n,u.targetText=n,u.stop();return}u.targetText=n,u.start()},[l,u,i,t,n]),P.useEffect(()=>()=>{u.stop()},[u]),P.useMemo(()=>t?{type:"text",text:r,status:n===r?e.status:Wy}:e,[t,r,e,n])},aY=Object.freeze(Object.defineProperty({__proto__:null,AssistantRuntimeImpl:wO,BaseAssistantRuntimeCore:VD,CompositeContextProvider:mC,DefaultThreadComposerRuntimeCore:GD,MessageRepository:vC,ThreadRuntimeImpl:tO,fromThreadMessageLike:rh,generateId:og,getAutoStatus:ag,useSmooth:EO,useSmoothStatus:sY,withSmoothContextProvider:iY},Symbol.toStringTag,{value:"Module"}));var lY=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],el=lY.reduce((e,t)=>{const n=lD(`Primitive.${t}`),i=P.forwardRef((s,r)=>{const{asChild:a,...o}=s,l=a?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(l,{...o,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{});const wC=(e,t,n=[])=>{const i=P.forwardRef((s,r)=>{const a={},o={};Object.keys(s).forEach(u=>{n.includes(u)?a[u]=s[u]:o[u]=s[u]});const l=t(a)??void 0;return b.jsx(el.button,{type:"button",...o,ref:r,disabled:o.disabled||!l,onClick:Di(o.onClick,l)})});return i.displayName=e,i},RO=P.forwardRef((e,t)=>b.jsx(el.div,{...e,ref:t}));RO.displayName="AttachmentPrimitive.Root";const cY=()=>{const e=qn();return P.useCallback(()=>{e.attachment().remove()},[e])},uY=wC("AttachmentPrimitive.Remove",cY),ah=e=>{const t=P.useRef(void 0);return P.useCallback(i=>{t.current&&t.current(),i&&(t.current=e(i))},[e])},AO=(e,t)=>{const n=P.useCallback(i=>{if(!e)return;const s=e(),r=()=>{const o=t?t(i):i.offsetHeight;s.setHeight(o)},a=new ResizeObserver(r);return a.observe(i),r(),()=>{a.disconnect(),s.unregister()}},[e,t]);return ah(n)},fA=P.createContext(!1),pA=(e,t)=>{const n=e.match(/^([\d.]+)(em|px|rem)$/);if(!n)return 0;const i=parseFloat(n[1]),s=n[2];if(s==="px")return i;if(s==="em"){const r=parseFloat(getComputedStyle(t).fontSize)||16;return i*r}if(s==="rem"){const r=parseFloat(getComputedStyle(document.documentElement).fontSize)||16;return i*r}return 0},MO=({children:e,fillClampThreshold:t="10em",fillClampOffset:n="6em"})=>{const i=st(({thread:l,message:u})=>u.isLast&&u.role==="assistant"&&u.index>=1&&l.messages.at(u.index-1)?.role==="user"),s=xC({optional:!0}),r=P.useContext(fA),a=P.useCallback(l=>{if(!s||r)return;const u=()=>{const h=s.getState();if(h.turnAnchor==="top"&&i){const{viewport:f,inset:m,userMessage:g}=h.height,C=pA(t,l),S=pA(n,l),v=g<=C?g:S,_=Math.max(0,f-m-v);l.style.minHeight=`${_}px`,l.style.flexShrink="0",l.style.transition="min-height 0s"}else l.style.minHeight="",l.style.flexShrink="",l.style.transition=""};return u(),s.subscribe(u)},[s,i,r,t,n]),o=ah(a);return b.jsx(fA.Provider,{value:!0,children:b.jsx(lC,{ref:o,children:e})})};MO.displayName="ThreadPrimitive.ViewportSlack";const dY=()=>{const e=qn(),t=st(()=>e.message()),n=P.useCallback(i=>{const s=()=>{t.setIsHovering(!0)},r=()=>{t.setIsHovering(!1)};return i.addEventListener("mouseenter",s),i.addEventListener("mouseleave",r),i.matches(":hover")&&queueMicrotask(()=>t.setIsHovering(!0)),()=>{i.removeEventListener("mouseenter",s),i.removeEventListener("mouseleave",r),t.setIsHovering(!1)}},[t]);return ah(n)},hY=()=>{const e=ym(s=>s.turnAnchor),t=ym(s=>s.registerUserMessageHeight),n=st(({thread:s,message:r})=>e==="top"&&r.role==="user"&&r.index===s.messages.length-2&&s.messages.at(-1)?.role==="assistant"),i=P.useCallback(s=>s.offsetHeight,[]);return AO(n?t:null,i)},Vd=P.forwardRef((e,t)=>{const n=dY(),i=hY(),s=Es(t,n,i);return b.jsx(MO,{children:b.jsx(el.div,{...e,ref:s})})});Vd.displayName="MessagePrimitive.Root";const LO=()=>st(({part:t})=>{if(t.type!=="text"&&t.type!=="reasoning")throw new Error("MessagePartText can only be used inside text or reasoning message parts.");return t}),IO=P.forwardRef(({smooth:e=!0,component:t="span",...n},i)=>{const{text:s,status:r}=EO(LO(),e);return b.jsx(t,{"data-status":r.type,...n,ref:i,children:s})});IO.displayName="MessagePartPrimitive.Text";const fY=()=>st(({part:t})=>{if(t.type!=="image")throw new Error("MessagePartImage can only be used inside image message parts.");return t}),PO=P.forwardRef((e,t)=>{const{image:n}=fY();return b.jsx(el.img,{src:n,...e,ref:t})});PO.displayName="MessagePartPrimitive.Image";const DO=({children:e})=>st(({part:n})=>n.status.type==="running")?e:null;DO.displayName="MessagePartPrimitive.InProgress";const mA=e=>Symbol.iterator in e,gA=e=>"entries"in e,vA=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),i=t instanceof Map?t:new Map(t.entries());if(n.size!==i.size)return!1;for(const[s,r]of n)if(!i.has(s)||!Object.is(r,i.get(s)))return!1;return!0},pY=(e,t)=>{const n=e[Symbol.iterator](),i=t[Symbol.iterator]();let s=n.next(),r=i.next();for(;!s.done&&!r.done;){if(!Object.is(s.value,r.value))return!1;s=n.next(),r=i.next()}return!!s.done&&!!r.done};function mY(e,t){return Object.is(e,t)?!0:typeof e!="object"||e===null||typeof t!="object"||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?!1:mA(e)&&mA(t)?gA(e)&&gA(t)?vA(e,t):pY(e,t):vA({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})}function gY(e){const t=Un.useRef(void 0);return n=>{const i=e(n);return mY(t.current,i)?t.current:t.current=i}}const bA=e=>{let t=-1;return{startGroup:n=>{t===-1&&(t=n)},endGroup:(n,i)=>{t!==-1&&(i.push({type:e,startIndex:t,endIndex:n}),t=-1)},finalize:(n,i)=>{t!==-1&&i.push({type:e,startIndex:t,endIndex:n})}}},vY=e=>{const t=[],n=bA("toolGroup"),i=bA("reasoningGroup");for(let s=0;s<e.length;s++){const r=e[s];r==="tool-call"?(i.endGroup(s-1,t),n.startGroup(s)):r==="reasoning"?(n.endGroup(s-1,t),i.startGroup(s)):(n.endGroup(s-1,t),i.endGroup(s-1,t),t.push({type:"single",index:s}))}return n.finalize(e.length-1,t),i.finalize(e.length-1,t),t},bY=()=>{const e=st(gY(t=>t.message.parts.map(n=>n.type)));return P.useMemo(()=>e.length===0?[]:vY(e),[e])},yY=({Fallback:e,...t})=>{const n=st(({tools:i})=>{const s=i.tools[t.toolName]??e;return Array.isArray(s)?s[0]??e:s});return n?b.jsx(n,{...t}):null},Ar={Text:()=>b.jsxs("p",{style:{whiteSpace:"pre-line"},children:[b.jsx(IO,{}),b.jsx(DO,{children:b.jsx("span",{style:{fontFamily:"revert"},children:" "})})]}),Reasoning:()=>null,Source:()=>null,Image:()=>b.jsx(PO,{}),File:()=>null,Unstable_Audio:()=>null,ToolGroup:({children:e})=>e,ReasoningGroup:({children:e})=>e},_Y=({components:{Text:e=Ar.Text,Reasoning:t=Ar.Reasoning,Image:n=Ar.Image,Source:i=Ar.Source,File:s=Ar.File,Unstable_Audio:r=Ar.Unstable_Audio,tools:a={}}={}})=>{const o=qn(),l=st(({part:h})=>h),u=l.type;if(u==="tool-call"){const h=o.part().addToolResult,f=o.part().resumeToolCall;if("Override"in a)return b.jsx(a.Override,{...l,addResult:h,resume:f});const m=a.by_name?.[l.toolName]??a.Fallback;return b.jsx(yY,{...l,Fallback:m,addResult:h,resume:f})}if(l.status?.type==="requires-action")throw new Error("Encountered unexpected requires-action status");switch(u){case"text":return b.jsx(e,{...l});case"reasoning":return b.jsx(t,{...l});case"source":return b.jsx(i,{...l});case"image":return b.jsx(n,{...l});case"file":return b.jsx(s,{...l});case"audio":return b.jsx(r,{...l});case"data":return null;default:const h=u;throw new Error(`Unknown message part type: ${h}`)}},Dp=P.memo(({index:e,components:t})=>b.jsx(XK,{index:e,children:b.jsx(_Y,{components:t})}),(e,t)=>e.index===t.index&&e.components?.Text===t.components?.Text&&e.components?.Reasoning===t.components?.Reasoning&&e.components?.Source===t.components?.Source&&e.components?.Image===t.components?.Image&&e.components?.File===t.components?.File&&e.components?.Unstable_Audio===t.components?.Unstable_Audio&&e.components?.tools===t.components?.tools&&e.components?.ToolGroup===t.components?.ToolGroup&&e.components?.ReasoningGroup===t.components?.ReasoningGroup);Dp.displayName="MessagePrimitive.PartByIndex";const SY=({status:e,component:t})=>b.jsx(xO,{text:"",isRunning:e.type==="running",children:b.jsx(t,{type:"text",text:"",status:e})}),CY=Object.freeze({type:"complete"}),xY=({components:e})=>{const t=st(n=>n.message.status??CY);return e?.Empty?b.jsx(e.Empty,{status:t}):b.jsx(SY,{status:t,component:e?.Text??Ar.Text})},wY=P.memo(xY,(e,t)=>e.components?.Empty===t.components?.Empty&&e.components?.Text===t.components?.Text),OO=({components:e})=>{const t=st(({message:s})=>s.parts.length),n=bY(),i=P.useMemo(()=>t===0?b.jsx(wY,{components:e}):n.map(s=>{if(s.type==="single")return b.jsx(Dp,{index:s.index,components:e},s.index);if(s.type==="toolGroup"){const r=e?.ToolGroup??Ar.ToolGroup;return b.jsx(r,{startIndex:s.startIndex,endIndex:s.endIndex,children:Array.from({length:s.endIndex-s.startIndex+1},(a,o)=>b.jsx(Dp,{index:s.startIndex+o,components:e},o))},`tool-${s.startIndex}`)}else{const r=e?.ReasoningGroup??Ar.ReasoningGroup;return b.jsx(r,{startIndex:s.startIndex,endIndex:s.endIndex,children:Array.from({length:s.endIndex-s.startIndex+1},(a,o)=>b.jsx(Dp,{index:s.startIndex+o,components:e},o))},`reasoning-${s.startIndex}`)}}),[n,e,t]);return b.jsx(b.Fragment,{children:i})};OO.displayName="MessagePrimitive.Parts";const NO=()=>{const e=qn(),t=st(i=>i.thread.isRunning||!i.composer.isEditing||i.composer.isEmpty),n=P.useCallback(()=>{e.composer().send()},[e]);return t?null:n};wC("ComposerPrimitive.Send",NO);const jO=P.forwardRef(({onSubmit:e,...t},n)=>{const i=NO(),s=r=>{r.preventDefault(),i&&i()};return b.jsx(el.form,{...t,ref:n,onSubmit:Di(e,s)})});jO.displayName="ComposerPrimitive.Root";function E0(){return E0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},E0.apply(null,arguments)}function kY(e,t){if(e==null)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.indexOf(i)!==-1)continue;n[i]=e[i]}return n}var TY=P.useLayoutEffect,EY=function(t){var n=Un.useRef(t);return TY(function(){n.current=t}),n},yA=function(t,n){if(typeof t=="function"){t(n);return}t.current=n},RY=function(t,n){var i=Un.useRef();return Un.useCallback(function(s){t.current=s,i.current&&yA(i.current,null),i.current=n,n&&yA(n,s)},[n])},_A={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},AY=function(t){Object.keys(_A).forEach(function(n){t.style.setProperty(n,_A[n],"important")})},SA=AY,Qn=null,CA=function(t,n){var i=t.scrollHeight;return n.sizingStyle.boxSizing==="border-box"?i+n.borderSize:i-n.paddingSize};function MY(e,t,n,i){n===void 0&&(n=1),i===void 0&&(i=1/0),Qn||(Qn=document.createElement("textarea"),Qn.setAttribute("tabindex","-1"),Qn.setAttribute("aria-hidden","true"),SA(Qn)),Qn.parentNode===null&&document.body.appendChild(Qn);var s=e.paddingSize,r=e.borderSize,a=e.sizingStyle,o=a.boxSizing;Object.keys(a).forEach(function(m){var g=m;Qn.style[g]=a[g]}),SA(Qn),Qn.value=t;var l=CA(Qn,e);Qn.value=t,l=CA(Qn,e),Qn.value="x";var u=Qn.scrollHeight-s,h=u*n;o==="border-box"&&(h=h+s+r),l=Math.max(h,l);var f=u*i;return o==="border-box"&&(f=f+s+r),l=Math.min(f,l),[l,u]}var xA=function(){},LY=function(t,n){return t.reduce(function(i,s){return i[s]=n[s],i},{})},IY=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],PY=!!document.documentElement.currentStyle,DY=function(t){var n=window.getComputedStyle(t);if(n===null)return null;var i=LY(IY,n),s=i.boxSizing;if(s==="")return null;PY&&s==="border-box"&&(i.width=parseFloat(i.width)+parseFloat(i.borderRightWidth)+parseFloat(i.borderLeftWidth)+parseFloat(i.paddingRight)+parseFloat(i.paddingLeft)+"px");var r=parseFloat(i.paddingBottom)+parseFloat(i.paddingTop),a=parseFloat(i.borderBottomWidth)+parseFloat(i.borderTopWidth);return{sizingStyle:i,paddingSize:r,borderSize:a}},OY=DY;function kC(e,t,n){var i=EY(n);P.useLayoutEffect(function(){var s=function(a){return i.current(a)};if(e)return e.addEventListener(t,s),function(){return e.removeEventListener(t,s)}},[])}var NY=function(t,n){kC(document.body,"reset",function(i){t.current.form===i.target&&n(i)})},jY=function(t){kC(window,"resize",t)},BY=function(t){kC(document.fonts,"loadingdone",t)},FY=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],UY=function(t,n){var i=t.cacheMeasurements,s=t.maxRows,r=t.minRows,a=t.onChange,o=a===void 0?xA:a,l=t.onHeightChange,u=l===void 0?xA:l,h=kY(t,FY),f=h.value!==void 0,m=P.useRef(null),g=RY(m,n),C=P.useRef(0),S=P.useRef(),v=function(){var x=m.current,k=i&&S.current?S.current:OY(x);if(k){S.current=k;var A=MY(k,x.value||x.placeholder||"x",r,s),T=A[0],M=A[1];C.current!==T&&(C.current=T,x.style.setProperty("height",T+"px","important"),u(T,{rowHeight:M}))}},_=function(x){f||v(),o(x)};return P.useLayoutEffect(v),NY(m,function(){if(!f){var w=m.current.value;requestAnimationFrame(function(){var x=m.current;x&&w!==x.value&&v()})}}),jY(v),BY(v),P.createElement("textarea",E0({},h,{onChange:_,ref:g}))},zY=P.forwardRef(UY);const BO=e=>{const t=xs(e),n=ym(i=>i.onScrollToBottom);P.useEffect(()=>n(t),[n,t])},FO=P.forwardRef(({autoFocus:e=!1,asChild:t,disabled:n,onChange:i,onKeyDown:s,onPaste:r,submitOnEnter:a=!0,cancelOnEscape:o=!0,unstable_focusOnRunStart:l=!0,unstable_focusOnScrollToBottom:u=!0,unstable_focusOnThreadSwitched:h=!0,addAttachmentOnPaste:f=!0,...m},g)=>{const C=qn(),S=st(({composer:E})=>E.isEditing?E.text:""),v=t?lC:zY,_=st(({thread:E,composer:L})=>E.isDisabled||L.dictation?.inputDisabled)||n,w=P.useRef(null),x=Es(g,w);uD(E=>{if(!o||!w.current?.contains(E.target))return;const L=C.composer();L.getState().canCancel&&(L.cancel(),E.preventDefault())});const k=E=>{_||!a||E.nativeEvent.isComposing||E.key==="Enter"&&E.shiftKey===!1&&(C.thread().getState().isRunning||(E.preventDefault(),w.current?.closest("form")?.requestSubmit()))},A=async E=>{if(!f)return;const L=C.thread().getState().capabilities,D=Array.from(E.clipboardData?.files||[]);if(L.attachments&&D.length>0)try{E.preventDefault(),await Promise.all(D.map(O=>C.composer().addAttachment(O)))}catch(O){console.error("Error adding attachment:",O)}},T=e&&!_,M=P.useCallback(()=>{const E=w.current;!E||!T||(E.focus({preventScroll:!0}),E.setSelectionRange(E.value.length,E.value.length))},[T]);return P.useEffect(()=>M(),[M]),BO(()=>{C.composer().getState().type==="thread"&&u&&M()}),P.useEffect(()=>{if(!(C.composer().getState().type!=="thread"||!l))return C.on("thread.run-start",M)},[l,M,C]),P.useEffect(()=>{if(!(C.composer().getState().type!=="thread"||!h))return C.on("thread-list-item.switched-to",M)},[h,M,C]),b.jsx(v,{name:"input",value:S,...m,ref:x,disabled:_,onChange:Di(i,E=>{C.composer().getState().isEditing&&T0(()=>{C.composer().setText(E.target.value)})}),onKeyDown:Di(s,k),onPaste:Di(r,A)})});FO.displayName="ComposerPrimitive.Input";const HY=({multiple:e=!0}={})=>{const t=st(({composer:s})=>!s.isEditing),n=qn(),i=P.useCallback(()=>{const s=document.createElement("input");s.type="file",s.multiple=e,s.hidden=!0;const r=n.composer().getState().attachmentAccept;r!=="*"&&(s.accept=r),document.body.appendChild(s),s.onchange=a=>{const o=a.target.files;if(o){for(const l of o)n.composer().addAttachment(l);document.body.removeChild(s)}},s.oncancel=()=>{(!s.files||s.files.length===0)&&document.body.removeChild(s)},s.click()},[n,e]);return t?null:i},$Y=wC("ComposerPrimitive.AddAttachment",HY,["multiple"]),qY=(e,t)=>{const n=t.type;switch(n){case"image":return e?.Image??e?.Attachment;case"document":return e?.Document??e?.Attachment;case"file":return e?.File??e?.Attachment;default:const i=n;throw new Error(`Unknown attachment type: ${i}`)}},VY=({components:e})=>{const t=st(({attachment:i})=>i);if(!t)return null;const n=qY(e,t);return n?b.jsx(n,{}):null},UO=P.memo(({index:e,components:t})=>b.jsx(ZK,{index:e,children:b.jsx(VY,{components:t})}),(e,t)=>e.index===t.index&&e.components?.Image===t.components?.Image&&e.components?.Document===t.components?.Document&&e.components?.File===t.components?.File&&e.components?.Attachment===t.components?.Attachment);UO.displayName="ComposerPrimitive.AttachmentByIndex";const zO=({components:e})=>{const t=st(i=>i.composer.attachments.length);return P.useMemo(()=>Array.from({length:t},(i,s)=>b.jsx(UO,{index:s,components:e},s)),[t,e])};zO.displayName="ComposerPrimitive.Attachments";const HO=P.forwardRef((e,t)=>b.jsx(el.div,{...e,ref:t}));HO.displayName="ThreadPrimitive.Root";const WY=e=>{const t=xs(e),n=P.useCallback(i=>{const s=new ResizeObserver(()=>{t()}),r=new MutationObserver(a=>{a.some(l=>l.type!=="attributes"||l.attributeName!=="style")&&t()});return s.observe(i),r.observe(i,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),()=>{s.disconnect(),r.disconnect()}},[t]);return ah(n)},GY=({autoScroll:e,scrollToBottomOnRunStart:t=!0,scrollToBottomOnInitialize:n=!0,scrollToBottomOnThreadSwitch:i=!0})=>{const s=P.useRef(null),r=xC();e===void 0&&(e=r.getState().turnAnchor!=="top");const a=P.useRef(0),o=P.useRef(null),l=P.useCallback(g=>{const C=s.current;C&&(o.current=g,C.scrollTo({top:C.scrollHeight,behavior:g}))},[]),u=()=>{const g=s.current;if(!g)return;const C=r.getState().isAtBottom,S=Math.abs(g.scrollHeight-g.scrollTop-g.clientHeight)<1||g.scrollHeight<=g.clientHeight;!S&&a.current<g.scrollTop||(S&&(o.current=null),(S||o.current===null)&&S!==C&&qd(r).setState({isAtBottom:S})),a.current=g.scrollTop},h=WY(()=>{const g=o.current;g?l(g):e&&r.getState().isAtBottom&&l("instant"),u()}),f=ah(g=>(g.addEventListener("scroll",u),()=>{g.removeEventListener("scroll",u)}));return BO(({behavior:g})=>{l(g)}),qy("thread.run-start",()=>{t&&(o.current="auto",requestAnimationFrame(()=>{l("auto")}))}),qy("thread.initialize",()=>{n&&(o.current="instant",requestAnimationFrame(()=>{l("instant")}))}),qy("thread-list-item.switched-to",()=>{i&&(o.current="instant",requestAnimationFrame(()=>{l("instant")}))}),Es(h,f,s)},KY=()=>{const e=ym(n=>n.registerViewport),t=P.useCallback(n=>n.clientHeight,[]);return AO(e,t)},$O=P.forwardRef(({autoScroll:e,scrollToBottomOnRunStart:t,scrollToBottomOnInitialize:n,scrollToBottomOnThreadSwitch:i,children:s,...r},a)=>{const o=GY({autoScroll:e,scrollToBottomOnRunStart:t,scrollToBottomOnInitialize:n,scrollToBottomOnThreadSwitch:i}),l=KY(),u=Es(a,o,l);return b.jsx(el.div,{...r,ref:u,children:s})});$O.displayName="ThreadPrimitive.ViewportScrollable";const qO=P.forwardRef(({turnAnchor:e,...t},n)=>b.jsx(CO,{options:{turnAnchor:e},children:b.jsx($O,{...t,ref:n})}));qO.displayName="ThreadPrimitive.Viewport";const VO=(e,t)=>e.Message===t.Message&&e.EditComposer===t.EditComposer&&e.UserEditComposer===t.UserEditComposer&&e.AssistantEditComposer===t.AssistantEditComposer&&e.SystemEditComposer===t.SystemEditComposer&&e.UserMessage===t.UserMessage&&e.AssistantMessage===t.AssistantMessage&&e.SystemMessage===t.SystemMessage,YY=()=>null,QY=(e,t,n)=>{switch(t){case"user":return n?e.UserEditComposer??e.EditComposer??e.UserMessage??e.Message:e.UserMessage??e.Message;case"assistant":return n?e.AssistantEditComposer??e.EditComposer??e.AssistantMessage??e.Message:e.AssistantMessage??e.Message;case"system":return n?e.SystemEditComposer??e.EditComposer??e.SystemMessage??e.Message:e.SystemMessage??YY;default:const i=t;throw new Error(`Unknown message role: ${i}`)}},JY=({components:e})=>{const t=st(({message:s})=>s.role),n=st(({message:s})=>s.composer.isEditing),i=QY(e,t,n);return b.jsx(i,{})},WO=P.memo(({index:e,components:t})=>b.jsx(JK,{index:e,children:b.jsx(JY,{components:t})}),(e,t)=>e.index===t.index&&VO(e.components,t.components));WO.displayName="ThreadPrimitive.MessageByIndex";const GO=({components:e})=>{const t=st(({thread:i})=>i.messages.length);return P.useMemo(()=>t===0?null:Array.from({length:t},(i,s)=>b.jsx(WO,{index:s,components:e},s)),[t,e])};GO.displayName="ThreadPrimitive.Messages";const XY=P.memo(GO,(e,t)=>VO(e.components,t.components));function KO(e){if(e.role==="agent"&&e.content.length>0){const t=e.content[0];return typeof t.uuid=="string"?t.uuid:null}return null}function ZY(e){if(e.role==="agent"&&e.content.length>0){const t=e.content[0];return typeof t.parentUUID=="string"?t.parentUUID:null}return null}function R0(e,t,n){const i=[],s=e.orphanMessages.get(t);if(!s)return i;e.orphanMessages.delete(t);for(const r of s){const a=KO(r);a&&e.uuidToSidechainId.set(a,n),i.push({...r,sidechainId:n}),a&&i.push(...R0(e,a,n))}return i}function eQ(e){const t={promptToTaskId:new Map,uuidToSidechainId:new Map,orphanMessages:new Map},n=[];for(const i of e)if(i.role==="agent")for(const s of i.content){if(s.type!=="tool-call"||s.name!=="Task")continue;const r=s.input;!Se(r)||typeof r.prompt!="string"||t.promptToTaskId.set(r.prompt,i.id)}for(const i of e){if(!i.isSidechain){n.push({...i});continue}const s=KO(i),r=ZY(i);let a;if(i.role==="agent")for(const o of i.content){if(o.type!=="sidechain")continue;const l=t.promptToTaskId.get(o.prompt);if(l){a=l;break}}if(a&&s){t.uuidToSidechainId.set(s,a),n.push({...i,sidechainId:a}),n.push(...R0(t,s,a));continue}if(r){const o=t.uuidToSidechainId.get(r);if(o)s&&t.uuidToSidechainId.set(s,o),n.push({...i,sidechainId:o}),s&&n.push(...R0(t,s,o));else{const l=t.orphanMessages.get(r)??[];l.push(i),t.orphanMessages.set(r,l)}continue}n.push({...i})}return n}function tQ(e){const t=e.match(/^Claude AI usage limit reached\|(\d+)$/);if(!t)return null;const n=Number.parseInt(t[1],10);return Number.isFinite(n)?n:null}function nQ(e){if(e.isSidechain||e.role!=="agent")return null;for(const t of e.content)if(t.type==="text"){const n=tQ(t.text);if(n!==null)return{type:"limit-reached",endsAt:n}}return null}function iQ(e){const t=[];let n=null,i=null;for(const s of e){if(s.kind!=="agent-event"){t.push(s),n=null,i=null;continue}const r=s.event;if(r.type==="title-changed"&&typeof r.title=="string"){const o=r.title.trim(),l=`title-changed:${o}`;if(l===n)continue;t.push(s),n=l,i=o;continue}if(r.type==="message"&&typeof r.message=="string"){const o=r.message.trim(),l=`message:${o}`;if(l===n||i&&o===i)continue;t.push(s),n=l,i=null;continue}let a;try{a=`event:${JSON.stringify(r)}`}catch{a=`event:${String(r.type)}`}a!==n&&(t.push(s),n=a,i=null)}return t}function sQ(e){const t=[];for(const n of e){if(n.kind!=="agent-event"){t.push(n);continue}if(n.event.type!=="api-error"){t.push(n);continue}const s=t[t.length-1];s?.kind==="agent-event"&&s.event.type==="api-error"?t[t.length-1]=n:t.push(n)}return t}function rQ(e){const t=new Map,n=e?.completedRequests??null;if(n)for(const[s,r]of Object.entries(n))t.set(s,{toolName:r.tool,input:r.arguments,permission:{id:s,status:r.status,reason:r.reason??void 0,mode:r.mode??void 0,decision:r.decision??void 0,allowedTools:r.allowTools,answers:r.answers,createdAt:r.createdAt??null,completedAt:r.completedAt??null}});const i=e?.requests??null;if(i)for(const[s,r]of Object.entries(i))t.has(s)||t.set(s,{toolName:r.tool,input:r.arguments,permission:{id:s,status:"pending",createdAt:r.createdAt??null}});return t}function A0(e,t,n,i){const s=t.get(n);if(s){const l=u=>{const h=u.trim().toLowerCase();return h===""||h==="tool"||h==="unknown"};return i.createdAt<s.createdAt&&(s.createdAt=i.createdAt,s.tool.createdAt=i.createdAt),i.permission&&(s.tool.permission={...s.tool.permission,...i.permission},s.tool.state==="running"&&i.permission.status==="pending"&&(s.tool.state="pending")),i.name&&(!l(i.name)||l(s.tool.name))&&(s.tool.name=i.name),i.input!==null&&i.input!==void 0&&(s.tool.input=i.input),i.description!==null&&(s.tool.description=i.description),s}const r=i.permission?.status==="pending"?"pending":i.permission?.status==="denied"||i.permission?.status==="canceled"?"error":"running",a={id:n,name:i.name,state:r,input:i.input,createdAt:i.createdAt,startedAt:r==="running"?i.createdAt:null,completedAt:null,description:i.description,permission:i.permission},o={kind:"tool-call",id:n,localId:i.localId,createdAt:i.createdAt,tool:a,children:[],meta:i.meta};return t.set(n,o),e.push(o),o}function oQ(e){const t=new Set;for(const n of e)if(n.role==="agent")for(const i of n.content)i.type==="tool-call"?t.add(i.id):i.type==="tool-result"&&t.add(i.tool_use_id);return t}function YO(e){return e==="change_title"?!0:e.endsWith("__change_title")||e.endsWith("_change_title")}function QO(e){if(!e||typeof e!="object")return null;const t=e.title;return typeof t=="string"&&t.trim().length>0?t.trim():null}function aQ(e){const t=new Map;for(const n of e)if(n.role==="agent")for(const i of n.content){if(i.type!=="tool-call"||!YO(i.name))continue;const s=QO(i.input);s&&t.set(i.id,s)}return t}const lQ=/<(?:local-command-[a-z-]+|command-(?:name|message|args))>/i,cQ=/<command-name>/i,uQ=/<local-command-stdout>/i;function dQ(e){if(!e||typeof e!="object")return null;const t=e.sentFrom;return typeof t=="string"?t:null}function hQ(e){return lQ.test(e)}function fQ(e){return cQ.test(e)}function wA(e){return uQ.test(e)}function kA(e,t){return dQ(t)==="cli"&&hQ(e)}function TA(e){return{kind:"cli-output",id:e.id,localId:e.localId,createdAt:e.createdAt,text:e.text,source:e.source,meta:e.meta}}function pQ(e){const t=[];for(const n of e){if(n.kind!=="cli-output"){t.push(n);continue}const i=t[t.length-1];if(i&&i.kind==="cli-output"&&i.source===n.source&&fQ(i.text)&&!wA(i.text)&&wA(n.text)){const s=i.text.endsWith(`
`)||n.text.startsWith(`
`)?"":`
`;t[t.length-1]={...i,text:`${i.text}${s}${n.text}`};continue}t.push(n)}return t}function JO(e,t){const n=[],i=new Map;let s=!1;for(const r of e){if(r.role==="event"){if(r.content.type==="ready"){s=!0;continue}n.push({kind:"agent-event",id:r.id,createdAt:r.createdAt,event:r.content,meta:r.meta});continue}const a=nQ(r);if(a){n.push({kind:"agent-event",id:r.id,createdAt:r.createdAt,event:a,meta:r.meta});continue}if(r.role==="user"){if(kA(r.content.text,r.meta)){n.push(TA({id:r.id,localId:r.localId,createdAt:r.createdAt,text:r.content.text,source:"user",meta:r.meta}));continue}n.push({kind:"user-text",id:r.id,localId:r.localId,createdAt:r.createdAt,text:r.content.text,attachments:r.content.attachments,status:r.status,originalText:r.originalText,meta:r.meta});continue}if(r.role==="agent")for(let o=0;o<r.content.length;o+=1){const l=r.content[o];if(l.type==="text"){if(kA(l.text,r.meta)){n.push(TA({id:`${r.id}:${o}`,localId:r.localId,createdAt:r.createdAt,text:l.text,source:"assistant",meta:r.meta}));continue}n.push({kind:"agent-text",id:`${r.id}:${o}`,localId:r.localId,createdAt:r.createdAt,text:l.text,meta:r.meta});continue}if(l.type==="reasoning"){n.push({kind:"agent-reasoning",id:`${r.id}:${o}`,localId:r.localId,createdAt:r.createdAt,text:l.text,meta:r.meta});continue}if(l.type==="summary"){n.push({kind:"agent-event",id:`${r.id}:${o}`,createdAt:r.createdAt,event:{type:"message",message:l.summary},meta:r.meta});continue}if(l.type==="tool-call"){if(YO(l.name)){const f=t.titleChangesByToolUseId.get(l.id)??QO(l.input);f&&!t.emittedTitleChangeToolUseIds.has(l.id)&&(t.emittedTitleChangeToolUseIds.add(l.id),n.push({kind:"agent-event",id:`${r.id}:${o}`,createdAt:r.createdAt,event:{type:"title-changed",title:f},meta:r.meta}));continue}const u=t.permissionsById.get(l.id)?.permission,h=A0(n,i,l.id,{createdAt:r.createdAt,localId:r.localId,meta:r.meta,name:l.name,input:l.input,description:l.description,permission:u});if(h.tool.state==="pending"&&(h.tool.state="running",h.tool.startedAt=r.createdAt),l.name==="Task"&&!t.consumedGroupIds.has(r.id)){const f=t.groups.get(r.id)??null;if(f&&f.length>0){t.consumedGroupIds.add(r.id);const m=JO(f,t);s=s||m.hasReadyEvent,h.children=m.blocks}}continue}if(l.type==="tool-result"){const u=t.titleChangesByToolUseId.get(l.tool_use_id)??null;if(u){t.emittedTitleChangeToolUseIds.has(l.tool_use_id)||(t.emittedTitleChangeToolUseIds.add(l.tool_use_id),n.push({kind:"agent-event",id:`${r.id}:${o}`,createdAt:r.createdAt,event:{type:"title-changed",title:u},meta:r.meta}));continue}const h=t.permissionsById.get(l.tool_use_id),f=l.permissions?{id:l.tool_use_id,status:l.permissions.result==="approved"?"approved":"denied",date:l.permissions.date,mode:l.permissions.mode,allowedTools:l.permissions.allowedTools,decision:l.permissions.decision}:void 0,m=f&&h?.permission?{...h.permission,...f,allowedTools:f.allowedTools??h.permission.allowedTools,decision:f.decision??h.permission.decision}:f??h?.permission,g=A0(n,i,l.tool_use_id,{createdAt:r.createdAt,localId:r.localId,meta:r.meta,name:h?.toolName??"Tool",input:h?.input??null,description:null,permission:m});g.tool.result=l.content,g.tool.completedAt=r.createdAt,g.tool.state=l.is_error?"error":"completed";continue}l.type==="sidechain"&&n.push({kind:"user-text",id:`${r.id}:${o}`,localId:null,createdAt:r.createdAt,text:l.prompt})}}return{blocks:pQ(n),toolBlocksById:i,hasReadyEvent:s}}function mQ(e){return(e.cache_creation_input_tokens||0)+(e.cache_read_input_tokens||0)+e.input_tokens}function gQ(e,t){const n=rQ(t),i=oQ(e),s=aQ(e),r=eQ(e),a=new Map,o=[];for(const S of r)if(S.sidechainId){const v=a.get(S.sidechainId)??[];v.push(S),a.set(S.sidechainId,v)}else o.push(S);const f=JO(o,{permissionsById:n,groups:a,consumedGroupIds:new Set,titleChangesByToolUseId:s,emittedTitleChangeToolUseIds:new Set});let m=f.hasReadyEvent;const g=e.length>0?Math.min(...e.map(S=>S.createdAt)):null;for(const[S,v]of n){if(i.has(S)||f.toolBlocksById.has(S))continue;const _=v.permission.createdAt??Date.now();if(g!==null&&_<g)continue;const w=A0(f.blocks,f.toolBlocksById,S,{createdAt:_,localId:null,name:v.toolName,input:v.input,description:null,permission:v.permission});v.permission.status==="approved"?(w.tool.state="completed",w.tool.completedAt=v.permission.completedAt??_,w.tool.result===void 0&&(w.tool.result="Approved")):(v.permission.status==="denied"||v.permission.status==="canceled")&&(w.tool.state="error",w.tool.completedAt=v.permission.completedAt??_,w.tool.result===void 0&&v.permission.reason&&(w.tool.result={error:v.permission.reason}))}let C=null;for(let S=e.length-1;S>=0;S--){const v=e[S];if(v.usage){C={inputTokens:v.usage.input_tokens,outputTokens:v.usage.output_tokens,cacheCreation:v.usage.cache_creation_input_tokens??0,cacheRead:v.usage.cache_read_input_tokens??0,contextSize:mQ(v.usage),timestamp:v.createdAt};break}}return{blocks:iQ(sQ(f.blocks)),hasReadyEvent:m,latestUsage:C}}function XO(e,t){for(const n of e)t.set(n.id,n),n.kind==="tool-call"&&XO(n.children,t)}function ZO(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0}function EA(e){return Array.isArray(e)?e:e.answers??[]}function vQ(e,t){if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;n.sort(),i.sort();for(let s=0;s<n.length;s+=1){const r=n[s];if(r!==i[s])return!1;const a=e[r],o=t[r];if(!ZO(EA(a),EA(o)))return!1}return!0}function bQ(e,t){return e===t?!0:!e||!t?!1:e.id===t.id&&e.status===t.status&&e.reason===t.reason&&e.mode===t.mode&&e.decision===t.decision&&e.date===t.date&&e.createdAt===t.createdAt&&e.completedAt===t.completedAt&&ZO(e.allowedTools,t.allowedTools)&&vQ(e.answers,t.answers)}function RA(e){switch(e.type){case"switch":return`switch:${e.mode}`;case"message":return`message:${e.message}`;case"title-changed":return`title:${e.title}`;case"limit-reached":return`limit:${e.endsAt}`;case"ready":return"ready";default:try{return JSON.stringify(e)}catch{return e.type}}}function yQ(e,t){return e===t?!0:RA(e)===RA(t)}function _Q(e,t){return e.text===t.text&&e.status===t.status&&e.originalText===t.originalText&&e.localId===t.localId&&e.createdAt===t.createdAt&&e.meta===t.meta}function SQ(e,t){return e.text===t.text&&e.localId===t.localId&&e.createdAt===t.createdAt&&e.meta===t.meta}function CQ(e,t){return e.text===t.text&&e.localId===t.localId&&e.createdAt===t.createdAt&&e.meta===t.meta}function xQ(e,t){return e.text===t.text&&e.localId===t.localId&&e.createdAt===t.createdAt&&e.source===t.source&&e.meta===t.meta}function wQ(e,t){return e.createdAt===t.createdAt&&e.meta===t.meta&&yQ(e.event,t.event)}function kQ(e,t,n){return n?e.localId===t.localId&&e.createdAt===t.createdAt&&e.meta===t.meta&&e.tool.id===t.tool.id&&e.tool.name===t.tool.name&&e.tool.state===t.tool.state&&e.tool.input===t.tool.input&&e.tool.result===t.tool.result&&e.tool.description===t.tool.description&&e.tool.createdAt===t.tool.createdAt&&e.tool.startedAt===t.tool.startedAt&&e.tool.completedAt===t.tool.completedAt&&bQ(e.tool.permission,t.tool.permission):!1}function eN(e,t){let n=!1;const i=e.map(s=>{const r=TQ(s,t);return r!==s&&(n=!0),r});return n?i:e}function TQ(e,t){const n=t.get(e.id);if(e.kind==="tool-call"){const s=eN(e.children,t),r=s===e.children?e:{...e,children:s};if(n&&n.kind==="tool-call"){const a=n.children.length===s.length&&n.children.every((o,l)=>o===s[l]);if(kQ(n,r,a))return n}return r}if(!n||n.kind!==e.kind)return e;if(e.kind==="user-text"){const s=n;return _Q(s,e)?s:e}if(e.kind==="agent-text"){const s=n;return SQ(s,e)?s:e}if(e.kind==="cli-output"){const s=n;return xQ(s,e)?s:e}if(e.kind==="agent-reasoning"){const s=n;return CQ(s,e)?s:e}const i=n;return wQ(i,e)?i:e}function EQ(e,t){const n=eN(e,t),i=new Map;return XO(n,i),{blocks:n,byId:i}}const tN=[`
`,",","(",")","[","]","{","}","<",">",";","!","?","."];function RQ(e,t,n){let i=t.start-1,s=-1,r=!1,a=-1;for(;i>=0;){const o=e.charAt(i);if(o===" "){if(r)return a;if(s>=0)return s+1;s=i,i--}else{if(n.includes(o)&&(i===0||e.charAt(i-1)===" "||e.charAt(i-1)===`
`))return o==="@"&&(r=!0,a=i),i;if(tN.includes(o))return r?a:i+1;i--}}return r?a:(s>=0?s:i)+1}function AQ(e,t,n){let i=t,s=!1;for(n!==void 0&&n>=0&&n<e.length&&(s=e.charAt(n)==="@");i<e.length;){const r=e.charAt(i);if(s&&(r==="/"||r===".")){i++;continue}if(r===" "||tN.includes(r))break;i++}return i}function nN(e,t,n=["@","/"]){if(t.start!==t.end||t.start===0)return;const i=RQ(e,t,n),s=e.substring(i,t.end);if(!s.endsWith(" ")&&s.length>0){const r=s.charAt(0);if(n.includes(r)){const a=AQ(e,t.end,i),o=e.substring(i,a);return s.length===1&&o.length===1?{word:o,activeWord:s,offset:i,length:o.length,activeLength:s.length,endOffset:a}:{word:o,activeWord:s,offset:i,length:o.length,activeLength:s.length,endOffset:a}}}}function MQ(e,t,n=["@","/"]){return P.useMemo(()=>{const i=nN(e,t,n);return i?i.activeWord:null},[e,t.start,t.end,n])}class LQ{constructor(t){this.hasValue=!1,this.processing=!1,this.stopped=!1,this.command=t}setValue(t){this.stopped&&(this.stopped=!1),this.latestValue=t,this.hasValue=!0,this.processing||(this.processing=!0,this.doSync())}stop(){this.stopped=!0}async doSync(){for(;this.hasValue&&!this.stopped;){const t=this.latestValue;this.hasValue=!1;try{await this.command(t)}catch(n){console.error("ValueSync error:",n)}}this.processing=!1}}function iN(e,t,n={}){const{clampSelection:i=!0,autoSelectFirst:s=!0,wrapAround:r=!0,allowEmptyQuery:a=!1}=n,[o,l]=P.useState({suggestions:[],selected:-1}),u=P.useCallback(()=>{l(C=>C.suggestions.length===0?C:C.selected<=0?r?{...C,selected:C.suggestions.length-1}:{...C,selected:0}:{...C,selected:C.selected-1})},[r]),h=P.useCallback(()=>{l(C=>C.suggestions.length===0?C:C.selected>=C.suggestions.length-1?r?{...C,selected:0}:{...C,selected:C.suggestions.length-1}:C.selected<0?{...C,selected:0}:{...C,selected:C.selected+1})},[r]),f=P.useCallback(()=>{l({suggestions:[],selected:-1})},[]),m=P.useRef(t);m.current=t;const g=P.useRef(null);return P.useEffect(()=>{const C=new LQ(async S=>{if(S===null||!a&&S==="")return;const v=await m.current(S);l(_=>{if(i){let w=_.selected;return v.length===0?w=-1:s&&_.suggestions.length===0?w=0:_.selected>=v.length?w=v.length-1:_.selected<0&&v.length>0&&s&&(w=0),{suggestions:v,selected:w}}else{if(_.selected>=0&&_.selected<_.suggestions.length){const x=_.suggestions[_.selected].key,k=v.findIndex(A=>A.key===x);if(k!==-1)return{suggestions:v,selected:k}}const w=Math.min(_.selected,v.length-1);return{suggestions:v,selected:w<0&&v.length>0&&s?0:w}}})});return g.current=C,()=>{C.stop(),g.current===C&&(g.current=null)}},[i,s,a]),P.useEffect(()=>{g.current?.setValue(e)},[e,t,i,s,a]),e===null||!a&&e===""?[[],-1,u,h,f]:[o.suggestions,o.selected,u,h,f]}function IQ(e,t,n,i=["@","/"],s=!0){const r=nN(e,t,i);if(!r){const f=e.substring(0,t.start),m=e.substring(t.end),g=s?n+" ":n;return{text:f+g+m,cursorPosition:t.start+g.length}}const a=e.substring(0,r.offset),o=e.substring(r.endOffset);let l=n;s&&(o.length===0||o[0]!==" ")&&(l+=" ");const u=a+l+o,h=r.offset+l.length;return{text:u,cursorPosition:h}}function _m(e){return e==="codex"||e==="gemini"||e==="opencode"}function PQ(e){return e==="claude"}function DQ(e){return PQ(e)||_m(e)}const sN="codex-recent-skills",OQ=200;function NQ(e){try{return JSON.parse(e)}catch{return null}}function rN(){if(typeof window>"u")return{};try{const e=localStorage.getItem(sN);if(!e)return{};const t=NQ(e);if(!t||typeof t!="object")return{};const n=t,i={};for(const[s,r]of Object.entries(n))typeof s!="string"||s.trim().length===0||typeof r!="number"||!Number.isFinite(r)||(i[s]=r);return i}catch{return{}}}function jQ(e){const t=e.trim();if(t&&!(typeof window>"u"))try{const n=rN();n[t]=Date.now();const i=Object.entries(n).sort((r,a)=>a[1]-r[1]).slice(0,OQ),s=Object.fromEntries(i);localStorage.setItem(sN,JSON.stringify(s))}catch{}}const M0=P.memo(function(t){const{children:n,maxHeight:i=240}=t;return b.jsx("div",{className:"overflow-hidden rounded-xl border border-[var(--app-divider)] bg-[var(--app-bg)] shadow-lg",style:{maxHeight:i},children:b.jsx("div",{className:"overflow-y-auto",style:{maxHeight:i},children:n})})}),oN=P.memo(function(t){const{suggestions:n,selectedIndex:i,onSelect:s}=t,r=P.useRef(null);return P.useEffect(()=>{if(i<0||i>=n.length)return;const a=r.current;if(!a)return;a.querySelector(`[data-suggestion-index="${i}"]`)?.scrollIntoView({block:"nearest"})},[i,n]),n.length===0?null:b.jsx("div",{className:"py-1",ref:r,children:n.map((a,o)=>b.jsxs("button",{type:"button","data-suggestion-index":o,className:`flex w-full cursor-pointer flex-col items-start gap-0.5 px-3 py-2 text-left text-sm transition-colors ${o===i?"bg-[var(--app-button)] text-[var(--app-button-text)]":"text-[var(--app-fg)] hover:bg-[var(--app-secondary-bg)]"}`,onClick:()=>s(o),onMouseDown:l=>l.preventDefault(),children:[b.jsx("span",{className:"w-full font-medium",children:a.label}),a.description&&b.jsx("span",{className:`w-full min-h-[2.25rem] text-xs leading-snug line-clamp-2 ${o===i?"opacity-80":"text-[var(--app-hint)]"}`,children:a.description})]},a.key))})}),BQ=1e4,FQ={default:2e5,sonnet:2e5,opus:2e5};function UQ(e){const n=FQ[e??"default"];return n?Math.max(1,n-BQ):null}const AA=["Accomplishing","Actioning","Actualizing","Baking","Booping","Brewing","Calculating","Cerebrating","Channelling","Churning","Clauding","Coalescing","Cogitating","Computing","Combobulating","Concocting","Conjuring","Considering","Contemplating","Cooking","Crafting","Creating","Crunching","Deciphering","Deliberating","Determining","Discombobulating","Divining","Doing","Effecting","Elucidating","Enchanting","Envisioning","Finagling","Flibbertigibbeting","Forging","Forming","Frolicking","Generating","Germinating","Hatching","Herding","Honking","Ideating","Imagining","Incubating","Inferring","Manifesting","Marinating","Meandering","Moseying","Mulling","Mustering","Musing","Noodling","Percolating","Perusing","Philosophising","Pontificating","Pondering","Processing","Puttering","Puzzling","Reticulating","Ruminating","Scheming","Schlepping","Shimmying","Simmering","Smooshing","Spelunking","Spinning","Stewing","Sussing","Synthesizing","Thinking","Tinkering","Transmuting","Unfurling","Unravelling","Vibing","Wandering","Whirring","Wibbling","Wizarding","Working","Wrangling"],zQ={neutral:"text-[var(--app-hint)]",info:"text-blue-500",warning:"text-amber-500",danger:"text-red-500"};function HQ(e,t,n,i,s){const r=n?.requests&&Object.keys(n.requests).length>0;return i==="connecting"?{text:s("voice.connecting"),color:"text-[#007AFF]",dotColor:"bg-[#007AFF]",isPulsing:!0}:e?r?{text:s("misc.permissionRequired"),color:"text-[#FF9500]",dotColor:"bg-[#FF9500]",isPulsing:!0}:t?{text:AA[Math.floor(Math.random()*AA.length)].toLowerCase()+"",color:"text-[#007AFF]",dotColor:"bg-[#007AFF]",isPulsing:!0}:{text:s("misc.online"),color:"text-[#34C759]",dotColor:"bg-[#34C759]",isPulsing:!1}:{text:s("misc.offline"),color:"text-[#999]",dotColor:"bg-[#999]",isPulsing:!1}}function $Q(e,t,n){const i=e/t*100,s=Math.max(0,100-i),r=Math.round(s);return s<=5?{text:n("misc.percentLeft",{percent:r}),color:"text-red-500"}:s<=10?{text:n("misc.percentLeft",{percent:r}),color:"text-amber-500"}:{text:n("misc.percentLeft",{percent:r}),color:"text-[var(--app-hint)]"}}function qQ(e){const{t}=ot(),n=P.useMemo(()=>HQ(e.active,e.thinking,e.agentState,e.voiceStatus,t),[e.active,e.thinking,e.agentState,e.voiceStatus,t]),i=P.useMemo(()=>{if(e.contextSize===void 0)return null;const u=UQ(e.modelMode);return u?$Q(e.contextSize,u,t):null},[e.contextSize,e.modelMode,t]),s=e.permissionMode,r=s&&s!=="default"&&S2(s,e.agentFlavor)?s:null,a=r?b2(r):null,o=r?y2(r):null,l=o?zQ[o]:"text-[var(--app-hint)]";return b.jsxs("div",{className:"flex items-center justify-between px-2 pb-1",children:[b.jsxs("div",{className:"flex items-baseline gap-3",children:[b.jsxs("div",{className:"flex items-center gap-1.5",children:[b.jsx("span",{className:`h-2 w-2 rounded-full ${n.dotColor} ${n.isPulsing?"animate-pulse":""}`}),b.jsx("span",{className:`text-xs ${n.color}`,children:n.text})]}),i?b.jsx("span",{className:`text-[10px] ${i.color}`,children:i.text}):null]}),r?b.jsx("span",{className:`text-xs ${l}`,children:a}):null]})}function VQ(){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("path",{d:"M12 6v12"}),b.jsx("path",{d:"M8 9v6"}),b.jsx("path",{d:"M16 9v6"}),b.jsx("path",{d:"M4 11v2"}),b.jsx("path",{d:"M20 11v2"})]})}function WQ(e){return e.muted?b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),b.jsx("line",{x1:"22",y1:"9",x2:"16",y2:"15"}),b.jsx("line",{x1:"16",y1:"9",x2:"22",y2:"15"})]}):b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),b.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),b.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]})}function GQ(){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("circle",{cx:"12",cy:"12",r:"3"}),b.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}function KQ(){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),b.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})}function YQ(){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),b.jsx("polyline",{points:"7 9 10 12 7 15"}),b.jsx("line",{x1:"12",y1:"15",x2:"17",y2:"15"})]})}function QQ(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:b.jsx("path",{d:"M21.44 11.05l-8.49 8.49a5.5 5.5 0 0 1-7.78-7.78l8.49-8.49a3.5 3.5 0 0 1 4.95 4.95l-8.49 8.49a1.5 1.5 0 0 1-2.12-2.12l7.78-7.78"})})}function JQ(e){return e.spinning?b.jsxs("svg",{className:"animate-spin",xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[b.jsx("circle",{cx:"12",cy:"12",r:"10",strokeOpacity:"0.25"}),b.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeOpacity:"0.75"})]}):b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 16 16",fill:"currentColor",children:b.jsx("path",{d:"M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4-2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-4Z"})})}function MA(){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),b.jsx("polyline",{points:"5 12 12 5 19 12"})]})}function XQ(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:b.jsx("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2"})})}function ZQ(){return b.jsxs("svg",{className:"animate-spin",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[b.jsx("circle",{cx:"12",cy:"12",r:"10",strokeOpacity:"0.25"}),b.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeOpacity:"0.75"})]})}function eJ(e){const{t}=ot(),n=e.voiceStatus==="connecting",i=e.voiceStatus==="connected",s=n||i,r=e.canSend,a=()=>{s?e.onVoiceToggle():r?e.onSend():e.voiceEnabled&&e.onVoiceToggle()};let o,l,u;n?(o=b.jsx(ZQ,{}),l="bg-black text-white",u=t("voice.connecting")):i?(o=b.jsx(XQ,{}),l="bg-black text-white",u=t("composer.stop")):r?(o=b.jsx(MA,{}),l="bg-black text-white",u=t("composer.send")):e.voiceEnabled?(o=b.jsx(VQ,{}),l="bg-black text-white",u=t("composer.voice")):(o=b.jsx(MA,{}),l="bg-[#C0C0C0] text-white",u=t("composer.send"));const h=e.controlsDisabled||!r&&!e.voiceEnabled&&!s;return b.jsx("button",{type:"button",onClick:a,disabled:h,"aria-label":u,title:u,className:`flex h-8 w-8 items-center justify-center rounded-full transition-colors disabled:cursor-not-allowed disabled:opacity-50 ${l}`,children:o})}function tJ(e){const{t}=ot(),n=e.voiceStatus==="connected";return b.jsxs("div",{className:"flex items-center justify-between px-2 pb-2",children:[b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx($Y,{"aria-label":t("composer.attach"),title:t("composer.attach"),disabled:e.controlsDisabled,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-[var(--app-fg)] disabled:cursor-not-allowed disabled:opacity-50",children:b.jsx(QQ,{})}),e.showSettingsButton?b.jsx("button",{type:"button","aria-label":t("composer.settings"),title:t("composer.settings"),className:"settings-button flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-[var(--app-fg)]",onClick:e.onSettingsToggle,disabled:e.controlsDisabled,children:b.jsx(GQ,{})}):null,e.showTerminalButton?b.jsx("button",{type:"button","aria-label":t("composer.terminal"),title:t("composer.terminal"),className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-emerald-500 disabled:cursor-not-allowed disabled:opacity-50",onClick:e.onTerminal,disabled:e.terminalDisabled,children:b.jsx(YQ,{})}):null,e.showAbortButton?b.jsx("button",{type:"button","aria-label":t("composer.abort"),title:t("composer.abort"),disabled:e.abortDisabled,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-red-500 disabled:cursor-not-allowed disabled:opacity-50",onClick:e.onAbort,children:b.jsx(JQ,{spinning:e.isAborting})}):null,e.showSwitchButton?b.jsx("button",{type:"button","aria-label":t("composer.switchRemote"),title:t("composer.switchRemote"),disabled:e.switchDisabled,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-blue-500 disabled:cursor-not-allowed disabled:opacity-50",onClick:e.onSwitch,children:b.jsx(KQ,{})}):null,n&&e.onVoiceMicToggle?b.jsx("button",{type:"button","aria-label":e.voiceMicMuted?t("voice.unmute"):t("voice.mute"),title:e.voiceMicMuted?t("voice.unmute"):t("voice.mute"),className:`flex h-8 w-8 items-center justify-center rounded-full transition-colors ${e.voiceMicMuted?"bg-gray-200 text-gray-600 hover:bg-gray-300":"text-[var(--app-fg)]/60 hover:bg-[var(--app-bg)] hover:text-[var(--app-fg)]"}`,onClick:e.onVoiceMicToggle,children:b.jsx(WQ,{muted:e.voiceMicMuted})}):null]}),b.jsx(eJ,{canSend:e.canSend,voiceStatus:e.voiceStatus,voiceEnabled:e.voiceEnabled,controlsDisabled:e.controlsDisabled,onSend:e.onSend,onVoiceToggle:e.onVoiceToggle})]})}function nJ(){return b.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 16 16",fill:"none",children:[b.jsx("circle",{cx:"8",cy:"8",r:"6",stroke:"currentColor",strokeWidth:"1.5"}),b.jsx("path",{d:"M8 5v4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),b.jsx("circle",{cx:"8",cy:"11",r:"0.75",fill:"currentColor"})]})}function iJ(){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[b.jsx("line",{x1:"3",y1:"3",x2:"9",y2:"9"}),b.jsx("line",{x1:"9",y1:"3",x2:"3",y2:"9"})]})}function sJ(){const{name:e,status:t}=AK(),n=t.type==="running",i=t.type==="incomplete";return b.jsxs(RO,{className:"flex items-center gap-2 rounded-lg bg-[var(--app-subtle-bg)] px-3 py-2 text-base text-[var(--app-fg)]",children:[n?b.jsx(Ur,{size:"sm",label:null,className:"text-[var(--app-hint)]"}):null,i?b.jsx("span",{className:"text-red-500",children:b.jsx(nJ,{})}):null,b.jsx("span",{className:"max-w-[150px] truncate",children:e}),b.jsx(uY,{className:"ml-auto flex h-5 w-5 items-center justify-center rounded text-[var(--app-hint)] transition-colors hover:text-[var(--app-fg)]","aria-label":"Remove attachment",title:"Remove attachment",children:b.jsx(iJ,{})})]})}const rJ=async()=>[];function oJ(e){const{t}=ot(),{disabled:n=!1,permissionMode:i,modelMode:s,active:r=!0,allowSendWhenInactive:a=!1,thinking:o=!1,agentState:l,contextSize:u,controlledByUser:h=!1,agentFlavor:f,onPermissionModeChange:m,onModelModeChange:g,onSwitchToRemote:C,onTerminal:S,autocompletePrefixes:v=["@","/","$"],autocompleteSuggestions:_=rJ,voiceStatus:w="disconnected",voiceMicMuted:x=!1,onVoiceToggle:k,onVoiceMicToggle:A}=e,T=i??"default",M=s??"default",E=qn(),L=st(({composer:Le})=>Le.text),D=st(({composer:Le})=>Le.attachments),O=st(({thread:Le})=>Le.isRunning),j=st(({thread:Le})=>Le.isDisabled),U=n||!r&&!a||j,K=L.trim().length>0,$=D.length>0,Y=!$||D.every(Le=>{if(Le.status.type==="complete")return!0;if(Le.status.type!=="requires-action")return!1;const Ze=Le.path;return typeof Ze=="string"&&Ze.length>0}),Q=(K||$)&&Y&&!U&&!O,[F,N]=P.useState({text:"",selection:{start:0,end:0}}),[z,G]=P.useState(!1),[H,ee]=P.useState(!1),[ue,ce]=P.useState(!1),[J,V]=P.useState(!1),ne=P.useRef(null),he=P.useRef(h);P.useEffect(()=>{N(Le=>{if(Le.text===L)return Le;const Ze=L.length;return{text:L,selection:{start:Ze,end:Ze}}})},[L]),P.useEffect(()=>{he.current===!0&&h===!1&&V(!0),h&&V(!1),he.current=h},[h]);const{haptic:_e,isTouch:Ce}=er(),{isStandalone:we,isIOS:Ee}=$D(),yt=Ee&&we?"pb-0":"pb-3",Pe=MQ(F.text,F.selection,v),[Ot,Nt,Qe,Ge,Ke]=iN(Pe,_,{clampSelection:!0,wrapAround:!0}),Te=P.useCallback((Le="light")=>{Le==="light"?_e.impact("light"):Le==="success"?_e.notification("success"):_e.notification("error")},[_e]),Fe=P.useCallback(Le=>{const Ze=Ot[Le];if(!Ze||!ne.current)return;Ze.text.startsWith("$")&&jQ(Ze.text.slice(1));let Si=Ze.text,Kn=!0;f==="codex"&&Ze.source==="user"&&Ze.content&&(Si=Ze.content,Kn=!1);const os=IQ(F.text,F.selection,Si,v,Kn);E.composer().setText(os.text),N({text:os.text,selection:{start:os.cursorPosition,end:os.cursorPosition}}),setTimeout(()=>{const Wo=ne.current;if(Wo){Wo.setSelectionRange(os.cursorPosition,os.cursorPosition);try{Wo.focus({preventScroll:!0})}catch{Wo.focus()}}},0),Te("light")},[E,Ot,F,v,Te,f]),_t=U||H||!O,se=U||ue||!h,ge=!!(h&&C),Me=!!S;P.useEffect(()=>{H&&(O||ee(!1))},[H,O]),P.useEffect(()=>{ue&&(h||ce(!1))},[ue,h]);const je=P.useCallback(()=>{_t||(Te("error"),ee(!0),E.thread().cancelRun())},[_t,E,Te]),ze=P.useCallback(async()=>{if(!(se||!C)){Te("light"),ce(!0);try{await C()}catch{ce(!1)}}},[se,C,Te]),Ye=P.useMemo(()=>MU(f),[f]),He=P.useMemo(()=>Ye.map(Le=>Le.mode),[Ye]),Yt=P.useCallback(Le=>{const Ze=Le.key;if(!Le.nativeEvent.isComposing){if(Ot.length>0){if(Ze==="ArrowUp"){Le.preventDefault(),Qe();return}if(Ze==="ArrowDown"){Le.preventDefault(),Ge();return}if((Ze==="Enter"||Ze==="Tab")&&!Le.shiftKey){Le.preventDefault();const Si=Nt>=0?Nt:0;Fe(Si);return}if(Ze==="Escape"){Le.preventDefault(),Ke();return}}if(Ze==="Escape"&&O){Le.preventDefault(),je();return}if(Ze==="Tab"&&Le.shiftKey&&m&&He.length>0){Le.preventDefault();const Kn=(He.indexOf(T)+1)%He.length,os=He[Kn]??"default";m(os),Te("light")}}},[Ot,Nt,Qe,Ge,Ke,Fe,O,je,m,T,He,Te]);P.useEffect(()=>{const Le=Ze=>{if(Ze.key==="m"&&(Ze.metaKey||Ze.ctrlKey)&&g&&!_m(f)){Ze.preventDefault();const Kn=(Pf.indexOf(M)+1)%Pf.length;g(Pf[Kn]),Te("light")}};return window.addEventListener("keydown",Le),()=>window.removeEventListener("keydown",Le)},[M,g,Te,f]);const zt=P.useCallback(Le=>{const Ze={start:Le.target.selectionStart,end:Le.target.selectionEnd};N({text:Le.target.value,selection:Ze})},[]),sn=P.useCallback(Le=>{const Ze=Le.target;N(Si=>({...Si,selection:{start:Ze.selectionStart,end:Ze.selectionEnd}}))},[]),St=P.useCallback(async Le=>{const Si=Array.from(Le.clipboardData?.files||[]).filter(Kn=>Kn.type.startsWith("image/"));if(Si.length!==0){Le.preventDefault();try{for(const Kn of Si)await E.composer().addAttachment(Kn)}catch(Kn){console.error("Error adding pasted image:",Kn)}}},[E]),Wn=P.useCallback(()=>{Te("light"),G(Le=>!Le)},[Te]),Gn=P.useCallback(Le=>{if(Le&&!Y){Le.preventDefault();return}V(!1)},[Y]),il=P.useCallback(Le=>{!m||U||(m(Le),G(!1),Te("light"))},[m,U,Te]),ss=P.useCallback(Le=>{!g||U||(g(Le),G(!1),Te("light"))},[g,U,Te]),yi=!!(m&&Ye.length>0),_i=!!(g&&!_m(f)),rs=!!(yi||_i),sl=!0,Vo=!!k,Tg=P.useCallback(()=>{E.composer().send()},[E]),mh=P.useMemo(()=>z&&(yi||_i)?b.jsx("div",{className:"absolute bottom-[100%] mb-2 w-full",children:b.jsxs(M0,{maxHeight:320,children:[yi?b.jsxs("div",{className:"py-2",children:[b.jsx("div",{className:"px-3 pb-1 text-xs font-semibold text-[var(--app-hint)]",children:t("misc.permissionMode")}),Ye.map(Le=>b.jsxs("button",{type:"button",disabled:U,className:`flex w-full items-center gap-2 px-3 py-2 text-left text-sm transition-colors ${U?"cursor-not-allowed opacity-50":"cursor-pointer hover:bg-[var(--app-secondary-bg)]"}`,onClick:()=>il(Le.mode),onMouseDown:Ze=>Ze.preventDefault(),children:[b.jsx("div",{className:`flex h-4 w-4 items-center justify-center rounded-full border-2 ${T===Le.mode?"border-[var(--app-link)]":"border-[var(--app-hint)]"}`,children:T===Le.mode&&b.jsx("div",{className:"h-2 w-2 rounded-full bg-[var(--app-link)]"})}),b.jsx("span",{className:T===Le.mode?"text-[var(--app-link)]":"",children:Le.label})]},Le.mode))]}):null,yi&&_i?b.jsx("div",{className:"mx-3 h-px bg-[var(--app-divider)]"}):null,_i?b.jsxs("div",{className:"py-2",children:[b.jsx("div",{className:"px-3 pb-1 text-xs font-semibold text-[var(--app-hint)]",children:t("misc.model")}),Pf.map(Le=>b.jsxs("button",{type:"button",disabled:U,className:`flex w-full items-center gap-2 px-3 py-2 text-left text-sm transition-colors ${U?"cursor-not-allowed opacity-50":"cursor-pointer hover:bg-[var(--app-secondary-bg)]"}`,onClick:()=>ss(Le),onMouseDown:Ze=>Ze.preventDefault(),children:[b.jsx("div",{className:`flex h-4 w-4 items-center justify-center rounded-full border-2 ${M===Le?"border-[var(--app-link)]":"border-[var(--app-hint)]"}`,children:M===Le&&b.jsx("div",{className:"h-2 w-2 rounded-full bg-[var(--app-link)]"})}),b.jsx("span",{className:M===Le?"text-[var(--app-link)]":"",children:AU[Le]})]},Le))]}):null]})}):Ot.length>0?b.jsx("div",{className:"absolute bottom-[100%] mb-2 w-full",children:b.jsx(M0,{children:b.jsx(oN,{suggestions:Ot,selectedIndex:Nt,onSelect:Le=>Fe(Le)})})}):null,[z,yi,_i,Ot,Nt,U,T,M,Ye,il,ss,Fe]);return b.jsx("div",{className:`px-3 ${yt} pt-2 bg-[var(--app-bg)]`,children:b.jsx("div",{className:"mx-auto w-full max-w-content",children:b.jsxs(jO,{className:"relative",onSubmit:Gn,children:[mh,b.jsx(qQ,{active:r,thinking:o,agentState:l,contextSize:u,modelMode:M,permissionMode:T,agentFlavor:f,voiceStatus:w}),b.jsxs("div",{className:"overflow-hidden rounded-[20px] bg-[var(--app-secondary-bg)]",children:[D.length>0?b.jsx("div",{className:"flex flex-wrap gap-2 px-4 pt-3",children:b.jsx(zO,{components:{Attachment:sJ}})}):null,b.jsx("div",{className:"flex items-center px-4 py-3",children:b.jsx(FO,{ref:ne,autoFocus:!U&&!Ce,placeholder:t(J?"misc.typeMessage":"misc.typeAMessage"),disabled:U,maxRows:5,submitOnEnter:!Ce,cancelOnEscape:!1,onChange:zt,onSelect:sn,onKeyDown:Yt,onPaste:St,className:"flex-1 resize-none bg-transparent text-base leading-snug text-[var(--app-fg)] placeholder-[var(--app-hint)] focus:outline-none disabled:cursor-not-allowed disabled:opacity-50"})}),b.jsx(tJ,{canSend:Q,controlsDisabled:U,showSettingsButton:rs,onSettingsToggle:Wn,showTerminalButton:Me,terminalDisabled:U,onTerminal:S??(()=>{}),showAbortButton:sl,abortDisabled:_t,isAborting:H,onAbort:je,showSwitchButton:ge,switchDisabled:se,isSwitching:ue,onSwitch:ze,voiceEnabled:Vo,voiceStatus:w,voiceMicMuted:x,onVoiceToggle:k??(()=>{}),onVoiceMicToggle:A,onSend:Tg})]})]})})})}const aN=P.createContext(null);function aJ(e){return b.jsx(aN.Provider,{value:e.value,children:e.children})}function TC(){const e=P.useContext(aN);if(!e)throw new Error("HappyChatContext is missing");return e}function lN(e,t){const n=t||{};return(e[e.length-1]===""?[...e,""]:e).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const lJ=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,cJ=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,uJ={};function LA(e,t){return(uJ.jsx?cJ:lJ).test(e)}const dJ=/[ \t\n\f\r]/g;function hg(e){return typeof e=="object"?e.type==="text"?IA(e.value):!1:IA(e)}function IA(e){return e.replace(dJ,"")===""}class lh{constructor(t,n,i){this.normal=n,this.property=t,i&&(this.space=i)}}lh.prototype.normal={};lh.prototype.property={};lh.prototype.space=void 0;function cN(e,t){const n={},i={};for(const s of e)Object.assign(n,s.property),Object.assign(i,s.normal);return new lh(n,i,t)}function L0(e){return e.toLowerCase()}class bi{constructor(t,n){this.attribute=n,this.property=t}}bi.prototype.attribute="";bi.prototype.booleanish=!1;bi.prototype.boolean=!1;bi.prototype.commaOrSpaceSeparated=!1;bi.prototype.commaSeparated=!1;bi.prototype.defined=!1;bi.prototype.mustUseProperty=!1;bi.prototype.number=!1;bi.prototype.overloadedBoolean=!1;bi.prototype.property="";bi.prototype.spaceSeparated=!1;bi.prototype.space=void 0;let hJ=0;const nt=tl(),mn=tl(),I0=tl(),xe=tl(),Ht=tl(),vc=tl(),Ai=tl();function tl(){return 2**++hJ}const P0=Object.freeze(Object.defineProperty({__proto__:null,boolean:nt,booleanish:mn,commaOrSpaceSeparated:Ai,commaSeparated:vc,number:xe,overloadedBoolean:I0,spaceSeparated:Ht},Symbol.toStringTag,{value:"Module"})),Gy=Object.keys(P0);class EC extends bi{constructor(t,n,i,s){let r=-1;if(super(t,n),PA(this,"space",s),typeof i=="number")for(;++r<Gy.length;){const a=Gy[r];PA(this,Gy[r],(i&P0[a])===P0[a])}}}EC.prototype.defined=!0;function PA(e,t,n){n&&(e[t]=n)}function Nc(e){const t={},n={};for(const[i,s]of Object.entries(e.properties)){const r=new EC(i,e.transform(e.attributes||{},i),s,e.space);e.mustUseProperty&&e.mustUseProperty.includes(i)&&(r.mustUseProperty=!0),t[i]=r,n[L0(i)]=i,n[L0(r.attribute)]=i}return new lh(t,n,e.space)}const uN=Nc({properties:{ariaActiveDescendant:null,ariaAtomic:mn,ariaAutoComplete:null,ariaBusy:mn,ariaChecked:mn,ariaColCount:xe,ariaColIndex:xe,ariaColSpan:xe,ariaControls:Ht,ariaCurrent:null,ariaDescribedBy:Ht,ariaDetails:null,ariaDisabled:mn,ariaDropEffect:Ht,ariaErrorMessage:null,ariaExpanded:mn,ariaFlowTo:Ht,ariaGrabbed:mn,ariaHasPopup:null,ariaHidden:mn,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Ht,ariaLevel:xe,ariaLive:null,ariaModal:mn,ariaMultiLine:mn,ariaMultiSelectable:mn,ariaOrientation:null,ariaOwns:Ht,ariaPlaceholder:null,ariaPosInSet:xe,ariaPressed:mn,ariaReadOnly:mn,ariaRelevant:null,ariaRequired:mn,ariaRoleDescription:Ht,ariaRowCount:xe,ariaRowIndex:xe,ariaRowSpan:xe,ariaSelected:mn,ariaSetSize:xe,ariaSort:null,ariaValueMax:xe,ariaValueMin:xe,ariaValueNow:xe,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function dN(e,t){return t in e?e[t]:t}function hN(e,t){return dN(e,t.toLowerCase())}const fJ=Nc({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:vc,acceptCharset:Ht,accessKey:Ht,action:null,allow:null,allowFullScreen:nt,allowPaymentRequest:nt,allowUserMedia:nt,alt:null,as:null,async:nt,autoCapitalize:null,autoComplete:Ht,autoFocus:nt,autoPlay:nt,blocking:Ht,capture:null,charSet:null,checked:nt,cite:null,className:Ht,cols:xe,colSpan:null,content:null,contentEditable:mn,controls:nt,controlsList:Ht,coords:xe|vc,crossOrigin:null,data:null,dateTime:null,decoding:null,default:nt,defer:nt,dir:null,dirName:null,disabled:nt,download:I0,draggable:mn,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:nt,formTarget:null,headers:Ht,height:xe,hidden:I0,high:xe,href:null,hrefLang:null,htmlFor:Ht,httpEquiv:Ht,id:null,imageSizes:null,imageSrcSet:null,inert:nt,inputMode:null,integrity:null,is:null,isMap:nt,itemId:null,itemProp:Ht,itemRef:Ht,itemScope:nt,itemType:Ht,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:nt,low:xe,manifest:null,max:null,maxLength:xe,media:null,method:null,min:null,minLength:xe,multiple:nt,muted:nt,name:null,nonce:null,noModule:nt,noValidate:nt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:nt,optimum:xe,pattern:null,ping:Ht,placeholder:null,playsInline:nt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:nt,referrerPolicy:null,rel:Ht,required:nt,reversed:nt,rows:xe,rowSpan:xe,sandbox:Ht,scope:null,scoped:nt,seamless:nt,selected:nt,shadowRootClonable:nt,shadowRootDelegatesFocus:nt,shadowRootMode:null,shape:null,size:xe,sizes:null,slot:null,span:xe,spellCheck:mn,src:null,srcDoc:null,srcLang:null,srcSet:null,start:xe,step:null,style:null,tabIndex:xe,target:null,title:null,translate:null,type:null,typeMustMatch:nt,useMap:null,value:mn,width:xe,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Ht,axis:null,background:null,bgColor:null,border:xe,borderColor:null,bottomMargin:xe,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:nt,declare:nt,event:null,face:null,frame:null,frameBorder:null,hSpace:xe,leftMargin:xe,link:null,longDesc:null,lowSrc:null,marginHeight:xe,marginWidth:xe,noResize:nt,noHref:nt,noShade:nt,noWrap:nt,object:null,profile:null,prompt:null,rev:null,rightMargin:xe,rules:null,scheme:null,scrolling:mn,standby:null,summary:null,text:null,topMargin:xe,valueType:null,version:null,vAlign:null,vLink:null,vSpace:xe,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:nt,disableRemotePlayback:nt,prefix:null,property:null,results:xe,security:null,unselectable:null},space:"html",transform:hN}),pJ=Nc({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Ai,accentHeight:xe,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:xe,amplitude:xe,arabicForm:null,ascent:xe,attributeName:null,attributeType:null,azimuth:xe,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:xe,by:null,calcMode:null,capHeight:xe,className:Ht,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:xe,diffuseConstant:xe,direction:null,display:null,dur:null,divisor:xe,dominantBaseline:null,download:nt,dx:null,dy:null,edgeMode:null,editable:null,elevation:xe,enableBackground:null,end:null,event:null,exponent:xe,externalResourcesRequired:null,fill:null,fillOpacity:xe,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:vc,g2:vc,glyphName:vc,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:xe,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:xe,horizOriginX:xe,horizOriginY:xe,id:null,ideographic:xe,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:xe,k:xe,k1:xe,k2:xe,k3:xe,k4:xe,kernelMatrix:Ai,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:xe,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:xe,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:xe,overlineThickness:xe,paintOrder:null,panose1:null,path:null,pathLength:xe,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Ht,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:xe,pointsAtY:xe,pointsAtZ:xe,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Ai,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Ai,rev:Ai,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Ai,requiredFeatures:Ai,requiredFonts:Ai,requiredFormats:Ai,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:xe,specularExponent:xe,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:xe,strikethroughThickness:xe,string:null,stroke:null,strokeDashArray:Ai,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:xe,strokeOpacity:xe,strokeWidth:null,style:null,surfaceScale:xe,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Ai,tabIndex:xe,tableValues:null,target:null,targetX:xe,targetY:xe,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Ai,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:xe,underlineThickness:xe,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:xe,values:null,vAlphabetic:xe,vMathematical:xe,vectorEffect:null,vHanging:xe,vIdeographic:xe,version:null,vertAdvY:xe,vertOriginX:xe,vertOriginY:xe,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:xe,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:dN}),fN=Nc({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),pN=Nc({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:hN}),mN=Nc({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),mJ={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},gJ=/[A-Z]/g,DA=/-[a-z]/g,vJ=/^data[-\w.:]+$/i;function gN(e,t){const n=L0(t);let i=t,s=bi;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&vJ.test(t)){if(t.charAt(4)==="-"){const r=t.slice(5).replace(DA,yJ);i="data"+r.charAt(0).toUpperCase()+r.slice(1)}else{const r=t.slice(4);if(!DA.test(r)){let a=r.replace(gJ,bJ);a.charAt(0)!=="-"&&(a="-"+a),t="data"+a}}s=EC}return new s(i,t)}function bJ(e){return"-"+e.toLowerCase()}function yJ(e){return e.charAt(1).toUpperCase()}const vN=cN([uN,fJ,fN,pN,mN],"html"),ch=cN([uN,pJ,fN,pN,mN],"svg");function bN(e){return e.join(" ").trim()}var Yl={},Ky,OA;function _J(){if(OA)return Ky;OA=1;var e=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,t=/\n/g,n=/^\s*/,i=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,s=/^:\s*/,r=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,a=/^[;\s]*/,o=/^\s+|\s+$/g,l=`
`,u="/",h="*",f="",m="comment",g="declaration";function C(v,_){if(typeof v!="string")throw new TypeError("First argument must be a string");if(!v)return[];_=_||{};var w=1,x=1;function k(q){var K=q.match(t);K&&(w+=K.length);var $=q.lastIndexOf(l);x=~$?q.length-$:x+q.length}function A(){var q={line:w,column:x};return function(K){return K.position=new T(q),L(),K}}function T(q){this.start=q,this.end={line:w,column:x},this.source=_.source}T.prototype.content=v;function M(q){var K=new Error(_.source+":"+w+":"+x+": "+q);if(K.reason=q,K.filename=_.source,K.line=w,K.column=x,K.source=v,!_.silent)throw K}function E(q){var K=q.exec(v);if(K){var $=K[0];return k($),v=v.slice($.length),K}}function L(){E(n)}function D(q){var K;for(q=q||[];K=O();)K!==!1&&q.push(K);return q}function O(){var q=A();if(!(u!=v.charAt(0)||h!=v.charAt(1))){for(var K=2;f!=v.charAt(K)&&(h!=v.charAt(K)||u!=v.charAt(K+1));)++K;if(K+=2,f===v.charAt(K-1))return M("End of comment missing");var $=v.slice(2,K-2);return x+=2,k($),v=v.slice(K),x+=2,q({type:m,comment:$})}}function j(){var q=A(),K=E(i);if(K){if(O(),!E(s))return M("property missing ':'");var $=E(r),Y=q({type:g,property:S(K[0].replace(e,f)),value:$?S($[0].replace(e,f)):f});return E(a),Y}}function U(){var q=[];D(q);for(var K;K=j();)K!==!1&&(q.push(K),D(q));return q}return L(),U()}function S(v){return v?v.replace(o,f):f}return Ky=C,Ky}var NA;function SJ(){if(NA)return Yl;NA=1;var e=Yl&&Yl.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Yl,"__esModule",{value:!0}),Yl.default=n;const t=e(_J());function n(i,s){let r=null;if(!i||typeof i!="string")return r;const a=(0,t.default)(i),o=typeof s=="function";return a.forEach(l=>{if(l.type!=="declaration")return;const{property:u,value:h}=l;o?s(u,h,l):h&&(r=r||{},r[u]=h)}),r}return Yl}var qu={},jA;function CJ(){if(jA)return qu;jA=1,Object.defineProperty(qu,"__esModule",{value:!0}),qu.camelCase=void 0;var e=/^--[a-zA-Z0-9_-]+$/,t=/-([a-z])/g,n=/^[^-]+$/,i=/^-(webkit|moz|ms|o|khtml)-/,s=/^-(ms)-/,r=function(u){return!u||n.test(u)||e.test(u)},a=function(u,h){return h.toUpperCase()},o=function(u,h){return"".concat(h,"-")},l=function(u,h){return h===void 0&&(h={}),r(u)?u:(u=u.toLowerCase(),h.reactCompat?u=u.replace(s,o):u=u.replace(i,o),u.replace(t,a))};return qu.camelCase=l,qu}var Vu,BA;function xJ(){if(BA)return Vu;BA=1;var e=Vu&&Vu.__importDefault||function(s){return s&&s.__esModule?s:{default:s}},t=e(SJ()),n=CJ();function i(s,r){var a={};return!s||typeof s!="string"||(0,t.default)(s,function(o,l){o&&l&&(a[(0,n.camelCase)(o,r)]=l)}),a}return i.default=i,Vu=i,Vu}var wJ=xJ();const kJ=Ga(wJ),yN=_N("end"),RC=_N("start");function _N(e){return t;function t(n){const i=n&&n.position&&n.position[e]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function TJ(e){const t=RC(e),n=yN(e);if(t&&n)return{start:t,end:n}}function gd(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?FA(e.position):"start"in e||"end"in e?FA(e):"line"in e||"column"in e?D0(e):""}function D0(e){return UA(e&&e.line)+":"+UA(e&&e.column)}function FA(e){return D0(e&&e.start)+"-"+D0(e&&e.end)}function UA(e){return e&&typeof e=="number"?e:1}class Vn extends Error{constructor(t,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let s="",r={},a=!1;if(n&&("line"in n&&"column"in n?r={place:n}:"start"in n&&"end"in n?r={place:n}:"type"in n?r={ancestors:[n],place:n.position}:r={...n}),typeof t=="string"?s=t:!r.cause&&t&&(a=!0,s=t.message,r.cause=t),!r.ruleId&&!r.source&&typeof i=="string"){const l=i.indexOf(":");l===-1?r.ruleId=i:(r.source=i.slice(0,l),r.ruleId=i.slice(l+1))}if(!r.place&&r.ancestors&&r.ancestors){const l=r.ancestors[r.ancestors.length-1];l&&(r.place=l.position)}const o=r.place&&"start"in r.place?r.place.start:r.place;this.ancestors=r.ancestors||void 0,this.cause=r.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=o?o.line:void 0,this.name=gd(r.place)||"1:1",this.place=r.place||void 0,this.reason=this.message,this.ruleId=r.ruleId||void 0,this.source=r.source||void 0,this.stack=a&&r.cause&&typeof r.cause.stack=="string"?r.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Vn.prototype.file="";Vn.prototype.name="";Vn.prototype.reason="";Vn.prototype.message="";Vn.prototype.stack="";Vn.prototype.column=void 0;Vn.prototype.line=void 0;Vn.prototype.ancestors=void 0;Vn.prototype.cause=void 0;Vn.prototype.fatal=void 0;Vn.prototype.place=void 0;Vn.prototype.ruleId=void 0;Vn.prototype.source=void 0;const AC={}.hasOwnProperty,EJ=new Map,RJ=/[A-Z]/g,AJ=new Set(["table","tbody","thead","tfoot","tr"]),MJ=new Set(["td","th"]),SN="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function CN(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let i;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");i=BJ(n,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");i=jJ(n,t.jsx,t.jsxs)}const s={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:i,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?ch:vN,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},r=xN(s,e,void 0);return r&&typeof r!="string"?r:s.create(e,s.Fragment,{children:r||void 0},void 0)}function xN(e,t,n){if(t.type==="element")return LJ(e,t,n);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return IJ(e,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return DJ(e,t,n);if(t.type==="mdxjsEsm")return PJ(e,t);if(t.type==="root")return OJ(e,t,n);if(t.type==="text")return NJ(e,t)}function LJ(e,t,n){const i=e.schema;let s=i;t.tagName.toLowerCase()==="svg"&&i.space==="html"&&(s=ch,e.schema=s),e.ancestors.push(t);const r=kN(e,t.tagName,!1),a=FJ(e,t);let o=LC(e,t);return AJ.has(t.tagName)&&(o=o.filter(function(l){return typeof l=="string"?!hg(l):!0})),wN(e,a,r,t),MC(a,o),e.ancestors.pop(),e.schema=i,e.create(t,r,a,n)}function IJ(e,t){if(t.data&&t.data.estree&&e.evaluater){const i=t.data.estree.body[0];return i.type,e.evaluater.evaluateExpression(i.expression)}Wd(e,t.position)}function PJ(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);Wd(e,t.position)}function DJ(e,t,n){const i=e.schema;let s=i;t.name==="svg"&&i.space==="html"&&(s=ch,e.schema=s),e.ancestors.push(t);const r=t.name===null?e.Fragment:kN(e,t.name,!0),a=UJ(e,t),o=LC(e,t);return wN(e,a,r,t),MC(a,o),e.ancestors.pop(),e.schema=i,e.create(t,r,a,n)}function OJ(e,t,n){const i={};return MC(i,LC(e,t)),e.create(t,e.Fragment,i,n)}function NJ(e,t){return t.value}function wN(e,t,n,i){typeof n!="string"&&n!==e.Fragment&&e.passNode&&(t.node=i)}function MC(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function jJ(e,t,n){return i;function i(s,r,a,o){const u=Array.isArray(a.children)?n:t;return o?u(r,a,o):u(r,a)}}function BJ(e,t){return n;function n(i,s,r,a){const o=Array.isArray(r.children),l=RC(i);return t(s,r,a,o,{columnNumber:l?l.column-1:void 0,fileName:e,lineNumber:l?l.line:void 0},void 0)}}function FJ(e,t){const n={};let i,s;for(s in t.properties)if(s!=="children"&&AC.call(t.properties,s)){const r=zJ(e,s,t.properties[s]);if(r){const[a,o]=r;e.tableCellAlignToStyle&&a==="align"&&typeof o=="string"&&MJ.has(t.tagName)?i=o:n[a]=o}}if(i){const r=n.style||(n.style={});r[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=i}return n}function UJ(e,t){const n={};for(const i of t.attributes)if(i.type==="mdxJsxExpressionAttribute")if(i.data&&i.data.estree&&e.evaluater){const r=i.data.estree.body[0];r.type;const a=r.expression;a.type;const o=a.properties[0];o.type,Object.assign(n,e.evaluater.evaluateExpression(o.argument))}else Wd(e,t.position);else{const s=i.name;let r;if(i.value&&typeof i.value=="object")if(i.value.data&&i.value.data.estree&&e.evaluater){const o=i.value.data.estree.body[0];o.type,r=e.evaluater.evaluateExpression(o.expression)}else Wd(e,t.position);else r=i.value===null?!0:i.value;n[s]=r}return n}function LC(e,t){const n=[];let i=-1;const s=e.passKeys?new Map:EJ;for(;++i<t.children.length;){const r=t.children[i];let a;if(e.passKeys){const l=r.type==="element"?r.tagName:r.type==="mdxJsxFlowElement"||r.type==="mdxJsxTextElement"?r.name:void 0;if(l){const u=s.get(l)||0;a=l+"-"+u,s.set(l,u+1)}}const o=xN(e,r,a);o!==void 0&&n.push(o)}return n}function zJ(e,t,n){const i=gN(e.schema,t);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=i.commaSeparated?lN(n):bN(n)),i.property==="style"){let s=typeof n=="object"?n:HJ(e,String(n));return e.stylePropertyNameCase==="css"&&(s=$J(s)),["style",s]}return[e.elementAttributeNameCase==="react"&&i.space?mJ[i.property]||i.property:i.attribute,n]}}function HJ(e,t){try{return kJ(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const i=n,s=new Vn("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:i,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=e.filePath||void 0,s.url=SN+"#cannot-parse-style-attribute",s}}function kN(e,t,n){let i;if(!n)i={type:"Literal",value:t};else if(t.includes(".")){const s=t.split(".");let r=-1,a;for(;++r<s.length;){const o=LA(s[r])?{type:"Identifier",name:s[r]}:{type:"Literal",value:s[r]};a=a?{type:"MemberExpression",object:a,property:o,computed:!!(r&&o.type==="Literal"),optional:!1}:o}i=a}else i=LA(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(i.type==="Literal"){const s=i.value;return AC.call(e.components,s)?e.components[s]:s}if(e.evaluater)return e.evaluater.evaluateExpression(i);Wd(e)}function Wd(e,t){const n=new Vn("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=SN+"#cannot-handle-mdx-estrees-without-createevaluater",n}function $J(e){const t={};let n;for(n in e)AC.call(e,n)&&(t[qJ(n)]=e[n]);return t}function qJ(e){let t=e.replace(RJ,VJ);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function VJ(e){return"-"+e.toLowerCase()}const Yy={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},WJ={};function IC(e,t){const n=WJ,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return TN(e,i,s)}function TN(e,t,n){if(GJ(e)){if("value"in e)return e.type==="html"&&!n?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return zA(e.children,t,n)}return Array.isArray(e)?zA(e,t,n):""}function zA(e,t,n){const i=[];let s=-1;for(;++s<e.length;)i[s]=TN(e[s],t,n);return i.join("")}function GJ(e){return!!(e&&typeof e=="object")}const HA=document.createElement("i");function PC(e){const t="&"+e+";";HA.innerHTML=t;const n=HA.textContent;return n.charCodeAt(n.length-1)===59&&e!=="semi"||n===t?!1:n}function Oi(e,t,n,i){const s=e.length;let r=0,a;if(t<0?t=-t>s?0:s+t:t=t>s?s:t,n=n>0?n:0,i.length<1e4)a=Array.from(i),a.unshift(t,n),e.splice(...a);else for(n&&e.splice(t,n);r<i.length;)a=i.slice(r,r+1e4),a.unshift(t,0),e.splice(...a),r+=1e4,t+=1e4}function Ji(e,t){return e.length>0?(Oi(e,e.length,0,t),e):t}const $A={}.hasOwnProperty;function EN(e){const t={};let n=-1;for(;++n<e.length;)KJ(t,e[n]);return t}function KJ(e,t){let n;for(n in t){const s=($A.call(e,n)?e[n]:void 0)||(e[n]={}),r=t[n];let a;if(r)for(a in r){$A.call(s,a)||(s[a]=[]);const o=r[a];YJ(s[a],Array.isArray(o)?o:o?[o]:[])}}}function YJ(e,t){let n=-1;const i=[];for(;++n<t.length;)(t[n].add==="after"?e:i).push(t[n]);Oi(e,0,0,i)}function RN(e,t){const n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function Cs(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ti=qo(/[A-Za-z]/),Hn=qo(/[\dA-Za-z]/),QJ=qo(/[#-'*+\--9=?A-Z^-~]/);function Sm(e){return e!==null&&(e<32||e===127)}const O0=qo(/\d/),JJ=qo(/[\dA-Fa-f]/),XJ=qo(/[!-/:-@[-`{-~]/);function $e(e){return e!==null&&e<-2}function Ut(e){return e!==null&&(e<0||e===32)}function ht(e){return e===-2||e===-1||e===32}const fg=qo(new RegExp("\\p{P}|\\p{S}","u")),Va=qo(/\s/);function qo(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCharCode(n))}}function jc(e){const t=[];let n=-1,i=0,s=0;for(;++n<e.length;){const r=e.charCodeAt(n);let a="";if(r===37&&Hn(e.charCodeAt(n+1))&&Hn(e.charCodeAt(n+2)))s=2;else if(r<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(r))||(a=String.fromCharCode(r));else if(r>55295&&r<57344){const o=e.charCodeAt(n+1);r<56320&&o>56319&&o<57344?(a=String.fromCharCode(r,o),s=1):a=""}else a=String.fromCharCode(r);a&&(t.push(e.slice(i,n),encodeURIComponent(a)),i=n+s+1,a=""),s&&(n+=s,s=0)}return t.join("")+e.slice(i)}function vt(e,t,n,i){const s=i?i-1:Number.POSITIVE_INFINITY;let r=0;return a;function a(l){return ht(l)?(e.enter(n),o(l)):t(l)}function o(l){return ht(l)&&r++<s?(e.consume(l),o):(e.exit(n),t(l))}}const ZJ={tokenize:eX};function eX(e){const t=e.attempt(this.parser.constructs.contentInitial,i,s);let n;return t;function i(o){if(o===null){e.consume(o);return}return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),vt(e,t,"linePrefix")}function s(o){return e.enter("paragraph"),r(o)}function r(o){const l=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,a(o)}function a(o){if(o===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(o);return}return $e(o)?(e.consume(o),e.exit("chunkText"),r):(e.consume(o),a)}}const tX={tokenize:nX},qA={tokenize:iX};function nX(e){const t=this,n=[];let i=0,s,r,a;return o;function o(x){if(i<n.length){const k=n[i];return t.containerState=k[1],e.attempt(k[0].continuation,l,u)(x)}return u(x)}function l(x){if(i++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,s&&w();const k=t.events.length;let A=k,T;for(;A--;)if(t.events[A][0]==="exit"&&t.events[A][1].type==="chunkFlow"){T=t.events[A][1].end;break}_(i);let M=k;for(;M<t.events.length;)t.events[M][1].end={...T},M++;return Oi(t.events,A+1,0,t.events.slice(k)),t.events.length=M,u(x)}return o(x)}function u(x){if(i===n.length){if(!s)return m(x);if(s.currentConstruct&&s.currentConstruct.concrete)return C(x);t.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(qA,h,f)(x)}function h(x){return s&&w(),_(i),m(x)}function f(x){return t.parser.lazy[t.now().line]=i!==n.length,a=t.now().offset,C(x)}function m(x){return t.containerState={},e.attempt(qA,g,C)(x)}function g(x){return i++,n.push([t.currentConstruct,t.containerState]),m(x)}function C(x){if(x===null){s&&w(),_(0),e.consume(x);return}return s=s||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:r}),S(x)}function S(x){if(x===null){v(e.exit("chunkFlow"),!0),_(0),e.consume(x);return}return $e(x)?(e.consume(x),v(e.exit("chunkFlow")),i=0,t.interrupt=void 0,o):(e.consume(x),S)}function v(x,k){const A=t.sliceStream(x);if(k&&A.push(null),x.previous=r,r&&(r.next=x),r=x,s.defineSkip(x.start),s.write(A),t.parser.lazy[x.start.line]){let T=s.events.length;for(;T--;)if(s.events[T][1].start.offset<a&&(!s.events[T][1].end||s.events[T][1].end.offset>a))return;const M=t.events.length;let E=M,L,D;for(;E--;)if(t.events[E][0]==="exit"&&t.events[E][1].type==="chunkFlow"){if(L){D=t.events[E][1].end;break}L=!0}for(_(i),T=M;T<t.events.length;)t.events[T][1].end={...D},T++;Oi(t.events,E+1,0,t.events.slice(M)),t.events.length=T}}function _(x){let k=n.length;for(;k-- >x;){const A=n[k];t.containerState=A[1],A[0].exit.call(t,e)}n.length=x}function w(){s.write([null]),r=void 0,s=void 0,t.containerState._closeFlow=void 0}}function iX(e,t,n){return vt(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Tc(e){if(e===null||Ut(e)||Va(e))return 1;if(fg(e))return 2}function pg(e,t,n){const i=[];let s=-1;for(;++s<e.length;){const r=e[s].resolveAll;r&&!i.includes(r)&&(t=r(t,n),i.push(r))}return t}const N0={name:"attention",resolveAll:sX,tokenize:rX};function sX(e,t){let n=-1,i,s,r,a,o,l,u,h;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(i=n;i--;)if(e[i][0]==="exit"&&e[i][1].type==="attentionSequence"&&e[i][1]._open&&t.sliceSerialize(e[i][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[i][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[i][1].end.offset-e[i][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;l=e[i][1].end.offset-e[i][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const f={...e[i][1].end},m={...e[n][1].start};VA(f,-l),VA(m,l),a={type:l>1?"strongSequence":"emphasisSequence",start:f,end:{...e[i][1].end}},o={type:l>1?"strongSequence":"emphasisSequence",start:{...e[n][1].start},end:m},r={type:l>1?"strongText":"emphasisText",start:{...e[i][1].end},end:{...e[n][1].start}},s={type:l>1?"strong":"emphasis",start:{...a.start},end:{...o.end}},e[i][1].end={...a.start},e[n][1].start={...o.end},u=[],e[i][1].end.offset-e[i][1].start.offset&&(u=Ji(u,[["enter",e[i][1],t],["exit",e[i][1],t]])),u=Ji(u,[["enter",s,t],["enter",a,t],["exit",a,t],["enter",r,t]]),u=Ji(u,pg(t.parser.constructs.insideSpan.null,e.slice(i+1,n),t)),u=Ji(u,[["exit",r,t],["enter",o,t],["exit",o,t],["exit",s,t]]),e[n][1].end.offset-e[n][1].start.offset?(h=2,u=Ji(u,[["enter",e[n][1],t],["exit",e[n][1],t]])):h=0,Oi(e,i-1,n-i+3,u),n=i+u.length-h-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function rX(e,t){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,s=Tc(i);let r;return a;function a(l){return r=l,e.enter("attentionSequence"),o(l)}function o(l){if(l===r)return e.consume(l),o;const u=e.exit("attentionSequence"),h=Tc(l),f=!h||h===2&&s||n.includes(l),m=!s||s===2&&h||n.includes(i);return u._open=!!(r===42?f:f&&(s||!m)),u._close=!!(r===42?m:m&&(h||!f)),t(l)}}function VA(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const oX={name:"autolink",tokenize:aX};function aX(e,t,n){let i=0;return s;function s(g){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(g),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),r}function r(g){return ti(g)?(e.consume(g),a):g===64?n(g):u(g)}function a(g){return g===43||g===45||g===46||Hn(g)?(i=1,o(g)):u(g)}function o(g){return g===58?(e.consume(g),i=0,l):(g===43||g===45||g===46||Hn(g))&&i++<32?(e.consume(g),o):(i=0,u(g))}function l(g){return g===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(g),e.exit("autolinkMarker"),e.exit("autolink"),t):g===null||g===32||g===60||Sm(g)?n(g):(e.consume(g),l)}function u(g){return g===64?(e.consume(g),h):QJ(g)?(e.consume(g),u):n(g)}function h(g){return Hn(g)?f(g):n(g)}function f(g){return g===46?(e.consume(g),i=0,h):g===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(g),e.exit("autolinkMarker"),e.exit("autolink"),t):m(g)}function m(g){if((g===45||Hn(g))&&i++<63){const C=g===45?m:f;return e.consume(g),C}return n(g)}}const uh={partial:!0,tokenize:lX};function lX(e,t,n){return i;function i(r){return ht(r)?vt(e,s,"linePrefix")(r):s(r)}function s(r){return r===null||$e(r)?t(r):n(r)}}const AN={continuation:{tokenize:uX},exit:dX,name:"blockQuote",tokenize:cX};function cX(e,t,n){const i=this;return s;function s(a){if(a===62){const o=i.containerState;return o.open||(e.enter("blockQuote",{_container:!0}),o.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(a),e.exit("blockQuoteMarker"),r}return n(a)}function r(a){return ht(a)?(e.enter("blockQuotePrefixWhitespace"),e.consume(a),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(a))}}function uX(e,t,n){const i=this;return s;function s(a){return ht(a)?vt(e,r,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):r(a)}function r(a){return e.attempt(AN,t,n)(a)}}function dX(e){e.exit("blockQuote")}const MN={name:"characterEscape",tokenize:hX};function hX(e,t,n){return i;function i(r){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(r),e.exit("escapeMarker"),s}function s(r){return XJ(r)?(e.enter("characterEscapeValue"),e.consume(r),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(r)}}const LN={name:"characterReference",tokenize:fX};function fX(e,t,n){const i=this;let s=0,r,a;return o;function o(f){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(f),e.exit("characterReferenceMarker"),l}function l(f){return f===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(f),e.exit("characterReferenceMarkerNumeric"),u):(e.enter("characterReferenceValue"),r=31,a=Hn,h(f))}function u(f){return f===88||f===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(f),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),r=6,a=JJ,h):(e.enter("characterReferenceValue"),r=7,a=O0,h(f))}function h(f){if(f===59&&s){const m=e.exit("characterReferenceValue");return a===Hn&&!PC(i.sliceSerialize(m))?n(f):(e.enter("characterReferenceMarker"),e.consume(f),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return a(f)&&s++<r?(e.consume(f),h):n(f)}}const WA={partial:!0,tokenize:mX},GA={concrete:!0,name:"codeFenced",tokenize:pX};function pX(e,t,n){const i=this,s={partial:!0,tokenize:A};let r=0,a=0,o;return l;function l(T){return u(T)}function u(T){const M=i.events[i.events.length-1];return r=M&&M[1].type==="linePrefix"?M[2].sliceSerialize(M[1],!0).length:0,o=T,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),h(T)}function h(T){return T===o?(a++,e.consume(T),h):a<3?n(T):(e.exit("codeFencedFenceSequence"),ht(T)?vt(e,f,"whitespace")(T):f(T))}function f(T){return T===null||$e(T)?(e.exit("codeFencedFence"),i.interrupt?t(T):e.check(WA,S,k)(T)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),m(T))}function m(T){return T===null||$e(T)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),f(T)):ht(T)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),vt(e,g,"whitespace")(T)):T===96&&T===o?n(T):(e.consume(T),m)}function g(T){return T===null||$e(T)?f(T):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),C(T))}function C(T){return T===null||$e(T)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),f(T)):T===96&&T===o?n(T):(e.consume(T),C)}function S(T){return e.attempt(s,k,v)(T)}function v(T){return e.enter("lineEnding"),e.consume(T),e.exit("lineEnding"),_}function _(T){return r>0&&ht(T)?vt(e,w,"linePrefix",r+1)(T):w(T)}function w(T){return T===null||$e(T)?e.check(WA,S,k)(T):(e.enter("codeFlowValue"),x(T))}function x(T){return T===null||$e(T)?(e.exit("codeFlowValue"),w(T)):(e.consume(T),x)}function k(T){return e.exit("codeFenced"),t(T)}function A(T,M,E){let L=0;return D;function D(K){return T.enter("lineEnding"),T.consume(K),T.exit("lineEnding"),O}function O(K){return T.enter("codeFencedFence"),ht(K)?vt(T,j,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(K):j(K)}function j(K){return K===o?(T.enter("codeFencedFenceSequence"),U(K)):E(K)}function U(K){return K===o?(L++,T.consume(K),U):L>=a?(T.exit("codeFencedFenceSequence"),ht(K)?vt(T,q,"whitespace")(K):q(K)):E(K)}function q(K){return K===null||$e(K)?(T.exit("codeFencedFence"),M(K)):E(K)}}}function mX(e,t,n){const i=this;return s;function s(a){return a===null?n(a):(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),r)}function r(a){return i.parser.lazy[i.now().line]?n(a):t(a)}}const Qy={name:"codeIndented",tokenize:vX},gX={partial:!0,tokenize:bX};function vX(e,t,n){const i=this;return s;function s(u){return e.enter("codeIndented"),vt(e,r,"linePrefix",5)(u)}function r(u){const h=i.events[i.events.length-1];return h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?a(u):n(u)}function a(u){return u===null?l(u):$e(u)?e.attempt(gX,a,l)(u):(e.enter("codeFlowValue"),o(u))}function o(u){return u===null||$e(u)?(e.exit("codeFlowValue"),a(u)):(e.consume(u),o)}function l(u){return e.exit("codeIndented"),t(u)}}function bX(e,t,n){const i=this;return s;function s(a){return i.parser.lazy[i.now().line]?n(a):$e(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),s):vt(e,r,"linePrefix",5)(a)}function r(a){const o=i.events[i.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?t(a):$e(a)?s(a):n(a)}}const yX={name:"codeText",previous:SX,resolve:_X,tokenize:CX};function _X(e){let t=e.length-4,n=3,i,s;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(i=n;++i<t;)if(e[i][1].type==="codeTextData"){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}}for(i=n-1,t++;++i<=t;)s===void 0?i!==t&&e[i][1].type!=="lineEnding"&&(s=i):(i===t||e[i][1].type==="lineEnding")&&(e[s][1].type="codeTextData",i!==s+2&&(e[s][1].end=e[i-1][1].end,e.splice(s+2,i-s-2),t-=i-s-2,i=s+2),s=void 0);return e}function SX(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function CX(e,t,n){let i=0,s,r;return a;function a(f){return e.enter("codeText"),e.enter("codeTextSequence"),o(f)}function o(f){return f===96?(e.consume(f),i++,o):(e.exit("codeTextSequence"),l(f))}function l(f){return f===null?n(f):f===32?(e.enter("space"),e.consume(f),e.exit("space"),l):f===96?(r=e.enter("codeTextSequence"),s=0,h(f)):$e(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),l):(e.enter("codeTextData"),u(f))}function u(f){return f===null||f===32||f===96||$e(f)?(e.exit("codeTextData"),l(f)):(e.consume(f),u)}function h(f){return f===96?(e.consume(f),s++,h):s===i?(e.exit("codeTextSequence"),e.exit("codeText"),t(f)):(r.type="codeTextData",u(f))}}class xX{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(t,i):t>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(t,n,i){const s=n||0;this.setCursor(Math.trunc(t));const r=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return i&&Wu(this.left,i),r.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),Wu(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),Wu(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const n=this.left.splice(t,Number.POSITIVE_INFINITY);Wu(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);Wu(this.left,n.reverse())}}}function Wu(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function IN(e){const t={};let n=-1,i,s,r,a,o,l,u;const h=new xX(e);for(;++n<h.length;){for(;n in t;)n=t[n];if(i=h.get(n),n&&i[1].type==="chunkFlow"&&h.get(n-1)[1].type==="listItemPrefix"&&(l=i[1]._tokenizer.events,r=0,r<l.length&&l[r][1].type==="lineEndingBlank"&&(r+=2),r<l.length&&l[r][1].type==="content"))for(;++r<l.length&&l[r][1].type!=="content";)l[r][1].type==="chunkText"&&(l[r][1]._isInFirstContentOfListItem=!0,r++);if(i[0]==="enter")i[1].contentType&&(Object.assign(t,wX(h,n)),n=t[n],u=!0);else if(i[1]._container){for(r=n,s=void 0;r--;)if(a=h.get(r),a[1].type==="lineEnding"||a[1].type==="lineEndingBlank")a[0]==="enter"&&(s&&(h.get(s)[1].type="lineEndingBlank"),a[1].type="lineEnding",s=r);else if(!(a[1].type==="linePrefix"||a[1].type==="listItemIndent"))break;s&&(i[1].end={...h.get(s)[1].start},o=h.slice(s,n),o.unshift(i),h.splice(s,n-s+1,o))}}return Oi(e,0,Number.POSITIVE_INFINITY,h.slice(0)),!u}function wX(e,t){const n=e.get(t)[1],i=e.get(t)[2];let s=t-1;const r=[];let a=n._tokenizer;a||(a=i.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(a._contentTypeTextTrailing=!0));const o=a.events,l=[],u={};let h,f,m=-1,g=n,C=0,S=0;const v=[S];for(;g;){for(;e.get(++s)[1]!==g;);r.push(s),g._tokenizer||(h=i.sliceStream(g),g.next||h.push(null),f&&a.defineSkip(g.start),g._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(h),g._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),f=g,g=g.next}for(g=n;++m<o.length;)o[m][0]==="exit"&&o[m-1][0]==="enter"&&o[m][1].type===o[m-1][1].type&&o[m][1].start.line!==o[m][1].end.line&&(S=m+1,v.push(S),g._tokenizer=void 0,g.previous=void 0,g=g.next);for(a.events=[],g?(g._tokenizer=void 0,g.previous=void 0):v.pop(),m=v.length;m--;){const _=o.slice(v[m],v[m+1]),w=r.pop();l.push([w,w+_.length-1]),e.splice(w,2,_)}for(l.reverse(),m=-1;++m<l.length;)u[C+l[m][0]]=C+l[m][1],C+=l[m][1]-l[m][0]-1;return u}const kX={resolve:EX,tokenize:RX},TX={partial:!0,tokenize:AX};function EX(e){return IN(e),e}function RX(e,t){let n;return i;function i(o){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),s(o)}function s(o){return o===null?r(o):$e(o)?e.check(TX,a,r)(o):(e.consume(o),s)}function r(o){return e.exit("chunkContent"),e.exit("content"),t(o)}function a(o){return e.consume(o),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function AX(e,t,n){const i=this;return s;function s(a){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),vt(e,r,"linePrefix")}function r(a){if(a===null||$e(a))return n(a);const o=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?t(a):e.interrupt(i.parser.constructs.flow,n,t)(a)}}function PN(e,t,n,i,s,r,a,o,l){const u=l||Number.POSITIVE_INFINITY;let h=0;return f;function f(_){return _===60?(e.enter(i),e.enter(s),e.enter(r),e.consume(_),e.exit(r),m):_===null||_===32||_===41||Sm(_)?n(_):(e.enter(i),e.enter(a),e.enter(o),e.enter("chunkString",{contentType:"string"}),S(_))}function m(_){return _===62?(e.enter(r),e.consume(_),e.exit(r),e.exit(s),e.exit(i),t):(e.enter(o),e.enter("chunkString",{contentType:"string"}),g(_))}function g(_){return _===62?(e.exit("chunkString"),e.exit(o),m(_)):_===null||_===60||$e(_)?n(_):(e.consume(_),_===92?C:g)}function C(_){return _===60||_===62||_===92?(e.consume(_),g):g(_)}function S(_){return!h&&(_===null||_===41||Ut(_))?(e.exit("chunkString"),e.exit(o),e.exit(a),e.exit(i),t(_)):h<u&&_===40?(e.consume(_),h++,S):_===41?(e.consume(_),h--,S):_===null||_===32||_===40||Sm(_)?n(_):(e.consume(_),_===92?v:S)}function v(_){return _===40||_===41||_===92?(e.consume(_),S):S(_)}}function DN(e,t,n,i,s,r){const a=this;let o=0,l;return u;function u(g){return e.enter(i),e.enter(s),e.consume(g),e.exit(s),e.enter(r),h}function h(g){return o>999||g===null||g===91||g===93&&!l||g===94&&!o&&"_hiddenFootnoteSupport"in a.parser.constructs?n(g):g===93?(e.exit(r),e.enter(s),e.consume(g),e.exit(s),e.exit(i),t):$e(g)?(e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),h):(e.enter("chunkString",{contentType:"string"}),f(g))}function f(g){return g===null||g===91||g===93||$e(g)||o++>999?(e.exit("chunkString"),h(g)):(e.consume(g),l||(l=!ht(g)),g===92?m:f)}function m(g){return g===91||g===92||g===93?(e.consume(g),o++,f):f(g)}}function ON(e,t,n,i,s,r){let a;return o;function o(m){return m===34||m===39||m===40?(e.enter(i),e.enter(s),e.consume(m),e.exit(s),a=m===40?41:m,l):n(m)}function l(m){return m===a?(e.enter(s),e.consume(m),e.exit(s),e.exit(i),t):(e.enter(r),u(m))}function u(m){return m===a?(e.exit(r),l(a)):m===null?n(m):$e(m)?(e.enter("lineEnding"),e.consume(m),e.exit("lineEnding"),vt(e,u,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),h(m))}function h(m){return m===a||m===null||$e(m)?(e.exit("chunkString"),u(m)):(e.consume(m),m===92?f:h)}function f(m){return m===a||m===92?(e.consume(m),h):h(m)}}function vd(e,t){let n;return i;function i(s){return $e(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),n=!0,i):ht(s)?vt(e,i,n?"linePrefix":"lineSuffix")(s):t(s)}}const MX={name:"definition",tokenize:IX},LX={partial:!0,tokenize:PX};function IX(e,t,n){const i=this;let s;return r;function r(g){return e.enter("definition"),a(g)}function a(g){return DN.call(i,e,o,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(g)}function o(g){return s=Cs(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),g===58?(e.enter("definitionMarker"),e.consume(g),e.exit("definitionMarker"),l):n(g)}function l(g){return Ut(g)?vd(e,u)(g):u(g)}function u(g){return PN(e,h,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(g)}function h(g){return e.attempt(LX,f,f)(g)}function f(g){return ht(g)?vt(e,m,"whitespace")(g):m(g)}function m(g){return g===null||$e(g)?(e.exit("definition"),i.parser.defined.push(s),t(g)):n(g)}}function PX(e,t,n){return i;function i(o){return Ut(o)?vd(e,s)(o):n(o)}function s(o){return ON(e,r,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function r(o){return ht(o)?vt(e,a,"whitespace")(o):a(o)}function a(o){return o===null||$e(o)?t(o):n(o)}}const DX={name:"hardBreakEscape",tokenize:OX};function OX(e,t,n){return i;function i(r){return e.enter("hardBreakEscape"),e.consume(r),s}function s(r){return $e(r)?(e.exit("hardBreakEscape"),t(r)):n(r)}}const NX={name:"headingAtx",resolve:jX,tokenize:BX};function jX(e,t){let n=e.length-2,i=3,s,r;return e[i][1].type==="whitespace"&&(i+=2),n-2>i&&e[n][1].type==="whitespace"&&(n-=2),e[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&e[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(s={type:"atxHeadingText",start:e[i][1].start,end:e[n][1].end},r={type:"chunkText",start:e[i][1].start,end:e[n][1].end,contentType:"text"},Oi(e,i,n-i+1,[["enter",s,t],["enter",r,t],["exit",r,t],["exit",s,t]])),e}function BX(e,t,n){let i=0;return s;function s(h){return e.enter("atxHeading"),r(h)}function r(h){return e.enter("atxHeadingSequence"),a(h)}function a(h){return h===35&&i++<6?(e.consume(h),a):h===null||Ut(h)?(e.exit("atxHeadingSequence"),o(h)):n(h)}function o(h){return h===35?(e.enter("atxHeadingSequence"),l(h)):h===null||$e(h)?(e.exit("atxHeading"),t(h)):ht(h)?vt(e,o,"whitespace")(h):(e.enter("atxHeadingText"),u(h))}function l(h){return h===35?(e.consume(h),l):(e.exit("atxHeadingSequence"),o(h))}function u(h){return h===null||h===35||Ut(h)?(e.exit("atxHeadingText"),o(h)):(e.consume(h),u)}}const FX=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],KA=["pre","script","style","textarea"],UX={concrete:!0,name:"htmlFlow",resolveTo:$X,tokenize:qX},zX={partial:!0,tokenize:WX},HX={partial:!0,tokenize:VX};function $X(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function qX(e,t,n){const i=this;let s,r,a,o,l;return u;function u(H){return h(H)}function h(H){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(H),f}function f(H){return H===33?(e.consume(H),m):H===47?(e.consume(H),r=!0,S):H===63?(e.consume(H),s=3,i.interrupt?t:N):ti(H)?(e.consume(H),a=String.fromCharCode(H),v):n(H)}function m(H){return H===45?(e.consume(H),s=2,g):H===91?(e.consume(H),s=5,o=0,C):ti(H)?(e.consume(H),s=4,i.interrupt?t:N):n(H)}function g(H){return H===45?(e.consume(H),i.interrupt?t:N):n(H)}function C(H){const ee="CDATA[";return H===ee.charCodeAt(o++)?(e.consume(H),o===ee.length?i.interrupt?t:j:C):n(H)}function S(H){return ti(H)?(e.consume(H),a=String.fromCharCode(H),v):n(H)}function v(H){if(H===null||H===47||H===62||Ut(H)){const ee=H===47,ue=a.toLowerCase();return!ee&&!r&&KA.includes(ue)?(s=1,i.interrupt?t(H):j(H)):FX.includes(a.toLowerCase())?(s=6,ee?(e.consume(H),_):i.interrupt?t(H):j(H)):(s=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(H):r?w(H):x(H))}return H===45||Hn(H)?(e.consume(H),a+=String.fromCharCode(H),v):n(H)}function _(H){return H===62?(e.consume(H),i.interrupt?t:j):n(H)}function w(H){return ht(H)?(e.consume(H),w):D(H)}function x(H){return H===47?(e.consume(H),D):H===58||H===95||ti(H)?(e.consume(H),k):ht(H)?(e.consume(H),x):D(H)}function k(H){return H===45||H===46||H===58||H===95||Hn(H)?(e.consume(H),k):A(H)}function A(H){return H===61?(e.consume(H),T):ht(H)?(e.consume(H),A):x(H)}function T(H){return H===null||H===60||H===61||H===62||H===96?n(H):H===34||H===39?(e.consume(H),l=H,M):ht(H)?(e.consume(H),T):E(H)}function M(H){return H===l?(e.consume(H),l=null,L):H===null||$e(H)?n(H):(e.consume(H),M)}function E(H){return H===null||H===34||H===39||H===47||H===60||H===61||H===62||H===96||Ut(H)?A(H):(e.consume(H),E)}function L(H){return H===47||H===62||ht(H)?x(H):n(H)}function D(H){return H===62?(e.consume(H),O):n(H)}function O(H){return H===null||$e(H)?j(H):ht(H)?(e.consume(H),O):n(H)}function j(H){return H===45&&s===2?(e.consume(H),$):H===60&&s===1?(e.consume(H),Y):H===62&&s===4?(e.consume(H),z):H===63&&s===3?(e.consume(H),N):H===93&&s===5?(e.consume(H),F):$e(H)&&(s===6||s===7)?(e.exit("htmlFlowData"),e.check(zX,G,U)(H)):H===null||$e(H)?(e.exit("htmlFlowData"),U(H)):(e.consume(H),j)}function U(H){return e.check(HX,q,G)(H)}function q(H){return e.enter("lineEnding"),e.consume(H),e.exit("lineEnding"),K}function K(H){return H===null||$e(H)?U(H):(e.enter("htmlFlowData"),j(H))}function $(H){return H===45?(e.consume(H),N):j(H)}function Y(H){return H===47?(e.consume(H),a="",Q):j(H)}function Q(H){if(H===62){const ee=a.toLowerCase();return KA.includes(ee)?(e.consume(H),z):j(H)}return ti(H)&&a.length<8?(e.consume(H),a+=String.fromCharCode(H),Q):j(H)}function F(H){return H===93?(e.consume(H),N):j(H)}function N(H){return H===62?(e.consume(H),z):H===45&&s===2?(e.consume(H),N):j(H)}function z(H){return H===null||$e(H)?(e.exit("htmlFlowData"),G(H)):(e.consume(H),z)}function G(H){return e.exit("htmlFlow"),t(H)}}function VX(e,t,n){const i=this;return s;function s(a){return $e(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),r):n(a)}function r(a){return i.parser.lazy[i.now().line]?n(a):t(a)}}function WX(e,t,n){return i;function i(s){return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),e.attempt(uh,t,n)}}const GX={name:"htmlText",tokenize:KX};function KX(e,t,n){const i=this;let s,r,a;return o;function o(N){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(N),l}function l(N){return N===33?(e.consume(N),u):N===47?(e.consume(N),A):N===63?(e.consume(N),x):ti(N)?(e.consume(N),E):n(N)}function u(N){return N===45?(e.consume(N),h):N===91?(e.consume(N),r=0,C):ti(N)?(e.consume(N),w):n(N)}function h(N){return N===45?(e.consume(N),g):n(N)}function f(N){return N===null?n(N):N===45?(e.consume(N),m):$e(N)?(a=f,Y(N)):(e.consume(N),f)}function m(N){return N===45?(e.consume(N),g):f(N)}function g(N){return N===62?$(N):N===45?m(N):f(N)}function C(N){const z="CDATA[";return N===z.charCodeAt(r++)?(e.consume(N),r===z.length?S:C):n(N)}function S(N){return N===null?n(N):N===93?(e.consume(N),v):$e(N)?(a=S,Y(N)):(e.consume(N),S)}function v(N){return N===93?(e.consume(N),_):S(N)}function _(N){return N===62?$(N):N===93?(e.consume(N),_):S(N)}function w(N){return N===null||N===62?$(N):$e(N)?(a=w,Y(N)):(e.consume(N),w)}function x(N){return N===null?n(N):N===63?(e.consume(N),k):$e(N)?(a=x,Y(N)):(e.consume(N),x)}function k(N){return N===62?$(N):x(N)}function A(N){return ti(N)?(e.consume(N),T):n(N)}function T(N){return N===45||Hn(N)?(e.consume(N),T):M(N)}function M(N){return $e(N)?(a=M,Y(N)):ht(N)?(e.consume(N),M):$(N)}function E(N){return N===45||Hn(N)?(e.consume(N),E):N===47||N===62||Ut(N)?L(N):n(N)}function L(N){return N===47?(e.consume(N),$):N===58||N===95||ti(N)?(e.consume(N),D):$e(N)?(a=L,Y(N)):ht(N)?(e.consume(N),L):$(N)}function D(N){return N===45||N===46||N===58||N===95||Hn(N)?(e.consume(N),D):O(N)}function O(N){return N===61?(e.consume(N),j):$e(N)?(a=O,Y(N)):ht(N)?(e.consume(N),O):L(N)}function j(N){return N===null||N===60||N===61||N===62||N===96?n(N):N===34||N===39?(e.consume(N),s=N,U):$e(N)?(a=j,Y(N)):ht(N)?(e.consume(N),j):(e.consume(N),q)}function U(N){return N===s?(e.consume(N),s=void 0,K):N===null?n(N):$e(N)?(a=U,Y(N)):(e.consume(N),U)}function q(N){return N===null||N===34||N===39||N===60||N===61||N===96?n(N):N===47||N===62||Ut(N)?L(N):(e.consume(N),q)}function K(N){return N===47||N===62||Ut(N)?L(N):n(N)}function $(N){return N===62?(e.consume(N),e.exit("htmlTextData"),e.exit("htmlText"),t):n(N)}function Y(N){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(N),e.exit("lineEnding"),Q}function Q(N){return ht(N)?vt(e,F,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(N):F(N)}function F(N){return e.enter("htmlTextData"),a(N)}}const DC={name:"labelEnd",resolveAll:XX,resolveTo:ZX,tokenize:eZ},YX={tokenize:tZ},QX={tokenize:nZ},JX={tokenize:iZ};function XX(e){let t=-1;const n=[];for(;++t<e.length;){const i=e[t][1];if(n.push(e[t]),i.type==="labelImage"||i.type==="labelLink"||i.type==="labelEnd"){const s=i.type==="labelImage"?4:2;i.type="data",t+=s}}return e.length!==n.length&&Oi(e,0,e.length,n),e}function ZX(e,t){let n=e.length,i=0,s,r,a,o;for(;n--;)if(s=e[n][1],r){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;e[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(a){if(e[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(r=n,s.type!=="labelLink")){i=2;break}}else s.type==="labelEnd"&&(a=n);const l={type:e[r][1].type==="labelLink"?"link":"image",start:{...e[r][1].start},end:{...e[e.length-1][1].end}},u={type:"label",start:{...e[r][1].start},end:{...e[a][1].end}},h={type:"labelText",start:{...e[r+i+2][1].end},end:{...e[a-2][1].start}};return o=[["enter",l,t],["enter",u,t]],o=Ji(o,e.slice(r+1,r+i+3)),o=Ji(o,[["enter",h,t]]),o=Ji(o,pg(t.parser.constructs.insideSpan.null,e.slice(r+i+4,a-3),t)),o=Ji(o,[["exit",h,t],e[a-2],e[a-1],["exit",u,t]]),o=Ji(o,e.slice(a+1)),o=Ji(o,[["exit",l,t]]),Oi(e,r,e.length,o),e}function eZ(e,t,n){const i=this;let s=i.events.length,r,a;for(;s--;)if((i.events[s][1].type==="labelImage"||i.events[s][1].type==="labelLink")&&!i.events[s][1]._balanced){r=i.events[s][1];break}return o;function o(m){return r?r._inactive?f(m):(a=i.parser.defined.includes(Cs(i.sliceSerialize({start:r.end,end:i.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(m),e.exit("labelMarker"),e.exit("labelEnd"),l):n(m)}function l(m){return m===40?e.attempt(YX,h,a?h:f)(m):m===91?e.attempt(QX,h,a?u:f)(m):a?h(m):f(m)}function u(m){return e.attempt(JX,h,f)(m)}function h(m){return t(m)}function f(m){return r._balanced=!0,n(m)}}function tZ(e,t,n){return i;function i(f){return e.enter("resource"),e.enter("resourceMarker"),e.consume(f),e.exit("resourceMarker"),s}function s(f){return Ut(f)?vd(e,r)(f):r(f)}function r(f){return f===41?h(f):PN(e,a,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(f)}function a(f){return Ut(f)?vd(e,l)(f):h(f)}function o(f){return n(f)}function l(f){return f===34||f===39||f===40?ON(e,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(f):h(f)}function u(f){return Ut(f)?vd(e,h)(f):h(f)}function h(f){return f===41?(e.enter("resourceMarker"),e.consume(f),e.exit("resourceMarker"),e.exit("resource"),t):n(f)}}function nZ(e,t,n){const i=this;return s;function s(o){return DN.call(i,e,r,a,"reference","referenceMarker","referenceString")(o)}function r(o){return i.parser.defined.includes(Cs(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?t(o):n(o)}function a(o){return n(o)}}function iZ(e,t,n){return i;function i(r){return e.enter("reference"),e.enter("referenceMarker"),e.consume(r),e.exit("referenceMarker"),s}function s(r){return r===93?(e.enter("referenceMarker"),e.consume(r),e.exit("referenceMarker"),e.exit("reference"),t):n(r)}}const sZ={name:"labelStartImage",resolveAll:DC.resolveAll,tokenize:rZ};function rZ(e,t,n){const i=this;return s;function s(o){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(o),e.exit("labelImageMarker"),r}function r(o){return o===91?(e.enter("labelMarker"),e.consume(o),e.exit("labelMarker"),e.exit("labelImage"),a):n(o)}function a(o){return o===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(o):t(o)}}const oZ={name:"labelStartLink",resolveAll:DC.resolveAll,tokenize:aZ};function aZ(e,t,n){const i=this;return s;function s(a){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelLink"),r}function r(a){return a===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(a):t(a)}}const Jy={name:"lineEnding",tokenize:lZ};function lZ(e,t){return n;function n(i){return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),vt(e,t,"linePrefix")}}const Op={name:"thematicBreak",tokenize:cZ};function cZ(e,t,n){let i=0,s;return r;function r(u){return e.enter("thematicBreak"),a(u)}function a(u){return s=u,o(u)}function o(u){return u===s?(e.enter("thematicBreakSequence"),l(u)):i>=3&&(u===null||$e(u))?(e.exit("thematicBreak"),t(u)):n(u)}function l(u){return u===s?(e.consume(u),i++,l):(e.exit("thematicBreakSequence"),ht(u)?vt(e,o,"whitespace")(u):o(u))}}const hi={continuation:{tokenize:fZ},exit:mZ,name:"list",tokenize:hZ},uZ={partial:!0,tokenize:gZ},dZ={partial:!0,tokenize:pZ};function hZ(e,t,n){const i=this,s=i.events[i.events.length-1];let r=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,a=0;return o;function o(g){const C=i.containerState.type||(g===42||g===43||g===45?"listUnordered":"listOrdered");if(C==="listUnordered"?!i.containerState.marker||g===i.containerState.marker:O0(g)){if(i.containerState.type||(i.containerState.type=C,e.enter(C,{_container:!0})),C==="listUnordered")return e.enter("listItemPrefix"),g===42||g===45?e.check(Op,n,u)(g):u(g);if(!i.interrupt||g===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),l(g)}return n(g)}function l(g){return O0(g)&&++a<10?(e.consume(g),l):(!i.interrupt||a<2)&&(i.containerState.marker?g===i.containerState.marker:g===41||g===46)?(e.exit("listItemValue"),u(g)):n(g)}function u(g){return e.enter("listItemMarker"),e.consume(g),e.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||g,e.check(uh,i.interrupt?n:h,e.attempt(uZ,m,f))}function h(g){return i.containerState.initialBlankLine=!0,r++,m(g)}function f(g){return ht(g)?(e.enter("listItemPrefixWhitespace"),e.consume(g),e.exit("listItemPrefixWhitespace"),m):n(g)}function m(g){return i.containerState.size=r+i.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(g)}}function fZ(e,t,n){const i=this;return i.containerState._closeFlow=void 0,e.check(uh,s,r);function s(o){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,vt(e,t,"listItemIndent",i.containerState.size+1)(o)}function r(o){return i.containerState.furtherBlankLines||!ht(o)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,a(o)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,e.attempt(dZ,t,a)(o))}function a(o){return i.containerState._closeFlow=!0,i.interrupt=void 0,vt(e,e.attempt(hi,t,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function pZ(e,t,n){const i=this;return vt(e,s,"listItemIndent",i.containerState.size+1);function s(r){const a=i.events[i.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===i.containerState.size?t(r):n(r)}}function mZ(e){e.exit(this.containerState.type)}function gZ(e,t,n){const i=this;return vt(e,s,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function s(r){const a=i.events[i.events.length-1];return!ht(r)&&a&&a[1].type==="listItemPrefixWhitespace"?t(r):n(r)}}const YA={name:"setextUnderline",resolveTo:vZ,tokenize:bZ};function vZ(e,t){let n=e.length,i,s,r;for(;n--;)if(e[n][0]==="enter"){if(e[n][1].type==="content"){i=n;break}e[n][1].type==="paragraph"&&(s=n)}else e[n][1].type==="content"&&e.splice(n,1),!r&&e[n][1].type==="definition"&&(r=n);const a={type:"setextHeading",start:{...e[i][1].start},end:{...e[e.length-1][1].end}};return e[s][1].type="setextHeadingText",r?(e.splice(s,0,["enter",a,t]),e.splice(r+1,0,["exit",e[i][1],t]),e[i][1].end={...e[r][1].end}):e[i][1]=a,e.push(["exit",a,t]),e}function bZ(e,t,n){const i=this;let s;return r;function r(u){let h=i.events.length,f;for(;h--;)if(i.events[h][1].type!=="lineEnding"&&i.events[h][1].type!=="linePrefix"&&i.events[h][1].type!=="content"){f=i.events[h][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||f)?(e.enter("setextHeadingLine"),s=u,a(u)):n(u)}function a(u){return e.enter("setextHeadingLineSequence"),o(u)}function o(u){return u===s?(e.consume(u),o):(e.exit("setextHeadingLineSequence"),ht(u)?vt(e,l,"lineSuffix")(u):l(u))}function l(u){return u===null||$e(u)?(e.exit("setextHeadingLine"),t(u)):n(u)}}const yZ={tokenize:_Z};function _Z(e){const t=this,n=e.attempt(uh,i,e.attempt(this.parser.constructs.flowInitial,s,vt(e,e.attempt(this.parser.constructs.flow,s,e.attempt(kX,s)),"linePrefix")));return n;function i(r){if(r===null){e.consume(r);return}return e.enter("lineEndingBlank"),e.consume(r),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n}function s(r){if(r===null){e.consume(r);return}return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),t.currentConstruct=void 0,n}}const SZ={resolveAll:jN()},CZ=NN("string"),xZ=NN("text");function NN(e){return{resolveAll:jN(e==="text"?wZ:void 0),tokenize:t};function t(n){const i=this,s=this.parser.constructs[e],r=n.attempt(s,a,o);return a;function a(h){return u(h)?r(h):o(h)}function o(h){if(h===null){n.consume(h);return}return n.enter("data"),n.consume(h),l}function l(h){return u(h)?(n.exit("data"),r(h)):(n.consume(h),l)}function u(h){if(h===null)return!0;const f=s[h];let m=-1;if(f)for(;++m<f.length;){const g=f[m];if(!g.previous||g.previous.call(i,i.previous))return!0}return!1}}}function jN(e){return t;function t(n,i){let s=-1,r;for(;++s<=n.length;)r===void 0?n[s]&&n[s][1].type==="data"&&(r=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==r+2&&(n[r][1].end=n[s-1][1].end,n.splice(r+2,s-r-2),s=r+2),r=void 0);return e?e(n,i):n}}function wZ(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type==="lineEnding")&&e[n-1][1].type==="data"){const i=e[n-1][1],s=t.sliceStream(i);let r=s.length,a=-1,o=0,l;for(;r--;){const u=s[r];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===32;)o++,a--;if(a)break;a=-1}else if(u===-2)l=!0,o++;else if(u!==-1){r++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(o=0),o){const u={type:n===e.length||l||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:r?a:i.start._bufferIndex+a,_index:i.start._index+r,line:i.end.line,column:i.end.column-o,offset:i.end.offset-o},end:{...i.end}};i.end={...u.start},i.start.offset===i.end.offset?Object.assign(i,u):(e.splice(n,0,["enter",u,t],["exit",u,t]),n+=2)}n++}return e}const kZ={42:hi,43:hi,45:hi,48:hi,49:hi,50:hi,51:hi,52:hi,53:hi,54:hi,55:hi,56:hi,57:hi,62:AN},TZ={91:MX},EZ={[-2]:Qy,[-1]:Qy,32:Qy},RZ={35:NX,42:Op,45:[YA,Op],60:UX,61:YA,95:Op,96:GA,126:GA},AZ={38:LN,92:MN},MZ={[-5]:Jy,[-4]:Jy,[-3]:Jy,33:sZ,38:LN,42:N0,60:[oX,GX],91:oZ,92:[DX,MN],93:DC,95:N0,96:yX},LZ={null:[N0,SZ]},IZ={null:[42,95]},PZ={null:[]},DZ=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:IZ,contentInitial:TZ,disable:PZ,document:kZ,flow:RZ,flowInitial:EZ,insideSpan:LZ,string:AZ,text:MZ},Symbol.toStringTag,{value:"Module"}));function OZ(e,t,n){let i={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},r=[];let a=[],o=[];const l={attempt:M(A),check:M(T),consume:w,enter:x,exit:k,interrupt:M(T,{interrupt:!0})},u={code:null,containerState:{},defineSkip:S,events:[],now:C,parser:e,previous:null,sliceSerialize:m,sliceStream:g,write:f};let h=t.tokenize.call(u,l);return t.resolveAll&&r.push(t),u;function f(O){return a=Ji(a,O),v(),a[a.length-1]!==null?[]:(E(t,0),u.events=pg(r,u.events,u),u.events)}function m(O,j){return jZ(g(O),j)}function g(O){return NZ(a,O)}function C(){const{_bufferIndex:O,_index:j,line:U,column:q,offset:K}=i;return{_bufferIndex:O,_index:j,line:U,column:q,offset:K}}function S(O){s[O.line]=O.column,D()}function v(){let O;for(;i._index<a.length;){const j=a[i._index];if(typeof j=="string")for(O=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===O&&i._bufferIndex<j.length;)_(j.charCodeAt(i._bufferIndex));else _(j)}}function _(O){h=h(O)}function w(O){$e(O)?(i.line++,i.column=1,i.offset+=O===-3?2:1,D()):O!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===a[i._index].length&&(i._bufferIndex=-1,i._index++)),u.previous=O}function x(O,j){const U=j||{};return U.type=O,U.start=C(),u.events.push(["enter",U,u]),o.push(U),U}function k(O){const j=o.pop();return j.end=C(),u.events.push(["exit",j,u]),j}function A(O,j){E(O,j.from)}function T(O,j){j.restore()}function M(O,j){return U;function U(q,K,$){let Y,Q,F,N;return Array.isArray(q)?G(q):"tokenize"in q?G([q]):z(q);function z(ce){return J;function J(V){const ne=V!==null&&ce[V],he=V!==null&&ce.null,_e=[...Array.isArray(ne)?ne:ne?[ne]:[],...Array.isArray(he)?he:he?[he]:[]];return G(_e)(V)}}function G(ce){return Y=ce,Q=0,ce.length===0?$:H(ce[Q])}function H(ce){return J;function J(V){return N=L(),F=ce,ce.partial||(u.currentConstruct=ce),ce.name&&u.parser.constructs.disable.null.includes(ce.name)?ue():ce.tokenize.call(j?Object.assign(Object.create(u),j):u,l,ee,ue)(V)}}function ee(ce){return O(F,N),K}function ue(ce){return N.restore(),++Q<Y.length?H(Y[Q]):$}}}function E(O,j){O.resolveAll&&!r.includes(O)&&r.push(O),O.resolve&&Oi(u.events,j,u.events.length-j,O.resolve(u.events.slice(j),u)),O.resolveTo&&(u.events=O.resolveTo(u.events,u))}function L(){const O=C(),j=u.previous,U=u.currentConstruct,q=u.events.length,K=Array.from(o);return{from:q,restore:$};function $(){i=O,u.previous=j,u.currentConstruct=U,u.events.length=q,o=K,D()}}function D(){i.line in s&&i.column<2&&(i.column=s[i.line],i.offset+=s[i.line]-1)}}function NZ(e,t){const n=t.start._index,i=t.start._bufferIndex,s=t.end._index,r=t.end._bufferIndex;let a;if(n===s)a=[e[n].slice(i,r)];else{if(a=e.slice(n,s),i>-1){const o=a[0];typeof o=="string"?a[0]=o.slice(i):a.shift()}r>0&&a.push(e[s].slice(0,r))}return a}function jZ(e,t){let n=-1;const i=[];let s;for(;++n<e.length;){const r=e[n];let a;if(typeof r=="string")a=r;else switch(r){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=t?" ":"	";break}case-1:{if(!t&&s)continue;a=" ";break}default:a=String.fromCharCode(r)}s=r===-2,i.push(a)}return i.join("")}function BZ(e){const i={constructs:EN([DZ,...(e||{}).extensions||[]]),content:s(ZJ),defined:[],document:s(tX),flow:s(yZ),lazy:{},string:s(CZ),text:s(xZ)};return i;function s(r){return a;function a(o){return OZ(i,r,o)}}}function FZ(e){for(;!IN(e););return e}const QA=/[\0\t\n\r]/g;function UZ(){let e=1,t="",n=!0,i;return s;function s(r,a,o){const l=[];let u,h,f,m,g;for(r=t+(typeof r=="string"?r.toString():new TextDecoder(a||void 0).decode(r)),f=0,t="",n&&(r.charCodeAt(0)===65279&&f++,n=void 0);f<r.length;){if(QA.lastIndex=f,u=QA.exec(r),m=u&&u.index!==void 0?u.index:r.length,g=r.charCodeAt(m),!u){t=r.slice(f);break}if(g===10&&f===m&&i)l.push(-3),i=void 0;else switch(i&&(l.push(-5),i=void 0),f<m&&(l.push(r.slice(f,m)),e+=m-f),g){case 0:{l.push(65533),e++;break}case 9:{for(h=Math.ceil(e/4)*4,l.push(-2);e++<h;)l.push(-1);break}case 10:{l.push(-4),e=1;break}default:i=!0,e=1}f=m+1}return o&&(i&&l.push(-5),t&&l.push(t),l.push(null)),l}}const zZ=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function HZ(e){return e.replace(zZ,$Z)}function $Z(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),r=s===120||s===88;return RN(n.slice(r?2:1),r?16:10)}return PC(n)||e}const BN={}.hasOwnProperty;function qZ(e,t,n){return t&&typeof t=="object"&&(n=t,t=void 0),VZ(n)(FZ(BZ(n).document().write(UZ()(e,t,!0))))}function VZ(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:r(Nt),autolinkProtocol:L,autolinkEmail:L,atxHeading:r(qe),blockQuote:r(he),characterEscape:L,characterReference:L,codeFenced:r(_e),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:r(_e,a),codeText:r(Ce,a),codeTextData:L,data:L,codeFlowValue:L,definition:r(we),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:r(Ee),hardBreakEscape:r(yt),hardBreakTrailing:r(yt),htmlFlow:r(Pe,a),htmlFlowData:L,htmlText:r(Pe,a),htmlTextData:L,image:r(Ot),label:a,link:r(Nt),listItem:r(Ge),listItemValue:m,listOrdered:r(Qe,f),listUnordered:r(Qe),paragraph:r(Ke),reference:H,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:r(qe),strong:r(Te),thematicBreak:r(_t)},exit:{atxHeading:l(),atxHeadingSequence:A,autolink:l(),autolinkEmail:ne,autolinkProtocol:V,blockQuote:l(),characterEscapeValue:D,characterReferenceMarkerHexadecimal:ue,characterReferenceMarkerNumeric:ue,characterReferenceValue:ce,characterReference:J,codeFenced:l(v),codeFencedFence:S,codeFencedFenceInfo:g,codeFencedFenceMeta:C,codeFlowValue:D,codeIndented:l(_),codeText:l(K),codeTextData:D,data:D,definition:l(),definitionDestinationString:k,definitionLabelString:w,definitionTitleString:x,emphasis:l(),hardBreakEscape:l(j),hardBreakTrailing:l(j),htmlFlow:l(U),htmlFlowData:D,htmlText:l(q),htmlTextData:D,image:l(Y),label:F,labelText:Q,lineEnding:O,link:l($),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:ee,resourceDestinationString:N,resourceTitleString:z,resource:G,setextHeading:l(E),setextHeadingLineSequence:M,setextHeadingText:T,strong:l(),thematicBreak:l()}};FN(t,(e||{}).mdastExtensions||[]);const n={};return i;function i(se){let ge={type:"root",children:[]};const Me={stack:[ge],tokenStack:[],config:t,enter:o,exit:u,buffer:a,resume:h,data:n},je=[];let ze=-1;for(;++ze<se.length;)if(se[ze][1].type==="listOrdered"||se[ze][1].type==="listUnordered")if(se[ze][0]==="enter")je.push(ze);else{const Ye=je.pop();ze=s(se,Ye,ze)}for(ze=-1;++ze<se.length;){const Ye=t[se[ze][0]];BN.call(Ye,se[ze][1].type)&&Ye[se[ze][1].type].call(Object.assign({sliceSerialize:se[ze][2].sliceSerialize},Me),se[ze][1])}if(Me.tokenStack.length>0){const Ye=Me.tokenStack[Me.tokenStack.length-1];(Ye[1]||JA).call(Me,void 0,Ye[0])}for(ge.position={start:vo(se.length>0?se[0][1].start:{line:1,column:1,offset:0}),end:vo(se.length>0?se[se.length-2][1].end:{line:1,column:1,offset:0})},ze=-1;++ze<t.transforms.length;)ge=t.transforms[ze](ge)||ge;return ge}function s(se,ge,Me){let je=ge-1,ze=-1,Ye=!1,He,Yt,zt,sn;for(;++je<=Me;){const St=se[je];switch(St[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{St[0]==="enter"?ze++:ze--,sn=void 0;break}case"lineEndingBlank":{St[0]==="enter"&&(He&&!sn&&!ze&&!zt&&(zt=je),sn=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:sn=void 0}if(!ze&&St[0]==="enter"&&St[1].type==="listItemPrefix"||ze===-1&&St[0]==="exit"&&(St[1].type==="listUnordered"||St[1].type==="listOrdered")){if(He){let Wn=je;for(Yt=void 0;Wn--;){const Gn=se[Wn];if(Gn[1].type==="lineEnding"||Gn[1].type==="lineEndingBlank"){if(Gn[0]==="exit")continue;Yt&&(se[Yt][1].type="lineEndingBlank",Ye=!0),Gn[1].type="lineEnding",Yt=Wn}else if(!(Gn[1].type==="linePrefix"||Gn[1].type==="blockQuotePrefix"||Gn[1].type==="blockQuotePrefixWhitespace"||Gn[1].type==="blockQuoteMarker"||Gn[1].type==="listItemIndent"))break}zt&&(!Yt||zt<Yt)&&(He._spread=!0),He.end=Object.assign({},Yt?se[Yt][1].start:St[1].end),se.splice(Yt||je,0,["exit",He,St[2]]),je++,Me++}if(St[1].type==="listItemPrefix"){const Wn={type:"listItem",_spread:!1,start:Object.assign({},St[1].start),end:void 0};He=Wn,se.splice(je,0,["enter",Wn,St[2]]),je++,Me++,zt=void 0,sn=!0}}}return se[ge][1]._spread=Ye,Me}function r(se,ge){return Me;function Me(je){o.call(this,se(je),je),ge&&ge.call(this,je)}}function a(){this.stack.push({type:"fragment",children:[]})}function o(se,ge,Me){this.stack[this.stack.length-1].children.push(se),this.stack.push(se),this.tokenStack.push([ge,Me||void 0]),se.position={start:vo(ge.start),end:void 0}}function l(se){return ge;function ge(Me){se&&se.call(this,Me),u.call(this,Me)}}function u(se,ge){const Me=this.stack.pop(),je=this.tokenStack.pop();if(je)je[0].type!==se.type&&(ge?ge.call(this,se,je[0]):(je[1]||JA).call(this,se,je[0]));else throw new Error("Cannot close `"+se.type+"` ("+gd({start:se.start,end:se.end})+"): its not open");Me.position.end=vo(se.end)}function h(){return IC(this.stack.pop())}function f(){this.data.expectingFirstListItemValue=!0}function m(se){if(this.data.expectingFirstListItemValue){const ge=this.stack[this.stack.length-2];ge.start=Number.parseInt(this.sliceSerialize(se),10),this.data.expectingFirstListItemValue=void 0}}function g(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.lang=se}function C(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.meta=se}function S(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function v(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.value=se.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function _(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.value=se.replace(/(\r?\n|\r)$/g,"")}function w(se){const ge=this.resume(),Me=this.stack[this.stack.length-1];Me.label=ge,Me.identifier=Cs(this.sliceSerialize(se)).toLowerCase()}function x(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.title=se}function k(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.url=se}function A(se){const ge=this.stack[this.stack.length-1];if(!ge.depth){const Me=this.sliceSerialize(se).length;ge.depth=Me}}function T(){this.data.setextHeadingSlurpLineEnding=!0}function M(se){const ge=this.stack[this.stack.length-1];ge.depth=this.sliceSerialize(se).codePointAt(0)===61?1:2}function E(){this.data.setextHeadingSlurpLineEnding=void 0}function L(se){const Me=this.stack[this.stack.length-1].children;let je=Me[Me.length-1];(!je||je.type!=="text")&&(je=Fe(),je.position={start:vo(se.start),end:void 0},Me.push(je)),this.stack.push(je)}function D(se){const ge=this.stack.pop();ge.value+=this.sliceSerialize(se),ge.position.end=vo(se.end)}function O(se){const ge=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Me=ge.children[ge.children.length-1];Me.position.end=vo(se.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(ge.type)&&(L.call(this,se),D.call(this,se))}function j(){this.data.atHardBreak=!0}function U(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.value=se}function q(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.value=se}function K(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.value=se}function $(){const se=this.stack[this.stack.length-1];if(this.data.inReference){const ge=this.data.referenceType||"shortcut";se.type+="Reference",se.referenceType=ge,delete se.url,delete se.title}else delete se.identifier,delete se.label;this.data.referenceType=void 0}function Y(){const se=this.stack[this.stack.length-1];if(this.data.inReference){const ge=this.data.referenceType||"shortcut";se.type+="Reference",se.referenceType=ge,delete se.url,delete se.title}else delete se.identifier,delete se.label;this.data.referenceType=void 0}function Q(se){const ge=this.sliceSerialize(se),Me=this.stack[this.stack.length-2];Me.label=HZ(ge),Me.identifier=Cs(ge).toLowerCase()}function F(){const se=this.stack[this.stack.length-1],ge=this.resume(),Me=this.stack[this.stack.length-1];if(this.data.inReference=!0,Me.type==="link"){const je=se.children;Me.children=je}else Me.alt=ge}function N(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.url=se}function z(){const se=this.resume(),ge=this.stack[this.stack.length-1];ge.title=se}function G(){this.data.inReference=void 0}function H(){this.data.referenceType="collapsed"}function ee(se){const ge=this.resume(),Me=this.stack[this.stack.length-1];Me.label=ge,Me.identifier=Cs(this.sliceSerialize(se)).toLowerCase(),this.data.referenceType="full"}function ue(se){this.data.characterReferenceType=se.type}function ce(se){const ge=this.sliceSerialize(se),Me=this.data.characterReferenceType;let je;Me?(je=RN(ge,Me==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):je=PC(ge);const ze=this.stack[this.stack.length-1];ze.value+=je}function J(se){const ge=this.stack.pop();ge.position.end=vo(se.end)}function V(se){D.call(this,se);const ge=this.stack[this.stack.length-1];ge.url=this.sliceSerialize(se)}function ne(se){D.call(this,se);const ge=this.stack[this.stack.length-1];ge.url="mailto:"+this.sliceSerialize(se)}function he(){return{type:"blockquote",children:[]}}function _e(){return{type:"code",lang:null,meta:null,value:""}}function Ce(){return{type:"inlineCode",value:""}}function we(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Ee(){return{type:"emphasis",children:[]}}function qe(){return{type:"heading",depth:0,children:[]}}function yt(){return{type:"break"}}function Pe(){return{type:"html",value:""}}function Ot(){return{type:"image",title:null,url:"",alt:null}}function Nt(){return{type:"link",title:null,url:"",children:[]}}function Qe(se){return{type:"list",ordered:se.type==="listOrdered",start:null,spread:se._spread,children:[]}}function Ge(se){return{type:"listItem",spread:se._spread,checked:null,children:[]}}function Ke(){return{type:"paragraph",children:[]}}function Te(){return{type:"strong",children:[]}}function Fe(){return{type:"text",value:""}}function _t(){return{type:"thematicBreak"}}}function vo(e){return{line:e.line,column:e.column,offset:e.offset}}function FN(e,t){let n=-1;for(;++n<t.length;){const i=t[n];Array.isArray(i)?FN(e,i):WZ(e,i)}}function WZ(e,t){let n;for(n in t)if(BN.call(t,n))switch(n){case"canContainEols":{const i=t[n];i&&e[n].push(...i);break}case"transforms":{const i=t[n];i&&e[n].push(...i);break}case"enter":case"exit":{const i=t[n];i&&Object.assign(e[n],i);break}}}function JA(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+gd({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+gd({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+gd({start:t.start,end:t.end})+") is still open")}function GZ(e){const t=this;t.parser=n;function n(i){return qZ(i,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function KZ(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)}function YZ(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:`
`}]}function QZ(e,t){const n=t.value?t.value+`
`:"",i={},s=t.lang?t.lang.split(/\s+/):[];s.length>0&&(i.className=["language-"+s[0]]);let r={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return t.meta&&(r.data={meta:t.meta}),e.patch(t,r),r=e.applyData(t,r),r={type:"element",tagName:"pre",properties:{},children:[r]},e.patch(t,r),r}function JZ(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function XZ(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function ZZ(e,t){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",i=String(t.identifier).toUpperCase(),s=jc(i.toLowerCase()),r=e.footnoteOrder.indexOf(i);let a,o=e.footnoteCounts.get(i);o===void 0?(o=0,e.footnoteOrder.push(i),a=e.footnoteOrder.length):a=r+1,o+=1,e.footnoteCounts.set(i,o);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]};e.patch(t,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,u),e.applyData(t,u)}function eee(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function tee(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}}function UN(e,t){const n=t.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+i}];const s=e.all(t),r=s[0];r&&r.type==="text"?r.value="["+r.value:s.unshift({type:"text",value:"["});const a=s[s.length-1];return a&&a.type==="text"?a.value+=i:s.push({type:"text",value:i}),s}function nee(e,t){const n=String(t.identifier).toUpperCase(),i=e.definitionById.get(n);if(!i)return UN(e,t);const s={src:jc(i.url||""),alt:t.alt};i.title!==null&&i.title!==void 0&&(s.title=i.title);const r={type:"element",tagName:"img",properties:s,children:[]};return e.patch(t,r),e.applyData(t,r)}function iee(e,t){const n={src:jc(t.url)};t.alt!==null&&t.alt!==void 0&&(n.alt=t.alt),t.title!==null&&t.title!==void 0&&(n.title=t.title);const i={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,i),e.applyData(t,i)}function see(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,i),e.applyData(t,i)}function ree(e,t){const n=String(t.identifier).toUpperCase(),i=e.definitionById.get(n);if(!i)return UN(e,t);const s={href:jc(i.url||"")};i.title!==null&&i.title!==void 0&&(s.title=i.title);const r={type:"element",tagName:"a",properties:s,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function oee(e,t){const n={href:jc(t.url)};t.title!==null&&t.title!==void 0&&(n.title=t.title);const i={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,i),e.applyData(t,i)}function aee(e,t,n){const i=e.all(t),s=n?lee(n):zN(t),r={},a=[];if(typeof t.checked=="boolean"){const h=i[0];let f;h&&h.type==="element"&&h.tagName==="p"?f=h:(f={type:"element",tagName:"p",properties:{},children:[]},i.unshift(f)),f.children.length>0&&f.children.unshift({type:"text",value:" "}),f.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),r.className=["task-list-item"]}let o=-1;for(;++o<i.length;){const h=i[o];(s||o!==0||h.type!=="element"||h.tagName!=="p")&&a.push({type:"text",value:`
`}),h.type==="element"&&h.tagName==="p"&&!s?a.push(...h.children):a.push(h)}const l=i[i.length-1];l&&(s||l.type!=="element"||l.tagName!=="p")&&a.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:r,children:a};return e.patch(t,u),e.applyData(t,u)}function lee(e){let t=!1;if(e.type==="list"){t=e.spread||!1;const n=e.children;let i=-1;for(;!t&&++i<n.length;)t=zN(n[i])}return t}function zN(e){const t=e.spread;return t??e.children.length>1}function cee(e,t){const n={},i=e.all(t);let s=-1;for(typeof t.start=="number"&&t.start!==1&&(n.start=t.start);++s<i.length;){const a=i[s];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const r={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(i,!0)};return e.patch(t,r),e.applyData(t,r)}function uee(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function dee(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)}function hee(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function fee(e,t){const n=e.all(t),i=n.shift(),s=[];if(i){const a={type:"element",tagName:"thead",properties:{},children:e.wrap([i],!0)};e.patch(t.children[0],a),s.push(a)}if(n.length>0){const a={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},o=RC(t.children[1]),l=yN(t.children[t.children.length-1]);o&&l&&(a.position={start:o,end:l}),s.push(a)}const r={type:"element",tagName:"table",properties:{},children:e.wrap(s,!0)};return e.patch(t,r),e.applyData(t,r)}function pee(e,t,n){const i=n?n.children:void 0,r=(i?i.indexOf(t):1)===0?"th":"td",a=n&&n.type==="table"?n.align:void 0,o=a?a.length:t.children.length;let l=-1;const u=[];for(;++l<o;){const f=t.children[l],m={},g=a?a[l]:void 0;g&&(m.align=g);let C={type:"element",tagName:r,properties:m,children:[]};f&&(C.children=e.all(f),e.patch(f,C),C=e.applyData(f,C)),u.push(C)}const h={type:"element",tagName:"tr",properties:{},children:e.wrap(u,!0)};return e.patch(t,h),e.applyData(t,h)}function mee(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}const XA=9,ZA=32;function gee(e){const t=String(e),n=/\r?\n|\r/g;let i=n.exec(t),s=0;const r=[];for(;i;)r.push(eM(t.slice(s,i.index),s>0,!0),i[0]),s=i.index+i[0].length,i=n.exec(t);return r.push(eM(t.slice(s),s>0,!1)),r.join("")}function eM(e,t,n){let i=0,s=e.length;if(t){let r=e.codePointAt(i);for(;r===XA||r===ZA;)i++,r=e.codePointAt(i)}if(n){let r=e.codePointAt(s-1);for(;r===XA||r===ZA;)s--,r=e.codePointAt(s-1)}return s>i?e.slice(i,s):""}function vee(e,t){const n={type:"text",value:gee(String(t.value))};return e.patch(t,n),e.applyData(t,n)}function bee(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)}const yee={blockquote:KZ,break:YZ,code:QZ,delete:JZ,emphasis:XZ,footnoteReference:ZZ,heading:eee,html:tee,imageReference:nee,image:iee,inlineCode:see,linkReference:ree,link:oee,listItem:aee,list:cee,paragraph:uee,root:dee,strong:hee,table:fee,tableCell:mee,tableRow:pee,text:vee,thematicBreak:bee,toml:Qf,yaml:Qf,definition:Qf,footnoteDefinition:Qf};function Qf(){}const HN=-1,mg=0,bd=1,Cm=2,OC=3,NC=4,jC=5,BC=6,$N=7,qN=8,tM=typeof self=="object"?self:globalThis,_ee=(e,t)=>{const n=(s,r)=>(e.set(r,s),s),i=s=>{if(e.has(s))return e.get(s);const[r,a]=t[s];switch(r){case mg:case HN:return n(a,s);case bd:{const o=n([],s);for(const l of a)o.push(i(l));return o}case Cm:{const o=n({},s);for(const[l,u]of a)o[i(l)]=i(u);return o}case OC:return n(new Date(a),s);case NC:{const{source:o,flags:l}=a;return n(new RegExp(o,l),s)}case jC:{const o=n(new Map,s);for(const[l,u]of a)o.set(i(l),i(u));return o}case BC:{const o=n(new Set,s);for(const l of a)o.add(i(l));return o}case $N:{const{name:o,message:l}=a;return n(new tM[o](l),s)}case qN:return n(BigInt(a),s);case"BigInt":return n(Object(BigInt(a)),s);case"ArrayBuffer":return n(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:o}=new Uint8Array(a);return n(new DataView(o),a)}}return n(new tM[r](a),s)};return i},nM=e=>_ee(new Map,e)(0),Ql="",{toString:See}={},{keys:Cee}=Object,Gu=e=>{const t=typeof e;if(t!=="object"||!e)return[mg,t];const n=See.call(e).slice(8,-1);switch(n){case"Array":return[bd,Ql];case"Object":return[Cm,Ql];case"Date":return[OC,Ql];case"RegExp":return[NC,Ql];case"Map":return[jC,Ql];case"Set":return[BC,Ql];case"DataView":return[bd,n]}return n.includes("Array")?[bd,n]:n.includes("Error")?[$N,n]:[Cm,n]},Jf=([e,t])=>e===mg&&(t==="function"||t==="symbol"),xee=(e,t,n,i)=>{const s=(a,o)=>{const l=i.push(a)-1;return n.set(o,l),l},r=a=>{if(n.has(a))return n.get(a);let[o,l]=Gu(a);switch(o){case mg:{let h=a;switch(l){case"bigint":o=qN,h=a.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+l);h=null;break;case"undefined":return s([HN],a)}return s([o,h],a)}case bd:{if(l){let m=a;return l==="DataView"?m=new Uint8Array(a.buffer):l==="ArrayBuffer"&&(m=new Uint8Array(a)),s([l,[...m]],a)}const h=[],f=s([o,h],a);for(const m of a)h.push(r(m));return f}case Cm:{if(l)switch(l){case"BigInt":return s([l,a.toString()],a);case"Boolean":case"Number":case"String":return s([l,a.valueOf()],a)}if(t&&"toJSON"in a)return r(a.toJSON());const h=[],f=s([o,h],a);for(const m of Cee(a))(e||!Jf(Gu(a[m])))&&h.push([r(m),r(a[m])]);return f}case OC:return s([o,a.toISOString()],a);case NC:{const{source:h,flags:f}=a;return s([o,{source:h,flags:f}],a)}case jC:{const h=[],f=s([o,h],a);for(const[m,g]of a)(e||!(Jf(Gu(m))||Jf(Gu(g))))&&h.push([r(m),r(g)]);return f}case BC:{const h=[],f=s([o,h],a);for(const m of a)(e||!Jf(Gu(m)))&&h.push(r(m));return f}}const{message:u}=a;return s([o,{name:l,message:u}],a)};return r},iM=(e,{json:t,lossy:n}={})=>{const i=[];return xee(!(t||n),!!t,new Map,i)(e),i},xm=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?nM(iM(e,t)):structuredClone(e):(e,t)=>nM(iM(e,t));function wee(e,t){const n=[{type:"text",value:""}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function kee(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function Tee(e){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||wee,i=e.options.footnoteBackLabel||kee,s=e.options.footnoteLabel||"Footnotes",r=e.options.footnoteLabelTagName||"h2",a=e.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let l=-1;for(;++l<e.footnoteOrder.length;){const u=e.footnoteById.get(e.footnoteOrder[l]);if(!u)continue;const h=e.all(u),f=String(u.identifier).toUpperCase(),m=jc(f.toLowerCase());let g=0;const C=[],S=e.footnoteCounts.get(f);for(;S!==void 0&&++g<=S;){C.length>0&&C.push({type:"text",value:" "});let w=typeof n=="string"?n:n(l,g);typeof w=="string"&&(w={type:"text",value:w}),C.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+m+(g>1?"-"+g:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(l,g),className:["data-footnote-backref"]},children:Array.isArray(w)?w:[w]})}const v=h[h.length-1];if(v&&v.type==="element"&&v.tagName==="p"){const w=v.children[v.children.length-1];w&&w.type==="text"?w.value+=" ":v.children.push({type:"text",value:" "}),v.children.push(...C)}else h.push(...C);const _={type:"element",tagName:"li",properties:{id:t+"fn-"+m},children:e.wrap(h,!0)};e.patch(u,_),o.push(_)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:r,properties:{...xm(a),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(o,!0)},{type:"text",value:`
`}]}}const gg=(function(e){if(e==null)return Mee;if(typeof e=="function")return vg(e);if(typeof e=="object")return Array.isArray(e)?Eee(e):Ree(e);if(typeof e=="string")return Aee(e);throw new Error("Expected function, string, or object as test")});function Eee(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=gg(e[n]);return vg(i);function i(...s){let r=-1;for(;++r<t.length;)if(t[r].apply(this,s))return!0;return!1}}function Ree(e){const t=e;return vg(n);function n(i){const s=i;let r;for(r in e)if(s[r]!==t[r])return!1;return!0}}function Aee(e){return vg(t);function t(n){return n&&n.type===e}}function vg(e){return t;function t(n,i,s){return!!(Lee(n)&&e.call(this,n,typeof i=="number"?i:void 0,s||void 0))}}function Mee(){return!0}function Lee(e){return e!==null&&typeof e=="object"&&"type"in e}const VN=[],Iee=!0,j0=!1,Pee="skip";function WN(e,t,n,i){let s;typeof t=="function"&&typeof n!="function"?(i=n,n=t):s=t;const r=gg(s),a=i?-1:1;o(e,void 0,[])();function o(l,u,h){const f=l&&typeof l=="object"?l:{};if(typeof f.type=="string"){const g=typeof f.tagName=="string"?f.tagName:typeof f.name=="string"?f.name:void 0;Object.defineProperty(m,"name",{value:"node ("+(l.type+(g?"<"+g+">":""))+")"})}return m;function m(){let g=VN,C,S,v;if((!t||r(l,u,h[h.length-1]||void 0))&&(g=Dee(n(l,h)),g[0]===j0))return g;if("children"in l&&l.children){const _=l;if(_.children&&g[0]!==Pee)for(S=(i?_.children.length:-1)+a,v=h.concat(_);S>-1&&S<_.children.length;){const w=_.children[S];if(C=o(w,S,v)(),C[0]===j0)return C;S=typeof C[1]=="number"?C[1]:S+a}}return g}}}function Dee(e){return Array.isArray(e)?e:typeof e=="number"?[Iee,e]:e==null?VN:[e]}function FC(e,t,n,i){let s,r,a;typeof t=="function"&&typeof n!="function"?(r=void 0,a=t,s=n):(r=t,a=n,s=i),WN(e,r,o,s);function o(l,u){const h=u[u.length-1],f=h?h.children.indexOf(l):void 0;return a(l,f,h)}}const B0={}.hasOwnProperty,Oee={};function Nee(e,t){const n=t||Oee,i=new Map,s=new Map,r=new Map,a={...yee,...n.handlers},o={all:u,applyData:Bee,definitionById:i,footnoteById:s,footnoteCounts:r,footnoteOrder:[],handlers:a,one:l,options:n,patch:jee,wrap:Uee};return FC(e,function(h){if(h.type==="definition"||h.type==="footnoteDefinition"){const f=h.type==="definition"?i:s,m=String(h.identifier).toUpperCase();f.has(m)||f.set(m,h)}}),o;function l(h,f){const m=h.type,g=o.handlers[m];if(B0.call(o.handlers,m)&&g)return g(o,h,f);if(o.options.passThrough&&o.options.passThrough.includes(m)){if("children"in h){const{children:S,...v}=h,_=xm(v);return _.children=o.all(h),_}return xm(h)}return(o.options.unknownHandler||Fee)(o,h,f)}function u(h){const f=[];if("children"in h){const m=h.children;let g=-1;for(;++g<m.length;){const C=o.one(m[g],h);if(C){if(g&&m[g-1].type==="break"&&(!Array.isArray(C)&&C.type==="text"&&(C.value=sM(C.value)),!Array.isArray(C)&&C.type==="element")){const S=C.children[0];S&&S.type==="text"&&(S.value=sM(S.value))}Array.isArray(C)?f.push(...C):f.push(C)}}}return f}}function jee(e,t){e.position&&(t.position=TJ(e))}function Bee(e,t){let n=t;if(e&&e.data){const i=e.data.hName,s=e.data.hChildren,r=e.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const a="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:a}}n.type==="element"&&r&&Object.assign(n.properties,xm(r)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function Fee(e,t){const n=t.data||{},i="value"in t&&!(B0.call(n,"hProperties")||B0.call(n,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,i),e.applyData(t,i)}function Uee(e,t){const n=[];let i=-1;for(t&&n.push({type:"text",value:`
`});++i<e.length;)i&&n.push({type:"text",value:`
`}),n.push(e[i]);return t&&e.length>0&&n.push({type:"text",value:`
`}),n}function sM(e){let t=0,n=e.charCodeAt(t);for(;n===9||n===32;)t++,n=e.charCodeAt(t);return e.slice(t)}function rM(e,t){const n=Nee(e,t),i=n.one(e,void 0),s=Tee(n),r=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return s&&r.children.push({type:"text",value:`
`},s),r}function zee(e,t){return e&&"run"in e?async function(n,i){const s=rM(n,{file:i,...t});await e.run(s,i)}:function(n,i){return rM(n,{file:i,...e||t})}}function oM(e){if(e)throw e}var Xy,aM;function Hee(){if(aM)return Xy;aM=1;var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,s=function(u){return typeof Array.isArray=="function"?Array.isArray(u):t.call(u)==="[object Array]"},r=function(u){if(!u||t.call(u)!=="[object Object]")return!1;var h=e.call(u,"constructor"),f=u.constructor&&u.constructor.prototype&&e.call(u.constructor.prototype,"isPrototypeOf");if(u.constructor&&!h&&!f)return!1;var m;for(m in u);return typeof m>"u"||e.call(u,m)},a=function(u,h){n&&h.name==="__proto__"?n(u,h.name,{enumerable:!0,configurable:!0,value:h.newValue,writable:!0}):u[h.name]=h.newValue},o=function(u,h){if(h==="__proto__")if(e.call(u,h)){if(i)return i(u,h).value}else return;return u[h]};return Xy=function l(){var u,h,f,m,g,C,S=arguments[0],v=1,_=arguments.length,w=!1;for(typeof S=="boolean"&&(w=S,S=arguments[1]||{},v=2),(S==null||typeof S!="object"&&typeof S!="function")&&(S={});v<_;++v)if(u=arguments[v],u!=null)for(h in u)f=o(S,h),m=o(u,h),S!==m&&(w&&m&&(r(m)||(g=s(m)))?(g?(g=!1,C=f&&s(f)?f:[]):C=f&&r(f)?f:{},a(S,{name:h,newValue:l(w,C,m)})):typeof m<"u"&&a(S,{name:h,newValue:m}));return S},Xy}var $ee=Hee();const Zy=Ga($ee);function F0(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function qee(){const e=[],t={run:n,use:i};return t;function n(...s){let r=-1;const a=s.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);o(null,...s);function o(l,...u){const h=e[++r];let f=-1;if(l){a(l);return}for(;++f<s.length;)(u[f]===null||u[f]===void 0)&&(u[f]=s[f]);s=u,h?Vee(h,o)(...u):a(null,...u)}}function i(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return e.push(s),t}}function Vee(e,t){let n;return i;function i(...a){const o=e.length>a.length;let l;o&&a.push(s);try{l=e.apply(this,a)}catch(u){const h=u;if(o&&n)throw h;return s(h)}o||(l&&l.then&&typeof l.then=="function"?l.then(r,s):l instanceof Error?s(l):r(l))}function s(a,...o){n||(n=!0,t(a,...o))}function r(a){s(null,a)}}const Bs={basename:Wee,dirname:Gee,extname:Kee,join:Yee,sep:"/"};function Wee(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');dh(e);let n=0,i=-1,s=e.length,r;if(t===void 0||t.length===0||t.length>e.length){for(;s--;)if(e.codePointAt(s)===47){if(r){n=s+1;break}}else i<0&&(r=!0,i=s+1);return i<0?"":e.slice(n,i)}if(t===e)return"";let a=-1,o=t.length-1;for(;s--;)if(e.codePointAt(s)===47){if(r){n=s+1;break}}else a<0&&(r=!0,a=s+1),o>-1&&(e.codePointAt(s)===t.codePointAt(o--)?o<0&&(i=s):(o=-1,i=a));return n===i?i=a:i<0&&(i=e.length),e.slice(n,i)}function Gee(e){if(dh(e),e.length===0)return".";let t=-1,n=e.length,i;for(;--n;)if(e.codePointAt(n)===47){if(i){t=n;break}}else i||(i=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function Kee(e){dh(e);let t=e.length,n=-1,i=0,s=-1,r=0,a;for(;t--;){const o=e.codePointAt(t);if(o===47){if(a){i=t+1;break}continue}n<0&&(a=!0,n=t+1),o===46?s<0?s=t:r!==1&&(r=1):s>-1&&(r=-1)}return s<0||n<0||r===0||r===1&&s===n-1&&s===i+1?"":e.slice(s,n)}function Yee(...e){let t=-1,n;for(;++t<e.length;)dh(e[t]),e[t]&&(n=n===void 0?e[t]:n+"/"+e[t]);return n===void 0?".":Qee(n)}function Qee(e){dh(e);const t=e.codePointAt(0)===47;let n=Jee(e,!t);return n.length===0&&!t&&(n="."),n.length>0&&e.codePointAt(e.length-1)===47&&(n+="/"),t?"/"+n:n}function Jee(e,t){let n="",i=0,s=-1,r=0,a=-1,o,l;for(;++a<=e.length;){if(a<e.length)o=e.codePointAt(a);else{if(o===47)break;o=47}if(o===47){if(!(s===a-1||r===1))if(s!==a-1&&r===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",i=0):(n=n.slice(0,l),i=n.length-1-n.lastIndexOf("/")),s=a,r=0;continue}}else if(n.length>0){n="",i=0,s=a,r=0;continue}}t&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+e.slice(s+1,a):n=e.slice(s+1,a),i=a-s-1;s=a,r=0}else o===46&&r>-1?r++:r=-1}return n}function dh(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const Xee={cwd:Zee};function Zee(){return"/"}function U0(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function ete(e){if(typeof e=="string")e=new URL(e);else if(!U0(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return tte(e)}function tte(e){if(e.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const t=e.pathname;let n=-1;for(;++n<t.length;)if(t.codePointAt(n)===37&&t.codePointAt(n+1)===50){const i=t.codePointAt(n+2);if(i===70||i===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(t)}const e_=["history","path","basename","stem","extname","dirname"];class GN{constructor(t){let n;t?U0(t)?n={path:t}:typeof t=="string"||nte(t)?n={value:t}:n=t:n={},this.cwd="cwd"in n?"":Xee.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<e_.length;){const r=e_[i];r in n&&n[r]!==void 0&&n[r]!==null&&(this[r]=r==="history"?[...n[r]]:n[r])}let s;for(s in n)e_.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?Bs.basename(this.path):void 0}set basename(t){n_(t,"basename"),t_(t,"basename"),this.path=Bs.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?Bs.dirname(this.path):void 0}set dirname(t){lM(this.basename,"dirname"),this.path=Bs.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?Bs.extname(this.path):void 0}set extname(t){if(t_(t,"extname"),lM(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Bs.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){U0(t)&&(t=ete(t)),n_(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?Bs.basename(this.path,this.extname):void 0}set stem(t){n_(t,"stem"),t_(t,"stem"),this.path=Bs.join(this.dirname||"",t+(this.extname||""))}fail(t,n,i){const s=this.message(t,n,i);throw s.fatal=!0,s}info(t,n,i){const s=this.message(t,n,i);return s.fatal=void 0,s}message(t,n,i){const s=new Vn(t,n,i);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}}function t_(e,t){if(e&&e.includes(Bs.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Bs.sep+"`")}function n_(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function lM(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function nte(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const ite=(function(e){const i=this.constructor.prototype,s=i[e],r=function(){return s.apply(r,arguments)};return Object.setPrototypeOf(r,i),r}),ste={}.hasOwnProperty;class UC extends ite{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=qee()}copy(){const t=new UC;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];t.use(...i)}return t.data(Zy(!0,{},this.namespace)),t}data(t,n){return typeof t=="string"?arguments.length===2?(r_("data",this.frozen),this.namespace[t]=n,this):ste.call(this.namespace,t)&&this.namespace[t]||void 0:t?(r_("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const s=n.call(t,...i);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const n=Xf(t),i=this.parser||this.Parser;return i_("parse",i),i(String(n),n)}process(t,n){const i=this;return this.freeze(),i_("process",this.parser||this.Parser),s_("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(r,a){const o=Xf(t),l=i.parse(o);i.run(l,o,function(h,f,m){if(h||!f||!m)return u(h);const g=f,C=i.stringify(g,m);ate(C)?m.value=C:m.result=C,u(h,m)});function u(h,f){h||!f?a(h):r?r(f):n(void 0,f)}}}processSync(t){let n=!1,i;return this.freeze(),i_("processSync",this.parser||this.Parser),s_("processSync",this.compiler||this.Compiler),this.process(t,s),uM("processSync","process",n),i;function s(r,a){n=!0,oM(r),i=a}}run(t,n,i){cM(t),this.freeze();const s=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?r(void 0,i):new Promise(r);function r(a,o){const l=Xf(n);s.run(t,l,u);function u(h,f,m){const g=f||t;h?o(h):a?a(g):i(void 0,g,m)}}}runSync(t,n){let i=!1,s;return this.run(t,n,r),uM("runSync","run",i),s;function r(a,o){oM(a),s=o,i=!0}}stringify(t,n){this.freeze();const i=Xf(n),s=this.compiler||this.Compiler;return s_("stringify",s),cM(t),s(t,i)}use(t,...n){const i=this.attachers,s=this.namespace;if(r_("use",this.frozen),t!=null)if(typeof t=="function")l(t,n);else if(typeof t=="object")Array.isArray(t)?o(t):a(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function r(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[h,...f]=u;l(h,f)}else a(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function a(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(u.plugins),u.settings&&(s.settings=Zy(!0,s.settings,u.settings))}function o(u){let h=-1;if(u!=null)if(Array.isArray(u))for(;++h<u.length;){const f=u[h];r(f)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,h){let f=-1,m=-1;for(;++f<i.length;)if(i[f][0]===u){m=f;break}if(m===-1)i.push([u,...h]);else if(h.length>0){let[g,...C]=h;const S=i[m][1];F0(S)&&F0(g)&&(g=Zy(!0,S,g)),i[m]=[u,g,...C]}}}}const rte=new UC().freeze();function i_(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function s_(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function r_(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function cM(e){if(!F0(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function uM(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function Xf(e){return ote(e)?e:new GN(e)}function ote(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function ate(e){return typeof e=="string"||lte(e)}function lte(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const cte="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",dM=[],hM={allowDangerousHtml:!0},ute=/^(https?|ircs?|mailto|xmpp)$/i,dte=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function hte(e){const t=fte(e),n=pte(e);return mte(t.runSync(t.parse(n),n),e)}function fte(e){const t=e.rehypePlugins||dM,n=e.remarkPlugins||dM,i=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...hM}:hM;return rte().use(GZ).use(n).use(zee,i).use(t)}function pte(e){const t=e.children||"",n=new GN;return typeof t=="string"&&(n.value=t),n}function mte(e,t){const n=t.allowedElements,i=t.allowElement,s=t.components,r=t.disallowedElements,a=t.skipHtml,o=t.unwrapDisallowed,l=t.urlTransform||gte;for(const h of dte)Object.hasOwn(t,h.from)&&(""+h.from+(h.to?"use `"+h.to+"` instead":"remove it")+cte+h.id,void 0);return FC(e,u),CN(e,{Fragment:b.Fragment,components:s,ignoreInvalidStyle:!0,jsx:b.jsx,jsxs:b.jsxs,passKeys:!0,passNode:!0});function u(h,f,m){if(h.type==="raw"&&m&&typeof f=="number")return a?m.children.splice(f,1):m.children[f]={type:"text",value:h.value},f;if(h.type==="element"){let g;for(g in Yy)if(Object.hasOwn(Yy,g)&&Object.hasOwn(h.properties,g)){const C=h.properties[g],S=Yy[g];(S===null||S.includes(h.tagName))&&(h.properties[g]=l(String(C||""),g,h))}}if(h.type==="element"){let g=n?!n.includes(h.tagName):r?r.includes(h.tagName):!1;if(!g&&i&&typeof f=="number"&&(g=!i(h,f,m)),g&&m&&typeof f=="number")return o&&h.children?m.children.splice(f,1,...h.children):m.children.splice(f,1),f}}}function gte(e){const t=e.indexOf(":"),n=e.indexOf("?"),i=e.indexOf("#"),s=e.indexOf("/");return t===-1||s!==-1&&t>s||n!==-1&&t>n||i!==-1&&t>i||ute.test(e.slice(0,t))?e:""}const vte=(e,t)=>typeof e=="string"?e===t:JSON.stringify(e)===JSON.stringify(t),bte=(e,t)=>{if(!e||!t)return!1;const n=i=>{const{position:s,data:r,...a}=i||{};return a};return JSON.stringify(n(e.properties))===JSON.stringify(n(t.properties))&&vte(e.children,t.children)},zC=(e,t)=>bte(e.node,t.node),yte=(e={})=>Object.fromEntries(Object.entries(e??{}).map(([t,n])=>{if(!n)return[t,n];const i=n,s=({node:r,...a})=>b.jsx(i,{...a});return[t,P.memo(s,zC)]})),HC=P.createContext(null),KN=()=>P.useContext(HC)!==null,_te=({children:e,...t})=>b.jsx(HC.Provider,{value:t,children:e}),Ste=P.memo(_te,zC),Cte=({node:e,...t})=>b.jsx("pre",{...t}),xte=({node:e,...t})=>b.jsx("code",{...t}),$C=({node:e,components:{Pre:t,Code:n},code:i})=>b.jsx(t,{children:b.jsx(n,{node:e,children:i})}),wte=()=>null,kte=({node:e,components:{Pre:t,Code:n,SyntaxHighlighter:i,CodeHeader:s},language:r,code:a})=>{const o=P.useMemo(()=>({Pre:t,Code:n}),[t,n]),l=r?i:$C;return b.jsxs(b.Fragment,{children:[b.jsx(s,{node:e,language:r,code:a}),b.jsx(l,{node:e,components:o,language:r??"unknown",code:a})]})};var o_={exports:{}};var fM;function Tte(){return fM||(fM=1,(function(e){(function(){var t={}.hasOwnProperty;function n(){for(var r="",a=0;a<arguments.length;a++){var o=arguments[a];o&&(r=s(r,i(o)))}return r}function i(r){if(typeof r=="string"||typeof r=="number")return r;if(typeof r!="object")return"";if(Array.isArray(r))return n.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var a="";for(var o in r)t.call(r,o)&&r[o]&&(a=s(a,o));return a}function s(r,a){return a?r?r+" "+a:r+a:r}e.exports?(n.default=n,e.exports=n):window.classNames=n})()})(o_)),o_.exports}var Ete=Tte();const YN=Ga(Ete),pM=({className:e,...t})=>({className:n,...i})=>({className:YN(e,n),...t,...i}),Rte=({node:e,components:{Pre:t,Code:n,SyntaxHighlighter:i,CodeHeader:s},componentsByLanguage:r={},children:a,...o})=>{const l=P.useContext(HC),u=pM(l),h=xs(v=>b.jsx(t,{...u(v)})),f=pM(o),m=xs(v=>b.jsx(n,{...f(v)})),g=/language-(\w+)/.exec(o.className||"")?.[1]??"";if(typeof a!="string")return b.jsx($C,{node:e,components:{Pre:h,Code:m},code:a});const C=r[g]?.SyntaxHighlighter??i,S=r[g]?.CodeHeader??s;return b.jsx(kte,{node:e,components:{Pre:h,Code:m,SyntaxHighlighter:C,CodeHeader:S},language:g||"unknown",code:a})},Ate=({node:e,components:t,componentsByLanguage:n,...i})=>KN()?b.jsx(Rte,{node:e,components:t,componentsByLanguage:n,...i}):b.jsx(t.Code,{...i}),Mte=P.memo(Ate,(e,t)=>e.components===t.components&&e.componentsByLanguage===t.componentsByLanguage&&zC(e,t)),{useSmooth:Lte,useSmoothStatus:Ite,withSmoothContextProvider:Pte}=aY,Dte=({components:e,componentsByLanguage:t,smooth:n=!0,preprocess:i,...s})=>{const r=LO(),a=P.useMemo(()=>i?{...r,text:i(r.text)}:r,[r,i]),{text:o}=Lte(a,n),{pre:l=Cte,code:u=xte,SyntaxHighlighter:h=$C,CodeHeader:f=wte}=e??{},m=P.useMemo(()=>({Pre:l,Code:u,SyntaxHighlighter:h,CodeHeader:f}),[l,u,h,f]),g=xs(S=>b.jsx(Mte,{components:m,componentsByLanguage:t,...S})),C=P.useMemo(()=>{const{pre:S,code:v,SyntaxHighlighter:_,CodeHeader:w,...x}=e??{};return{...x,pre:Ste,code:g}},[g,e]);return b.jsx(hte,{components:C,...s,children:o})},QN=P.forwardRef(({className:e,containerProps:t,containerComponent:n="div",...i},s)=>{const r=Ite();return b.jsx(n,{"data-status":r.type,...t,className:YN(e,t?.className),ref:s,children:b.jsx(Dte,{...i})})});QN.displayName="MarkdownTextPrimitive";const qC=Pte(QN);function wm(e,t){const n=String(e);if(typeof t!="string")throw new TypeError("Expected character");let i=0,s=n.indexOf(t);for(;s!==-1;)i++,s=n.indexOf(t,s+t.length);return i}function Ote(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Nte(e,t,n){const s=gg((n||{}).ignore||[]),r=jte(t);let a=-1;for(;++a<r.length;)WN(e,"text",o);function o(u,h){let f=-1,m;for(;++f<h.length;){const g=h[f],C=m?m.children:void 0;if(s(g,C?C.indexOf(g):void 0,m))return;m=g}if(m)return l(u,h)}function l(u,h){const f=h[h.length-1],m=r[a][0],g=r[a][1];let C=0;const v=f.children.indexOf(u);let _=!1,w=[];m.lastIndex=0;let x=m.exec(u.value);for(;x;){const k=x.index,A={index:x.index,input:x.input,stack:[...h,u]};let T=g(...x,A);if(typeof T=="string"&&(T=T.length>0?{type:"text",value:T}:void 0),T===!1?m.lastIndex=k+1:(C!==k&&w.push({type:"text",value:u.value.slice(C,k)}),Array.isArray(T)?w.push(...T):T&&w.push(T),C=k+x[0].length,_=!0),!m.global)break;x=m.exec(u.value)}return _?(C<u.value.length&&w.push({type:"text",value:u.value.slice(C)}),f.children.splice(v,1,...w)):w=[u],v+w.length}}function jte(e){const t=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!e[0]||Array.isArray(e[0])?e:[e];let i=-1;for(;++i<n.length;){const s=n[i];t.push([Bte(s[0]),Fte(s[1])])}return t}function Bte(e){return typeof e=="string"?new RegExp(Ote(e),"g"):e}function Fte(e){return typeof e=="function"?e:function(){return e}}const a_="phrasing",l_=["autolink","link","image","label"];function Ute(){return{transforms:[Gte],enter:{literalAutolink:Hte,literalAutolinkEmail:c_,literalAutolinkHttp:c_,literalAutolinkWww:c_},exit:{literalAutolink:Wte,literalAutolinkEmail:Vte,literalAutolinkHttp:$te,literalAutolinkWww:qte}}}function zte(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:a_,notInConstruct:l_},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:a_,notInConstruct:l_},{character:":",before:"[ps]",after:"\\/",inConstruct:a_,notInConstruct:l_}]}}function Hte(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function c_(e){this.config.enter.autolinkProtocol.call(this,e)}function $te(e){this.config.exit.autolinkProtocol.call(this,e)}function qte(e){this.config.exit.data.call(this,e);const t=this.stack[this.stack.length-1];t.type,t.url="http://"+this.sliceSerialize(e)}function Vte(e){this.config.exit.autolinkEmail.call(this,e)}function Wte(e){this.exit(e)}function Gte(e){Nte(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Kte],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),Yte]],{ignore:["link","linkReference"]})}function Kte(e,t,n,i,s){let r="";if(!JN(s)||(/^w/i.test(t)&&(n=t+n,t="",r="http://"),!Qte(n)))return!1;const a=Jte(n+i);if(!a[0])return!1;const o={type:"link",title:null,url:r+t+a[0],children:[{type:"text",value:t+a[0]}]};return a[1]?[o,{type:"text",value:a[1]}]:o}function Yte(e,t,n,i){return!JN(i,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+t+"@"+n,children:[{type:"text",value:t+"@"+n}]}}function Qte(e){const t=e.split(".");return!(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))}function Jte(e){const t=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!t)return[e,void 0];e=e.slice(0,t.index);let n=t[0],i=n.indexOf(")");const s=wm(e,"(");let r=wm(e,")");for(;i!==-1&&s>r;)e+=n.slice(0,i+1),n=n.slice(i+1),i=n.indexOf(")"),r++;return[e,n]}function JN(e,t){const n=e.input.charCodeAt(e.index-1);return(e.index===0||Va(n)||fg(n))&&(!t||n!==47)}XN.peek=one;function Xte(){this.buffer()}function Zte(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function ene(){this.buffer()}function tne(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function nne(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=Cs(this.sliceSerialize(e)).toLowerCase(),n.label=t}function ine(e){this.exit(e)}function sne(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=Cs(this.sliceSerialize(e)).toLowerCase(),n.label=t}function rne(e){this.exit(e)}function one(){return"["}function XN(e,t,n,i){const s=n.createTracker(i);let r=s.move("[^");const a=n.enter("footnoteReference"),o=n.enter("reference");return r+=s.move(n.safe(n.associationId(e),{after:"]",before:r})),o(),a(),r+=s.move("]"),r}function ane(){return{enter:{gfmFootnoteCallString:Xte,gfmFootnoteCall:Zte,gfmFootnoteDefinitionLabelString:ene,gfmFootnoteDefinition:tne},exit:{gfmFootnoteCallString:nne,gfmFootnoteCall:ine,gfmFootnoteDefinitionLabelString:sne,gfmFootnoteDefinition:rne}}}function lne(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:n,footnoteReference:XN},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,s,r,a){const o=r.createTracker(a);let l=o.move("[^");const u=r.enter("footnoteDefinition"),h=r.enter("label");return l+=o.move(r.safe(r.associationId(i),{before:l,after:"]"})),h(),l+=o.move("]:"),i.children&&i.children.length>0&&(o.shift(4),l+=o.move((t?`
`:" ")+r.indentLines(r.containerFlow(i,o.current()),t?ZN:cne))),u(),l}}function cne(e,t,n){return t===0?e:ZN(e,t,n)}function ZN(e,t,n){return(n?"":"    ")+e}const une=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];e5.peek=mne;function dne(){return{canContainEols:["delete"],enter:{strikethrough:fne},exit:{strikethrough:pne}}}function hne(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:une}],handlers:{delete:e5}}}function fne(e){this.enter({type:"delete",children:[]},e)}function pne(e){this.exit(e)}function e5(e,t,n,i){const s=n.createTracker(i),r=n.enter("strikethrough");let a=s.move("~~");return a+=n.containerPhrasing(e,{...s.current(),before:a,after:"~"}),a+=s.move("~~"),r(),a}function mne(){return"~"}function gne(e){return e.length}function vne(e,t){const n=t||{},i=(n.align||[]).concat(),s=n.stringLength||gne,r=[],a=[],o=[],l=[];let u=0,h=-1;for(;++h<e.length;){const S=[],v=[];let _=-1;for(e[h].length>u&&(u=e[h].length);++_<e[h].length;){const w=bne(e[h][_]);if(n.alignDelimiters!==!1){const x=s(w);v[_]=x,(l[_]===void 0||x>l[_])&&(l[_]=x)}S.push(w)}a[h]=S,o[h]=v}let f=-1;if(typeof i=="object"&&"length"in i)for(;++f<u;)r[f]=mM(i[f]);else{const S=mM(i);for(;++f<u;)r[f]=S}f=-1;const m=[],g=[];for(;++f<u;){const S=r[f];let v="",_="";S===99?(v=":",_=":"):S===108?v=":":S===114&&(_=":");let w=n.alignDelimiters===!1?1:Math.max(1,l[f]-v.length-_.length);const x=v+"-".repeat(w)+_;n.alignDelimiters!==!1&&(w=v.length+w+_.length,w>l[f]&&(l[f]=w),g[f]=w),m[f]=x}a.splice(1,0,m),o.splice(1,0,g),h=-1;const C=[];for(;++h<a.length;){const S=a[h],v=o[h];f=-1;const _=[];for(;++f<u;){const w=S[f]||"";let x="",k="";if(n.alignDelimiters!==!1){const A=l[f]-(v[f]||0),T=r[f];T===114?x=" ".repeat(A):T===99?A%2?(x=" ".repeat(A/2+.5),k=" ".repeat(A/2-.5)):(x=" ".repeat(A/2),k=x):k=" ".repeat(A)}n.delimiterStart!==!1&&!f&&_.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&w==="")&&(n.delimiterStart!==!1||f)&&_.push(" "),n.alignDelimiters!==!1&&_.push(x),_.push(w),n.alignDelimiters!==!1&&_.push(k),n.padding!==!1&&_.push(" "),(n.delimiterEnd!==!1||f!==u-1)&&_.push("|")}C.push(n.delimiterEnd===!1?_.join("").replace(/ +$/,""):_.join(""))}return C.join(`
`)}function bne(e){return e==null?"":String(e)}function mM(e){const t=typeof e=="string"?e.codePointAt(0):0;return t===67||t===99?99:t===76||t===108?108:t===82||t===114?114:0}const gM={}.hasOwnProperty;function yne(e,t){const n=t||{};function i(s,...r){let a=i.invalid;const o=i.handlers;if(s&&gM.call(s,e)){const l=String(s[e]);a=gM.call(o,l)?o[l]:i.unknown}if(a)return a.call(this,s,...r)}return i.handlers=n.handlers||{},i.invalid=n.invalid,i.unknown=n.unknown,i}function _ne(e,t,n,i){const s=n.enter("blockquote"),r=n.createTracker(i);r.move("> "),r.shift(2);const a=n.indentLines(n.containerFlow(e,r.current()),Sne);return s(),a}function Sne(e,t,n){return">"+(n?"":" ")+e}function Cne(e,t){return vM(e,t.inConstruct,!0)&&!vM(e,t.notInConstruct,!1)}function vM(e,t,n){if(typeof t=="string"&&(t=[t]),!t||t.length===0)return n;let i=-1;for(;++i<t.length;)if(e.includes(t[i]))return!0;return!1}function bM(e,t,n,i){let s=-1;for(;++s<n.unsafe.length;)if(n.unsafe[s].character===`
`&&Cne(n.stack,n.unsafe[s]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function xne(e,t){const n=String(e);let i=n.indexOf(t),s=i,r=0,a=0;if(typeof t!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===s?++r>a&&(a=r):r=1,s=i+t.length,i=n.indexOf(t,s);return a}function wne(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function kne(e){const t=e.options.fence||"`";if(t!=="`"&&t!=="~")throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function Tne(e,t,n,i){const s=kne(n),r=e.value||"",a=s==="`"?"GraveAccent":"Tilde";if(wne(e,n)){const f=n.enter("codeIndented"),m=n.indentLines(r,Ene);return f(),m}const o=n.createTracker(i),l=s.repeat(Math.max(xne(r,s)+1,3)),u=n.enter("codeFenced");let h=o.move(l);if(e.lang){const f=n.enter(`codeFencedLang${a}`);h+=o.move(n.safe(e.lang,{before:h,after:" ",encode:["`"],...o.current()})),f()}if(e.lang&&e.meta){const f=n.enter(`codeFencedMeta${a}`);h+=o.move(" "),h+=o.move(n.safe(e.meta,{before:h,after:`
`,encode:["`"],...o.current()})),f()}return h+=o.move(`
`),r&&(h+=o.move(r+`
`)),h+=o.move(l),u(),h}function Ene(e,t,n){return(n?"":"    ")+e}function VC(e){const t=e.options.quote||'"';if(t!=='"'&&t!=="'")throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function Rne(e,t,n,i){const s=VC(n),r=s==='"'?"Quote":"Apostrophe",a=n.enter("definition");let o=n.enter("label");const l=n.createTracker(i);let u=l.move("[");return u+=l.move(n.safe(n.associationId(e),{before:u,after:"]",...l.current()})),u+=l.move("]: "),o(),!e.url||/[\0- \u007F]/.test(e.url)?(o=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(e.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(o=n.enter("destinationRaw"),u+=l.move(n.safe(e.url,{before:u,after:e.title?" ":`
`,...l.current()}))),o(),e.title&&(o=n.enter(`title${r}`),u+=l.move(" "+s),u+=l.move(n.safe(e.title,{before:u,after:s,...l.current()})),u+=l.move(s),o()),a(),u}function Ane(e){const t=e.options.emphasis||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function Gd(e){return"&#x"+e.toString(16).toUpperCase()+";"}function km(e,t,n){const i=Tc(e),s=Tc(t);return i===void 0?s===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}t5.peek=Mne;function t5(e,t,n,i){const s=Ane(n),r=n.enter("emphasis"),a=n.createTracker(i),o=a.move(s);let l=a.move(n.containerPhrasing(e,{after:s,before:o,...a.current()}));const u=l.charCodeAt(0),h=km(i.before.charCodeAt(i.before.length-1),u,s);h.inside&&(l=Gd(u)+l.slice(1));const f=l.charCodeAt(l.length-1),m=km(i.after.charCodeAt(0),f,s);m.inside&&(l=l.slice(0,-1)+Gd(f));const g=a.move(s);return r(),n.attentionEncodeSurroundingInfo={after:m.outside,before:h.outside},o+l+g}function Mne(e,t,n){return n.options.emphasis||"*"}function Lne(e,t){let n=!1;return FC(e,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,j0}),!!((!e.depth||e.depth<3)&&IC(e)&&(t.options.setext||n))}function Ine(e,t,n,i){const s=Math.max(Math.min(6,e.depth||1),1),r=n.createTracker(i);if(Lne(e,n)){const h=n.enter("headingSetext"),f=n.enter("phrasing"),m=n.containerPhrasing(e,{...r.current(),before:`
`,after:`
`});return f(),h(),m+`
`+(s===1?"=":"-").repeat(m.length-(Math.max(m.lastIndexOf("\r"),m.lastIndexOf(`
`))+1))}const a="#".repeat(s),o=n.enter("headingAtx"),l=n.enter("phrasing");r.move(a+" ");let u=n.containerPhrasing(e,{before:"# ",after:`
`,...r.current()});return/^[\t ]/.test(u)&&(u=Gd(u.charCodeAt(0))+u.slice(1)),u=u?a+" "+u:a,n.options.closeAtx&&(u+=" "+a),l(),o(),u}n5.peek=Pne;function n5(e){return e.value||""}function Pne(){return"<"}i5.peek=Dne;function i5(e,t,n,i){const s=VC(n),r=s==='"'?"Quote":"Apostrophe",a=n.enter("image");let o=n.enter("label");const l=n.createTracker(i);let u=l.move("![");return u+=l.move(n.safe(e.alt,{before:u,after:"]",...l.current()})),u+=l.move("]("),o(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(o=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(e.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(o=n.enter("destinationRaw"),u+=l.move(n.safe(e.url,{before:u,after:e.title?" ":")",...l.current()}))),o(),e.title&&(o=n.enter(`title${r}`),u+=l.move(" "+s),u+=l.move(n.safe(e.title,{before:u,after:s,...l.current()})),u+=l.move(s),o()),u+=l.move(")"),a(),u}function Dne(){return"!"}s5.peek=One;function s5(e,t,n,i){const s=e.referenceType,r=n.enter("imageReference");let a=n.enter("label");const o=n.createTracker(i);let l=o.move("![");const u=n.safe(e.alt,{before:l,after:"]",...o.current()});l+=o.move(u+"]["),a();const h=n.stack;n.stack=[],a=n.enter("reference");const f=n.safe(n.associationId(e),{before:l,after:"]",...o.current()});return a(),n.stack=h,r(),s==="full"||!u||u!==f?l+=o.move(f+"]"):s==="shortcut"?l=l.slice(0,-1):l+=o.move("]"),l}function One(){return"!"}r5.peek=Nne;function r5(e,t,n){let i=e.value||"",s="`",r=-1;for(;new RegExp("(^|[^`])"+s+"([^`]|$)").test(i);)s+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++r<n.unsafe.length;){const a=n.unsafe[r],o=n.compilePattern(a);let l;if(a.atBreak)for(;l=o.exec(i);){let u=l.index;i.charCodeAt(u)===10&&i.charCodeAt(u-1)===13&&u--,i=i.slice(0,u)+" "+i.slice(l.index+1)}}return s+i+s}function Nne(){return"`"}function o5(e,t){const n=IC(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}a5.peek=jne;function a5(e,t,n,i){const s=VC(n),r=s==='"'?"Quote":"Apostrophe",a=n.createTracker(i);let o,l;if(o5(e,n)){const h=n.stack;n.stack=[],o=n.enter("autolink");let f=a.move("<");return f+=a.move(n.containerPhrasing(e,{before:f,after:">",...a.current()})),f+=a.move(">"),o(),n.stack=h,f}o=n.enter("link"),l=n.enter("label");let u=a.move("[");return u+=a.move(n.containerPhrasing(e,{before:u,after:"](",...a.current()})),u+=a.move("]("),l(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(l=n.enter("destinationLiteral"),u+=a.move("<"),u+=a.move(n.safe(e.url,{before:u,after:">",...a.current()})),u+=a.move(">")):(l=n.enter("destinationRaw"),u+=a.move(n.safe(e.url,{before:u,after:e.title?" ":")",...a.current()}))),l(),e.title&&(l=n.enter(`title${r}`),u+=a.move(" "+s),u+=a.move(n.safe(e.title,{before:u,after:s,...a.current()})),u+=a.move(s),l()),u+=a.move(")"),o(),u}function jne(e,t,n){return o5(e,n)?"<":"["}l5.peek=Bne;function l5(e,t,n,i){const s=e.referenceType,r=n.enter("linkReference");let a=n.enter("label");const o=n.createTracker(i);let l=o.move("[");const u=n.containerPhrasing(e,{before:l,after:"]",...o.current()});l+=o.move(u+"]["),a();const h=n.stack;n.stack=[],a=n.enter("reference");const f=n.safe(n.associationId(e),{before:l,after:"]",...o.current()});return a(),n.stack=h,r(),s==="full"||!u||u!==f?l+=o.move(f+"]"):s==="shortcut"?l=l.slice(0,-1):l+=o.move("]"),l}function Bne(){return"["}function WC(e){const t=e.options.bullet||"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function Fne(e){const t=WC(e),n=e.options.bulletOther;if(!n)return t==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}function Une(e){const t=e.options.bulletOrdered||".";if(t!=="."&&t!==")")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function c5(e){const t=e.options.rule||"*";if(t!=="*"&&t!=="-"&&t!=="_")throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function zne(e,t,n,i){const s=n.enter("list"),r=n.bulletCurrent;let a=e.ordered?Une(n):WC(n);const o=e.ordered?a==="."?")":".":Fne(n);let l=t&&n.bulletLastUsed?a===n.bulletLastUsed:!1;if(!e.ordered){const h=e.children?e.children[0]:void 0;if((a==="*"||a==="-")&&h&&(!h.children||!h.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(l=!0),c5(n)===a&&h){let f=-1;for(;++f<e.children.length;){const m=e.children[f];if(m&&m.type==="listItem"&&m.children&&m.children[0]&&m.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(a=o),n.bulletCurrent=a;const u=n.containerFlow(e,i);return n.bulletLastUsed=a,n.bulletCurrent=r,s(),u}function Hne(e){const t=e.options.listItemIndent||"one";if(t!=="tab"&&t!=="one"&&t!=="mixed")throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function $ne(e,t,n,i){const s=Hne(n);let r=n.bulletCurrent||WC(n);t&&t.type==="list"&&t.ordered&&(r=(typeof t.start=="number"&&t.start>-1?t.start:1)+(n.options.incrementListMarker===!1?0:t.children.indexOf(e))+r);let a=r.length+1;(s==="tab"||s==="mixed"&&(t&&t.type==="list"&&t.spread||e.spread))&&(a=Math.ceil(a/4)*4);const o=n.createTracker(i);o.move(r+" ".repeat(a-r.length)),o.shift(a);const l=n.enter("listItem"),u=n.indentLines(n.containerFlow(e,o.current()),h);return l(),u;function h(f,m,g){return m?(g?"":" ".repeat(a))+f:(g?r:r+" ".repeat(a-r.length))+f}}function qne(e,t,n,i){const s=n.enter("paragraph"),r=n.enter("phrasing"),a=n.containerPhrasing(e,i);return r(),s(),a}const Vne=gg(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function Wne(e,t,n,i){return(e.children.some(function(a){return Vne(a)})?n.containerPhrasing:n.containerFlow).call(n,e,i)}function Gne(e){const t=e.options.strong||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}u5.peek=Kne;function u5(e,t,n,i){const s=Gne(n),r=n.enter("strong"),a=n.createTracker(i),o=a.move(s+s);let l=a.move(n.containerPhrasing(e,{after:s,before:o,...a.current()}));const u=l.charCodeAt(0),h=km(i.before.charCodeAt(i.before.length-1),u,s);h.inside&&(l=Gd(u)+l.slice(1));const f=l.charCodeAt(l.length-1),m=km(i.after.charCodeAt(0),f,s);m.inside&&(l=l.slice(0,-1)+Gd(f));const g=a.move(s+s);return r(),n.attentionEncodeSurroundingInfo={after:m.outside,before:h.outside},o+l+g}function Kne(e,t,n){return n.options.strong||"*"}function Yne(e,t,n,i){return n.safe(e.value,i)}function Qne(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function Jne(e,t,n){const i=(c5(n)+(n.options.ruleSpaces?" ":"")).repeat(Qne(n));return n.options.ruleSpaces?i.slice(0,-1):i}const d5={blockquote:_ne,break:bM,code:Tne,definition:Rne,emphasis:t5,hardBreak:bM,heading:Ine,html:n5,image:i5,imageReference:s5,inlineCode:r5,link:a5,linkReference:l5,list:zne,listItem:$ne,paragraph:qne,root:Wne,strong:u5,text:Yne,thematicBreak:Jne};function Xne(){return{enter:{table:Zne,tableData:yM,tableHeader:yM,tableRow:tie},exit:{codeText:nie,table:eie,tableData:u_,tableHeader:u_,tableRow:u_}}}function Zne(e){const t=e._align;this.enter({type:"table",align:t.map(function(n){return n==="none"?null:n}),children:[]},e),this.data.inTable=!0}function eie(e){this.exit(e),this.data.inTable=void 0}function tie(e){this.enter({type:"tableRow",children:[]},e)}function u_(e){this.exit(e)}function yM(e){this.enter({type:"tableCell",children:[]},e)}function nie(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,iie));const n=this.stack[this.stack.length-1];n.type,n.value=t,this.exit(e)}function iie(e,t){return t==="|"?t:e}function sie(e){const t=e||{},n=t.tableCellPadding,i=t.tablePipeAlign,s=t.stringLength,r=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:m,table:a,tableCell:l,tableRow:o}};function a(g,C,S,v){return u(h(g,S,v),g.align)}function o(g,C,S,v){const _=f(g,S,v),w=u([_]);return w.slice(0,w.indexOf(`
`))}function l(g,C,S,v){const _=S.enter("tableCell"),w=S.enter("phrasing"),x=S.containerPhrasing(g,{...v,before:r,after:r});return w(),_(),x}function u(g,C){return vne(g,{align:C,alignDelimiters:i,padding:n,stringLength:s})}function h(g,C,S){const v=g.children;let _=-1;const w=[],x=C.enter("table");for(;++_<v.length;)w[_]=f(v[_],C,S);return x(),w}function f(g,C,S){const v=g.children;let _=-1;const w=[],x=C.enter("tableRow");for(;++_<v.length;)w[_]=l(v[_],g,C,S);return x(),w}function m(g,C,S){let v=d5.inlineCode(g,C,S);return S.stack.includes("tableCell")&&(v=v.replace(/\|/g,"\\$&")),v}}function rie(){return{exit:{taskListCheckValueChecked:_M,taskListCheckValueUnchecked:_M,paragraph:aie}}}function oie(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:lie}}}function _M(e){const t=this.stack[this.stack.length-2];t.type,t.checked=e.type==="taskListCheckValueChecked"}function aie(e){const t=this.stack[this.stack.length-2];if(t&&t.type==="listItem"&&typeof t.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const i=n.children[0];if(i&&i.type==="text"){const s=t.children;let r=-1,a;for(;++r<s.length;){const o=s[r];if(o.type==="paragraph"){a=o;break}}a===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(e)}function lie(e,t,n,i){const s=e.children[0],r=typeof e.checked=="boolean"&&s&&s.type==="paragraph",a="["+(e.checked?"x":" ")+"] ",o=n.createTracker(i);r&&o.move(a);let l=d5.listItem(e,t,n,{...i,...o.current()});return r&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),l;function u(h){return h+a}}function cie(){return[Ute(),ane(),dne(),Xne(),rie()]}function uie(e){return{extensions:[zte(),lne(e),hne(),sie(e),oie()]}}const die={tokenize:vie,partial:!0},h5={tokenize:bie,partial:!0},f5={tokenize:yie,partial:!0},p5={tokenize:_ie,partial:!0},hie={tokenize:Sie,partial:!0},m5={name:"wwwAutolink",tokenize:mie,previous:v5},g5={name:"protocolAutolink",tokenize:gie,previous:b5},zr={name:"emailAutolink",tokenize:pie,previous:y5},nr={};function fie(){return{text:nr}}let pa=48;for(;pa<123;)nr[pa]=zr,pa++,pa===58?pa=65:pa===91&&(pa=97);nr[43]=zr;nr[45]=zr;nr[46]=zr;nr[95]=zr;nr[72]=[zr,g5];nr[104]=[zr,g5];nr[87]=[zr,m5];nr[119]=[zr,m5];function pie(e,t,n){const i=this;let s,r;return a;function a(f){return!z0(f)||!y5.call(i,i.previous)||GC(i.events)?n(f):(e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),o(f))}function o(f){return z0(f)?(e.consume(f),o):f===64?(e.consume(f),l):n(f)}function l(f){return f===46?e.check(hie,h,u)(f):f===45||f===95||Hn(f)?(r=!0,e.consume(f),l):h(f)}function u(f){return e.consume(f),s=!0,l}function h(f){return r&&s&&ti(i.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),t(f)):n(f)}}function mie(e,t,n){const i=this;return s;function s(a){return a!==87&&a!==119||!v5.call(i,i.previous)||GC(i.events)?n(a):(e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(die,e.attempt(h5,e.attempt(f5,r),n),n)(a))}function r(a){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),t(a)}}function gie(e,t,n){const i=this;let s="",r=!1;return a;function a(f){return(f===72||f===104)&&b5.call(i,i.previous)&&!GC(i.events)?(e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),s+=String.fromCodePoint(f),e.consume(f),o):n(f)}function o(f){if(ti(f)&&s.length<5)return s+=String.fromCodePoint(f),e.consume(f),o;if(f===58){const m=s.toLowerCase();if(m==="http"||m==="https")return e.consume(f),l}return n(f)}function l(f){return f===47?(e.consume(f),r?u:(r=!0,l)):n(f)}function u(f){return f===null||Sm(f)||Ut(f)||Va(f)||fg(f)?n(f):e.attempt(h5,e.attempt(f5,h),n)(f)}function h(f){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),t(f)}}function vie(e,t,n){let i=0;return s;function s(a){return(a===87||a===119)&&i<3?(i++,e.consume(a),s):a===46&&i===3?(e.consume(a),r):n(a)}function r(a){return a===null?n(a):t(a)}}function bie(e,t,n){let i,s,r;return a;function a(u){return u===46||u===95?e.check(p5,l,o)(u):u===null||Ut(u)||Va(u)||u!==45&&fg(u)?l(u):(r=!0,e.consume(u),a)}function o(u){return u===95?i=!0:(s=i,i=void 0),e.consume(u),a}function l(u){return s||i||!r?n(u):t(u)}}function yie(e,t){let n=0,i=0;return s;function s(a){return a===40?(n++,e.consume(a),s):a===41&&i<n?r(a):a===33||a===34||a===38||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===60||a===63||a===93||a===95||a===126?e.check(p5,t,r)(a):a===null||Ut(a)||Va(a)?t(a):(e.consume(a),s)}function r(a){return a===41&&i++,e.consume(a),s}}function _ie(e,t,n){return i;function i(o){return o===33||o===34||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===63||o===95||o===126?(e.consume(o),i):o===38?(e.consume(o),r):o===93?(e.consume(o),s):o===60||o===null||Ut(o)||Va(o)?t(o):n(o)}function s(o){return o===null||o===40||o===91||Ut(o)||Va(o)?t(o):i(o)}function r(o){return ti(o)?a(o):n(o)}function a(o){return o===59?(e.consume(o),i):ti(o)?(e.consume(o),a):n(o)}}function Sie(e,t,n){return i;function i(r){return e.consume(r),s}function s(r){return Hn(r)?n(r):t(r)}}function v5(e){return e===null||e===40||e===42||e===95||e===91||e===93||e===126||Ut(e)}function b5(e){return!ti(e)}function y5(e){return!(e===47||z0(e))}function z0(e){return e===43||e===45||e===46||e===95||Hn(e)}function GC(e){let t=e.length,n=!1;for(;t--;){const i=e[t][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){n=!0;break}if(i._gfmAutolinkLiteralWalkedInto){n=!1;break}}return e.length>0&&!n&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const Cie={tokenize:Mie,partial:!0};function xie(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:Eie,continuation:{tokenize:Rie},exit:Aie}},text:{91:{name:"gfmFootnoteCall",tokenize:Tie},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:wie,resolveTo:kie}}}}function wie(e,t,n){const i=this;let s=i.events.length;const r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a;for(;s--;){const l=i.events[s][1];if(l.type==="labelImage"){a=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return o;function o(l){if(!a||!a._balanced)return n(l);const u=Cs(i.sliceSerialize({start:a.end,end:i.now()}));return u.codePointAt(0)!==94||!r.includes(u.slice(1))?n(l):(e.enter("gfmFootnoteCallLabelMarker"),e.consume(l),e.exit("gfmFootnoteCallLabelMarker"),t(l))}}function kie(e,t){let n=e.length;for(;n--;)if(e[n][1].type==="labelImage"&&e[n][0]==="enter"){e[n][1];break}e[n+1][1].type="data",e[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},e[n+3][1].start),end:Object.assign({},e[e.length-1][1].end)},s={type:"gfmFootnoteCallMarker",start:Object.assign({},e[n+3][1].end),end:Object.assign({},e[n+3][1].end)};s.end.column++,s.end.offset++,s.end._bufferIndex++;const r={type:"gfmFootnoteCallString",start:Object.assign({},s.end),end:Object.assign({},e[e.length-1][1].start)},a={type:"chunkString",contentType:"string",start:Object.assign({},r.start),end:Object.assign({},r.end)},o=[e[n+1],e[n+2],["enter",i,t],e[n+3],e[n+4],["enter",s,t],["exit",s,t],["enter",r,t],["enter",a,t],["exit",a,t],["exit",r,t],e[e.length-2],e[e.length-1],["exit",i,t]];return e.splice(n,e.length-n+1,...o),e}function Tie(e,t,n){const i=this,s=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let r=0,a;return o;function o(f){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(f),e.exit("gfmFootnoteCallLabelMarker"),l}function l(f){return f!==94?n(f):(e.enter("gfmFootnoteCallMarker"),e.consume(f),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",u)}function u(f){if(r>999||f===93&&!a||f===null||f===91||Ut(f))return n(f);if(f===93){e.exit("chunkString");const m=e.exit("gfmFootnoteCallString");return s.includes(Cs(i.sliceSerialize(m)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(f),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):n(f)}return Ut(f)||(a=!0),r++,e.consume(f),f===92?h:u}function h(f){return f===91||f===92||f===93?(e.consume(f),r++,u):u(f)}}function Eie(e,t,n){const i=this,s=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let r,a=0,o;return l;function l(C){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(C),e.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(C){return C===94?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(C),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",h):n(C)}function h(C){if(a>999||C===93&&!o||C===null||C===91||Ut(C))return n(C);if(C===93){e.exit("chunkString");const S=e.exit("gfmFootnoteDefinitionLabelString");return r=Cs(i.sliceSerialize(S)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(C),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),m}return Ut(C)||(o=!0),a++,e.consume(C),C===92?f:h}function f(C){return C===91||C===92||C===93?(e.consume(C),a++,h):h(C)}function m(C){return C===58?(e.enter("definitionMarker"),e.consume(C),e.exit("definitionMarker"),s.includes(r)||s.push(r),vt(e,g,"gfmFootnoteDefinitionWhitespace")):n(C)}function g(C){return t(C)}}function Rie(e,t,n){return e.check(uh,t,e.attempt(Cie,t,n))}function Aie(e){e.exit("gfmFootnoteDefinition")}function Mie(e,t,n){const i=this;return vt(e,s,"gfmFootnoteDefinitionIndent",5);function s(r){const a=i.events[i.events.length-1];return a&&a[1].type==="gfmFootnoteDefinitionIndent"&&a[2].sliceSerialize(a[1],!0).length===4?t(r):n(r)}}function Lie(e){let n=(e||{}).singleTilde;const i={name:"strikethrough",tokenize:r,resolveAll:s};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function s(a,o){let l=-1;for(;++l<a.length;)if(a[l][0]==="enter"&&a[l][1].type==="strikethroughSequenceTemporary"&&a[l][1]._close){let u=l;for(;u--;)if(a[u][0]==="exit"&&a[u][1].type==="strikethroughSequenceTemporary"&&a[u][1]._open&&a[l][1].end.offset-a[l][1].start.offset===a[u][1].end.offset-a[u][1].start.offset){a[l][1].type="strikethroughSequence",a[u][1].type="strikethroughSequence";const h={type:"strikethrough",start:Object.assign({},a[u][1].start),end:Object.assign({},a[l][1].end)},f={type:"strikethroughText",start:Object.assign({},a[u][1].end),end:Object.assign({},a[l][1].start)},m=[["enter",h,o],["enter",a[u][1],o],["exit",a[u][1],o],["enter",f,o]],g=o.parser.constructs.insideSpan.null;g&&Oi(m,m.length,0,pg(g,a.slice(u+1,l),o)),Oi(m,m.length,0,[["exit",f,o],["enter",a[l][1],o],["exit",a[l][1],o],["exit",h,o]]),Oi(a,u-1,l-u+3,m),l=u+m.length-2;break}}for(l=-1;++l<a.length;)a[l][1].type==="strikethroughSequenceTemporary"&&(a[l][1].type="data");return a}function r(a,o,l){const u=this.previous,h=this.events;let f=0;return m;function m(C){return u===126&&h[h.length-1][1].type!=="characterEscape"?l(C):(a.enter("strikethroughSequenceTemporary"),g(C))}function g(C){const S=Tc(u);if(C===126)return f>1?l(C):(a.consume(C),f++,g);if(f<2&&!n)return l(C);const v=a.exit("strikethroughSequenceTemporary"),_=Tc(C);return v._open=!_||_===2&&!!S,v._close=!S||S===2&&!!_,o(C)}}}class Iie{constructor(){this.map=[]}add(t,n,i){Pie(this,t,n,i)}consume(t){if(this.map.sort(function(r,a){return r[0]-a[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(t.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),t.length=this.map[n][0];i.push(t.slice()),t.length=0;let s=i.pop();for(;s;){for(const r of s)t.push(r);s=i.pop()}this.map.length=0}}function Pie(e,t,n,i){let s=0;if(!(n===0&&i.length===0)){for(;s<e.map.length;){if(e.map[s][0]===t){e.map[s][1]+=n,e.map[s][2].push(...i);return}s+=1}e.map.push([t,n,i])}}function Die(e,t){let n=!1;const i=[];for(;t<e.length;){const s=e[t];if(n){if(s[0]==="enter")s[1].type==="tableContent"&&i.push(e[t+1][1].type==="tableDelimiterMarker"?"left":"none");else if(s[1].type==="tableContent"){if(e[t-1][1].type==="tableDelimiterMarker"){const r=i.length-1;i[r]=i[r]==="left"?"center":"right"}}else if(s[1].type==="tableDelimiterRow")break}else s[0]==="enter"&&s[1].type==="tableDelimiterRow"&&(n=!0);t+=1}return i}function Oie(){return{flow:{null:{name:"table",tokenize:Nie,resolveAll:jie}}}}function Nie(e,t,n){const i=this;let s=0,r=0,a;return o;function o(D){let O=i.events.length-1;for(;O>-1;){const q=i.events[O][1].type;if(q==="lineEnding"||q==="linePrefix")O--;else break}const j=O>-1?i.events[O][1].type:null,U=j==="tableHead"||j==="tableRow"?T:l;return U===T&&i.parser.lazy[i.now().line]?n(D):U(D)}function l(D){return e.enter("tableHead"),e.enter("tableRow"),u(D)}function u(D){return D===124||(a=!0,r+=1),h(D)}function h(D){return D===null?n(D):$e(D)?r>1?(r=0,i.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(D),e.exit("lineEnding"),g):n(D):ht(D)?vt(e,h,"whitespace")(D):(r+=1,a&&(a=!1,s+=1),D===124?(e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),a=!0,h):(e.enter("data"),f(D)))}function f(D){return D===null||D===124||Ut(D)?(e.exit("data"),h(D)):(e.consume(D),D===92?m:f)}function m(D){return D===92||D===124?(e.consume(D),f):f(D)}function g(D){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(D):(e.enter("tableDelimiterRow"),a=!1,ht(D)?vt(e,C,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(D):C(D))}function C(D){return D===45||D===58?v(D):D===124?(a=!0,e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),S):A(D)}function S(D){return ht(D)?vt(e,v,"whitespace")(D):v(D)}function v(D){return D===58?(r+=1,a=!0,e.enter("tableDelimiterMarker"),e.consume(D),e.exit("tableDelimiterMarker"),_):D===45?(r+=1,_(D)):D===null||$e(D)?k(D):A(D)}function _(D){return D===45?(e.enter("tableDelimiterFiller"),w(D)):A(D)}function w(D){return D===45?(e.consume(D),w):D===58?(a=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(D),e.exit("tableDelimiterMarker"),x):(e.exit("tableDelimiterFiller"),x(D))}function x(D){return ht(D)?vt(e,k,"whitespace")(D):k(D)}function k(D){return D===124?C(D):D===null||$e(D)?!a||s!==r?A(D):(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(D)):A(D)}function A(D){return n(D)}function T(D){return e.enter("tableRow"),M(D)}function M(D){return D===124?(e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),M):D===null||$e(D)?(e.exit("tableRow"),t(D)):ht(D)?vt(e,M,"whitespace")(D):(e.enter("data"),E(D))}function E(D){return D===null||D===124||Ut(D)?(e.exit("data"),M(D)):(e.consume(D),D===92?L:E)}function L(D){return D===92||D===124?(e.consume(D),E):E(D)}}function jie(e,t){let n=-1,i=!0,s=0,r=[0,0,0,0],a=[0,0,0,0],o=!1,l=0,u,h,f;const m=new Iie;for(;++n<e.length;){const g=e[n],C=g[1];g[0]==="enter"?C.type==="tableHead"?(o=!1,l!==0&&(SM(m,t,l,u,h),h=void 0,l=0),u={type:"table",start:Object.assign({},C.start),end:Object.assign({},C.end)},m.add(n,0,[["enter",u,t]])):C.type==="tableRow"||C.type==="tableDelimiterRow"?(i=!0,f=void 0,r=[0,0,0,0],a=[0,n+1,0,0],o&&(o=!1,h={type:"tableBody",start:Object.assign({},C.start),end:Object.assign({},C.end)},m.add(n,0,[["enter",h,t]])),s=C.type==="tableDelimiterRow"?2:h?3:1):s&&(C.type==="data"||C.type==="tableDelimiterMarker"||C.type==="tableDelimiterFiller")?(i=!1,a[2]===0&&(r[1]!==0&&(a[0]=a[1],f=Zf(m,t,r,s,void 0,f),r=[0,0,0,0]),a[2]=n)):C.type==="tableCellDivider"&&(i?i=!1:(r[1]!==0&&(a[0]=a[1],f=Zf(m,t,r,s,void 0,f)),r=a,a=[r[1],n,0,0])):C.type==="tableHead"?(o=!0,l=n):C.type==="tableRow"||C.type==="tableDelimiterRow"?(l=n,r[1]!==0?(a[0]=a[1],f=Zf(m,t,r,s,n,f)):a[1]!==0&&(f=Zf(m,t,a,s,n,f)),s=0):s&&(C.type==="data"||C.type==="tableDelimiterMarker"||C.type==="tableDelimiterFiller")&&(a[3]=n)}for(l!==0&&SM(m,t,l,u,h),m.consume(t.events),n=-1;++n<t.events.length;){const g=t.events[n];g[0]==="enter"&&g[1].type==="table"&&(g[1]._align=Die(t.events,n))}return e}function Zf(e,t,n,i,s,r){const a=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",o="tableContent";n[0]!==0&&(r.end=Object.assign({},ec(t.events,n[0])),e.add(n[0],0,[["exit",r,t]]));const l=ec(t.events,n[1]);if(r={type:a,start:Object.assign({},l),end:Object.assign({},l)},e.add(n[1],0,[["enter",r,t]]),n[2]!==0){const u=ec(t.events,n[2]),h=ec(t.events,n[3]),f={type:o,start:Object.assign({},u),end:Object.assign({},h)};if(e.add(n[2],0,[["enter",f,t]]),i!==2){const m=t.events[n[2]],g=t.events[n[3]];if(m[1].end=Object.assign({},g[1].end),m[1].type="chunkText",m[1].contentType="text",n[3]>n[2]+1){const C=n[2]+1,S=n[3]-n[2]-1;e.add(C,S,[])}}e.add(n[3]+1,0,[["exit",f,t]])}return s!==void 0&&(r.end=Object.assign({},ec(t.events,s)),e.add(s,0,[["exit",r,t]]),r=void 0),r}function SM(e,t,n,i,s){const r=[],a=ec(t.events,n);s&&(s.end=Object.assign({},a),r.push(["exit",s,t])),i.end=Object.assign({},a),r.push(["exit",i,t]),e.add(n+1,0,r)}function ec(e,t){const n=e[t],i=n[0]==="enter"?"start":"end";return n[1][i]}const Bie={name:"tasklistCheck",tokenize:Uie};function Fie(){return{text:{91:Bie}}}function Uie(e,t,n){const i=this;return s;function s(l){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(l):(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(l),e.exit("taskListCheckMarker"),r)}function r(l){return Ut(l)?(e.enter("taskListCheckValueUnchecked"),e.consume(l),e.exit("taskListCheckValueUnchecked"),a):l===88||l===120?(e.enter("taskListCheckValueChecked"),e.consume(l),e.exit("taskListCheckValueChecked"),a):n(l)}function a(l){return l===93?(e.enter("taskListCheckMarker"),e.consume(l),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),o):n(l)}function o(l){return $e(l)?t(l):ht(l)?e.check({tokenize:zie},t,n)(l):n(l)}}function zie(e,t,n){return vt(e,i,"whitespace");function i(s){return s===null?n(s):t(s)}}function Hie(e){return EN([fie(),xie(),Lie(e),Oie(),Fie()])}const $ie={};function qie(e){const t=this,n=e||$ie,i=t.data(),s=i.micromarkExtensions||(i.micromarkExtensions=[]),r=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),a=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);s.push(Hie(n)),r.push(cie()),a.push(uie(n))}let Tn=class extends Error{constructor(t){super(t),this.name="ShikiError"}};function Vie(e){return KC(e)}function KC(e){return Array.isArray(e)?Wie(e):e instanceof RegExp?e:typeof e=="object"?Gie(e):e}function Wie(e){let t=[];for(let n=0,i=e.length;n<i;n++)t[n]=KC(e[n]);return t}function Gie(e){let t={};for(let n in e)t[n]=KC(e[n]);return t}function _5(e,...t){return t.forEach(n=>{for(let i in n)e[i]=n[i]}),e}function S5(e){const t=~e.lastIndexOf("/")||~e.lastIndexOf("\\");return t===0?e:~t===e.length-1?S5(e.substring(0,e.length-1)):e.substr(~t+1)}var d_=/\$(\d+)|\${(\d+):\/(downcase|upcase)}/g,ep=class{static hasCaptures(e){return e===null?!1:(d_.lastIndex=0,d_.test(e))}static replaceCaptures(e,t,n){return e.replace(d_,(i,s,r,a)=>{let o=n[parseInt(s||r,10)];if(o){let l=t.substring(o.start,o.end);for(;l[0]===".";)l=l.substring(1);switch(a){case"downcase":return l.toLowerCase();case"upcase":return l.toUpperCase();default:return l}}else return i})}};function C5(e,t){return e<t?-1:e>t?1:0}function x5(e,t){if(e===null&&t===null)return 0;if(!e)return-1;if(!t)return 1;let n=e.length,i=t.length;if(n===i){for(let s=0;s<n;s++){let r=C5(e[s],t[s]);if(r!==0)return r}return 0}return n-i}function CM(e){return!!(/^#[0-9a-f]{6}$/i.test(e)||/^#[0-9a-f]{8}$/i.test(e)||/^#[0-9a-f]{3}$/i.test(e)||/^#[0-9a-f]{4}$/i.test(e))}function w5(e){return e.replace(/[\-\\\{\}\*\+\?\|\^\$\.\,\[\]\(\)\#\s]/g,"\\$&")}var k5=class{constructor(e){this.fn=e}cache=new Map;get(e){if(this.cache.has(e))return this.cache.get(e);const t=this.fn(e);return this.cache.set(e,t),t}},Tm=class{constructor(e,t,n){this._colorMap=e,this._defaults=t,this._root=n}static createFromRawTheme(e,t){return this.createFromParsedTheme(Qie(e),t)}static createFromParsedTheme(e,t){return Xie(e,t)}_cachedMatchRoot=new k5(e=>this._root.match(e));getColorMap(){return this._colorMap.getColorMap()}getDefaults(){return this._defaults}match(e){if(e===null)return this._defaults;const t=e.scopeName,i=this._cachedMatchRoot.get(t).find(s=>Kie(e.parent,s.parentScopes));return i?new T5(i.fontStyle,i.foreground,i.background):null}},h_=class Np{constructor(t,n){this.parent=t,this.scopeName=n}static push(t,n){for(const i of n)t=new Np(t,i);return t}static from(...t){let n=null;for(let i=0;i<t.length;i++)n=new Np(n,t[i]);return n}push(t){return new Np(this,t)}getSegments(){let t=this;const n=[];for(;t;)n.push(t.scopeName),t=t.parent;return n.reverse(),n}toString(){return this.getSegments().join(" ")}extends(t){return this===t?!0:this.parent===null?!1:this.parent.extends(t)}getExtensionIfDefined(t){const n=[];let i=this;for(;i&&i!==t;)n.push(i.scopeName),i=i.parent;return i===t?n.reverse():void 0}};function Kie(e,t){if(t.length===0)return!0;for(let n=0;n<t.length;n++){let i=t[n],s=!1;if(i===">"){if(n===t.length-1)return!1;i=t[++n],s=!0}for(;e&&!Yie(e.scopeName,i);){if(s)return!1;e=e.parent}if(!e)return!1;e=e.parent}return!0}function Yie(e,t){return t===e||e.startsWith(t)&&e[t.length]==="."}var T5=class{constructor(e,t,n){this.fontStyle=e,this.foregroundId=t,this.backgroundId=n}};function Qie(e){if(!e)return[];if(!e.settings||!Array.isArray(e.settings))return[];let t=e.settings,n=[],i=0;for(let s=0,r=t.length;s<r;s++){let a=t[s];if(!a.settings)continue;let o;if(typeof a.scope=="string"){let f=a.scope;f=f.replace(/^[,]+/,""),f=f.replace(/[,]+$/,""),o=f.split(",")}else Array.isArray(a.scope)?o=a.scope:o=[""];let l=-1;if(typeof a.settings.fontStyle=="string"){l=0;let f=a.settings.fontStyle.split(" ");for(let m=0,g=f.length;m<g;m++)switch(f[m]){case"italic":l=l|1;break;case"bold":l=l|2;break;case"underline":l=l|4;break;case"strikethrough":l=l|8;break}}let u=null;typeof a.settings.foreground=="string"&&CM(a.settings.foreground)&&(u=a.settings.foreground);let h=null;typeof a.settings.background=="string"&&CM(a.settings.background)&&(h=a.settings.background);for(let f=0,m=o.length;f<m;f++){let C=o[f].trim().split(" "),S=C[C.length-1],v=null;C.length>1&&(v=C.slice(0,C.length-1),v.reverse()),n[i++]=new Jie(S,v,s,l,u,h)}}return n}var Jie=class{constructor(e,t,n,i,s,r){this.scope=e,this.parentScopes=t,this.index=n,this.fontStyle=i,this.foreground=s,this.background=r}},Fn=(e=>(e[e.NotSet=-1]="NotSet",e[e.None=0]="None",e[e.Italic=1]="Italic",e[e.Bold=2]="Bold",e[e.Underline=4]="Underline",e[e.Strikethrough=8]="Strikethrough",e))(Fn||{});function Xie(e,t){e.sort((l,u)=>{let h=C5(l.scope,u.scope);return h!==0||(h=x5(l.parentScopes,u.parentScopes),h!==0)?h:l.index-u.index});let n=0,i="#000000",s="#ffffff";for(;e.length>=1&&e[0].scope==="";){let l=e.shift();l.fontStyle!==-1&&(n=l.fontStyle),l.foreground!==null&&(i=l.foreground),l.background!==null&&(s=l.background)}let r=new Zie(t),a=new T5(n,r.getId(i),r.getId(s)),o=new tse(new H0(0,null,-1,0,0),[]);for(let l=0,u=e.length;l<u;l++){let h=e[l];o.insert(0,h.scope,h.parentScopes,h.fontStyle,r.getId(h.foreground),r.getId(h.background))}return new Tm(r,a,o)}var Zie=class{_isFrozen;_lastColorId;_id2color;_color2id;constructor(e){if(this._lastColorId=0,this._id2color=[],this._color2id=Object.create(null),Array.isArray(e)){this._isFrozen=!0;for(let t=0,n=e.length;t<n;t++)this._color2id[e[t]]=t,this._id2color[t]=e[t]}else this._isFrozen=!1}getId(e){if(e===null)return 0;e=e.toUpperCase();let t=this._color2id[e];if(t)return t;if(this._isFrozen)throw new Error(`Missing color in color map - ${e}`);return t=++this._lastColorId,this._color2id[e]=t,this._id2color[t]=e,t}getColorMap(){return this._id2color.slice(0)}},ese=Object.freeze([]),H0=class E5{scopeDepth;parentScopes;fontStyle;foreground;background;constructor(t,n,i,s,r){this.scopeDepth=t,this.parentScopes=n||ese,this.fontStyle=i,this.foreground=s,this.background=r}clone(){return new E5(this.scopeDepth,this.parentScopes,this.fontStyle,this.foreground,this.background)}static cloneArr(t){let n=[];for(let i=0,s=t.length;i<s;i++)n[i]=t[i].clone();return n}acceptOverwrite(t,n,i,s){this.scopeDepth>t?console.log("how did this happen?"):this.scopeDepth=t,n!==-1&&(this.fontStyle=n),i!==0&&(this.foreground=i),s!==0&&(this.background=s)}},tse=class $0{constructor(t,n=[],i={}){this._mainRule=t,this._children=i,this._rulesWithParentScopes=n}_rulesWithParentScopes;static _cmpBySpecificity(t,n){if(t.scopeDepth!==n.scopeDepth)return n.scopeDepth-t.scopeDepth;let i=0,s=0;for(;t.parentScopes[i]===">"&&i++,n.parentScopes[s]===">"&&s++,!(i>=t.parentScopes.length||s>=n.parentScopes.length);){const r=n.parentScopes[s].length-t.parentScopes[i].length;if(r!==0)return r;i++,s++}return n.parentScopes.length-t.parentScopes.length}match(t){if(t!==""){let i=t.indexOf("."),s,r;if(i===-1?(s=t,r=""):(s=t.substring(0,i),r=t.substring(i+1)),this._children.hasOwnProperty(s))return this._children[s].match(r)}const n=this._rulesWithParentScopes.concat(this._mainRule);return n.sort($0._cmpBySpecificity),n}insert(t,n,i,s,r,a){if(n===""){this._doInsertHere(t,i,s,r,a);return}let o=n.indexOf("."),l,u;o===-1?(l=n,u=""):(l=n.substring(0,o),u=n.substring(o+1));let h;this._children.hasOwnProperty(l)?h=this._children[l]:(h=new $0(this._mainRule.clone(),H0.cloneArr(this._rulesWithParentScopes)),this._children[l]=h),h.insert(t+1,u,i,s,r,a)}_doInsertHere(t,n,i,s,r){if(n===null){this._mainRule.acceptOverwrite(t,i,s,r);return}for(let a=0,o=this._rulesWithParentScopes.length;a<o;a++){let l=this._rulesWithParentScopes[a];if(x5(l.parentScopes,n)===0){l.acceptOverwrite(t,i,s,r);return}}i===-1&&(i=this._mainRule.fontStyle),s===0&&(s=this._mainRule.foreground),r===0&&(r=this._mainRule.background),this._rulesWithParentScopes.push(new H0(t,n,i,s,r))}},Ec=class Wi{static toBinaryStr(t){return t.toString(2).padStart(32,"0")}static print(t){const n=Wi.getLanguageId(t),i=Wi.getTokenType(t),s=Wi.getFontStyle(t),r=Wi.getForeground(t),a=Wi.getBackground(t);console.log({languageId:n,tokenType:i,fontStyle:s,foreground:r,background:a})}static getLanguageId(t){return(t&255)>>>0}static getTokenType(t){return(t&768)>>>8}static containsBalancedBrackets(t){return(t&1024)!==0}static getFontStyle(t){return(t&30720)>>>11}static getForeground(t){return(t&16744448)>>>15}static getBackground(t){return(t&4278190080)>>>24}static set(t,n,i,s,r,a,o){let l=Wi.getLanguageId(t),u=Wi.getTokenType(t),h=Wi.containsBalancedBrackets(t)?1:0,f=Wi.getFontStyle(t),m=Wi.getForeground(t),g=Wi.getBackground(t);return n!==0&&(l=n),i!==8&&(u=i),s!==null&&(h=s?1:0),r!==-1&&(f=r),a!==0&&(m=a),o!==0&&(g=o),(l<<0|u<<8|h<<10|f<<11|m<<15|g<<24)>>>0}};function Em(e,t){const n=[],i=nse(e);let s=i.next();for(;s!==null;){let l=0;if(s.length===2&&s.charAt(1)===":"){switch(s.charAt(0)){case"R":l=1;break;case"L":l=-1;break;default:console.log(`Unknown priority ${s} in scope selector`)}s=i.next()}let u=a();if(n.push({matcher:u,priority:l}),s!==",")break;s=i.next()}return n;function r(){if(s==="-"){s=i.next();const l=r();return u=>!!l&&!l(u)}if(s==="("){s=i.next();const l=o();return s===")"&&(s=i.next()),l}if(xM(s)){const l=[];do l.push(s),s=i.next();while(xM(s));return u=>t(l,u)}return null}function a(){const l=[];let u=r();for(;u;)l.push(u),u=r();return h=>l.every(f=>f(h))}function o(){const l=[];let u=a();for(;u&&(l.push(u),s==="|"||s===",");){do s=i.next();while(s==="|"||s===",");u=a()}return h=>l.some(f=>f(h))}}function xM(e){return!!e&&!!e.match(/[\w\.:]+/)}function nse(e){let t=/([LR]:|[\w\.:][\w\.:\-]*|[\,\|\-\(\)])/g,n=t.exec(e);return{next:()=>{if(!n)return null;const i=n[0];return n=t.exec(e),i}}}function R5(e){typeof e.dispose=="function"&&e.dispose()}var Kd=class{constructor(e){this.scopeName=e}toKey(){return this.scopeName}},ise=class{constructor(e,t){this.scopeName=e,this.ruleName=t}toKey(){return`${this.scopeName}#${this.ruleName}`}},sse=class{_references=[];_seenReferenceKeys=new Set;get references(){return this._references}visitedRule=new Set;add(e){const t=e.toKey();this._seenReferenceKeys.has(t)||(this._seenReferenceKeys.add(t),this._references.push(e))}},rse=class{constructor(e,t){this.repo=e,this.initialScopeName=t,this.seenFullScopeRequests.add(this.initialScopeName),this.Q=[new Kd(this.initialScopeName)]}seenFullScopeRequests=new Set;seenPartialScopeRequests=new Set;Q;processQueue(){const e=this.Q;this.Q=[];const t=new sse;for(const n of e)ose(n,this.initialScopeName,this.repo,t);for(const n of t.references)if(n instanceof Kd){if(this.seenFullScopeRequests.has(n.scopeName))continue;this.seenFullScopeRequests.add(n.scopeName),this.Q.push(n)}else{if(this.seenFullScopeRequests.has(n.scopeName)||this.seenPartialScopeRequests.has(n.toKey()))continue;this.seenPartialScopeRequests.add(n.toKey()),this.Q.push(n)}}};function ose(e,t,n,i){const s=n.lookup(e.scopeName);if(!s){if(e.scopeName===t)throw new Error(`No grammar provided for <${t}>`);return}const r=n.lookup(t);e instanceof Kd?jp({baseGrammar:r,selfGrammar:s},i):q0(e.ruleName,{baseGrammar:r,selfGrammar:s,repository:s.repository},i);const a=n.injections(e.scopeName);if(a)for(const o of a)i.add(new Kd(o))}function q0(e,t,n){if(t.repository&&t.repository[e]){const i=t.repository[e];Rm([i],t,n)}}function jp(e,t){e.selfGrammar.patterns&&Array.isArray(e.selfGrammar.patterns)&&Rm(e.selfGrammar.patterns,{...e,repository:e.selfGrammar.repository},t),e.selfGrammar.injections&&Rm(Object.values(e.selfGrammar.injections),{...e,repository:e.selfGrammar.repository},t)}function Rm(e,t,n){for(const i of e){if(n.visitedRule.has(i))continue;n.visitedRule.add(i);const s=i.repository?_5({},t.repository,i.repository):t.repository;Array.isArray(i.patterns)&&Rm(i.patterns,{...t,repository:s},n);const r=i.include;if(!r)continue;const a=A5(r);switch(a.kind){case 0:jp({...t,selfGrammar:t.baseGrammar},n);break;case 1:jp(t,n);break;case 2:q0(a.ruleName,{...t,repository:s},n);break;case 3:case 4:const o=a.scopeName===t.selfGrammar.scopeName?t.selfGrammar:a.scopeName===t.baseGrammar.scopeName?t.baseGrammar:void 0;if(o){const l={baseGrammar:t.baseGrammar,selfGrammar:o,repository:s};a.kind===4?q0(a.ruleName,l,n):jp(l,n)}else a.kind===4?n.add(new ise(a.scopeName,a.ruleName)):n.add(new Kd(a.scopeName));break}}}var ase=class{kind=0},lse=class{kind=1},cse=class{constructor(e){this.ruleName=e}kind=2},use=class{constructor(e){this.scopeName=e}kind=3},dse=class{constructor(e,t){this.scopeName=e,this.ruleName=t}kind=4};function A5(e){if(e==="$base")return new ase;if(e==="$self")return new lse;const t=e.indexOf("#");if(t===-1)return new use(e);if(t===0)return new cse(e.substring(1));{const n=e.substring(0,t),i=e.substring(t+1);return new dse(n,i)}}var hse=/\\(\d+)/,wM=/\\(\d+)/g,fse=-1,M5=-2;var hh=class{$location;id;_nameIsCapturing;_name;_contentNameIsCapturing;_contentName;constructor(e,t,n,i){this.$location=e,this.id=t,this._name=n||null,this._nameIsCapturing=ep.hasCaptures(this._name),this._contentName=i||null,this._contentNameIsCapturing=ep.hasCaptures(this._contentName)}get debugName(){const e=this.$location?`${S5(this.$location.filename)}:${this.$location.line}`:"unknown";return`${this.constructor.name}#${this.id} @ ${e}`}getName(e,t){return!this._nameIsCapturing||this._name===null||e===null||t===null?this._name:ep.replaceCaptures(this._name,e,t)}getContentName(e,t){return!this._contentNameIsCapturing||this._contentName===null?this._contentName:ep.replaceCaptures(this._contentName,e,t)}},pse=class extends hh{retokenizeCapturedWithRuleId;constructor(e,t,n,i,s){super(e,t,n,i),this.retokenizeCapturedWithRuleId=s}dispose(){}collectPatterns(e,t){throw new Error("Not supported!")}compile(e,t){throw new Error("Not supported!")}compileAG(e,t,n,i){throw new Error("Not supported!")}},mse=class extends hh{_match;captures;_cachedCompiledPatterns;constructor(e,t,n,i,s){super(e,t,n,null),this._match=new Yd(i,this.id),this.captures=s,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugMatchRegExp(){return`${this._match.source}`}collectPatterns(e,t){t.push(this._match)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,n,i){return this._getCachedCompiledPatterns(e).compileAG(e,n,i)}_getCachedCompiledPatterns(e){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new Qd,this.collectPatterns(e,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},kM=class extends hh{hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(e,t,n,i,s){super(e,t,n,i),this.patterns=s.patterns,this.hasMissingPatterns=s.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}collectPatterns(e,t){for(const n of this.patterns)e.getRule(n).collectPatterns(e,t)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,n,i){return this._getCachedCompiledPatterns(e).compileAG(e,n,i)}_getCachedCompiledPatterns(e){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new Qd,this.collectPatterns(e,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},V0=class extends hh{_begin;beginCaptures;_end;endHasBackReferences;endCaptures;applyEndPatternLast;hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(e,t,n,i,s,r,a,o,l,u){super(e,t,n,i),this._begin=new Yd(s,this.id),this.beginCaptures=r,this._end=new Yd(a||"",-1),this.endHasBackReferences=this._end.hasBackReferences,this.endCaptures=o,this.applyEndPatternLast=l||!1,this.patterns=u.patterns,this.hasMissingPatterns=u.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugEndRegExp(){return`${this._end.source}`}getEndWithResolvedBackReferences(e,t){return this._end.resolveBackReferences(e,t)}collectPatterns(e,t){t.push(this._begin)}compile(e,t){return this._getCachedCompiledPatterns(e,t).compile(e)}compileAG(e,t,n,i){return this._getCachedCompiledPatterns(e,t).compileAG(e,n,i)}_getCachedCompiledPatterns(e,t){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new Qd;for(const n of this.patterns)e.getRule(n).collectPatterns(e,this._cachedCompiledPatterns);this.applyEndPatternLast?this._cachedCompiledPatterns.push(this._end.hasBackReferences?this._end.clone():this._end):this._cachedCompiledPatterns.unshift(this._end.hasBackReferences?this._end.clone():this._end)}return this._end.hasBackReferences&&(this.applyEndPatternLast?this._cachedCompiledPatterns.setSource(this._cachedCompiledPatterns.length()-1,t):this._cachedCompiledPatterns.setSource(0,t)),this._cachedCompiledPatterns}},Am=class extends hh{_begin;beginCaptures;whileCaptures;_while;whileHasBackReferences;hasMissingPatterns;patterns;_cachedCompiledPatterns;_cachedCompiledWhilePatterns;constructor(e,t,n,i,s,r,a,o,l){super(e,t,n,i),this._begin=new Yd(s,this.id),this.beginCaptures=r,this.whileCaptures=o,this._while=new Yd(a,M5),this.whileHasBackReferences=this._while.hasBackReferences,this.patterns=l.patterns,this.hasMissingPatterns=l.hasMissingPatterns,this._cachedCompiledPatterns=null,this._cachedCompiledWhilePatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null),this._cachedCompiledWhilePatterns&&(this._cachedCompiledWhilePatterns.dispose(),this._cachedCompiledWhilePatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugWhileRegExp(){return`${this._while.source}`}getWhileWithResolvedBackReferences(e,t){return this._while.resolveBackReferences(e,t)}collectPatterns(e,t){t.push(this._begin)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,n,i){return this._getCachedCompiledPatterns(e).compileAG(e,n,i)}_getCachedCompiledPatterns(e){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new Qd;for(const t of this.patterns)e.getRule(t).collectPatterns(e,this._cachedCompiledPatterns)}return this._cachedCompiledPatterns}compileWhile(e,t){return this._getCachedCompiledWhilePatterns(e,t).compile(e)}compileWhileAG(e,t,n,i){return this._getCachedCompiledWhilePatterns(e,t).compileAG(e,n,i)}_getCachedCompiledWhilePatterns(e,t){return this._cachedCompiledWhilePatterns||(this._cachedCompiledWhilePatterns=new Qd,this._cachedCompiledWhilePatterns.push(this._while.hasBackReferences?this._while.clone():this._while)),this._while.hasBackReferences&&this._cachedCompiledWhilePatterns.setSource(0,t||""),this._cachedCompiledWhilePatterns}},L5=class jn{static createCaptureRule(t,n,i,s,r){return t.registerRule(a=>new pse(n,a,i,s,r))}static getCompiledRuleId(t,n,i){return t.id||n.registerRule(s=>{if(t.id=s,t.match)return new mse(t.$vscodeTextmateLocation,t.id,t.name,t.match,jn._compileCaptures(t.captures,n,i));if(typeof t.begin>"u"){t.repository&&(i=_5({},i,t.repository));let r=t.patterns;return typeof r>"u"&&t.include&&(r=[{include:t.include}]),new kM(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,jn._compilePatterns(r,n,i))}return t.while?new Am(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,t.begin,jn._compileCaptures(t.beginCaptures||t.captures,n,i),t.while,jn._compileCaptures(t.whileCaptures||t.captures,n,i),jn._compilePatterns(t.patterns,n,i)):new V0(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,t.begin,jn._compileCaptures(t.beginCaptures||t.captures,n,i),t.end,jn._compileCaptures(t.endCaptures||t.captures,n,i),t.applyEndPatternLast,jn._compilePatterns(t.patterns,n,i))}),t.id}static _compileCaptures(t,n,i){let s=[];if(t){let r=0;for(const a in t){if(a==="$vscodeTextmateLocation")continue;const o=parseInt(a,10);o>r&&(r=o)}for(let a=0;a<=r;a++)s[a]=null;for(const a in t){if(a==="$vscodeTextmateLocation")continue;const o=parseInt(a,10);let l=0;t[a].patterns&&(l=jn.getCompiledRuleId(t[a],n,i)),s[o]=jn.createCaptureRule(n,t[a].$vscodeTextmateLocation,t[a].name,t[a].contentName,l)}}return s}static _compilePatterns(t,n,i){let s=[];if(t)for(let r=0,a=t.length;r<a;r++){const o=t[r];let l=-1;if(o.include){const u=A5(o.include);switch(u.kind){case 0:case 1:l=jn.getCompiledRuleId(i[o.include],n,i);break;case 2:let h=i[u.ruleName];h&&(l=jn.getCompiledRuleId(h,n,i));break;case 3:case 4:const f=u.scopeName,m=u.kind===4?u.ruleName:null,g=n.getExternalGrammar(f,i);if(g)if(m){let C=g.repository[m];C&&(l=jn.getCompiledRuleId(C,n,g.repository))}else l=jn.getCompiledRuleId(g.repository.$self,n,g.repository);break}}else l=jn.getCompiledRuleId(o,n,i);if(l!==-1){const u=n.getRule(l);let h=!1;if((u instanceof kM||u instanceof V0||u instanceof Am)&&u.hasMissingPatterns&&u.patterns.length===0&&(h=!0),h)continue;s.push(l)}}return{patterns:s,hasMissingPatterns:(t?t.length:0)!==s.length}}},Yd=class I5{source;ruleId;hasAnchor;hasBackReferences;_anchorCache;constructor(t,n){if(t&&typeof t=="string"){const i=t.length;let s=0,r=[],a=!1;for(let o=0;o<i;o++)if(t.charAt(o)==="\\"&&o+1<i){const u=t.charAt(o+1);u==="z"?(r.push(t.substring(s,o)),r.push("$(?!\\n)(?<!\\n)"),s=o+2):(u==="A"||u==="G")&&(a=!0),o++}this.hasAnchor=a,s===0?this.source=t:(r.push(t.substring(s,i)),this.source=r.join(""))}else this.hasAnchor=!1,this.source=t;this.hasAnchor?this._anchorCache=this._buildAnchorCache():this._anchorCache=null,this.ruleId=n,typeof this.source=="string"?this.hasBackReferences=hse.test(this.source):this.hasBackReferences=!1}clone(){return new I5(this.source,this.ruleId)}setSource(t){this.source!==t&&(this.source=t,this.hasAnchor&&(this._anchorCache=this._buildAnchorCache()))}resolveBackReferences(t,n){if(typeof this.source!="string")throw new Error("This method should only be called if the source is a string");let i=n.map(s=>t.substring(s.start,s.end));return wM.lastIndex=0,this.source.replace(wM,(s,r)=>w5(i[parseInt(r,10)]||""))}_buildAnchorCache(){if(typeof this.source!="string")throw new Error("This method should only be called if the source is a string");let t=[],n=[],i=[],s=[],r,a,o,l;for(r=0,a=this.source.length;r<a;r++)o=this.source.charAt(r),t[r]=o,n[r]=o,i[r]=o,s[r]=o,o==="\\"&&r+1<a&&(l=this.source.charAt(r+1),l==="A"?(t[r+1]="",n[r+1]="",i[r+1]="A",s[r+1]="A"):l==="G"?(t[r+1]="",n[r+1]="G",i[r+1]="",s[r+1]="G"):(t[r+1]=l,n[r+1]=l,i[r+1]=l,s[r+1]=l),r++);return{A0_G0:t.join(""),A0_G1:n.join(""),A1_G0:i.join(""),A1_G1:s.join("")}}resolveAnchors(t,n){return!this.hasAnchor||!this._anchorCache||typeof this.source!="string"?this.source:t?n?this._anchorCache.A1_G1:this._anchorCache.A1_G0:n?this._anchorCache.A0_G1:this._anchorCache.A0_G0}},Qd=class{_items;_hasAnchors;_cached;_anchorCache;constructor(){this._items=[],this._hasAnchors=!1,this._cached=null,this._anchorCache={A0_G0:null,A0_G1:null,A1_G0:null,A1_G1:null}}dispose(){this._disposeCaches()}_disposeCaches(){this._cached&&(this._cached.dispose(),this._cached=null),this._anchorCache.A0_G0&&(this._anchorCache.A0_G0.dispose(),this._anchorCache.A0_G0=null),this._anchorCache.A0_G1&&(this._anchorCache.A0_G1.dispose(),this._anchorCache.A0_G1=null),this._anchorCache.A1_G0&&(this._anchorCache.A1_G0.dispose(),this._anchorCache.A1_G0=null),this._anchorCache.A1_G1&&(this._anchorCache.A1_G1.dispose(),this._anchorCache.A1_G1=null)}push(e){this._items.push(e),this._hasAnchors=this._hasAnchors||e.hasAnchor}unshift(e){this._items.unshift(e),this._hasAnchors=this._hasAnchors||e.hasAnchor}length(){return this._items.length}setSource(e,t){this._items[e].source!==t&&(this._disposeCaches(),this._items[e].setSource(t))}compile(e){if(!this._cached){let t=this._items.map(n=>n.source);this._cached=new TM(e,t,this._items.map(n=>n.ruleId))}return this._cached}compileAG(e,t,n){return this._hasAnchors?t?n?(this._anchorCache.A1_G1||(this._anchorCache.A1_G1=this._resolveAnchors(e,t,n)),this._anchorCache.A1_G1):(this._anchorCache.A1_G0||(this._anchorCache.A1_G0=this._resolveAnchors(e,t,n)),this._anchorCache.A1_G0):n?(this._anchorCache.A0_G1||(this._anchorCache.A0_G1=this._resolveAnchors(e,t,n)),this._anchorCache.A0_G1):(this._anchorCache.A0_G0||(this._anchorCache.A0_G0=this._resolveAnchors(e,t,n)),this._anchorCache.A0_G0):this.compile(e)}_resolveAnchors(e,t,n){let i=this._items.map(s=>s.resolveAnchors(t,n));return new TM(e,i,this._items.map(s=>s.ruleId))}},TM=class{constructor(e,t,n){this.regExps=t,this.rules=n,this.scanner=e.createOnigScanner(t)}scanner;dispose(){typeof this.scanner.dispose=="function"&&this.scanner.dispose()}toString(){const e=[];for(let t=0,n=this.rules.length;t<n;t++)e.push("   - "+this.rules[t]+": "+this.regExps[t]);return e.join(`
`)}findNextMatchSync(e,t,n){const i=this.scanner.findNextMatchSync(e,t,n);return i?{ruleId:this.rules[i.index],captureIndices:i.captureIndices}:null}},f_=class{constructor(e,t){this.languageId=e,this.tokenType=t}},gse=class W0{_defaultAttributes;_embeddedLanguagesMatcher;constructor(t,n){this._defaultAttributes=new f_(t,8),this._embeddedLanguagesMatcher=new vse(Object.entries(n||{}))}getDefaultAttributes(){return this._defaultAttributes}getBasicScopeAttributes(t){return t===null?W0._NULL_SCOPE_METADATA:this._getBasicScopeAttributes.get(t)}static _NULL_SCOPE_METADATA=new f_(0,0);_getBasicScopeAttributes=new k5(t=>{const n=this._scopeToLanguage(t),i=this._toStandardTokenType(t);return new f_(n,i)});_scopeToLanguage(t){return this._embeddedLanguagesMatcher.match(t)||0}_toStandardTokenType(t){const n=t.match(W0.STANDARD_TOKEN_TYPE_REGEXP);if(!n)return 8;switch(n[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"meta.embedded":return 0}throw new Error("Unexpected match for standard token type!")}static STANDARD_TOKEN_TYPE_REGEXP=/\b(comment|string|regex|meta\.embedded)\b/},vse=class{values;scopesRegExp;constructor(e){if(e.length===0)this.values=null,this.scopesRegExp=null;else{this.values=new Map(e);const t=e.map(([n,i])=>w5(n));t.sort(),t.reverse(),this.scopesRegExp=new RegExp(`^((${t.join(")|(")}))($|\\.)`,"")}}match(e){if(!this.scopesRegExp)return;const t=e.match(this.scopesRegExp);if(t)return this.values.get(t[1])}},EM=class{constructor(e,t){this.stack=e,this.stoppedEarly=t}};function P5(e,t,n,i,s,r,a,o){const l=t.content.length;let u=!1,h=-1;if(a){const g=bse(e,t,n,i,s,r);s=g.stack,i=g.linePos,n=g.isFirstLine,h=g.anchorPosition}const f=Date.now();for(;!u;){if(o!==0&&Date.now()-f>o)return new EM(s,!0);m()}return new EM(s,!1);function m(){const g=yse(e,t,n,i,s,h);if(!g){r.produce(s,l),u=!0;return}const C=g.captureIndices,S=g.matchedRuleId,v=C&&C.length>0?C[0].end>i:!1;if(S===fse){const _=s.getRule(e);r.produce(s,C[0].start),s=s.withContentNameScopesList(s.nameScopesList),ed(e,t,n,s,r,_.endCaptures,C),r.produce(s,C[0].end);const w=s;if(s=s.parent,h=w.getAnchorPos(),!v&&w.getEnterPos()===i){s=w,r.produce(s,l),u=!0;return}}else{const _=e.getRule(S);r.produce(s,C[0].start);const w=s,x=_.getName(t.content,C),k=s.contentNameScopesList.pushAttributed(x,e);if(s=s.push(S,i,h,C[0].end===l,null,k,k),_ instanceof V0){const A=_;ed(e,t,n,s,r,A.beginCaptures,C),r.produce(s,C[0].end),h=C[0].end;const T=A.getContentName(t.content,C),M=k.pushAttributed(T,e);if(s=s.withContentNameScopesList(M),A.endHasBackReferences&&(s=s.withEndRule(A.getEndWithResolvedBackReferences(t.content,C))),!v&&w.hasSameRuleAs(s)){s=s.pop(),r.produce(s,l),u=!0;return}}else if(_ instanceof Am){const A=_;ed(e,t,n,s,r,A.beginCaptures,C),r.produce(s,C[0].end),h=C[0].end;const T=A.getContentName(t.content,C),M=k.pushAttributed(T,e);if(s=s.withContentNameScopesList(M),A.whileHasBackReferences&&(s=s.withEndRule(A.getWhileWithResolvedBackReferences(t.content,C))),!v&&w.hasSameRuleAs(s)){s=s.pop(),r.produce(s,l),u=!0;return}}else if(ed(e,t,n,s,r,_.captures,C),r.produce(s,C[0].end),s=s.pop(),!v){s=s.safePop(),r.produce(s,l),u=!0;return}}C[0].end>i&&(i=C[0].end,n=!1)}}function bse(e,t,n,i,s,r){let a=s.beginRuleCapturedEOL?0:-1;const o=[];for(let l=s;l;l=l.pop()){const u=l.getRule(e);u instanceof Am&&o.push({rule:u,stack:l})}for(let l=o.pop();l;l=o.pop()){const{ruleScanner:u,findOptions:h}=Cse(l.rule,e,l.stack.endRule,n,i===a),f=u.findNextMatchSync(t,i,h);if(f){if(f.ruleId!==M5){s=l.stack.pop();break}f.captureIndices&&f.captureIndices.length&&(r.produce(l.stack,f.captureIndices[0].start),ed(e,t,n,l.stack,r,l.rule.whileCaptures,f.captureIndices),r.produce(l.stack,f.captureIndices[0].end),a=f.captureIndices[0].end,f.captureIndices[0].end>i&&(i=f.captureIndices[0].end,n=!1))}else{s=l.stack.pop();break}}return{stack:s,linePos:i,anchorPosition:a,isFirstLine:n}}function yse(e,t,n,i,s,r){const a=_se(e,t,n,i,s,r),o=e.getInjections();if(o.length===0)return a;const l=Sse(o,e,t,n,i,s,r);if(!l)return a;if(!a)return l;const u=a.captureIndices[0].start,h=l.captureIndices[0].start;return h<u||l.priorityMatch&&h===u?l:a}function _se(e,t,n,i,s,r){const a=s.getRule(e),{ruleScanner:o,findOptions:l}=D5(a,e,s.endRule,n,i===r),u=o.findNextMatchSync(t,i,l);return u?{captureIndices:u.captureIndices,matchedRuleId:u.ruleId}:null}function Sse(e,t,n,i,s,r,a){let o=Number.MAX_VALUE,l=null,u,h=0;const f=r.contentNameScopesList.getScopeNames();for(let m=0,g=e.length;m<g;m++){const C=e[m];if(!C.matcher(f))continue;const S=t.getRule(C.ruleId),{ruleScanner:v,findOptions:_}=D5(S,t,null,i,s===a),w=v.findNextMatchSync(n,s,_);if(!w)continue;const x=w.captureIndices[0].start;if(!(x>=o)&&(o=x,l=w.captureIndices,u=w.ruleId,h=C.priority,o===s))break}return l?{priorityMatch:h===-1,captureIndices:l,matchedRuleId:u}:null}function D5(e,t,n,i,s){return{ruleScanner:e.compileAG(t,n,i,s),findOptions:0}}function Cse(e,t,n,i,s){return{ruleScanner:e.compileWhileAG(t,n,i,s),findOptions:0}}function ed(e,t,n,i,s,r,a){if(r.length===0)return;const o=t.content,l=Math.min(r.length,a.length),u=[],h=a[0].end;for(let f=0;f<l;f++){const m=r[f];if(m===null)continue;const g=a[f];if(g.length===0)continue;if(g.start>h)break;for(;u.length>0&&u[u.length-1].endPos<=g.start;)s.produceFromScopes(u[u.length-1].scopes,u[u.length-1].endPos),u.pop();if(u.length>0?s.produceFromScopes(u[u.length-1].scopes,g.start):s.produce(i,g.start),m.retokenizeCapturedWithRuleId){const S=m.getName(o,a),v=i.contentNameScopesList.pushAttributed(S,e),_=m.getContentName(o,a),w=v.pushAttributed(_,e),x=i.push(m.retokenizeCapturedWithRuleId,g.start,-1,!1,null,v,w),k=e.createOnigString(o.substring(0,g.end));P5(e,k,n&&g.start===0,g.start,x,s,!1,0),R5(k);continue}const C=m.getName(o,a);if(C!==null){const v=(u.length>0?u[u.length-1].scopes:i.contentNameScopesList).pushAttributed(C,e);u.push(new xse(v,g.end))}}for(;u.length>0;)s.produceFromScopes(u[u.length-1].scopes,u[u.length-1].endPos),u.pop()}var xse=class{scopes;endPos;constructor(e,t){this.scopes=e,this.endPos=t}};function wse(e,t,n,i,s,r,a,o){return new Tse(e,t,n,i,s,r,a,o)}function RM(e,t,n,i,s){const r=Em(t,Mm),a=L5.getCompiledRuleId(n,i,s.repository);for(const o of r)e.push({debugSelector:t,matcher:o.matcher,ruleId:a,grammar:s,priority:o.priority})}function Mm(e,t){if(t.length<e.length)return!1;let n=0;return e.every(i=>{for(let s=n;s<t.length;s++)if(kse(t[s],i))return n=s+1,!0;return!1})}function kse(e,t){if(!e)return!1;if(e===t)return!0;const n=t.length;return e.length>n&&e.substr(0,n)===t&&e[n]==="."}var Tse=class{constructor(e,t,n,i,s,r,a,o){if(this._rootScopeName=e,this.balancedBracketSelectors=r,this._onigLib=o,this._basicScopeAttributesProvider=new gse(n,i),this._rootId=-1,this._lastRuleId=0,this._ruleId2desc=[null],this._includedGrammars={},this._grammarRepository=a,this._grammar=AM(t,null),this._injections=null,this._tokenTypeMatchers=[],s)for(const l of Object.keys(s)){const u=Em(l,Mm);for(const h of u)this._tokenTypeMatchers.push({matcher:h.matcher,type:s[l]})}}_rootId;_lastRuleId;_ruleId2desc;_includedGrammars;_grammarRepository;_grammar;_injections;_basicScopeAttributesProvider;_tokenTypeMatchers;get themeProvider(){return this._grammarRepository}dispose(){for(const e of this._ruleId2desc)e&&e.dispose()}createOnigScanner(e){return this._onigLib.createOnigScanner(e)}createOnigString(e){return this._onigLib.createOnigString(e)}getMetadataForScope(e){return this._basicScopeAttributesProvider.getBasicScopeAttributes(e)}_collectInjections(){const e={lookup:s=>s===this._rootScopeName?this._grammar:this.getExternalGrammar(s),injections:s=>this._grammarRepository.injections(s)},t=[],n=this._rootScopeName,i=e.lookup(n);if(i){const s=i.injections;if(s)for(let a in s)RM(t,a,s[a],this,i);const r=this._grammarRepository.injections(n);r&&r.forEach(a=>{const o=this.getExternalGrammar(a);if(o){const l=o.injectionSelector;l&&RM(t,l,o,this,o)}})}return t.sort((s,r)=>s.priority-r.priority),t}getInjections(){return this._injections===null&&(this._injections=this._collectInjections()),this._injections}registerRule(e){const t=++this._lastRuleId,n=e(t);return this._ruleId2desc[t]=n,n}getRule(e){return this._ruleId2desc[e]}getExternalGrammar(e,t){if(this._includedGrammars[e])return this._includedGrammars[e];if(this._grammarRepository){const n=this._grammarRepository.lookup(e);if(n)return this._includedGrammars[e]=AM(n,t&&t.$base),this._includedGrammars[e]}}tokenizeLine(e,t,n=0){const i=this._tokenize(e,t,!1,n);return{tokens:i.lineTokens.getResult(i.ruleStack,i.lineLength),ruleStack:i.ruleStack,stoppedEarly:i.stoppedEarly}}tokenizeLine2(e,t,n=0){const i=this._tokenize(e,t,!0,n);return{tokens:i.lineTokens.getBinaryResult(i.ruleStack,i.lineLength),ruleStack:i.ruleStack,stoppedEarly:i.stoppedEarly}}_tokenize(e,t,n,i){this._rootId===-1&&(this._rootId=L5.getCompiledRuleId(this._grammar.repository.$self,this,this._grammar.repository),this.getInjections());let s;if(!t||t===G0.NULL){s=!0;const u=this._basicScopeAttributesProvider.getDefaultAttributes(),h=this.themeProvider.getDefaults(),f=Ec.set(0,u.languageId,u.tokenType,null,h.fontStyle,h.foregroundId,h.backgroundId),m=this.getRule(this._rootId).getName(null,null);let g;m?g=yd.createRootAndLookUpScopeName(m,f,this):g=yd.createRoot("unknown",f),t=new G0(null,this._rootId,-1,-1,!1,null,g,g)}else s=!1,t.reset();e=e+`
`;const r=this.createOnigString(e),a=r.content.length,o=new Rse(n,e,this._tokenTypeMatchers,this.balancedBracketSelectors),l=P5(this,r,s,0,t,o,!0,i);return R5(r),{lineLength:a,lineTokens:o,ruleStack:l.stack,stoppedEarly:l.stoppedEarly}}};function AM(e,t){return e=Vie(e),e.repository=e.repository||{},e.repository.$self={$vscodeTextmateLocation:e.$vscodeTextmateLocation,patterns:e.patterns,name:e.scopeName},e.repository.$base=t||e.repository.$self,e}var yd=class Ns{constructor(t,n,i){this.parent=t,this.scopePath=n,this.tokenAttributes=i}static fromExtension(t,n){let i=t,s=t?.scopePath??null;for(const r of n)s=h_.push(s,r.scopeNames),i=new Ns(i,s,r.encodedTokenAttributes);return i}static createRoot(t,n){return new Ns(null,new h_(null,t),n)}static createRootAndLookUpScopeName(t,n,i){const s=i.getMetadataForScope(t),r=new h_(null,t),a=i.themeProvider.themeMatch(r),o=Ns.mergeAttributes(n,s,a);return new Ns(null,r,o)}get scopeName(){return this.scopePath.scopeName}toString(){return this.getScopeNames().join(" ")}equals(t){return Ns.equals(this,t)}static equals(t,n){do{if(t===n||!t&&!n)return!0;if(!t||!n||t.scopeName!==n.scopeName||t.tokenAttributes!==n.tokenAttributes)return!1;t=t.parent,n=n.parent}while(!0)}static mergeAttributes(t,n,i){let s=-1,r=0,a=0;return i!==null&&(s=i.fontStyle,r=i.foregroundId,a=i.backgroundId),Ec.set(t,n.languageId,n.tokenType,null,s,r,a)}pushAttributed(t,n){if(t===null)return this;if(t.indexOf(" ")===-1)return Ns._pushAttributed(this,t,n);const i=t.split(/ /g);let s=this;for(const r of i)s=Ns._pushAttributed(s,r,n);return s}static _pushAttributed(t,n,i){const s=i.getMetadataForScope(n),r=t.scopePath.push(n),a=i.themeProvider.themeMatch(r),o=Ns.mergeAttributes(t.tokenAttributes,s,a);return new Ns(t,r,o)}getScopeNames(){return this.scopePath.getSegments()}getExtensionIfDefined(t){const n=[];let i=this;for(;i&&i!==t;)n.push({encodedTokenAttributes:i.tokenAttributes,scopeNames:i.scopePath.getExtensionIfDefined(i.parent?.scopePath??null)}),i=i.parent;return i===t?n.reverse():void 0}},G0=class Ca{constructor(t,n,i,s,r,a,o,l){this.parent=t,this.ruleId=n,this.beginRuleCapturedEOL=r,this.endRule=a,this.nameScopesList=o,this.contentNameScopesList=l,this.depth=this.parent?this.parent.depth+1:1,this._enterPos=i,this._anchorPos=s}_stackElementBrand=void 0;static NULL=new Ca(null,0,0,0,!1,null,null,null);_enterPos;_anchorPos;depth;equals(t){return t===null?!1:Ca._equals(this,t)}static _equals(t,n){return t===n?!0:this._structuralEquals(t,n)?yd.equals(t.contentNameScopesList,n.contentNameScopesList):!1}static _structuralEquals(t,n){do{if(t===n||!t&&!n)return!0;if(!t||!n||t.depth!==n.depth||t.ruleId!==n.ruleId||t.endRule!==n.endRule)return!1;t=t.parent,n=n.parent}while(!0)}clone(){return this}static _reset(t){for(;t;)t._enterPos=-1,t._anchorPos=-1,t=t.parent}reset(){Ca._reset(this)}pop(){return this.parent}safePop(){return this.parent?this.parent:this}push(t,n,i,s,r,a,o){return new Ca(this,t,n,i,s,r,a,o)}getEnterPos(){return this._enterPos}getAnchorPos(){return this._anchorPos}getRule(t){return t.getRule(this.ruleId)}toString(){const t=[];return this._writeString(t,0),"["+t.join(",")+"]"}_writeString(t,n){return this.parent&&(n=this.parent._writeString(t,n)),t[n++]=`(${this.ruleId}, ${this.nameScopesList?.toString()}, ${this.contentNameScopesList?.toString()})`,n}withContentNameScopesList(t){return this.contentNameScopesList===t?this:this.parent.push(this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,this.endRule,this.nameScopesList,t)}withEndRule(t){return this.endRule===t?this:new Ca(this.parent,this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,t,this.nameScopesList,this.contentNameScopesList)}hasSameRuleAs(t){let n=this;for(;n&&n._enterPos===t._enterPos;){if(n.ruleId===t.ruleId)return!0;n=n.parent}return!1}toStateStackFrame(){return{ruleId:this.ruleId,beginRuleCapturedEOL:this.beginRuleCapturedEOL,endRule:this.endRule,nameScopesList:this.nameScopesList?.getExtensionIfDefined(this.parent?.nameScopesList??null)??[],contentNameScopesList:this.contentNameScopesList?.getExtensionIfDefined(this.nameScopesList)??[]}}static pushFrame(t,n){const i=yd.fromExtension(t?.nameScopesList??null,n.nameScopesList);return new Ca(t,n.ruleId,n.enterPos??-1,n.anchorPos??-1,n.beginRuleCapturedEOL,n.endRule,i,yd.fromExtension(i,n.contentNameScopesList))}},Ese=class{balancedBracketScopes;unbalancedBracketScopes;allowAny=!1;constructor(e,t){this.balancedBracketScopes=e.flatMap(n=>n==="*"?(this.allowAny=!0,[]):Em(n,Mm).map(i=>i.matcher)),this.unbalancedBracketScopes=t.flatMap(n=>Em(n,Mm).map(i=>i.matcher))}get matchesAlways(){return this.allowAny&&this.unbalancedBracketScopes.length===0}get matchesNever(){return this.balancedBracketScopes.length===0&&!this.allowAny}match(e){for(const t of this.unbalancedBracketScopes)if(t(e))return!1;for(const t of this.balancedBracketScopes)if(t(e))return!0;return this.allowAny}},Rse=class{constructor(e,t,n,i){this.balancedBracketSelectors=i,this._emitBinaryTokens=e,this._tokenTypeOverrides=n,this._lineText=null,this._tokens=[],this._binaryTokens=[],this._lastTokenEndIndex=0}_emitBinaryTokens;_lineText;_tokens;_binaryTokens;_lastTokenEndIndex;_tokenTypeOverrides;produce(e,t){this.produceFromScopes(e.contentNameScopesList,t)}produceFromScopes(e,t){if(this._lastTokenEndIndex>=t)return;if(this._emitBinaryTokens){let i=e?.tokenAttributes??0,s=!1;if(this.balancedBracketSelectors?.matchesAlways&&(s=!0),this._tokenTypeOverrides.length>0||this.balancedBracketSelectors&&!this.balancedBracketSelectors.matchesAlways&&!this.balancedBracketSelectors.matchesNever){const r=e?.getScopeNames()??[];for(const a of this._tokenTypeOverrides)a.matcher(r)&&(i=Ec.set(i,0,a.type,null,-1,0,0));this.balancedBracketSelectors&&(s=this.balancedBracketSelectors.match(r))}if(s&&(i=Ec.set(i,0,8,s,-1,0,0)),this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-1]===i){this._lastTokenEndIndex=t;return}this._binaryTokens.push(this._lastTokenEndIndex),this._binaryTokens.push(i),this._lastTokenEndIndex=t;return}const n=e?.getScopeNames()??[];this._tokens.push({startIndex:this._lastTokenEndIndex,endIndex:t,scopes:n}),this._lastTokenEndIndex=t}getResult(e,t){return this._tokens.length>0&&this._tokens[this._tokens.length-1].startIndex===t-1&&this._tokens.pop(),this._tokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(e,t),this._tokens[this._tokens.length-1].startIndex=0),this._tokens}getBinaryResult(e,t){this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-2]===t-1&&(this._binaryTokens.pop(),this._binaryTokens.pop()),this._binaryTokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(e,t),this._binaryTokens[this._binaryTokens.length-2]=0);const n=new Uint32Array(this._binaryTokens.length);for(let i=0,s=this._binaryTokens.length;i<s;i++)n[i]=this._binaryTokens[i];return n}},Ase=class{constructor(e,t){this._onigLib=t,this._theme=e}_grammars=new Map;_rawGrammars=new Map;_injectionGrammars=new Map;_theme;dispose(){for(const e of this._grammars.values())e.dispose()}setTheme(e){this._theme=e}getColorMap(){return this._theme.getColorMap()}addGrammar(e,t){this._rawGrammars.set(e.scopeName,e),t&&this._injectionGrammars.set(e.scopeName,t)}lookup(e){return this._rawGrammars.get(e)}injections(e){return this._injectionGrammars.get(e)}getDefaults(){return this._theme.getDefaults()}themeMatch(e){return this._theme.match(e)}grammarForScopeName(e,t,n,i,s){if(!this._grammars.has(e)){let r=this._rawGrammars.get(e);if(!r)return null;this._grammars.set(e,wse(e,r,t,n,i,s,this,this._onigLib))}return this._grammars.get(e)}},Mse=class{_options;_syncRegistry;_ensureGrammarCache;constructor(t){this._options=t,this._syncRegistry=new Ase(Tm.createFromRawTheme(t.theme,t.colorMap),t.onigLib),this._ensureGrammarCache=new Map}dispose(){this._syncRegistry.dispose()}setTheme(t,n){this._syncRegistry.setTheme(Tm.createFromRawTheme(t,n))}getColorMap(){return this._syncRegistry.getColorMap()}loadGrammarWithEmbeddedLanguages(t,n,i){return this.loadGrammarWithConfiguration(t,n,{embeddedLanguages:i})}loadGrammarWithConfiguration(t,n,i){return this._loadGrammar(t,n,i.embeddedLanguages,i.tokenTypes,new Ese(i.balancedBracketSelectors||[],i.unbalancedBracketSelectors||[]))}loadGrammar(t){return this._loadGrammar(t,0,null,null,null)}_loadGrammar(t,n,i,s,r){const a=new rse(this._syncRegistry,t);for(;a.Q.length>0;)a.Q.map(o=>this._loadSingleGrammar(o.scopeName)),a.processQueue();return this._grammarForScopeName(t,n,i,s,r)}_loadSingleGrammar(t){this._ensureGrammarCache.has(t)||(this._doLoadSingleGrammar(t),this._ensureGrammarCache.set(t,!0))}_doLoadSingleGrammar(t){const n=this._options.loadGrammar(t);if(n){const i=typeof this._options.getInjections=="function"?this._options.getInjections(t):void 0;this._syncRegistry.addGrammar(n,i)}}addGrammar(t,n=[],i=0,s=null){return this._syncRegistry.addGrammar(t,n),this._grammarForScopeName(t.scopeName,i,s)}_grammarForScopeName(t,n=0,i=null,s=null,r=null){return this._syncRegistry.grammarForScopeName(t,n,i,s,r)}},K0=G0.NULL;const Lse=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],Ise=/["&'<>`]/g,Pse=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Dse=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,Ose=/[|\\{}()[\]^$+*?.]/g,MM=new WeakMap;function Nse(e,t){if(e=e.replace(t.subset?jse(t.subset):Ise,i),t.subset||t.escapeOnly)return e;return e.replace(Pse,n).replace(Dse,i);function n(s,r,a){return t.format((s.charCodeAt(0)-55296)*1024+s.charCodeAt(1)-56320+65536,a.charCodeAt(r+2),t)}function i(s,r,a){return t.format(s.charCodeAt(0),a.charCodeAt(r+1),t)}}function jse(e){let t=MM.get(e);return t||(t=Bse(e),MM.set(e,t)),t}function Bse(e){const t=[];let n=-1;for(;++n<e.length;)t.push(e[n].replace(Ose,"\\$&"));return new RegExp("(?:"+t.join("|")+")","g")}const Fse=/[\dA-Fa-f]/;function Use(e,t,n){const i="&#x"+e.toString(16).toUpperCase();return n&&t&&!Fse.test(String.fromCharCode(t))?i:i+";"}const zse=/\d/;function Hse(e,t,n){const i="&#"+String(e);return n&&t&&!zse.test(String.fromCharCode(t))?i:i+";"}const $se=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],p_={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:"",euro:""},qse=["cent","copy","divide","gt","lt","not","para","times"],O5={}.hasOwnProperty,Y0={};let tp;for(tp in p_)O5.call(p_,tp)&&(Y0[p_[tp]]=tp);const Vse=/[^\dA-Za-z]/;function Wse(e,t,n,i){const s=String.fromCharCode(e);if(O5.call(Y0,s)){const r=Y0[s],a="&"+r;return n&&$se.includes(r)&&!qse.includes(r)&&(!i||t&&t!==61&&Vse.test(String.fromCharCode(t)))?a:a+";"}return""}function Gse(e,t,n){let i=Use(e,t,n.omitOptionalSemicolons),s;if((n.useNamedReferences||n.useShortestReferences)&&(s=Wse(e,t,n.omitOptionalSemicolons,n.attribute)),(n.useShortestReferences||!s)&&n.useShortestReferences){const r=Hse(e,t,n.omitOptionalSemicolons);r.length<i.length&&(i=r)}return s&&(!n.useShortestReferences||s.length<i.length)?s:i}function bc(e,t){return Nse(e,Object.assign({format:Gse},t))}const Kse=/^>|^->|<!--|-->|--!>|<!-$/g,Yse=[">"],Qse=["<",">"];function Jse(e,t,n,i){return i.settings.bogusComments?"<?"+bc(e.value,Object.assign({},i.settings.characterReferences,{subset:Yse}))+">":"<!--"+e.value.replace(Kse,s)+"-->";function s(r){return bc(r,Object.assign({},i.settings.characterReferences,{subset:Qse}))}}function Xse(e,t,n,i){return"<!"+(i.settings.upperDoctype?"DOCTYPE":"doctype")+(i.settings.tightDoctype?"":" ")+"html>"}const Sn=j5(1),N5=j5(-1),Zse=[];function j5(e){return t;function t(n,i,s){const r=n?n.children:Zse;let a=(i||0)+e,o=r[a];if(!s)for(;o&&hg(o);)a+=e,o=r[a];return o}}const ere={}.hasOwnProperty;function B5(e){return t;function t(n,i,s){return ere.call(e,n.tagName)&&e[n.tagName](n,i,s)}}const YC=B5({body:nre,caption:m_,colgroup:m_,dd:ore,dt:rre,head:m_,html:tre,li:sre,optgroup:are,option:lre,p:ire,rp:LM,rt:LM,tbody:ure,td:IM,tfoot:dre,th:IM,thead:cre,tr:hre});function m_(e,t,n){const i=Sn(n,t,!0);return!i||i.type!=="comment"&&!(i.type==="text"&&hg(i.value.charAt(0)))}function tre(e,t,n){const i=Sn(n,t);return!i||i.type!=="comment"}function nre(e,t,n){const i=Sn(n,t);return!i||i.type!=="comment"}function ire(e,t,n){const i=Sn(n,t);return i?i.type==="element"&&(i.tagName==="address"||i.tagName==="article"||i.tagName==="aside"||i.tagName==="blockquote"||i.tagName==="details"||i.tagName==="div"||i.tagName==="dl"||i.tagName==="fieldset"||i.tagName==="figcaption"||i.tagName==="figure"||i.tagName==="footer"||i.tagName==="form"||i.tagName==="h1"||i.tagName==="h2"||i.tagName==="h3"||i.tagName==="h4"||i.tagName==="h5"||i.tagName==="h6"||i.tagName==="header"||i.tagName==="hgroup"||i.tagName==="hr"||i.tagName==="main"||i.tagName==="menu"||i.tagName==="nav"||i.tagName==="ol"||i.tagName==="p"||i.tagName==="pre"||i.tagName==="section"||i.tagName==="table"||i.tagName==="ul"):!n||!(n.type==="element"&&(n.tagName==="a"||n.tagName==="audio"||n.tagName==="del"||n.tagName==="ins"||n.tagName==="map"||n.tagName==="noscript"||n.tagName==="video"))}function sre(e,t,n){const i=Sn(n,t);return!i||i.type==="element"&&i.tagName==="li"}function rre(e,t,n){const i=Sn(n,t);return!!(i&&i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd"))}function ore(e,t,n){const i=Sn(n,t);return!i||i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd")}function LM(e,t,n){const i=Sn(n,t);return!i||i.type==="element"&&(i.tagName==="rp"||i.tagName==="rt")}function are(e,t,n){const i=Sn(n,t);return!i||i.type==="element"&&i.tagName==="optgroup"}function lre(e,t,n){const i=Sn(n,t);return!i||i.type==="element"&&(i.tagName==="option"||i.tagName==="optgroup")}function cre(e,t,n){const i=Sn(n,t);return!!(i&&i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot"))}function ure(e,t,n){const i=Sn(n,t);return!i||i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot")}function dre(e,t,n){return!Sn(n,t)}function hre(e,t,n){const i=Sn(n,t);return!i||i.type==="element"&&i.tagName==="tr"}function IM(e,t,n){const i=Sn(n,t);return!i||i.type==="element"&&(i.tagName==="td"||i.tagName==="th")}const fre=B5({body:gre,colgroup:vre,head:mre,html:pre,tbody:bre});function pre(e){const t=Sn(e,-1);return!t||t.type!=="comment"}function mre(e){const t=new Set;for(const i of e.children)if(i.type==="element"&&(i.tagName==="base"||i.tagName==="title")){if(t.has(i.tagName))return!1;t.add(i.tagName)}const n=e.children[0];return!n||n.type==="element"}function gre(e){const t=Sn(e,-1,!0);return!t||t.type!=="comment"&&!(t.type==="text"&&hg(t.value.charAt(0)))&&!(t.type==="element"&&(t.tagName==="meta"||t.tagName==="link"||t.tagName==="script"||t.tagName==="style"||t.tagName==="template"))}function vre(e,t,n){const i=N5(n,t),s=Sn(e,-1,!0);return n&&i&&i.type==="element"&&i.tagName==="colgroup"&&YC(i,n.children.indexOf(i),n)?!1:!!(s&&s.type==="element"&&s.tagName==="col")}function bre(e,t,n){const i=N5(n,t),s=Sn(e,-1);return n&&i&&i.type==="element"&&(i.tagName==="thead"||i.tagName==="tbody")&&YC(i,n.children.indexOf(i),n)?!1:!!(s&&s.type==="element"&&s.tagName==="tr")}const np={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function yre(e,t,n,i){const s=i.schema,r=s.space==="svg"?!1:i.settings.omitOptionalTags;let a=s.space==="svg"?i.settings.closeEmptyElements:i.settings.voids.includes(e.tagName.toLowerCase());const o=[];let l;s.space==="html"&&e.tagName==="svg"&&(i.schema=ch);const u=_re(i,e.properties),h=i.all(s.space==="html"&&e.tagName==="template"?e.content:e);return i.schema=s,h&&(a=!1),(u||!r||!fre(e,t,n))&&(o.push("<",e.tagName,u?" "+u:""),a&&(s.space==="svg"||i.settings.closeSelfClosing)&&(l=u.charAt(u.length-1),(!i.settings.tightSelfClosing||l==="/"||l&&l!=='"'&&l!=="'")&&o.push(" "),o.push("/")),o.push(">")),o.push(h),!a&&(!r||!YC(e,t,n))&&o.push("</"+e.tagName+">"),o.join("")}function _re(e,t){const n=[];let i=-1,s;if(t){for(s in t)if(t[s]!==null&&t[s]!==void 0){const r=Sre(e,s,t[s]);r&&n.push(r)}}for(;++i<n.length;){const r=e.settings.tightAttributes?n[i].charAt(n[i].length-1):void 0;i!==n.length-1&&r!=='"'&&r!=="'"&&(n[i]+=" ")}return n.join("")}function Sre(e,t,n){const i=gN(e.schema,t),s=e.settings.allowParseErrors&&e.schema.space==="html"?0:1,r=e.settings.allowDangerousCharacters?0:1;let a=e.quote,o;if(i.overloadedBoolean&&(n===i.attribute||n==="")?n=!0:(i.boolean||i.overloadedBoolean)&&(typeof n!="string"||n===i.attribute||n==="")&&(n=!!n),n==null||n===!1||typeof n=="number"&&Number.isNaN(n))return"";const l=bc(i.attribute,Object.assign({},e.settings.characterReferences,{subset:np.name[s][r]}));return n===!0||(n=Array.isArray(n)?(i.commaSeparated?lN:bN)(n,{padLeft:!e.settings.tightCommaSeparatedLists}):String(n),e.settings.collapseEmptyAttributes&&!n)?l:(e.settings.preferUnquoted&&(o=bc(n,Object.assign({},e.settings.characterReferences,{attribute:!0,subset:np.unquoted[s][r]}))),o!==n&&(e.settings.quoteSmart&&wm(n,a)>wm(n,e.alternative)&&(a=e.alternative),o=a+bc(n,Object.assign({},e.settings.characterReferences,{subset:(a==="'"?np.single:np.double)[s][r],attribute:!0}))+a),l+(o&&"="+o))}const Cre=["<","&"];function F5(e,t,n,i){return n&&n.type==="element"&&(n.tagName==="script"||n.tagName==="style")?e.value:bc(e.value,Object.assign({},i.settings.characterReferences,{subset:Cre}))}function xre(e,t,n,i){return i.settings.allowDangerousHtml?e.value:F5(e,t,n,i)}function wre(e,t,n,i){return i.all(e)}const kre=yne("type",{invalid:Tre,unknown:Ere,handlers:{comment:Jse,doctype:Xse,element:yre,raw:xre,root:wre,text:F5}});function Tre(e){throw new Error("Expected node, not `"+e+"`")}function Ere(e){const t=e;throw new Error("Cannot compile unknown node `"+t.type+"`")}const Rre={},Are={},Mre=[];function Lre(e,t){const n=t||Rre,i=n.quote||'"',s=i==='"'?"'":'"';if(i!=='"'&&i!=="'")throw new Error("Invalid quote `"+i+"`, expected `'` or `\"`");return{one:Ire,all:Pre,settings:{omitOptionalTags:n.omitOptionalTags||!1,allowParseErrors:n.allowParseErrors||!1,allowDangerousCharacters:n.allowDangerousCharacters||!1,quoteSmart:n.quoteSmart||!1,preferUnquoted:n.preferUnquoted||!1,tightAttributes:n.tightAttributes||!1,upperDoctype:n.upperDoctype||!1,tightDoctype:n.tightDoctype||!1,bogusComments:n.bogusComments||!1,tightCommaSeparatedLists:n.tightCommaSeparatedLists||!1,tightSelfClosing:n.tightSelfClosing||!1,collapseEmptyAttributes:n.collapseEmptyAttributes||!1,allowDangerousHtml:n.allowDangerousHtml||!1,voids:n.voids||Lse,characterReferences:n.characterReferences||Are,closeSelfClosing:n.closeSelfClosing||!1,closeEmptyElements:n.closeEmptyElements||!1},schema:n.space==="svg"?ch:vN,quote:i,alternative:s}.one(Array.isArray(e)?{type:"root",children:e}:e,void 0,void 0)}function Ire(e,t,n){return kre(e,t,n,this)}function Pre(e){const t=[],n=e&&e.children||Mre;let i=-1;for(;++i<n.length;)t[i]=this.one(n[i],i,e);return t.join("")}function Lm(e,t){const n=typeof e=="string"?{}:{...e.colorReplacements},i=typeof e=="string"?e:e.name;for(const[s,r]of Object.entries(t?.colorReplacements||{}))typeof r=="string"?n[s]=r:s===i&&Object.assign(n,r);return n}function Po(e,t){return e&&(t?.[e?.toLowerCase()]||e)}function Dre(e){return Array.isArray(e)?e:[e]}async function U5(e){return Promise.resolve(typeof e=="function"?e():e).then(t=>t.default||t)}function QC(e){return!e||["plaintext","txt","text","plain"].includes(e)}function Ore(e){return e==="ansi"||QC(e)}function JC(e){return e==="none"}function Nre(e){return JC(e)}function z5(e,t){if(!t)return e;e.properties||={},e.properties.class||=[],typeof e.properties.class=="string"&&(e.properties.class=e.properties.class.split(/\s+/g)),Array.isArray(e.properties.class)||(e.properties.class=[]);const n=Array.isArray(t)?t:t.split(/\s+/g);for(const i of n)i&&!e.properties.class.includes(i)&&e.properties.class.push(i);return e}function bg(e,t=!1){if(e.length===0)return[["",0]];const n=e.split(/(\r?\n)/g);let i=0;const s=[];for(let r=0;r<n.length;r+=2){const a=t?n[r]+(n[r+1]||""):n[r];s.push([a,i]),i+=n[r].length,i+=n[r+1]?.length||0}return s}function jre(e){const t=bg(e,!0).map(([s])=>s);function n(s){if(s===e.length)return{line:t.length-1,character:t[t.length-1].length};let r=s,a=0;for(const o of t){if(r<o.length)break;r-=o.length,a++}return{line:a,character:r}}function i(s,r){let a=0;for(let o=0;o<s;o++)a+=t[o].length;return a+=r,a}return{lines:t,indexToPos:n,posToIndex:i}}const XC="light-dark()",Bre=["color","background-color"];function Fre(e,t){let n=0;const i=[];for(const s of t)s>n&&i.push({...e,content:e.content.slice(n,s),offset:e.offset+n}),n=s;return n<e.content.length&&i.push({...e,content:e.content.slice(n),offset:e.offset+n}),i}function Ure(e,t){const n=Array.from(t instanceof Set?t:new Set(t)).sort((i,s)=>i-s);return n.length?e.map(i=>i.flatMap(s=>{const r=n.filter(a=>s.offset<a&&a<s.offset+s.content.length).map(a=>a-s.offset).sort((a,o)=>a-o);return r.length?Fre(s,r):s})):e}function zre(e,t,n,i,s="css-vars"){const r={content:e.content,explanation:e.explanation,offset:e.offset},a=t.map(h=>Im(e.variants[h])),o=new Set(a.flatMap(h=>Object.keys(h))),l={},u=(h,f)=>{const m=f==="color"?"":f==="background-color"?"-bg":`-${f}`;return n+t[h]+(f==="color"?"":m)};return a.forEach((h,f)=>{for(const m of o){const g=h[m]||"inherit";if(f===0&&i&&Bre.includes(m))if(i===XC&&a.length>1){const C=t.findIndex(w=>w==="light"),S=t.findIndex(w=>w==="dark");if(C===-1||S===-1)throw new Tn('When using `defaultColor: "light-dark()"`, you must provide both `light` and `dark` themes');const v=a[C][m]||"inherit",_=a[S][m]||"inherit";l[m]=`light-dark(${v}, ${_})`,s==="css-vars"&&(l[u(f,m)]=g)}else l[m]=g;else s==="css-vars"&&(l[u(f,m)]=g)}}),r.htmlStyle=l,r}function Im(e){const t={};if(e.color&&(t.color=e.color),e.bgColor&&(t["background-color"]=e.bgColor),e.fontStyle){e.fontStyle&Fn.Italic&&(t["font-style"]="italic"),e.fontStyle&Fn.Bold&&(t["font-weight"]="bold");const n=[];e.fontStyle&Fn.Underline&&n.push("underline"),e.fontStyle&Fn.Strikethrough&&n.push("line-through"),n.length&&(t["text-decoration"]=n.join(" "))}return t}function Q0(e){return typeof e=="string"?e:Object.entries(e).map(([t,n])=>`${t}:${n}`).join(";")}const H5=new WeakMap;function yg(e,t){H5.set(e,t)}function Jd(e){return H5.get(e)}class Bc{_stacks={};lang;get themes(){return Object.keys(this._stacks)}get theme(){return this.themes[0]}get _stack(){return this._stacks[this.theme]}static initial(t,n){return new Bc(Object.fromEntries(Dre(n).map(i=>[i,K0])),t)}constructor(...t){if(t.length===2){const[n,i]=t;this.lang=i,this._stacks=n}else{const[n,i,s]=t;this.lang=i,this._stacks={[s]:n}}}getInternalStack(t=this.theme){return this._stacks[t]}getScopes(t=this.theme){return Hre(this._stacks[t])}toJSON(){return{lang:this.lang,theme:this.theme,themes:this.themes,scopes:this.getScopes()}}}function Hre(e){const t=[],n=new Set;function i(s){if(n.has(s))return;n.add(s);const r=s?.nameScopesList?.scopeName;r&&t.push(r),s.parent&&i(s.parent)}return i(e),t}function $re(e,t){if(!(e instanceof Bc))throw new Tn("Invalid grammar state");return e.getInternalStack(t)}function qre(){const e=new WeakMap;function t(n){if(!e.has(n.meta)){let i=function(a){if(typeof a=="number"){if(a<0||a>n.source.length)throw new Tn(`Invalid decoration offset: ${a}. Code length: ${n.source.length}`);return{...s.indexToPos(a),offset:a}}else{const o=s.lines[a.line];if(o===void 0)throw new Tn(`Invalid decoration position ${JSON.stringify(a)}. Lines length: ${s.lines.length}`);let l=a.character;if(l<0&&(l=o.length+l),l<0||l>o.length)throw new Tn(`Invalid decoration position ${JSON.stringify(a)}. Line ${a.line} length: ${o.length}`);return{...a,character:l,offset:s.posToIndex(a.line,l)}}};const s=jre(n.source),r=(n.options.decorations||[]).map(a=>({...a,start:i(a.start),end:i(a.end)}));Vre(r),e.set(n.meta,{decorations:r,converter:s,source:n.source})}return e.get(n.meta)}return{name:"shiki:decorations",tokens(n){if(!this.options.decorations?.length)return;const s=t(this).decorations.flatMap(a=>[a.start.offset,a.end.offset]);return Ure(n,s)},code(n){if(!this.options.decorations?.length)return;const i=t(this),s=Array.from(n.children).filter(h=>h.type==="element"&&h.tagName==="span");if(s.length!==i.converter.lines.length)throw new Tn(`Number of lines in code element (${s.length}) does not match the number of lines in the source (${i.converter.lines.length}). Failed to apply decorations.`);function r(h,f,m,g){const C=s[h];let S="",v=-1,_=-1;if(f===0&&(v=0),m===0&&(_=0),m===Number.POSITIVE_INFINITY&&(_=C.children.length),v===-1||_===-1)for(let x=0;x<C.children.length;x++)S+=$5(C.children[x]),v===-1&&S.length===f&&(v=x+1),_===-1&&S.length===m&&(_=x+1);if(v===-1)throw new Tn(`Failed to find start index for decoration ${JSON.stringify(g.start)}`);if(_===-1)throw new Tn(`Failed to find end index for decoration ${JSON.stringify(g.end)}`);const w=C.children.slice(v,_);if(!g.alwaysWrap&&w.length===C.children.length)o(C,g,"line");else if(!g.alwaysWrap&&w.length===1&&w[0].type==="element")o(w[0],g,"token");else{const x={type:"element",tagName:"span",properties:{},children:w};o(x,g,"wrapper"),C.children.splice(v,w.length,x)}}function a(h,f){s[h]=o(s[h],f,"line")}function o(h,f,m){const g=f.properties||{},C=f.transform||(S=>S);return h.tagName=f.tagName||"span",h.properties={...h.properties,...g,class:h.properties.class},f.properties?.class&&z5(h,f.properties.class),h=C(h,m)||h,h}const l=[],u=i.decorations.sort((h,f)=>f.start.offset-h.start.offset||h.end.offset-f.end.offset);for(const h of u){const{start:f,end:m}=h;if(f.line===m.line)r(f.line,f.character,m.character,h);else if(f.line<m.line){r(f.line,f.character,Number.POSITIVE_INFINITY,h);for(let g=f.line+1;g<m.line;g++)l.unshift(()=>a(g,h));r(m.line,0,m.character,h)}}l.forEach(h=>h())}}}function Vre(e){for(let t=0;t<e.length;t++){const n=e[t];if(n.start.offset>n.end.offset)throw new Tn(`Invalid decoration range: ${JSON.stringify(n.start)} - ${JSON.stringify(n.end)}`);for(let i=t+1;i<e.length;i++){const s=e[i],r=n.start.offset<=s.start.offset&&s.start.offset<n.end.offset,a=n.start.offset<s.end.offset&&s.end.offset<=n.end.offset,o=s.start.offset<=n.start.offset&&n.start.offset<s.end.offset,l=s.start.offset<n.end.offset&&n.end.offset<=s.end.offset;if(r||a||o||l){if(r&&a||o&&l||o&&n.start.offset===n.end.offset||a&&s.start.offset===s.end.offset)continue;throw new Tn(`Decorations ${JSON.stringify(n.start)} and ${JSON.stringify(s.start)} intersect.`)}}}}function $5(e){return e.type==="text"?e.value:e.type==="element"?e.children.map($5).join(""):""}const Wre=[qre()];function Pm(e){const t=Gre(e.transformers||[]);return[...t.pre,...t.normal,...t.post,...Wre]}function Gre(e){const t=[],n=[],i=[];for(const s of e)switch(s.enforce){case"pre":t.push(s);break;case"post":n.push(s);break;default:i.push(s)}return{pre:t,post:n,normal:i}}var Aa=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"],g_={1:"bold",2:"dim",3:"italic",4:"underline",7:"reverse",8:"hidden",9:"strikethrough"};function Kre(e,t){const n=e.indexOf("\x1B",t);if(n!==-1&&e[n+1]==="["){const i=e.indexOf("m",n);if(i!==-1)return{sequence:e.substring(n+2,i).split(";"),startPosition:n,position:i+1}}return{position:e.length}}function PM(e){const t=e.shift();if(t==="2"){const n=e.splice(0,3).map(i=>Number.parseInt(i));return n.length!==3||n.some(i=>Number.isNaN(i))?void 0:{type:"rgb",rgb:n}}else if(t==="5"){const n=e.shift();if(n)return{type:"table",index:Number(n)}}}function Yre(e){const t=[];for(;e.length>0;){const n=e.shift();if(!n)continue;const i=Number.parseInt(n);if(!Number.isNaN(i))if(i===0)t.push({type:"resetAll"});else if(i<=9)g_[i]&&t.push({type:"setDecoration",value:g_[i]});else if(i<=29){const s=g_[i-20];s&&(t.push({type:"resetDecoration",value:s}),s==="dim"&&t.push({type:"resetDecoration",value:"bold"}))}else if(i<=37)t.push({type:"setForegroundColor",value:{type:"named",name:Aa[i-30]}});else if(i===38){const s=PM(e);s&&t.push({type:"setForegroundColor",value:s})}else if(i===39)t.push({type:"resetForegroundColor"});else if(i<=47)t.push({type:"setBackgroundColor",value:{type:"named",name:Aa[i-40]}});else if(i===48){const s=PM(e);s&&t.push({type:"setBackgroundColor",value:s})}else i===49?t.push({type:"resetBackgroundColor"}):i===53?t.push({type:"setDecoration",value:"overline"}):i===55?t.push({type:"resetDecoration",value:"overline"}):i>=90&&i<=97?t.push({type:"setForegroundColor",value:{type:"named",name:Aa[i-90+8]}}):i>=100&&i<=107&&t.push({type:"setBackgroundColor",value:{type:"named",name:Aa[i-100+8]}})}return t}function Qre(){let e=null,t=null,n=new Set;return{parse(i){const s=[];let r=0;do{const a=Kre(i,r),o=a.sequence?i.substring(r,a.startPosition):i.substring(r);if(o.length>0&&s.push({value:o,foreground:e,background:t,decorations:new Set(n)}),a.sequence){const l=Yre(a.sequence);for(const u of l)u.type==="resetAll"?(e=null,t=null,n.clear()):u.type==="resetForegroundColor"?e=null:u.type==="resetBackgroundColor"?t=null:u.type==="resetDecoration"&&n.delete(u.value);for(const u of l)u.type==="setForegroundColor"?e=u.value:u.type==="setBackgroundColor"?t=u.value:u.type==="setDecoration"&&n.add(u.value)}r=a.position}while(r<i.length);return s}}}var Jre={black:"#000000",red:"#bb0000",green:"#00bb00",yellow:"#bbbb00",blue:"#0000bb",magenta:"#ff00ff",cyan:"#00bbbb",white:"#eeeeee",brightBlack:"#555555",brightRed:"#ff5555",brightGreen:"#00ff00",brightYellow:"#ffff55",brightBlue:"#5555ff",brightMagenta:"#ff55ff",brightCyan:"#55ffff",brightWhite:"#ffffff"};function Xre(e=Jre){function t(o){return e[o]}function n(o){return`#${o.map(l=>Math.max(0,Math.min(l,255)).toString(16).padStart(2,"0")).join("")}`}let i;function s(){if(i)return i;i=[];for(let u=0;u<Aa.length;u++)i.push(t(Aa[u]));let o=[0,95,135,175,215,255];for(let u=0;u<6;u++)for(let h=0;h<6;h++)for(let f=0;f<6;f++)i.push(n([o[u],o[h],o[f]]));let l=8;for(let u=0;u<24;u++,l+=10)i.push(n([l,l,l]));return i}function r(o){return s()[o]}function a(o){switch(o.type){case"named":return t(o.name);case"rgb":return n(o.rgb);case"table":return r(o.index)}}return{value:a}}const Zre={black:"#000000",red:"#cd3131",green:"#0DBC79",yellow:"#E5E510",blue:"#2472C8",magenta:"#BC3FBC",cyan:"#11A8CD",white:"#E5E5E5",brightBlack:"#666666",brightRed:"#F14C4C",brightGreen:"#23D18B",brightYellow:"#F5F543",brightBlue:"#3B8EEA",brightMagenta:"#D670D6",brightCyan:"#29B8DB",brightWhite:"#FFFFFF"};function eoe(e,t,n){const i=Lm(e,n),s=bg(t),r=Object.fromEntries(Aa.map(l=>{const u=`terminal.ansi${l[0].toUpperCase()}${l.substring(1)}`,h=e.colors?.[u];return[l,h||Zre[l]]})),a=Xre(r),o=Qre();return s.map(l=>o.parse(l[0]).map(u=>{let h,f;u.decorations.has("reverse")?(h=u.background?a.value(u.background):e.bg,f=u.foreground?a.value(u.foreground):e.fg):(h=u.foreground?a.value(u.foreground):e.fg,f=u.background?a.value(u.background):void 0),h=Po(h,i),f=Po(f,i),u.decorations.has("dim")&&(h=toe(h));let m=Fn.None;return u.decorations.has("bold")&&(m|=Fn.Bold),u.decorations.has("italic")&&(m|=Fn.Italic),u.decorations.has("underline")&&(m|=Fn.Underline),u.decorations.has("strikethrough")&&(m|=Fn.Strikethrough),{content:u.value,offset:l[1],color:h,bgColor:f,fontStyle:m}}))}function toe(e){const t=e.match(/#([0-9a-f]{3,8})/i);if(t){const i=t[1];if(i.length===8){const s=Math.round(Number.parseInt(i.slice(6,8),16)/2).toString(16).padStart(2,"0");return`#${i.slice(0,6)}${s}`}else{if(i.length===6)return`#${i}80`;if(i.length===4){const s=i[0],r=i[1],a=i[2],o=i[3],l=Math.round(Number.parseInt(`${o}${o}`,16)/2).toString(16).padStart(2,"0");return`#${s}${s}${r}${r}${a}${a}${l}`}else if(i.length===3){const s=i[0],r=i[1],a=i[2];return`#${s}${s}${r}${r}${a}${a}80`}}}const n=e.match(/var\((--[\w-]+-ansi-[\w-]+)\)/);return n?`var(${n[1]}-dim)`:e}function ZC(e,t,n={}){const{theme:i=e.getLoadedThemes()[0]}=n,s=e.resolveLangAlias(n.lang||"text");if(QC(s)||JC(i))return bg(t).map(l=>[{content:l[0],offset:l[1]}]);const{theme:r,colorMap:a}=e.setTheme(i);if(s==="ansi")return eoe(r,t,n);const o=e.getLanguage(n.lang||"text");if(n.grammarState){if(n.grammarState.lang!==o.name)throw new Tn(`Grammar state language "${n.grammarState.lang}" does not match highlight language "${o.name}"`);if(!n.grammarState.themes.includes(r.name))throw new Tn(`Grammar state themes "${n.grammarState.themes}" do not contain highlight theme "${r.name}"`)}return ioe(t,o,r,a,n)}function noe(...e){if(e.length===2)return Jd(e[1]);const[t,n,i={}]=e,{lang:s="text",theme:r=t.getLoadedThemes()[0]}=i;if(QC(s)||JC(r))throw new Tn("Plain language does not have grammar state");if(s==="ansi")throw new Tn("ANSI language does not have grammar state");const{theme:a,colorMap:o}=t.setTheme(r),l=t.getLanguage(s);return new Bc(ex(n,l,a,o,i).stateStack,l.name,a.name)}function ioe(e,t,n,i,s){const r=ex(e,t,n,i,s),a=new Bc(r.stateStack,t.name,n.name);return yg(r.tokens,a),r.tokens}function ex(e,t,n,i,s){const r=Lm(n,s),{tokenizeMaxLineLength:a=0,tokenizeTimeLimit:o=500}=s,l=bg(e);let u=s.grammarState?$re(s.grammarState,n.name)??K0:s.grammarContextCode!=null?ex(s.grammarContextCode,t,n,i,{...s,grammarState:void 0,grammarContextCode:void 0}).stateStack:K0,h=[];const f=[];for(let m=0,g=l.length;m<g;m++){const[C,S]=l[m];if(C===""){h=[],f.push([]);continue}if(a>0&&C.length>=a){h=[],f.push([{content:C,offset:S,color:"",fontStyle:0}]);continue}let v,_,w;s.includeExplanation&&(v=t.tokenizeLine(C,u,o),_=v.tokens,w=0);const x=t.tokenizeLine2(C,u,o),k=x.tokens.length/2;for(let A=0;A<k;A++){const T=x.tokens[2*A],M=A+1<k?x.tokens[2*A+2]:C.length;if(T===M)continue;const E=x.tokens[2*A+1],L=Po(i[Ec.getForeground(E)],r),D=Ec.getFontStyle(E),O={content:C.substring(T,M),offset:S+T,color:L,fontStyle:D};if(s.includeExplanation){const j=[];if(s.includeExplanation!=="scopeName")for(const q of n.settings){let K;switch(typeof q.scope){case"string":K=q.scope.split(/,/).map($=>$.trim());break;case"object":K=q.scope;break;default:continue}j.push({settings:q,selectors:K.map($=>$.split(/ /))})}O.explanation=[];let U=0;for(;T+U<M;){const q=_[w],K=C.substring(q.startIndex,q.endIndex);U+=K.length,O.explanation.push({content:K,scopes:s.includeExplanation==="scopeName"?soe(q.scopes):roe(j,q.scopes)}),w+=1}}h.push(O)}f.push(h),h=[],u=x.ruleStack}return{tokens:f,stateStack:u}}function soe(e){return e.map(t=>({scopeName:t}))}function roe(e,t){const n=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];n[i]={scopeName:r,themeMatches:aoe(e,r,t.slice(0,i))}}return n}function DM(e,t){return e===t||t.substring(0,e.length)===e&&t[e.length]==="."}function ooe(e,t,n){if(!DM(e[e.length-1],t))return!1;let i=e.length-2,s=n.length-1;for(;i>=0&&s>=0;)DM(e[i],n[s])&&(i-=1),s-=1;return i===-1}function aoe(e,t,n){const i=[];for(const{selectors:s,settings:r}of e)for(const a of s)if(ooe(a,t,n)){i.push(r);break}return i}function q5(e,t,n){const i=Object.entries(n.themes).filter(l=>l[1]).map(l=>({color:l[0],theme:l[1]})),s=i.map(l=>{const u=ZC(e,t,{...n,theme:l.theme}),h=Jd(u),f=typeof l.theme=="string"?l.theme:l.theme.name;return{tokens:u,state:h,theme:f}}),r=loe(...s.map(l=>l.tokens)),a=r[0].map((l,u)=>l.map((h,f)=>{const m={content:h.content,variants:{},offset:h.offset};return"includeExplanation"in n&&n.includeExplanation&&(m.explanation=h.explanation),r.forEach((g,C)=>{const{content:S,explanation:v,offset:_,...w}=g[u][f];m.variants[i[C].color]=w}),m})),o=s[0].state?new Bc(Object.fromEntries(s.map(l=>[l.theme,l.state?.getInternalStack(l.theme)])),s[0].state.lang):void 0;return o&&yg(a,o),a}function loe(...e){const t=e.map(()=>[]),n=e.length;for(let i=0;i<e[0].length;i++){const s=e.map(l=>l[i]),r=t.map(()=>[]);t.forEach((l,u)=>l.push(r[u]));const a=s.map(()=>0),o=s.map(l=>l[0]);for(;o.every(l=>l);){const l=Math.min(...o.map(u=>u.content.length));for(let u=0;u<n;u++){const h=o[u];h.content.length===l?(r[u].push(h),a[u]+=1,o[u]=s[u][a[u]]):(r[u].push({...h,content:h.content.slice(0,l)}),o[u]={...h,content:h.content.slice(l),offset:h.offset+l})}}}return t}function Dm(e,t,n){let i,s,r,a,o,l;if("themes"in n){const{defaultColor:u="light",cssVariablePrefix:h="--shiki-",colorsRendering:f="css-vars"}=n,m=Object.entries(n.themes).filter(_=>_[1]).map(_=>({color:_[0],theme:_[1]})).sort((_,w)=>_.color===u?-1:w.color===u?1:0);if(m.length===0)throw new Tn("`themes` option must not be empty");const g=q5(e,t,n);if(l=Jd(g),u&&XC!==u&&!m.find(_=>_.color===u))throw new Tn(`\`themes\` option must contain the defaultColor key \`${u}\``);const C=m.map(_=>e.getTheme(_.theme)),S=m.map(_=>_.color);r=g.map(_=>_.map(w=>zre(w,S,h,u,f))),l&&yg(r,l);const v=m.map(_=>Lm(_.theme,n));s=OM(m,C,v,h,u,"fg",f),i=OM(m,C,v,h,u,"bg",f),a=`shiki-themes ${C.map(_=>_.name).join(" ")}`,o=u?void 0:[s,i].join(";")}else if("theme"in n){const u=Lm(n.theme,n);r=ZC(e,t,n);const h=e.getTheme(n.theme);i=Po(h.bg,u),s=Po(h.fg,u),a=h.name,l=Jd(r)}else throw new Tn("Invalid options, either `theme` or `themes` must be provided");return{tokens:r,fg:s,bg:i,themeName:a,rootStyle:o,grammarState:l}}function OM(e,t,n,i,s,r,a){return e.map((o,l)=>{const u=Po(t[l][r],n[l])||"inherit",h=`${i+o.color}${r==="bg"?"-bg":""}:${u}`;if(l===0&&s){if(s===XC&&e.length>1){const f=e.findIndex(S=>S.color==="light"),m=e.findIndex(S=>S.color==="dark");if(f===-1||m===-1)throw new Tn('When using `defaultColor: "light-dark()"`, you must provide both `light` and `dark` themes');const g=Po(t[f][r],n[f])||"inherit",C=Po(t[m][r],n[m])||"inherit";return`light-dark(${g}, ${C});${h}`}return u}return a==="css-vars"?h:null}).filter(o=>!!o).join(";")}function Om(e,t,n,i={meta:{},options:n,codeToHast:(s,r)=>Om(e,s,r),codeToTokens:(s,r)=>Dm(e,s,r)}){let s=t;for(const C of Pm(n))s=C.preprocess?.call(i,s,n)||s;let{tokens:r,fg:a,bg:o,themeName:l,rootStyle:u,grammarState:h}=Dm(e,s,n);const{mergeWhitespaces:f=!0,mergeSameStyleTokens:m=!1}=n;f===!0?r=uoe(r):f==="never"&&(r=doe(r)),m&&(r=hoe(r));const g={...i,get source(){return s}};for(const C of Pm(n))r=C.tokens?.call(g,r)||r;return coe(r,{...n,fg:a,bg:o,themeName:l,rootStyle:n.rootStyle===!1?!1:n.rootStyle??u},g,h)}function coe(e,t,n,i=Jd(e)){const s=Pm(t),r=[],a={type:"root",children:[]},{structure:o="classic",tabindex:l="0"}=t,u={class:`shiki ${t.themeName||""}`};t.rootStyle!==!1&&(t.rootStyle!=null?u.style=t.rootStyle:u.style=`background-color:${t.bg};color:${t.fg}`),l!==!1&&l!=null&&(u.tabindex=l.toString());for(const[S,v]of Object.entries(t.meta||{}))S.startsWith("_")||(u[S]=v);let h={type:"element",tagName:"pre",properties:u,children:[],data:t.data},f={type:"element",tagName:"code",properties:{},children:r};const m=[],g={...n,structure:o,addClassToHast:z5,get source(){return n.source},get tokens(){return e},get options(){return t},get root(){return a},get pre(){return h},get code(){return f},get lines(){return m}};if(e.forEach((S,v)=>{v&&(o==="inline"?a.children.push({type:"element",tagName:"br",properties:{},children:[]}):o==="classic"&&r.push({type:"text",value:`
`}));let _={type:"element",tagName:"span",properties:{class:"line"},children:[]},w=0;for(const x of S){let k={type:"element",tagName:"span",properties:{...x.htmlAttrs},children:[{type:"text",value:x.content}]};const A=Q0(x.htmlStyle||Im(x));A&&(k.properties.style=A);for(const T of s)k=T?.span?.call(g,k,v+1,w,_,x)||k;o==="inline"?a.children.push(k):o==="classic"&&_.children.push(k),w+=x.content.length}if(o==="classic"){for(const x of s)_=x?.line?.call(g,_,v+1)||_;m.push(_),r.push(_)}else o==="inline"&&m.push(_)}),o==="classic"){for(const S of s)f=S?.code?.call(g,f)||f;h.children.push(f);for(const S of s)h=S?.pre?.call(g,h)||h;a.children.push(h)}else if(o==="inline"){const S=[];let v={type:"element",tagName:"span",properties:{class:"line"},children:[]};for(const x of a.children)x.type==="element"&&x.tagName==="br"?(S.push(v),v={type:"element",tagName:"span",properties:{class:"line"},children:[]}):(x.type==="element"||x.type==="text")&&v.children.push(x);S.push(v);let w={type:"element",tagName:"code",properties:{},children:S};for(const x of s)w=x?.code?.call(g,w)||w;a.children=[];for(let x=0;x<w.children.length;x++){x>0&&a.children.push({type:"element",tagName:"br",properties:{},children:[]});const k=w.children[x];k.type==="element"&&a.children.push(...k.children)}}let C=a;for(const S of s)C=S?.root?.call(g,C)||C;return i&&yg(C,i),C}function uoe(e){return e.map(t=>{const n=[];let i="",s;return t.forEach((r,a)=>{const l=!(r.fontStyle&&(r.fontStyle&Fn.Underline||r.fontStyle&Fn.Strikethrough));l&&r.content.match(/^\s+$/)&&t[a+1]?(s===void 0&&(s=r.offset),i+=r.content):i?(l?n.push({...r,offset:s,content:i+r.content}):n.push({content:i,offset:s},r),s=void 0,i=""):n.push(r)}),n})}function doe(e){return e.map(t=>t.flatMap(n=>{if(n.content.match(/^\s+$/))return n;const i=n.content.match(/^(\s*)(.*?)(\s*)$/);if(!i)return n;const[,s,r,a]=i;if(!s&&!a)return n;const o=[{...n,offset:n.offset+s.length,content:r}];return s&&o.unshift({content:s,offset:n.offset}),a&&o.push({content:a,offset:n.offset+s.length+r.length}),o}))}function hoe(e){return e.map(t=>{const n=[];for(const i of t){if(n.length===0){n.push({...i});continue}const s=n[n.length-1],r=Q0(s.htmlStyle||Im(s)),a=Q0(i.htmlStyle||Im(i)),o=s.fontStyle&&(s.fontStyle&Fn.Underline||s.fontStyle&Fn.Strikethrough),l=i.fontStyle&&(i.fontStyle&Fn.Underline||i.fontStyle&Fn.Strikethrough);!o&&!l&&r===a?s.content+=i.content:n.push({...i})}return n})}const foe=Lre;function poe(e,t,n){const i={meta:{},options:n,codeToHast:(r,a)=>Om(e,r,a),codeToTokens:(r,a)=>Dm(e,r,a)};let s=foe(Om(e,t,n,i));for(const r of Pm(n))s=r.postprocess?.call(i,s,n)||s;return s}const NM={light:"#333333",dark:"#bbbbbb"},jM={light:"#fffffe",dark:"#1e1e1e"},BM="__shiki_resolved";function tx(e){if(e?.[BM])return e;const t={...e};t.tokenColors&&!t.settings&&(t.settings=t.tokenColors,delete t.tokenColors),t.type||="dark",t.colorReplacements={...t.colorReplacements},t.settings||=[];let{bg:n,fg:i}=t;if(!n||!i){const o=t.settings?t.settings.find(l=>!l.name&&!l.scope):void 0;o?.settings?.foreground&&(i=o.settings.foreground),o?.settings?.background&&(n=o.settings.background),!i&&t?.colors?.["editor.foreground"]&&(i=t.colors["editor.foreground"]),!n&&t?.colors?.["editor.background"]&&(n=t.colors["editor.background"]),i||(i=t.type==="light"?NM.light:NM.dark),n||(n=t.type==="light"?jM.light:jM.dark),t.fg=i,t.bg=n}t.settings[0]&&t.settings[0].settings&&!t.settings[0].scope||t.settings.unshift({settings:{foreground:t.fg,background:t.bg}});let s=0;const r=new Map;function a(o){if(r.has(o))return r.get(o);s+=1;const l=`#${s.toString(16).padStart(8,"0").toLowerCase()}`;return t.colorReplacements?.[`#${l}`]?a(o):(r.set(o,l),l)}t.settings=t.settings.map(o=>{const l=o.settings?.foreground&&!o.settings.foreground.startsWith("#"),u=o.settings?.background&&!o.settings.background.startsWith("#");if(!l&&!u)return o;const h={...o,settings:{...o.settings}};if(l){const f=a(o.settings.foreground);t.colorReplacements[f]=o.settings.foreground,h.settings.foreground=f}if(u){const f=a(o.settings.background);t.colorReplacements[f]=o.settings.background,h.settings.background=f}return h});for(const o of Object.keys(t.colors||{}))if((o==="editor.foreground"||o==="editor.background"||o.startsWith("terminal.ansi"))&&!t.colors[o]?.startsWith("#")){const l=a(t.colors[o]);t.colorReplacements[l]=t.colors[o],t.colors[o]=l}return Object.defineProperty(t,BM,{enumerable:!1,writable:!1,value:!0}),t}async function V5(e){return Array.from(new Set((await Promise.all(e.filter(t=>!Ore(t)).map(async t=>await U5(t).then(n=>Array.isArray(n)?n:[n])))).flat()))}async function W5(e){return(await Promise.all(e.map(async n=>Nre(n)?null:tx(await U5(n))))).filter(n=>!!n)}let moe=3;function goe(e,t=3){t>moe||console.trace(`[SHIKI DEPRECATE]: ${e}`)}class ac extends Error{constructor(t){super(t),this.name="ShikiError"}}function G5(e,t){if(!t)return e;if(t[e]){const n=new Set([e]);for(;t[e];){if(e=t[e],n.has(e))throw new ac(`Circular alias \`${Array.from(n).join(" -> ")} -> ${e}\``);n.add(e)}}return e}class voe extends Mse{constructor(t,n,i,s={}){super(t),this._resolver=t,this._themes=n,this._langs=i,this._alias=s,this._themes.map(r=>this.loadTheme(r)),this.loadLanguages(this._langs)}_resolvedThemes=new Map;_resolvedGrammars=new Map;_langMap=new Map;_langGraph=new Map;_textmateThemeCache=new WeakMap;_loadedThemesCache=null;_loadedLanguagesCache=null;getTheme(t){return typeof t=="string"?this._resolvedThemes.get(t):this.loadTheme(t)}loadTheme(t){const n=tx(t);return n.name&&(this._resolvedThemes.set(n.name,n),this._loadedThemesCache=null),n}getLoadedThemes(){return this._loadedThemesCache||(this._loadedThemesCache=[...this._resolvedThemes.keys()]),this._loadedThemesCache}setTheme(t){let n=this._textmateThemeCache.get(t);n||(n=Tm.createFromRawTheme(t),this._textmateThemeCache.set(t,n)),this._syncRegistry.setTheme(n)}getGrammar(t){return t=G5(t,this._alias),this._resolvedGrammars.get(t)}loadLanguage(t){if(this.getGrammar(t.name))return;const n=new Set([...this._langMap.values()].filter(r=>r.embeddedLangsLazy?.includes(t.name)));this._resolver.addLanguage(t);const i={balancedBracketSelectors:t.balancedBracketSelectors||["*"],unbalancedBracketSelectors:t.unbalancedBracketSelectors||[]};this._syncRegistry._rawGrammars.set(t.scopeName,t);const s=this.loadGrammarWithConfiguration(t.scopeName,1,i);if(s.name=t.name,this._resolvedGrammars.set(t.name,s),t.aliases&&t.aliases.forEach(r=>{this._alias[r]=t.name}),this._loadedLanguagesCache=null,n.size)for(const r of n)this._resolvedGrammars.delete(r.name),this._loadedLanguagesCache=null,this._syncRegistry?._injectionGrammars?.delete(r.scopeName),this._syncRegistry?._grammars?.delete(r.scopeName),this.loadLanguage(this._langMap.get(r.name))}dispose(){super.dispose(),this._resolvedThemes.clear(),this._resolvedGrammars.clear(),this._langMap.clear(),this._langGraph.clear(),this._loadedThemesCache=null}loadLanguages(t){for(const s of t)this.resolveEmbeddedLanguages(s);const n=Array.from(this._langGraph.entries()),i=n.filter(([s,r])=>!r);if(i.length){const s=n.filter(([r,a])=>a?(a.embeddedLanguages||a.embeddedLangs)?.some(l=>i.map(([u])=>u).includes(l)):!1).filter(r=>!i.includes(r));throw new ac(`Missing languages ${i.map(([r])=>`\`${r}\``).join(", ")}, required by ${s.map(([r])=>`\`${r}\``).join(", ")}`)}for(const[s,r]of n)this._resolver.addLanguage(r);for(const[s,r]of n)this.loadLanguage(r)}getLoadedLanguages(){return this._loadedLanguagesCache||(this._loadedLanguagesCache=[...new Set([...this._resolvedGrammars.keys(),...Object.keys(this._alias)])]),this._loadedLanguagesCache}resolveEmbeddedLanguages(t){this._langMap.set(t.name,t),this._langGraph.set(t.name,t);const n=t.embeddedLanguages??t.embeddedLangs;if(n)for(const i of n)this._langGraph.set(i,this._langMap.get(i))}}class boe{_langs=new Map;_scopeToLang=new Map;_injections=new Map;_onigLib;constructor(t,n){this._onigLib={createOnigScanner:i=>t.createScanner(i),createOnigString:i=>t.createString(i)},n.forEach(i=>this.addLanguage(i))}get onigLib(){return this._onigLib}getLangRegistration(t){return this._langs.get(t)}loadGrammar(t){return this._scopeToLang.get(t)}addLanguage(t){this._langs.set(t.name,t),t.aliases&&t.aliases.forEach(n=>{this._langs.set(n,t)}),this._scopeToLang.set(t.scopeName,t),t.injectTo&&t.injectTo.forEach(n=>{this._injections.get(n)||this._injections.set(n,[]),this._injections.get(n).push(t.scopeName)})}getInjections(t){const n=t.split(".");let i=[];for(let s=1;s<=n.length;s++){const r=n.slice(0,s).join(".");i=[...i,...this._injections.get(r)||[]]}return i}}let Ku=0;function yoe(e){Ku+=1,e.warnings!==!1&&Ku>=10&&Ku%10===0&&console.warn(`[Shiki] ${Ku} instances have been created. Shiki is supposed to be used as a singleton, consider refactoring your code to cache your highlighter instance; Or call \`highlighter.dispose()\` to release unused instances.`);let t=!1;if(!e.engine)throw new ac("`engine` option is required for synchronous mode");const n=(e.langs||[]).flat(1),i=(e.themes||[]).flat(1).map(tx),s=new boe(e.engine,n),r=new voe(s,i,n,e.langAlias);let a;function o(x){return G5(x,e.langAlias)}function l(x){_();const k=r.getGrammar(typeof x=="string"?x:x.name);if(!k)throw new ac(`Language \`${x}\` not found, you may need to load it first`);return k}function u(x){if(x==="none")return{bg:"",fg:"",name:"none",settings:[],type:"dark"};_();const k=r.getTheme(x);if(!k)throw new ac(`Theme \`${x}\` not found, you may need to load it first`);return k}function h(x){_();const k=u(x);a!==x&&(r.setTheme(k),a=x);const A=r.getColorMap();return{theme:k,colorMap:A}}function f(){return _(),r.getLoadedThemes()}function m(){return _(),r.getLoadedLanguages()}function g(...x){_(),r.loadLanguages(x.flat(1))}async function C(...x){return g(await V5(x))}function S(...x){_();for(const k of x.flat(1))r.loadTheme(k)}async function v(...x){return _(),S(await W5(x))}function _(){if(t)throw new ac("Shiki instance has been disposed")}function w(){t||(t=!0,r.dispose(),Ku-=1)}return{setTheme:h,getTheme:u,getLanguage:l,getLoadedThemes:f,getLoadedLanguages:m,resolveLangAlias:o,loadLanguage:C,loadLanguageSync:g,loadTheme:v,loadThemeSync:S,dispose:w,[Symbol.dispose]:w}}async function _oe(e){e.engine||goe("`engine` option is required. Use `createOnigurumaEngine` or `createJavaScriptRegexEngine` to create an engine.");const[t,n,i]=await Promise.all([W5(e.themes||[]),V5(e.langs||[]),e.engine]);return yoe({...e,themes:t,langs:n,engine:i})}async function Soe(e){const t=await _oe(e);return{getLastGrammarState:(...n)=>noe(t,...n),codeToTokensBase:(n,i)=>ZC(t,n,i),codeToTokensWithThemes:(n,i)=>q5(t,n,i),codeToTokens:(n,i)=>Dm(t,n,i),codeToHast:(n,i)=>Om(t,n,i),codeToHtml:(n,i)=>poe(t,n,i),getBundledLanguages:()=>({}),getBundledThemes:()=>({}),...t,getInternalContext:()=>t}}function Fc(e){if([...e].length!==1)throw new Error(`Expected "${e}" to be a single code point`);return e.codePointAt(0)}function Coe(e,t,n){return e.has(t)||e.set(t,n),e.get(t)}const nx=new Set(["alnum","alpha","ascii","blank","cntrl","digit","graph","lower","print","punct","space","upper","word","xdigit"]),En=String.raw;function Uc(e,t){if(e==null)throw new Error(t??"Value expected");return e}const K5=En`\[\^?`,Y5=`c.? | C(?:-.?)?|${En`[pP]\{(?:\^?[-\x20_]*[A-Za-z][-\x20\w]*\})?`}|${En`x[89A-Fa-f]\p{AHex}(?:\\x[89A-Fa-f]\p{AHex})*`}|${En`u(?:\p{AHex}{4})? | x\{[^\}]*\}? | x\p{AHex}{0,2}`}|${En`o\{[^\}]*\}?`}|${En`\d{1,3}`}`,ix=/[?*+][?+]?|\{(?:\d+(?:,\d*)?|,\d+)\}\??/,ip=new RegExp(En`
  \\ (?:
    ${Y5}
    | [gk]<[^>]*>?
    | [gk]'[^']*'?
    | .
  )
  | \( (?:
    \? (?:
      [:=!>({]
      | <[=!]
      | <[^>]*>
      | '[^']*'
      | ~\|?
      | #(?:[^)\\]|\\.?)*
      | [^:)]*[:)]
    )?
    | \*[^\)]*\)?
  )?
  | (?:${ix.source})+
  | ${K5}
  | .
`.replace(/\s+/g,""),"gsu"),v_=new RegExp(En`
  \\ (?:
    ${Y5}
    | .
  )
  | \[:(?:\^?\p{Alpha}+|\^):\]
  | ${K5}
  | &&
  | .
`.replace(/\s+/g,""),"gsu");function xoe(e,t={}){const n={flags:"",...t,rules:{captureGroup:!1,singleline:!1,...t.rules}};if(typeof e!="string")throw new Error("String expected as pattern");const i=Hoe(n.flags),s=[i.extended],r={captureGroup:n.rules.captureGroup,getCurrentModX(){return s.at(-1)},numOpenGroups:0,popModX(){s.pop()},pushModX(f){s.push(f)},replaceCurrentModX(f){s[s.length-1]=f},singleline:n.rules.singleline};let a=[],o;for(ip.lastIndex=0;o=ip.exec(e);){const f=woe(r,e,o[0],ip.lastIndex);f.tokens?a.push(...f.tokens):f.token&&a.push(f.token),f.lastIndex!==void 0&&(ip.lastIndex=f.lastIndex)}const l=[];let u=0;a.filter(f=>f.type==="GroupOpen").forEach(f=>{f.kind==="capturing"?f.number=++u:f.raw==="("&&l.push(f)}),u||l.forEach((f,m)=>{f.kind="capturing",f.number=m+1});const h=u||l.length;return{tokens:a.map(f=>f.type==="EscapedNumber"?qoe(f,h):f).flat(),flags:i}}function woe(e,t,n,i){const[s,r]=n;if(n==="["||n==="[^"){const a=koe(t,n,i);return{tokens:a.tokens,lastIndex:a.lastIndex}}if(s==="\\"){if("AbBGyYzZ".includes(r))return{token:FM(n,n)};if(/^\\g[<']/.test(n)){if(!/^\\g(?:<[^>]+>|'[^']+')$/.test(n))throw new Error(`Invalid group name "${n}"`);return{token:Ooe(n)}}if(/^\\k[<']/.test(n)){if(!/^\\k(?:<[^>]+>|'[^']+')$/.test(n))throw new Error(`Invalid group name "${n}"`);return{token:J5(n)}}if(r==="K")return{token:X5("keep",n)};if(r==="N"||r==="R")return{token:Ma("newline",n,{negate:r==="N"})};if(r==="O")return{token:Ma("any",n)};if(r==="X")return{token:Ma("text_segment",n)};const a=Q5(n,{inCharClass:!1});return Array.isArray(a)?{tokens:a}:{token:a}}if(s==="("){if(r==="*")return{token:Foe(n)};if(n==="(?{")throw new Error(`Unsupported callout "${n}"`);if(n.startsWith("(?#")){if(t[i]!==")")throw new Error('Unclosed comment group "(?#"');return{lastIndex:i+1}}if(/^\(\?[-imx]+[:)]$/.test(n))return{token:Boe(n,e)};if(e.pushModX(e.getCurrentModX()),e.numOpenGroups++,n==="("&&!e.captureGroup||n==="(?:")return{token:tc("group",n)};if(n==="(?>")return{token:tc("atomic",n)};if(n==="(?="||n==="(?!"||n==="(?<="||n==="(?<!")return{token:tc(n[2]==="<"?"lookbehind":"lookahead",n,{negate:n.endsWith("!")})};if(n==="("&&e.captureGroup||n.startsWith("(?<")&&n.endsWith(">")||n.startsWith("(?'")&&n.endsWith("'"))return{token:tc("capturing",n,{...n!=="("&&{name:n.slice(3,-1)}})};if(n.startsWith("(?~")){if(n==="(?~|")throw new Error(`Unsupported absence function kind "${n}"`);return{token:tc("absence_repeater",n)}}throw n==="(?("?new Error(`Unsupported conditional "${n}"`):new Error(`Invalid or unsupported group option "${n}"`)}if(n===")"){if(e.popModX(),e.numOpenGroups--,e.numOpenGroups<0)throw new Error('Unmatched ")"');return{token:Ioe(n)}}if(e.getCurrentModX()){if(n==="#"){const a=t.indexOf(`
`,i);return{lastIndex:a===-1?t.length:a}}if(/^\s$/.test(n)){const a=/\s+/y;return a.lastIndex=i,{lastIndex:a.exec(t)?a.lastIndex:i}}}if(n===".")return{token:Ma("dot",n)};if(n==="^"||n==="$"){const a=e.singleline?{"^":En`\A`,$:En`\Z`}[n]:n;return{token:FM(a,n)}}return n==="|"?{token:Eoe(n)}:ix.test(n)?{tokens:Voe(n)}:{token:Nr(Fc(n),n)}}function koe(e,t,n){const i=[UM(t[1]==="^",t)];let s=1,r;for(v_.lastIndex=n;r=v_.exec(e);){const a=r[0];if(a[0]==="["&&a[1]!==":")s++,i.push(UM(a[1]==="^",a));else if(a==="]"){if(i.at(-1).type==="CharacterClassOpen")i.push(Nr(93,a));else if(s--,i.push(Roe(a)),!s)break}else{const o=Toe(a);Array.isArray(o)?i.push(...o):i.push(o)}}return{tokens:i,lastIndex:v_.lastIndex||e.length}}function Toe(e){if(e[0]==="\\")return Q5(e,{inCharClass:!0});if(e[0]==="["){const t=/\[:(?<negate>\^?)(?<name>[a-z]+):\]/.exec(e);if(!t||!nx.has(t.groups.name))throw new Error(`Invalid POSIX class "${e}"`);return Ma("posix",e,{value:t.groups.name,negate:!!t.groups.negate})}return e==="-"?Aoe(e):e==="&&"?Moe(e):Nr(Fc(e),e)}function Q5(e,{inCharClass:t}){const n=e[1];if(n==="c"||n==="C")return joe(e);if("dDhHsSwW".includes(n))return Uoe(e);if(e.startsWith(En`\o{`))throw new Error(`Incomplete, invalid, or unsupported octal code point "${e}"`);if(/^\\[pP]\{/.test(e)){if(e.length===3)throw new Error(`Incomplete or invalid Unicode property "${e}"`);return zoe(e)}if(new RegExp("^\\\\x[89A-Fa-f]\\p{AHex}","u").test(e))try{const i=e.split(/\\x/).slice(1).map(a=>parseInt(a,16)),s=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}).decode(new Uint8Array(i)),r=new TextEncoder;return[...s].map(a=>{const o=[...r.encode(a)].map(l=>`\\x${l.toString(16)}`).join("");return Nr(Fc(a),o)})}catch{throw new Error(`Multibyte code "${e}" incomplete or invalid in Oniguruma`)}if(n==="u"||n==="x")return Nr($oe(e),e);if(zM.has(n))return Nr(zM.get(n),e);if(/\d/.test(n))return Loe(t,e);if(e==="\\")throw new Error(En`Incomplete escape "\"`);if(n==="M")throw new Error(`Unsupported meta "${e}"`);if([...e].length===2)return Nr(e.codePointAt(1),e);throw new Error(`Unexpected escape "${e}"`)}function Eoe(e){return{type:"Alternator",raw:e}}function FM(e,t){return{type:"Assertion",kind:e,raw:t}}function J5(e){return{type:"Backreference",raw:e}}function Nr(e,t){return{type:"Character",value:e,raw:t}}function Roe(e){return{type:"CharacterClassClose",raw:e}}function Aoe(e){return{type:"CharacterClassHyphen",raw:e}}function Moe(e){return{type:"CharacterClassIntersector",raw:e}}function UM(e,t){return{type:"CharacterClassOpen",negate:e,raw:t}}function Ma(e,t,n={}){return{type:"CharacterSet",kind:e,...n,raw:t}}function X5(e,t,n={}){return e==="keep"?{type:"Directive",kind:e,raw:t}:{type:"Directive",kind:e,flags:Uc(n.flags),raw:t}}function Loe(e,t){return{type:"EscapedNumber",inCharClass:e,raw:t}}function Ioe(e){return{type:"GroupClose",raw:e}}function tc(e,t,n={}){return{type:"GroupOpen",kind:e,...n,raw:t}}function Poe(e,t,n,i){return{type:"NamedCallout",kind:e,tag:t,arguments:n,raw:i}}function Doe(e,t,n,i){return{type:"Quantifier",kind:e,min:t,max:n,raw:i}}function Ooe(e){return{type:"Subroutine",raw:e}}const Noe=new Set(["COUNT","CMP","ERROR","FAIL","MAX","MISMATCH","SKIP","TOTAL_COUNT"]),zM=new Map([["a",7],["b",8],["e",27],["f",12],["n",10],["r",13],["t",9],["v",11]]);function joe(e){const t=e[1]==="c"?e[2]:e[3];if(!t||!/[A-Za-z]/.test(t))throw new Error(`Unsupported control character "${e}"`);return Nr(Fc(t.toUpperCase())-64,e)}function Boe(e,t){let{on:n,off:i}=/^\(\?(?<on>[imx]*)(?:-(?<off>[-imx]*))?/.exec(e).groups;i??="";const s=(t.getCurrentModX()||n.includes("x"))&&!i.includes("x"),r=$M(n),a=$M(i),o={};if(r&&(o.enable=r),a&&(o.disable=a),e.endsWith(")"))return t.replaceCurrentModX(s),X5("flags",e,{flags:o});if(e.endsWith(":"))return t.pushModX(s),t.numOpenGroups++,tc("group",e,{...(r||a)&&{flags:o}});throw new Error(`Unexpected flag modifier "${e}"`)}function Foe(e){const t=/\(\*(?<name>[A-Za-z_]\w*)?(?:\[(?<tag>(?:[A-Za-z_]\w*)?)\])?(?:\{(?<args>[^}]*)\})?\)/.exec(e);if(!t)throw new Error(`Incomplete or invalid named callout "${e}"`);const{name:n,tag:i,args:s}=t.groups;if(!n)throw new Error(`Invalid named callout "${e}"`);if(i==="")throw new Error(`Named callout tag with empty value not allowed "${e}"`);const r=s?s.split(",").filter(h=>h!=="").map(h=>/^[+-]?\d+$/.test(h)?+h:h):[],[a,o,l]=r,u=Noe.has(n)?n.toLowerCase():"custom";switch(u){case"fail":case"mismatch":case"skip":if(r.length>0)throw new Error(`Named callout arguments not allowed "${r}"`);break;case"error":if(r.length>1)throw new Error(`Named callout allows only one argument "${r}"`);if(typeof a=="string")throw new Error(`Named callout argument must be a number "${a}"`);break;case"max":if(!r.length||r.length>2)throw new Error(`Named callout must have one or two arguments "${r}"`);if(typeof a=="string"&&!/^[A-Za-z_]\w*$/.test(a))throw new Error(`Named callout argument one must be a tag or number "${a}"`);if(r.length===2&&(typeof o=="number"||!/^[<>X]$/.test(o)))throw new Error(`Named callout optional argument two must be '<', '>', or 'X' "${o}"`);break;case"count":case"total_count":if(r.length>1)throw new Error(`Named callout allows only one argument "${r}"`);if(r.length===1&&(typeof a=="number"||!/^[<>X]$/.test(a)))throw new Error(`Named callout optional argument must be '<', '>', or 'X' "${a}"`);break;case"cmp":if(r.length!==3)throw new Error(`Named callout must have three arguments "${r}"`);if(typeof a=="string"&&!/^[A-Za-z_]\w*$/.test(a))throw new Error(`Named callout argument one must be a tag or number "${a}"`);if(typeof o=="number"||!/^(?:[<>!=]=|[<>])$/.test(o))throw new Error(`Named callout argument two must be '==', '!=', '>', '<', '>=', or '<=' "${o}"`);if(typeof l=="string"&&!/^[A-Za-z_]\w*$/.test(l))throw new Error(`Named callout argument three must be a tag or number "${l}"`);break;case"custom":throw new Error(`Undefined callout name "${n}"`);default:throw new Error(`Unexpected named callout kind "${u}"`)}return Poe(u,i??null,s?.split(",")??null,e)}function HM(e){let t=null,n,i;if(e[0]==="{"){const{minStr:s,maxStr:r}=/^\{(?<minStr>\d*)(?:,(?<maxStr>\d*))?/.exec(e).groups,a=1e5;if(+s>a||r&&+r>a)throw new Error("Quantifier value unsupported in Oniguruma");if(n=+s,i=r===void 0?+s:r===""?1/0:+r,n>i&&(t="possessive",[n,i]=[i,n]),e.endsWith("?")){if(t==="possessive")throw new Error('Unsupported possessive interval quantifier chain with "?"');t="lazy"}else t||(t="greedy")}else n=e[0]==="+"?1:0,i=e[0]==="?"?1:1/0,t=e[1]==="+"?"possessive":e[1]==="?"?"lazy":"greedy";return Doe(t,n,i,e)}function Uoe(e){const t=e[1].toLowerCase();return Ma({d:"digit",h:"hex",s:"space",w:"word"}[t],e,{negate:e[1]!==t})}function zoe(e){const{p:t,neg:n,value:i}=/^\\(?<p>[pP])\{(?<neg>\^?)(?<value>[^}]+)/.exec(e).groups;return Ma("property",e,{value:i,negate:t==="P"&&!n||t==="p"&&!!n})}function $M(e){const t={};return e.includes("i")&&(t.ignoreCase=!0),e.includes("m")&&(t.dotAll=!0),e.includes("x")&&(t.extended=!0),Object.keys(t).length?t:null}function Hoe(e){const t={ignoreCase:!1,dotAll:!1,extended:!1,digitIsAscii:!1,posixIsAscii:!1,spaceIsAscii:!1,wordIsAscii:!1,textSegmentMode:null};for(let n=0;n<e.length;n++){const i=e[n];if(!"imxDPSWy".includes(i))throw new Error(`Invalid flag "${i}"`);if(i==="y"){if(!/^y{[gw]}/.test(e.slice(n)))throw new Error('Invalid or unspecified flag "y" mode');t.textSegmentMode=e[n+2]==="g"?"grapheme":"word",n+=3;continue}t[{i:"ignoreCase",m:"dotAll",x:"extended",D:"digitIsAscii",P:"posixIsAscii",S:"spaceIsAscii",W:"wordIsAscii"}[i]]=!0}return t}function $oe(e){if(new RegExp("^(?:\\\\u(?!\\p{AHex}{4})|\\\\x(?!\\p{AHex}{1,2}|\\{\\p{AHex}{1,8}\\}))","u").test(e))throw new Error(`Incomplete or invalid escape "${e}"`);const t=e[2]==="{"?new RegExp("^\\\\x\\{\\s*(?<hex>\\p{AHex}+)","u").exec(e).groups.hex:e.slice(2);return parseInt(t,16)}function qoe(e,t){const{raw:n,inCharClass:i}=e,s=n.slice(1);if(!i&&(s!=="0"&&s.length===1||s[0]!=="0"&&+s<=t))return[J5(n)];const r=[],a=s.match(/^[0-7]+|\d/g);for(let o=0;o<a.length;o++){const l=a[o];let u;if(o===0&&l!=="8"&&l!=="9"){if(u=parseInt(l,8),u>127)throw new Error(En`Octal encoded byte above 177 unsupported "${n}"`)}else u=Fc(l);r.push(Nr(u,(o===0?"\\":"")+l))}return r}function Voe(e){const t=[],n=new RegExp(ix,"gy");let i;for(;i=n.exec(e);){const s=i[0];if(s[0]==="{"){const r=/^\{(?<min>\d+),(?<max>\d+)\}\??$/.exec(s);if(r){const{min:a,max:o}=r.groups;if(+a>+o&&s.endsWith("?")){n.lastIndex--,t.push(HM(s.slice(0,-1)));continue}}}t.push(HM(s))}return t}function Z5(e,t){if(!Array.isArray(e.body))throw new Error("Expected node with body array");if(e.body.length!==1)return!1;const n=e.body[0];return!t||Object.keys(t).every(i=>t[i]===n[i])}function Woe(e){return Goe.has(e.type)}const Goe=new Set(["AbsenceFunction","Backreference","CapturingGroup","Character","CharacterClass","CharacterSet","Group","Quantifier","Subroutine"]);function e3(e,t={}){const n={flags:"",normalizeUnknownPropertyNames:!1,skipBackrefValidation:!1,skipLookbehindValidation:!1,skipPropertyNameValidation:!1,unicodePropertyMap:null,...t,rules:{captureGroup:!1,singleline:!1,...t.rules}},i=xoe(e,{flags:n.flags,rules:{captureGroup:n.rules.captureGroup,singleline:n.rules.singleline}}),s=(m,g)=>{const C=i.tokens[r.nextIndex];switch(r.parent=m,r.nextIndex++,C.type){case"Alternator":return Wa();case"Assertion":return Koe(C);case"Backreference":return Yoe(C,r);case"Character":return _g(C.value,{useLastValid:!!g.isCheckingRangeEnd});case"CharacterClassHyphen":return Qoe(C,r,g);case"CharacterClassOpen":return Joe(C,r,g);case"CharacterSet":return Xoe(C,r);case"Directive":return sae(C.kind,{flags:C.flags});case"GroupOpen":return Zoe(C,r,g);case"NamedCallout":return oae(C.kind,C.tag,C.arguments);case"Quantifier":return eae(C,r);case"Subroutine":return tae(C,r);default:throw new Error(`Unexpected token type "${C.type}"`)}},r={capturingGroups:[],hasNumberedRef:!1,namedGroupsByName:new Map,nextIndex:0,normalizeUnknownPropertyNames:n.normalizeUnknownPropertyNames,parent:null,skipBackrefValidation:n.skipBackrefValidation,skipLookbehindValidation:n.skipLookbehindValidation,skipPropertyNameValidation:n.skipPropertyNameValidation,subroutines:[],tokens:i.tokens,unicodePropertyMap:n.unicodePropertyMap,walk:s},a=lae(rae(i.flags));let o=a.body[0];for(;r.nextIndex<i.tokens.length;){const m=s(o,{});m.type==="Alternative"?(a.body.push(m),o=m):o.body.push(m)}const{capturingGroups:l,hasNumberedRef:u,namedGroupsByName:h,subroutines:f}=r;if(u&&h.size&&!n.rules.captureGroup)throw new Error("Numbered backref/subroutine not allowed when using named capture");for(const{ref:m}of f)if(typeof m=="number"){if(m>l.length)throw new Error("Subroutine uses a group number that's not defined");m&&(l[m-1].isSubroutined=!0)}else if(h.has(m)){if(h.get(m).length>1)throw new Error(En`Subroutine uses a duplicate group name "\g<${m}>"`);h.get(m)[0].isSubroutined=!0}else throw new Error(En`Subroutine uses a group name that's not defined "\g<${m}>"`);return a}function Koe({kind:e}){return J0(Uc({"^":"line_start",$:"line_end","\\A":"string_start","\\b":"word_boundary","\\B":"word_boundary","\\G":"search_start","\\y":"text_segment_boundary","\\Y":"text_segment_boundary","\\z":"string_end","\\Z":"string_end_newline"}[e],`Unexpected assertion kind "${e}"`),{negate:e===En`\B`||e===En`\Y`})}function Yoe({raw:e},t){const n=/^\\k[<']/.test(e),i=n?e.slice(3,-1):e.slice(1),s=(r,a=!1)=>{const o=t.capturingGroups.length;let l=!1;if(r>o)if(t.skipBackrefValidation)l=!0;else throw new Error(`Not enough capturing groups defined to the left "${e}"`);return t.hasNumberedRef=!0,X0(a?o+1-r:r,{orphan:l})};if(n){const r=/^(?<sign>-?)0*(?<num>[1-9]\d*)$/.exec(i);if(r)return s(+r.groups.num,!!r.groups.sign);if(/[-+]/.test(i))throw new Error(`Invalid backref name "${e}"`);if(!t.namedGroupsByName.has(i))throw new Error(`Group name not defined to the left "${e}"`);return X0(i)}return s(+i)}function Qoe(e,t,n){const{tokens:i,walk:s}=t,r=t.parent,a=r.body.at(-1),o=i[t.nextIndex];if(!n.isCheckingRangeEnd&&a&&a.type!=="CharacterClass"&&a.type!=="CharacterClassRange"&&o&&o.type!=="CharacterClassOpen"&&o.type!=="CharacterClassClose"&&o.type!=="CharacterClassIntersector"){const l=s(r,{...n,isCheckingRangeEnd:!0});if(a.type==="Character"&&l.type==="Character")return r.body.pop(),iae(a,l);throw new Error("Invalid character class range")}return _g(Fc("-"))}function Joe({negate:e},t,n){const{tokens:i,walk:s}=t,r=i[t.nextIndex],a=[Bp()];let o=WM(r);for(;o.type!=="CharacterClassClose";){if(o.type==="CharacterClassIntersector")a.push(Bp()),t.nextIndex++;else{const u=a.at(-1);u.body.push(s(u,n))}o=WM(i[t.nextIndex],r)}const l=Bp({negate:e});return a.length===1?l.body=a[0].body:(l.kind="intersection",l.body=a.map(u=>u.body.length===1?u.body[0]:u)),t.nextIndex++,l}function Xoe({kind:e,negate:t,value:n},i){const{normalizeUnknownPropertyNames:s,skipPropertyNameValidation:r,unicodePropertyMap:a}=i;if(e==="property"){const o=Sg(n);if(nx.has(o)&&!a?.has(o))e="posix",n=o;else return nc(n,{negate:t,normalizeUnknownPropertyNames:s,skipPropertyNameValidation:r,unicodePropertyMap:a})}return e==="posix"?aae(n,{negate:t}):Z0(e,{negate:t})}function Zoe(e,t,n){const{tokens:i,capturingGroups:s,namedGroupsByName:r,skipLookbehindValidation:a,walk:o}=t,l=cae(e),u=l.type==="AbsenceFunction",h=VM(l),f=h&&l.negate;if(l.type==="CapturingGroup"&&(s.push(l),l.name&&Coe(r,l.name,[]).push(l)),u&&n.isInAbsenceFunction)throw new Error("Nested absence function not supported by Oniguruma");let m=GM(i[t.nextIndex]);for(;m.type!=="GroupClose";){if(m.type==="Alternator")l.body.push(Wa()),t.nextIndex++;else{const g=l.body.at(-1),C=o(g,{...n,isInAbsenceFunction:n.isInAbsenceFunction||u,isInLookbehind:n.isInLookbehind||h,isInNegLookbehind:n.isInNegLookbehind||f});if(g.body.push(C),(h||n.isInLookbehind)&&!a){const S="Lookbehind includes a pattern not allowed by Oniguruma";if(f||n.isInNegLookbehind){if(qM(C)||C.type==="CapturingGroup")throw new Error(S)}else if(qM(C)||VM(C)&&C.negate)throw new Error(S)}}m=GM(i[t.nextIndex])}return t.nextIndex++,l}function eae({kind:e,min:t,max:n},i){const s=i.parent,r=s.body.at(-1);if(!r||!Woe(r))throw new Error("Quantifier requires a repeatable token");const a=n3(e,t,n,r);return s.body.pop(),a}function tae({raw:e},t){const{capturingGroups:n,subroutines:i}=t;let s=e.slice(3,-1);const r=/^(?<sign>[-+]?)0*(?<num>[1-9]\d*)$/.exec(s);if(r){const o=+r.groups.num,l=n.length;if(t.hasNumberedRef=!0,s={"":o,"+":l+o,"-":l+1-o}[r.groups.sign],s<1)throw new Error("Invalid subroutine number")}else s==="0"&&(s=0);const a=i3(s);return i.push(a),a}function nae(e,t){return{type:"AbsenceFunction",kind:e,body:fh(t?.body)}}function Wa(e){return{type:"Alternative",body:s3(e?.body)}}function J0(e,t){const n={type:"Assertion",kind:e};return(e==="word_boundary"||e==="text_segment_boundary")&&(n.negate=!!t?.negate),n}function X0(e,t){const n=!!t?.orphan;return{type:"Backreference",ref:e,...n&&{orphan:n}}}function t3(e,t){const n={name:void 0,isSubroutined:!1,...t};if(n.name!==void 0&&!uae(n.name))throw new Error(`Group name "${n.name}" invalid in Oniguruma`);return{type:"CapturingGroup",number:e,...n.name&&{name:n.name},...n.isSubroutined&&{isSubroutined:n.isSubroutined},body:fh(t?.body)}}function _g(e,t){const n={useLastValid:!1,...t};if(e>1114111){const i=e.toString(16);if(n.useLastValid)e=1114111;else throw e>1310719?new Error(`Invalid code point out of range "\\x{${i}}"`):new Error(`Invalid code point out of range in JS "\\x{${i}}"`)}return{type:"Character",value:e}}function Bp(e){const t={kind:"union",negate:!1,...e};return{type:"CharacterClass",kind:t.kind,negate:t.negate,body:s3(e?.body)}}function iae(e,t){if(t.value<e.value)throw new Error("Character class range out of order");return{type:"CharacterClassRange",min:e,max:t}}function Z0(e,t){const n=!!t?.negate,i={type:"CharacterSet",kind:e};return(e==="digit"||e==="hex"||e==="newline"||e==="space"||e==="word")&&(i.negate=n),(e==="text_segment"||e==="newline"&&!n)&&(i.variableLength=!0),i}function sae(e,t={}){if(e==="keep")return{type:"Directive",kind:e};if(e==="flags")return{type:"Directive",kind:e,flags:Uc(t.flags)};throw new Error(`Unexpected directive kind "${e}"`)}function rae(e){return{type:"Flags",...e}}function bs(e){const t=e?.atomic,n=e?.flags;if(t&&n)throw new Error("Atomic group cannot have flags");return{type:"Group",...t&&{atomic:t},...n&&{flags:n},body:fh(e?.body)}}function wa(e){const t={behind:!1,negate:!1,...e};return{type:"LookaroundAssertion",kind:t.behind?"lookbehind":"lookahead",negate:t.negate,body:fh(e?.body)}}function oae(e,t,n){return{type:"NamedCallout",kind:e,tag:t,arguments:n}}function aae(e,t){const n=!!t?.negate;if(!nx.has(e))throw new Error(`Invalid POSIX class "${e}"`);return{type:"CharacterSet",kind:"posix",value:e,negate:n}}function n3(e,t,n,i){if(t>n)throw new Error("Invalid reversed quantifier range");return{type:"Quantifier",kind:e,min:t,max:n,body:i}}function lae(e,t){return{type:"Regex",body:fh(t?.body),flags:e}}function i3(e){return{type:"Subroutine",ref:e}}function nc(e,t){const n={negate:!1,normalizeUnknownPropertyNames:!1,skipPropertyNameValidation:!1,unicodePropertyMap:null,...t};let i=n.unicodePropertyMap?.get(Sg(e));if(!i){if(n.normalizeUnknownPropertyNames)i=dae(e);else if(n.unicodePropertyMap&&!n.skipPropertyNameValidation)throw new Error(En`Invalid Unicode property "\p{${e}}"`)}return{type:"CharacterSet",kind:"property",value:i??e,negate:n.negate}}function cae({flags:e,kind:t,name:n,negate:i,number:s}){switch(t){case"absence_repeater":return nae("repeater");case"atomic":return bs({atomic:!0});case"capturing":return t3(s,{name:n});case"group":return bs({flags:e});case"lookahead":case"lookbehind":return wa({behind:t==="lookbehind",negate:i});default:throw new Error(`Unexpected group kind "${t}"`)}}function fh(e){if(e===void 0)e=[Wa()];else if(!Array.isArray(e)||!e.length||!e.every(t=>t.type==="Alternative"))throw new Error("Invalid body; expected array of one or more Alternative nodes");return e}function s3(e){if(e===void 0)e=[];else if(!Array.isArray(e)||!e.every(t=>!!t.type))throw new Error("Invalid body; expected array of nodes");return e}function qM(e){return e.type==="LookaroundAssertion"&&e.kind==="lookahead"}function VM(e){return e.type==="LookaroundAssertion"&&e.kind==="lookbehind"}function uae(e){return/^[\p{Alpha}\p{Pc}][^)]*$/u.test(e)}function dae(e){return e.trim().replace(/[- _]+/g,"_").replace(/[A-Z][a-z]+(?=[A-Z])/g,"$&_").replace(/[A-Za-z]+/g,t=>t[0].toUpperCase()+t.slice(1).toLowerCase())}function Sg(e){return e.replace(/[- _]+/g,"").toLowerCase()}function WM(e,t){return Uc(e,`${t?.type==="Character"&&t.value===93?"Empty":"Unclosed"} character class`)}function GM(e){return Uc(e,"Unclosed group")}function _d(e,t,n=null){function i(r,a){for(let o=0;o<r.length;o++){const l=s(r[o],a,o,r);o=Math.max(-1,o+l)}}function s(r,a=null,o=null,l=null){let u=0,h=!1;const f={node:r,parent:a,key:o,container:l,root:e,remove(){sp(l).splice(Math.max(0,Jl(o)+u),1),u--,h=!0},removeAllNextSiblings(){return sp(l).splice(Jl(o)+1)},removeAllPrevSiblings(){const _=Jl(o)+u;return u-=_,sp(l).splice(0,Math.max(0,_))},replaceWith(_,w={}){const x=!!w.traverse;l?l[Math.max(0,Jl(o)+u)]=_:Uc(a,"Can't replace root node")[o]=_,x&&s(_,a,o,l),h=!0},replaceWithMultiple(_,w={}){const x=!!w.traverse;if(sp(l).splice(Math.max(0,Jl(o)+u),1,..._),u+=_.length-1,x){let k=0;for(let A=0;A<_.length;A++)k+=s(_[A],a,Jl(o)+A+k,l)}h=!0},skip(){h=!0}},{type:m}=r,g=t["*"],C=t[m],S=typeof g=="function"?g:g?.enter,v=typeof C=="function"?C:C?.enter;if(S?.(f,n),v?.(f,n),!h)switch(m){case"AbsenceFunction":case"CapturingGroup":case"Group":i(r.body,r);break;case"Alternative":case"CharacterClass":i(r.body,r);break;case"Assertion":case"Backreference":case"Character":case"CharacterSet":case"Directive":case"Flags":case"NamedCallout":case"Subroutine":break;case"CharacterClassRange":s(r.min,r,"min"),s(r.max,r,"max");break;case"LookaroundAssertion":i(r.body,r);break;case"Quantifier":s(r.body,r,"body");break;case"Regex":i(r.body,r),s(r.flags,r,"flags");break;default:throw new Error(`Unexpected node type "${m}"`)}return C?.exit?.(f,n),g?.exit?.(f,n),u}return s(e),e}function sp(e){if(!Array.isArray(e))throw new Error("Container expected");return e}function Jl(e){if(typeof e!="number")throw new Error("Numeric key expected");return e}const hae=String.raw`\(\?(?:[:=!>A-Za-z\-]|<[=!]|\(DEFINE\))`;function fae(e,t){for(let n=0;n<e.length;n++)e[n]>=t&&e[n]++}function pae(e,t,n,i){return e.slice(0,t)+i+e.slice(t+n.length)}const ns=Object.freeze({DEFAULT:"DEFAULT",CHAR_CLASS:"CHAR_CLASS"});function sx(e,t,n,i){const s=new RegExp(String.raw`${t}|(?<$skip>\[\^?|\\?.)`,"gsu"),r=[!1];let a=0,o="";for(const l of e.matchAll(s)){const{0:u,groups:{$skip:h}}=l;if(!h&&(!i||i===ns.DEFAULT==!a)){n instanceof Function?o+=n(l,{context:a?ns.CHAR_CLASS:ns.DEFAULT,negated:r[r.length-1]}):o+=n;continue}u[0]==="["?(a++,r.push(u[1]==="^")):u==="]"&&a&&(a--,r.pop()),o+=u}return o}function r3(e,t,n,i){sx(e,t,n,i)}function mae(e,t,n=0,i){if(!new RegExp(t,"su").test(e))return null;const s=new RegExp(`${t}|(?<$skip>\\\\?.)`,"gsu");s.lastIndex=n;let r=0,a;for(;a=s.exec(e);){const{0:o,groups:{$skip:l}}=a;if(!l&&(!i||i===ns.DEFAULT==!r))return a;o==="["?r++:o==="]"&&r&&r--,s.lastIndex==a.index&&s.lastIndex++}return null}function rp(e,t,n){return!!mae(e,t,0,n)}function gae(e,t){const n=/\\?./gsu;n.lastIndex=t;let i=e.length,s=0,r=1,a;for(;a=n.exec(e);){const[o]=a;if(o==="[")s++;else if(s)o==="]"&&s--;else if(o==="(")r++;else if(o===")"&&(r--,!r)){i=a.index;break}}return e.slice(t,i)}const KM=new RegExp(String.raw`(?<noncapturingStart>${hae})|(?<capturingStart>\((?:\?<[^>]+>)?)|\\?.`,"gsu");function vae(e,t){const n=t?.hiddenCaptures??[];let i=t?.captureTransfers??new Map;if(!/\(\?>/.test(e))return{pattern:e,captureTransfers:i,hiddenCaptures:n};const s="(?>",r="(?:(?=(",a=[0],o=[];let l=0,u=0,h=NaN,f;do{f=!1;let m=0,g=0,C=!1,S;for(KM.lastIndex=Number.isNaN(h)?0:h+r.length;S=KM.exec(e);){const{0:v,index:_,groups:{capturingStart:w,noncapturingStart:x}}=S;if(v==="[")m++;else if(m)v==="]"&&m--;else if(v===s&&!C)h=_,C=!0;else if(C&&x)g++;else if(w)C?g++:(l++,a.push(l+u));else if(v===")"&&C){if(!g){u++;const k=l+u;if(e=`${e.slice(0,h)}${r}${e.slice(h+s.length,_)}))<$$${k}>)${e.slice(_+1)}`,f=!0,o.push(k),fae(n,k),i.size){const A=new Map;i.forEach((T,M)=>{A.set(M>=k?M+1:M,T.map(E=>E>=k?E+1:E))}),i=A}break}g--}}}while(f);return n.push(...o),e=sx(e,String.raw`\\(?<backrefNum>[1-9]\d*)|<\$\$(?<wrappedBackrefNum>\d+)>`,({0:m,groups:{backrefNum:g,wrappedBackrefNum:C}})=>{if(g){const S=+g;if(S>a.length-1)throw new Error(`Backref "${m}" greater than number of captures`);return`\\${a[S]}`}return`\\${C}`},ns.DEFAULT),{pattern:e,captureTransfers:i,hiddenCaptures:n}}const o3=String.raw`(?:[?*+]|\{\d+(?:,\d*)?\})`,b_=new RegExp(String.raw`
\\(?: \d+
  | c[A-Za-z]
  | [gk]<[^>]+>
  | [pPu]\{[^\}]+\}
  | u[A-Fa-f\d]{4}
  | x[A-Fa-f\d]{2}
  )
| \((?: \? (?: [:=!>]
  | <(?:[=!]|[^>]+>)
  | [A-Za-z\-]+:
  | \(DEFINE\)
  ))?
| (?<qBase>${o3})(?<qMod>[?+]?)(?<invalidQ>[?*+\{]?)
| \\?.
`.replace(/\s+/g,""),"gsu");function bae(e){if(!new RegExp(`${o3}\\+`).test(e))return{pattern:e};const t=[];let n=null,i=null,s="",r=0,a;for(b_.lastIndex=0;a=b_.exec(e);){const{0:o,index:l,groups:{qBase:u,qMod:h,invalidQ:f}}=a;if(o==="[")r||(i=l),r++;else if(o==="]")r?r--:i=null;else if(!r)if(h==="+"&&s&&!s.startsWith("(")){if(f)throw new Error(`Invalid quantifier "${o}"`);let m=-1;if(/^\{\d+\}$/.test(u))e=pae(e,l+u.length,h,"");else{if(s===")"||s==="]"){const g=s===")"?n:i;if(g===null)throw new Error(`Invalid unmatched "${s}"`);e=`${e.slice(0,g)}(?>${e.slice(g,l)}${u})${e.slice(l+o.length)}`}else e=`${e.slice(0,l-s.length)}(?>${s}${u})${e.slice(l+o.length)}`;m+=4}b_.lastIndex+=m}else o[0]==="("?t.push(l):o===")"&&(n=t.length?t.pop():null);s=o}return{pattern:e}}const Zi=String.raw,yae=Zi`\\g<(?<gRNameOrNum>[^>&]+)&R=(?<gRDepth>[^>]+)>`,eS=Zi`\(\?R=(?<rDepth>[^\)]+)\)|${yae}`,Cg=Zi`\(\?<(?![=!])(?<captureName>[^>]+)>`,a3=Zi`${Cg}|(?<unnamed>\()(?!\?)`,ma=new RegExp(Zi`${Cg}|${eS}|\(\?|\\?.`,"gsu"),y_="Cannot use multiple overlapping recursions";function _ae(e,t){const{hiddenCaptures:n,mode:i}={hiddenCaptures:[],mode:"plugin",...t};let s=t?.captureTransfers??new Map;if(!new RegExp(eS,"su").test(e))return{pattern:e,captureTransfers:s,hiddenCaptures:n};if(i==="plugin"&&rp(e,Zi`\(\?\(DEFINE\)`,ns.DEFAULT))throw new Error("DEFINE groups cannot be used with recursion");const r=[],a=rp(e,Zi`\\[1-9]`,ns.DEFAULT),o=new Map,l=[];let u=!1,h=0,f=0,m;for(ma.lastIndex=0;m=ma.exec(e);){const{0:g,groups:{captureName:C,rDepth:S,gRNameOrNum:v,gRDepth:_}}=m;if(g==="[")h++;else if(h)g==="]"&&h--;else if(S){if(YM(S),u)throw new Error(y_);if(a)throw new Error(`${i==="external"?"Backrefs":"Numbered backrefs"} cannot be used with global recursion`);const w=e.slice(0,m.index),x=e.slice(ma.lastIndex);if(rp(x,eS,ns.DEFAULT))throw new Error(y_);const k=+S-1;e=QM(w,x,k,!1,n,r,f),s=XM(s,w,k,r.length,0,f);break}else if(v){YM(_);let w=!1;for(const j of l)if(j.name===v||j.num===+v){if(w=!0,j.hasRecursedWithin)throw new Error(y_);break}if(!w)throw new Error(Zi`Recursive \g cannot be used outside the referenced group "${i==="external"?v:Zi`\g<${v}&R=${_}>`}"`);const x=o.get(v),k=gae(e,x);if(a&&rp(k,Zi`${Cg}|\((?!\?)`,ns.DEFAULT))throw new Error(`${i==="external"?"Backrefs":"Numbered backrefs"} cannot be used with recursion of capturing groups`);const A=e.slice(x,m.index),T=k.slice(A.length+g.length),M=r.length,E=+_-1,L=QM(A,T,E,!0,n,r,f);s=XM(s,A,E,r.length-M,M,f);const D=e.slice(0,x),O=e.slice(x+k.length);e=`${D}${L}${O}`,ma.lastIndex+=L.length-g.length-A.length-T.length,l.forEach(j=>j.hasRecursedWithin=!0),u=!0}else if(C)f++,o.set(String(f),ma.lastIndex),o.set(C,ma.lastIndex),l.push({num:f,name:C});else if(g[0]==="("){const w=g==="(";w&&(f++,o.set(String(f),ma.lastIndex)),l.push(w?{num:f}:{})}else g===")"&&l.pop()}return n.push(...r),{pattern:e,captureTransfers:s,hiddenCaptures:n}}function YM(e){const t=`Max depth must be integer between 2 and 100; used ${e}`;if(!/^[1-9]\d*$/.test(e))throw new Error(t);if(e=+e,e<2||e>100)throw new Error(t)}function QM(e,t,n,i,s,r,a){const o=new Set;i&&r3(e+t,Cg,({groups:{captureName:u}})=>{o.add(u)},ns.DEFAULT);const l=[n,i?o:null,s,r,a];return`${e}${JM(`(?:${e}`,"forward",...l)}(?:)${JM(`${t})`,"backward",...l)}${t}`}function JM(e,t,n,i,s,r,a){const l=h=>t==="forward"?h+2:n-h+2-1;let u="";for(let h=0;h<n;h++){const f=l(h);u+=sx(e,Zi`${a3}|\\k<(?<backref>[^>]+)>`,({0:m,groups:{captureName:g,unnamed:C,backref:S}})=>{if(S&&i&&!i.has(S))return m;const v=`_$${f}`;if(C||g){const _=a+r.length+1;return r.push(_),Sae(s,_),C?m:`(?<${g}${v}>`}return Zi`\k<${S}${v}>`},ns.DEFAULT)}return u}function Sae(e,t){for(let n=0;n<e.length;n++)e[n]>=t&&e[n]++}function XM(e,t,n,i,s,r){if(e.size&&i){let a=0;r3(t,a3,()=>a++,ns.DEFAULT);const o=r-a+s,l=new Map;return e.forEach((u,h)=>{const f=(i-a*n)/n,m=a*n,g=h>o+a?h+i:h,C=[];for(const S of u)if(S<=o)C.push(S);else if(S>o+a+f)C.push(S+i);else if(S<=o+a)for(let v=0;v<=n;v++)C.push(S+a*v);else for(let v=0;v<=n;v++)C.push(S+m+f*v);l.set(g,C)}),l}return e}var yn=String.fromCodePoint,Xe=String.raw,jr={flagGroups:(()=>{try{new RegExp("(?i:)")}catch{return!1}return!0})(),unicodeSets:(()=>{try{new RegExp("[[]]","v")}catch{return!1}return!0})()};jr.bugFlagVLiteralHyphenIsRange=jr.unicodeSets?(()=>{try{new RegExp(Xe`[\d\-a]`,"v")}catch{return!0}return!1})():!1;jr.bugNestedClassIgnoresNegation=jr.unicodeSets&&new RegExp("[[^a]]","v").test("a");function Nm(e,{enable:t,disable:n}){return{dotAll:!n?.dotAll&&!!(t?.dotAll||e.dotAll),ignoreCase:!n?.ignoreCase&&!!(t?.ignoreCase||e.ignoreCase)}}function Xd(e,t,n){return e.has(t)||e.set(t,n),e.get(t)}function tS(e,t){return ZM[e]>=ZM[t]}function Cae(e,t){if(e==null)throw new Error(t??"Value expected");return e}var ZM={ES2025:2025,ES2024:2024,ES2018:2018},xae={auto:"auto",ES2025:"ES2025",ES2024:"ES2024",ES2018:"ES2018"};function l3(e={}){if({}.toString.call(e)!=="[object Object]")throw new Error("Unexpected options");if(e.target!==void 0&&!xae[e.target])throw new Error(`Unexpected target "${e.target}"`);const t={accuracy:"default",avoidSubclass:!1,flags:"",global:!1,hasIndices:!1,lazyCompileLength:1/0,target:"auto",verbose:!1,...e,rules:{allowOrphanBackrefs:!1,asciiWordBoundaries:!1,captureGroup:!1,recursionLimit:20,singleline:!1,...e.rules}};return t.target==="auto"&&(t.target=jr.flagGroups?"ES2025":jr.unicodeSets?"ES2024":"ES2018"),t}var wae="[	-\r ]",kae=new Set([yn(304),yn(305)]),xr=Xe`[\p{L}\p{M}\p{N}\p{Pc}]`;function c3(e){if(kae.has(e))return[e];const t=new Set,n=e.toLowerCase(),i=n.toUpperCase(),s=Rae.get(n),r=Tae.get(n),a=Eae.get(n);return[...i].length===1&&t.add(i),a&&t.add(a),s&&t.add(s),t.add(n),r&&t.add(r),[...t]}var rx=new Map(`C Other
Cc Control cntrl
Cf Format
Cn Unassigned
Co Private_Use
Cs Surrogate
L Letter
LC Cased_Letter
Ll Lowercase_Letter
Lm Modifier_Letter
Lo Other_Letter
Lt Titlecase_Letter
Lu Uppercase_Letter
M Mark Combining_Mark
Mc Spacing_Mark
Me Enclosing_Mark
Mn Nonspacing_Mark
N Number
Nd Decimal_Number digit
Nl Letter_Number
No Other_Number
P Punctuation punct
Pc Connector_Punctuation
Pd Dash_Punctuation
Pe Close_Punctuation
Pf Final_Punctuation
Pi Initial_Punctuation
Po Other_Punctuation
Ps Open_Punctuation
S Symbol
Sc Currency_Symbol
Sk Modifier_Symbol
Sm Math_Symbol
So Other_Symbol
Z Separator
Zl Line_Separator
Zp Paragraph_Separator
Zs Space_Separator
ASCII
ASCII_Hex_Digit AHex
Alphabetic Alpha
Any
Assigned
Bidi_Control Bidi_C
Bidi_Mirrored Bidi_M
Case_Ignorable CI
Cased
Changes_When_Casefolded CWCF
Changes_When_Casemapped CWCM
Changes_When_Lowercased CWL
Changes_When_NFKC_Casefolded CWKCF
Changes_When_Titlecased CWT
Changes_When_Uppercased CWU
Dash
Default_Ignorable_Code_Point DI
Deprecated Dep
Diacritic Dia
Emoji
Emoji_Component EComp
Emoji_Modifier EMod
Emoji_Modifier_Base EBase
Emoji_Presentation EPres
Extended_Pictographic ExtPict
Extender Ext
Grapheme_Base Gr_Base
Grapheme_Extend Gr_Ext
Hex_Digit Hex
IDS_Binary_Operator IDSB
IDS_Trinary_Operator IDST
ID_Continue IDC
ID_Start IDS
Ideographic Ideo
Join_Control Join_C
Logical_Order_Exception LOE
Lowercase Lower
Math
Noncharacter_Code_Point NChar
Pattern_Syntax Pat_Syn
Pattern_White_Space Pat_WS
Quotation_Mark QMark
Radical
Regional_Indicator RI
Sentence_Terminal STerm
Soft_Dotted SD
Terminal_Punctuation Term
Unified_Ideograph UIdeo
Uppercase Upper
Variation_Selector VS
White_Space space
XID_Continue XIDC
XID_Start XIDS`.split(/\s/).map(e=>[Sg(e),e])),Tae=new Map([["s",yn(383)],[yn(383),"s"]]),Eae=new Map([[yn(223),yn(7838)],[yn(107),yn(8490)],[yn(229),yn(8491)],[yn(969),yn(8486)]]),Rae=new Map([_o(453),_o(456),_o(459),_o(498),...__(8072,8079),...__(8088,8095),...__(8104,8111),_o(8124),_o(8140),_o(8188)]),Aae=new Map([["alnum",Xe`[\p{Alpha}\p{Nd}]`],["alpha",Xe`\p{Alpha}`],["ascii",Xe`\p{ASCII}`],["blank",Xe`[\p{Zs}\t]`],["cntrl",Xe`\p{Cc}`],["digit",Xe`\p{Nd}`],["graph",Xe`[\P{space}&&\P{Cc}&&\P{Cn}&&\P{Cs}]`],["lower",Xe`\p{Lower}`],["print",Xe`[[\P{space}&&\P{Cc}&&\P{Cn}&&\P{Cs}]\p{Zs}]`],["punct",Xe`[\p{P}\p{S}]`],["space",Xe`\p{space}`],["upper",Xe`\p{Upper}`],["word",Xe`[\p{Alpha}\p{M}\p{Nd}\p{Pc}]`],["xdigit",Xe`\p{AHex}`]]);function Mae(e,t){const n=[];for(let i=e;i<=t;i++)n.push(i);return n}function _o(e){const t=yn(e);return[t.toLowerCase(),t]}function __(e,t){return Mae(e,t).map(n=>_o(n))}var u3=new Set(["Lower","Lowercase","Upper","Uppercase","Ll","Lowercase_Letter","Lt","Titlecase_Letter","Lu","Uppercase_Letter"]);function Lae(e,t){const n={accuracy:"default",asciiWordBoundaries:!1,avoidSubclass:!1,bestEffortTarget:"ES2025",...t};d3(e);const i={accuracy:n.accuracy,asciiWordBoundaries:n.asciiWordBoundaries,avoidSubclass:n.avoidSubclass,flagDirectivesByAlt:new Map,jsGroupNameMap:new Map,minTargetEs2024:tS(n.bestEffortTarget,"ES2024"),passedLookbehind:!1,strategy:null,subroutineRefMap:new Map,supportedGNodes:new Set,digitIsAscii:e.flags.digitIsAscii,spaceIsAscii:e.flags.spaceIsAscii,wordIsAscii:e.flags.wordIsAscii};_d(e,Iae,i);const s={dotAll:e.flags.dotAll,ignoreCase:e.flags.ignoreCase},r={currentFlags:s,prevFlags:null,globalFlags:s,groupOriginByCopy:new Map,groupsByName:new Map,multiplexCapturesToLeftByRef:new Map,openRefs:new Map,reffedNodesByReferencer:new Map,subroutineRefMap:i.subroutineRefMap};_d(e,Pae,r);const a={groupsByName:r.groupsByName,highestOrphanBackref:0,numCapturesToLeft:0,reffedNodesByReferencer:r.reffedNodesByReferencer};return _d(e,Dae,a),e._originMap=r.groupOriginByCopy,e._strategy=i.strategy,e}var Iae={AbsenceFunction({node:e,parent:t,replaceWith:n}){const{body:i,kind:s}=e;if(s==="repeater"){const r=bs();r.body[0].body.push(wa({negate:!0,body:i}),nc("Any"));const a=bs();a.body[0].body.push(n3("greedy",0,1/0,r)),n(an(a,t),{traverse:!0})}else throw new Error('Unsupported absence function "(?~|"')},Alternative:{enter({node:e,parent:t,key:n},{flagDirectivesByAlt:i}){const s=e.body.filter(r=>r.kind==="flags");for(let r=n+1;r<t.body.length;r++){const a=t.body[r];Xd(i,a,[]).push(...s)}},exit({node:e},{flagDirectivesByAlt:t}){if(t.get(e)?.length){const n=f3(t.get(e));if(n){const i=bs({flags:n});i.body[0].body=e.body,e.body=[an(i,e)]}}}},Assertion({node:e,parent:t,key:n,container:i,root:s,remove:r,replaceWith:a},o){const{kind:l,negate:u}=e,{asciiWordBoundaries:h,avoidSubclass:f,supportedGNodes:m,wordIsAscii:g}=o;if(l==="text_segment_boundary")throw new Error(`Unsupported text segment boundary "\\${u?"Y":"y"}"`);if(l==="line_end")a(an(wa({body:[Wa({body:[J0("string_end")]}),Wa({body:[_g(10)]})]}),t));else if(l==="line_start")a(an(wr(Xe`(?<=\A|\n(?!\z))`,{skipLookbehindValidation:!0}),t));else if(l==="search_start")if(m.has(e))s.flags.sticky=!0,r();else{const C=i[n-1];if(C&&Uae(C))a(an(wa({negate:!0}),t));else{if(f)throw new Error(Xe`Uses "\G" in a way that requires a subclass`);a(So(J0("string_start"),t)),o.strategy="clip_search"}}else if(!(l==="string_end"||l==="string_start"))if(l==="string_end_newline")a(an(wr(Xe`(?=\n?\z)`),t));else if(l==="word_boundary"){if(!g&&!h){const C=`(?:(?<=${xr})(?!${xr})|(?<!${xr})(?=${xr}))`,S=`(?:(?<=${xr})(?=${xr})|(?<!${xr})(?!${xr}))`;a(an(wr(u?S:C),t))}}else throw new Error(`Unexpected assertion kind "${l}"`)},Backreference({node:e},{jsGroupNameMap:t}){let{ref:n}=e;typeof n=="string"&&!C_(n)&&(n=S_(n,t),e.ref=n)},CapturingGroup({node:e},{jsGroupNameMap:t,subroutineRefMap:n}){let{name:i}=e;i&&!C_(i)&&(i=S_(i,t),e.name=i),n.set(e.number,e),i&&n.set(i,e)},CharacterClassRange({node:e,parent:t,replaceWith:n}){if(t.kind==="intersection"){const i=Bp({body:[e]});n(an(i,t),{traverse:!0})}},CharacterSet({node:e,parent:t,replaceWith:n},{accuracy:i,minTargetEs2024:s,digitIsAscii:r,spaceIsAscii:a,wordIsAscii:o}){const{kind:l,negate:u,value:h}=e;if(r&&(l==="digit"||h==="digit")){n(So(Z0("digit",{negate:u}),t));return}if(a&&(l==="space"||h==="space")){n(an(x_(wr(wae),u),t));return}if(o&&(l==="word"||h==="word")){n(So(Z0("word",{negate:u}),t));return}if(l==="any")n(So(nc("Any"),t));else if(l==="digit")n(So(nc("Nd",{negate:u}),t));else if(l!=="dot")if(l==="text_segment"){if(i==="strict")throw new Error(Xe`Use of "\X" requires non-strict accuracy`);const f="\\p{Emoji}(?:\\p{EMod}|\\uFE0F\\u20E3?|[\\x{E0020}-\\x{E007E}]+\\x{E007F})?",m=Xe`\p{RI}{2}|${f}(?:\u200D${f})*`;n(an(wr(Xe`(?>\r\n|${s?Xe`\p{RGI_Emoji}`:m}|\P{M}\p{M}*)`,{skipPropertyNameValidation:!0}),t))}else if(l==="hex")n(So(nc("AHex",{negate:u}),t));else if(l==="newline")n(an(wr(u?`[^
]`:`(?>\r
?|[
\v\f\u2028\u2029])`),t));else if(l==="posix")if(!s&&(h==="graph"||h==="print")){if(i==="strict")throw new Error(`POSIX class "${h}" requires min target ES2024 or non-strict accuracy`);let f={graph:"!-~",print:" -~"}[h];u&&(f=`\0-${yn(f.codePointAt(0)-1)}${yn(f.codePointAt(2)+1)}-`),n(an(wr(`[${f}]`),t))}else n(an(x_(wr(Aae.get(h)),u),t));else if(l==="property")rx.has(Sg(h))||(e.key="sc");else if(l==="space")n(So(nc("space",{negate:u}),t));else if(l==="word")n(an(x_(wr(xr),u),t));else throw new Error(`Unexpected character set kind "${l}"`)},Directive({node:e,parent:t,root:n,remove:i,replaceWith:s,removeAllPrevSiblings:r,removeAllNextSiblings:a}){const{kind:o,flags:l}=e;if(o==="flags")if(!l.enable&&!l.disable)i();else{const u=bs({flags:l});u.body[0].body=a(),s(an(u,t),{traverse:!0})}else if(o==="keep"){const u=n.body[0],f=n.body.length===1&&Z5(u,{type:"Group"})&&u.body[0].body.length===1?u.body[0]:n;if(t.parent!==f||f.body.length>1)throw new Error(Xe`Uses "\K" in a way that's unsupported`);const m=wa({behind:!0});m.body[0].body=r(),s(an(m,t))}else throw new Error(`Unexpected directive kind "${o}"`)},Flags({node:e,parent:t}){if(e.posixIsAscii)throw new Error('Unsupported flag "P"');if(e.textSegmentMode==="word")throw new Error('Unsupported flag "y{w}"');["digitIsAscii","extended","posixIsAscii","spaceIsAscii","wordIsAscii","textSegmentMode"].forEach(n=>delete e[n]),Object.assign(e,{global:!1,hasIndices:!1,multiline:!1,sticky:e.sticky??!1}),t.options={disable:{x:!0,n:!0},force:{v:!0}}},Group({node:e}){if(!e.flags)return;const{enable:t,disable:n}=e.flags;t?.extended&&delete t.extended,n?.extended&&delete n.extended,t?.dotAll&&n?.dotAll&&delete t.dotAll,t?.ignoreCase&&n?.ignoreCase&&delete t.ignoreCase,t&&!Object.keys(t).length&&delete e.flags.enable,n&&!Object.keys(n).length&&delete e.flags.disable,!e.flags.enable&&!e.flags.disable&&delete e.flags},LookaroundAssertion({node:e},t){const{kind:n}=e;n==="lookbehind"&&(t.passedLookbehind=!0)},NamedCallout({node:e,parent:t,replaceWith:n}){const{kind:i}=e;if(i==="fail")n(an(wa({negate:!0}),t));else throw new Error(`Unsupported named callout "(*${i.toUpperCase()}"`)},Quantifier({node:e}){if(e.body.type==="Quantifier"){const t=bs();t.body[0].body.push(e.body),e.body=an(t,e)}},Regex:{enter({node:e},{supportedGNodes:t}){const n=[];let i=!1,s=!1;for(const r of e.body)if(r.body.length===1&&r.body[0].kind==="search_start")r.body.pop();else{const a=m3(r.body);a?(i=!0,Array.isArray(a)?n.push(...a):n.push(a)):s=!0}i&&!s&&n.forEach(r=>t.add(r))},exit(e,{accuracy:t,passedLookbehind:n,strategy:i}){if(t==="strict"&&n&&i)throw new Error(Xe`Uses "\G" in a way that requires non-strict accuracy`)}},Subroutine({node:e},{jsGroupNameMap:t}){let{ref:n}=e;typeof n=="string"&&!C_(n)&&(n=S_(n,t),e.ref=n)}},Pae={Backreference({node:e},{multiplexCapturesToLeftByRef:t,reffedNodesByReferencer:n}){const{orphan:i,ref:s}=e;i||n.set(e,[...t.get(s).map(({node:r})=>r)])},CapturingGroup:{enter({node:e,parent:t,replaceWith:n,skip:i},{groupOriginByCopy:s,groupsByName:r,multiplexCapturesToLeftByRef:a,openRefs:o,reffedNodesByReferencer:l}){const u=s.get(e);if(u&&o.has(e.number)){const f=So(eL(e.number),t);l.set(f,o.get(e.number)),n(f);return}o.set(e.number,e),a.set(e.number,[]),e.name&&Xd(a,e.name,[]);const h=a.get(e.name??e.number);for(let f=0;f<h.length;f++){const m=h[f];if(u===m.node||u&&u===m.origin||e===m.origin){h.splice(f,1);break}}if(a.get(e.number).push({node:e,origin:u}),e.name&&a.get(e.name).push({node:e,origin:u}),e.name){const f=Xd(r,e.name,new Map);let m=!1;if(u)m=!0;else for(const g of f.values())if(!g.hasDuplicateNameToRemove){m=!0;break}r.get(e.name).set(e,{node:e,hasDuplicateNameToRemove:m})}},exit({node:e},{openRefs:t}){t.delete(e.number)}},Group:{enter({node:e},t){t.prevFlags=t.currentFlags,e.flags&&(t.currentFlags=Nm(t.currentFlags,e.flags))},exit(e,t){t.currentFlags=t.prevFlags}},Subroutine({node:e,parent:t,replaceWith:n},i){const{isRecursive:s,ref:r}=e;if(s){let h=t;for(;(h=h.parent)&&!(h.type==="CapturingGroup"&&(h.name===r||h.number===r)););i.reffedNodesByReferencer.set(e,h);return}const a=i.subroutineRefMap.get(r),o=r===0,l=o?eL(0):h3(a,i.groupOriginByCopy,null);let u=l;if(!o){const h=f3(jae(a,m=>m.type==="Group"&&!!m.flags)),f=h?Nm(i.globalFlags,h):i.globalFlags;Oae(f,i.currentFlags)||(u=bs({flags:Bae(f)}),u.body[0].body.push(l))}n(an(u,t),{traverse:!o})}},Dae={Backreference({node:e,parent:t,replaceWith:n},i){if(e.orphan){i.highestOrphanBackref=Math.max(i.highestOrphanBackref,e.ref);return}const r=i.reffedNodesByReferencer.get(e).filter(a=>Nae(a,e));if(!r.length)n(an(wa({negate:!0}),t));else if(r.length>1){const a=bs({atomic:!0,body:r.reverse().map(o=>Wa({body:[X0(o.number)]}))});n(an(a,t))}else e.ref=r[0].number},CapturingGroup({node:e},t){e.number=++t.numCapturesToLeft,e.name&&t.groupsByName.get(e.name).get(e).hasDuplicateNameToRemove&&delete e.name},Regex:{exit({node:e},t){const n=Math.max(t.highestOrphanBackref-t.numCapturesToLeft,0);for(let i=0;i<n;i++){const s=t3();e.body.at(-1).body.push(s)}}},Subroutine({node:e},t){!e.isRecursive||e.ref===0||(e.ref=t.reffedNodesByReferencer.get(e).number)}};function d3(e){_d(e,{"*"({node:t,parent:n}){t.parent=n}})}function Oae(e,t){return e.dotAll===t.dotAll&&e.ignoreCase===t.ignoreCase}function Nae(e,t){let n=t;do{if(n.type==="Regex")return!1;if(n.type==="Alternative")continue;if(n===e)return!1;const i=p3(n.parent);for(const s of i){if(s===n)break;if(s===e||g3(s,e))return!0}}while(n=n.parent);throw new Error("Unexpected path")}function h3(e,t,n,i){const s=Array.isArray(e)?[]:{};for(const[r,a]of Object.entries(e))r==="parent"?s.parent=Array.isArray(n)?i:n:a&&typeof a=="object"?s[r]=h3(a,t,s,n):(r==="type"&&a==="CapturingGroup"&&t.set(s,t.get(e)??e),s[r]=a);return s}function eL(e){const t=i3(e);return t.isRecursive=!0,t}function jae(e,t){const n=[];for(;e=e.parent;)(!t||t(e))&&n.push(e);return n}function S_(e,t){if(t.has(e))return t.get(e);const n=`$${t.size}_${e.replace(/^[^$_\p{IDS}]|[^$\u200C\u200D\p{IDC}]/ug,"_")}`;return t.set(e,n),n}function f3(e){const t=["dotAll","ignoreCase"],n={enable:{},disable:{}};return e.forEach(({flags:i})=>{t.forEach(s=>{i.enable?.[s]&&(delete n.disable[s],n.enable[s]=!0),i.disable?.[s]&&(n.disable[s]=!0)})}),Object.keys(n.enable).length||delete n.enable,Object.keys(n.disable).length||delete n.disable,n.enable||n.disable?n:null}function Bae({dotAll:e,ignoreCase:t}){const n={};return(e||t)&&(n.enable={},e&&(n.enable.dotAll=!0),t&&(n.enable.ignoreCase=!0)),(!e||!t)&&(n.disable={},!e&&(n.disable.dotAll=!0),!t&&(n.disable.ignoreCase=!0)),n}function p3(e){if(!e)throw new Error("Node expected");const{body:t}=e;return Array.isArray(t)?t:t?[t]:null}function m3(e){const t=e.find(n=>n.kind==="search_start"||zae(n,{negate:!1})||!Fae(n));if(!t)return null;if(t.kind==="search_start")return t;if(t.type==="LookaroundAssertion")return t.body[0].body[0];if(t.type==="CapturingGroup"||t.type==="Group"){const n=[];for(const i of t.body){const s=m3(i.body);if(!s)return null;Array.isArray(s)?n.push(...s):n.push(s)}return n}return null}function g3(e,t){const n=p3(e)??[];for(const i of n)if(i===t||g3(i,t))return!0;return!1}function Fae({type:e}){return e==="Assertion"||e==="Directive"||e==="LookaroundAssertion"}function Uae(e){const t=["Character","CharacterClass","CharacterSet"];return t.includes(e.type)||e.type==="Quantifier"&&e.min&&t.includes(e.body.type)}function zae(e,t){const n={negate:null,...t};return e.type==="LookaroundAssertion"&&(n.negate===null||e.negate===n.negate)&&e.body.length===1&&Z5(e.body[0],{type:"Assertion",kind:"search_start"})}function C_(e){return/^[$_\p{IDS}][$\u200C\u200D\p{IDC}]*$/u.test(e)}function wr(e,t){const i=e3(e,{...t,unicodePropertyMap:rx}).body;return i.length>1||i[0].body.length>1?bs({body:i}):i[0].body[0]}function x_(e,t){return e.negate=t,e}function So(e,t){return e.parent=t,e}function an(e,t){return d3(e),e.parent=t,e}function Hae(e,t){const n=l3(t),i=tS(n.target,"ES2024"),s=tS(n.target,"ES2025"),r=n.rules.recursionLimit;if(!Number.isInteger(r)||r<2||r>20)throw new Error("Invalid recursionLimit; use 2-20");let a=null,o=null;if(!s){const g=[e.flags.ignoreCase];_d(e,$ae,{getCurrentModI:()=>g.at(-1),popModI(){g.pop()},pushModI(C){g.push(C)},setHasCasedChar(){g.at(-1)?a=!0:o=!0}})}const l={dotAll:e.flags.dotAll,ignoreCase:!!((e.flags.ignoreCase||a)&&!o)};let u=e;const h={accuracy:n.accuracy,appliedGlobalFlags:l,captureMap:new Map,currentFlags:{dotAll:e.flags.dotAll,ignoreCase:e.flags.ignoreCase},inCharClass:!1,lastNode:u,originMap:e._originMap,recursionLimit:r,useAppliedIgnoreCase:!!(!s&&a&&o),useFlagMods:s,useFlagV:i,verbose:n.verbose};function f(g){return h.lastNode=u,u=g,Cae(qae[g.type],`Unexpected node type "${g.type}"`)(g,h,f)}const m={pattern:e.body.map(f).join("|"),flags:f(e.flags),options:{...e.options}};return i||(delete m.options.force.v,m.options.disable.v=!0,m.options.unicodeSetsPlugin=null),m._captureTransfers=new Map,m._hiddenCaptures=[],h.captureMap.forEach((g,C)=>{g.hidden&&m._hiddenCaptures.push(C),g.transferTo&&Xd(m._captureTransfers,g.transferTo,[]).push(C)}),m}var $ae={"*":{enter({node:e},t){if(nL(e)){const n=t.getCurrentModI();t.pushModI(e.flags?Nm({ignoreCase:n},e.flags).ignoreCase:n)}},exit({node:e},t){nL(e)&&t.popModI()}},Backreference(e,t){t.setHasCasedChar()},Character({node:e},t){ox(yn(e.value))&&t.setHasCasedChar()},CharacterClassRange({node:e,skip:t},n){t(),v3(e,{firstOnly:!0}).length&&n.setHasCasedChar()},CharacterSet({node:e},t){e.kind==="property"&&u3.has(e.value)&&t.setHasCasedChar()}},qae={Alternative({body:e},t,n){return e.map(n).join("")},Assertion({kind:e,negate:t}){if(e==="string_end")return"$";if(e==="string_start")return"^";if(e==="word_boundary")return t?Xe`\B`:Xe`\b`;throw new Error(`Unexpected assertion kind "${e}"`)},Backreference({ref:e},t){if(typeof e!="number")throw new Error("Unexpected named backref in transformed AST");if(!t.useFlagMods&&t.accuracy==="strict"&&t.currentFlags.ignoreCase&&!t.captureMap.get(e).ignoreCase)throw new Error("Use of case-insensitive backref to case-sensitive group requires target ES2025 or non-strict accuracy");return"\\"+e},CapturingGroup(e,t,n){const{body:i,name:s,number:r}=e,a={ignoreCase:t.currentFlags.ignoreCase},o=t.originMap.get(e);return o&&(a.hidden=!0,r>o.number&&(a.transferTo=o.number)),t.captureMap.set(r,a),`(${s?`?<${s}>`:""}${i.map(n).join("|")})`},Character({value:e},t){const n=yn(e),i=Xl(e,{escDigit:t.lastNode.type==="Backreference",inCharClass:t.inCharClass,useFlagV:t.useFlagV});if(i!==n)return i;if(t.useAppliedIgnoreCase&&t.currentFlags.ignoreCase&&ox(n)){const s=c3(n);return t.inCharClass?s.join(""):s.length>1?`[${s.join("")}]`:s[0]}return n},CharacterClass(e,t,n){const{kind:i,negate:s,parent:r}=e;let{body:a}=e;if(i==="intersection"&&!t.useFlagV)throw new Error("Use of character class intersection requires min target ES2024");jr.bugFlagVLiteralHyphenIsRange&&t.useFlagV&&a.some(iL)&&(a=[_g(45),...a.filter(u=>!iL(u))]);const o=()=>`[${s?"^":""}${a.map(n).join(i==="intersection"?"&&":"")}]`;if(!t.inCharClass){if((!t.useFlagV||jr.bugNestedClassIgnoresNegation)&&!s){const h=a.filter(f=>f.type==="CharacterClass"&&f.kind==="union"&&f.negate);if(h.length){const f=bs(),m=f.body[0];return f.parent=r,m.parent=f,a=a.filter(g=>!h.includes(g)),e.body=a,a.length?(e.parent=m,m.body.push(e)):f.body.pop(),h.forEach(g=>{const C=Wa({body:[g]});g.parent=C,C.parent=f,f.body.push(C)}),n(f)}}t.inCharClass=!0;const u=o();return t.inCharClass=!1,u}const l=a[0];if(i==="union"&&!s&&l&&((!t.useFlagV||!t.verbose)&&r.kind==="union"&&!(jr.bugFlagVLiteralHyphenIsRange&&t.useFlagV)||!t.verbose&&r.kind==="intersection"&&a.length===1&&l.type!=="CharacterClassRange"))return a.map(n).join("");if(!t.useFlagV&&r.type==="CharacterClass")throw new Error("Uses nested character class in a way that requires min target ES2024");return o()},CharacterClassRange(e,t){const n=e.min.value,i=e.max.value,s={escDigit:!1,inCharClass:!0,useFlagV:t.useFlagV},r=Xl(n,s),a=Xl(i,s),o=new Set;if(t.useAppliedIgnoreCase&&t.currentFlags.ignoreCase){const l=v3(e);Yae(l).forEach(h=>{o.add(Array.isArray(h)?`${Xl(h[0],s)}-${Xl(h[1],s)}`:Xl(h,s))})}return`${r}-${a}${[...o].join("")}`},CharacterSet({kind:e,negate:t,value:n,key:i},s){if(e==="dot")return s.currentFlags.dotAll?s.appliedGlobalFlags.dotAll||s.useFlagMods?".":"[^]":Xe`[^\n]`;if(e==="digit")return t?Xe`\D`:Xe`\d`;if(e==="property"){if(s.useAppliedIgnoreCase&&s.currentFlags.ignoreCase&&u3.has(n))throw new Error(`Unicode property "${n}" can't be case-insensitive when other chars have specific case`);return`${t?Xe`\P`:Xe`\p`}{${i?`${i}=`:""}${n}}`}if(e==="word")return t?Xe`\W`:Xe`\w`;throw new Error(`Unexpected character set kind "${e}"`)},Flags(e,t){return(t.appliedGlobalFlags.ignoreCase?"i":"")+(e.dotAll?"s":"")+(e.sticky?"y":"")},Group({atomic:e,body:t,flags:n,parent:i},s,r){const a=s.currentFlags;n&&(s.currentFlags=Nm(a,n));const o=t.map(r).join("|"),l=!s.verbose&&t.length===1&&i.type!=="Quantifier"&&!e&&(!s.useFlagMods||!n)?o:`(?${Qae(e,n,s.useFlagMods)}${o})`;return s.currentFlags=a,l},LookaroundAssertion({body:e,kind:t,negate:n},i,s){return`(?${`${t==="lookahead"?"":"<"}${n?"!":"="}`}${e.map(s).join("|")})`},Quantifier(e,t,n){return n(e.body)+Jae(e)},Subroutine({isRecursive:e,ref:t},n){if(!e)throw new Error("Unexpected non-recursive subroutine in transformed AST");const i=n.recursionLimit;return t===0?`(?R=${i})`:Xe`\g<${t}&R=${i}>`}},Vae=new Set(["$","(",")","*","+",".","?","[","\\","]","^","{","|","}"]),Wae=new Set(["-","\\","]","^","["]),Gae=new Set(["(",")","-","/","[","\\","]","^","{","|","}","!","#","$","%","&","*","+",",",".",":",";","<","=",">","?","@","`","~"]),tL=new Map([[9,Xe`\t`],[10,Xe`\n`],[11,Xe`\v`],[12,Xe`\f`],[13,Xe`\r`],[8232,Xe`\u2028`],[8233,Xe`\u2029`],[65279,Xe`\uFEFF`]]),Kae=new RegExp("^\\p{Cased}$","u");function ox(e){return Kae.test(e)}function v3(e,t){const n=!!t?.firstOnly,i=e.min.value,s=e.max.value,r=[];if(i<65&&(s===65535||s>=131071)||i===65536&&s>=131071)return r;for(let a=i;a<=s;a++){const o=yn(a);if(!ox(o))continue;const l=c3(o).filter(u=>{const h=u.codePointAt(0);return h<i||h>s});if(l.length&&(r.push(...l),n))break}return r}function Xl(e,{escDigit:t,inCharClass:n,useFlagV:i}){if(tL.has(e))return tL.get(e);if(e<32||e>126&&e<160||e>262143||t&&Xae(e))return e>255?`\\u{${e.toString(16).toUpperCase()}}`:`\\x${e.toString(16).toUpperCase().padStart(2,"0")}`;const s=n?i?Gae:Wae:Vae,r=yn(e);return(s.has(r)?"\\":"")+r}function Yae(e){const t=e.map(s=>s.codePointAt(0)).sort((s,r)=>s-r),n=[];let i=null;for(let s=0;s<t.length;s++)t[s+1]===t[s]+1?i??=t[s]:i===null?n.push(t[s]):(n.push([i,t[s]]),i=null);return n}function Qae(e,t,n){if(e)return">";let i="";if(t&&n){const{enable:s,disable:r}=t;i=(s?.ignoreCase?"i":"")+(s?.dotAll?"s":"")+(r?"-":"")+(r?.ignoreCase?"i":"")+(r?.dotAll?"s":"")}return`${i}:`}function Jae({kind:e,max:t,min:n}){let i;return!n&&t===1?i="?":!n&&t===1/0?i="*":n===1&&t===1/0?i="+":n===t?i=`{${n}}`:i=`{${n},${t===1/0?"":t}}`,i+{greedy:"",lazy:"?",possessive:"+"}[e]}function nL({type:e}){return e==="CapturingGroup"||e==="Group"||e==="LookaroundAssertion"}function Xae(e){return e>47&&e<58}function iL({type:e,value:t}){return e==="Character"&&t===45}var Zae=class nS extends RegExp{#e=new Map;#t=null;#n;#s=null;#i=null;rawOptions={};get source(){return this.#n||"(?:)"}constructor(t,n,i){const s=!!i?.lazyCompile;if(t instanceof RegExp){if(i)throw new Error("Cannot provide options when copying a regexp");const r=t;super(r,n),this.#n=r.source,r instanceof nS&&(this.#e=r.#e,this.#s=r.#s,this.#i=r.#i,this.rawOptions=r.rawOptions)}else{const r={hiddenCaptures:[],strategy:null,transfers:[],...i};super(s?"":t,n),this.#n=t,this.#e=tle(r.hiddenCaptures,r.transfers),this.#i=r.strategy,this.rawOptions=i??{}}s||(this.#t=this)}exec(t){if(!this.#t){const{lazyCompile:s,...r}=this.rawOptions;this.#t=new nS(this.#n,this.flags,r)}const n=this.global||this.sticky,i=this.lastIndex;if(this.#i==="clip_search"&&n&&i){this.lastIndex=0;const s=this.#r(t.slice(i));return s&&(ele(s,i,t,this.hasIndices),this.lastIndex+=i),s}return this.#r(t)}#r(t){this.#t.lastIndex=this.lastIndex;const n=super.exec.call(this.#t,t);if(this.lastIndex=this.#t.lastIndex,!n||!this.#e.size)return n;const i=[...n];n.length=1;let s;this.hasIndices&&(s=[...n.indices],n.indices.length=1);const r=[0];for(let a=1;a<i.length;a++){const{hidden:o,transferTo:l}=this.#e.get(a)??{};if(o?r.push(null):(r.push(n.length),n.push(i[a]),this.hasIndices&&n.indices.push(s[a])),l&&i[a]!==void 0){const u=r[l];if(!u)throw new Error(`Invalid capture transfer to "${u}"`);if(n[u]=i[a],this.hasIndices&&(n.indices[u]=s[a]),n.groups){this.#s||(this.#s=nle(this.source));const h=this.#s.get(l);h&&(n.groups[h]=i[a],this.hasIndices&&(n.indices.groups[h]=s[a]))}}}return n}};function ele(e,t,n,i){if(e.index+=t,e.input=n,i){const s=e.indices;for(let a=0;a<s.length;a++){const o=s[a];o&&(s[a]=[o[0]+t,o[1]+t])}const r=s.groups;r&&Object.keys(r).forEach(a=>{const o=r[a];o&&(r[a]=[o[0]+t,o[1]+t])})}}function tle(e,t){const n=new Map;for(const i of e)n.set(i,{hidden:!0});for(const[i,s]of t)for(const r of s)Xd(n,r,{}).transferTo=i;return n}function nle(e){const t=/(?<capture>\((?:\?<(?![=!])(?<name>[^>]+)>|(?!\?)))|\\?./gsu,n=new Map;let i=0,s=0,r;for(;r=t.exec(e);){const{0:a,groups:{capture:o,name:l}}=r;a==="["?i++:i?a==="]"&&i--:o&&(s++,l&&n.set(s,l))}return n}function ile(e,t){const n=sle(e,t);return n.options?new Zae(n.pattern,n.flags,n.options):new RegExp(n.pattern,n.flags)}function sle(e,t){const n=l3(t),i=e3(e,{flags:n.flags,normalizeUnknownPropertyNames:!0,rules:{captureGroup:n.rules.captureGroup,singleline:n.rules.singleline},skipBackrefValidation:n.rules.allowOrphanBackrefs,unicodePropertyMap:rx}),s=Lae(i,{accuracy:n.accuracy,asciiWordBoundaries:n.rules.asciiWordBoundaries,avoidSubclass:n.avoidSubclass,bestEffortTarget:n.target}),r=Hae(s,n),a=_ae(r.pattern,{captureTransfers:r._captureTransfers,hiddenCaptures:r._hiddenCaptures,mode:"external"}),o=bae(a.pattern),l=vae(o.pattern,{captureTransfers:a.captureTransfers,hiddenCaptures:a.hiddenCaptures}),u={pattern:l.pattern,flags:`${n.hasIndices?"d":""}${n.global?"g":""}${r.flags}${r.options.disable.v?"u":"v"}`};if(n.avoidSubclass){if(n.lazyCompileLength!==1/0)throw new Error("Lazy compilation requires subclass")}else{const h=l.hiddenCaptures.sort((C,S)=>C-S),f=Array.from(l.captureTransfers),m=s._strategy,g=u.pattern.length>=n.lazyCompileLength;(h.length||f.length||m||g)&&(u.options={...h.length&&{hiddenCaptures:h},...f.length&&{transfers:f},...m&&{strategy:m},...g&&{lazyCompile:g}})}return u}const sL=4294967295;class rle{constructor(t,n={}){this.patterns=t,this.options=n;const{forgiving:i=!1,cache:s,regexConstructor:r}=n;if(!r)throw new Error("Option `regexConstructor` is not provided");this.regexps=t.map(a=>{if(typeof a!="string")return a;const o=s?.get(a);if(o){if(o instanceof RegExp)return o;if(i)return null;throw o}try{const l=r(a);return s?.set(a,l),l}catch(l){if(s?.set(a,l),i)return null;throw l}})}regexps;findNextMatchSync(t,n,i){const s=typeof t=="string"?t:t.content,r=[];function a(o,l,u=0){return{index:o,captureIndices:l.indices.map(h=>h==null?{start:sL,end:sL,length:0}:{start:h[0]+u,end:h[1]+u,length:h[1]-h[0]})}}for(let o=0;o<this.regexps.length;o++){const l=this.regexps[o];if(l)try{l.lastIndex=n;const u=l.exec(s);if(!u)continue;if(u.index===n)return a(o,u,0);r.push([o,u,0])}catch(u){if(this.options.forgiving)continue;throw u}}if(r.length){const o=Math.min(...r.map(l=>l[1].index));for(const[l,u,h]of r)if(u.index===o)return a(l,u,h)}return null}}function ole(e,t){return ile(e,{global:!0,hasIndices:!0,lazyCompileLength:3e3,rules:{allowOrphanBackrefs:!0,asciiWordBoundaries:!0,captureGroup:!0,recursionLimit:5,singleline:!0},...t})}function ale(e={}){const t=Object.assign({target:"auto",cache:new Map},e);return t.regexConstructor||=n=>ole(n,{target:t.target}),{createScanner(n){return new rle(n,t)},createString(n){return{content:n}}}}const lle=[Tt(()=>import("./github-light-DAi9KRSo.js"),[]),Tt(()=>import("./github-dark-DHJKELXO.js"),[])],cle=[Tt(()=>import("./shellscript-Yzrsuije.js"),[]),Tt(()=>import("./powershell-Dpen1YoG.js"),[]),Tt(()=>import("./json-Cp-IABpG.js"),[]),Tt(()=>import("./yaml-Buea-lGh.js"),[]),Tt(()=>import("./toml-vGWfd6FD.js"),[]),Tt(()=>import("./xml-sdJ4AIDG.js"),__vite__mapDeps([0,1])),Tt(()=>import("./ini-BEwlwnbL.js"),[]),Tt(()=>import("./markdown-Cvjx9yec.js"),[]),Tt(()=>import("./html-GMplVEZG.js"),__vite__mapDeps([2,3,4])),Tt(()=>import("./css-DPfMkruS.js"),[]),Tt(()=>import("./scss-OYdSNvt2.js"),__vite__mapDeps([5,4])),Tt(()=>import("./javascript-wDzz0qaB.js"),[]),Tt(()=>import("./typescript-BPQ3VLAy.js"),[]),Tt(()=>import("./jsx-g9-lgVsj.js"),[]),Tt(()=>import("./tsx-COt5Ahok.js"),[]),Tt(()=>import("./sql-BLtJtn59.js"),[]),Tt(()=>import("./graphql-ChdNCCLP.js"),__vite__mapDeps([6,3,7,8,9])),Tt(()=>import("./c-BIGW1oBm.js"),[]),Tt(()=>import("./rust-B1yitclQ.js"),[]),Tt(()=>import("./go-CxLEBnE3.js"),[]),Tt(()=>import("./java-CylS5w8V.js"),[]),Tt(()=>import("./kotlin-BdnUsdx6.js"),[]),Tt(()=>import("./python-B6aJPvgy.js"),[]),Tt(()=>import("./php-Dhbhpdrm.js"),__vite__mapDeps([10,2,3,4,0,1,11,12])),Tt(()=>import("./swift-Dg5xB15N.js"),[]),Tt(()=>import("./csharp-COcwbKMJ.js"),[]),Tt(()=>import("./dockerfile-BcOcwvcX.js"),[]),Tt(()=>import("./make-CHLpvVh8.js"),[]),Tt(()=>import("./diff-D97Zzqfu.js"),[])],ule={light:"github-light",dark:"github-dark"},b3={sh:"shellscript",bash:"shellscript",zsh:"shellscript",shell:"shellscript",ps1:"powershell",js:"javascript",ts:"typescript",mjs:"javascript",cjs:"javascript",mts:"typescript",cts:"typescript",yml:"yaml",md:"markdown",htm:"html",pgsql:"sql",mysql:"sql",postgres:"sql",gql:"graphql",py:"python",rs:"rust",kt:"kotlin",cs:"csharp",makefile:"make"};let w_=null;function dle(){return w_||(w_=Soe({themes:lle,langs:cle,engine:ale({forgiving:!0})})),w_}function hle(e){if(!e)return"text";const n=(e.startsWith("language-")?e.slice(9):e).toLowerCase().trim();return n==="text"||n==="plaintext"||n==="txt"?"text":b3[n]??n}function ax(e,t){const[n,i]=P.useState(null),s=P.useMemo(()=>hle(t),[t]);return P.useEffect(()=>{let r=!1;async function a(){const l=await dle();if(r)return;const u=l.getLoadedLanguages();if(s==="text"||!u.includes(s)){i(null);return}const h=l.codeToHast(e,{lang:s,themes:ule,defaultColor:!1,structure:"inline"});if(r)return;const f=CN(h,{jsx:b.jsx,jsxs:b.jsxs,Fragment:b.Fragment});i(f)}const o=setTimeout(a,50);return()=>{r=!0,clearTimeout(o)}},[e,s]),n}function fle(e){const t=ax(e.code,e.language);return b.jsx("div",{className:"aui-md-codeblock min-w-0 w-full max-w-full overflow-x-auto overflow-y-hidden rounded-b-md bg-[var(--app-code-bg)]",children:b.jsx("pre",{className:"shiki m-0 w-max min-w-full p-2 text-sm font-mono",children:b.jsx("code",{className:"block",children:t??e.code})})})}function ple(e){if(typeof document>"u"||!document.body)return!1;const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly","true"),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="1px",t.style.height="1px",t.style.padding="0",t.style.border="0",t.style.opacity="0",t.style.pointerEvents="none";const n=document.activeElement instanceof HTMLElement?document.activeElement:null,i=document.getSelection(),s=i&&i.rangeCount>0?i.getRangeAt(0):null;document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,t.value.length);let r=!1;try{r=document.execCommand("copy")}catch{r=!1}finally{document.body.removeChild(t),i&&(i.removeAllRanges(),s&&i.addRange(s)),n?.focus()}return r}async function mle(e){if(typeof navigator<"u"&&navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(e);return}catch{}if(!ple(e))throw new Error("Copy to clipboard failed")}function jm(e=1500){const[t,n]=P.useState(!1),{haptic:i}=er(),s=P.useCallback(async r=>{try{return await mle(r),i.notification("success"),n(!0),setTimeout(()=>n(!1),e),!0}catch{return i.notification("error"),!1}},[i,e]);return{copied:t,copy:s}}const lx=[qie];function gle(e){const{copied:t,copy:n}=jm(),i=e.language&&e.language!=="unknown"?e.language:"";return b.jsxs("div",{className:"aui-md-codeheader flex items-center justify-between rounded-t-md bg-[var(--app-code-bg)] px-2 py-1",children:[b.jsx("div",{className:"min-w-0 flex-1 pr-2 text-xs font-mono text-[var(--app-hint)]",children:i}),b.jsx("button",{type:"button",onClick:()=>n(e.code),className:"shrink-0 rounded p-1 text-[var(--app-hint)] hover:bg-[var(--app-subtle-bg)] hover:text-[var(--app-fg)] transition-colors",title:"Copy",children:t?b.jsx(pm,{className:"h-3.5 w-3.5"}):b.jsx(fm,{className:"h-3.5 w-3.5"})})]})}function vle(e){const{className:t,...n}=e;return b.jsx("div",{className:"aui-md-pre-wrapper min-w-0 w-full max-w-full overflow-x-auto overflow-y-hidden",children:b.jsx("pre",{...n,className:Be("aui-md-pre m-0 w-max min-w-full rounded-b-md rounded-t-none bg-[var(--app-code-bg)] p-2 text-sm",t)})})}function ble(e){return KN()?b.jsx("code",{...e,className:Be("aui-md-codeblockcode font-mono",e.className)}):b.jsx("code",{...e,className:Be("aui-md-code break-words rounded bg-[var(--app-inline-code-bg)] px-[0.3em] py-[0.1em] font-mono text-[0.9em]",e.className)})}function yle(e){const t=e.target==="_blank"?e.rel??"noreferrer":e.rel;return b.jsx("a",{...e,rel:t,className:Be("aui-md-a text-[var(--app-link)] underline",e.className)})}function _le(e){return b.jsx("p",{...e,className:Be("aui-md-p leading-relaxed",e.className)})}function Sle(e){return b.jsx("blockquote",{...e,className:Be("aui-md-blockquote border-l-4 border-[var(--app-hint)] pl-3 opacity-85",e.className)})}function Cle(e){return b.jsx("ul",{...e,className:Be("aui-md-ul list-disc pl-6",e.className)})}function xle(e){return b.jsx("ol",{...e,className:Be("aui-md-ol list-decimal pl-6",e.className)})}function wle(e){return b.jsx("li",{...e,className:Be("aui-md-li",e.className)})}function kle(e){return b.jsx("hr",{...e,className:Be("aui-md-hr border-[var(--app-divider)]",e.className)})}function Tle(e){const{className:t,...n}=e;return b.jsx("div",{className:"aui-md-table-wrapper max-w-full overflow-x-auto",children:b.jsx("table",{...n,className:Be("aui-md-table w-full border-collapse",t)})})}function Ele(e){return b.jsx("thead",{...e,className:Be("aui-md-thead",e.className)})}function Rle(e){return b.jsx("tbody",{...e,className:Be("aui-md-tbody",e.className)})}function Ale(e){return b.jsx("tr",{...e,className:Be("aui-md-tr",e.className)})}function Mle(e){return b.jsx("th",{...e,className:Be("aui-md-th border border-[var(--app-border)] bg-[var(--app-subtle-bg)] px-2 py-1 text-left font-semibold",e.className)})}function Lle(e){return b.jsx("td",{...e,className:Be("aui-md-td border border-[var(--app-border)] px-2 py-1",e.className)})}function Ile(e){return b.jsx("h1",{...e,className:Be("aui-md-h1 mt-3 text-base font-semibold",e.className)})}function Ple(e){return b.jsx("h2",{...e,className:Be("aui-md-h2 mt-3 text-base font-semibold",e.className)})}function Dle(e){return b.jsx("h3",{...e,className:Be("aui-md-h3 mt-2 text-base font-semibold",e.className)})}function Ole(e){return b.jsx("h4",{...e,className:Be("aui-md-h4 mt-2 text-base font-semibold",e.className)})}function Nle(e){return b.jsx("h5",{...e,className:Be("aui-md-h5 mt-2 text-base font-semibold",e.className)})}function jle(e){return b.jsx("h6",{...e,className:Be("aui-md-h6 mt-2 text-base font-semibold",e.className)})}function Ble(e){return b.jsx("strong",{...e,className:Be("aui-md-strong font-semibold",e.className)})}function Fle(e){return b.jsx("em",{...e,className:Be("aui-md-em italic",e.className)})}function Ule(e){return b.jsx("img",{...e,className:Be("aui-md-img max-w-full rounded",e.className)})}const Bm=yte({SyntaxHighlighter:fle,CodeHeader:gle,pre:vle,code:ble,h1:Ile,h2:Ple,h3:Dle,h4:Ole,h5:Nle,h6:jle,a:yle,p:_le,strong:Ble,em:Fle,blockquote:Sle,ul:Cle,ol:xle,li:wle,hr:kle,table:Tle,thead:Ele,tbody:Rle,tr:Ale,th:Mle,td:Lle,img:Ule});function zle(){return b.jsx(qC,{remarkPlugins:lx,components:Bm,className:Be("aui-md min-w-0 max-w-full break-words text-base")})}function Hle(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:Be("transition-transform duration-200",e.open?"rotate-90":"",e.className),children:b.jsx("polyline",{points:"9 18 15 12 9 6"})})}function $le(){return b.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-current rounded-full animate-pulse"})}const qle=()=>b.jsx(qC,{remarkPlugins:lx,components:Bm,className:Be("aui-reasoning-content min-w-0 max-w-full break-words text-sm text-[var(--app-hint)]")}),Vle=({children:e})=>{const[t,n]=P.useState(!1),i=LK(),s=i.status?.type==="running"&&i.content.length>0&&i.content[i.content.length-1]?.type==="reasoning";return P.useEffect(()=>{s&&n(!0)},[s]),b.jsxs("div",{className:"aui-reasoning-group my-2",children:[b.jsxs("button",{type:"button",onClick:()=>n(!t),className:Be("flex items-center gap-1.5 text-xs font-medium","text-[var(--app-hint)] hover:text-[var(--app-fg)]","transition-colors cursor-pointer select-none"),children:[b.jsx(Hle,{open:t}),b.jsx("span",{children:"Reasoning"}),s&&b.jsx("span",{className:"flex items-center gap-1 ml-1 text-[var(--app-hint)]",children:b.jsx($le,{})})]}),b.jsx("div",{className:Be("overflow-hidden transition-all duration-200 ease-in-out",t?"max-h-[5000px] opacity-100":"max-h-0 opacity-0"),children:b.jsx("div",{className:"pl-4 pt-2 border-l-2 border-[var(--app-border)] ml-0.5",children:e})})]})};function Wle(e){const t=e<1e12?e*1e3:e,n=new Date(t);return Number.isNaN(n.getTime())?String(e):n.toLocaleString()}function Gle(e){const t=e/1e3;if(t<60)return`${t.toFixed(1)}s`;const n=Math.floor(t/60),i=Math.round(t%60);return`${n}m ${i}s`}function cx(e){if(e.type==="api-error"){const{retryAttempt:t,maxRetries:n}=e;return n>0&&t>=n?{icon:"",text:"API error: Max retries reached"}:n>0?{icon:"",text:`API error: Retrying (${t}/${n})`}:t>0?{icon:"",text:"API error: Retrying..."}:{icon:"",text:"API error"}}if(e.type==="switch")return{icon:"",text:`Switched to ${e.mode==="local"?"local":"remote"}`};if(e.type==="title-changed"){const t=typeof e.title=="string"?e.title:"";return{icon:null,text:t?`Title changed to "${t}"`:"Title changed"}}if(e.type==="permission-mode-changed"){const t=e.mode;return{icon:"",text:`Permission mode: ${typeof t=="string"?t:"default"}`}}if(e.type==="limit-reached"){const t=typeof e.endsAt=="number"?e.endsAt:null;return{icon:"",text:t?`Usage limit reached until ${Wle(t)}`:"Usage limit reached"}}if(e.type==="message")return{icon:null,text:typeof e.message=="string"?e.message:"Message"};if(e.type==="turn-duration"){const t=typeof e.durationMs=="number"?e.durationMs:0;return{icon:"",text:`Turn: ${Gle(t)}`}}if(e.type==="microcompact"){const t=typeof e.tokensSaved=="number"?e.tokensSaved:0;return{icon:"",text:`Context compacted (saved ${t>=1e3?`${Math.round(t/1e3)}K`:String(t)} tokens)`}}if(e.type==="compact")return{icon:"",text:"Conversation compacted"};try{return{icon:null,text:JSON.stringify(e)}}catch{return{icon:null,text:String(e.type)}}}function Kle(e){return cx(e).text}function Ii(e){const{t}=ot(),n=e.showCopyButton??!0,{copied:i,copy:s}=jm(),r=ax(e.code,e.language);return b.jsxs("div",{className:"relative min-w-0 max-w-full",children:[n?b.jsx("button",{type:"button",onClick:()=>s(e.code),className:"absolute right-1.5 top-1.5 rounded p-1 text-[var(--app-hint)] hover:bg-[var(--app-subtle-bg)] hover:text-[var(--app-fg)] transition-colors",title:t("code.copy"),children:i?b.jsx(pm,{className:"h-3.5 w-3.5"}):b.jsx(fm,{className:"h-3.5 w-3.5"})}):null,b.jsx("div",{className:"min-w-0 w-full max-w-full overflow-x-auto overflow-y-hidden rounded-md bg-[var(--app-code-bg)]",children:b.jsx("pre",{className:"shiki m-0 w-max min-w-full p-2 pr-8 text-xs font-mono",children:b.jsx("code",{className:"block",children:r??e.code})})})]})}function Yle(e){const t=e.components?{...Bm,...e.components}:Bm;return b.jsx(xO,{text:e.content,children:b.jsx(qC,{remarkPlugins:lx,components:t,className:Be("aui-md min-w-0 max-w-full break-words text-base")})})}function No(e){return b.jsx(Yle,{...e})}const y3=["ultrathink","fuck","step by step","ELI5","lgtm","impl it","pls fix","stop changing","","","","","","","","","",""];function Qle(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Jle(e){const t=e.map(Qle).join("|");return new RegExp(`(${t})`,"gi")}function Xle(e,t){const n=e.toLowerCase();return t.some(i=>n.includes(i.toLowerCase()))}const rL=Jle(y3);function Zle({word:e,baseKey:t}){const n=e.length,i=2;return b.jsx("span",{children:e.split("").map((s,r)=>{const a=r/n*2,o=r/n*i;return b.jsx("span",{className:"rainbow-letter",style:{animationDelay:`${-a}s, ${-o}s`},children:s===" "?"":s},`${t}-${r}`)})})}function ece(e){rL.lastIndex=0;const t=[];let n=0,i;for(;(i=rL.exec(e))!==null;)i.index>n&&t.push(e.slice(n,i.index)),t.push(b.jsx(Zle,{word:i[1],baseKey:i.index},i.index)),n=i.index+i[0].length;return n<e.length&&t.push(e.slice(n)),b.jsx(b.Fragment,{children:t})}function tce(e){return Un.Children.map(e,t=>typeof t=="string"?ece(t):t)}function _3(e){const t=e.text,n=P.useRef(null),[i,s]=P.useState(!1);P.useEffect(()=>{const o=n.current;if(!o)return;const l=new IntersectionObserver(([u])=>{u.isIntersecting&&s(!0)},{rootMargin:"100px"});return l.observe(o),()=>l.disconnect()},[]);const r=Xle(t,y3),a=P.useMemo(()=>({p:({children:o})=>b.jsx("p",{children:tce(o)})}),[]);return b.jsx("div",{ref:n,children:b.jsx(No,{content:t,components:r&&i?a:void 0})})}function nce(){return b.jsxs("svg",{className:"h-[14px] w-[14px]",viewBox:"0 0 16 16",fill:"none",children:[b.jsx("circle",{cx:"8",cy:"8",r:"6",stroke:"currentColor",strokeWidth:"1.5"}),b.jsx("path",{d:"M8 5v4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),b.jsx("circle",{cx:"8",cy:"11",r:"0.75",fill:"currentColor"})]})}function S3(e){return e.status!=="failed"?null:b.jsxs("span",{className:"inline-flex items-center gap-1",children:[b.jsx("span",{className:"text-red-500",children:b.jsx(nce,{})}),e.onRetry?b.jsx("button",{type:"button",onClick:e.onRetry,className:"text-xs text-blue-500 hover:underline",children:"Retry"}):null]})}const ux=P.forwardRef(({className:e,...t},n)=>b.jsx("div",{ref:n,className:Be("rounded-lg bg-[var(--app-secondary-bg)] shadow-sm",e),...t}));ux.displayName="Card";const dx=P.forwardRef(({className:e,...t},n)=>b.jsx("div",{ref:n,className:Be("flex flex-col space-y-1.5 p-4",e),...t}));dx.displayName="CardHeader";const hx=P.forwardRef(({className:e,...t},n)=>b.jsx("h3",{ref:n,className:Be("text-base font-semibold leading-none tracking-tight",e),...t}));hx.displayName="CardTitle";const C3=P.forwardRef(({className:e,...t},n)=>b.jsx("p",{ref:n,className:Be("text-sm text-[var(--app-hint)]",e),...t}));C3.displayName="CardDescription";const x3=P.forwardRef(({className:e,...t},n)=>b.jsx("div",{ref:n,className:Be("p-4 pt-0",e),...t}));x3.displayName="CardContent";class ice{diff(t,n,i={}){let s;typeof i=="function"?(s=i,i={}):"callback"in i&&(s=i.callback);const r=this.castInput(t,i),a=this.castInput(n,i),o=this.removeEmpty(this.tokenize(r,i)),l=this.removeEmpty(this.tokenize(a,i));return this.diffWithOptionsObj(o,l,i,s)}diffWithOptionsObj(t,n,i,s){var r;const a=w=>{if(w=this.postProcess(w,i),s){setTimeout(function(){s(w)},0);return}else return w},o=n.length,l=t.length;let u=1,h=o+l;i.maxEditLength!=null&&(h=Math.min(h,i.maxEditLength));const f=(r=i.timeout)!==null&&r!==void 0?r:1/0,m=Date.now()+f,g=[{oldPos:-1,lastComponent:void 0}];let C=this.extractCommon(g[0],n,t,0,i);if(g[0].oldPos+1>=l&&C+1>=o)return a(this.buildValues(g[0].lastComponent,n,t));let S=-1/0,v=1/0;const _=()=>{for(let w=Math.max(S,-u);w<=Math.min(v,u);w+=2){let x;const k=g[w-1],A=g[w+1];k&&(g[w-1]=void 0);let T=!1;if(A){const E=A.oldPos-w;T=A&&0<=E&&E<o}const M=k&&k.oldPos+1<l;if(!T&&!M){g[w]=void 0;continue}if(!M||T&&k.oldPos<A.oldPos?x=this.addToPath(A,!0,!1,0,i):x=this.addToPath(k,!1,!0,1,i),C=this.extractCommon(x,n,t,w,i),x.oldPos+1>=l&&C+1>=o)return a(this.buildValues(x.lastComponent,n,t))||!0;g[w]=x,x.oldPos+1>=l&&(v=Math.min(v,w-1)),C+1>=o&&(S=Math.max(S,w+1))}u++};if(s)(function w(){setTimeout(function(){if(u>h||Date.now()>m)return s(void 0);_()||w()},0)})();else for(;u<=h&&Date.now()<=m;){const w=_();if(w)return w}}addToPath(t,n,i,s,r){const a=t.lastComponent;return a&&!r.oneChangePerToken&&a.added===n&&a.removed===i?{oldPos:t.oldPos+s,lastComponent:{count:a.count+1,added:n,removed:i,previousComponent:a.previousComponent}}:{oldPos:t.oldPos+s,lastComponent:{count:1,added:n,removed:i,previousComponent:a}}}extractCommon(t,n,i,s,r){const a=n.length,o=i.length;let l=t.oldPos,u=l-s,h=0;for(;u+1<a&&l+1<o&&this.equals(i[l+1],n[u+1],r);)u++,l++,h++,r.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return h&&!r.oneChangePerToken&&(t.lastComponent={count:h,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=l,u}equals(t,n,i){return i.comparator?i.comparator(t,n):t===n||!!i.ignoreCase&&t.toLowerCase()===n.toLowerCase()}removeEmpty(t){const n=[];for(let i=0;i<t.length;i++)t[i]&&n.push(t[i]);return n}castInput(t,n){return t}tokenize(t,n){return Array.from(t)}join(t){return t.join("")}postProcess(t,n){return t}get useLongestToken(){return!1}buildValues(t,n,i){const s=[];let r;for(;t;)s.push(t),r=t.previousComponent,delete t.previousComponent,t=r;s.reverse();const a=s.length;let o=0,l=0,u=0;for(;o<a;o++){const h=s[o];if(h.removed)h.value=this.join(i.slice(u,u+h.count)),u+=h.count;else{if(!h.added&&this.useLongestToken){let f=n.slice(l,l+h.count);f=f.map(function(m,g){const C=i[u+g];return C.length>m.length?C:m}),h.value=this.join(f)}else h.value=this.join(n.slice(l,l+h.count));l+=h.count,h.added||(u+=h.count)}}return s}}class sce extends ice{constructor(){super(...arguments),this.tokenize=ace}equals(t,n,i){return i.ignoreWhitespace?((!i.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!i.newlineIsToken||!n.includes(`
`))&&(n=n.trim())):i.ignoreNewlineAtEof&&!i.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),n.endsWith(`
`)&&(n=n.slice(0,-1))),super.equals(t,n,i)}}const rce=new sce;function oce(e,t,n){return rce.diff(e,t,n)}function ace(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,`
`));const n=[],i=e.split(/(\n|\r\n)/);i[i.length-1]||i.pop();for(let s=0;s<i.length;s++){const r=i[s];s%2&&!t.newlineIsToken?n[n.length-1]+=r:n.push(r)}return n}function w3(){const[e,t]=P.useState(!1),n=P.useCallback(r=>{t(!0)},[]),i=P.useCallback(r=>{t(!1)},[]),s=P.useCallback(r=>{t(!1)},[]);return{suppressFocusRing:e,onTriggerPointerDown:n,onTriggerKeyDown:i,onTriggerBlur:s}}function nl(e){const{t}=ot(),n=e.variant??"preview",{suppressFocusRing:i,onTriggerPointerDown:s,onTriggerKeyDown:r,onTriggerBlur:a}=w3(),o=P.useMemo(()=>{const f=e.oldString.length,m=e.newString.length,g=`${f.toLocaleString()} chars`,C=`${m.toLocaleString()} chars`;return{oldChars:f,newChars:m,label:`old: ${g}  new: ${C}`}},[e.oldString.length,e.newString.length]),l=e.filePath?e.filePath:t("diff.title"),u=e.filePath?o.label:`${t("diff.title")}  ${o.label}`,h=b.jsx(lce,{oldString:e.oldString,newString:e.newString,filePath:e.filePath});return n==="inline"?h:b.jsxs(Ja,{children:[b.jsx(rg,{asChild:!0,children:b.jsx("button",{type:"button",className:Be("w-full text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)]",i&&"focus-visible:ring-0"),onPointerDown:s,onKeyDown:r,onBlur:a,children:b.jsxs("div",{className:"overflow-hidden rounded-md border border-[var(--app-border)] bg-[var(--app-subtle-bg)] hover:bg-[var(--app-secondary-bg)] transition-colors",children:[e.filePath?b.jsx("div",{className:"border-b border-[var(--app-border)] bg-[var(--app-subtle-bg)] px-2 py-1 text-xs text-[var(--app-hint)] truncate",children:e.filePath}):null,b.jsx("div",{className:"px-2 py-2",children:b.jsxs("div",{className:"flex items-center justify-between gap-3",children:[b.jsx("div",{className:"min-w-0 font-mono text-xs text-[var(--app-hint)] truncate",children:e.filePath?o.label:u}),b.jsx("div",{className:"shrink-0 text-xs text-[var(--app-link)]",children:t("diff.view")})]})})]})})}),b.jsxs(Ho,{className:"max-w-4xl",children:[b.jsxs(Xa,{children:[b.jsx($o,{className:"break-all",children:l}),b.jsx(ih,{className:"font-mono break-all",children:o.label})]}),b.jsx("div",{className:"mt-3 max-h-[75vh] overflow-auto",children:h})]})]})}function lce(e){const t=P.useMemo(()=>oce(e.oldString,e.newString),[e.oldString,e.newString]);return b.jsxs("div",{className:"overflow-hidden rounded-md border border-[var(--app-border)] bg-[var(--app-subtle-bg)]",children:[e.filePath?b.jsx("div",{className:"border-b border-[var(--app-border)] bg-[var(--app-subtle-bg)] px-2 py-1 text-xs text-[var(--app-hint)] truncate",children:e.filePath}):null,b.jsx("div",{className:"font-mono text-xs",children:t.map((n,i)=>{const s=n.value.split(`
`);s.length>0&&s[s.length-1]===""&&s.pop();const r=n.added?"+":n.removed?"-":" ",a=Be(n.added&&"bg-[var(--app-diff-added-bg)] text-[var(--app-diff-added-text)]",n.removed&&"bg-[var(--app-diff-removed-bg)] text-[var(--app-diff-removed-text)]");return b.jsx("div",{className:a,children:s.map((o,l)=>b.jsxs("div",{className:"whitespace-pre-wrap px-2",children:[r," ",o]},l))},i)})})]})}function Rc(e,t){if(!Se(e))return null;const n=e[t];return typeof n=="string"?n:null}function dt(e,t){for(const n of t){const i=Rc(e,n);if(i)return i}return null}function hs(e,t){return e.length<=t?e:e.slice(0,t-3)+"..."}function cce(e,t,n){if(!n||n.length===0)return!1;if(n.includes(e))return!0;if(e==="Bash"){const i=dt(t,["command","cmd"]);if(i)return n.includes(`Bash(${i})`)}return!1}function uce(e,t){return _m(e?.flavor)||t.startsWith("Codex")||t.startsWith("Gemini")||t.startsWith("OpenCode")}function dce(e,t,n,i,s){return e.status==="pending"?s("tool.waitingForApproval"):e.status==="canceled"?e.reason?`${s("tool.canceled")}: ${e.reason}`:s("tool.canceled"):i?e.status==="approved"&&e.decision==="approved_for_session"?s("tool.approvedForSession"):e.status==="approved"?s("tool.approved"):e.status==="denied"&&e.decision==="abort"?e.reason?`${s("tool.aborted")}: ${e.reason}`:s("tool.aborted"):e.status==="denied"?e.reason?`${s("tool.deny")}: ${e.reason}`:s("tool.deny"):s("tool.allow"):e.status==="approved"?e.mode==="acceptEdits"?s("tool.approvedAllowAllEdits"):cce(t,n,e.allowedTools)?s("tool.approvedForSession"):s("tool.approved"):e.status==="denied"?e.reason?`${s("tool.deny")}: ${e.reason}`:s("tool.deny"):s("tool.allow")}function ga(e){const t="flex w-full items-center justify-between rounded-md px-2 py-2 text-sm text-left transition-colors disabled:pointer-events-none disabled:opacity-50 hover:bg-[var(--app-subtle-bg)]",n=e.tone==="allow"?"text-emerald-600":e.tone==="deny"?"text-red-600":"text-[var(--app-link)]";return b.jsxs("button",{type:"button",className:`${t} ${n}`,disabled:e.disabled,"aria-busy":e.loading===!0,onClick:e.onClick,children:[b.jsx("span",{className:"flex-1",children:e.label}),e.loading?b.jsx("span",{className:"ml-2 shrink-0",children:b.jsx(Ur,{size:"sm",label:null,className:"text-current"})}):null]})}function hce(e){const{t}=ot(),{haptic:n}=er(),i=e.tool.permission,[s,r]=P.useState(null),[a,o]=P.useState(!1),[l,u]=P.useState(!1),[h,f]=P.useState(null),m=P.useMemo(()=>uce(e.metadata,e.tool.name),[e.metadata,e.tool.name]);if(!i)return null;const g=dce(i,e.tool.name,e.tool.input,m,t),C=i.status==="pending",S=async(O,j)=>{if(!e.disabled){f(null);try{await O(),n.notification(j),e.onDone()}catch(U){n.notification("error"),f(U instanceof Error?U.message:t("tool.requestFailed"))}}},v=e.tool.name,_=v==="Edit"||v==="MultiEdit"||v==="Write"||v==="NotebookEdit",x=!m&&C&&!(v==="Edit"||v==="MultiEdit"||v==="Write"||v==="NotebookEdit"||v==="exit_plan_mode"||v==="ExitPlanMode"),k=!m&&C&&_,A=async()=>{!C||s||a||l||(r("allow"),await S(()=>e.api.approvePermission(e.sessionId,i.id),"success"),r(null))},T=async()=>{!C||s||a||l||(o(!0),await S(()=>e.api.approvePermission(e.sessionId,i.id,"acceptEdits"),"success"),o(!1))},M=async()=>{if(!x||s||a||l)return;u(!0);const O=v==="Bash"?dt(e.tool.input,["command","cmd"]):null,j=v==="Bash"&&O?`Bash(${O})`:v;await S(()=>e.api.approvePermission(e.sessionId,i.id,{allowTools:[j]}),"success"),u(!1)},E=async()=>{!C||s||a||l||(r("deny"),await S(()=>e.api.denyPermission(e.sessionId,i.id),"success"),r(null))},L=async O=>{if(!(!C||s||l)){if(O==="approved_for_session"){u(!0),await S(()=>e.api.approvePermission(e.sessionId,i.id,{decision:O}),"success"),u(!1);return}r("allow"),await S(()=>e.api.approvePermission(e.sessionId,i.id,{decision:O}),"success"),r(null)}},D=async()=>{!C||s||l||(r("abort"),await S(()=>e.api.denyPermission(e.sessionId,i.id,{decision:"abort"}),"success"),r(null))};return C?b.jsxs("div",{className:"mt-2",children:[b.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:g}),h?b.jsx("div",{className:"mt-2 text-xs text-red-600",children:h}):null,b.jsx("div",{className:"mt-2 flex flex-col gap-1",children:m?b.jsxs(b.Fragment,{children:[b.jsx(ga,{label:t("tool.yes"),tone:"allow",loading:s==="allow",disabled:e.disabled||s!==null||l,onClick:()=>L("approved")}),b.jsx(ga,{label:t("tool.yesForSession"),tone:"neutral",loading:l,disabled:e.disabled||s!==null||l,onClick:()=>L("approved_for_session")}),b.jsx(ga,{label:t("tool.abortLabel"),tone:"deny",loading:s==="abort",disabled:e.disabled||s!==null||l,onClick:D})]}):b.jsxs(b.Fragment,{children:[b.jsx(ga,{label:t("tool.allow"),tone:"allow",loading:s==="allow",disabled:e.disabled||s!==null||a||l,onClick:A}),x?b.jsx(ga,{label:t("tool.allowForSession"),tone:"neutral",loading:l,disabled:e.disabled||s!==null||a||l,onClick:M}):null,k?b.jsx(ga,{label:t("tool.allowAll"),tone:"neutral",loading:a,disabled:e.disabled||s!==null||a||l,onClick:T}):null,b.jsx(ga,{label:t("tool.deny"),tone:"deny",loading:s==="deny",disabled:e.disabled||s!==null||a||l,onClick:E})]})})]}):i.status!=="denied"&&i.status!=="canceled"||!i.reason?null:b.jsx("div",{className:"mt-2 text-xs text-red-600",children:i.reason})}const fce=cC("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors",{variants:{variant:{default:"border-[var(--app-border)] bg-[var(--app-subtle-bg)] text-[var(--app-fg)]",warning:"border-[var(--app-badge-warning-border)] bg-[var(--app-badge-warning-bg)] text-[var(--app-badge-warning-text)]",success:"border-[var(--app-badge-success-border)] bg-[var(--app-badge-success-bg)] text-[var(--app-badge-success-text)]",destructive:"border-[var(--app-badge-error-border)] bg-[var(--app-badge-error-bg)] text-[var(--app-badge-error-text)]"}},defaultVariants:{variant:"default"}});function iS({className:e,variant:t,...n}){return b.jsx("div",{className:Be(fce({variant:t}),e),...n})}function k3(e){return e==="AskUserQuestion"||e==="ask_user_question"}function T3(e){if(!Se(e))return{questions:[]};const t=e.questions;if(!Array.isArray(t))return{questions:[]};const n=[];for(const i of t){if(!Se(i))continue;const s=typeof i.question=="string"?i.question.trim():"",r=typeof i.header=="string"?i.header.trim():"",a=typeof i.multiSelect=="boolean"?i.multiSelect:!1,o=Array.isArray(i.options)?i.options:[],l=[];for(const u of o){if(!Se(u))continue;const h=typeof u.label=="string"?u.label.trim():"";if(!h)continue;const f=typeof u.description=="string"?u.description.trim():null;l.push({label:h,description:f})}!s&&l.length===0||n.push({header:r.length>0?r:null,question:s,options:l,multiSelect:a})}return{questions:n}}function pce(e){const t=e.mode==="multi"?e.checked?"":"":e.checked?"":"";return b.jsx("span",{className:"mt-0.5 w-4 shrink-0 text-center text-[var(--app-hint)]",children:t})}function oL(e){return b.jsxs("button",{type:"button",className:Be("flex w-full items-start gap-2 rounded-md px-2 py-2 text-left text-sm transition-colors hover:bg-[var(--app-subtle-bg)] disabled:pointer-events-none disabled:opacity-50",e.checked?"bg-[var(--app-subtle-bg)]":null),disabled:e.disabled,onClick:e.onClick,children:[b.jsx(pce,{checked:e.checked,mode:e.mode}),b.jsxs("span",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"font-medium text-[var(--app-fg)] break-words",children:e.title}),e.description?b.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)] break-words",children:e.description}):null]})]})}function mce(e,t,n,i){const s=[];for(const a of t){const o=e.options[a];if(!o)continue;const l=o.label.trim();l.length>0&&s.push(l)}const r=i.trim();return n&&r.length>0&&s.push(r),s}function gce(e){const{t}=ot(),{haptic:n}=er(),i=e.tool.permission,r=P.useMemo(()=>T3(e.tool.input),[e.tool.input]).questions,[a,o]=P.useState(0),[l,u]=P.useState([]),[h,f]=P.useState([]),[m,g]=P.useState([]),[C,S]=P.useState(""),[v,_]=P.useState(!1),[w,x]=P.useState(null);if(P.useEffect(()=>{o(0),u(r.map(()=>[])),f(r.map(()=>!1)),g(r.map(()=>"")),S(""),_(!1),x(null)},[e.tool.id]),!i||i.status!=="pending"||!k3(e.tool.name))return null;const k=async(K,$)=>{if(!e.disabled){x(null);try{await K(),n.notification($),e.onDone()}catch(Y){n.notification("error"),x(Y instanceof Error?Y.message:t("dialog.error.default"))}}},A=Math.max(1,r.length),T=Math.min(Math.max(a,0),A-1),M=r[T]?.multiSelect?"multi":"single",E=K=>{if(r.length===0){const Q=C.trim();return Q.length>0?[Q]:null}const $=r[K];if(!$)return null;const Y=mce($,l[K]??[],h[K]??!1,m[K]??"");return Y.length>0?Y:null},L=async()=>{if(v)return;const K={};if(r.length===0){const $=E(0);if(!$){x(t("tool.selectOption"));return}K[0]=$}else for(let $=0;$<r.length;$+=1){const Y=E($);if(!Y){x(t("tool.selectOption")),o($);return}K[String($)]=Y}_(!0),await k(()=>e.api.approvePermission(e.sessionId,i.id,{answers:K}),"success"),_(!1)},D=()=>{if(r.length===0)return;if(!E(T)){x(t("tool.selectOption"));return}x(null),o($=>Math.min($+1,r.length-1))},O=()=>{x(null),o(K=>Math.max(K-1,0))},j=(K,$)=>{const Y=r[K];Y&&(n.selection(),u(Q=>{const F=Q.slice(),N=new Set(F[K]??[]);return Y.multiSelect?(N.has($)?N.delete($):N.add($),F[K]=Array.from(N).sort((z,G)=>z-G),F):(F[K]=[$],F)}),Y.multiSelect||f(Q=>{const F=Q.slice();return F[K]=!1,F}))},U=K=>{const $=r[K];if($){if(n.selection(),!$.multiSelect){u(Y=>{const Q=Y.slice();return Q[K]=[],Q}),f(Y=>{const Q=Y.slice();return Q[K]=!0,Q});return}f(Y=>{const Q=Y.slice();return Q[K]=!Q[K],Q})}},q=(K,$)=>{g(Y=>{const Q=Y.slice();return Q[K]=$,Q}),$.trim().length>0&&f(Y=>{const Q=Y.slice();return Q[K]=!0,Q})};return b.jsxs("div",{className:"mt-3 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] p-3",children:[b.jsx("div",{className:"flex items-start justify-between gap-3",children:b.jsx("div",{className:"min-w-0",children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(iS,{variant:"default",children:t("tool.question")}),b.jsxs("span",{className:"font-mono text-xs text-[var(--app-hint)]",children:["[",T+1,"/",A,"]"]})]})})}),w?b.jsx("div",{className:"mt-2 text-xs text-red-600",children:w}):null,r.length===0?b.jsxs("div",{className:"mt-3",children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:t("tool.askUserQuestion.fallback")}),b.jsx("textarea",{value:C,onChange:K=>S(K.target.value),disabled:e.disabled||v,placeholder:t("tool.askUserQuestion.placeholder"),className:"mt-2 w-full min-h-[88px] resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-3 py-2 text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"})]}):b.jsxs("div",{className:"mt-3",children:[b.jsx("div",{className:"flex items-start justify-between gap-3",children:b.jsxs("div",{className:"min-w-0 flex-1",children:[r[T]?.header?b.jsx("div",{className:"flex items-center gap-2",children:b.jsx(iS,{variant:"default",children:r[T].header})}):null,r[T]?.question?b.jsx("div",{className:Be("text-sm text-[var(--app-fg)] break-words",r[T]?.header?"mt-2":""),children:r[T].question}):null]})}),b.jsxs("div",{className:"mt-3 flex flex-col gap-1",children:[r[T].options.map((K,$)=>{const Y=(l[T]??[]).includes($);return b.jsx(oL,{checked:Y,mode:M,disabled:e.disabled||v,title:K.label,description:K.description,onClick:()=>j(T,$)},$)}),b.jsx(oL,{checked:h[T]??!1,mode:M,disabled:e.disabled||v,title:t("tool.other"),description:t("tool.otherDescription"),onClick:()=>U(T)}),h[T]??!1?b.jsx("textarea",{value:m[T]??"",onChange:K=>q(T,K.target.value),disabled:e.disabled||v,placeholder:t("tool.askUserQuestion.otherPlaceholder"),className:"mt-2 w-full min-h-[88px] resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-3 py-2 text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"}):null]})]}),b.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[b.jsx("div",{className:"flex items-center gap-2",children:r.length>1?b.jsx(Rn,{type:"button",variant:"outline",size:"sm",disabled:e.disabled||v||T===0,onClick:O,children:t("tool.prev")}):null}),b.jsx("div",{className:"flex items-center gap-2",children:r.length>1&&T<r.length-1?b.jsx(Rn,{type:"button",variant:"default",size:"sm",disabled:e.disabled||v,onClick:D,children:t("tool.next")}):b.jsx(Rn,{type:"button",variant:"default",size:"sm",disabled:e.disabled||v,onClick:L,"aria-busy":v,className:"gap-2",children:v?b.jsxs(b.Fragment,{children:[b.jsx(Ur,{size:"sm",label:null,className:"text-[var(--app-button-text)]"}),t("tool.submitting")]}):t("tool.submit")})})]})]})}function E3(e){return e==="request_user_input"}function R3(e){if(!Se(e))return{questions:[]};const t=e.questions;if(!Array.isArray(t))return{questions:[]};const n=[];for(const i of t){if(!Se(i))continue;const s=typeof i.id=="string"?i.id.trim():"",r=typeof i.question=="string"?i.question.trim():"";if(!s)continue;const a=Array.isArray(i.options)?i.options:[],o=[];for(const l of a){if(!Se(l))continue;const u=typeof l.label=="string"?l.label.trim():"";if(!u)continue;const h=typeof l.description=="string"?l.description.trim():null;o.push({label:u,description:h})}n.push({id:s,question:r,options:o})}return{questions:n}}function vce(e){const t={};for(const[n,i]of Object.entries(e)){const s=[];i.selected&&s.push(i.selected);const r=i.userNote.trim();r.length>0&&s.push(`user_note: ${r}`),t[n]={answers:s}}return{answers:t}}function bce(e){if(!Se(e))return null;const t=Se(e.answers)?e.answers:e,n={};for(const[i,s]of Object.entries(t)){let r=[];Se(s)&&Array.isArray(s.answers)?r=s.answers.filter(l=>typeof l=="string"):Array.isArray(s)&&(r=s.filter(l=>typeof l=="string"));let a=null,o=null;for(const l of r)l.startsWith("user_note: ")?o=l.slice(11).trim():a||(a=l.trim());n[i]={selected:a,userNote:o}}return n}function yce(e){const t=e.checked?"":"";return b.jsx("span",{className:"mt-0.5 w-4 shrink-0 text-center text-[var(--app-hint)]",children:t})}function _ce(e){return b.jsxs("button",{type:"button",className:Be("flex w-full items-start gap-2 rounded-md px-2 py-2 text-left text-sm transition-colors hover:bg-[var(--app-subtle-bg)] disabled:pointer-events-none disabled:opacity-50",e.checked?"bg-[var(--app-subtle-bg)]":null),disabled:e.disabled,onClick:e.onClick,children:[b.jsx(yce,{checked:e.checked}),b.jsxs("span",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"font-medium text-[var(--app-fg)] break-words",children:e.title}),e.description?b.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)] break-words",children:e.description}):null]})]})}function Sce(e){const{t}=ot(),{haptic:n}=er(),i=e.tool.permission,r=P.useMemo(()=>R3(e.tool.input),[e.tool.input]).questions,[a,o]=P.useState(0),[l,u]=P.useState({}),[h,f]=P.useState(!1),[m,g]=P.useState(null);if(P.useEffect(()=>{o(0);const D={};for(const O of r)D[O.id]={selected:null,userNote:""};u(D),f(!1),g(null)},[e.tool.id]),!i||i.status!=="pending"||!E3(e.tool.name))return null;const C=async(D,O)=>{if(!e.disabled){g(null);try{await D(),n.notification(O),e.onDone()}catch(j){n.notification("error"),g(j instanceof Error?j.message:t("dialog.error.default"))}}},S=Math.max(1,r.length),v=Math.min(Math.max(a,0),S-1),_=r[v],w=D=>{const O=l[D.id];return O?D.options.length>0&&O.selected!==null||O.userNote.trim().length>0:!1},x=async()=>{if(h)return;for(let O=0;O<r.length;O+=1){const j=r[O];if(!w(j)){g(t("tool.selectOption")),o(O);return}}const D=vce(l);f(!0),await C(()=>e.api.approvePermission(e.sessionId,i.id,D),"success"),f(!1)},k=()=>{if(_){if(!w(_)){g(t("tool.selectOption"));return}g(null),o(D=>Math.min(D+1,r.length-1))}},A=()=>{g(null),o(D=>Math.max(D-1,0))},T=(D,O)=>{n.selection(),u(j=>({...j,[D]:{...j[D],selected:O}}))},M=(D,O)=>{u(j=>({...j,[D]:{...j[D],userNote:O}}))},E=_?l[_.id]:null,L=_&&_.options.length===0;return b.jsxs("div",{className:"mt-3 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] p-3",children:[b.jsx("div",{className:"flex items-start justify-between gap-3",children:b.jsx("div",{className:"min-w-0",children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(iS,{variant:"default",children:t("tool.question")}),b.jsxs("span",{className:"font-mono text-xs text-[var(--app-hint)]",children:["[",v+1,"/",S,"]"]})]})})}),m?b.jsx("div",{className:"mt-2 text-xs text-red-600",children:m}):null,_?b.jsxs("div",{className:"mt-3",children:[_.question?b.jsx("div",{className:"text-sm text-[var(--app-fg)] break-words",children:_.question}):null,L?b.jsx("textarea",{value:E?.userNote??"",onChange:D=>M(_.id,D.target.value),disabled:e.disabled||h,placeholder:t("tool.requestUserInput.textPlaceholder"),className:"mt-3 w-full min-h-[88px] resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-3 py-2 text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"mt-3 flex flex-col gap-1",children:_.options.map((D,O)=>{const j=E?.selected===D.label;return b.jsx(_ce,{checked:j,disabled:e.disabled||h,title:D.label,description:D.description,onClick:()=>T(_.id,D.label)},O)})}),b.jsxs("div",{className:"mt-3",children:[b.jsx("div",{className:"text-xs text-[var(--app-hint)] mb-1",children:t("tool.requestUserInput.noteLabel")}),b.jsx("textarea",{value:E?.userNote??"",onChange:D=>M(_.id,D.target.value),disabled:e.disabled||h,placeholder:t("tool.requestUserInput.notePlaceholder"),className:"w-full min-h-[60px] resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-3 py-2 text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"})]})]})]}):null,b.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[b.jsx("div",{className:"flex items-center gap-2",children:r.length>1?b.jsx(Rn,{type:"button",variant:"outline",size:"sm",disabled:e.disabled||h||v===0,onClick:A,children:t("tool.prev")}):null}),b.jsx("div",{className:"flex items-center gap-2",children:r.length>1&&v<r.length-1?b.jsx(Rn,{type:"button",variant:"default",size:"sm",disabled:e.disabled||h,onClick:k,children:t("tool.next")}):b.jsx(Rn,{type:"button",variant:"default",size:"sm",disabled:e.disabled||h,onClick:x,"aria-busy":h,className:"gap-2",children:h?b.jsxs(b.Fragment,{children:[b.jsx(Ur,{size:"sm",label:null,className:"text-[var(--app-button-text)]"}),t("tool.submitting")]}):t("tool.submit")})})]})]})}function Ms(e,t){return b.jsx("svg",{className:t.className??"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",children:e})}function k_(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2"}),b.jsx("path",{d:"M7 9l3 3-3 3"}),b.jsx("path",{d:"M11 15h6"})]}),e)}function aL(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("circle",{cx:"11",cy:"11",r:"6"}),b.jsx("path",{d:"M20 20l-3.5-3.5"})]}),e)}function op(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("path",{d:"M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7-9.5-7-9.5-7z"}),b.jsx("circle",{cx:"12",cy:"12",r:"2.5"})]}),e)}function va(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("path",{d:"M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7z"}),b.jsx("path",{d:"M14 2v5h5"}),b.jsx("path",{d:"M9 12h2"}),b.jsx("path",{d:"M9 16h6"}),b.jsx("path",{d:"M13 12h2"})]}),e)}function lL(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("circle",{cx:"12",cy:"12",r:"9"}),b.jsx("path",{d:"M3 12h18"}),b.jsx("path",{d:"M12 3a12 12 0 0 1 0 18"}),b.jsx("path",{d:"M12 3a12 12 0 0 0 0 18"})]}),e)}function cL(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("rect",{x:"8",y:"3",width:"8",height:"4",rx:"1"}),b.jsx("path",{d:"M9 7H7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"})]}),e)}function uL(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("path",{d:"M9 18h6"}),b.jsx("path",{d:"M10 22h4"}),b.jsx("path",{d:"M8 10a4 4 0 1 1 8 0c0 1.6-.8 2.4-1.7 3.4-.6.7-1.3 1.4-1.3 2.6h-2c0-1.2-.7-1.9-1.3-2.6C8.8 12.4 8 11.6 8 10z"})]}),e)}function Cce(e){return Ms(b.jsx(b.Fragment,{children:b.jsx("path",{d:"M9 3a2 2 0 0 1 2 2v1h2V5a2 2 0 1 1 4 0v3h-3v2h1a2 2 0 1 1 0 4h-1v2h3v3H6a2 2 0 0 1-2-2v-3h3v-2H6a2 2 0 1 1 0-4h1V8H4V5a2 2 0 0 1 2-2h3z"})}),e)}function xce(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("path",{d:"M12 2c4 1 6 4 7 8-2 1-4 2-7 2s-5-1-7-2c1-4 3-7 7-8z"}),b.jsx("path",{d:"M9 14l-2 6 5-3"}),b.jsx("path",{d:"M15 14l2 6-5-3"}),b.jsx("circle",{cx:"12",cy:"8.5",r:"1.2"})]}),e)}function wce(e){return Ms(b.jsx(b.Fragment,{children:b.jsx("path",{d:"M21 7a5 5 0 0 1-7 4L7 18a2 2 0 0 1-3-3l7-7a5 5 0 0 1 6-6l-3 3 4 4 3-3z"})}),e)}function ap(e){return Ms(b.jsxs(b.Fragment,{children:[b.jsx("circle",{cx:"12",cy:"12",r:"9"}),b.jsx("path",{d:"M9.5 9a2.5 2.5 0 1 1 4.1 1.9c-.9.7-1.6 1.3-1.6 2.6"}),b.jsx("path",{d:"M12 17h.01"})]}),e)}function ds(e,t){if(!t?.path)return e;const n=t.path,i=e.toLowerCase(),s=n.toLowerCase();if(!i.startsWith(s))return e;const r=e.slice(n.length);if(r!==""&&!r.startsWith("/")&&!r.startsWith("\\"))return e;let a=r;return(a.startsWith("/")||a.startsWith("\\"))&&(a=a.slice(1)),a.length===0?"<root>":a}function fx(e){const n=e.replace(/\\/g,"/").split("/").filter(Boolean);return n.length>0?n[n.length-1]:e}const Mt="h-3.5 w-3.5";function dL(e){return e.split(`
`).length}function T_(e){return e.split("_").filter(t=>t.length>0).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}function kce(e){const t=e.replace(/^mcp__/,""),n=t.split("__");if(n.length>=2){const i=T_(n[0]),s=T_(n.slice(1).join("_"));return`MCP: ${i} ${s}`}return`MCP: ${T_(t)}`}const Tce={Task:{icon:()=>b.jsx(xce,{className:Mt}),title:e=>dt(e.input,["description"])??"Task",subtitle:e=>{const t=dt(e.input,["prompt"]);return t?hs(t,120):null},minimal:e=>e.childrenCount===0},Bash:{icon:()=>b.jsx(k_,{className:Mt}),title:e=>e.description??"Terminal",subtitle:e=>dt(e.input,["command","cmd"]),minimal:!0},Glob:{icon:()=>b.jsx(aL,{className:Mt}),title:e=>dt(e.input,["pattern"])??"Search files",minimal:!0},Grep:{icon:()=>b.jsx(op,{className:Mt}),title:e=>{const t=dt(e.input,["pattern"]);return t?`grep(pattern: ${t})`:"Search content"},minimal:!0},LS:{icon:()=>b.jsx(aL,{className:Mt}),title:e=>{const t=dt(e.input,["path"]);return t?ds(t,e.metadata):"List files"},minimal:!0},CodexBash:{icon:e=>{if(Se(e.input)&&Array.isArray(e.input.parsed_cmd)&&e.input.parsed_cmd.length>0){const t=e.input.parsed_cmd[0],n=Se(t)?t.type:null;if(n==="read")return b.jsx(op,{className:Mt});if(n==="write")return b.jsx(va,{className:Mt})}return b.jsx(k_,{className:Mt})},title:e=>{if(Se(e.input)&&Array.isArray(e.input.parsed_cmd)&&e.input.parsed_cmd.length===1){const t=e.input.parsed_cmd[0];if(Se(t)&&t.type==="read"&&typeof t.name=="string")return ds(t.name,e.metadata)}return e.description??"Terminal"},subtitle:e=>{const t=dt(e.input,["command","cmd"]);return t||(Se(e.input)&&Array.isArray(e.input.command)?e.input.command.filter(n=>typeof n=="string").join(" "):null)},minimal:!0},CodexPermission:{icon:()=>b.jsx(ap,{className:Mt}),title:e=>{const t=dt(e.input,["tool"]);return t?`Permission: ${t}`:"Permission request"},subtitle:e=>dt(e.input,["message","command"])??null,minimal:!0},shell_command:{icon:()=>b.jsx(k_,{className:Mt}),title:e=>e.description??"Terminal",subtitle:e=>dt(e.input,["command","cmd"]),minimal:!0},Read:{icon:()=>b.jsx(op,{className:Mt}),title:e=>{const t=dt(e.input,["file_path","path","file"]);return t?ds(t,e.metadata):"Read file"},minimal:!0},Edit:{icon:()=>b.jsx(va,{className:Mt}),title:e=>{const t=dt(e.input,["file_path","path"]);return t?ds(t,e.metadata):"Edit file"},minimal:!0},MultiEdit:{icon:()=>b.jsx(va,{className:Mt}),title:e=>{const t=dt(e.input,["file_path","path"]);if(!t)return"Edit file";const n=Se(e.input)&&Array.isArray(e.input.edits)?e.input.edits:null,i=n?n.length:0,s=ds(t,e.metadata);return i>1?`${s} (${i} edits)`:s},minimal:!0},Write:{icon:()=>b.jsx(va,{className:Mt}),title:e=>{const t=dt(e.input,["file_path","path"]);return t?ds(t,e.metadata):"Write file"},subtitle:e=>{const t=dt(e.input,["content","text"]);if(!t)return null;const n=dL(t);return n>1?`${n} lines`:`${t.length} chars`},minimal:!0},WebFetch:{icon:()=>b.jsx(lL,{className:Mt}),title:e=>{const t=dt(e.input,["url"]);if(!t)return"Web fetch";try{return new URL(t).hostname}catch{return t}},subtitle:e=>{const t=dt(e.input,["url"]);return t||null},minimal:!0},WebSearch:{icon:()=>b.jsx(lL,{className:Mt}),title:e=>dt(e.input,["query"])??"Web search",subtitle:e=>{const t=dt(e.input,["query"]);return t?hs(t,80):null},minimal:!0},NotebookRead:{icon:()=>b.jsx(op,{className:Mt}),title:e=>{const t=dt(e.input,["notebook_path"]);return t?ds(t,e.metadata):"Read notebook"},minimal:!0},NotebookEdit:{icon:()=>b.jsx(va,{className:Mt}),title:e=>{const t=dt(e.input,["notebook_path"]);return t?ds(t,e.metadata):"Edit notebook"},subtitle:e=>{const t=dt(e.input,["edit_mode"]);return t?`mode: ${t}`:null},minimal:!1},TodoWrite:{icon:()=>b.jsx(uL,{className:Mt}),title:()=>"Todo list",subtitle:e=>{const t=Se(e.input)&&Array.isArray(e.input.todos)?e.input.todos:null;if(t&&t.length>0)return`${t.length} items`;const n=Se(e.result)&&Array.isArray(e.result.newTodos)?e.result.newTodos:null;return n&&n.length>0?`${n.length} items`:null},minimal:e=>{const t=Se(e.input)&&Array.isArray(e.input.todos)?e.input.todos:null;if(t&&t.length>0)return!1;const n=Se(e.result)&&Array.isArray(e.result.newTodos)?e.result.newTodos:null;return!(n&&n.length>0)}},CodexReasoning:{icon:()=>b.jsx(uL,{className:Mt}),title:e=>dt(e.input,["title"])??"Reasoning",minimal:!0},CodexPatch:{icon:()=>b.jsx(va,{className:Mt}),title:()=>"Apply changes",subtitle:e=>{if(Se(e.input)&&Se(e.input.changes)){const t=Object.keys(e.input.changes);if(t.length===0)return null;const n=t[0],i=ds(n,e.metadata),s=fx(i);return t.length>1?`${s} (+${t.length-1})`:s}return null},minimal:!0},CodexDiff:{icon:()=>b.jsx(va,{className:Mt}),title:()=>"Diff",subtitle:e=>{const t=dt(e.input,["unified_diff"]);if(!t)return null;const n=t.split(`
`);for(const i of n)if(i.startsWith("+++ b/")||i.startsWith("+++ ")){const s=i.replace(/^\+\+\+ (b\/)?/,"");return s.split("/").pop()??s}return null},minimal:e=>{const t=dt(e.input,["unified_diff"]);return t?t.length>=2e3||dL(t)>=50:!0}},ExitPlanMode:{icon:()=>b.jsx(cL,{className:Mt}),title:()=>"Plan proposal",minimal:!1},exit_plan_mode:{icon:()=>b.jsx(cL,{className:Mt}),title:()=>"Plan proposal",minimal:!1},AskUserQuestion:{icon:()=>b.jsx(ap,{className:Mt}),title:e=>{const t=Se(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=Se(i)&&typeof i.header=="string"?i.header.trim():"";return n>1?`${n} Questions`:s.length>0?s:"Question"},subtitle:e=>{const t=Se(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=Se(i)&&typeof i.question=="string"?i.question.trim():"";return n>1&&s.length>0?hs(s,100)+` (+${n-1} more)`:s.length>0?hs(s,120):null},minimal:!0},ask_user_question:{icon:()=>b.jsx(ap,{className:Mt}),title:e=>{const t=Se(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=Se(i)&&typeof i.header=="string"?i.header.trim():"";return n>1?`${n} Questions`:s.length>0?s:"Question"},subtitle:e=>{const t=Se(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=Se(i)&&typeof i.question=="string"?i.question.trim():"";return n>1&&s.length>0?hs(s,100)+` (+${n-1} more)`:s.length>0?hs(s,120):null},minimal:!0},request_user_input:{icon:()=>b.jsx(ap,{className:Mt}),title:e=>{const t=Se(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=Se(i)&&typeof i.id=="string"?i.id.trim():"";return n>1?`${n} Questions`:s.length>0?s:"Question"},subtitle:e=>{const t=Se(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=Se(i)&&typeof i.question=="string"?i.question.trim():"";return n>1&&s.length>0?hs(s,100)+` (+${n-1} more)`:s.length>0?hs(s,120):null},minimal:!0}};function A3(e){if(e.toolName.startsWith("mcp__"))return{icon:b.jsx(Cce,{className:Mt}),title:kce(e.toolName),subtitle:null,minimal:!0};const t=Tce[e.toolName];if(t){const l=typeof t.minimal=="function"?t.minimal(e):t.minimal??!1;return{icon:t.icon(e),title:t.title(e),subtitle:t.subtitle?t.subtitle(e):null,minimal:l}}const n=dt(e.input,["file_path","path","filePath","file"]),i=dt(e.input,["command","cmd"]),s=dt(e.input,["pattern"]),r=dt(e.input,["url"]),a=dt(e.input,["query"]),o=n??i??s??r??a;return{icon:b.jsx(wce,{className:Mt}),title:e.toolName,subtitle:o?hs(o,80):null,minimal:!0}}function Ece(e){const t=e.split(`
`),n=[],i=[];let s,r=!1;for(const a of t){if(a.startsWith("+++ b/")||a.startsWith("+++ ")){s=a.replace(/^\+\+\+ (b\/)?/,"");continue}if(!(a.startsWith("diff --git")||a.startsWith("index ")||a.startsWith("---")||a.startsWith("new file mode")||a.startsWith("deleted file mode"))){if(a.startsWith("@@")){r=!0;continue}if(r)if(a.startsWith("+"))i.push(a.substring(1));else if(a.startsWith("-"))n.push(a.substring(1));else if(a.startsWith(" "))n.push(a.substring(1)),i.push(a.substring(1));else{if(a==="\\ No newline at end of file")continue;a===""&&(n.push(""),i.push(""))}}}return{oldText:n.join(`
`),newText:i.join(`
`),fileName:s}}function M3(e,t){const n=e.tool.input;if(!Se(n)||typeof n.unified_diff!="string")return null;const i=Ece(n.unified_diff);return b.jsx(nl,{oldString:i.oldText,newString:i.newText,filePath:t?i.fileName:void 0,variant:t?"inline":void 0})}function Rce(e){return M3(e.block,!1)}function Ace(e){return M3(e.block,!0)}function Mce(e){const t=e.block.tool.input;if(!Se(t)||!Se(t.changes))return null;const n=Object.keys(t.changes);return n.length===0?null:b.jsx("div",{className:"flex flex-col gap-1",children:n.map(i=>{const s=ds(i,e.metadata);return b.jsx("div",{className:"text-sm text-[var(--app-fg)] font-mono break-all",children:fx(s)},i)})})}function L3(e){const t=e.block.tool.input;if(!Se(t))return null;const n=typeof t.old_string=="string"?t.old_string:null,i=typeof t.new_string=="string"?t.new_string:null;return n===null||i===null?null:b.jsx(nl,{oldString:n,newString:i,variant:"inline"})}function Lce(e){if(!e)return;const t={};for(const[n,i]of Object.entries(e))Array.isArray(i)?t[n]=i:i&&typeof i=="object"&&"answers"in i&&(t[n]=i.answers);return t}function Ice(e,t,n){if(!e)return!1;const i=e[String(t)];return!i||!Array.isArray(i)?!1:i.some(s=>s.trim()===n.trim())}function Pce(e,t){return e?t?"":"":t?"":""}function Dce(e,t,n,i){const s=e[String(t)];if(!s||!Array.isArray(s))return null;const r=new Set(n.map(o=>o.label.trim())),a=s.filter(o=>!r.has(o.trim()));return a.length===0?null:b.jsx(b.Fragment,{children:a.map((o,l)=>b.jsx("div",{className:"rounded-md border border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30 px-2 py-2",children:b.jsxs("div",{className:"flex items-start gap-2",children:[b.jsx("span",{className:"shrink-0 text-sm text-emerald-600",children:i?"":""}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"text-sm text-emerald-700 dark:text-emerald-300 font-medium break-words",children:o}),b.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)]",children:"(custom answer)"})]})]})},`other-${l}`))})}function hL(e,t){const n=e[String(t)];if(!n||!Array.isArray(n))return null;const i=n.map(s=>s.trim()).filter(s=>s.length>0);return i.length===0?null:b.jsx("div",{className:"mt-3 flex flex-col gap-1",children:i.map((s,r)=>b.jsx("div",{className:"rounded-md border border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30 px-2 py-2",children:b.jsxs("div",{className:"flex items-start gap-2",children:[b.jsx("span",{className:"shrink-0 text-sm text-emerald-600",children:""}),b.jsx("div",{className:"min-w-0 flex-1",children:b.jsx("div",{className:"text-sm text-emerald-700 dark:text-emerald-300 font-medium break-words",children:s})})]})},r))})}function Fm(e){const n=T3(e.block.tool.input).questions,i=e.block.tool.permission?.answers??void 0,s=Lce(i),r=s&&Object.keys(s).length>0;return n.length===0?r&&s?hL(s,0):null:b.jsx("div",{className:"flex flex-col gap-3",children:n.map((a,o)=>{const l=a.multiSelect;return b.jsxs("div",{className:"rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-3",children:[a.question?b.jsx("div",{className:"text-sm text-[var(--app-fg)] break-words",children:a.question}):null,a.options.length>0?b.jsxs("div",{className:"mt-3 flex flex-col gap-1",children:[a.options.map((u,h)=>{const f=Ice(s,o,u.label);return b.jsx("div",{className:Be("rounded-md border px-2 py-2",f?"border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30":"border-[var(--app-border)]"),children:b.jsxs("div",{className:"flex items-start gap-2",children:[r&&b.jsx("span",{className:Be("shrink-0 text-sm",f?"text-emerald-600":"text-[var(--app-hint)]"),children:Pce(l,f)}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:Be("text-sm break-words",f?"text-emerald-700 dark:text-emerald-300 font-medium":"text-[var(--app-fg)]"),children:u.label}),u.description?b.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)] break-words",children:u.description}):null]})]})},h)}),r&&Dce(s,o,a.options,l)]}):r&&s?hL(s,o):null]},o)})})}function Oce(e){return e?"":""}function Nce(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return}return e}function I3(e){const n=R3(e.block.tool.input).questions,i=e.block.tool.permission?.answers??Nce(e.block.tool.result)??void 0,s=i?bce(i):null,r=s&&Object.keys(s).length>0;return n.length===0?null:b.jsx("div",{className:"flex flex-col gap-3",children:n.map(a=>{const o=s?.[a.id],l=a.options.length===0;return b.jsxs("div",{className:"rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-3",children:[a.question?b.jsx("div",{className:"text-sm text-[var(--app-fg)] break-words",children:a.question}):null,l?r&&o?.userNote?b.jsx("div",{className:"mt-3",children:b.jsx("div",{className:"rounded-md border border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30 px-2 py-2",children:b.jsxs("div",{className:"flex items-start gap-2",children:[b.jsx("span",{className:"shrink-0 text-sm text-emerald-600",children:""}),b.jsx("div",{className:"min-w-0 flex-1",children:b.jsx("div",{className:"text-sm text-emerald-700 dark:text-emerald-300 font-medium break-words",children:o.userNote})})]})})}):null:b.jsxs("div",{className:"mt-3 flex flex-col gap-1",children:[a.options.map((u,h)=>{const f=o?.selected===u.label;return b.jsx("div",{className:Be("rounded-md border px-2 py-2",f?"border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30":"border-[var(--app-border)]"),children:b.jsxs("div",{className:"flex items-start gap-2",children:[r&&b.jsx("span",{className:Be("shrink-0 text-sm",f?"text-emerald-600":"text-[var(--app-hint)]"),children:Oce(f)}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:Be("text-sm break-words",f?"text-emerald-700 dark:text-emerald-300 font-medium":"text-[var(--app-fg)]"),children:u.label}),u.description?b.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)] break-words",children:u.description}):null]})]})},h)}),r&&o?.userNote?b.jsx("div",{className:"mt-2 rounded-md border border-blue-300 bg-blue-50 dark:bg-blue-950/30 px-2 py-2",children:b.jsxs("div",{className:"flex items-start gap-2",children:[b.jsx("span",{className:"shrink-0 text-xs text-blue-500",children:""}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:"Note:"}),b.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300 break-words",children:o.userNote})]})]})}):null]})]},a.id)})})}function Um(e){const t=e.block.tool.input;if(!Se(t))return null;const n=typeof t.plan=="string"?t.plan:null;return n?b.jsx(No,{content:n}):null}const E_=3;function P3(e){return!Se(e)||!Array.isArray(e.edits)?[]:e.edits.filter(Se).map(t=>({old_string:typeof t.old_string=="string"?t.old_string:"",new_string:typeof t.new_string=="string"?t.new_string:""})).filter(t=>t.old_string.length>0||t.new_string.length>0)}function jce(e){const t=P3(e.block.tool.input);return t.length===0?null:b.jsxs("div",{className:"flex flex-col gap-2",children:[t.slice(0,E_).map((n,i)=>b.jsx(nl,{oldString:n.old_string,newString:n.new_string},i)),t.length>E_?b.jsxs("div",{className:"text-xs text-[var(--app-hint)]",children:["(+",t.length-E_," more edits)"]}):null]})}function Bce(e){const t=P3(e.block.tool.input);return t.length===0?null:b.jsx("div",{className:"flex flex-col gap-2",children:t.map((n,i)=>b.jsx(nl,{oldString:n.old_string,newString:n.new_string,variant:"inline"},i))})}function Fce(e,t){const n=Se(e)&&Array.isArray(e.todos)?e.todos.filter(Se):[];return n.length>0?n.map(s=>({id:typeof s.id=="string"?s.id:void 0,content:typeof s.content=="string"?s.content:void 0,status:s.status==="pending"||s.status==="in_progress"||s.status==="completed"?s.status:void 0,priority:s.priority==="high"||s.priority==="medium"||s.priority==="low"?s.priority:void 0})):(Se(t)&&Array.isArray(t.newTodos)?t.newTodos.filter(Se):[]).map(s=>({id:typeof s.id=="string"?s.id:void 0,content:typeof s.content=="string"?s.content:void 0,status:s.status==="pending"||s.status==="in_progress"||s.status==="completed"?s.status:void 0,priority:s.priority==="high"||s.priority==="medium"||s.priority==="low"?s.priority:void 0}))}function Uce(e){return e.status==="completed"?"text-emerald-600 line-through":e.status==="in_progress"?"text-[var(--app-link)]":"text-[var(--app-hint)]"}function zce(e){return e.status==="completed"?"":""}function Hce(e){const t=Fce(e.block.tool.input,e.block.tool.result);return t.length===0?null:b.jsx("div",{className:"flex flex-col gap-1",children:t.map((n,i)=>{const s=n.content?.trim()?n.content.trim():"(empty)";return b.jsxs("div",{className:`text-sm ${Uce(n)}`,children:[zce(n)," ",s]},n.id??String(i))})})}function D3(e){const t=e.block.tool.input;if(!Se(t))return null;const n=typeof t.content=="string"?t.content:typeof t.text=="string"?t.text:null;return n===null?null:b.jsx(nl,{oldString:"",newString:n,variant:"inline"})}const $ce={Edit:L3,MultiEdit:jce,Write:D3,TodoWrite:Hce,CodexDiff:Rce,AskUserQuestion:Fm,ExitPlanMode:Um,ask_user_question:Fm,exit_plan_mode:Um,request_user_input:I3},qce={Edit:L3,MultiEdit:Bce,Write:D3,CodexDiff:Ace,CodexPatch:Mce,AskUserQuestion:Fm,ExitPlanMode:Um,ask_user_question:Fm,exit_plan_mode:Um,request_user_input:I3};function Vce(e){return $ce[e]??null}function Wce(e){return qce[e]??null}function O3(e){const t=/<tool_use_error>(.*?)<\/tool_use_error>/s,n=e.match(t);return n?{isToolUseError:!0,errorMessage:typeof n[1]=="string"?n[1].trim():""}:{isToolUseError:!1,errorMessage:null}}function fL(e){return typeof e=="string"?e:Se(e)&&(e.type==="text"&&typeof e.text=="string"||typeof e.text=="string")?e.text:null}function ks(e,t=0){if(t>2||e==null)return null;if(typeof e=="string"){const o=O3(e);return o.isToolUseError?o.errorMessage??"":e}if(Array.isArray(e)){const o=e.map(fL).filter(l=>typeof l=="string"&&l.length>0);return o.length>0?o.join(`
`):null}if(!Se(e))return null;if(typeof e.content=="string")return e.content;if(typeof e.text=="string")return e.text;if(typeof e.output=="string")return e.output;if(typeof e.error=="string")return e.error;if(typeof e.message=="string")return e.message;const n=Array.isArray(e.content)?e.content:null;if(n){const o=n.map(fL).filter(l=>typeof l=="string"&&l.length>0);return o.length>0?o.join(`
`):null}const i=Se(e.output)?e.output:null;if(i){if(typeof i.content=="string")return i.content;if(typeof i.text=="string")return i.text}const s=Se(e.error)?e.error:null;if(s){if(typeof s.message=="string")return s.message;if(typeof s.error=="string")return s.error}const r=Se(e.result)?e.result:null;if(r){const o=ks(r,t+1);if(o)return o}const a=Se(e.data)?e.data:null;if(a){const o=ks(a,t+1);if(o)return o}return null}function Gce(e){const t=e.match(/^Exit code:\s*(\d+)/m),n=e.match(/^Wall time:\s*(.+)$/m),i=e.match(/^Output:\n([\s\S]*)$/m);return!t&&!n&&!i?null:{exitCode:t?parseInt(t[1],10):null,wallTime:n?n[1].trim():null,output:i?i[1]:e}}function Kce(e){const t=e.trimStart();return t.startsWith("<!DOCTYPE")||t.startsWith("<html")||t.startsWith("<div")||t.startsWith("<span")}function pL(e){const t=e.trim();return t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]")}function Vs(e,t={mode:"auto"}){return t.mode==="code"?b.jsx(Ii,{code:e,language:t.language??"text"}):t.mode==="markdown"?b.jsx(No,{content:e}):Kce(e)||pL(e)?b.jsx(Ii,{code:e,language:pL(e)?"json":"html"}):b.jsx(No,{content:e})}function ir(e){return e==="pending"?"Waiting for permission":e==="running"?"Running":"(no output)"}function Jt(e){return null}function Yce(e){if(!Se(e))return null;const t=typeof e.stdout=="string"?e.stdout:null,n=typeof e.stderr=="string"?e.stderr:null;if(t!==null||n!==null)return{stdout:t,stderr:n};const i=Se(e.output)?e.output:null;if(i){const s=typeof i.stdout=="string"?i.stdout:null,r=typeof i.stderr=="string"?i.stderr:null;if(s!==null||r!==null)return{stdout:s,stderr:r}}return null}function Qce(e){if(!Se(e))return null;const t=Se(e.file)?e.file:null;if(!t)return null;const n=typeof t.content=="string"?t.content:null;return n===null?null:{filePath:typeof t.filePath=="string"?t.filePath:typeof t.file_path=="string"?t.file_path:null,content:n}}function Jce(e){return e.split(`
`).map(t=>t.trim()).filter(t=>t.length>0)}function Xce(e){const t=e.trimStart();return t.startsWith("- ")||t.startsWith("* ")||t.startsWith("1. ")}const mL=e=>{const t=e.block.tool.permission?.answers??null;return t&&Object.keys(t).length>0?null:b.jsx(ic,{...e})},Zce=e=>{const t=e.block.tool.result;if(t==null)return b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)});if(typeof t=="string"){const s=O3(t),r=s.isToolUseError?s.errorMessage??"":t;return b.jsxs(b.Fragment,{children:[b.jsx(Ii,{code:r,language:"text"}),b.jsx(Jt,{value:t})]})}const n=Yce(t);if(n)return b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"flex flex-col gap-2",children:[n.stdout?b.jsx(Ii,{code:n.stdout,language:"text"}):null,n.stderr?b.jsx(Ii,{code:n.stderr,language:"text"}):null]}),b.jsx(Jt,{value:t})]});const i=ks(t);return i?b.jsxs(b.Fragment,{children:[Vs(i,{mode:"code",language:"text"}),b.jsx(Jt,{value:t})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),b.jsx(Jt,{value:t})]})},ic=e=>{const t=e.block.tool.result;if(t==null)return b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)});const n=ks(t);return n?b.jsxs(b.Fragment,{children:[Vs(n,{mode:"auto"}),b.jsx(Jt,{value:t})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),b.jsx(Jt,{value:t})]})},R_=e=>{const t=e.block.tool.result;if(t==null)return b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)});const n=ks(t);if(!n)return b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),b.jsx(Jt,{value:t})]});if(Xce(n))return b.jsxs(b.Fragment,{children:[b.jsx(No,{content:n}),b.jsx(Jt,{value:t})]});const i=Jce(n);return i.length===0?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),b.jsx(Jt,{value:t})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"flex flex-col gap-1",children:i.map(s=>b.jsx("div",{className:"text-sm font-mono text-[var(--app-fg)] break-all",children:s},s))}),b.jsx(Jt,{value:t})]})},gL=e=>{const t=e.block.tool.result;if(t==null)return b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)});const n=Qce(t);if(n){const s=n.filePath?ds(n.filePath,e.metadata):null;return b.jsxs(b.Fragment,{children:[s?b.jsx("div",{className:"mb-2 text-xs text-[var(--app-hint)] font-mono break-all",children:fx(s)}):null,b.jsx(Ii,{code:n.content,language:"text"}),b.jsx(Jt,{value:t})]})}const i=ks(t);return i?b.jsxs(b.Fragment,{children:[Vs(i,{mode:"code",language:"text"}),b.jsx(Jt,{value:t})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),b.jsx(Jt,{value:t})]})},lp=e=>{const{state:t,result:n}=e.block.tool;if(n==null)return t==="completed"?b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"Done"}):b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(t)});const i=ks(n);if(typeof i=="string"&&i.trim().length>0){const s=t==="error"?"text-red-600":"text-[var(--app-fg)]";return b.jsxs(b.Fragment,{children:[b.jsx("div",{className:`text-sm ${s}`,children:Vs(i,{mode:t==="error"?"code":"auto"})}),b.jsx(Jt,{value:n})]})}return b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:t==="completed"?"Done":"(no output)"}),b.jsx(Jt,{value:n})]})},eue=e=>{const t=e.block.tool.result,n=ks(t);return n?b.jsxs(b.Fragment,{children:[Vs(n,{mode:"auto"}),b.jsx(Jt,{value:t})]}):t==null?e.block.tool.state==="completed"?b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"Done"}):b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),b.jsx(Jt,{value:t})]})},tue=e=>{const t=e.block.tool.result;if(t==null)return b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)});const n=ks(t);return n?b.jsxs(b.Fragment,{children:[Vs(n,{mode:"auto"}),b.jsx(Jt,{value:t})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),b.jsx(Jt,{value:t})]})},nue=e=>{const t=e.block.tool.result;if(t==null)return e.block.tool.state==="completed"?b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"Done"}):b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)});const n=ks(t);return n?b.jsxs(b.Fragment,{children:[Vs(n,{mode:"code",language:"diff"}),b.jsx(Jt,{value:t})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"Done"}),b.jsx(Jt,{value:t})]})};function iue(e,t){const n=Se(e)&&Array.isArray(e.todos)?e.todos.filter(Se):[];return n.length>0?n.map(s=>({id:typeof s.id=="string"?s.id:void 0,content:typeof s.content=="string"?s.content:void 0,status:s.status==="pending"||s.status==="in_progress"||s.status==="completed"?s.status:void 0,priority:s.priority==="high"||s.priority==="medium"||s.priority==="low"?s.priority:void 0})):(Se(t)&&Array.isArray(t.newTodos)?t.newTodos.filter(Se):[]).map(s=>({id:typeof s.id=="string"?s.id:void 0,content:typeof s.content=="string"?s.content:void 0,status:s.status==="pending"||s.status==="in_progress"||s.status==="completed"?s.status:void 0,priority:s.priority==="high"||s.priority==="medium"||s.priority==="low"?s.priority:void 0}))}function sue(e){return e.status==="completed"?"text-emerald-600 line-through":e.status==="in_progress"?"text-[var(--app-link)]":"text-[var(--app-hint)]"}function rue(e){return e.status==="completed"?"":""}const oue=e=>{const t=iue(e.block.tool.input,e.block.tool.result);return t.length===0?b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)}):b.jsx("div",{className:"flex flex-col gap-1",children:t.map((n,i)=>{const s=n.content?.trim()?n.content.trim():"(empty)";return b.jsxs("div",{className:`text-sm ${sue(n)}`,children:[rue(n)," ",s]},n.id??String(i))})})},vL=e=>{const t=e.block.tool.result;if(t==null)return b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:ir(e.block.tool.state)});if(typeof t=="string"){const i=Gce(t);if(i)return b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"text-xs text-[var(--app-hint)] mb-2",children:[i.exitCode!==null&&`Exit code: ${i.exitCode}`,i.exitCode!==null&&i.wallTime&&"  ",i.wallTime&&`Wall time: ${i.wallTime}`]}),Vs(i.output.trim(),{mode:"code"}),b.jsx(Jt,{value:t})]})}const n=ks(t);return n?b.jsxs(b.Fragment,{children:[Vs(n,{mode:"auto"}),typeof t=="object"?b.jsx(Jt,{value:t}):null]}):typeof t=="string"?Vs(t,{mode:"auto"}):b.jsx(Ii,{code:To(t),language:"json"})},aue={Task:ic,Bash:Zce,Glob:R_,Grep:R_,LS:R_,Read:gL,Edit:lp,MultiEdit:lp,Write:lp,WebFetch:ic,WebSearch:ic,NotebookRead:gL,NotebookEdit:lp,TodoWrite:oue,CodexReasoning:tue,CodexPatch:eue,CodexDiff:nue,AskUserQuestion:mL,ExitPlanMode:ic,ask_user_question:mL,exit_plan_mode:ic};function lue(e){return e.startsWith("mcp__")?vL:aue[e]??vL}const cue=1e3;function uue(e){const[t,n]=P.useState(()=>Date.now());if(P.useEffect(()=>{if(!e.active)return;const s=setInterval(()=>n(Date.now()),cue);return()=>clearInterval(s)},[e.active]),!e.active)return null;const i=(t-e.from)/1e3;return Number.isFinite(i)?b.jsxs("span",{className:"font-mono text-xs text-[var(--app-hint)]",children:[i.toFixed(1),"s"]}):null}function due(e,t){const n=A3({toolName:e.tool.name,input:e.tool.input,result:e.tool.result,childrenCount:e.children.length,description:e.tool.description,metadata:t});return n.subtitle?hs(`${n.title}: ${n.subtitle}`,140):n.title}function hue(e){return e.state==="completed"?b.jsx("span",{className:"text-emerald-600",children:""}):e.state==="error"?b.jsx("span",{className:"text-red-600",children:""}):e.state==="pending"?b.jsx("span",{className:"text-amber-600",children:""}):b.jsx("span",{className:"text-amber-600 animate-pulse",children:""})}function fue(e){if(e.tool.name!=="Task")return null;const t=e.children.filter(i=>i.kind==="tool-call").filter(i=>i.tool.state==="pending"||i.tool.state==="running"||i.tool.state==="completed"||i.tool.state==="error");if(t.length===0)return null;const n=t.slice(-3);return{visible:n,remaining:t.length-n.length}}function pue(e,t){const n=fue(e);if(!n)return null;const i=n.visible,s=n.remaining;return b.jsx("div",{className:"flex flex-col gap-1 px-1",children:b.jsxs("div",{className:"flex flex-col gap-1",children:[i.map(r=>b.jsx("div",{className:"flex items-center gap-2",children:b.jsxs("div",{className:"min-w-0 flex-1 font-mono text-xs text-[var(--app-hint)]",children:[b.jsx("span",{className:"mr-2 inline-block w-4 text-center align-middle",children:b.jsx(hue,{state:r.tool.state})}),b.jsx("span",{className:"align-middle break-all",children:due(r,t)})]})},r.id)),s>0?b.jsxs("div",{className:"text-xs text-[var(--app-hint)] italic",children:["(+",s," more)"]}):null]})})}function mue(e){if(!Se(e))return null;const t=dt(e,["file_path","path"])??void 0,n=Rc(e,"old_string"),i=Rc(e,"new_string");return n===null||i===null?null:b.jsx(nl,{oldString:n,newString:i,filePath:t})}function gue(e){if(!Se(e))return null;const t=Rc(e,"plan");return t?b.jsx(No,{content:t}):null}function bL(e){const t=e.tool.name,n=e.tool.input;if(t==="Task"&&Se(n)&&typeof n.prompt=="string")return b.jsx(No,{content:n.prompt});if(t==="Edit"){const s=mue(n);if(s)return s}if(t==="MultiEdit"&&Se(n)){const s=dt(n,["file_path","path"])??void 0,r=Array.isArray(n.edits)?n.edits:null;if(r&&r.length>0){const a=r.slice(0,3).map((o,l)=>{if(!Se(o))return null;const u=Rc(o,"old_string"),h=Rc(o,"new_string");return u===null||h===null?null:b.jsx("div",{children:b.jsx(nl,{oldString:u,newString:h,filePath:s})},l)}).filter(Boolean);if(a.length>0)return b.jsxs("div",{className:"flex flex-col gap-2",children:[a,r.length>3?b.jsxs("div",{className:"text-xs text-[var(--app-hint)]",children:["(+",r.length-3," more edits)"]}):null]})}}if(t==="Write"&&Se(n)){const s=dt(n,["file_path","path"]),r=dt(n,["content","text"]);if(s&&r!==null)return b.jsxs("div",{className:"flex flex-col gap-2",children:[b.jsx("div",{className:"text-xs text-[var(--app-hint)] font-mono break-all",children:s}),b.jsx(Ii,{code:r,language:"text"})]})}if(t==="CodexDiff"&&Se(n)&&typeof n.unified_diff=="string")return b.jsx(Ii,{code:n.unified_diff,language:"diff"});if(t==="ExitPlanMode"||t==="exit_plan_mode"){const s=gue(n);if(s)return s}const i=Se(n)&&Array.isArray(n.command)?n.command:null;if((t==="CodexBash"||t==="Bash")&&(typeof i?.[0]=="string"||typeof n=="object")){const s=Array.isArray(i)?i.filter(r=>typeof r=="string").join(" "):dt(n,["command","cmd"]);if(s)return b.jsx(Ii,{code:s,language:"bash"})}return b.jsx(Ii,{code:To(n),language:"json"})}function vue(e){return e.state==="completed"?b.jsxs("svg",{className:"h-3 w-3",viewBox:"0 0 16 16",fill:"none",children:[b.jsx("circle",{cx:"8",cy:"8",r:"6",stroke:"currentColor",strokeWidth:"1.5"}),b.jsx("path",{d:"M5.2 8.3l1.8 1.8 3.8-4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}):e.state==="error"?b.jsxs("svg",{className:"h-3 w-3",viewBox:"0 0 16 16",fill:"none",children:[b.jsx("circle",{cx:"8",cy:"8",r:"6",stroke:"currentColor",strokeWidth:"1.5"}),b.jsx("path",{d:"M5.6 5.6l4.8 4.8M10.4 5.6l-4.8 4.8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):e.state==="pending"?b.jsxs("svg",{className:"h-3 w-3",viewBox:"0 0 16 16",fill:"none",children:[b.jsx("rect",{x:"4.5",y:"7",width:"7",height:"6",rx:"1.5",stroke:"currentColor",strokeWidth:"1.5"}),b.jsx("path",{d:"M6 7V5.8a2 2 0 0 1 4 0V7",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):b.jsxs("svg",{className:"h-3 w-3 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[b.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"2.5",opacity:"0.25"}),b.jsx("path",{d:"M21 12a9 9 0 0 0-9-9",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",opacity:"0.75"})]})}function bue(e){return e==="completed"?"text-emerald-600":e==="error"?"text-red-600":e==="pending"?"text-amber-600":"text-[var(--app-hint)]"}function yue(){return b.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 16 16",fill:"none",children:b.jsx("path",{d:"M6 3l5 5-5 5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}function _ue(e){const{t}=ot(),n=P.useMemo(()=>A3({toolName:e.block.tool.name,input:e.block.tool.input,result:e.block.tool.result,childrenCount:e.block.children.length,description:e.block.tool.description,metadata:e.metadata}),[e.block.tool.name,e.block.tool.input,e.block.tool.result,e.block.children.length,e.block.tool.description,e.metadata]),i=e.block.tool.name,s=n.title,r=n.subtitle??e.block.tool.description,a=pue(e.block,e.metadata),o=e.block.tool.startedAt??e.block.tool.createdAt,l=!n.minimal&&i!=="Task",u=l?Vce(i):null,h=Wce(i),f=lue(i),m=e.block.tool.permission,g=k3(i),C=E3(i),S=g||C,v=!!(m&&(m.status==="pending"||(m.status==="denied"||m.status==="canceled")&&m.reason)),_=l||a!==null||v,w=bue(e.block.tool.state),{suppressFocusRing:x,onTriggerPointerDown:k,onTriggerKeyDown:A,onTriggerBlur:T}=w3(),M=b.jsxs("div",{className:"flex flex-col gap-1",children:[b.jsxs("div",{className:"flex items-center justify-between gap-3",children:[b.jsxs("div",{className:"min-w-0 flex items-center gap-2",children:[b.jsx("div",{className:"shrink-0 flex h-3.5 w-3.5 items-center justify-center text-[var(--app-hint)] leading-none",children:n.icon}),b.jsx(hx,{className:"min-w-0 text-sm font-medium leading-tight break-words",children:s})]}),b.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[b.jsx(uue,{from:o,active:e.block.tool.state==="running"}),b.jsx("span",{className:w,children:b.jsx(vue,{state:e.block.tool.state})}),b.jsx("span",{className:"text-[var(--app-hint)]",children:b.jsx(yue,{})})]})]}),r?b.jsx(C3,{className:"font-mono text-xs break-all opacity-80",children:hs(r,160)}):null]});return b.jsxs(ux,{className:"overflow-hidden shadow-sm",children:[b.jsx(dx,{className:"p-3 space-y-0",children:b.jsxs(Ja,{children:[b.jsx(rg,{asChild:!0,children:b.jsx("button",{type:"button",className:Be("w-full text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)]",x&&"focus-visible:ring-0"),onPointerDown:k,onKeyDown:A,onBlur:T,children:M})}),b.jsxs(Ho,{className:"max-w-2xl",children:[b.jsx(Xa,{children:b.jsx($o,{children:s})}),(()=>{const E=S&&m?.answers&&Object.keys(m.answers).length>0;return b.jsxs("div",{className:"mt-3 flex max-h-[75vh] flex-col gap-4 overflow-auto",children:[b.jsxs("div",{children:[b.jsx("div",{className:"mb-1 text-xs font-medium text-[var(--app-hint)]",children:t(E?"tool.questionsAnswers":"tool.input")}),h?b.jsx(h,{block:e.block,metadata:e.metadata}):bL(e.block)]}),!E&&b.jsxs("div",{children:[b.jsx("div",{className:"mb-1 text-xs font-medium text-[var(--app-hint)]",children:t("tool.result")}),b.jsx(f,{block:e.block,metadata:e.metadata})]})]})})()]})]})}),_?b.jsxs(x3,{className:"px-3 pb-3 pt-0",children:[a?b.jsx("div",{className:"mt-2",children:a}):null,l?u?b.jsx("div",{className:"mt-3",children:b.jsx(u,{block:e.block,metadata:e.metadata})}):b.jsxs("div",{className:"mt-3 flex flex-col gap-3",children:[b.jsxs("div",{children:[b.jsx("div",{className:"mb-1 text-xs font-medium text-[var(--app-hint)]",children:t("tool.input")}),bL(e.block)]}),b.jsxs("div",{children:[b.jsx("div",{className:"mb-1 text-xs font-medium text-[var(--app-hint)]",children:t("tool.result")}),b.jsx(f,{block:e.block,metadata:e.metadata})]})]}):null,g&&m?.status==="pending"?b.jsx(gce,{api:e.api,sessionId:e.sessionId,tool:e.block.tool,disabled:e.disabled,onDone:e.onDone}):C&&m?.status==="pending"?b.jsx(Sce,{api:e.api,sessionId:e.sessionId,tool:e.block.tool,disabled:e.disabled,onDone:e.onDone}):b.jsx(hce,{api:e.api,sessionId:e.sessionId,metadata:e.metadata,tool:e.block.tool,disabled:e.disabled,onDone:e.onDone})]}):null]})}const N3=P.memo(_ue),Sue=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,Cue=/\u001b\][^\u0007]*(?:\u0007|\u001b\\)/g,xue=/[\u0000-\u0008\u000b\u000c\u000e-\u001f\u007f]/g;function wue(e){return e.replace(/\r\n?/g,`
`).replace(Cue,"").replace(Sue,"").replace(xue,"")}const kue="(?:local-command-[a-z-]+|command-(?:name|message|args))",Tue=`<(${kue})>([\\s\\S]*?)<\\/\\1>`,Eue=/<br\s*\/?>/gi,A_={"command-name":"terminal.commandName","command-message":"terminal.commandMessage","command-args":"terminal.commandArgs","local-command-stdout":"terminal.stdout","local-command-stderr":"terminal.stderr"},Rue=/<command-name>([\s\S]*?)<\/command-name>/i;function td(e){return wue(e).replace(Eue,`
`)}function Aue(e,t){const n=e.toLowerCase();return A_[n]?t?t(A_[n]):A_[n]:n.replace(/-/g," ")}function Mue(e,t){const n=Array.from(e.matchAll(new RegExp(Tue,"gi")));if(n.length===0)return td(e);const i=[];let s=0;for(const r of n){const a=r.index??0;if(a>s){const h=td(e.slice(s,a));h.trim().length>0&&i.push(h.trimEnd())}const o=r[1]??"",l=td(r[2]??""),u=Aue(o,t);l.length>0?i.push(`${u}:
${l}`):i.push(`${u}:`),s=a+r[0].length}if(s<e.length){const r=td(e.slice(s));r.trim().length>0&&i.push(r.trimEnd())}return i.join(`

`)}function Lue(e){const t=e.match(Rue);if(!t)return null;const i=td(t[1]??"").split(`
`).find(s=>s.trim().length>0)?.trim();return i&&i.length>0?i:null}function Iue(){return b.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 16 16",fill:"none",children:b.jsx("path",{d:"M6 3l5 5-5 5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}function Pue(){return b.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 16 16",fill:"none",children:[b.jsx("path",{d:"M3 4.5l3 3-3 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),b.jsx("path",{d:"M8.5 10.5h4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}function px(e){const{t}=ot(),n=P.useMemo(()=>Mue(e.text,t),[e.text,t]),i=P.useMemo(()=>Lue(e.text),[e.text]);return b.jsx(ux,{className:"min-w-0 max-w-full overflow-hidden shadow-sm",children:b.jsx(dx,{className:"p-3 space-y-0",children:b.jsxs(Ja,{children:[b.jsx(rg,{asChild:!0,children:b.jsx("button",{type:"button",className:"w-full text-left",children:b.jsx("div",{className:"flex flex-col gap-1",children:b.jsxs("div",{className:"flex items-center justify-between gap-3",children:[b.jsxs("div",{className:"min-w-0 flex items-center gap-2",children:[b.jsx("div",{className:"shrink-0 flex h-4 w-4 items-center justify-center text-[var(--app-hint)] leading-none",children:b.jsx(Pue,{})}),b.jsx(hx,{className:"min-w-0 text-sm font-medium leading-tight break-words",children:i??t("terminal.commandName")})]}),b.jsx("span",{className:"text-[var(--app-hint)]",children:b.jsx(Iue,{})})]})})})}),b.jsxs(Ho,{className:"max-w-2xl",children:[b.jsx(Xa,{children:b.jsx($o,{children:t("terminal.commandName")})}),b.jsx("div",{className:"mt-3 max-h-[75vh] overflow-auto",children:b.jsx("div",{className:"min-w-0 max-w-full overflow-x-auto overflow-y-hidden",children:b.jsx("pre",{className:"m-0 w-max min-w-full bg-[var(--app-code-bg)] p-2 text-xs font-mono",children:n})})})]})]})})})}function Due(e){return!(!Se(e)||e.kind!=="tool-call"||typeof e.id!="string"||e.localId!==null&&typeof e.localId!="string"||typeof e.createdAt!="number"||!Array.isArray(e.children)||!Se(e.tool)||typeof e.tool.name!="string"||!("input"in e.tool)||e.tool.description!==null&&typeof e.tool.description!="string"||e.tool.state!=="pending"&&e.tool.state!=="running"&&e.tool.state!=="completed"&&e.tool.state!=="error")}function Oue(e){return e.kind==="tool-call"&&e.tool.permission?.status==="pending"}function j3(e){const t=[],n=[];for(const i of e.children)Oue(i)?t.push(i):n.push(i);return{pending:t,rest:n}}function yc(e){const t=TC();return b.jsx("div",{className:"flex flex-col gap-3",children:e.blocks.map(n=>{if(n.kind==="user-text"){const i="w-fit max-w-[92%] ml-auto rounded-xl bg-[var(--app-secondary-bg)] px-3 py-2 text-[var(--app-fg)] shadow-sm",s=n.status,a=s==="failed"&&typeof n.localId=="string"&&!!t.onRetryMessage?()=>t.onRetryMessage(n.localId):void 0;return b.jsx("div",{className:i,children:b.jsxs("div",{className:"flex items-end gap-2",children:[b.jsx("div",{className:"flex-1",children:b.jsx(_3,{text:n.text})}),s?b.jsx("div",{className:"shrink-0 self-end pb-0.5",children:b.jsx(S3,{status:s,onRetry:a})}):null]})},`user:${n.id}`)}if(n.kind==="agent-text")return b.jsx("div",{className:"px-1",children:b.jsx(No,{content:n.text})},`agent:${n.id}`);if(n.kind==="cli-output"){const i=n.source==="user"?"ml-auto w-full max-w-[92%]":"";return b.jsx("div",{className:"px-1 min-w-0 max-w-full overflow-x-hidden",children:b.jsx("div",{className:i,children:b.jsx(px,{text:n.text})})},`cli:${n.id}`)}if(n.kind==="agent-event"){const i=cx(n.event);return b.jsx("div",{className:"py-1",children:b.jsx("div",{className:"mx-auto w-fit max-w-[92%] px-2 text-center text-xs text-[var(--app-hint)] opacity-80",children:b.jsxs("span",{className:"inline-flex items-center gap-1",children:[i.icon?b.jsx("span",{"aria-hidden":"true",children:i.icon}):null,b.jsx("span",{children:i.text})]})})},`event:${n.id}`)}if(n.kind==="tool-call"){const i=n.tool.name==="Task",s=i?j3(n):null;return b.jsxs("div",{className:"py-1",children:[b.jsx(N3,{api:t.api,sessionId:t.sessionId,metadata:t.metadata,disabled:t.disabled,onDone:t.onRefresh,block:n}),n.children.length>0?i?b.jsxs(b.Fragment,{children:[s&&s.pending.length>0?b.jsx("div",{className:"mt-2 pl-3",children:b.jsx(yc,{blocks:s.pending})}):null,s&&s.rest.length>0?b.jsxs("details",{className:"mt-2",children:[b.jsxs("summary",{className:"cursor-pointer text-xs text-[var(--app-hint)]",children:["Task details (",s.rest.length,")"]}),b.jsx("div",{className:"mt-2 pl-3",children:b.jsx(yc,{blocks:s.rest})})]}):null]}):b.jsx("div",{className:"mt-2 pl-3",children:b.jsx(yc,{blocks:n.children})}):null]},`tool:${n.id}`)}return null})})}function Nue(e){const t=TC(),n=e.artifact;if(!Due(n)){const a=typeof e.argsText=="string"?e.argsText.trim():"",o=a.length>0,l=e.result!==void 0,u=l?To(e.result):"";return b.jsx("div",{className:"py-1 min-w-0 max-w-full overflow-x-hidden",children:b.jsxs("div",{className:"rounded-xl bg-[var(--app-secondary-bg)] p-3 shadow-sm",children:[b.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[b.jsxs("div",{className:"font-mono text-[var(--app-hint)]",children:["Tool: ",e.toolName]}),e.isError?b.jsx("span",{className:"text-red-500",children:"Error"}):null,e.status.type==="running"&&!l?b.jsx("span",{className:"text-[var(--app-hint)]",children:"Running"}):null]}),o?b.jsx("div",{className:"mt-2",children:b.jsx(Ii,{code:a,language:"json"})}):null,l?b.jsx("div",{className:"mt-2",children:b.jsx(Ii,{code:u,language:typeof e.result=="string"?"text":"json"})}):null]})})}const i=n,s=i.tool.name==="Task",r=s?j3(i):null;return b.jsxs("div",{className:"py-1 min-w-0 max-w-full overflow-x-hidden",children:[b.jsx(N3,{api:t.api,sessionId:t.sessionId,metadata:t.metadata,disabled:t.disabled,onDone:t.onRefresh,block:i}),i.children.length>0?s?b.jsxs(b.Fragment,{children:[r&&r.pending.length>0?b.jsx("div",{className:"mt-2 pl-3",children:b.jsx(yc,{blocks:r.pending})}):null,r&&r.rest.length>0?b.jsxs("details",{className:"mt-2",children:[b.jsxs("summary",{className:"cursor-pointer text-xs text-[var(--app-hint)]",children:["Task details (",r.rest.length,")"]}),b.jsx("div",{className:"mt-2 pl-3",children:b.jsx(yc,{blocks:r.rest})})]}):null]}):b.jsx("div",{className:"mt-2 pl-3",children:b.jsx(yc,{blocks:i.children})}):null]})}const jue={Fallback:Nue},Bue={Text:zle,Reasoning:qle,ReasoningGroup:Vle,tools:jue};function Fue(){const e=st(({message:s})=>s.metadata.custom?.kind==="cli-output"),t=st(({message:s})=>s.metadata.custom?.kind!=="cli-output"?"":s.content.find(a=>a.type==="text")?.text??""),i=st(({message:s})=>{if(s.role!=="assistant")return!1;const r=s.content;return r.length>0&&r.every(a=>a.type==="tool-call")})?"py-1 min-w-0 max-w-full overflow-x-hidden":"px-1 min-w-0 max-w-full overflow-x-hidden";return e?b.jsx(Vd,{className:"px-1 min-w-0 max-w-full overflow-x-hidden",children:b.jsx(px,{text:t})}):b.jsx(Vd,{className:i,children:b.jsx(OO,{components:Bue})})}const Uue={ts:"#3178c6",tsx:"#3178c6",js:"#f7df1e",jsx:"#f7df1e",json:"#f59e0b",md:"#64748b",mdx:"#64748b",css:"#2563eb",scss:"#db2777",html:"#f97316",yml:"#ef4444",yaml:"#ef4444",sh:"#10b981",bash:"#10b981",py:"#3776ab",go:"#0ea5e9",rs:"#f97316"};function zue(e){const t=e.trim();if(t.startsWith(".")&&t.indexOf(".",1)===-1)return t.slice(1).toLowerCase();const n=t.split(".");return n.length<=1?"":n[n.length-1]?.toLowerCase()??""}function ph(e){const t=e.size??20,n=P.useMemo(()=>{const i=zue(e.fileName);return Uue[i]??"var(--app-hint)"},[e.fileName]);return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",style:{color:n},children:[b.jsx("path",{d:"M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"}),b.jsx("path",{d:"M14 2v6h6"})]})}function sS(e){return e.startsWith("image/")}function Hue(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}function $ue(e){const{attachment:t}=e;return b.jsxs("div",{className:"relative overflow-hidden rounded-lg",children:[b.jsx("img",{src:t.previewUrl,alt:t.filename,className:"max-h-48 max-w-full object-contain"}),b.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent px-2 py-1.5",children:b.jsx("span",{className:"text-xs text-white/90 line-clamp-1",children:t.filename})})]})}function que(e){const{attachment:t}=e;return b.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-[var(--app-bg)] px-3 py-2",children:[b.jsx(ph,{fileName:t.filename,size:24}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"truncate text-base font-medium text-[var(--app-fg)]",children:t.filename}),b.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:Hue(t.size)})]})]})}function Vue(e){const{attachments:t}=e;if(!t||t.length===0)return null;const n=t.filter(s=>sS(s.mimeType)&&s.previewUrl),i=t.filter(s=>!sS(s.mimeType)||!s.previewUrl);return b.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[n.length>0&&b.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(s=>b.jsx($ue,{attachment:s},s.id))}),i.length>0&&b.jsx("div",{className:"flex flex-col gap-1.5",children:i.map(s=>b.jsx(que,{attachment:s},s.id))})]})}function Wue(){const e=TC(),t=st(({message:g})=>g.role),n=st(({message:g})=>g.role!=="user"?"":g.content.find(C=>C.type==="text")?.text??""),i=st(({message:g})=>g.role!=="user"?void 0:g.metadata.custom?.status),s=st(({message:g})=>g.role!=="user"?null:g.metadata.custom?.localId??null),r=st(({message:g})=>g.role!=="user"?void 0:g.metadata.custom?.attachments),a=st(({message:g})=>g.metadata.custom?.kind==="cli-output"),o=st(({message:g})=>g.metadata.custom?.kind!=="cli-output"?"":g.content.find(S=>S.type==="text")?.text??"");if(t!=="user")return null;const u=i==="failed"&&typeof s=="string"&&!!e.onRetryMessage?()=>e.onRetryMessage(s):void 0,h="w-fit min-w-0 max-w-[92%] ml-auto rounded-xl bg-[var(--app-secondary-bg)] px-3 py-2 text-[var(--app-fg)] shadow-sm";if(a)return b.jsx(Vd,{className:"px-1 min-w-0 max-w-full overflow-x-hidden",children:b.jsx("div",{className:"ml-auto w-full max-w-[92%]",children:b.jsx(px,{text:o})})});const f=n.length>0,m=r&&r.length>0;return b.jsx(Vd,{className:h,children:b.jsxs("div",{className:"flex items-end gap-2",children:[b.jsxs("div",{className:"flex-1 min-w-0",children:[f&&b.jsx(_3,{text:n}),m&&b.jsx(Vue,{attachments:r})]}),i?b.jsx("div",{className:"shrink-0 self-end pb-0.5",children:b.jsx(S3,{status:i,onRetry:u})}):null]})})}function Gue(){const e=st(({message:i})=>i.role),t=st(({message:i})=>i.role!=="system"?"":i.content[0]?.type==="text"?i.content[0].text:""),n=st(({message:i})=>{if(i.role!=="system")return null;const s=i.metadata.custom,r=s?.kind==="event"?s.event:void 0;return r?cx(r).icon:null});return e!=="system"?null:b.jsx("div",{className:"py-1",children:b.jsx("div",{className:"mx-auto w-fit max-w-[92%] px-2 text-center text-xs text-[var(--app-hint)] opacity-80",children:b.jsxs("span",{className:"inline-flex items-center gap-1",children:[n?b.jsx("span",{"aria-hidden":"true",children:n}):null,b.jsx("span",{children:t})]})})})}function Kue(e){const{t}=ot();return e.count===0?null:b.jsxs("button",{onClick:e.onClick,className:"absolute bottom-20 left-1/2 -translate-x-1/2 bg-[var(--app-button)] text-[var(--app-button-text)] px-3 py-1.5 rounded-full text-sm font-medium shadow-lg animate-bounce-in z-10",children:[t("misc.newMessage",{n:e.count})," "]})}function Yue(){const{t:e}=ot(),t=[{align:"end",width:"w-2/3",height:"h-10"},{align:"start",width:"w-3/4",height:"h-12"},{align:"end",width:"w-1/2",height:"h-9"},{align:"start",width:"w-5/6",height:"h-14"}];return b.jsxs("div",{role:"status","aria-live":"polite",children:[b.jsx("span",{className:"sr-only",children:e("misc.loadingMessages")}),b.jsx("div",{className:"space-y-3 animate-pulse",children:t.map((n,i)=>b.jsx("div",{className:n.align==="end"?"flex justify-end":"flex justify-start",children:b.jsx("div",{className:`${n.height} ${n.width} rounded-xl bg-[var(--app-subtle-bg)]`})},`skeleton-${i}`))})]})}const Que={UserMessage:Wue,AssistantMessage:Fue,SystemMessage:Gue};function Jue(e){const{t}=ot(),n=P.useRef(null),i=P.useRef(null),s=P.useRef(!1),r=P.useRef(null),a=P.useRef(!1),o=P.useRef(!1),l=P.useRef(e.isLoadingMoreMessages),u=P.useRef(e.hasMoreMessages),h=P.useRef(e.isLoadingMessages),f=P.useRef(e.onLoadMore),m=P.useRef(()=>{}),g=P.useRef(!0),C=P.useRef(e.onAtBottomChange),S=P.useRef(e.onFlushPending),v=P.useRef(e.forceScrollToken),[_,w]=P.useState(!0),x=P.useRef(_);P.useEffect(()=>{x.current=_},[_]),P.useEffect(()=>{C.current=e.onAtBottomChange},[e.onAtBottomChange]),P.useEffect(()=>{S.current=e.onFlushPending},[e.onFlushPending]),P.useEffect(()=>{u.current=e.hasMoreMessages},[e.hasMoreMessages]),P.useEffect(()=>{h.current=e.isLoadingMessages},[e.isLoadingMessages]),P.useEffect(()=>{f.current=e.onLoadMore},[e.onLoadMore]),P.useEffect(()=>{const M=n.current;if(!M)return;const E=120,L=()=>{const O=M.scrollHeight-M.scrollTop-M.clientHeight<E;O?x.current||w(!0):x.current&&w(!1),O!==g.current&&(g.current=O,C.current(O),O&&S.current())};return M.addEventListener("scroll",L,{passive:!0}),()=>M.removeEventListener("scroll",L)},[]);const k=P.useCallback(()=>{const M=n.current;M&&M.scrollTo({top:M.scrollHeight,behavior:"smooth"}),w(!0),g.current||(g.current=!0,C.current(!0)),S.current()},[]);P.useEffect(()=>{w(!0),g.current=!0,C.current(!0),v.current=e.forceScrollToken},[e.sessionId]),P.useEffect(()=>{v.current!==e.forceScrollToken&&(v.current=e.forceScrollToken,k())},[e.forceScrollToken,k]);const A=P.useCallback(()=>{if(h.current||!u.current||l.current||s.current)return;const M=n.current;if(!M)return;r.current={scrollTop:M.scrollTop,scrollHeight:M.scrollHeight},s.current=!0,o.current=!1;let E;try{E=f.current()}catch(L){throw r.current=null,s.current=!1,L}E.catch(L=>{r.current=null,s.current=!1,console.error("Failed to load older messages:",L)}).finally(()=>{!o.current&&!l.current&&r.current&&(r.current=null,s.current=!1)})},[]);P.useEffect(()=>{m.current=A},[A]),P.useEffect(()=>{const M=i.current,E=n.current;if(!M||!E||!e.hasMoreMessages||e.isLoadingMessages||typeof IntersectionObserver>"u")return;const L=new IntersectionObserver(D=>{for(const O of D)O.isIntersecting&&m.current()},{root:E,rootMargin:"200px 0px 0px 0px"});return L.observe(M),()=>L.disconnect()},[e.hasMoreMessages,e.isLoadingMessages]),P.useLayoutEffect(()=>{const M=r.current,E=n.current;if(!M||!E)return;const L=E.scrollHeight-M.scrollHeight;E.scrollTop=M.scrollTop+L,r.current=null,s.current=!1},[e.messagesVersion]),P.useEffect(()=>{l.current=e.isLoadingMoreMessages,e.isLoadingMoreMessages&&(o.current=!0),a.current&&!e.isLoadingMoreMessages&&r.current&&(r.current=null,s.current=!1),a.current=e.isLoadingMoreMessages},[e.isLoadingMoreMessages]);const T=e.isLoadingMessages&&e.rawMessagesCount===0&&e.pendingCount===0;return b.jsx(aJ,{value:{api:e.api,sessionId:e.sessionId,metadata:e.metadata,disabled:e.disabled,onRefresh:e.onRefresh,onRetryMessage:e.onRetryMessage},children:b.jsxs(HO,{className:"flex min-h-0 flex-1 flex-col relative",children:[b.jsx(qO,{asChild:!0,autoScroll:_,children:b.jsx("div",{ref:n,className:"min-h-0 flex-1 overflow-y-auto overflow-x-hidden",children:b.jsxs("div",{className:"mx-auto w-full max-w-content min-w-0 p-3",children:[b.jsx("div",{ref:i,className:"h-px w-full","aria-hidden":"true"}),T?b.jsx(Yue,{}):b.jsxs(b.Fragment,{children:[e.messagesWarning?b.jsx("div",{className:"mb-3 rounded-md bg-amber-500/10 p-2 text-xs",children:e.messagesWarning}):null,e.hasMoreMessages&&!e.isLoadingMessages?b.jsx("div",{className:"py-1 mb-2",children:b.jsx("div",{className:"mx-auto w-fit",children:b.jsx(Rn,{variant:"outline",size:"sm",onClick:A,disabled:e.isLoadingMoreMessages||e.isLoadingMessages,"aria-busy":e.isLoadingMoreMessages,className:"gap-1.5 text-xs opacity-80 hover:opacity-100",children:e.isLoadingMoreMessages?b.jsxs(b.Fragment,{children:[b.jsx(Ur,{size:"sm",label:null,className:"text-current"}),t("misc.loading")]}):b.jsxs(b.Fragment,{children:[b.jsx("span",{"aria-hidden":"true",children:""}),t("misc.loadOlder")]})})})}):null,null]}),b.jsx("div",{className:"flex flex-col gap-3",children:b.jsx(XY,{components:Que})})]})})}),b.jsx(Kue,{count:e.pendingCount,onClick:k})]})})}function Xue(e){if(e.kind==="user-text")return{role:"user",id:`user:${e.id}`,createdAt:new Date(e.createdAt),content:[{type:"text",text:e.text}],metadata:{custom:{kind:"user",status:e.status,localId:e.localId,originalText:e.originalText,attachments:e.attachments}}};if(e.kind==="agent-text")return{role:"assistant",id:`assistant:${e.id}`,createdAt:new Date(e.createdAt),content:[{type:"text",text:e.text}],metadata:{custom:{kind:"assistant"}}};if(e.kind==="agent-reasoning")return{role:"assistant",id:`assistant:${e.id}`,createdAt:new Date(e.createdAt),content:[{type:"reasoning",text:e.text}],metadata:{custom:{kind:"assistant"}}};if(e.kind==="agent-event")return{role:"system",id:`event:${e.id}`,createdAt:new Date(e.createdAt),content:[{type:"text",text:Kle(e.event)}],metadata:{custom:{kind:"event",event:e.event}}};if(e.kind==="cli-output"){const s=`cli:${e.id}`;return{role:e.source==="user"?"user":"assistant",id:s,createdAt:new Date(e.createdAt),content:[{type:"text",text:e.text}],metadata:{custom:{kind:"cli-output",source:e.source}}}}const t=e,n=`tool:${t.id}`,i=To(t.tool.input);return{role:"assistant",id:n,createdAt:new Date(t.createdAt),content:[{type:"tool-call",toolCallId:t.id,toolName:t.tool.name,argsText:i,result:t.tool.result,isError:t.tool.state==="error",artifact:t}],metadata:{custom:{kind:"tool",toolCallId:t.id}}}}function Zue(e){return e?e.filter(t=>t.type==="text"&&typeof t.text=="string").map(t=>t.text).join(`
`).trim():""}function ede(e){try{const t=JSON.parse(e);return t&&typeof t=="object"&&"__attachmentMetadata"in t?t:null}catch{return null}}function tde(e){if(e.role!=="user")return{text:"",attachments:[]};const t=[],n=[],i=e.attachments?.flatMap(a=>a.content??[])??[];for(const a of i)if(a.type==="text"&&typeof a.text=="string"){const o=a,l=ede(o.text);l?t.push(l.__attachmentMetadata):n.push(o.text)}const s=Zue(e.content);return{text:[n.join(`
`),s].filter(a=>a.length>0).join(`

`).trim(),attachments:t}}function nde(e){const t=DK({callback:Xue,messages:e.blocks,isRunning:e.session.thinking}),n=P.useCallback(async r=>{const{text:a,attachments:o}=tde(r);!a&&o.length===0||e.onSendMessage(a,o.length>0?o:void 0)},[e.onSendMessage]),i=P.useCallback(async()=>{await e.onAbort()},[e.onAbort]),s=P.useMemo(()=>({isDisabled:e.isSending||!e.session.active&&!e.allowSendWhenInactive,isRunning:e.session.thinking,messages:t,onNew:n,onCancel:i,adapters:e.attachmentAdapter?{attachments:e.attachmentAdapter}:void 0,unstable_capabilities:{copy:!0}}),[e.session.active,e.isSending,e.allowSendWhenInactive,e.session.thinking,t,n,i,e.attachmentAdapter]);return VG(s)}const ide=50*1024*1024,sde=5*1024*1024;function rde(e,t){const n=new Set,i=async s=>{if(s)try{await e.deleteUploadFile(t,s)}catch{}};return{accept:"*/*",async*add({file:s}){const r=crypto.randomUUID(),a=s.type||"application/octet-stream";yield{id:r,type:"file",name:s.name,contentType:a,file:s,status:{type:"running",reason:"uploading",progress:0}};try{if(n.has(r))return;if(s.size>ide){yield{id:r,type:"file",name:s.name,contentType:a,file:s,status:{type:"incomplete",reason:"error"}};return}const o=await ode(s);if(n.has(r))return;yield{id:r,type:"file",name:s.name,contentType:a,file:s,status:{type:"running",reason:"uploading",progress:50}};const l=await e.uploadFile(t,s.name,o,a);if(n.has(r)){l.success&&l.path&&await i(l.path);return}if(!l.success||!l.path){yield{id:r,type:"file",name:s.name,contentType:a,file:s,status:{type:"incomplete",reason:"error"}};return}let u;sS(a)&&s.size<=sde&&(u=await ade(s)),yield{id:r,type:"file",name:s.name,contentType:a,file:s,status:{type:"requires-action",reason:"composer-send"},path:l.path,previewUrl:u}}catch{yield{id:r,type:"file",name:s.name,contentType:a,file:s,status:{type:"incomplete",reason:"error"}}}},async remove(s){n.add(s.id);const r=s.path;await i(r)},async send(s){const r=s,a=r.path,o=a?{id:s.id,filename:s.name,mimeType:s.contentType??"application/octet-stream",size:s.file?.size??0,path:a,previewUrl:r.previewUrl}:void 0;return{id:s.id,type:s.type,name:s.name,contentType:s.contentType,status:{type:"complete"},content:o?[{type:"text",text:JSON.stringify({__attachmentMetadata:o})}]:[]}}}}async function ode(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=()=>{const r=i.result.split(",")[1];if(!r){n(new Error("Failed to read file"));return}t(r)},i.onerror=n,i.readAsDataURL(e)})}async function ade(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=n,i.readAsDataURL(e)})}function mx(e,t,n){const i=Fr(),s=async()=>{t&&(await i.invalidateQueries({queryKey:Vt.session(t)}),await i.invalidateQueries({queryKey:Vt.sessions}))},r=Tr({mutationFn:async()=>{if(!e||!t)throw new Error("Session unavailable");await e.abortSession(t)},onSuccess:()=>{s()}}),a=Tr({mutationFn:async()=>{if(!e||!t)throw new Error("Session unavailable");await e.archiveSession(t)},onSuccess:()=>{s()}}),o=Tr({mutationFn:async()=>{if(!e||!t)throw new Error("Session unavailable");await e.switchSession(t)},onSuccess:()=>{s()}}),l=Tr({mutationFn:async m=>{if(!e||!t)throw new Error("Session unavailable");if(DQ(n)&&!S2(m,n))throw new Error("Invalid permission mode for session flavor");await e.setPermissionMode(t,m)},onSuccess:()=>{s()}}),u=Tr({mutationFn:async m=>{if(!e||!t)throw new Error("Session unavailable");await e.setModelMode(t,m)},onSuccess:()=>{s()}}),h=Tr({mutationFn:async m=>{if(!e||!t)throw new Error("Session unavailable");await e.renameSession(t,m)},onSuccess:()=>{s()}}),f=Tr({mutationFn:async()=>{if(!e||!t)throw new Error("Session unavailable");await e.deleteSession(t)},onSuccess:async()=>{t&&(i.removeQueries({queryKey:Vt.session(t)}),AS(t),await i.invalidateQueries({queryKey:Vt.sessions}))}});return{abortSession:r.mutateAsync,archiveSession:a.mutateAsync,switchSession:o.mutateAsync,setPermissionMode:l.mutateAsync,setModelMode:u.mutateAsync,renameSession:h.mutateAsync,deleteSession:f.mutateAsync,isPending:r.isPending||a.isPending||o.isPending||l.isPending||u.isPending||h.isPending||f.isPending}}function lde(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),b.jsx("path",{d:"m15 5 4 4"})]})}function cde(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("rect",{width:"20",height:"5",x:"2",y:"3",rx:"1"}),b.jsx("path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"}),b.jsx("path",{d:"M10 12h4"})]})}function ude(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("path",{d:"M3 6h18"}),b.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),b.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),b.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),b.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]})}function B3(e){const{t}=ot(),{isOpen:n,onClose:i,sessionActive:s,onRename:r,onArchive:a,onDelete:o,anchorPoint:l,menuId:u}=e,h=P.useRef(null),[f,m]=P.useState(null),g=P.useId(),C=u??`session-action-menu-${g}`,S=`${C}-heading`,v=()=>{i(),r()},_=()=>{i(),a()},w=()=>{i(),o()},x=P.useCallback(()=>{const T=h.current;if(!T)return;const M=T.getBoundingClientRect(),E=window.innerWidth,L=window.innerHeight,D=8,O=8,j=L-l.y,U=l.y,q=j<M.height+O&&U>j;let K=q?l.y-M.height-O:l.y+O,$=l.x-M.width/2;const Y=q?"bottom center":"top center";K=Math.min(Math.max(K,D),L-M.height-D),$=Math.min(Math.max($,D),E-M.width-D),m({top:K,left:$,transformOrigin:Y})},[l]);if(P.useLayoutEffect(()=>{n&&x()},[n,x]),P.useEffect(()=>{if(!n){m(null);return}const T=L=>{const D=L.target;h.current?.contains(D)||i()},M=L=>{L.key==="Escape"&&i()},E=()=>{x()};return document.addEventListener("pointerdown",T),document.addEventListener("keydown",M),window.addEventListener("resize",E),window.addEventListener("scroll",E,!0),()=>{document.removeEventListener("pointerdown",T),document.removeEventListener("keydown",M),window.removeEventListener("resize",E),window.removeEventListener("scroll",E,!0)}},[n,i,x]),P.useEffect(()=>{if(!n)return;const T=window.requestAnimationFrame(()=>{h.current?.querySelector('[role="menuitem"]')?.focus()});return()=>window.cancelAnimationFrame(T)},[n]),!n)return null;const k=f?{top:f.top,left:f.left,transformOrigin:f.transformOrigin}:void 0,A="flex w-full items-center gap-3 rounded-md px-3 py-2 text-left text-base transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)]";return b.jsxs("div",{ref:h,className:"fixed z-50 min-w-[200px] rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] p-1 shadow-lg animate-menu-pop",style:k,children:[b.jsx("div",{id:S,className:"px-3 py-1.5 text-[10px] font-semibold uppercase tracking-wide text-[var(--app-hint)]",children:t("session.more")}),b.jsxs("div",{id:C,role:"menu","aria-labelledby":S,className:"flex flex-col gap-1",children:[b.jsxs("button",{type:"button",role:"menuitem",className:`${A} hover:bg-[var(--app-subtle-bg)]`,onClick:v,children:[b.jsx(lde,{className:"text-[var(--app-hint)]"}),t("session.action.rename")]}),s?b.jsxs("button",{type:"button",role:"menuitem",className:`${A} text-red-500 hover:bg-red-500/10`,onClick:_,children:[b.jsx(cde,{className:"text-red-500"}),t("session.action.archive")]}):b.jsxs("button",{type:"button",role:"menuitem",className:`${A} text-red-500 hover:bg-red-500/10`,onClick:w,children:[b.jsx(ude,{className:"text-red-500"}),t("session.action.delete")]})]})]})}function F3(e){const{t}=ot(),{isOpen:n,onClose:i,currentName:s,onRename:r,isPending:a}=e,[o,l]=P.useState(s),[u,h]=P.useState(null),f=P.useRef(null);P.useEffect(()=>{n&&(l(s),h(null),setTimeout(()=>{f.current?.focus(),f.current?.select()},100))},[n,s]);const m=async C=>{C.preventDefault();const S=o.trim();if(!S||S===s){i();return}h(null);try{await r(S),i()}catch{h(t("dialog.rename.error"))}},g=C=>{C.key==="Escape"&&i()};return b.jsx(Ja,{open:n,onOpenChange:C=>!C&&i(),children:b.jsxs(Ho,{className:"max-w-sm",children:[b.jsx(Xa,{children:b.jsx($o,{children:t("dialog.rename.title")})}),b.jsxs("form",{onSubmit:m,className:"mt-4 flex flex-col gap-4",children:[b.jsx("input",{ref:f,type:"text",value:o,onChange:C=>l(C.target.value),onKeyDown:g,placeholder:t("dialog.rename.placeholder"),className:"w-full px-3 py-2.5 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent",disabled:a,maxLength:255}),u?b.jsx("div",{className:"rounded-md bg-red-50 p-3 text-sm text-red-600 dark:bg-red-900/20 dark:text-red-400",children:u}):null,b.jsxs("div",{className:"flex gap-2 justify-end",children:[b.jsx(Rn,{type:"button",variant:"secondary",onClick:i,disabled:a,children:t("button.cancel")}),b.jsx(Rn,{type:"submit",disabled:a||!o.trim(),children:t(a?"dialog.rename.saving":"button.save")})]})]})]})})}function zm(e){const{t}=ot(),{isOpen:n,onClose:i,title:s,description:r,confirmLabel:a,confirmingLabel:o,onConfirm:l,isPending:u,destructive:h=!1}=e,[f,m]=P.useState(null);P.useEffect(()=>{n&&m(null)},[n]);const g=async()=>{m(null);try{await l(),i()}catch(C){const S=C instanceof Error&&C.message?C.message:t("dialog.error.default");m(S)}};return b.jsx(Ja,{open:n,onOpenChange:C=>!C&&i(),children:b.jsxs(Ho,{className:"max-w-sm",children:[b.jsxs(Xa,{children:[b.jsx($o,{children:s}),b.jsx(ih,{className:"mt-2",children:r})]}),f?b.jsx("div",{className:"mt-3 rounded-md bg-red-50 p-3 text-sm text-red-600 dark:bg-red-900/20 dark:text-red-400",children:f}):null,b.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[b.jsx(Rn,{type:"button",variant:"secondary",onClick:i,disabled:u,children:t("button.cancel")}),b.jsx(Rn,{type:"button",variant:h?"destructive":"secondary",onClick:g,disabled:u,children:u?o:a})]})]})})}function dde(e){if(e.metadata?.name)return e.metadata.name;if(e.metadata?.summary?.text)return e.metadata.summary.text;if(e.metadata?.path){const t=e.metadata.path.split("/").filter(Boolean);return t.length>0?t[t.length-1]:e.id.slice(0,8)}return e.id.slice(0,8)}function hde(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("path",{d:"M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"}),b.jsx("path",{d:"M14 2v6h6"})]})}function fde(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",className:e.className,children:[b.jsx("circle",{cx:"12",cy:"5",r:"2"}),b.jsx("circle",{cx:"12",cy:"12",r:"2"}),b.jsx("circle",{cx:"12",cy:"19",r:"2"})]})}function pde(e){const{t}=ot(),{session:n,api:i,onSessionDeleted:s}=e,r=P.useMemo(()=>dde(n),[n]),a=n.metadata?.worktree?.branch,[o,l]=P.useState(!1),[u,h]=P.useState({x:0,y:0}),f=P.useId(),m=P.useRef(null),[g,C]=P.useState(!1),[S,v]=P.useState(!1),[_,w]=P.useState(!1),{archiveSession:x,renameSession:k,deleteSession:A,isPending:T}=mx(i,n.id,n.metadata?.flavor??null),M=async()=>{await A(),s?.()},E=()=>{if(!o&&m.current){const L=m.current.getBoundingClientRect();h({x:L.right,y:L.bottom})}l(L=>!L)};return SS()?null:b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3",children:[b.jsx("button",{type:"button",onClick:e.onBack,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:b.jsx("polyline",{points:"15 18 9 12 15 6"})})}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"truncate font-semibold",children:r}),b.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-0.5 text-xs text-[var(--app-hint)]",children:[b.jsxs("span",{className:"inline-flex items-center gap-1",children:[b.jsx("span",{"aria-hidden":"true",children:""}),n.metadata?.flavor?.trim()||"unknown"]}),b.jsxs("span",{children:[t("session.item.modelMode"),": ",n.modelMode||"default"]}),a?b.jsxs("span",{children:[t("session.item.worktree"),": ",a]}):null]})]}),e.onViewFiles?b.jsx("button",{type:"button",onClick:e.onViewFiles,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",title:t("session.title"),children:b.jsx(hde,{})}):null,b.jsx("button",{type:"button",onClick:E,onPointerDown:L=>L.stopPropagation(),ref:m,"aria-haspopup":"menu","aria-expanded":o,"aria-controls":o?f:void 0,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",title:t("session.more"),children:b.jsx(fde,{})})]})}),b.jsx(B3,{isOpen:o,onClose:()=>l(!1),sessionActive:n.active,onRename:()=>C(!0),onArchive:()=>v(!0),onDelete:()=>w(!0),anchorPoint:u,menuId:f}),b.jsx(F3,{isOpen:g,onClose:()=>C(!1),currentName:r,onRename:k,isPending:T}),b.jsx(zm,{isOpen:S,onClose:()=>v(!1),title:t("dialog.archive.title"),description:t("dialog.archive.description",{name:r}),confirmLabel:t("dialog.archive.confirm"),confirmingLabel:t("dialog.archive.confirming"),onConfirm:x,isPending:T,destructive:!0}),b.jsx(zm,{isOpen:_,onClose:()=>w(!1),title:t("dialog.delete.title"),description:t("dialog.delete.description",{name:r}),confirmLabel:t("dialog.delete.confirm"),confirmingLabel:t("dialog.delete.confirming"),onConfirm:M,isPending:T,destructive:!0})]})}function mde(e){const{haptic:t}=er(),n=Ts(),i=!e.session.active,s=P.useRef(new Map),r=P.useRef(new Map),[a,o]=P.useState(0),l=e.session.metadata?.flavor??null,{abortSession:u,switchSession:h,setPermissionMode:f,setModelMode:m}=mx(e.api,e.session.id,l),g=$P();P.useEffect(()=>{I2({getSession:()=>e.session,sendMessage:($,Y)=>e.onSend(Y),approvePermission:async($,Y)=>{await e.api.approvePermission(e.session.id,Y),e.onRefresh()},denyPermission:async($,Y)=>{await e.api.denyPermission(e.session.id,Y),e.onRefresh()}})},[e.session,e.api,e.onSend,e.onRefresh]),P.useEffect(()=>{v9($=>$===e.session.id?e.session:null,$=>$===e.session.id?e.messages:[])},[e.session,e.messages]);const C=P.useRef([]);P.useEffect(()=>{const $=new Set(C.current.map(Q=>Q.id)),Y=e.messages.filter(Q=>!$.has(Q.id));Y.length>0&&dd.onMessages(e.session.id,Y),C.current=e.messages},[e.messages,e.session.id]);const S=P.useRef(e.session.thinking);P.useEffect(()=>{S.current&&!e.session.thinking&&dd.onReady(e.session.id),S.current=e.session.thinking},[e.session.thinking,e.session.id]);const v=P.useRef(new Set);P.useEffect(()=>{const $=e.session.agentState?.requests??{},Y=new Set(Object.keys($));for(const[Q,F]of Object.entries($))v.current.has(Q)||dd.onPermissionRequested(e.session.id,Q,F.tool??"unknown",F.arguments);v.current=Y},[e.session.agentState?.requests,e.session.id]);const _=P.useCallback(async()=>{g&&(g.status==="connected"||g.status==="connecting"?await g.stopVoice():await g.startVoice(e.session.id))},[g,e.session.id]),w=P.useCallback(()=>{g&&g.toggleMic()},[g]),x=P.useRef(null);P.useEffect(()=>{s.current.clear(),r.current.clear()},[e.session.id]);const k=P.useMemo(()=>{x.current!==null&&x.current!==e.session.id&&(s.current.clear(),r.current.clear()),x.current=e.session.id;const $=s.current,Y=[],Q=new Set;for(const F of e.messages){Q.add(F.id);const N=$.get(F.id);if(N&&N.source===F){N.normalized&&Y.push(N.normalized);continue}const z=C2(F);$.set(F.id,{source:F,normalized:z}),z&&Y.push(z)}for(const F of $.keys())Q.has(F)||$.delete(F);return Y},[e.messages]),A=P.useMemo(()=>gQ(k,e.session.agentState),[k,e.session.agentState]),T=P.useMemo(()=>EQ(A.blocks,r.current),[A.blocks]);P.useEffect(()=>{r.current=T.byId},[T.byId]);const M=P.useCallback(async $=>{try{await f($),t.notification("success"),e.onRefresh()}catch(Y){t.notification("error"),console.error("Failed to set permission mode:",Y)}},[f,e.onRefresh,t]),E=P.useCallback(async $=>{try{await m($),t.notification("success"),e.onRefresh()}catch(Y){t.notification("error"),console.error("Failed to set model mode:",Y)}},[m,e.onRefresh,t]),L=P.useCallback(async()=>{await u(),e.onRefresh()},[u,e.onRefresh]),D=P.useCallback(async()=>{await h(),e.onRefresh()},[h,e.onRefresh]),O=P.useCallback(()=>{n({to:"/sessions/$sessionId/files",params:{sessionId:e.session.id}})},[n,e.session.id]),j=P.useCallback(()=>{n({to:"/sessions/$sessionId/terminal",params:{sessionId:e.session.id}})},[n,e.session.id]),U=P.useCallback(($,Y)=>{e.onSend($,Y),o(Q=>Q+1)},[e.onSend]),q=P.useMemo(()=>{if(e.session.active)return rde(e.api,e.session.id)},[e.api,e.session.id,e.session.active]),K=nde({session:e.session,blocks:T.blocks,isSending:e.isSending,onSendMessage:U,onAbort:L,attachmentAdapter:q,allowSendWhenInactive:!0});return b.jsxs("div",{className:"flex h-full flex-col",children:[b.jsx(pde,{session:e.session,onBack:e.onBack,onViewFiles:e.session.metadata?.path?O:void 0,api:e.api,onSessionDeleted:e.onBack}),i?b.jsx("div",{className:"px-3 pt-3",children:b.jsx("div",{className:"mx-auto w-full max-w-content rounded-md bg-[var(--app-subtle-bg)] p-3 text-sm text-[var(--app-hint)]",children:"Session is inactive. Sending will resume it automatically."})}):null,b.jsx(QK,{runtime:K,children:b.jsxs("div",{className:"relative flex min-h-0 flex-1 flex-col",children:[b.jsx(Jue,{api:e.api,sessionId:e.session.id,metadata:e.session.metadata,disabled:i,onRefresh:e.onRefresh,onRetryMessage:e.onRetryMessage,onFlushPending:e.onFlushPending,onAtBottomChange:e.onAtBottomChange,isLoadingMessages:e.isLoadingMessages,messagesWarning:e.messagesWarning,hasMoreMessages:e.hasMoreMessages,isLoadingMoreMessages:e.isLoadingMoreMessages,onLoadMore:e.onLoadMore,pendingCount:e.pendingCount,rawMessagesCount:e.messages.length,normalizedMessagesCount:k.length,messagesVersion:e.messagesVersion,forceScrollToken:a},e.session.id),b.jsx(oJ,{disabled:e.isSending,permissionMode:e.session.permissionMode,modelMode:e.session.modelMode,agentFlavor:l,active:e.session.active,allowSendWhenInactive:!0,thinking:e.session.thinking,agentState:e.session.agentState,contextSize:A.latestUsage?.contextSize,controlledByUser:e.session.agentState?.controlledByUser===!0,onPermissionModeChange:M,onModelModeChange:E,onSwitchToRemote:D,onTerminal:e.session.active?j:void 0,autocompleteSuggestions:e.autocompleteSuggestions,voiceStatus:g?.status,voiceMicMuted:g?.micMuted,onVoiceToggle:g?_:void 0,onVoiceMicToggle:g?w:void 0})]})}),g&&b.jsx(a9,{api:e.api,micMuted:g.micMuted,onStatusChange:g.setStatus})]})}function U3(e){const{onLongPress:t,onClick:n,threshold:i=500,disabled:s=!1}=e,r=P.useRef(null),a=P.useRef(!1),o=P.useRef(!1),l=P.useRef({x:0,y:0}),u=P.useCallback(()=>{r.current&&(clearTimeout(r.current),r.current=null)},[]),h=P.useCallback((k,A)=>{s||(u(),a.current=!1,o.current=!1,l.current={x:k,y:A},r.current=setTimeout(()=>{a.current=!0,t(l.current)},i))},[s,u,t,i]),f=P.useCallback(k=>{u(),k&&!a.current&&!o.current&&n&&n(),a.current=!1,o.current=!1},[u,n]),m=P.useCallback(k=>{k.button===0&&h(k.clientX,k.clientY)},[h]),g=P.useCallback(()=>{f(!a.current)},[f]),C=P.useCallback(()=>{f(!1)},[f]),S=P.useCallback(k=>{const A=k.touches[0];h(A.clientX,A.clientY)},[h]),v=P.useCallback(k=>{a.current&&k.preventDefault(),f(!a.current)},[f]),_=P.useCallback(()=>{o.current=!0,u()},[u]),w=P.useCallback(k=>{s||(k.preventDefault(),u(),a.current=!0,t({x:k.clientX,y:k.clientY}))},[s,u,t]),x=P.useCallback(k=>{s||(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),n?.())},[s,n]);return{onMouseDown:m,onMouseUp:g,onMouseLeave:C,onTouchStart:S,onTouchEnd:v,onTouchMove:_,onContextMenu:w,onKeyDown:x}}function gde(e){if(e==="Other")return e;const t=e.split(/[\\/]+/).filter(Boolean);return t.length===0?e:t.length===1?t[0]:`${t[t.length-2]}/${t[t.length-1]}`}function vde(e){const t=new Map;return e.forEach(n=>{const i=n.metadata?.worktree?.basePath??n.metadata?.path??"Other";t.has(i)||t.set(i,[]),t.get(i).push(n)}),Array.from(t.entries()).map(([n,i])=>{const s=[...i].sort((l,u)=>{const h=l.active?l.pendingRequestsCount>0?0:1:2,f=u.active?u.pendingRequestsCount>0?0:1:2;return h!==f?h-f:u.updatedAt-l.updatedAt}),r=i.reduce((l,u)=>u.updatedAt>l?u.updatedAt:l,-1/0),a=i.some(l=>l.active),o=gde(n);return{directory:n,displayName:o,sessions:s,latestUpdatedAt:r,hasActiveSession:a}}).sort((n,i)=>n.hasActiveSession!==i.hasActiveSession?n.hasActiveSession?-1:1:i.latestUpdatedAt-n.latestUpdatedAt)}function bde(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),b.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function yde(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("path",{d:"M9 18h6"}),b.jsx("path",{d:"M10 22h4"}),b.jsx("path",{d:"M12 2a7 7 0 0 0-4 12c.6.6 1 1.2 1 2h6c0-.8.4-1.4 1-2a7 7 0 0 0-4-12Z"})]})}function _de(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`${e.className??""} transition-transform duration-200 ${e.collapsed?"":"rotate-90"}`,children:b.jsx("polyline",{points:"9 18 15 12 9 6"})})}function Sde(e){if(e.metadata?.name)return e.metadata.name;if(e.metadata?.summary?.text)return e.metadata.summary.text;if(e.metadata?.path){const t=e.metadata.path.split("/").filter(Boolean);return t.length>0?t[t.length-1]:e.id.slice(0,8)}return e.id.slice(0,8)}function Cde(e){return!e.todoProgress||e.todoProgress.completed===e.todoProgress.total?null:e.todoProgress}function xde(e){const t=e.metadata?.flavor?.trim();return t||"unknown"}function wde(e,t){const n=e<1e12?e*1e3:e;if(!Number.isFinite(n))return null;const i=Date.now()-n;if(i<6e4)return t("session.time.justNow");const s=Math.floor(i/6e4);if(s<60)return t("session.time.minutesAgo",{n:s});const r=Math.floor(s/60);if(r<24)return t("session.time.hoursAgo",{n:r});const a=Math.floor(r/24);return a<7?t("session.time.daysAgo",{n:a}):new Date(n).toLocaleDateString()}function kde(e){const{t}=ot(),{session:n,onSelect:i,showPath:s=!0,api:r,selected:a=!1}=e,{haptic:o}=er(),[l,u]=P.useState(!1),[h,f]=P.useState({x:0,y:0}),[m,g]=P.useState(!1),[C,S]=P.useState(!1),[v,_]=P.useState(!1),{archiveSession:w,renameSession:x,deleteSession:k,isPending:A}=mx(r,n.id,n.metadata?.flavor??null),T=U3({onLongPress:L=>{o.impact("medium"),f(L),u(!0)},onClick:()=>{l||i(n.id)},threshold:500}),M=Sde(n),E=n.active?n.thinking?"bg-[#007AFF]":"bg-[var(--app-badge-success-text)]":"bg-[var(--app-hint)]";return b.jsxs(b.Fragment,{children:[b.jsxs("button",{type:"button",...T,className:`session-list-item flex w-full flex-col gap-1.5 px-3 py-3 text-left transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)] select-none ${a?"bg-[var(--app-secondary-bg)]":""}`,style:{WebkitTouchCallout:"none"},"aria-current":a?"page":void 0,children:[b.jsxs("div",{className:"flex items-center justify-between gap-3",children:[b.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[b.jsx("span",{className:"flex h-4 w-4 items-center justify-center","aria-hidden":"true",children:b.jsx("span",{className:`h-2 w-2 rounded-full ${E}`})}),b.jsx("div",{className:"truncate text-base font-medium",children:M})]}),b.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs",children:[n.thinking?b.jsx("span",{className:"text-[#007AFF] animate-pulse",children:t("session.item.thinking")}):null,(()=>{const L=Cde(n);return L?b.jsxs("span",{className:"flex items-center gap-1 text-[var(--app-hint)]",children:[b.jsx(yde,{className:"h-3 w-3"}),L.completed,"/",L.total]}):null})(),n.pendingRequestsCount>0?b.jsxs("span",{className:"text-[var(--app-badge-warning-text)]",children:[t("session.item.pending")," ",n.pendingRequestsCount]}):null,b.jsx("span",{className:"text-[var(--app-hint)]",children:wde(n.updatedAt,t)})]})]}),s?b.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:n.metadata?.path??n.id}):null,b.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-[var(--app-hint)]",children:[b.jsxs("span",{className:"inline-flex items-center gap-2",children:[b.jsx("span",{className:"flex h-4 w-4 items-center justify-center","aria-hidden":"true",children:""}),xde(n)]}),b.jsxs("span",{children:[t("session.item.modelMode"),": ",n.modelMode||"default"]}),n.metadata?.worktree?.branch?b.jsxs("span",{children:[t("session.item.worktree"),": ",n.metadata.worktree.branch]}):null]})]}),b.jsx(B3,{isOpen:l,onClose:()=>u(!1),sessionActive:n.active,onRename:()=>g(!0),onArchive:()=>S(!0),onDelete:()=>_(!0),anchorPoint:h}),b.jsx(F3,{isOpen:m,onClose:()=>g(!1),currentName:M,onRename:x,isPending:A}),b.jsx(zm,{isOpen:C,onClose:()=>S(!1),title:t("dialog.archive.title"),description:t("dialog.archive.description",{name:M}),confirmLabel:t("dialog.archive.confirm"),confirmingLabel:t("dialog.archive.confirming"),onConfirm:w,isPending:A,destructive:!0}),b.jsx(zm,{isOpen:v,onClose:()=>_(!1),title:t("dialog.delete.title"),description:t("dialog.delete.description",{name:M}),confirmLabel:t("dialog.delete.confirm"),confirmingLabel:t("dialog.delete.confirming"),onConfirm:k,isPending:A,destructive:!0})]})}function Tde(e){const{t}=ot(),{renderHeader:n=!0,api:i,selectedSessionId:s}=e,r=P.useMemo(()=>vde(e.sessions),[e.sessions]),[a,o]=P.useState(()=>new Map),l=h=>{const f=a.get(h.directory);return f!==void 0?f:!h.hasActiveSession},u=(h,f)=>{o(m=>{const g=new Map(m);return g.set(h,!f),g})};return P.useEffect(()=>{o(h=>{if(h.size===0)return h;const f=new Map(h),m=new Set(r.map(C=>C.directory));let g=!1;for(const C of f.keys())m.has(C)||(f.delete(C),g=!0);return g?f:h})},[r]),b.jsxs("div",{className:"mx-auto w-full max-w-content flex flex-col",children:[n?b.jsxs("div",{className:"flex items-center justify-between px-3 py-1",children:[b.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:t("sessions.count",{n:e.sessions.length,m:r.length})}),b.jsx("button",{type:"button",onClick:e.onNewSession,className:"session-list-new-button p-1.5 rounded-full text-[var(--app-link)] transition-colors",title:t("sessions.new"),children:b.jsx(bde,{className:"h-5 w-5"})})]}):null,b.jsx("div",{className:"flex flex-col",children:r.map(h=>{const f=l(h);return b.jsxs("div",{children:[b.jsxs("button",{type:"button",onClick:()=>u(h.directory,f),className:"sticky top-0 z-10 flex w-full items-center gap-2 px-3 py-2 text-left bg-[var(--app-bg)] border-b border-[var(--app-divider)] transition-colors hover:bg-[var(--app-secondary-bg)]",children:[b.jsx(_de,{className:"h-4 w-4 text-[var(--app-hint)]",collapsed:f}),b.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[b.jsx("span",{className:"font-medium text-base break-words",title:h.directory,children:h.displayName}),b.jsxs("span",{className:"shrink-0 text-xs text-[var(--app-hint)]",children:["(",h.sessions.length,")"]})]})]}),f?null:b.jsx("div",{className:"flex flex-col divide-y divide-[var(--app-divider)] border-b border-[var(--app-divider)]",children:h.sessions.map(m=>b.jsx(kde,{session:m,onSelect:e.onSelect,showPath:!1,api:i,selected:m.id===s},m.id))})]},h.directory)})})]})}function Ede(e){const t=Fr(),n=Tr({mutationFn:async i=>{if(!e)throw new Error("API unavailable");return await e.spawnSession(i.machineId,i.directory,i.agent,i.model,i.yolo,i.sessionType,i.worktreeName)},onSuccess:()=>{t.invalidateQueries({queryKey:Vt.sessions})}});return{spawnSession:n.mutateAsync,isPending:n.isPending,error:n.error instanceof Error?n.error.message:n.error?"Failed to spawn session":null}}function z3(e){const t=Ws({queryKey:Vt.sessions,queryFn:async()=>{if(!e)throw new Error("API unavailable");return await e.getSessions()},enabled:!!e});return{sessions:t.data?.sessions??[],isLoading:t.isLoading,error:t.error instanceof Error?t.error.message:t.error?"Failed to load sessions":null,refetch:t.refetch}}function Rde(e,t,n){return P.useMemo(()=>{const i=e?t.filter(u=>u.metadata?.machineId===e):t,s=i.map(u=>u.metadata?.path).filter(u=>!!u),r=i.map(u=>u.metadata?.worktree?.basePath).filter(u=>!!u),a=[...new Set(n)],o=new Set(a),l=[...new Set([...s,...r])].filter(u=>!o.has(u)).sort((u,h)=>u.localeCompare(h));return[...a,...l]},[e,t,n])}const H3="codex:recentPaths",yL="codex:lastMachineId",Ade=5;function Mde(){try{const e=localStorage.getItem(H3);return e?JSON.parse(e):{}}catch{return{}}}function Lde(e){try{localStorage.setItem(H3,JSON.stringify(e))}catch{}}function Ide(){const[e,t]=P.useState(Mde),n=P.useCallback(a=>a?e[a]??[]:[],[e]),i=P.useCallback((a,o)=>{const l=o.trim();l&&t(u=>{const f=(u[a]??[]).filter(C=>C!==l),m=[l,...f].slice(0,Ade),g={...u,[a]:m};return Lde(g),g})},[]),s=P.useCallback(()=>{try{return localStorage.getItem(yL)}catch{return null}},[]),r=P.useCallback(a=>{try{localStorage.setItem(yL,a)}catch{}},[]);return P.useMemo(()=>({getRecentPaths:n,addRecentPath:i,getLastUsedMachineId:s,setLastUsedMachineId:r}),[n,i,s,r])}function Pde(e){const{t}=ot();return b.jsxs("div",{className:"flex gap-2 px-3 py-3",children:[b.jsx(Rn,{variant:"secondary",onClick:e.onCancel,disabled:e.isDisabled,children:t("button.cancel")}),b.jsx(Rn,{onClick:e.onCreate,disabled:!e.canCreate,"aria-busy":e.isPending,className:"gap-2",children:e.isPending?b.jsxs(b.Fragment,{children:[b.jsx(Ur,{size:"sm",label:null,className:"text-[var(--app-button-text)]"}),t("newSession.creating")]}):t("newSession.create")})]})}function Dde(e){const{t}=ot();return b.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[b.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.agent")}),b.jsx("div",{className:"flex gap-3",children:["codex"].map(n=>b.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[b.jsx("input",{type:"radio",name:"agent",value:n,checked:e.agent===n,onChange:()=>e.onAgentChange(n),disabled:e.isDisabled,className:"accent-[var(--app-link)]"}),b.jsx("span",{className:"text-sm capitalize",children:n})]},n))})]})}function Ode(e){const{t}=ot();return b.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[b.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.directory")}),b.jsxs("div",{className:"relative",children:[b.jsx("input",{type:"text",placeholder:t("newSession.placeholder"),value:e.directory,onChange:n=>e.onDirectoryChange(n.target.value),onKeyDown:e.onDirectoryKeyDown,onFocus:e.onDirectoryFocus,onBlur:e.onDirectoryBlur,disabled:e.isDisabled,className:"w-full rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-link)] disabled:opacity-50"}),e.suggestions.length>0&&b.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1",children:b.jsx(M0,{maxHeight:200,children:b.jsx(oN,{suggestions:e.suggestions,selectedIndex:e.selectedIndex,onSelect:e.onSuggestionSelect})})})]}),e.recentPaths.length>0&&b.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[b.jsxs("span",{className:"text-xs text-[var(--app-hint)]",children:[t("newSession.recent"),":"]}),b.jsx("div",{className:"flex flex-wrap gap-1",children:e.recentPaths.map(n=>b.jsx("button",{type:"button",onClick:()=>e.onPathClick(n),disabled:e.isDisabled,className:"rounded bg-[var(--app-subtle-bg)] px-2 py-1 text-xs text-[var(--app-fg)] hover:bg-[var(--app-secondary-bg)] transition-colors truncate max-w-[200px] disabled:opacity-50",title:n,children:n},n))})]})]})}function Nde(e){return e.metadata?.displayName?e.metadata.displayName:e.metadata?.host?e.metadata.host:e.id.slice(0,8)}function jde(e){const{t}=ot();return b.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[b.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.machine")}),b.jsxs("select",{value:e.machineId??"",onChange:n=>e.onChange(n.target.value),disabled:e.isDisabled,className:"w-full rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-link)] disabled:opacity-50",children:[e.isLoading&&b.jsx("option",{value:"",children:t("loading.machines")}),!e.isLoading&&e.machines.length===0&&b.jsx("option",{value:"",children:t("misc.noMachines")}),e.machines.map(n=>b.jsxs("option",{value:n.id,children:[Nde(n),n.metadata?.platform?` (${n.metadata.platform})`:""]},n.id))]})]})}const Bde={claude:[{value:"auto",label:"Auto"},{value:"opus",label:"Opus"},{value:"sonnet",label:"Sonnet"}],codex:[{value:"auto",label:"Auto"},{value:"gpt-5.2-codex",label:"GPT-5.2 Codex"},{value:"gpt-5.2",label:"GPT-5.2"},{value:"gpt-5.1-codex-max",label:"GPT-5.1 Codex Max"},{value:"gpt-5.1-codex-mini",label:"GPT-5.1 Codex Mini"}],gemini:[{value:"auto",label:"Auto"},{value:"gemini-3-pro-preview",label:"Gemini 3 Pro Preview"},{value:"gemini-2.5-pro",label:"Gemini 2.5 Pro"},{value:"gemini-2.5-flash",label:"Gemini 2.5 Flash"}],opencode:[]};function Fde(e){const{t}=ot(),n=Bde[e.agent];return n.length===0?null:b.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[b.jsxs("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:[t("newSession.model")," ",b.jsxs("span",{className:"font-normal",children:["(",t("newSession.model.optional"),")"]})]}),b.jsx("select",{value:e.model,onChange:i=>e.onModelChange(i.target.value),disabled:e.isDisabled,className:"w-full px-3 py-2 text-sm rounded-lg border border-[var(--app-divider)] bg-[var(--app-bg)] text-[var(--app-text)] focus:outline-none focus:ring-2 focus:ring-[var(--app-link)] disabled:opacity-50",children:n.map(i=>b.jsx("option",{value:i.value,children:i.label},i.value))})]})}const $3="codex:newSession:agent",q3="codex:newSession:yolo",Ude=["codex"];function zde(){try{const e=localStorage.getItem($3);if(e&&Ude.includes(e))return e}catch{}return"codex"}function Hde(e){try{localStorage.setItem($3,e)}catch{}}function $de(){try{return localStorage.getItem(q3)==="true"}catch{return!1}}function qde(e){try{localStorage.setItem(q3,e?"true":"false")}catch{}}function Vde(e){const{t}=ot();return b.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[b.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.yolo")}),b.jsxs("div",{className:"flex items-center justify-between gap-3",children:[b.jsxs("div",{className:"flex flex-col",children:[b.jsx("span",{className:"text-sm text-[var(--app-fg)]",children:t("newSession.yolo.title")}),b.jsx("span",{className:"text-xs text-[var(--app-hint)]",children:t("newSession.yolo.desc")})]}),b.jsxs("label",{className:"relative inline-flex h-5 w-9 items-center",children:[b.jsx("input",{type:"checkbox",checked:e.yoloMode,onChange:n=>e.onToggle(n.target.checked),disabled:e.isDisabled,className:"peer sr-only"}),b.jsx("span",{className:"absolute inset-0 rounded-full bg-[var(--app-border)] transition-colors peer-checked:bg-[var(--app-link)] peer-disabled:opacity-50"}),b.jsx("span",{className:"absolute left-0.5 h-4 w-4 rounded-full bg-[var(--app-bg)] transition-transform peer-checked:translate-x-4 peer-disabled:opacity-50"})]})]})]})}function Wde(e){const{haptic:t}=er(),{spawnSession:n,isPending:i,error:s}=Ede(e.api),{sessions:r}=z3(e.api),a=!!(i||e.isLoading),{getRecentPaths:o,addRecentPath:l,getLastUsedMachineId:u,setLastUsedMachineId:h}=Ide(),[f,m]=P.useState(null),[g,C]=P.useState(""),[S,v]=P.useState(!1),[_,w]=P.useState(!1),[x,k]=P.useState({}),[A,T]=P.useState(zde),[M,E]=P.useState("auto"),[L,D]=P.useState($de),[O,j]=P.useState(null);P.useEffect(()=>{E("auto")},[A]),P.useEffect(()=>{Hde(A)},[A]),P.useEffect(()=>{qde(L)},[L]),P.useEffect(()=>{if(e.machines.length===0||f&&e.machines.find(qe=>qe.id===f))return;const we=u(),Ee=we?e.machines.find(qe=>qe.id===we):null;if(Ee){m(Ee.id);const qe=o(Ee.id);qe[0]&&C(qe[0])}else e.machines[0]&&m(e.machines[0].id)},[e.machines,f,u,o]);const U=P.useMemo(()=>o(f),[o,f]),q=Rde(f,r,U),K=P.useMemo(()=>Array.from(new Set(q)).slice(0,1e3),[q]);P.useEffect(()=>{let we=!1;return!f||K.length===0?(k({}),()=>{we=!0}):(e.api.checkMachinePathsExists(f,K).then(Ee=>{we||k(Ee.exists??{})}).catch(()=>{we||k({})}),()=>{we=!0})},[f,K,e.api]);const $=P.useMemo(()=>q.filter(we=>x[we]),[q,x]),Y=P.useCallback(async we=>{const Ee=we.toLowerCase();return $.filter(qe=>qe.toLowerCase().includes(Ee)).slice(0,8).map(qe=>({key:qe,text:qe,label:qe}))},[$]),Q=!_||S?null:g,[F,N,z,G,H]=iN(Q,Y,{allowEmptyQuery:!0,autoSelectFirst:!1}),ee=P.useCallback(we=>{m(we);const Ee=o(we);Ee[0]?C(Ee[0]):C("")},[o]),ue=P.useCallback(we=>{C(we)},[]),ce=P.useCallback(we=>{const Ee=F[we];Ee&&(C(Ee.text),H(),v(!0))},[F,H]),J=P.useCallback(we=>{v(!1),C(we)},[]),V=P.useCallback(()=>{v(!1),w(!0)},[]),ne=P.useCallback(()=>{w(!1)},[]),he=P.useCallback(we=>{F.length!==0&&(we.key==="ArrowUp"&&(we.preventDefault(),z()),we.key==="ArrowDown"&&(we.preventDefault(),G()),(we.key==="Enter"||we.key==="Tab")&&N>=0&&(we.preventDefault(),ce(N)),we.key==="Escape"&&H())},[F,N,z,G,H,ce]);async function _e(){if(!(!f||!g.trim())){j(null);try{const we=M!=="auto"&&A!=="opencode"?M:void 0,Ee=await n({machineId:f,directory:g.trim(),agent:A,model:we,yolo:L});if(Ee.type==="success"){t.notification("success"),h(f),l(f,g.trim()),e.onSuccess(Ee.sessionId);return}t.notification("error"),j(Ee.message)}catch(we){t.notification("error"),j(we instanceof Error?we.message:"Failed to create session")}}}const Ce=!!(f&&g.trim()&&!a);return b.jsxs("div",{className:"flex flex-col divide-y divide-[var(--app-divider)]",children:[b.jsx(jde,{machines:e.machines,machineId:f,isLoading:e.isLoading,isDisabled:a,onChange:ee}),b.jsx(Ode,{directory:g,suggestions:F,selectedIndex:N,isDisabled:a,recentPaths:U,onDirectoryChange:J,onDirectoryFocus:V,onDirectoryBlur:ne,onDirectoryKeyDown:he,onSuggestionSelect:ce,onPathClick:ue}),b.jsx(Dde,{agent:A,isDisabled:a,onAgentChange:T}),b.jsx(Fde,{agent:A,model:M,isDisabled:a,onModelChange:E}),b.jsx(Vde,{yoloMode:L,isDisabled:a,onToggle:D}),O??s?b.jsx("div",{className:"px-3 py-2 text-sm text-red-600",children:O??s}):null,b.jsx(Pde,{isPending:i,canCreate:Ce,isDisabled:a,onCancel:e.onCancel,onCreate:_e})]})}const _L={sessionId:"unknown",messages:[],pending:[],pendingCount:0,hasMore:!1,oldestSeq:null,newestSeq:null,isLoading:!1,isLoadingMore:!1,warning:null,atBottom:!0,messagesVersion:0};function Gde(e,t){const n=P.useSyncExternalStore(P.useCallback(o=>t?QU(t,o):()=>{},[t]),P.useCallback(()=>t?E2(t):_L,[t]),()=>_L);P.useEffect(()=>{!e||!t||sd(e,t)},[e,t]),P.useEffect(()=>{if(t)return()=>{AS(t)}},[t]);const i=P.useCallback(async()=>{!e||!t||!n.hasMore||n.isLoadingMore||await XU(e,t)},[e,t,n.hasMore,n.isLoadingMore]),s=P.useCallback(async()=>{!e||!t||await sd(e,t)},[e,t]),r=P.useCallback(async()=>{if(!t)return;e8(t)&&e&&await sd(e,t)},[e,t]),a=P.useCallback(o=>{t&&t8(t,o)},[t]);return{messages:n.messages,warning:n.warning,isLoading:n.isLoading,isLoadingMore:n.isLoadingMore,hasMore:n.hasMore,pendingCount:n.pendingCount,messagesVersion:n.messagesVersion,loadMore:i,refetch:s,flushPending:r,setAtBottom:a}}function Kde(e,t){const n=Ws({queryKey:Vt.machines,queryFn:async()=>{if(!e)throw new Error("API unavailable");return await e.getMachines()},enabled:!!(e&&t)});return{machines:n.data?.machines??[],isLoading:n.isLoading,error:n.error instanceof Error?n.error.message:n.error?"Failed to load machines":null,refetch:n.refetch}}function gx(e,t){const n=t??"unknown",i=Ws({queryKey:Vt.session(n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");return await e.getSession(t)},enabled:!!(e&&t)});return{session:i.data?.session??null,isLoading:i.isLoading,error:i.error instanceof Error?i.error.message:i.error?"Failed to load session":null,refetch:i.refetch}}function Yde(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;const n=[];for(let i=0;i<=t.length;i++)n[i]=[i];for(let i=0;i<=e.length;i++)n[0][i]=i;for(let i=1;i<=t.length;i++)for(let s=1;s<=e.length;s++)n[i][s]=t[i-1]===e[s-1]?n[i-1][s-1]:Math.min(n[i-1][s-1]+1,n[i][s-1]+1,n[i-1][s]+1);return n[t.length][e.length]}const SL={claude:[{name:"clear",description:"Clear conversation history and free up context",source:"builtin"},{name:"compact",description:"Clear conversation history but keep a summary in context",source:"builtin"},{name:"context",description:"Visualize current context usage as a colored grid",source:"builtin"},{name:"cost",description:"Show the total cost and duration of the current session",source:"builtin"},{name:"doctor",description:"Diagnose and verify your Claude Code installation and settings",source:"builtin"},{name:"plan",description:"View or open the current session plan",source:"builtin"},{name:"stats",description:"Show your Claude Code usage statistics and activity",source:"builtin"},{name:"status",description:"Show Claude Code status including version, model, account, and API connectivity",source:"builtin"}],codex:[{name:"review",description:"Review current changes and find issues",source:"builtin"},{name:"new",description:"Start a new chat during a conversation",source:"builtin"},{name:"compat",description:"Summarize conversation to prevent hitting the context limit",source:"builtin"},{name:"undo",description:"Ask Codex to undo a turn",source:"builtin"},{name:"diff",description:"Show git diff including untracked files",source:"builtin"},{name:"status",description:"Show current session configuration and token usage",source:"builtin"}],gemini:[{name:"about",description:"Show version info",source:"builtin"},{name:"clear",description:"Clear the screen and conversation history",source:"builtin"},{name:"compress",description:"Compress the context by replacing it with a summary",source:"builtin"},{name:"stats",description:"Check session stats",source:"builtin"}],opencode:[]};function Qde(e,t,n="claude"){const i=t??"unknown",s=Ws({queryKey:Vt.slashCommands(i),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");return await e.getSlashCommands(t)},enabled:!!(e&&t),staleTime:1/0,gcTime:1800*1e3,retry:!1}),r=P.useMemo(()=>{const o=SL[n]??SL.claude??[];if(s.data?.success&&s.data.commands){const l=s.data.commands.filter(u=>u.source==="user"||u.source==="plugin");return[...o,...l]}return o},[n,s.data]),a=P.useCallback(async o=>{const l=o.startsWith("/")?o.slice(1).toLowerCase():o.toLowerCase();if(!l)return r.map(h=>({key:`/${h.name}`,text:`/${h.name}`,label:`/${h.name}`,description:h.description??(h.source==="user"?"Custom command":void 0),content:h.content,source:h.source}));const u=Math.max(2,Math.floor(l.length/2));return r.map(h=>{const f=h.name.toLowerCase();let m;if(f===l)m=0;else if(f.startsWith(l))m=1;else if(f.includes(l))m=2;else{const g=Yde(l,f);m=g<=u?3+g:1/0}return{cmd:h,score:m}}).filter(h=>h.score<1/0).sort((h,f)=>h.score-f.score).map(({cmd:h})=>({key:`/${h.name}`,text:`/${h.name}`,label:`/${h.name}`,description:h.description??(h.source==="user"?"Custom command":void 0),content:h.content,source:h.source}))},[r]);return{commands:r,isLoading:s.isLoading,error:s.error instanceof Error?s.error.message:s.error?"Failed to load commands":null,getSuggestions:a}}function Jde(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;const n=[];for(let i=0;i<=t.length;i++)n[i]=[i];for(let i=0;i<=e.length;i++)n[0][i]=i;for(let i=1;i<=t.length;i++)for(let s=1;s<=e.length;s++)n[i][s]=t[i-1]===e[s-1]?n[i-1][s-1]:Math.min(n[i-1][s-1]+1,n[i][s-1]+1,n[i-1][s]+1);return n[t.length][e.length]}function Xde(e,t){const n=t??"unknown",i=Ws({queryKey:Vt.skills(n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");return await e.getSkills(t)},enabled:!!(e&&t),staleTime:1/0,gcTime:1800*1e3,retry:!1}),s=P.useMemo(()=>i.data?.success&&i.data.skills?i.data.skills:[],[i.data]),r=P.useCallback(async a=>{const o=rN(),l=f=>o[f]??0,u=a.startsWith("$")?a.slice(1).toLowerCase():a.toLowerCase();if(!u)return[...s].sort((f,m)=>l(m.name)-l(f.name)||f.name.localeCompare(m.name)).map(f=>({key:`$${f.name}`,text:`$${f.name}`,label:`$${f.name}`,description:f.description,source:"builtin"}));const h=Math.max(2,Math.floor(u.length/2));return s.map(f=>{const m=f.name.toLowerCase();let g;if(m===u)g=0;else if(m.startsWith(u))g=1;else if(m.includes(u))g=2;else{const C=Jde(u,m);g=C<=h?3+C:1/0}return{skill:f,score:g,recency:l(f.name)}}).filter(f=>f.score<1/0).sort((f,m)=>f.score-m.score||m.recency-f.recency||f.skill.name.localeCompare(m.skill.name)).map(({skill:f})=>({key:`$${f.name}`,text:`$${f.name}`,label:`$${f.name}`,description:f.description,source:"builtin"}))},[s]);return{skills:s,isLoading:i.isLoading,error:i.error instanceof Error?i.error.message:i.error?"Failed to load skills":null,getSuggestions:r}}function Zde(e,t){const n=E2(e);for(const i of n.messages)if(i.localId===t)return i;for(const i of n.pending)if(i.localId===t)return i;return null}function ehe(e,t,n){const{haptic:i}=er(),[s,r]=P.useState(!1),a=P.useRef(!1),o=Tr({mutationFn:async h=>{if(!e)throw new Error("API unavailable");await e.sendMessage(h.sessionId,h.text,h.localId,h.attachments)},onMutate:async h=>{const f={id:h.localId,seq:null,localId:h.localId,content:{role:"user",content:{type:"text",text:h.text,attachments:h.attachments}},createdAt:h.createdAt,status:"sending",originalText:h.text};n8(h.sessionId,f)},onSuccess:(h,f)=>{iy(f.sessionId,f.localId,"sent"),i.notification("success")},onError:(h,f)=>{iy(f.sessionId,f.localId,"failed"),i.notification("error")}});return{sendMessage:(h,f)=>{if(!e){n?.onBlocked?.("no-api"),i.notification("error");return}if(!t){n?.onBlocked?.("no-session"),i.notification("error");return}if(o.isPending||a.current){n?.onBlocked?.("pending");return}const m=zU("local"),g=Date.now();(async()=>{let C=t;if(n?.resolveSessionId){a.current=!0,r(!0);try{const S=await n.resolveSessionId(t);S&&S!==t&&(n.onSessionResolved?.(S),C=S)}catch(S){i.notification("error"),console.error("Failed to resolve session before send:",S);return}finally{a.current=!1,r(!1)}}o.mutate({sessionId:C,text:h,localId:m,createdAt:g,attachments:f})})()},retryMessage:h=>{if(!e){n?.onBlocked?.("no-api"),i.notification("error");return}if(!t){n?.onBlocked?.("no-session"),i.notification("error");return}if(o.isPending||a.current){n?.onBlocked?.("pending");return}const f=Zde(t,h);f?.originalText&&(iy(t,h,"sending"),o.mutate({sessionId:t,text:f.originalText,localId:h,createdAt:f.createdAt}))},isSending:o.isPending||s}}function the(e,t,n,i){const s=t??"unknown",r=!!(e&&t)&&(i?.enabled??!0),a=Ws({queryKey:Vt.sessionDirectory(s,n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");const l=await e.listSessionDirectory(t,n);return l.success?{entries:l.entries??[],error:null}:{entries:[],error:l.error??"Failed to list directory"}},enabled:r}),o=a.error instanceof Error?a.error.message:a.error?"Failed to list directory":null;return{entries:a.data?.entries??[],error:o??a.data?.error??null,isLoading:a.isLoading,refetch:a.refetch}}function nhe(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`${e.className??""} transition-transform duration-200 ${e.collapsed?"":"rotate-90"}`,children:b.jsx("polyline",{points:"9 18 15 12 9 6"})})}function ihe(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:b.jsx("path",{d:"M3 7a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"})})}function she(e){const t=e.rows??4,n=12+e.depth*14;return b.jsx("div",{className:"animate-pulse",children:Array.from({length:t}).map((i,s)=>b.jsxs("div",{className:"flex items-center gap-3 px-3 py-2",style:{paddingLeft:n},children:[b.jsx("div",{className:"h-5 w-5 rounded bg-[var(--app-subtle-bg)]"}),b.jsx("div",{className:"h-3 w-40 rounded bg-[var(--app-subtle-bg)]"})]},`dir-skel-${e.depth}-${s}`))})}function rhe(e){const t=12+e.depth*14;return b.jsx("div",{className:"px-3 py-2 text-xs text-[var(--app-hint)] bg-amber-500/10",style:{paddingLeft:t},children:e.message})}function V3(e){const t=e.expanded.has(e.path),{entries:n,error:i,isLoading:s}=the(e.api,e.sessionId,e.path,{enabled:t}),r=P.useMemo(()=>n.filter(h=>h.type==="directory"),[n]),a=P.useMemo(()=>n.filter(h=>h.type==="file"),[n]),o=e.depth+1,l=12+e.depth*14,u=12+o*14;return b.jsxs("div",{children:[b.jsxs("button",{type:"button",onClick:()=>e.onToggle(e.path),className:"flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-[var(--app-subtle-bg)] transition-colors",style:{paddingLeft:l},children:[b.jsx(nhe,{collapsed:!t,className:"text-[var(--app-hint)]"}),b.jsx(ihe,{className:"text-[var(--app-link)]"}),b.jsx("div",{className:"min-w-0 flex-1",children:b.jsx("div",{className:"truncate font-medium",children:e.label})})]}),t?s?b.jsx(she,{depth:o}):i?b.jsx(rhe,{depth:o,message:i}):b.jsxs("div",{children:[r.map(h=>{const f=e.path?`${e.path}/${h.name}`:h.name;return b.jsx(V3,{api:e.api,sessionId:e.sessionId,path:f,label:h.name,depth:o,onOpenFile:e.onOpenFile,expanded:e.expanded,onToggle:e.onToggle},f)}),a.map(h=>{const f=e.path?`${e.path}/${h.name}`:h.name;return b.jsxs("button",{type:"button",onClick:()=>e.onOpenFile(f),className:"flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-[var(--app-subtle-bg)] transition-colors",style:{paddingLeft:u},children:[b.jsx("span",{className:"h-4 w-4"}),b.jsx(ph,{fileName:h.name,size:22}),b.jsx("div",{className:"min-w-0 flex-1",children:b.jsx("div",{className:"truncate font-medium",children:h.name})})]},f)}),r.length===0&&a.length===0?b.jsx("div",{className:"px-3 py-2 text-sm text-[var(--app-hint)]",style:{paddingLeft:u},children:"Empty directory."}):null]}):null]})}function ohe(e){const[t,n]=P.useState(()=>new Set([""])),i=P.useCallback(s=>{n(r=>{const a=new Set(r);return a.has(s)?a.delete(s):a.add(s),a})},[]);return b.jsx("div",{className:"border-t border-[var(--app-divider)]",children:b.jsx(V3,{api:e.api,sessionId:e.sessionId,path:"",label:e.rootLabel,depth:0,onOpenFile:e.onOpenFile,expanded:t,onToggle:i})})}const ahe=/^# branch\.oid (.+)$/,lhe=/^# branch\.head (.+)$/,che=/^# branch\.upstream (.+)$/,uhe=/^# branch\.ab \+(\d+) -(\d+)$/,dhe=/^1 (.)(.) (.{4}) (\d{6}) (\d{6}) (\d{6}) ([0-9a-f]+) ([0-9a-f]+) (.+)$/,hhe=/^2 (.)(.) (.{4}) (\d{6}) (\d{6}) (\d{6}) ([0-9a-f]+) ([0-9a-f]+) ([RC])(\d{1,3}) (.+)\t(.+)$/,fhe=/^u (.)(.) (.{4}) (\d{6}) (\d{6}) (\d{6}) (\d{6}) ([0-9a-f]+) ([0-9a-f]+) ([0-9a-f]+) (.+)$/,phe=/^\? (.+)$/,mhe=/^! (.+)$/,ghe=/^(\d+|-)\t(\d+|-)\t(.*)$/;function vhe(e){const t=e.trim().split(`
`).filter(i=>i.length>0),n={files:[],notAdded:[],ignored:[],branch:{}};for(const i of t){if(i.startsWith("# branch.oid ")){const s=ahe.exec(i);s&&(n.branch.oid=s[1]);continue}if(i.startsWith("# branch.head ")){const s=lhe.exec(i);s&&(n.branch.head=s[1]);continue}if(i.startsWith("# branch.upstream ")){const s=che.exec(i);s&&(n.branch.upstream=s[1]);continue}if(i.startsWith("# branch.ab ")){const s=uhe.exec(i);s&&(n.branch.ahead=parseInt(s[1],10),n.branch.behind=parseInt(s[2],10));continue}if(i.startsWith("1 ")){const s=dhe.exec(i);if(s){const r=_he(s);r&&n.files.push(r)}continue}if(i.startsWith("2 ")){const s=hhe.exec(i);if(s){const r=She(s);r&&n.files.push(r)}continue}if(i.startsWith("u ")){const s=fhe.exec(i);if(s){const r=Che(s);r&&n.files.push(r)}continue}if(i.startsWith("? ")){const s=phe.exec(i);s&&n.notAdded.push(s[1]);continue}if(i.startsWith("! ")){const s=mhe.exec(i);s&&n.ignored.push(s[1])}}return n}function CL(e){const t=e.trim().split(`
`).filter(i=>i.length>0),n={files:[],insertions:0,deletions:0,changes:0,changed:0};for(const i of t){const s=ghe.exec(i);if(!s)continue;const r=s[1],a=s[2],o=s[3],l=r==="-"||a==="-",u=l?0:parseInt(r,10),h=l?0:parseInt(a,10),f=u+h;n.files.push({file:o,changes:f,insertions:u,deletions:h,binary:l}),n.insertions+=u,n.deletions+=h,n.changes+=f,n.changed+=1}return n}function xL(e){const t={};for(const n of e.files){const i=xhe(n.file),s={added:n.insertions,removed:n.deletions,binary:n.binary};t[n.file]=s,i.newPath&&i.newPath!==n.file&&(t[i.newPath]=s),i.oldPath&&i.oldPath!==n.file&&i.oldPath!==i.newPath&&(t[i.oldPath]=s)}return t}function bhe(e){const t=e.branch.head;return!t||t==="(detached)"||t==="(initial)"?null:t}function yhe(e,t,n){const i=vhe(e),s=bhe(i),r=CL(t),a=CL(n),o=xL(r),l=xL(a),u=[],h=[];for(const f of i.files){const m=f.path.split("/"),g=m[m.length-1]||f.path,C=m.slice(0,-1).join("/");if(f.index!==" "&&f.index!=="."&&f.index!=="?"){const S=wL(f.index),v=l[f.path]??{added:0,removed:0};u.push({fileName:g,filePath:C,fullPath:f.path,status:S,isStaged:!0,linesAdded:v.added,linesRemoved:v.removed,oldPath:f.from})}if(f.workingDir!==" "&&f.workingDir!=="."){const S=wL(f.workingDir),v=o[f.path]??{added:0,removed:0};h.push({fileName:g,filePath:C,fullPath:f.path,status:S,isStaged:!1,linesAdded:v.added,linesRemoved:v.removed,oldPath:f.from})}}for(const f of i.notAdded){const m=f.endsWith("/")?f.slice(0,-1):f,g=m.split("/"),C=g[g.length-1]||m,S=g.slice(0,-1).join("/");f.endsWith("/")||h.push({fileName:C,filePath:S,fullPath:m,status:"untracked",isStaged:!1,linesAdded:0,linesRemoved:0})}return{stagedFiles:u,unstagedFiles:h,branch:s,totalStaged:u.length,totalUnstaged:h.length}}function _he(e){return!e[1]||!e[2]||!e[9]?null:{index:e[1],workingDir:e[2],path:e[9]}}function She(e){return!e[1]||!e[2]||!e[11]||!e[12]?null:{index:e[1],workingDir:e[2],from:e[11],path:e[12]}}function Che(e){return!e[1]||!e[2]||!e[11]?null:{index:e[1],workingDir:e[2],path:e[11]}}function wL(e){switch(e){case"M":return"modified";case"A":return"added";case"D":return"deleted";case"R":case"C":return"renamed";case"?":return"untracked";case"U":return"conflicted";default:return"modified"}}function xhe(e){const t=e.trim();if(t.includes("{")&&t.includes("=>")&&t.includes("}")){const n=t.replace(/\{([^{}]+?)\s*=>\s*([^{}]+?)\}/g,(s,r,a)=>a.trim()),i=t.replace(/\{([^{}]+?)\s*=>\s*([^{}]+?)\}/g,(s,r)=>r.trim());return{newPath:n,oldPath:i}}if(t.includes("=>")){const n=t.split(/\s*=>\s*/),i=n[0]?.trim(),s=n[n.length-1]?.trim();if(s)return{newPath:s,oldPath:i}}return{newPath:t}}function whe(e,t){const n=t??"unknown",i=Ws({queryKey:Vt.gitStatus(n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");const r=await e.getGitStatus(t);if(!r.success)return{status:null,error:r.error??r.stderr??"Git status unavailable"};const[a,o]=await Promise.all([e.getGitDiffNumstat(t,!1),e.getGitDiffNumstat(t,!0)]),l=yhe(r.stdout??"",a.success?a.stdout??"":"",o.success?o.stdout??"":""),u=[];return a.success||u.push(`Unstaged diff unavailable: ${a.error??a.stderr??"unknown error"}`),o.success||u.push(`Staged diff unavailable: ${o.error??o.stderr??"unknown error"}`),{status:l,error:u.length?u.join(" "):null}},enabled:!!(e&&t)}),s=i.error instanceof Error?i.error.message:i.error?"Git status unavailable":null;return{status:i.data?.status??null,error:s??i.data?.error??null,isLoading:i.isLoading,refetch:i.refetch}}function khe(e,t,n,i){const s=t??"unknown",r=i?.limit??200,a=i?.enabled??!!(e&&t),o=Ws({queryKey:Vt.sessionFiles(s,n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");const u=await e.searchSessionFiles(t,n,r);return u.success?{files:u.files??[],error:null}:{files:[],error:u.error??"Failed to search files"}},enabled:a}),l=o.error instanceof Error?o.error.message:o.error?"Failed to search files":null;return{files:o.data?.files??[],error:l??o.data?.error??null,isLoading:o.isLoading,refetch:o.refetch}}function The(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:b.jsx("polyline",{points:"15 18 9 12 15 6"})})}function Ehe(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("path",{d:"M21 12a9 9 0 1 1-3-6.7"}),b.jsx("polyline",{points:"21 3 21 9 15 9"})]})}function Rhe(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("circle",{cx:"11",cy:"11",r:"8"}),b.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}function Ahe(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("line",{x1:"6",y1:"3",x2:"6",y2:"15"}),b.jsx("circle",{cx:"6",cy:"18",r:"3"}),b.jsx("circle",{cx:"18",cy:"6",r:"3"}),b.jsx("path",{d:"M18 9a9 9 0 0 1-9 9"})]})}function Mhe(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:b.jsx("path",{d:"M3 7a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"})})}function Lhe(e){const{label:t,color:n}=P.useMemo(()=>{switch(e.status){case"added":return{label:"A",color:"var(--app-git-staged-color)"};case"deleted":return{label:"D",color:"var(--app-git-deleted-color)"};case"renamed":return{label:"R",color:"var(--app-git-renamed-color)"};case"untracked":return{label:"?",color:"var(--app-git-untracked-color)"};case"conflicted":return{label:"U",color:"var(--app-git-deleted-color)"};default:return{label:"M",color:"var(--app-git-unstaged-color)"}}},[e.status]);return b.jsx("span",{className:"inline-flex items-center justify-center rounded border px-1.5 py-0.5 text-[10px] font-semibold",style:{color:n,borderColor:n},children:t})}function Ihe(e){return!e.added&&!e.removed?null:b.jsxs("span",{className:"flex items-center gap-1 text-[11px] font-mono",children:[e.added?b.jsxs("span",{className:"text-[var(--app-diff-added-text)]",children:["+",e.added]}):null,e.removed?b.jsxs("span",{className:"text-[var(--app-diff-removed-text)]",children:["-",e.removed]}):null]})}function kL(e){const t=e.file.filePath||"project root";return b.jsxs("button",{type:"button",onClick:e.onOpen,className:`flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-[var(--app-subtle-bg)] transition-colors ${e.showDivider?"border-b border-[var(--app-divider)]":""}`,children:[b.jsx(ph,{fileName:e.file.fileName,size:22}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"truncate font-medium",children:e.file.fileName}),b.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:t})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(Ihe,{added:e.file.linesAdded,removed:e.file.linesRemoved}),b.jsx(Lhe,{status:e.file.status})]})]})}function Phe(e){const t=e.file.filePath||"project root",n=e.file.fileType==="file"?b.jsx(ph,{fileName:e.file.fileName,size:22}):b.jsx(Mhe,{className:"text-[var(--app-link)]"});return b.jsxs("button",{type:"button",onClick:e.onOpen,className:`flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-[var(--app-subtle-bg)] transition-colors ${e.showDivider?"border-b border-[var(--app-divider)]":""}`,children:[n,b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"truncate font-medium",children:e.file.fileName}),b.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:t})]})]})}function TL(e){const t=["w-1/3","w-1/2","w-2/3","w-2/5","w-3/5"],n=["w-1/2","w-2/3","w-3/4","w-1/3"],i=e.rows??6;return b.jsxs("div",{className:"p-3 animate-pulse space-y-3",role:"status","aria-live":"polite",children:[b.jsx("span",{className:"sr-only",children:e.label}),Array.from({length:i}).map((s,r)=>b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("div",{className:"h-6 w-6 rounded bg-[var(--app-subtle-bg)]"}),b.jsxs("div",{className:"flex-1 space-y-2",children:[b.jsx("div",{className:`h-3 ${t[r%t.length]} rounded bg-[var(--app-subtle-bg)]`}),b.jsx("div",{className:`h-2 ${n[r%n.length]} rounded bg-[var(--app-subtle-bg)]`})]})]},`skeleton-row-${r}`))]})}function Dhe(){const{api:e}=Pc(),t=Ts(),n=Fr(),i=Ka(),{sessionId:s}=jo({from:"/sessions/$sessionId/files"}),r=eh({from:"/sessions/$sessionId/files"}),{session:a}=gx(e,s),[o,l]=P.useState(""),u=r.tab==="directories"?"directories":"changes",[h,f]=P.useState(u),{status:m,error:g,isLoading:C,refetch:S}=whe(e,s),v=!!o,_=khe(e,s,o,{enabled:v}),w=P.useCallback((L,D)=>{const O=D===void 0?h==="directories"?{path:zf(L),tab:"directories"}:{path:zf(L)}:h==="directories"?{path:zf(L),staged:D,tab:"directories"}:{path:zf(L),staged:D};t({to:"/sessions/$sessionId/file",params:{sessionId:s},search:O})},[h,t,s]),x=m?.branch??"detached",k=a?.metadata?.path??s,A=!!g,T=P.useMemo(()=>{const L=a?.metadata?.path??s,D=L.split(/[/\\]/).filter(Boolean);return D.length?D[D.length-1]:L},[a?.metadata?.path,s]),M=P.useCallback(()=>{if(o){n.invalidateQueries({queryKey:Vt.sessionFiles(s,o)});return}if(h==="directories"){n.invalidateQueries({queryKey:["session-directory",s]});return}S()},[h,n,S,o,s]),E=P.useCallback(L=>{f(L),t({to:"/sessions/$sessionId/files",params:{sessionId:s},search:L==="changes"?{}:{tab:L},replace:!0})},[t,s]);return b.jsxs("div",{className:"flex h-full flex-col",children:[b.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3 border-b border-[var(--app-border)]",children:[b.jsx("button",{type:"button",onClick:i,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:b.jsx(The,{})}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"truncate font-semibold",children:"Files"}),b.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:k})]}),b.jsx("button",{type:"button",onClick:M,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",title:"Refresh",children:b.jsx(Ehe,{})})]})}),b.jsx("div",{className:"bg-[var(--app-bg)]",children:b.jsx("div",{className:"mx-auto w-full max-w-content p-3 border-b border-[var(--app-border)]",children:b.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-[var(--app-subtle-bg)] px-3 py-2",children:[b.jsx(Rhe,{className:"text-[var(--app-hint)]"}),b.jsx("input",{value:o,onChange:L=>l(L.target.value),placeholder:"Search files",className:"w-full bg-transparent text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none",autoCapitalize:"none",autoCorrect:"off"})]})})}),b.jsx("div",{className:"bg-[var(--app-bg)] border-b border-[var(--app-divider)]",role:"tablist",children:b.jsxs("div",{className:"mx-auto w-full max-w-content grid grid-cols-2",children:[b.jsxs("button",{type:"button",role:"tab","aria-selected":h==="changes",onClick:()=>E("changes"),className:`relative py-3 text-center text-sm font-semibold transition-colors hover:bg-[var(--app-subtle-bg)] ${h==="changes"?"text-[var(--app-fg)]":"text-[var(--app-hint)]"}`,children:["Changes",b.jsx("span",{className:`absolute bottom-0 left-1/2 h-0.5 w-10 -translate-x-1/2 rounded-full ${h==="changes"?"bg-[var(--app-link)]":"bg-transparent"}`})]}),b.jsxs("button",{type:"button",role:"tab","aria-selected":h==="directories",onClick:()=>E("directories"),className:`relative py-3 text-center text-sm font-semibold transition-colors hover:bg-[var(--app-subtle-bg)] ${h==="directories"?"text-[var(--app-fg)]":"text-[var(--app-hint)]"}`,children:["Directories",b.jsx("span",{className:`absolute bottom-0 left-1/2 h-0.5 w-10 -translate-x-1/2 rounded-full ${h==="directories"?"bg-[var(--app-link)]":"bg-transparent"}`})]})]})}),!C&&m&&!o&&h==="changes"?b.jsx("div",{className:"bg-[var(--app-bg)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content px-3 py-2 border-b border-[var(--app-divider)]",children:[b.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[b.jsx(Ahe,{className:"text-[var(--app-hint)]"}),b.jsx("span",{className:"font-semibold",children:x})]}),b.jsxs("div",{className:"text-xs text-[var(--app-hint)]",children:[m.totalStaged," staged, ",m.totalUnstaged," unstaged"]})]})}):null,b.jsx("div",{className:"flex-1 overflow-y-auto",children:b.jsxs("div",{className:"mx-auto w-full max-w-content",children:[A&&h==="changes"?b.jsx("div",{className:"border-b border-[var(--app-divider)] bg-amber-500/10 px-3 py-2 text-xs text-[var(--app-hint)]",children:g}):null,v?_.isLoading?b.jsx(TL,{label:"Loading files"}):_.error?b.jsx("div",{className:"p-6 text-sm text-[var(--app-hint)]",children:_.error}):_.files.length===0?b.jsx("div",{className:"p-6 text-sm text-[var(--app-hint)]",children:o?"No files match your search.":"No files found in this project."}):b.jsx("div",{className:"border-t border-[var(--app-divider)]",children:_.files.map((L,D)=>b.jsx(Phe,{file:L,onOpen:()=>w(L.fullPath),showDivider:D<_.files.length-1},`${L.fullPath}-${D}`))}):h==="directories"?b.jsx(ohe,{api:e,sessionId:s,rootLabel:T,onOpenFile:L=>w(L)}):C?b.jsx(TL,{label:"Loading Git status"}):b.jsxs("div",{children:[m?.stagedFiles.length?b.jsxs("div",{children:[b.jsxs("div",{className:"border-b border-[var(--app-divider)] bg-[var(--app-bg)] px-3 py-2 text-xs font-semibold text-[var(--app-git-staged-color)]",children:["Staged Changes (",m.stagedFiles.length,")"]}),m.stagedFiles.map((L,D)=>b.jsx(kL,{file:L,onOpen:()=>w(L.fullPath,L.isStaged),showDivider:D<m.stagedFiles.length-1||m.unstagedFiles.length>0},`staged-${L.fullPath}-${D}`))]}):null,m?.unstagedFiles.length?b.jsxs("div",{children:[b.jsxs("div",{className:"border-b border-[var(--app-divider)] bg-[var(--app-bg)] px-3 py-2 text-xs font-semibold text-[var(--app-git-unstaged-color)]",children:["Unstaged Changes (",m.unstagedFiles.length,")"]}),m.unstagedFiles.map((L,D)=>b.jsx(kL,{file:L,onOpen:()=>w(L.fullPath,L.isStaged),showDivider:D<m.unstagedFiles.length-1},`unstaged-${L.fullPath}-${D}`))]}):null,m?null:b.jsx("div",{className:"p-6 text-sm text-[var(--app-hint)]",children:"Git status unavailable. Use Directories to browse all files, or search."}),m&&m.stagedFiles.length===0&&m.unstagedFiles.length===0?b.jsx("div",{className:"p-6 text-sm text-[var(--app-hint)]",children:"No changes detected. Use Directories to browse all files, or search."}):null]})]})})]})}const Ohe=1e6;function Nhe(e){if(!e)return"";const t=oD(e);return t.ok?t.text:e}function jhe(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:b.jsx("polyline",{points:"15 18 9 12 15 6"})})}function Bhe(e){const t=e.diffContent.split(`
`);return b.jsx("div",{className:"overflow-hidden rounded-md border border-[var(--app-border)] bg-[var(--app-bg)]",children:t.map((n,i)=>{const s=n.startsWith("+")&&!n.startsWith("+++"),r=n.startsWith("-")&&!n.startsWith("---"),a=n.startsWith("@@"),o=n.startsWith("+++")||n.startsWith("---"),l=["whitespace-pre-wrap px-3 py-0.5 text-xs font-mono",s?"bg-[var(--app-diff-added-bg)] text-[var(--app-diff-added-text)]":"",r?"bg-[var(--app-diff-removed-bg)] text-[var(--app-diff-removed-text)]":"",a?"bg-[var(--app-subtle-bg)] text-[var(--app-hint)] font-semibold":"",o?"text-[var(--app-hint)] font-semibold":""].filter(Boolean).join(" "),u=s?{borderLeft:"2px solid var(--app-git-staged-color)"}:r?{borderLeft:"2px solid var(--app-git-deleted-color)"}:void 0;return b.jsx("div",{className:l,style:u,children:n||" "},`${i}-${n}`)})})}function Fhe(){const e=["w-full","w-11/12","w-5/6","w-3/4","w-2/3","w-4/5"];return b.jsxs("div",{role:"status","aria-live":"polite",children:[b.jsx("span",{className:"sr-only",children:"Loading file"}),b.jsx("div",{className:"animate-pulse space-y-2 rounded-md border border-[var(--app-border)] bg-[var(--app-code-bg)] p-3",children:Array.from({length:12}).map((t,n)=>b.jsx("div",{className:`h-3 ${e[n%e.length]} rounded bg-[var(--app-subtle-bg)]`},`file-skeleton-${n}`))})]})}function Uhe(e){const t=e.split(".");if(t.length<=1)return;const n=t[t.length-1]?.toLowerCase();if(n)return b3[n]??n}function zhe(e){return new TextEncoder().encode(e).length}function Hhe(e){return e?e.includes("\0")?!0:e.split("").filter(n=>{const i=n.charCodeAt(0);return i<32&&i!==9&&i!==10&&i!==13}).length/e.length>.1:!1}function $he(e){return!e||e.success?null:e.error??e.stderr??"Failed to load diff"}function qhe(){const{api:e}=Pc(),{copied:t,copy:n}=jm(),{copied:i,copy:s}=jm(),r=Ka(),{sessionId:a}=jo({from:"/sessions/$sessionId/file"}),o=eh({from:"/sessions/$sessionId/file"}),l=typeof o.path=="string"?o.path:"",u=o.staged,h=P.useMemo(()=>Nhe(l),[l]),f=h.split("/").pop()||h||"File",m=Ws({queryKey:Vt.gitFileDiff(a,h,u),queryFn:async()=>{if(!e||!a||!h)throw new Error("Missing session or path");return await e.getGitDiffFile(a,h,u)},enabled:!!(e&&a&&h)}),g=Ws({queryKey:Vt.sessionFile(a,h),queryFn:async()=>{if(!e||!a||!h)throw new Error("Missing session or path");return await e.readSessionFile(a,h)},enabled:!!(e&&a&&h)}),C=m.data?.success?m.data.stdout??"":"",S=$he(m.data),v=m.data?.success===!0,_=m.data?.success===!1,w=g.data,x=w?.success&&w.content?oD(w.content):{text:"",ok:!0},k=x.text,A=w?.success?!x.ok||Hhe(k):!1,T=P.useMemo(()=>Uhe(h),[h]),M=ax(k,T),E=P.useMemo(()=>k?zhe(k):0,[k]),L=w?.success===!0&&!A&&k.length>0&&E<=Ohe,[D,O]=P.useState("diff");P.useEffect(()=>{if(v&&!C){O("file");return}_&&O("file")},[v,_,C]);const j=m.isLoading||g.isLoading,U=w&&!w.success?w.error??"Failed to read file":null,q=!h,K=S?`Diff unavailable: ${S}`:null;return b.jsxs("div",{className:"flex h-full flex-col",children:[b.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3 border-b border-[var(--app-border)]",children:[b.jsx("button",{type:"button",onClick:r,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:b.jsx(jhe,{})}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"truncate font-semibold",children:f}),b.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:h||"Unknown path"})]})]})}),b.jsx("div",{className:"bg-[var(--app-bg)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content px-3 py-2 flex items-center gap-2 border-b border-[var(--app-divider)]",children:[b.jsx(ph,{fileName:f,size:20}),b.jsx("span",{className:"min-w-0 flex-1 truncate text-xs text-[var(--app-hint)]",children:h}),b.jsx("button",{type:"button",onClick:()=>n(h),className:"shrink-0 rounded p-1 text-[var(--app-hint)] hover:bg-[var(--app-subtle-bg)] hover:text-[var(--app-fg)] transition-colors",title:"Copy path",children:t?b.jsx(pm,{className:"h-3.5 w-3.5"}):b.jsx(fm,{className:"h-3.5 w-3.5"})})]})}),C?b.jsx("div",{className:"bg-[var(--app-bg)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content px-3 py-2 flex items-center gap-2 border-b border-[var(--app-divider)]",children:[b.jsx("button",{type:"button",onClick:()=>O("diff"),className:`rounded px-3 py-1 text-xs font-semibold ${D==="diff"?"bg-[var(--app-button)] text-[var(--app-button-text)] opacity-80":"bg-[var(--app-subtle-bg)] text-[var(--app-hint)]"}`,children:"Diff"}),b.jsx("button",{type:"button",onClick:()=>O("file"),className:`rounded px-3 py-1 text-xs font-semibold ${D==="file"?"bg-[var(--app-button)] text-[var(--app-button-text)] opacity-80":"bg-[var(--app-subtle-bg)] text-[var(--app-hint)]"}`,children:"File"})]})}):null,b.jsx("div",{className:"flex-1 overflow-y-auto",children:b.jsxs("div",{className:"mx-auto w-full max-w-content p-4",children:[K?b.jsx("div",{className:"mb-3 rounded-md bg-amber-500/10 p-2 text-xs text-[var(--app-hint)]",children:K}):null,q?b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"No file path provided."}):j?b.jsx(Fhe,{}):U?b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:U}):A?b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"This looks like a binary file. It cannot be displayed."}):D==="diff"&&C?b.jsx(Bhe,{diffContent:C}):D==="diff"&&S?b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:S}):D==="file"?k?b.jsxs("div",{className:"relative",children:[L?b.jsx("button",{type:"button",onClick:()=>s(k),className:"absolute right-2 top-2 z-10 rounded p-1 text-[var(--app-hint)] hover:bg-[var(--app-subtle-bg)] hover:text-[var(--app-fg)] transition-colors",title:"Copy file content",children:i?b.jsx(pm,{className:"h-3.5 w-3.5"}):b.jsx(fm,{className:"h-3.5 w-3.5"})}):null,b.jsx("pre",{className:"shiki overflow-auto rounded-md bg-[var(--app-code-bg)] p-3 pr-8 text-xs font-mono",children:b.jsx("code",{children:M??k})})]}):b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"File is empty."}):b.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"No changes to display."})]})})]})}function Vhe(e,t,n,i){const s=new URL(e);return s.protocol=s.protocol==="https:"?"wss:":"ws:",s.pathname=`/ws/terminal/${encodeURIComponent(n)}/${encodeURIComponent(i)}`,s.search=new URLSearchParams({token:t}).toString(),s.toString()}function cp(e,t){if(e.readyState===WebSocket.OPEN)try{e.send(JSON.stringify(t))}catch{}}function Whe(e){const[t,n]=P.useState({status:"idle"}),i=P.useRef(null),s=P.useRef(()=>{}),r=P.useRef(()=>{}),a=P.useRef(e.sessionId),o=P.useRef(e.terminalId),l=P.useRef(e.token),u=P.useRef(e.baseUrl),h=P.useRef(null),f=P.useRef(!1);P.useEffect(()=>{a.current=e.sessionId,o.current=e.terminalId,u.current=e.baseUrl},[e.sessionId,e.terminalId,e.baseUrl]),P.useEffect(()=>{l.current=e.token,e.token||(i.current?.close(),i.current=null,n({status:"idle"}))},[e.token]);const m=P.useCallback(x=>{n({status:"error",error:x})},[]),g=P.useCallback((x,k)=>{h.current={cols:x,rows:k};const A=l.current,T=a.current,M=o.current;if(!A||!T||!M){m("Missing terminal credentials.");return}const E=i.current;if(E){if(E.readyState===WebSocket.OPEN){cp(E,{type:"resize",cols:x,rows:k}),n({status:"connected"});return}if(E.readyState===WebSocket.CONNECTING){n({status:"connecting"});return}i.current=null}let L;try{L=Vhe(u.current,A,T,M)}catch{m("Invalid terminal URL.");return}f.current=!1;const D=new WebSocket(L);i.current=D,n({status:"connecting"}),D.onopen=()=>{if(i.current!==D)return;n({status:"connected"});const O=h.current;O&&cp(D,{type:"resize",cols:O.cols,rows:O.rows})},D.onmessage=O=>{if(i.current!==D||typeof O.data!="string")return;let j;try{j=JSON.parse(O.data)}catch{return}if(!j||typeof j!="object"||typeof j.type!="string")return;const U=j;U.type==="output"&&typeof U.data=="string"&&s.current(U.data),U.type==="exit"&&typeof U.code=="number"&&(r.current(U.code,null),m("Terminal exited."))},D.onerror=()=>{i.current===D&&m("Connection error")},D.onclose=O=>{if(i.current!==D)return;if(i.current=null,f.current){f.current=!1,n({status:"idle"});return}const j=O.reason||`code ${O.code}`;m(`Disconnected: ${j}`)}},[m]),C=P.useCallback(x=>{const k=i.current;k&&cp(k,{type:"input",data:x})},[]),S=P.useCallback((x,k)=>{h.current={cols:x,rows:k};const A=i.current;A&&cp(A,{type:"resize",cols:x,rows:k})},[]),v=P.useCallback(()=>{const x=i.current;x&&(f.current=!0,x.close(),i.current=null,n({status:"idle"}))},[]),_=P.useCallback(x=>{s.current=x},[]),w=P.useCallback(x=>{r.current=x},[]);return{state:t,connect:g,write:C,resize:S,disconnect:v,onOutput:_,onExit:w}}var M_={exports:{}},EL;function Ghe(){return EL||(EL=1,(function(e,t){(function(n,i){e.exports=i()})(globalThis,(()=>(()=>{var n={4567:function(a,o,l){var u=this&&this.__decorate||function(w,x,k,A){var T,M=arguments.length,E=M<3?x:A===null?A=Object.getOwnPropertyDescriptor(x,k):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(w,x,k,A);else for(var L=w.length-1;L>=0;L--)(T=w[L])&&(E=(M<3?T(E):M>3?T(x,k,E):T(x,k))||E);return M>3&&E&&Object.defineProperty(x,k,E),E},h=this&&this.__param||function(w,x){return function(k,A){x(k,A,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.AccessibilityManager=void 0;const f=l(9042),m=l(9924),g=l(844),C=l(4725),S=l(2585),v=l(3656);let _=o.AccessibilityManager=class extends g.Disposable{constructor(w,x,k,A){super(),this._terminal=w,this._coreBrowserService=k,this._renderService=A,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let T=0;T<this._terminal.rows;T++)this._rowElements[T]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[T]);if(this._topBoundaryFocusListener=T=>this._handleBoundaryFocus(T,0),this._bottomBoundaryFocusListener=T=>this._handleBoundaryFocus(T,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new m.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((T=>this._handleResize(T.rows)))),this.register(this._terminal.onRender((T=>this._refreshRows(T.start,T.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((T=>this._handleChar(T)))),this.register(this._terminal.onLineFeed((()=>this._handleChar(`
`)))),this.register(this._terminal.onA11yTab((T=>this._handleTab(T)))),this.register(this._terminal.onKey((T=>this._handleKey(T.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,v.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,g.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(w){for(let x=0;x<w;x++)this._handleChar(" ")}_handleChar(w){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==w&&(this._charsToAnnounce+=w):this._charsToAnnounce+=w,w===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=f.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(w){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(w)||this._charsToConsume.push(w)}_refreshRows(w,x){this._liveRegionDebouncer.refresh(w,x,this._terminal.rows)}_renderRows(w,x){const k=this._terminal.buffer,A=k.lines.length.toString();for(let T=w;T<=x;T++){const M=k.lines.get(k.ydisp+T),E=[],L=M?.translateToString(!0,void 0,void 0,E)||"",D=(k.ydisp+T+1).toString(),O=this._rowElements[T];O&&(L.length===0?(O.innerText="",this._rowColumns.set(O,[0,1])):(O.textContent=L,this._rowColumns.set(O,E)),O.setAttribute("aria-posinset",D),O.setAttribute("aria-setsize",A))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(w,x){const k=w.target,A=this._rowElements[x===0?1:this._rowElements.length-2];if(k.getAttribute("aria-posinset")===(x===0?"1":`${this._terminal.buffer.lines.length}`)||w.relatedTarget!==A)return;let T,M;if(x===0?(T=k,M=this._rowElements.pop(),this._rowContainer.removeChild(M)):(T=this._rowElements.shift(),M=k,this._rowContainer.removeChild(T)),T.removeEventListener("focus",this._topBoundaryFocusListener),M.removeEventListener("focus",this._bottomBoundaryFocusListener),x===0){const E=this._createAccessibilityTreeNode();this._rowElements.unshift(E),this._rowContainer.insertAdjacentElement("afterbegin",E)}else{const E=this._createAccessibilityTreeNode();this._rowElements.push(E),this._rowContainer.appendChild(E)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(x===0?-1:1),this._rowElements[x===0?1:this._rowElements.length-2].focus(),w.preventDefault(),w.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;const w=document.getSelection();if(!w)return;if(w.isCollapsed)return void(this._rowContainer.contains(w.anchorNode)&&this._terminal.clearSelection());if(!w.anchorNode||!w.focusNode)return void console.error("anchorNode and/or focusNode are null");let x={node:w.anchorNode,offset:w.anchorOffset},k={node:w.focusNode,offset:w.focusOffset};if((x.node.compareDocumentPosition(k.node)&Node.DOCUMENT_POSITION_PRECEDING||x.node===k.node&&x.offset>k.offset)&&([x,k]=[k,x]),x.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(x={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(x.node))return;const A=this._rowElements.slice(-1)[0];if(k.node.compareDocumentPosition(A)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(k={node:A,offset:A.textContent?.length??0}),!this._rowContainer.contains(k.node))return;const T=({node:L,offset:D})=>{const O=L instanceof Text?L.parentNode:L;let j=parseInt(O?.getAttribute("aria-posinset"),10)-1;if(isNaN(j))return console.warn("row is invalid. Race condition?"),null;const U=this._rowColumns.get(O);if(!U)return console.warn("columns is null. Race condition?"),null;let q=D<U.length?U[D]:U.slice(-1)[0]+1;return q>=this._terminal.cols&&(++j,q=0),{row:j,column:q}},M=T(x),E=T(k);if(M&&E){if(M.row>E.row||M.row===E.row&&M.column>=E.column)throw new Error("invalid range");this._terminal.select(M.column,M.row,(E.row-M.row)*this._terminal.cols-M.column+E.column)}}_handleResize(w){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let x=this._rowContainer.children.length;x<this._terminal.rows;x++)this._rowElements[x]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[x]);for(;this._rowElements.length>w;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const w=this._coreBrowserService.mainDocument.createElement("div");return w.setAttribute("role","listitem"),w.tabIndex=-1,this._refreshRowDimensions(w),w}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let w=0;w<this._terminal.rows;w++)this._refreshRowDimensions(this._rowElements[w])}}_refreshRowDimensions(w){w.style.height=`${this._renderService.dimensions.css.cell.height}px`}};o.AccessibilityManager=_=u([h(1,S.IInstantiationService),h(2,C.ICoreBrowserService),h(3,C.IRenderService)],_)},3614:(a,o)=>{function l(m){return m.replace(/\r?\n/g,"\r")}function u(m,g){return g?"\x1B[200~"+m+"\x1B[201~":m}function h(m,g,C,S){m=u(m=l(m),C.decPrivateModes.bracketedPasteMode&&S.rawOptions.ignoreBracketedPasteMode!==!0),C.triggerDataEvent(m,!0),g.value=""}function f(m,g,C){const S=C.getBoundingClientRect(),v=m.clientX-S.left-10,_=m.clientY-S.top-10;g.style.width="20px",g.style.height="20px",g.style.left=`${v}px`,g.style.top=`${_}px`,g.style.zIndex="1000",g.focus()}Object.defineProperty(o,"__esModule",{value:!0}),o.rightClickHandler=o.moveTextAreaUnderMouseCursor=o.paste=o.handlePasteEvent=o.copyHandler=o.bracketTextForPaste=o.prepareTextForTerminal=void 0,o.prepareTextForTerminal=l,o.bracketTextForPaste=u,o.copyHandler=function(m,g){m.clipboardData&&m.clipboardData.setData("text/plain",g.selectionText),m.preventDefault()},o.handlePasteEvent=function(m,g,C,S){m.stopPropagation(),m.clipboardData&&h(m.clipboardData.getData("text/plain"),g,C,S)},o.paste=h,o.moveTextAreaUnderMouseCursor=f,o.rightClickHandler=function(m,g,C,S,v){f(m,g,C),v&&S.rightClickSelect(m),g.value=S.selectionText,g.select()}},7239:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorContrastCache=void 0;const u=l(1505);o.ColorContrastCache=class{constructor(){this._color=new u.TwoKeyMap,this._css=new u.TwoKeyMap}setCss(h,f,m){this._css.set(h,f,m)}getCss(h,f){return this._css.get(h,f)}setColor(h,f,m){this._color.set(h,f,m)}getColor(h,f){return this._color.get(h,f)}clear(){this._color.clear(),this._css.clear()}}},3656:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.addDisposableDomListener=void 0,o.addDisposableDomListener=function(l,u,h,f){l.addEventListener(u,h,f);let m=!1;return{dispose:()=>{m||(m=!0,l.removeEventListener(u,h,f))}}}},3551:function(a,o,l){var u=this&&this.__decorate||function(_,w,x,k){var A,T=arguments.length,M=T<3?w:k===null?k=Object.getOwnPropertyDescriptor(w,x):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(_,w,x,k);else for(var E=_.length-1;E>=0;E--)(A=_[E])&&(M=(T<3?A(M):T>3?A(w,x,M):A(w,x))||M);return T>3&&M&&Object.defineProperty(w,x,M),M},h=this&&this.__param||function(_,w){return function(x,k){w(x,k,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Linkifier=void 0;const f=l(3656),m=l(8460),g=l(844),C=l(2585),S=l(4725);let v=o.Linkifier=class extends g.Disposable{get currentLink(){return this._currentLink}constructor(_,w,x,k,A){super(),this._element=_,this._mouseService=w,this._renderService=x,this._bufferService=k,this._linkProviderService=A,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new m.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new m.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,g.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,g.toDisposable)((()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,f.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,f.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,f.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,f.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(_){this._lastMouseEvent=_;const w=this._positionFromMouseEvent(_,this._element,this._mouseService);if(!w)return;this._isMouseOut=!1;const x=_.composedPath();for(let k=0;k<x.length;k++){const A=x[k];if(A.classList.contains("xterm"))break;if(A.classList.contains("xterm-hover"))return}this._lastBufferCell&&w.x===this._lastBufferCell.x&&w.y===this._lastBufferCell.y||(this._handleHover(w),this._lastBufferCell=w)}_handleHover(_){if(this._activeLine!==_.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(_,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,_)||(this._clearCurrentLink(),this._askForLink(_,!0))}_askForLink(_,w){this._activeProviderReplies&&w||(this._activeProviderReplies?.forEach((k=>{k?.forEach((A=>{A.link.dispose&&A.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=_.y);let x=!1;for(const[k,A]of this._linkProviderService.linkProviders.entries())w?this._activeProviderReplies?.get(k)&&(x=this._checkLinkProviderResult(k,_,x)):A.provideLinks(_.y,(T=>{if(this._isMouseOut)return;const M=T?.map((E=>({link:E})));this._activeProviderReplies?.set(k,M),x=this._checkLinkProviderResult(k,_,x),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(_.y,this._activeProviderReplies)}))}_removeIntersectingLinks(_,w){const x=new Set;for(let k=0;k<w.size;k++){const A=w.get(k);if(A)for(let T=0;T<A.length;T++){const M=A[T],E=M.link.range.start.y<_?0:M.link.range.start.x,L=M.link.range.end.y>_?this._bufferService.cols:M.link.range.end.x;for(let D=E;D<=L;D++){if(x.has(D)){A.splice(T--,1);break}x.add(D)}}}}_checkLinkProviderResult(_,w,x){if(!this._activeProviderReplies)return x;const k=this._activeProviderReplies.get(_);let A=!1;for(let T=0;T<_;T++)this._activeProviderReplies.has(T)&&!this._activeProviderReplies.get(T)||(A=!0);if(!A&&k){const T=k.find((M=>this._linkAtPosition(M.link,w)));T&&(x=!0,this._handleNewLink(T))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!x)for(let T=0;T<this._activeProviderReplies.size;T++){const M=this._activeProviderReplies.get(T)?.find((E=>this._linkAtPosition(E.link,w)));if(M){x=!0,this._handleNewLink(M);break}}return x}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(_){if(!this._currentLink)return;const w=this._positionFromMouseEvent(_,this._element,this._mouseService);w&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,w)&&this._currentLink.link.activate(_,this._currentLink.link.text)}_clearCurrentLink(_,w){this._currentLink&&this._lastMouseEvent&&(!_||!w||this._currentLink.link.range.start.y>=_&&this._currentLink.link.range.end.y<=w)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,g.disposeArray)(this._linkCacheDisposables))}_handleNewLink(_){if(!this._lastMouseEvent)return;const w=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);w&&this._linkAtPosition(_.link,w)&&(this._currentLink=_,this._currentLink.state={decorations:{underline:_.link.decorations===void 0||_.link.decorations.underline,pointerCursor:_.link.decorations===void 0||_.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,_.link,this._lastMouseEvent),_.link.decorations={},Object.defineProperties(_.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:x=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==x&&(this._currentLink.state.decorations.pointerCursor=x,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",x))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:x=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==x&&(this._currentLink.state.decorations.underline=x,this._currentLink.state.isHovered&&this._fireUnderlineEvent(_.link,x))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((x=>{if(!this._currentLink)return;const k=x.start===0?0:x.start+1+this._bufferService.buffer.ydisp,A=this._bufferService.buffer.ydisp+1+x.end;if(this._currentLink.link.range.start.y>=k&&this._currentLink.link.range.end.y<=A&&(this._clearCurrentLink(k,A),this._lastMouseEvent)){const T=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);T&&this._askForLink(T,!1)}}))))}_linkHover(_,w,x){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(w,!0),this._currentLink.state.decorations.pointerCursor&&_.classList.add("xterm-cursor-pointer")),w.hover&&w.hover(x,w.text)}_fireUnderlineEvent(_,w){const x=_.range,k=this._bufferService.buffer.ydisp,A=this._createLinkUnderlineEvent(x.start.x-1,x.start.y-k-1,x.end.x,x.end.y-k-1,void 0);(w?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(A)}_linkLeave(_,w,x){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(w,!1),this._currentLink.state.decorations.pointerCursor&&_.classList.remove("xterm-cursor-pointer")),w.leave&&w.leave(x,w.text)}_linkAtPosition(_,w){const x=_.range.start.y*this._bufferService.cols+_.range.start.x,k=_.range.end.y*this._bufferService.cols+_.range.end.x,A=w.y*this._bufferService.cols+w.x;return x<=A&&A<=k}_positionFromMouseEvent(_,w,x){const k=x.getCoords(_,w,this._bufferService.cols,this._bufferService.rows);if(k)return{x:k[0],y:k[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(_,w,x,k,A){return{x1:_,y1:w,x2:x,y2:k,cols:this._bufferService.cols,fg:A}}};o.Linkifier=v=u([h(1,S.IMouseService),h(2,S.IRenderService),h(3,C.IBufferService),h(4,S.ILinkProviderService)],v)},9042:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.tooMuchOutput=o.promptLabel=void 0,o.promptLabel="Terminal input",o.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(a,o,l){var u=this&&this.__decorate||function(S,v,_,w){var x,k=arguments.length,A=k<3?v:w===null?w=Object.getOwnPropertyDescriptor(v,_):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(S,v,_,w);else for(var T=S.length-1;T>=0;T--)(x=S[T])&&(A=(k<3?x(A):k>3?x(v,_,A):x(v,_))||A);return k>3&&A&&Object.defineProperty(v,_,A),A},h=this&&this.__param||function(S,v){return function(_,w){v(_,w,S)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkProvider=void 0;const f=l(511),m=l(2585);let g=o.OscLinkProvider=class{constructor(S,v,_){this._bufferService=S,this._optionsService=v,this._oscLinkService=_}provideLinks(S,v){const _=this._bufferService.buffer.lines.get(S-1);if(!_)return void v(void 0);const w=[],x=this._optionsService.rawOptions.linkHandler,k=new f.CellData,A=_.getTrimmedLength();let T=-1,M=-1,E=!1;for(let L=0;L<A;L++)if(M!==-1||_.hasContent(L)){if(_.loadCell(L,k),k.hasExtendedAttrs()&&k.extended.urlId){if(M===-1){M=L,T=k.extended.urlId;continue}E=k.extended.urlId!==T}else M!==-1&&(E=!0);if(E||M!==-1&&L===A-1){const D=this._oscLinkService.getLinkData(T)?.uri;if(D){const O={start:{x:M+1,y:S},end:{x:L+(E||L!==A-1?0:1),y:S}};let j=!1;if(!x?.allowNonHttpProtocols)try{const U=new URL(D);["http:","https:"].includes(U.protocol)||(j=!0)}catch{j=!0}j||w.push({text:D,range:O,activate:(U,q)=>x?x.activate(U,q,O):C(0,q),hover:(U,q)=>x?.hover?.(U,q,O),leave:(U,q)=>x?.leave?.(U,q,O)})}E=!1,k.hasExtendedAttrs()&&k.extended.urlId?(M=L,T=k.extended.urlId):(M=-1,T=-1)}}v(w)}};function C(S,v){if(confirm(`Do you want to navigate to ${v}?

WARNING: This link could potentially be dangerous`)){const _=window.open();if(_){try{_.opener=null}catch{}_.location.href=v}else console.warn("Opening link blocked as opener could not be cleared")}}o.OscLinkProvider=g=u([h(0,m.IBufferService),h(1,m.IOptionsService),h(2,m.IOscLinkService)],g)},6193:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.RenderDebouncer=void 0,o.RenderDebouncer=class{constructor(l,u){this._renderCallback=l,this._coreBrowserService=u,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(l){return this._refreshCallbacks.push(l),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(l,u,h){this._rowCount=h,l=l!==void 0?l:0,u=u!==void 0?u:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,l):l,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,u):u,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const l=Math.max(this._rowStart,0),u=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(l,u),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const l of this._refreshCallbacks)l(0);this._refreshCallbacks=[]}}},3236:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Terminal=void 0;const u=l(3614),h=l(3656),f=l(3551),m=l(9042),g=l(3730),C=l(1680),S=l(3107),v=l(5744),_=l(2950),w=l(1296),x=l(428),k=l(4269),A=l(5114),T=l(8934),M=l(3230),E=l(9312),L=l(4725),D=l(6731),O=l(8055),j=l(8969),U=l(8460),q=l(844),K=l(6114),$=l(8437),Y=l(2584),Q=l(7399),F=l(5941),N=l(9074),z=l(2585),G=l(5435),H=l(4567),ee=l(779);class ue extends j.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(J={}){super(J),this.browser=K,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new q.MutableDisposable),this._onCursorMove=this.register(new U.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new U.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new U.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new U.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new U.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new U.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new U.EventEmitter),this._onBlur=this.register(new U.EventEmitter),this._onA11yCharEmitter=this.register(new U.EventEmitter),this._onA11yTabEmitter=this.register(new U.EventEmitter),this._onWillOpen=this.register(new U.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(N.DecorationService),this._instantiationService.setService(z.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(ee.LinkProviderService),this._instantiationService.setService(L.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(g.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((V,ne)=>this.refresh(V,ne)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((V=>this._reportWindowsOptions(V)))),this.register(this._inputHandler.onColor((V=>this._handleColorEvent(V)))),this.register((0,U.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,U.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,U.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,U.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((V=>this._afterResize(V.cols,V.rows)))),this.register((0,q.toDisposable)((()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)})))}_handleColorEvent(J){if(this._themeService)for(const V of J){let ne,he="";switch(V.index){case 256:ne="foreground",he="10";break;case 257:ne="background",he="11";break;case 258:ne="cursor",he="12";break;default:ne="ansi",he="4;"+V.index}switch(V.type){case 0:const _e=O.color.toColorRGB(ne==="ansi"?this._themeService.colors.ansi[V.index]:this._themeService.colors[ne]);this.coreService.triggerDataEvent(`${Y.C0.ESC}]${he};${(0,F.toRgbString)(_e)}${Y.C1_ESCAPED.ST}`);break;case 1:if(ne==="ansi")this._themeService.modifyColors((Ce=>Ce.ansi[V.index]=O.channels.toColor(...V.color)));else{const Ce=ne;this._themeService.modifyColors((we=>we[Ce]=O.channels.toColor(...V.color)))}break;case 2:this._themeService.restoreColor(V.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(J){J?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(H.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(J){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(Y.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(Y.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const J=this.buffer.ybase+this.buffer.y,V=this.buffer.lines.get(J);if(!V)return;const ne=Math.min(this.buffer.x,this.cols-1),he=this._renderService.dimensions.css.cell.height,_e=V.getWidth(ne),Ce=this._renderService.dimensions.css.cell.width*_e,we=this.buffer.y*this._renderService.dimensions.css.cell.height,Ee=ne*this._renderService.dimensions.css.cell.width;this.textarea.style.left=Ee+"px",this.textarea.style.top=we+"px",this.textarea.style.width=Ce+"px",this.textarea.style.height=he+"px",this.textarea.style.lineHeight=he+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,h.addDisposableDomListener)(this.element,"copy",(V=>{this.hasSelection()&&(0,u.copyHandler)(V,this._selectionService)})));const J=V=>(0,u.handlePasteEvent)(V,this.textarea,this.coreService,this.optionsService);this.register((0,h.addDisposableDomListener)(this.textarea,"paste",J)),this.register((0,h.addDisposableDomListener)(this.element,"paste",J)),K.isFirefox?this.register((0,h.addDisposableDomListener)(this.element,"mousedown",(V=>{V.button===2&&(0,u.rightClickHandler)(V,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,h.addDisposableDomListener)(this.element,"contextmenu",(V=>{(0,u.rightClickHandler)(V,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),K.isLinux&&this.register((0,h.addDisposableDomListener)(this.element,"auxclick",(V=>{V.button===1&&(0,u.moveTextAreaUnderMouseCursor)(V,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,h.addDisposableDomListener)(this.textarea,"keyup",(J=>this._keyUp(J)),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"keydown",(J=>this._keyDown(J)),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"keypress",(J=>this._keyPress(J)),!0)),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionupdate",(J=>this._compositionHelper.compositionupdate(J)))),this.register((0,h.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,h.addDisposableDomListener)(this.textarea,"input",(J=>this._inputEvent(J)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(J){if(!J)throw new Error("Terminal requires a parent element.");if(J.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=J.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),J.appendChild(this.element);const V=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),V.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,h.addDisposableDomListener)(this.screenElement,"mousemove",(ne=>this.updateCursorStyle(ne)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),V.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",m.promptLabel),K.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(A.CoreBrowserService,this.textarea,J.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(L.ICoreBrowserService,this._coreBrowserService),this.register((0,h.addDisposableDomListener)(this.textarea,"focus",(ne=>this._handleTextAreaFocus(ne)))),this.register((0,h.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(x.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(L.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(D.ThemeService),this._instantiationService.setService(L.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(k.CharacterJoinerService),this._instantiationService.setService(L.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(M.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(L.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((ne=>this._onRender.fire(ne)))),this.onResize((ne=>this._renderService.resize(ne.cols,ne.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(_.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(T.MouseService),this._instantiationService.setService(L.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(f.Linkifier,this.screenElement)),this.element.appendChild(V);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(C.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((ne=>this.scrollLines(ne.amount,ne.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(E.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(L.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((ne=>this.scrollLines(ne.amount,ne.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((ne=>this._renderService.handleSelectionChanged(ne.start,ne.end,ne.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((ne=>{this.textarea.value=ne,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((ne=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,h.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(S.BufferDecorationRenderer,this.screenElement)),this.register((0,h.addDisposableDomListener)(this.element,"mousedown",(ne=>this._selectionService.handleMouseDown(ne)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(H.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(ne=>this._handleScreenReaderModeOptionChange(ne)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(v.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(ne=>{!this._overviewRulerRenderer&&ne&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(v.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(w.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const J=this,V=this.element;function ne(Ce){const we=J._mouseService.getMouseReportCoords(Ce,J.screenElement);if(!we)return!1;let Ee,qe;switch(Ce.overrideType||Ce.type){case"mousemove":qe=32,Ce.buttons===void 0?(Ee=3,Ce.button!==void 0&&(Ee=Ce.button<3?Ce.button:3)):Ee=1&Ce.buttons?0:4&Ce.buttons?1:2&Ce.buttons?2:3;break;case"mouseup":qe=0,Ee=Ce.button<3?Ce.button:3;break;case"mousedown":qe=1,Ee=Ce.button<3?Ce.button:3;break;case"wheel":if(J._customWheelEventHandler&&J._customWheelEventHandler(Ce)===!1||J.viewport.getLinesScrolled(Ce)===0)return!1;qe=Ce.deltaY<0?0:1,Ee=4;break;default:return!1}return!(qe===void 0||Ee===void 0||Ee>4)&&J.coreMouseService.triggerMouseEvent({col:we.col,row:we.row,x:we.x,y:we.y,button:Ee,action:qe,ctrl:Ce.ctrlKey,alt:Ce.altKey,shift:Ce.shiftKey})}const he={mouseup:null,wheel:null,mousedrag:null,mousemove:null},_e={mouseup:Ce=>(ne(Ce),Ce.buttons||(this._document.removeEventListener("mouseup",he.mouseup),he.mousedrag&&this._document.removeEventListener("mousemove",he.mousedrag)),this.cancel(Ce)),wheel:Ce=>(ne(Ce),this.cancel(Ce,!0)),mousedrag:Ce=>{Ce.buttons&&ne(Ce)},mousemove:Ce=>{Ce.buttons||ne(Ce)}};this.register(this.coreMouseService.onProtocolChange((Ce=>{Ce?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Ce)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&Ce?he.mousemove||(V.addEventListener("mousemove",_e.mousemove),he.mousemove=_e.mousemove):(V.removeEventListener("mousemove",he.mousemove),he.mousemove=null),16&Ce?he.wheel||(V.addEventListener("wheel",_e.wheel,{passive:!1}),he.wheel=_e.wheel):(V.removeEventListener("wheel",he.wheel),he.wheel=null),2&Ce?he.mouseup||(he.mouseup=_e.mouseup):(this._document.removeEventListener("mouseup",he.mouseup),he.mouseup=null),4&Ce?he.mousedrag||(he.mousedrag=_e.mousedrag):(this._document.removeEventListener("mousemove",he.mousedrag),he.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,h.addDisposableDomListener)(V,"mousedown",(Ce=>{if(Ce.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(Ce))return ne(Ce),he.mouseup&&this._document.addEventListener("mouseup",he.mouseup),he.mousedrag&&this._document.addEventListener("mousemove",he.mousedrag),this.cancel(Ce)}))),this.register((0,h.addDisposableDomListener)(V,"wheel",(Ce=>{if(!he.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Ce)===!1)return!1;if(!this.buffer.hasScrollback){const we=this.viewport.getLinesScrolled(Ce);if(we===0)return;const Ee=Y.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Ce.deltaY<0?"A":"B");let qe="";for(let yt=0;yt<Math.abs(we);yt++)qe+=Ee;return this.coreService.triggerDataEvent(qe,!0),this.cancel(Ce,!0)}return this.viewport.handleWheel(Ce)?this.cancel(Ce):void 0}}),{passive:!1})),this.register((0,h.addDisposableDomListener)(V,"touchstart",(Ce=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(Ce),this.cancel(Ce)}),{passive:!0})),this.register((0,h.addDisposableDomListener)(V,"touchmove",(Ce=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(Ce)?void 0:this.cancel(Ce)}),{passive:!1}))}refresh(J,V){this._renderService?.refreshRows(J,V)}updateCursorStyle(J){this._selectionService?.shouldColumnSelect(J)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(J,V,ne=0){ne===1?(super.scrollLines(J,V,ne),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(J)}paste(J){(0,u.paste)(J,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(J){this._customKeyEventHandler=J}attachCustomWheelEventHandler(J){this._customWheelEventHandler=J}registerLinkProvider(J){return this._linkProviderService.registerLinkProvider(J)}registerCharacterJoiner(J){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const V=this._characterJoinerService.register(J);return this.refresh(0,this.rows-1),V}deregisterCharacterJoiner(J){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(J)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(J){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+J)}registerDecoration(J){return this._decorationService.registerDecoration(J)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(J,V,ne){this._selectionService.setSelection(J,V,ne)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(J,V){this._selectionService?.selectLines(J,V)}_keyDown(J){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(J)===!1)return!1;const V=this.browser.isMac&&this.options.macOptionIsMeta&&J.altKey;if(!V&&!this._compositionHelper.keydown(J))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;V||J.key!=="Dead"&&J.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const ne=(0,Q.evaluateKeyboardEvent)(J,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(J),ne.type===3||ne.type===2){const he=this.rows-1;return this.scrollLines(ne.type===2?-he:he),this.cancel(J,!0)}return ne.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,J)||(ne.cancel&&this.cancel(J,!0),!ne.key||!!(J.key&&!J.ctrlKey&&!J.altKey&&!J.metaKey&&J.key.length===1&&J.key.charCodeAt(0)>=65&&J.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(ne.key!==Y.C0.ETX&&ne.key!==Y.C0.CR||(this.textarea.value=""),this._onKey.fire({key:ne.key,domEvent:J}),this._showCursor(),this.coreService.triggerDataEvent(ne.key,!0),!this.optionsService.rawOptions.screenReaderMode||J.altKey||J.ctrlKey?this.cancel(J,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(J,V){const ne=J.isMac&&!this.options.macOptionIsMeta&&V.altKey&&!V.ctrlKey&&!V.metaKey||J.isWindows&&V.altKey&&V.ctrlKey&&!V.metaKey||J.isWindows&&V.getModifierState("AltGraph");return V.type==="keypress"?ne:ne&&(!V.keyCode||V.keyCode>47)}_keyUp(J){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(J)===!1||((function(V){return V.keyCode===16||V.keyCode===17||V.keyCode===18})(J)||this.focus(),this.updateCursorStyle(J),this._keyPressHandled=!1)}_keyPress(J){let V;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(J)===!1)return!1;if(this.cancel(J),J.charCode)V=J.charCode;else if(J.which===null||J.which===void 0)V=J.keyCode;else{if(J.which===0||J.charCode===0)return!1;V=J.which}return!(!V||(J.altKey||J.ctrlKey||J.metaKey)&&!this._isThirdLevelShift(this.browser,J)||(V=String.fromCharCode(V),this._onKey.fire({key:V,domEvent:J}),this._showCursor(),this.coreService.triggerDataEvent(V,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(J){if(J.data&&J.inputType==="insertText"&&(!J.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const V=J.data;return this.coreService.triggerDataEvent(V,!0),this.cancel(J),!0}return!1}resize(J,V){J!==this.cols||V!==this.rows?super.resize(J,V):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(J,V){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let J=1;J<this.rows;J++)this.buffer.lines.push(this.buffer.getBlankLine($.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const J=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=J,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(Y.C0.ESC+"[I"):this.coreService.triggerDataEvent(Y.C0.ESC+"[O")}_reportWindowsOptions(J){if(this._renderService)switch(J){case G.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const V=this._renderService.dimensions.css.canvas.width.toFixed(0),ne=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${Y.C0.ESC}[4;${ne};${V}t`);break;case G.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const he=this._renderService.dimensions.css.cell.width.toFixed(0),_e=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${Y.C0.ESC}[6;${_e};${he}t`)}}cancel(J,V){if(this.options.cancelEvents||V)return J.preventDefault(),J.stopPropagation(),!1}}o.Terminal=ue},9924:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TimeBasedDebouncer=void 0,o.TimeBasedDebouncer=class{constructor(l,u=1e3){this._renderCallback=l,this._debounceThresholdMS=u,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(l,u,h){this._rowCount=h,l=l!==void 0?l:0,u=u!==void 0?u:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,l):l,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,u):u;const f=Date.now();if(f-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=f,this._innerRefresh();else if(!this._additionalRefreshRequested){const m=f-this._lastRefreshMs,g=this._debounceThresholdMS-m;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),g)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const l=Math.max(this._rowStart,0),u=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(l,u)}}},1680:function(a,o,l){var u=this&&this.__decorate||function(_,w,x,k){var A,T=arguments.length,M=T<3?w:k===null?k=Object.getOwnPropertyDescriptor(w,x):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(_,w,x,k);else for(var E=_.length-1;E>=0;E--)(A=_[E])&&(M=(T<3?A(M):T>3?A(w,x,M):A(w,x))||M);return T>3&&M&&Object.defineProperty(w,x,M),M},h=this&&this.__param||function(_,w){return function(x,k){w(x,k,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Viewport=void 0;const f=l(3656),m=l(4725),g=l(8460),C=l(844),S=l(2585);let v=o.Viewport=class extends C.Disposable{constructor(_,w,x,k,A,T,M,E){super(),this._viewportElement=_,this._scrollArea=w,this._bufferService=x,this._optionsService=k,this._charSizeService=A,this._renderService=T,this._coreBrowserService=M,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new g.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,f.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((L=>this._activeBuffer=L.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((L=>this._renderDimensions=L))),this._handleThemeChange(E.colors),this.register(E.onChangeColors((L=>this._handleThemeChange(L)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(_){this._viewportElement.style.backgroundColor=_.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(_){if(_)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const w=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==w&&(this._lastRecordedBufferHeight=w,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const _=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==_&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=_),this._refreshAnimationFrame=null}syncScrollArea(_=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(_);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(_)}_handleScroll(_){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const w=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:w,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const _=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(_*(this._smoothScrollState.target-this._smoothScrollState.origin)),_<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(_,w){const x=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(w<0&&this._viewportElement.scrollTop!==0||w>0&&x<this._lastRecordedBufferHeight)||(_.cancelable&&_.preventDefault(),!1)}handleWheel(_){const w=this._getPixelsScrolled(_);return w!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+w:this._smoothScrollState.target+=w,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=w,this._bubbleScroll(_,w))}scrollLines(_){if(_!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const w=_*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+w,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:_,suppressScrollEvent:!1})}_getPixelsScrolled(_){if(_.deltaY===0||_.shiftKey)return 0;let w=this._applyScrollModifier(_.deltaY,_);return _.deltaMode===WheelEvent.DOM_DELTA_LINE?w*=this._currentRowHeight:_.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(w*=this._currentRowHeight*this._bufferService.rows),w}getBufferElements(_,w){let x,k="";const A=[],T=w??this._bufferService.buffer.lines.length,M=this._bufferService.buffer.lines;for(let E=_;E<T;E++){const L=M.get(E);if(!L)continue;const D=M.get(E+1)?.isWrapped;if(k+=L.translateToString(!D),!D||E===M.length-1){const O=document.createElement("div");O.textContent=k,A.push(O),k.length>0&&(x=O),k=""}}return{bufferElements:A,cursorElement:x}}getLinesScrolled(_){if(_.deltaY===0||_.shiftKey)return 0;let w=this._applyScrollModifier(_.deltaY,_);return _.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(w/=this._currentRowHeight+0,this._wheelPartialScroll+=w,w=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):_.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(w*=this._bufferService.rows),w}_applyScrollModifier(_,w){const x=this._optionsService.rawOptions.fastScrollModifier;return x==="alt"&&w.altKey||x==="ctrl"&&w.ctrlKey||x==="shift"&&w.shiftKey?_*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:_*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(_){this._lastTouchY=_.touches[0].pageY}handleTouchMove(_){const w=this._lastTouchY-_.touches[0].pageY;return this._lastTouchY=_.touches[0].pageY,w!==0&&(this._viewportElement.scrollTop+=w,this._bubbleScroll(_,w))}};o.Viewport=v=u([h(2,S.IBufferService),h(3,S.IOptionsService),h(4,m.ICharSizeService),h(5,m.IRenderService),h(6,m.ICoreBrowserService),h(7,m.IThemeService)],v)},3107:function(a,o,l){var u=this&&this.__decorate||function(S,v,_,w){var x,k=arguments.length,A=k<3?v:w===null?w=Object.getOwnPropertyDescriptor(v,_):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(S,v,_,w);else for(var T=S.length-1;T>=0;T--)(x=S[T])&&(A=(k<3?x(A):k>3?x(v,_,A):x(v,_))||A);return k>3&&A&&Object.defineProperty(v,_,A),A},h=this&&this.__param||function(S,v){return function(_,w){v(_,w,S)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferDecorationRenderer=void 0;const f=l(4725),m=l(844),g=l(2585);let C=o.BufferDecorationRenderer=class extends m.Disposable{constructor(S,v,_,w,x){super(),this._screenElement=S,this._bufferService=v,this._coreBrowserService=_,this._decorationService=w,this._renderService=x,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((k=>this._removeDecoration(k)))),this.register((0,m.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const S of this._decorationService.decorations)this._renderDecoration(S);this._dimensionsChanged=!1}_renderDecoration(S){this._refreshStyle(S),this._dimensionsChanged&&this._refreshXPosition(S)}_createElement(S){const v=this._coreBrowserService.mainDocument.createElement("div");v.classList.add("xterm-decoration"),v.classList.toggle("xterm-decoration-top-layer",S?.options?.layer==="top"),v.style.width=`${Math.round((S.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,v.style.height=(S.options.height||1)*this._renderService.dimensions.css.cell.height+"px",v.style.top=(S.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",v.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const _=S.options.x??0;return _&&_>this._bufferService.cols&&(v.style.display="none"),this._refreshXPosition(S,v),v}_refreshStyle(S){const v=S.marker.line-this._bufferService.buffers.active.ydisp;if(v<0||v>=this._bufferService.rows)S.element&&(S.element.style.display="none",S.onRenderEmitter.fire(S.element));else{let _=this._decorationElements.get(S);_||(_=this._createElement(S),S.element=_,this._decorationElements.set(S,_),this._container.appendChild(_),S.onDispose((()=>{this._decorationElements.delete(S),_.remove()}))),_.style.top=v*this._renderService.dimensions.css.cell.height+"px",_.style.display=this._altBufferIsActive?"none":"block",S.onRenderEmitter.fire(_)}}_refreshXPosition(S,v=S.element){if(!v)return;const _=S.options.x??0;(S.options.anchor||"left")==="right"?v.style.right=_?_*this._renderService.dimensions.css.cell.width+"px":"":v.style.left=_?_*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(S){this._decorationElements.get(S)?.remove(),this._decorationElements.delete(S),S.dispose()}};o.BufferDecorationRenderer=C=u([h(1,g.IBufferService),h(2,f.ICoreBrowserService),h(3,g.IDecorationService),h(4,f.IRenderService)],C)},5871:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorZoneStore=void 0,o.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(l){if(l.options.overviewRulerOptions){for(const u of this._zones)if(u.color===l.options.overviewRulerOptions.color&&u.position===l.options.overviewRulerOptions.position){if(this._lineIntersectsZone(u,l.marker.line))return;if(this._lineAdjacentToZone(u,l.marker.line,l.options.overviewRulerOptions.position))return void this._addLineToZone(u,l.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=l.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=l.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=l.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=l.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:l.options.overviewRulerOptions.color,position:l.options.overviewRulerOptions.position,startBufferLine:l.marker.line,endBufferLine:l.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(l){this._linePadding=l}_lineIntersectsZone(l,u){return u>=l.startBufferLine&&u<=l.endBufferLine}_lineAdjacentToZone(l,u,h){return u>=l.startBufferLine-this._linePadding[h||"full"]&&u<=l.endBufferLine+this._linePadding[h||"full"]}_addLineToZone(l,u){l.startBufferLine=Math.min(l.startBufferLine,u),l.endBufferLine=Math.max(l.endBufferLine,u)}}},5744:function(a,o,l){var u=this&&this.__decorate||function(x,k,A,T){var M,E=arguments.length,L=E<3?k:T===null?T=Object.getOwnPropertyDescriptor(k,A):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(x,k,A,T);else for(var D=x.length-1;D>=0;D--)(M=x[D])&&(L=(E<3?M(L):E>3?M(k,A,L):M(k,A))||L);return E>3&&L&&Object.defineProperty(k,A,L),L},h=this&&this.__param||function(x,k){return function(A,T){k(A,T,x)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OverviewRulerRenderer=void 0;const f=l(5871),m=l(4725),g=l(844),C=l(2585),S={full:0,left:0,center:0,right:0},v={full:0,left:0,center:0,right:0},_={full:0,left:0,center:0,right:0};let w=o.OverviewRulerRenderer=class extends g.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(x,k,A,T,M,E,L){super(),this._viewportElement=x,this._screenElement=k,this._bufferService=A,this._decorationService=T,this._renderService=M,this._optionsService=E,this._coreBrowserService=L,this._colorZoneStore=new f.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const D=this._canvas.getContext("2d");if(!D)throw new Error("Ctx cannot be null");this._ctx=D,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,g.toDisposable)((()=>{this._canvas?.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const x=Math.floor(this._canvas.width/3),k=Math.ceil(this._canvas.width/3);v.full=this._canvas.width,v.left=x,v.center=k,v.right=x,this._refreshDrawHeightConstants(),_.full=0,_.left=0,_.center=v.left,_.right=v.left+v.center}_refreshDrawHeightConstants(){S.full=Math.round(2*this._coreBrowserService.dpr);const x=this._canvas.height/this._bufferService.buffer.lines.length,k=Math.round(Math.max(Math.min(x,12),6)*this._coreBrowserService.dpr);S.left=k,S.center=k,S.right=k}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*S.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*S.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*S.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*S.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const k of this._decorationService.decorations)this._colorZoneStore.addDecoration(k);this._ctx.lineWidth=1;const x=this._colorZoneStore.zones;for(const k of x)k.position!=="full"&&this._renderColorZone(k);for(const k of x)k.position==="full"&&this._renderColorZone(k);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(x){this._ctx.fillStyle=x.color,this._ctx.fillRect(_[x.position||"full"],Math.round((this._canvas.height-1)*(x.startBufferLine/this._bufferService.buffers.active.lines.length)-S[x.position||"full"]/2),v[x.position||"full"],Math.round((this._canvas.height-1)*((x.endBufferLine-x.startBufferLine)/this._bufferService.buffers.active.lines.length)+S[x.position||"full"]))}_queueRefresh(x,k){this._shouldUpdateDimensions=x||this._shouldUpdateDimensions,this._shouldUpdateAnchor=k||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};o.OverviewRulerRenderer=w=u([h(2,C.IBufferService),h(3,C.IDecorationService),h(4,m.IRenderService),h(5,C.IOptionsService),h(6,m.ICoreBrowserService)],w)},2950:function(a,o,l){var u=this&&this.__decorate||function(S,v,_,w){var x,k=arguments.length,A=k<3?v:w===null?w=Object.getOwnPropertyDescriptor(v,_):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(S,v,_,w);else for(var T=S.length-1;T>=0;T--)(x=S[T])&&(A=(k<3?x(A):k>3?x(v,_,A):x(v,_))||A);return k>3&&A&&Object.defineProperty(v,_,A),A},h=this&&this.__param||function(S,v){return function(_,w){v(_,w,S)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CompositionHelper=void 0;const f=l(4725),m=l(2585),g=l(2584);let C=o.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(S,v,_,w,x,k){this._textarea=S,this._compositionView=v,this._bufferService=_,this._optionsService=w,this._coreService=x,this._renderService=k,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(S){this._compositionView.textContent=S.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(S){if(this._isComposing||this._isSendingComposition){if(S.keyCode===229||S.keyCode===16||S.keyCode===17||S.keyCode===18)return!1;this._finalizeComposition(!1)}return S.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(S){if(this._compositionView.classList.remove("active"),this._isComposing=!1,S){const v={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let _;this._isSendingComposition=!1,v.start+=this._dataAlreadySent.length,_=this._isComposing?this._textarea.value.substring(v.start,v.end):this._textarea.value.substring(v.start),_.length>0&&this._coreService.triggerDataEvent(_,!0)}}),0)}else{this._isSendingComposition=!1;const v=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(v,!0)}}_handleAnyTextareaChanges(){const S=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const v=this._textarea.value,_=v.replace(S,"");this._dataAlreadySent=_,v.length>S.length?this._coreService.triggerDataEvent(_,!0):v.length<S.length?this._coreService.triggerDataEvent(`${g.C0.DEL}`,!0):v.length===S.length&&v!==S&&this._coreService.triggerDataEvent(v,!0)}}),0)}updateCompositionElements(S){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const v=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),_=this._renderService.dimensions.css.cell.height,w=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,x=v*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=x+"px",this._compositionView.style.top=w+"px",this._compositionView.style.height=_+"px",this._compositionView.style.lineHeight=_+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const k=this._compositionView.getBoundingClientRect();this._textarea.style.left=x+"px",this._textarea.style.top=w+"px",this._textarea.style.width=Math.max(k.width,1)+"px",this._textarea.style.height=Math.max(k.height,1)+"px",this._textarea.style.lineHeight=k.height+"px"}S||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};o.CompositionHelper=C=u([h(2,m.IBufferService),h(3,m.IOptionsService),h(4,m.ICoreService),h(5,f.IRenderService)],C)},9806:(a,o)=>{function l(u,h,f){const m=f.getBoundingClientRect(),g=u.getComputedStyle(f),C=parseInt(g.getPropertyValue("padding-left")),S=parseInt(g.getPropertyValue("padding-top"));return[h.clientX-m.left-C,h.clientY-m.top-S]}Object.defineProperty(o,"__esModule",{value:!0}),o.getCoords=o.getCoordsRelativeToElement=void 0,o.getCoordsRelativeToElement=l,o.getCoords=function(u,h,f,m,g,C,S,v,_){if(!C)return;const w=l(u,h,f);return w?(w[0]=Math.ceil((w[0]+(_?S/2:0))/S),w[1]=Math.ceil(w[1]/v),w[0]=Math.min(Math.max(w[0],1),m+(_?1:0)),w[1]=Math.min(Math.max(w[1],1),g),w):void 0}},9504:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.moveToCellSequence=void 0;const u=l(2584);function h(v,_,w,x){const k=v-f(v,w),A=_-f(_,w),T=Math.abs(k-A)-(function(M,E,L){let D=0;const O=M-f(M,L),j=E-f(E,L);for(let U=0;U<Math.abs(O-j);U++){const q=m(M,E)==="A"?-1:1;L.buffer.lines.get(O+q*U)?.isWrapped&&D++}return D})(v,_,w);return S(T,C(m(v,_),x))}function f(v,_){let w=0,x=_.buffer.lines.get(v),k=x?.isWrapped;for(;k&&v>=0&&v<_.rows;)w++,x=_.buffer.lines.get(--v),k=x?.isWrapped;return w}function m(v,_){return v>_?"A":"B"}function g(v,_,w,x,k,A){let T=v,M=_,E="";for(;T!==w||M!==x;)T+=k?1:-1,k&&T>A.cols-1?(E+=A.buffer.translateBufferLineToString(M,!1,v,T),T=0,v=0,M++):!k&&T<0&&(E+=A.buffer.translateBufferLineToString(M,!1,0,v+1),T=A.cols-1,v=T,M--);return E+A.buffer.translateBufferLineToString(M,!1,v,T)}function C(v,_){const w=_?"O":"[";return u.C0.ESC+w+v}function S(v,_){v=Math.floor(v);let w="";for(let x=0;x<v;x++)w+=_;return w}o.moveToCellSequence=function(v,_,w,x){const k=w.buffer.x,A=w.buffer.y;if(!w.buffer.hasScrollback)return(function(E,L,D,O,j,U){return h(L,O,j,U).length===0?"":S(g(E,L,E,L-f(L,j),!1,j).length,C("D",U))})(k,A,0,_,w,x)+h(A,_,w,x)+(function(E,L,D,O,j,U){let q;q=h(L,O,j,U).length>0?O-f(O,j):L;const K=O,$=(function(Y,Q,F,N,z,G){let H;return H=h(F,N,z,G).length>0?N-f(N,z):Q,Y<F&&H<=N||Y>=F&&H<N?"C":"D"})(E,L,D,O,j,U);return S(g(E,q,D,K,$==="C",j).length,C($,U))})(k,A,v,_,w,x);let T;if(A===_)return T=k>v?"D":"C",S(Math.abs(k-v),C(T,x));T=A>_?"D":"C";const M=Math.abs(A-_);return S((function(E,L){return L.cols-E})(A>_?v:k,w)+(M-1)*w.cols+1+((A>_?k:v)-1),C(T,x))}},1296:function(a,o,l){var u=this&&this.__decorate||function(U,q,K,$){var Y,Q=arguments.length,F=Q<3?q:$===null?$=Object.getOwnPropertyDescriptor(q,K):$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(U,q,K,$);else for(var N=U.length-1;N>=0;N--)(Y=U[N])&&(F=(Q<3?Y(F):Q>3?Y(q,K,F):Y(q,K))||F);return Q>3&&F&&Object.defineProperty(q,K,F),F},h=this&&this.__param||function(U,q){return function(K,$){q(K,$,U)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRenderer=void 0;const f=l(3787),m=l(2550),g=l(2223),C=l(6171),S=l(6052),v=l(4725),_=l(8055),w=l(8460),x=l(844),k=l(2585),A="xterm-dom-renderer-owner-",T="xterm-rows",M="xterm-fg-",E="xterm-bg-",L="xterm-focus",D="xterm-selection";let O=1,j=o.DomRenderer=class extends x.Disposable{constructor(U,q,K,$,Y,Q,F,N,z,G,H,ee,ue){super(),this._terminal=U,this._document=q,this._element=K,this._screenElement=$,this._viewportElement=Y,this._helperContainer=Q,this._linkifier2=F,this._charSizeService=z,this._optionsService=G,this._bufferService=H,this._coreBrowserService=ee,this._themeService=ue,this._terminalClass=O++,this._rowElements=[],this._selectionRenderModel=(0,S.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new w.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(T),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(D),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,C.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((ce=>this._injectCss(ce)))),this._injectCss(this._themeService.colors),this._rowFactory=N.createInstance(f.DomRendererRowFactory,document),this._element.classList.add(A+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((ce=>this._handleLinkHover(ce)))),this.register(this._linkifier2.onHideLinkUnderline((ce=>this._handleLinkLeave(ce)))),this.register((0,x.toDisposable)((()=>{this._element.classList.remove(A+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new m.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const U=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*U,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*U),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/U),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/U),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const K of this._rowElements)K.style.width=`${this.dimensions.css.canvas.width}px`,K.style.height=`${this.dimensions.css.cell.height}px`,K.style.lineHeight=`${this.dimensions.css.cell.height}px`,K.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const q=`${this._terminalSelector} .${T} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=q,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(U){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let q=`${this._terminalSelector} .${T} { color: ${U.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;q+=`${this._terminalSelector} .${T} .xterm-dim { color: ${_.color.multiplyOpacity(U.foreground,.5).css};}`,q+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const K=`blink_underline_${this._terminalClass}`,$=`blink_bar_${this._terminalClass}`,Y=`blink_block_${this._terminalClass}`;q+=`@keyframes ${K} { 50% {  border-bottom-style: hidden; }}`,q+=`@keyframes ${$} { 50% {  box-shadow: none; }}`,q+=`@keyframes ${Y} { 0% {  background-color: ${U.cursor.css};  color: ${U.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${U.cursor.css}; }}`,q+=`${this._terminalSelector} .${T}.${L} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${K} 1s step-end infinite;}${this._terminalSelector} .${T}.${L} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${$} 1s step-end infinite;}${this._terminalSelector} .${T}.${L} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${Y} 1s step-end infinite;}${this._terminalSelector} .${T} .xterm-cursor.xterm-cursor-block { background-color: ${U.cursor.css}; color: ${U.cursorAccent.css};}${this._terminalSelector} .${T} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${U.cursor.css} !important; color: ${U.cursorAccent.css} !important;}${this._terminalSelector} .${T} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${U.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${T} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${U.cursor.css} inset;}${this._terminalSelector} .${T} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${U.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,q+=`${this._terminalSelector} .${D} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${D} div { position: absolute; background-color: ${U.selectionBackgroundOpaque.css};}${this._terminalSelector} .${D} div { position: absolute; background-color: ${U.selectionInactiveBackgroundOpaque.css};}`;for(const[Q,F]of U.ansi.entries())q+=`${this._terminalSelector} .${M}${Q} { color: ${F.css}; }${this._terminalSelector} .${M}${Q}.xterm-dim { color: ${_.color.multiplyOpacity(F,.5).css}; }${this._terminalSelector} .${E}${Q} { background-color: ${F.css}; }`;q+=`${this._terminalSelector} .${M}${g.INVERTED_DEFAULT_COLOR} { color: ${_.color.opaque(U.background).css}; }${this._terminalSelector} .${M}${g.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${_.color.multiplyOpacity(_.color.opaque(U.background),.5).css}; }${this._terminalSelector} .${E}${g.INVERTED_DEFAULT_COLOR} { background-color: ${U.foreground.css}; }`,this._themeStyleElement.textContent=q}_setDefaultSpacing(){const U=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${U}px`,this._rowFactory.defaultSpacing=U}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(U,q){for(let K=this._rowElements.length;K<=q;K++){const $=this._document.createElement("div");this._rowContainer.appendChild($),this._rowElements.push($)}for(;this._rowElements.length>q;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(U,q){this._refreshRowElements(U,q),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(L),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(L),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(U,q,K){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(U,q,K),this.renderRows(0,this._bufferService.rows-1),!U||!q)return;this._selectionRenderModel.update(this._terminal,U,q,K);const $=this._selectionRenderModel.viewportStartRow,Y=this._selectionRenderModel.viewportEndRow,Q=this._selectionRenderModel.viewportCappedStartRow,F=this._selectionRenderModel.viewportCappedEndRow;if(Q>=this._bufferService.rows||F<0)return;const N=this._document.createDocumentFragment();if(K){const z=U[0]>q[0];N.appendChild(this._createSelectionElement(Q,z?q[0]:U[0],z?U[0]:q[0],F-Q+1))}else{const z=$===Q?U[0]:0,G=Q===Y?q[0]:this._bufferService.cols;N.appendChild(this._createSelectionElement(Q,z,G));const H=F-Q-1;if(N.appendChild(this._createSelectionElement(Q+1,0,this._bufferService.cols,H)),Q!==F){const ee=Y===F?q[0]:this._bufferService.cols;N.appendChild(this._createSelectionElement(F,0,ee))}}this._selectionContainer.appendChild(N)}_createSelectionElement(U,q,K,$=1){const Y=this._document.createElement("div"),Q=q*this.dimensions.css.cell.width;let F=this.dimensions.css.cell.width*(K-q);return Q+F>this.dimensions.css.canvas.width&&(F=this.dimensions.css.canvas.width-Q),Y.style.height=$*this.dimensions.css.cell.height+"px",Y.style.top=U*this.dimensions.css.cell.height+"px",Y.style.left=`${Q}px`,Y.style.width=`${F}px`,Y}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const U of this._rowElements)U.replaceChildren()}renderRows(U,q){const K=this._bufferService.buffer,$=K.ybase+K.y,Y=Math.min(K.x,this._bufferService.cols-1),Q=this._optionsService.rawOptions.cursorBlink,F=this._optionsService.rawOptions.cursorStyle,N=this._optionsService.rawOptions.cursorInactiveStyle;for(let z=U;z<=q;z++){const G=z+K.ydisp,H=this._rowElements[z],ee=K.lines.get(G);if(!H||!ee)break;H.replaceChildren(...this._rowFactory.createRow(ee,G,G===$,F,N,Y,Q,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${A}${this._terminalClass}`}_handleLinkHover(U){this._setCellUnderline(U.x1,U.x2,U.y1,U.y2,U.cols,!0)}_handleLinkLeave(U){this._setCellUnderline(U.x1,U.x2,U.y1,U.y2,U.cols,!1)}_setCellUnderline(U,q,K,$,Y,Q){K<0&&(U=0),$<0&&(q=0);const F=this._bufferService.rows-1;K=Math.max(Math.min(K,F),0),$=Math.max(Math.min($,F),0),Y=Math.min(Y,this._bufferService.cols);const N=this._bufferService.buffer,z=N.ybase+N.y,G=Math.min(N.x,Y-1),H=this._optionsService.rawOptions.cursorBlink,ee=this._optionsService.rawOptions.cursorStyle,ue=this._optionsService.rawOptions.cursorInactiveStyle;for(let ce=K;ce<=$;++ce){const J=ce+N.ydisp,V=this._rowElements[ce],ne=N.lines.get(J);if(!V||!ne)break;V.replaceChildren(...this._rowFactory.createRow(ne,J,J===z,ee,ue,G,H,this.dimensions.css.cell.width,this._widthCache,Q?ce===K?U:0:-1,Q?(ce===$?q:Y)-1:-1))}}};o.DomRenderer=j=u([h(7,k.IInstantiationService),h(8,v.ICharSizeService),h(9,k.IOptionsService),h(10,k.IBufferService),h(11,v.ICoreBrowserService),h(12,v.IThemeService)],j)},3787:function(a,o,l){var u=this&&this.__decorate||function(T,M,E,L){var D,O=arguments.length,j=O<3?M:L===null?L=Object.getOwnPropertyDescriptor(M,E):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(T,M,E,L);else for(var U=T.length-1;U>=0;U--)(D=T[U])&&(j=(O<3?D(j):O>3?D(M,E,j):D(M,E))||j);return O>3&&j&&Object.defineProperty(M,E,j),j},h=this&&this.__param||function(T,M){return function(E,L){M(E,L,T)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRendererRowFactory=void 0;const f=l(2223),m=l(643),g=l(511),C=l(2585),S=l(8055),v=l(4725),_=l(4269),w=l(6171),x=l(3734);let k=o.DomRendererRowFactory=class{constructor(T,M,E,L,D,O,j){this._document=T,this._characterJoinerService=M,this._optionsService=E,this._coreBrowserService=L,this._coreService=D,this._decorationService=O,this._themeService=j,this._workCell=new g.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(T,M,E){this._selectionStart=T,this._selectionEnd=M,this._columnSelectMode=E}createRow(T,M,E,L,D,O,j,U,q,K,$){const Y=[],Q=this._characterJoinerService.getJoinedCharacters(M),F=this._themeService.colors;let N,z=T.getNoBgTrimmedLength();E&&z<O+1&&(z=O+1);let G=0,H="",ee=0,ue=0,ce=0,J=!1,V=0,ne=!1,he=0;const _e=[],Ce=K!==-1&&$!==-1;for(let we=0;we<z;we++){T.loadCell(we,this._workCell);let Ee=this._workCell.getWidth();if(Ee===0)continue;let qe=!1,yt=we,Pe=this._workCell;if(Q.length>0&&we===Q[0][0]){qe=!0;const He=Q.shift();Pe=new _.JoinedCellData(this._workCell,T.translateToString(!0,He[0],He[1]),He[1]-He[0]),yt=He[1]-1,Ee=Pe.getWidth()}const Ot=this._isCellInSelection(we,M),Nt=E&&we===O,Qe=Ce&&we>=K&&we<=$;let Ge=!1;this._decorationService.forEachDecorationAtCell(we,M,void 0,(He=>{Ge=!0}));let Ke=Pe.getChars()||m.WHITESPACE_CELL_CHAR;if(Ke===" "&&(Pe.isUnderline()||Pe.isOverline())&&(Ke=""),he=Ee*U-q.get(Ke,Pe.isBold(),Pe.isItalic()),N){if(G&&(Ot&&ne||!Ot&&!ne&&Pe.bg===ee)&&(Ot&&ne&&F.selectionForeground||Pe.fg===ue)&&Pe.extended.ext===ce&&Qe===J&&he===V&&!Nt&&!qe&&!Ge){Pe.isInvisible()?H+=m.WHITESPACE_CELL_CHAR:H+=Ke,G++;continue}G&&(N.textContent=H),N=this._document.createElement("span"),G=0,H=""}else N=this._document.createElement("span");if(ee=Pe.bg,ue=Pe.fg,ce=Pe.extended.ext,J=Qe,V=he,ne=Ot,qe&&O>=we&&O<=yt&&(O=we),!this._coreService.isCursorHidden&&Nt&&this._coreService.isCursorInitialized){if(_e.push("xterm-cursor"),this._coreBrowserService.isFocused)j&&_e.push("xterm-cursor-blink"),_e.push(L==="bar"?"xterm-cursor-bar":L==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(D)switch(D){case"outline":_e.push("xterm-cursor-outline");break;case"block":_e.push("xterm-cursor-block");break;case"bar":_e.push("xterm-cursor-bar");break;case"underline":_e.push("xterm-cursor-underline")}}if(Pe.isBold()&&_e.push("xterm-bold"),Pe.isItalic()&&_e.push("xterm-italic"),Pe.isDim()&&_e.push("xterm-dim"),H=Pe.isInvisible()?m.WHITESPACE_CELL_CHAR:Pe.getChars()||m.WHITESPACE_CELL_CHAR,Pe.isUnderline()&&(_e.push(`xterm-underline-${Pe.extended.underlineStyle}`),H===" "&&(H=""),!Pe.isUnderlineColorDefault()))if(Pe.isUnderlineColorRGB())N.style.textDecorationColor=`rgb(${x.AttributeData.toColorRGB(Pe.getUnderlineColor()).join(",")})`;else{let He=Pe.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Pe.isBold()&&He<8&&(He+=8),N.style.textDecorationColor=F.ansi[He].css}Pe.isOverline()&&(_e.push("xterm-overline"),H===" "&&(H="")),Pe.isStrikethrough()&&_e.push("xterm-strikethrough"),Qe&&(N.style.textDecoration="underline");let Te=Pe.getFgColor(),Fe=Pe.getFgColorMode(),_t=Pe.getBgColor(),se=Pe.getBgColorMode();const ge=!!Pe.isInverse();if(ge){const He=Te;Te=_t,_t=He;const Yt=Fe;Fe=se,se=Yt}let Me,je,ze,Ye=!1;switch(this._decorationService.forEachDecorationAtCell(we,M,void 0,(He=>{He.options.layer!=="top"&&Ye||(He.backgroundColorRGB&&(se=50331648,_t=He.backgroundColorRGB.rgba>>8&16777215,Me=He.backgroundColorRGB),He.foregroundColorRGB&&(Fe=50331648,Te=He.foregroundColorRGB.rgba>>8&16777215,je=He.foregroundColorRGB),Ye=He.options.layer==="top")})),!Ye&&Ot&&(Me=this._coreBrowserService.isFocused?F.selectionBackgroundOpaque:F.selectionInactiveBackgroundOpaque,_t=Me.rgba>>8&16777215,se=50331648,Ye=!0,F.selectionForeground&&(Fe=50331648,Te=F.selectionForeground.rgba>>8&16777215,je=F.selectionForeground)),Ye&&_e.push("xterm-decoration-top"),se){case 16777216:case 33554432:ze=F.ansi[_t],_e.push(`xterm-bg-${_t}`);break;case 50331648:ze=S.channels.toColor(_t>>16,_t>>8&255,255&_t),this._addStyle(N,`background-color:#${A((_t>>>0).toString(16),"0",6)}`);break;default:ge?(ze=F.foreground,_e.push(`xterm-bg-${f.INVERTED_DEFAULT_COLOR}`)):ze=F.background}switch(Me||Pe.isDim()&&(Me=S.color.multiplyOpacity(ze,.5)),Fe){case 16777216:case 33554432:Pe.isBold()&&Te<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(Te+=8),this._applyMinimumContrast(N,ze,F.ansi[Te],Pe,Me,void 0)||_e.push(`xterm-fg-${Te}`);break;case 50331648:const He=S.channels.toColor(Te>>16&255,Te>>8&255,255&Te);this._applyMinimumContrast(N,ze,He,Pe,Me,je)||this._addStyle(N,`color:#${A(Te.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(N,ze,F.foreground,Pe,Me,je)||ge&&_e.push(`xterm-fg-${f.INVERTED_DEFAULT_COLOR}`)}_e.length&&(N.className=_e.join(" "),_e.length=0),Nt||qe||Ge?N.textContent=H:G++,he!==this.defaultSpacing&&(N.style.letterSpacing=`${he}px`),Y.push(N),we=yt}return N&&G&&(N.textContent=H),Y}_applyMinimumContrast(T,M,E,L,D,O){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,w.treatGlyphAsBackgroundColor)(L.getCode()))return!1;const j=this._getContrastCache(L);let U;if(D||O||(U=j.getColor(M.rgba,E.rgba)),U===void 0){const q=this._optionsService.rawOptions.minimumContrastRatio/(L.isDim()?2:1);U=S.color.ensureContrastRatio(D||M,O||E,q),j.setColor((D||M).rgba,(O||E).rgba,U??null)}return!!U&&(this._addStyle(T,`color:${U.css}`),!0)}_getContrastCache(T){return T.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(T,M){T.setAttribute("style",`${T.getAttribute("style")||""}${M};`)}_isCellInSelection(T,M){const E=this._selectionStart,L=this._selectionEnd;return!(!E||!L)&&(this._columnSelectMode?E[0]<=L[0]?T>=E[0]&&M>=E[1]&&T<L[0]&&M<=L[1]:T<E[0]&&M>=E[1]&&T>=L[0]&&M<=L[1]:M>E[1]&&M<L[1]||E[1]===L[1]&&M===E[1]&&T>=E[0]&&T<L[0]||E[1]<L[1]&&M===L[1]&&T<L[0]||E[1]<L[1]&&M===E[1]&&T>=E[0])}};function A(T,M,E){for(;T.length<E;)T=M+T;return T}o.DomRendererRowFactory=k=u([h(1,v.ICharacterJoinerService),h(2,C.IOptionsService),h(3,v.ICoreBrowserService),h(4,C.ICoreService),h(5,C.IDecorationService),h(6,v.IThemeService)],k)},2550:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WidthCache=void 0,o.WidthCache=class{constructor(l,u){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=l.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const h=l.createElement("span");h.classList.add("xterm-char-measure-element");const f=l.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontWeight="bold";const m=l.createElement("span");m.classList.add("xterm-char-measure-element"),m.style.fontStyle="italic";const g=l.createElement("span");g.classList.add("xterm-char-measure-element"),g.style.fontWeight="bold",g.style.fontStyle="italic",this._measureElements=[h,f,m,g],this._container.appendChild(h),this._container.appendChild(f),this._container.appendChild(m),this._container.appendChild(g),u.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(l,u,h,f){l===this._font&&u===this._fontSize&&h===this._weight&&f===this._weightBold||(this._font=l,this._fontSize=u,this._weight=h,this._weightBold=f,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${h}`,this._measureElements[1].style.fontWeight=`${f}`,this._measureElements[2].style.fontWeight=`${h}`,this._measureElements[3].style.fontWeight=`${f}`,this.clear())}get(l,u,h){let f=0;if(!u&&!h&&l.length===1&&(f=l.charCodeAt(0))<256){if(this._flat[f]!==-9999)return this._flat[f];const C=this._measure(l,0);return C>0&&(this._flat[f]=C),C}let m=l;u&&(m+="B"),h&&(m+="I");let g=this._holey.get(m);if(g===void 0){let C=0;u&&(C|=1),h&&(C|=2),g=this._measure(l,C),g>0&&this._holey.set(m,g)}return g}_measure(l,u){const h=this._measureElements[u];return h.textContent=l.repeat(32),h.offsetWidth/32}}},2223:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TEXT_BASELINE=o.DIM_OPACITY=o.INVERTED_DEFAULT_COLOR=void 0;const u=l(6114);o.INVERTED_DEFAULT_COLOR=257,o.DIM_OPACITY=.5,o.TEXT_BASELINE=u.isFirefox||u.isLegacyEdge?"bottom":"ideographic"},6171:(a,o)=>{function l(h){return 57508<=h&&h<=57558}function u(h){return h>=128512&&h<=128591||h>=127744&&h<=128511||h>=128640&&h<=128767||h>=9728&&h<=9983||h>=9984&&h<=10175||h>=65024&&h<=65039||h>=129280&&h<=129535||h>=127462&&h<=127487}Object.defineProperty(o,"__esModule",{value:!0}),o.computeNextVariantOffset=o.createRenderDimensions=o.treatGlyphAsBackgroundColor=o.allowRescaling=o.isEmoji=o.isRestrictedPowerlineGlyph=o.isPowerlineGlyph=o.throwIfFalsy=void 0,o.throwIfFalsy=function(h){if(!h)throw new Error("value must not be falsy");return h},o.isPowerlineGlyph=l,o.isRestrictedPowerlineGlyph=function(h){return 57520<=h&&h<=57527},o.isEmoji=u,o.allowRescaling=function(h,f,m,g){return f===1&&m>Math.ceil(1.5*g)&&h!==void 0&&h>255&&!u(h)&&!l(h)&&!(function(C){return 57344<=C&&C<=63743})(h)},o.treatGlyphAsBackgroundColor=function(h){return l(h)||(function(f){return 9472<=f&&f<=9631})(h)},o.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},o.computeNextVariantOffset=function(h,f,m=0){return(h-(2*Math.round(f)-m))%(2*Math.round(f))}},6052:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createSelectionRenderModel=void 0;class l{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(h,f,m,g=!1){if(this.selectionStart=f,this.selectionEnd=m,!f||!m||f[0]===m[0]&&f[1]===m[1])return void this.clear();const C=h.buffers.active.ydisp,S=f[1]-C,v=m[1]-C,_=Math.max(S,0),w=Math.min(v,h.rows-1);_>=h.rows||w<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=g,this.viewportStartRow=S,this.viewportEndRow=v,this.viewportCappedStartRow=_,this.viewportCappedEndRow=w,this.startCol=f[0],this.endCol=m[0])}isCellSelected(h,f,m){return!!this.hasSelection&&(m-=h.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?f>=this.startCol&&m>=this.viewportCappedStartRow&&f<this.endCol&&m<=this.viewportCappedEndRow:f<this.startCol&&m>=this.viewportCappedStartRow&&f>=this.endCol&&m<=this.viewportCappedEndRow:m>this.viewportStartRow&&m<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&m===this.viewportStartRow&&f>=this.startCol&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportEndRow&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportStartRow&&f>=this.startCol)}}o.createSelectionRenderModel=function(){return new l}},456:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionModel=void 0,o.SelectionModel=class{constructor(l){this._bufferService=l,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const l=this.selectionStart[0]+this.selectionStartLength;return l>this._bufferService.cols?l%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(l/this._bufferService.cols)-1]:[l%this._bufferService.cols,this.selectionStart[1]+Math.floor(l/this._bufferService.cols)]:[l,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const l=this.selectionStart[0]+this.selectionStartLength;return l>this._bufferService.cols?[l%this._bufferService.cols,this.selectionStart[1]+Math.floor(l/this._bufferService.cols)]:[Math.max(l,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const l=this.selectionStart,u=this.selectionEnd;return!(!l||!u)&&(l[1]>u[1]||l[1]===u[1]&&l[0]>u[0])}handleTrim(l){return this.selectionStart&&(this.selectionStart[1]-=l),this.selectionEnd&&(this.selectionEnd[1]-=l),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(a,o,l){var u=this&&this.__decorate||function(w,x,k,A){var T,M=arguments.length,E=M<3?x:A===null?A=Object.getOwnPropertyDescriptor(x,k):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(w,x,k,A);else for(var L=w.length-1;L>=0;L--)(T=w[L])&&(E=(M<3?T(E):M>3?T(x,k,E):T(x,k))||E);return M>3&&E&&Object.defineProperty(x,k,E),E},h=this&&this.__param||function(w,x){return function(k,A){x(k,A,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharSizeService=void 0;const f=l(2585),m=l(8460),g=l(844);let C=o.CharSizeService=class extends g.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(w,x,k){super(),this._optionsService=k,this.width=0,this.height=0,this._onCharSizeChange=this.register(new m.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new _(this._optionsService))}catch{this._measureStrategy=this.register(new v(w,x,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const w=this._measureStrategy.measure();w.width===this.width&&w.height===this.height||(this.width=w.width,this.height=w.height,this._onCharSizeChange.fire())}};o.CharSizeService=C=u([h(2,f.IOptionsService)],C);class S extends g.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(x,k){x!==void 0&&x>0&&k!==void 0&&k>0&&(this._result.width=x,this._result.height=k)}}class v extends S{constructor(x,k,A){super(),this._document=x,this._parentElement=k,this._optionsService=A,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class _ extends S{constructor(x){super(),this._optionsService=x,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const k=this._ctx.measureText("W");if(!("width"in k&&"fontBoundingBoxAscent"in k&&"fontBoundingBoxDescent"in k))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const x=this._ctx.measureText("W");return this._validateAndSet(x.width,x.fontBoundingBoxAscent+x.fontBoundingBoxDescent),this._result}}},4269:function(a,o,l){var u=this&&this.__decorate||function(_,w,x,k){var A,T=arguments.length,M=T<3?w:k===null?k=Object.getOwnPropertyDescriptor(w,x):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(_,w,x,k);else for(var E=_.length-1;E>=0;E--)(A=_[E])&&(M=(T<3?A(M):T>3?A(w,x,M):A(w,x))||M);return T>3&&M&&Object.defineProperty(w,x,M),M},h=this&&this.__param||function(_,w){return function(x,k){w(x,k,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharacterJoinerService=o.JoinedCellData=void 0;const f=l(3734),m=l(643),g=l(511),C=l(2585);class S extends f.AttributeData{constructor(w,x,k){super(),this.content=0,this.combinedData="",this.fg=w.fg,this.bg=w.bg,this.combinedData=x,this._width=k}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(w){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.JoinedCellData=S;let v=o.CharacterJoinerService=class W3{constructor(w){this._bufferService=w,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new g.CellData}register(w){const x={id:this._nextCharacterJoinerId++,handler:w};return this._characterJoiners.push(x),x.id}deregister(w){for(let x=0;x<this._characterJoiners.length;x++)if(this._characterJoiners[x].id===w)return this._characterJoiners.splice(x,1),!0;return!1}getJoinedCharacters(w){if(this._characterJoiners.length===0)return[];const x=this._bufferService.buffer.lines.get(w);if(!x||x.length===0)return[];const k=[],A=x.translateToString(!0);let T=0,M=0,E=0,L=x.getFg(0),D=x.getBg(0);for(let O=0;O<x.getTrimmedLength();O++)if(x.loadCell(O,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==L||this._workCell.bg!==D){if(O-T>1){const j=this._getJoinedRanges(A,E,M,x,T);for(let U=0;U<j.length;U++)k.push(j[U])}T=O,E=M,L=this._workCell.fg,D=this._workCell.bg}M+=this._workCell.getChars().length||m.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-T>1){const O=this._getJoinedRanges(A,E,M,x,T);for(let j=0;j<O.length;j++)k.push(O[j])}return k}_getJoinedRanges(w,x,k,A,T){const M=w.substring(x,k);let E=[];try{E=this._characterJoiners[0].handler(M)}catch(L){console.error(L)}for(let L=1;L<this._characterJoiners.length;L++)try{const D=this._characterJoiners[L].handler(M);for(let O=0;O<D.length;O++)W3._mergeRanges(E,D[O])}catch(D){console.error(D)}return this._stringRangesToCellRanges(E,A,T),E}_stringRangesToCellRanges(w,x,k){let A=0,T=!1,M=0,E=w[A];if(E){for(let L=k;L<this._bufferService.cols;L++){const D=x.getWidth(L),O=x.getString(L).length||m.WHITESPACE_CELL_CHAR.length;if(D!==0){if(!T&&E[0]<=M&&(E[0]=L,T=!0),E[1]<=M){if(E[1]=L,E=w[++A],!E)break;E[0]<=M?(E[0]=L,T=!0):T=!1}M+=O}}E&&(E[1]=this._bufferService.cols)}}static _mergeRanges(w,x){let k=!1;for(let A=0;A<w.length;A++){const T=w[A];if(k){if(x[1]<=T[0])return w[A-1][1]=x[1],w;if(x[1]<=T[1])return w[A-1][1]=Math.max(x[1],T[1]),w.splice(A,1),w;w.splice(A,1),A--}else{if(x[1]<=T[0])return w.splice(A,0,x),w;if(x[1]<=T[1])return T[0]=Math.min(x[0],T[0]),w;x[0]<T[1]&&(T[0]=Math.min(x[0],T[0]),k=!0)}}return k?w[w.length-1][1]=x[1]:w.push(x),w}};o.CharacterJoinerService=v=u([h(0,C.IBufferService)],v)},5114:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreBrowserService=void 0;const u=l(844),h=l(8460),f=l(3656);class m extends u.Disposable{constructor(S,v,_){super(),this._textarea=S,this._window=v,this.mainDocument=_,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new g(this._window),this._onDprChange=this.register(new h.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new h.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((w=>this._screenDprMonitor.setWindow(w)))),this.register((0,h.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(S){this._window!==S&&(this._window=S,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}o.CoreBrowserService=m;class g extends u.Disposable{constructor(S){super(),this._parentWindow=S,this._windowResizeListener=this.register(new u.MutableDisposable),this._onDprChange=this.register(new h.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,u.toDisposable)((()=>this.clearListener())))}setWindow(S){this._parentWindow=S,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,f.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LinkProviderService=void 0;const u=l(844);class h extends u.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,u.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(m){return this.linkProviders.push(m),{dispose:()=>{const g=this.linkProviders.indexOf(m);g!==-1&&this.linkProviders.splice(g,1)}}}}o.LinkProviderService=h},8934:function(a,o,l){var u=this&&this.__decorate||function(C,S,v,_){var w,x=arguments.length,k=x<3?S:_===null?_=Object.getOwnPropertyDescriptor(S,v):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(C,S,v,_);else for(var A=C.length-1;A>=0;A--)(w=C[A])&&(k=(x<3?w(k):x>3?w(S,v,k):w(S,v))||k);return x>3&&k&&Object.defineProperty(S,v,k),k},h=this&&this.__param||function(C,S){return function(v,_){S(v,_,C)}};Object.defineProperty(o,"__esModule",{value:!0}),o.MouseService=void 0;const f=l(4725),m=l(9806);let g=o.MouseService=class{constructor(C,S){this._renderService=C,this._charSizeService=S}getCoords(C,S,v,_,w){return(0,m.getCoords)(window,C,S,v,_,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,w)}getMouseReportCoords(C,S){const v=(0,m.getCoordsRelativeToElement)(window,C,S);if(this._charSizeService.hasValidSize)return v[0]=Math.min(Math.max(v[0],0),this._renderService.dimensions.css.canvas.width-1),v[1]=Math.min(Math.max(v[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(v[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(v[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(v[0]),y:Math.floor(v[1])}}};o.MouseService=g=u([h(0,f.IRenderService),h(1,f.ICharSizeService)],g)},3230:function(a,o,l){var u=this&&this.__decorate||function(w,x,k,A){var T,M=arguments.length,E=M<3?x:A===null?A=Object.getOwnPropertyDescriptor(x,k):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(w,x,k,A);else for(var L=w.length-1;L>=0;L--)(T=w[L])&&(E=(M<3?T(E):M>3?T(x,k,E):T(x,k))||E);return M>3&&E&&Object.defineProperty(x,k,E),E},h=this&&this.__param||function(w,x){return function(k,A){x(k,A,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.RenderService=void 0;const f=l(6193),m=l(4725),g=l(8460),C=l(844),S=l(7226),v=l(2585);let _=o.RenderService=class extends C.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(w,x,k,A,T,M,E,L){super(),this._rowCount=w,this._charSizeService=A,this._renderer=this.register(new C.MutableDisposable),this._pausedResizeTask=new S.DebouncedIdleTask,this._observerDisposable=this.register(new C.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new g.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new g.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new g.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new g.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new f.RenderDebouncer(((D,O)=>this._renderRows(D,O)),E),this.register(this._renderDebouncer),this.register(E.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(M.onResize((()=>this._fullRefresh()))),this.register(M.buffers.onBufferActivate((()=>this._renderer.value?.clear()))),this.register(k.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(T.onDecorationRegistered((()=>this._fullRefresh()))),this.register(T.onDecorationRemoved((()=>this._fullRefresh()))),this.register(k.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(M.cols,M.rows),this._fullRefresh()}))),this.register(k.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(M.buffer.y,M.buffer.y,!0)))),this.register(L.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(E.window,x),this.register(E.onWindowChange((D=>this._registerIntersectionObserver(D,x))))}_registerIntersectionObserver(w,x){if("IntersectionObserver"in w){const k=new w.IntersectionObserver((A=>this._handleIntersectionChange(A[A.length-1])),{threshold:0});k.observe(x),this._observerDisposable.value=(0,C.toDisposable)((()=>k.disconnect()))}}_handleIntersectionChange(w){this._isPaused=w.isIntersecting===void 0?w.intersectionRatio===0:!w.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(w,x,k=!1){this._isPaused?this._needsFullRefresh=!0:(k||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(w,x,this._rowCount))}_renderRows(w,x){this._renderer.value&&(w=Math.min(w,this._rowCount-1),x=Math.min(x,this._rowCount-1),this._renderer.value.renderRows(w,x),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:w,end:x}),this._onRender.fire({start:w,end:x}),this._isNextRenderRedrawOnly=!0)}resize(w,x){this._rowCount=x,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(w){this._renderer.value=w,this._renderer.value&&(this._renderer.value.onRequestRedraw((x=>this.refreshRows(x.start,x.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(w){return this._renderDebouncer.addRefreshCallback(w)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(w,x){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.value?.handleResize(w,x))):this._renderer.value.handleResize(w,x),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(w,x,k){this._selectionState.start=w,this._selectionState.end=x,this._selectionState.columnSelectMode=k,this._renderer.value?.handleSelectionChanged(w,x,k)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};o.RenderService=_=u([h(2,v.IOptionsService),h(3,m.ICharSizeService),h(4,v.IDecorationService),h(5,v.IBufferService),h(6,m.ICoreBrowserService),h(7,m.IThemeService)],_)},9312:function(a,o,l){var u=this&&this.__decorate||function(E,L,D,O){var j,U=arguments.length,q=U<3?L:O===null?O=Object.getOwnPropertyDescriptor(L,D):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")q=Reflect.decorate(E,L,D,O);else for(var K=E.length-1;K>=0;K--)(j=E[K])&&(q=(U<3?j(q):U>3?j(L,D,q):j(L,D))||q);return U>3&&q&&Object.defineProperty(L,D,q),q},h=this&&this.__param||function(E,L){return function(D,O){L(D,O,E)}};Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionService=void 0;const f=l(9806),m=l(9504),g=l(456),C=l(4725),S=l(8460),v=l(844),_=l(6114),w=l(4841),x=l(511),k=l(2585),A="",T=new RegExp(A,"g");let M=o.SelectionService=class extends v.Disposable{constructor(E,L,D,O,j,U,q,K,$){super(),this._element=E,this._screenElement=L,this._linkifier=D,this._bufferService=O,this._coreService=j,this._mouseService=U,this._optionsService=q,this._renderService=K,this._coreBrowserService=$,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new x.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new S.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new S.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new S.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new S.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=Y=>this._handleMouseMove(Y),this._mouseUpListener=Y=>this._handleMouseUp(Y),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((Y=>this._handleTrim(Y))),this.register(this._bufferService.buffers.onBufferActivate((Y=>this._handleBufferActivate(Y)))),this.enable(),this._model=new g.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,v.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const E=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!(!E||!L||E[0]===L[0]&&E[1]===L[1])}get selectionText(){const E=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;if(!E||!L)return"";const D=this._bufferService.buffer,O=[];if(this._activeSelectionMode===3){if(E[0]===L[0])return"";const j=E[0]<L[0]?E[0]:L[0],U=E[0]<L[0]?L[0]:E[0];for(let q=E[1];q<=L[1];q++){const K=D.translateBufferLineToString(q,!0,j,U);O.push(K)}}else{const j=E[1]===L[1]?L[0]:void 0;O.push(D.translateBufferLineToString(E[1],!0,E[0],j));for(let U=E[1]+1;U<=L[1]-1;U++){const q=D.lines.get(U),K=D.translateBufferLineToString(U,!0);q?.isWrapped?O[O.length-1]+=K:O.push(K)}if(E[1]!==L[1]){const U=D.lines.get(L[1]),q=D.translateBufferLineToString(L[1],!0,0,L[0]);U&&U.isWrapped?O[O.length-1]+=q:O.push(q)}}return O.map((j=>j.replace(T," "))).join(_.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(E){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),_.isLinux&&E&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(E){const L=this._getMouseBufferCoords(E),D=this._model.finalSelectionStart,O=this._model.finalSelectionEnd;return!!(D&&O&&L)&&this._areCoordsInSelection(L,D,O)}isCellInSelection(E,L){const D=this._model.finalSelectionStart,O=this._model.finalSelectionEnd;return!(!D||!O)&&this._areCoordsInSelection([E,L],D,O)}_areCoordsInSelection(E,L,D){return E[1]>L[1]&&E[1]<D[1]||L[1]===D[1]&&E[1]===L[1]&&E[0]>=L[0]&&E[0]<D[0]||L[1]<D[1]&&E[1]===D[1]&&E[0]<D[0]||L[1]<D[1]&&E[1]===L[1]&&E[0]>=L[0]}_selectWordAtCursor(E,L){const D=this._linkifier.currentLink?.link?.range;if(D)return this._model.selectionStart=[D.start.x-1,D.start.y-1],this._model.selectionStartLength=(0,w.getRangeLength)(D,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const O=this._getMouseBufferCoords(E);return!!O&&(this._selectWordAt(O,L),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(E,L){this._model.clearSelection(),E=Math.max(E,0),L=Math.min(L,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,E],this._model.selectionEnd=[this._bufferService.cols,L],this.refresh(),this._onSelectionChange.fire()}_handleTrim(E){this._model.handleTrim(E)&&this.refresh()}_getMouseBufferCoords(E){const L=this._mouseService.getCoords(E,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(L)return L[0]--,L[1]--,L[1]+=this._bufferService.buffer.ydisp,L}_getMouseEventScrollAmount(E){let L=(0,f.getCoordsRelativeToElement)(this._coreBrowserService.window,E,this._screenElement)[1];const D=this._renderService.dimensions.css.canvas.height;return L>=0&&L<=D?0:(L>D&&(L-=D),L=Math.min(Math.max(L,-50),50),L/=50,L/Math.abs(L)+Math.round(14*L))}shouldForceSelection(E){return _.isMac?E.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:E.shiftKey}handleMouseDown(E){if(this._mouseDownTimeStamp=E.timeStamp,(E.button!==2||!this.hasSelection)&&E.button===0){if(!this._enabled){if(!this.shouldForceSelection(E))return;E.stopPropagation()}E.preventDefault(),this._dragScrollAmount=0,this._enabled&&E.shiftKey?this._handleIncrementalClick(E):E.detail===1?this._handleSingleClick(E):E.detail===2?this._handleDoubleClick(E):E.detail===3&&this._handleTripleClick(E),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(E){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(E))}_handleSingleClick(E){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(E)?3:0,this._model.selectionStart=this._getMouseBufferCoords(E),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const L=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);L&&L.length!==this._model.selectionStart[0]&&L.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(E){this._selectWordAtCursor(E,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(E){const L=this._getMouseBufferCoords(E);L&&(this._activeSelectionMode=2,this._selectLineAt(L[1]))}shouldColumnSelect(E){return E.altKey&&!(_.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(E){if(E.stopImmediatePropagation(),!this._model.selectionStart)return;const L=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(E),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(E),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const D=this._bufferService.buffer;if(this._model.selectionEnd[1]<D.lines.length){const O=D.lines.get(this._model.selectionEnd[1]);O&&O.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}L&&L[0]===this._model.selectionEnd[0]&&L[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const E=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(E.ydisp+this._bufferService.rows,E.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=E.ydisp),this.refresh()}}_handleMouseUp(E){const L=E.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&L<500&&E.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const D=this._mouseService.getCoords(E,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(D&&D[0]!==void 0&&D[1]!==void 0){const O=(0,m.moveToCellSequence)(D[0]-1,D[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(O,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const E=this._model.finalSelectionStart,L=this._model.finalSelectionEnd,D=!(!E||!L||E[0]===L[0]&&E[1]===L[1]);D?E&&L&&(this._oldSelectionStart&&this._oldSelectionEnd&&E[0]===this._oldSelectionStart[0]&&E[1]===this._oldSelectionStart[1]&&L[0]===this._oldSelectionEnd[0]&&L[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(E,L,D)):this._oldHasSelection&&this._fireOnSelectionChange(E,L,D)}_fireOnSelectionChange(E,L,D){this._oldSelectionStart=E,this._oldSelectionEnd=L,this._oldHasSelection=D,this._onSelectionChange.fire()}_handleBufferActivate(E){this.clearSelection(),this._trimListener.dispose(),this._trimListener=E.activeBuffer.lines.onTrim((L=>this._handleTrim(L)))}_convertViewportColToCharacterIndex(E,L){let D=L;for(let O=0;L>=O;O++){const j=E.loadCell(O,this._workCell).getChars().length;this._workCell.getWidth()===0?D--:j>1&&L!==O&&(D+=j-1)}return D}setSelection(E,L,D){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[E,L],this._model.selectionStartLength=D,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(E){this._isClickInSelection(E)||(this._selectWordAtCursor(E,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(E,L,D=!0,O=!0){if(E[0]>=this._bufferService.cols)return;const j=this._bufferService.buffer,U=j.lines.get(E[1]);if(!U)return;const q=j.translateBufferLineToString(E[1],!1);let K=this._convertViewportColToCharacterIndex(U,E[0]),$=K;const Y=E[0]-K;let Q=0,F=0,N=0,z=0;if(q.charAt(K)===" "){for(;K>0&&q.charAt(K-1)===" ";)K--;for(;$<q.length&&q.charAt($+1)===" ";)$++}else{let ee=E[0],ue=E[0];U.getWidth(ee)===0&&(Q++,ee--),U.getWidth(ue)===2&&(F++,ue++);const ce=U.getString(ue).length;for(ce>1&&(z+=ce-1,$+=ce-1);ee>0&&K>0&&!this._isCharWordSeparator(U.loadCell(ee-1,this._workCell));){U.loadCell(ee-1,this._workCell);const J=this._workCell.getChars().length;this._workCell.getWidth()===0?(Q++,ee--):J>1&&(N+=J-1,K-=J-1),K--,ee--}for(;ue<U.length&&$+1<q.length&&!this._isCharWordSeparator(U.loadCell(ue+1,this._workCell));){U.loadCell(ue+1,this._workCell);const J=this._workCell.getChars().length;this._workCell.getWidth()===2?(F++,ue++):J>1&&(z+=J-1,$+=J-1),$++,ue++}}$++;let G=K+Y-Q+N,H=Math.min(this._bufferService.cols,$-K+Q+F-N-z);if(L||q.slice(K,$).trim()!==""){if(D&&G===0&&U.getCodePoint(0)!==32){const ee=j.lines.get(E[1]-1);if(ee&&U.isWrapped&&ee.getCodePoint(this._bufferService.cols-1)!==32){const ue=this._getWordAt([this._bufferService.cols-1,E[1]-1],!1,!0,!1);if(ue){const ce=this._bufferService.cols-ue.start;G-=ce,H+=ce}}}if(O&&G+H===this._bufferService.cols&&U.getCodePoint(this._bufferService.cols-1)!==32){const ee=j.lines.get(E[1]+1);if(ee?.isWrapped&&ee.getCodePoint(0)!==32){const ue=this._getWordAt([0,E[1]+1],!1,!1,!0);ue&&(H+=ue.length)}}return{start:G,length:H}}}_selectWordAt(E,L){const D=this._getWordAt(E,L);if(D){for(;D.start<0;)D.start+=this._bufferService.cols,E[1]--;this._model.selectionStart=[D.start,E[1]],this._model.selectionStartLength=D.length}}_selectToWordAt(E){const L=this._getWordAt(E,!0);if(L){let D=E[1];for(;L.start<0;)L.start+=this._bufferService.cols,D--;if(!this._model.areSelectionValuesReversed())for(;L.start+L.length>this._bufferService.cols;)L.length-=this._bufferService.cols,D++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?L.start:L.start+L.length,D]}}_isCharWordSeparator(E){return E.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(E.getChars())>=0}_selectLineAt(E){const L=this._bufferService.buffer.getWrappedRangeForLine(E),D={start:{x:0,y:L.first},end:{x:this._bufferService.cols-1,y:L.last}};this._model.selectionStart=[0,L.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,w.getRangeLength)(D,this._bufferService.cols)}};o.SelectionService=M=u([h(3,k.IBufferService),h(4,k.ICoreService),h(5,C.IMouseService),h(6,k.IOptionsService),h(7,C.IRenderService),h(8,C.ICoreBrowserService)],M)},4725:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ILinkProviderService=o.IThemeService=o.ICharacterJoinerService=o.ISelectionService=o.IRenderService=o.IMouseService=o.ICoreBrowserService=o.ICharSizeService=void 0;const u=l(8343);o.ICharSizeService=(0,u.createDecorator)("CharSizeService"),o.ICoreBrowserService=(0,u.createDecorator)("CoreBrowserService"),o.IMouseService=(0,u.createDecorator)("MouseService"),o.IRenderService=(0,u.createDecorator)("RenderService"),o.ISelectionService=(0,u.createDecorator)("SelectionService"),o.ICharacterJoinerService=(0,u.createDecorator)("CharacterJoinerService"),o.IThemeService=(0,u.createDecorator)("ThemeService"),o.ILinkProviderService=(0,u.createDecorator)("LinkProviderService")},6731:function(a,o,l){var u=this&&this.__decorate||function(M,E,L,D){var O,j=arguments.length,U=j<3?E:D===null?D=Object.getOwnPropertyDescriptor(E,L):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")U=Reflect.decorate(M,E,L,D);else for(var q=M.length-1;q>=0;q--)(O=M[q])&&(U=(j<3?O(U):j>3?O(E,L,U):O(E,L))||U);return j>3&&U&&Object.defineProperty(E,L,U),U},h=this&&this.__param||function(M,E){return function(L,D){E(L,D,M)}};Object.defineProperty(o,"__esModule",{value:!0}),o.ThemeService=o.DEFAULT_ANSI_COLORS=void 0;const f=l(7239),m=l(8055),g=l(8460),C=l(844),S=l(2585),v=m.css.toColor("#ffffff"),_=m.css.toColor("#000000"),w=m.css.toColor("#ffffff"),x=m.css.toColor("#000000"),k={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};o.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const M=[m.css.toColor("#2e3436"),m.css.toColor("#cc0000"),m.css.toColor("#4e9a06"),m.css.toColor("#c4a000"),m.css.toColor("#3465a4"),m.css.toColor("#75507b"),m.css.toColor("#06989a"),m.css.toColor("#d3d7cf"),m.css.toColor("#555753"),m.css.toColor("#ef2929"),m.css.toColor("#8ae234"),m.css.toColor("#fce94f"),m.css.toColor("#729fcf"),m.css.toColor("#ad7fa8"),m.css.toColor("#34e2e2"),m.css.toColor("#eeeeec")],E=[0,95,135,175,215,255];for(let L=0;L<216;L++){const D=E[L/36%6|0],O=E[L/6%6|0],j=E[L%6];M.push({css:m.channels.toCss(D,O,j),rgba:m.channels.toRgba(D,O,j)})}for(let L=0;L<24;L++){const D=8+10*L;M.push({css:m.channels.toCss(D,D,D),rgba:m.channels.toRgba(D,D,D)})}return M})());let A=o.ThemeService=class extends C.Disposable{get colors(){return this._colors}constructor(M){super(),this._optionsService=M,this._contrastCache=new f.ColorContrastCache,this._halfContrastCache=new f.ColorContrastCache,this._onChangeColors=this.register(new g.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:v,background:_,cursor:w,cursorAccent:x,selectionForeground:void 0,selectionBackgroundTransparent:k,selectionBackgroundOpaque:m.color.blend(_,k),selectionInactiveBackgroundTransparent:k,selectionInactiveBackgroundOpaque:m.color.blend(_,k),ansi:o.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(M={}){const E=this._colors;if(E.foreground=T(M.foreground,v),E.background=T(M.background,_),E.cursor=T(M.cursor,w),E.cursorAccent=T(M.cursorAccent,x),E.selectionBackgroundTransparent=T(M.selectionBackground,k),E.selectionBackgroundOpaque=m.color.blend(E.background,E.selectionBackgroundTransparent),E.selectionInactiveBackgroundTransparent=T(M.selectionInactiveBackground,E.selectionBackgroundTransparent),E.selectionInactiveBackgroundOpaque=m.color.blend(E.background,E.selectionInactiveBackgroundTransparent),E.selectionForeground=M.selectionForeground?T(M.selectionForeground,m.NULL_COLOR):void 0,E.selectionForeground===m.NULL_COLOR&&(E.selectionForeground=void 0),m.color.isOpaque(E.selectionBackgroundTransparent)&&(E.selectionBackgroundTransparent=m.color.opacity(E.selectionBackgroundTransparent,.3)),m.color.isOpaque(E.selectionInactiveBackgroundTransparent)&&(E.selectionInactiveBackgroundTransparent=m.color.opacity(E.selectionInactiveBackgroundTransparent,.3)),E.ansi=o.DEFAULT_ANSI_COLORS.slice(),E.ansi[0]=T(M.black,o.DEFAULT_ANSI_COLORS[0]),E.ansi[1]=T(M.red,o.DEFAULT_ANSI_COLORS[1]),E.ansi[2]=T(M.green,o.DEFAULT_ANSI_COLORS[2]),E.ansi[3]=T(M.yellow,o.DEFAULT_ANSI_COLORS[3]),E.ansi[4]=T(M.blue,o.DEFAULT_ANSI_COLORS[4]),E.ansi[5]=T(M.magenta,o.DEFAULT_ANSI_COLORS[5]),E.ansi[6]=T(M.cyan,o.DEFAULT_ANSI_COLORS[6]),E.ansi[7]=T(M.white,o.DEFAULT_ANSI_COLORS[7]),E.ansi[8]=T(M.brightBlack,o.DEFAULT_ANSI_COLORS[8]),E.ansi[9]=T(M.brightRed,o.DEFAULT_ANSI_COLORS[9]),E.ansi[10]=T(M.brightGreen,o.DEFAULT_ANSI_COLORS[10]),E.ansi[11]=T(M.brightYellow,o.DEFAULT_ANSI_COLORS[11]),E.ansi[12]=T(M.brightBlue,o.DEFAULT_ANSI_COLORS[12]),E.ansi[13]=T(M.brightMagenta,o.DEFAULT_ANSI_COLORS[13]),E.ansi[14]=T(M.brightCyan,o.DEFAULT_ANSI_COLORS[14]),E.ansi[15]=T(M.brightWhite,o.DEFAULT_ANSI_COLORS[15]),M.extendedAnsi){const L=Math.min(E.ansi.length-16,M.extendedAnsi.length);for(let D=0;D<L;D++)E.ansi[D+16]=T(M.extendedAnsi[D],o.DEFAULT_ANSI_COLORS[D+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(M){this._restoreColor(M),this._onChangeColors.fire(this.colors)}_restoreColor(M){if(M!==void 0)switch(M){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[M]=this._restoreColors.ansi[M]}else for(let E=0;E<this._restoreColors.ansi.length;++E)this._colors.ansi[E]=this._restoreColors.ansi[E]}modifyColors(M){M(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function T(M,E){if(M!==void 0)try{return m.css.toColor(M)}catch{}return E}o.ThemeService=A=u([h(0,S.IOptionsService)],A)},6349:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CircularList=void 0;const u=l(8460),h=l(844);class f extends h.Disposable{constructor(g){super(),this._maxLength=g,this.onDeleteEmitter=this.register(new u.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new u.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new u.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(g){if(this._maxLength===g)return;const C=new Array(g);for(let S=0;S<Math.min(g,this.length);S++)C[S]=this._array[this._getCyclicIndex(S)];this._array=C,this._maxLength=g,this._startIndex=0}get length(){return this._length}set length(g){if(g>this._length)for(let C=this._length;C<g;C++)this._array[C]=void 0;this._length=g}get(g){return this._array[this._getCyclicIndex(g)]}set(g,C){this._array[this._getCyclicIndex(g)]=C}push(g){this._array[this._getCyclicIndex(this._length)]=g,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(g,C,...S){if(C){for(let v=g;v<this._length-C;v++)this._array[this._getCyclicIndex(v)]=this._array[this._getCyclicIndex(v+C)];this._length-=C,this.onDeleteEmitter.fire({index:g,amount:C})}for(let v=this._length-1;v>=g;v--)this._array[this._getCyclicIndex(v+S.length)]=this._array[this._getCyclicIndex(v)];for(let v=0;v<S.length;v++)this._array[this._getCyclicIndex(g+v)]=S[v];if(S.length&&this.onInsertEmitter.fire({index:g,amount:S.length}),this._length+S.length>this._maxLength){const v=this._length+S.length-this._maxLength;this._startIndex+=v,this._length=this._maxLength,this.onTrimEmitter.fire(v)}else this._length+=S.length}trimStart(g){g>this._length&&(g=this._length),this._startIndex+=g,this._length-=g,this.onTrimEmitter.fire(g)}shiftElements(g,C,S){if(!(C<=0)){if(g<0||g>=this._length)throw new Error("start argument out of range");if(g+S<0)throw new Error("Cannot shift elements in list beyond index 0");if(S>0){for(let _=C-1;_>=0;_--)this.set(g+_+S,this.get(g+_));const v=g+C+S-this._length;if(v>0)for(this._length+=v;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let v=0;v<C;v++)this.set(g+v+S,this.get(g+v))}}_getCyclicIndex(g){return(this._startIndex+g)%this._maxLength}}o.CircularList=f},1439:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.clone=void 0,o.clone=function l(u,h=5){if(typeof u!="object")return u;const f=Array.isArray(u)?[]:{};for(const m in u)f[m]=h<=1?u[m]:u[m]&&l(u[m],h-1);return f}},8055:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.contrastRatio=o.toPaddedHex=o.rgba=o.rgb=o.css=o.color=o.channels=o.NULL_COLOR=void 0;let l=0,u=0,h=0,f=0;var m,g,C,S,v;function _(x){const k=x.toString(16);return k.length<2?"0"+k:k}function w(x,k){return x<k?(k+.05)/(x+.05):(x+.05)/(k+.05)}o.NULL_COLOR={css:"#00000000",rgba:0},(function(x){x.toCss=function(k,A,T,M){return M!==void 0?`#${_(k)}${_(A)}${_(T)}${_(M)}`:`#${_(k)}${_(A)}${_(T)}`},x.toRgba=function(k,A,T,M=255){return(k<<24|A<<16|T<<8|M)>>>0},x.toColor=function(k,A,T,M){return{css:x.toCss(k,A,T,M),rgba:x.toRgba(k,A,T,M)}}})(m||(o.channels=m={})),(function(x){function k(A,T){return f=Math.round(255*T),[l,u,h]=v.toChannels(A.rgba),{css:m.toCss(l,u,h,f),rgba:m.toRgba(l,u,h,f)}}x.blend=function(A,T){if(f=(255&T.rgba)/255,f===1)return{css:T.css,rgba:T.rgba};const M=T.rgba>>24&255,E=T.rgba>>16&255,L=T.rgba>>8&255,D=A.rgba>>24&255,O=A.rgba>>16&255,j=A.rgba>>8&255;return l=D+Math.round((M-D)*f),u=O+Math.round((E-O)*f),h=j+Math.round((L-j)*f),{css:m.toCss(l,u,h),rgba:m.toRgba(l,u,h)}},x.isOpaque=function(A){return(255&A.rgba)==255},x.ensureContrastRatio=function(A,T,M){const E=v.ensureContrastRatio(A.rgba,T.rgba,M);if(E)return m.toColor(E>>24&255,E>>16&255,E>>8&255)},x.opaque=function(A){const T=(255|A.rgba)>>>0;return[l,u,h]=v.toChannels(T),{css:m.toCss(l,u,h),rgba:T}},x.opacity=k,x.multiplyOpacity=function(A,T){return f=255&A.rgba,k(A,f*T/255)},x.toColorRGB=function(A){return[A.rgba>>24&255,A.rgba>>16&255,A.rgba>>8&255]}})(g||(o.color=g={})),(function(x){let k,A;try{const T=document.createElement("canvas");T.width=1,T.height=1;const M=T.getContext("2d",{willReadFrequently:!0});M&&(k=M,k.globalCompositeOperation="copy",A=k.createLinearGradient(0,0,1,1))}catch{}x.toColor=function(T){if(T.match(/#[\da-f]{3,8}/i))switch(T.length){case 4:return l=parseInt(T.slice(1,2).repeat(2),16),u=parseInt(T.slice(2,3).repeat(2),16),h=parseInt(T.slice(3,4).repeat(2),16),m.toColor(l,u,h);case 5:return l=parseInt(T.slice(1,2).repeat(2),16),u=parseInt(T.slice(2,3).repeat(2),16),h=parseInt(T.slice(3,4).repeat(2),16),f=parseInt(T.slice(4,5).repeat(2),16),m.toColor(l,u,h,f);case 7:return{css:T,rgba:(parseInt(T.slice(1),16)<<8|255)>>>0};case 9:return{css:T,rgba:parseInt(T.slice(1),16)>>>0}}const M=T.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(M)return l=parseInt(M[1]),u=parseInt(M[2]),h=parseInt(M[3]),f=Math.round(255*(M[5]===void 0?1:parseFloat(M[5]))),m.toColor(l,u,h,f);if(!k||!A)throw new Error("css.toColor: Unsupported css format");if(k.fillStyle=A,k.fillStyle=T,typeof k.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(k.fillRect(0,0,1,1),[l,u,h,f]=k.getImageData(0,0,1,1).data,f!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:m.toRgba(l,u,h,f),css:T}}})(C||(o.css=C={})),(function(x){function k(A,T,M){const E=A/255,L=T/255,D=M/255;return .2126*(E<=.03928?E/12.92:Math.pow((E+.055)/1.055,2.4))+.7152*(L<=.03928?L/12.92:Math.pow((L+.055)/1.055,2.4))+.0722*(D<=.03928?D/12.92:Math.pow((D+.055)/1.055,2.4))}x.relativeLuminance=function(A){return k(A>>16&255,A>>8&255,255&A)},x.relativeLuminance2=k})(S||(o.rgb=S={})),(function(x){function k(T,M,E){const L=T>>24&255,D=T>>16&255,O=T>>8&255;let j=M>>24&255,U=M>>16&255,q=M>>8&255,K=w(S.relativeLuminance2(j,U,q),S.relativeLuminance2(L,D,O));for(;K<E&&(j>0||U>0||q>0);)j-=Math.max(0,Math.ceil(.1*j)),U-=Math.max(0,Math.ceil(.1*U)),q-=Math.max(0,Math.ceil(.1*q)),K=w(S.relativeLuminance2(j,U,q),S.relativeLuminance2(L,D,O));return(j<<24|U<<16|q<<8|255)>>>0}function A(T,M,E){const L=T>>24&255,D=T>>16&255,O=T>>8&255;let j=M>>24&255,U=M>>16&255,q=M>>8&255,K=w(S.relativeLuminance2(j,U,q),S.relativeLuminance2(L,D,O));for(;K<E&&(j<255||U<255||q<255);)j=Math.min(255,j+Math.ceil(.1*(255-j))),U=Math.min(255,U+Math.ceil(.1*(255-U))),q=Math.min(255,q+Math.ceil(.1*(255-q))),K=w(S.relativeLuminance2(j,U,q),S.relativeLuminance2(L,D,O));return(j<<24|U<<16|q<<8|255)>>>0}x.blend=function(T,M){if(f=(255&M)/255,f===1)return M;const E=M>>24&255,L=M>>16&255,D=M>>8&255,O=T>>24&255,j=T>>16&255,U=T>>8&255;return l=O+Math.round((E-O)*f),u=j+Math.round((L-j)*f),h=U+Math.round((D-U)*f),m.toRgba(l,u,h)},x.ensureContrastRatio=function(T,M,E){const L=S.relativeLuminance(T>>8),D=S.relativeLuminance(M>>8);if(w(L,D)<E){if(D<L){const U=k(T,M,E),q=w(L,S.relativeLuminance(U>>8));if(q<E){const K=A(T,M,E);return q>w(L,S.relativeLuminance(K>>8))?U:K}return U}const O=A(T,M,E),j=w(L,S.relativeLuminance(O>>8));if(j<E){const U=k(T,M,E);return j>w(L,S.relativeLuminance(U>>8))?O:U}return O}},x.reduceLuminance=k,x.increaseLuminance=A,x.toChannels=function(T){return[T>>24&255,T>>16&255,T>>8&255,255&T]}})(v||(o.rgba=v={})),o.toPaddedHex=_,o.contrastRatio=w},8969:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreTerminal=void 0;const u=l(844),h=l(2585),f=l(4348),m=l(7866),g=l(744),C=l(7302),S=l(6975),v=l(8460),_=l(1753),w=l(1480),x=l(7994),k=l(9282),A=l(5435),T=l(5981),M=l(2660);let E=!1;class L extends u.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new v.EventEmitter),this._onScroll.event((O=>{this._onScrollApi?.fire(O.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(O){for(const j in O)this.optionsService.options[j]=O[j]}constructor(O){super(),this._windowsWrappingHeuristics=this.register(new u.MutableDisposable),this._onBinary=this.register(new v.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new v.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new v.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new v.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new v.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new v.EventEmitter),this._instantiationService=new f.InstantiationService,this.optionsService=this.register(new C.OptionsService(O)),this._instantiationService.setService(h.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(g.BufferService)),this._instantiationService.setService(h.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(m.LogService)),this._instantiationService.setService(h.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(S.CoreService)),this._instantiationService.setService(h.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(_.CoreMouseService)),this._instantiationService.setService(h.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(w.UnicodeService)),this._instantiationService.setService(h.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(x.CharsetService),this._instantiationService.setService(h.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(M.OscLinkService),this._instantiationService.setService(h.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new A.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,v.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,v.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,v.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,v.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((j=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((j=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new T.WriteBuffer(((j,U)=>this._inputHandler.parse(j,U)))),this.register((0,v.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(O,j){this._writeBuffer.write(O,j)}writeSync(O,j){this._logService.logLevel<=h.LogLevelEnum.WARN&&!E&&(this._logService.warn("writeSync is unreliable and will be removed soon."),E=!0),this._writeBuffer.writeSync(O,j)}input(O,j=!0){this.coreService.triggerDataEvent(O,j)}resize(O,j){isNaN(O)||isNaN(j)||(O=Math.max(O,g.MINIMUM_COLS),j=Math.max(j,g.MINIMUM_ROWS),this._bufferService.resize(O,j))}scroll(O,j=!1){this._bufferService.scroll(O,j)}scrollLines(O,j,U){this._bufferService.scrollLines(O,j,U)}scrollPages(O){this.scrollLines(O*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(O){const j=O-this._bufferService.buffer.ydisp;j!==0&&this.scrollLines(j)}registerEscHandler(O,j){return this._inputHandler.registerEscHandler(O,j)}registerDcsHandler(O,j){return this._inputHandler.registerDcsHandler(O,j)}registerCsiHandler(O,j){return this._inputHandler.registerCsiHandler(O,j)}registerOscHandler(O,j){return this._inputHandler.registerOscHandler(O,j)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let O=!1;const j=this.optionsService.rawOptions.windowsPty;j&&j.buildNumber!==void 0&&j.buildNumber!==void 0?O=j.backend==="conpty"&&j.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(O=!0),O?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const O=[];O.push(this.onLineFeed(k.updateWindowsModeWrappedState.bind(null,this._bufferService))),O.push(this.registerCsiHandler({final:"H"},(()=>((0,k.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,u.toDisposable)((()=>{for(const j of O)j.dispose()}))}}}o.CoreTerminal=L},8460:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.runAndSubscribe=o.forwardEvent=o.EventEmitter=void 0,o.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=l=>(this._listeners.push(l),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===l)return void this._listeners.splice(u,1)}}})),this._event}fire(l,u){const h=[];for(let f=0;f<this._listeners.length;f++)h.push(this._listeners[f]);for(let f=0;f<h.length;f++)h[f].call(void 0,l,u)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},o.forwardEvent=function(l,u){return l((h=>u.fire(h)))},o.runAndSubscribe=function(l,u){return u(void 0),l((h=>u(h)))}},5435:function(a,o,l){var u=this&&this.__decorate||function(Q,F,N,z){var G,H=arguments.length,ee=H<3?F:z===null?z=Object.getOwnPropertyDescriptor(F,N):z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ee=Reflect.decorate(Q,F,N,z);else for(var ue=Q.length-1;ue>=0;ue--)(G=Q[ue])&&(ee=(H<3?G(ee):H>3?G(F,N,ee):G(F,N))||ee);return H>3&&ee&&Object.defineProperty(F,N,ee),ee},h=this&&this.__param||function(Q,F){return function(N,z){F(N,z,Q)}};Object.defineProperty(o,"__esModule",{value:!0}),o.InputHandler=o.WindowsOptionsReportType=void 0;const f=l(2584),m=l(7116),g=l(2015),C=l(844),S=l(482),v=l(8437),_=l(8460),w=l(643),x=l(511),k=l(3734),A=l(2585),T=l(1480),M=l(6242),E=l(6351),L=l(5941),D={"(":0,")":1,"*":2,"+":3,"-":1,".":2},O=131072;function j(Q,F){if(Q>24)return F.setWinLines||!1;switch(Q){case 1:return!!F.restoreWin;case 2:return!!F.minimizeWin;case 3:return!!F.setWinPosition;case 4:return!!F.setWinSizePixels;case 5:return!!F.raiseWin;case 6:return!!F.lowerWin;case 7:return!!F.refreshWin;case 8:return!!F.setWinSizeChars;case 9:return!!F.maximizeWin;case 10:return!!F.fullscreenWin;case 11:return!!F.getWinState;case 13:return!!F.getWinPosition;case 14:return!!F.getWinSizePixels;case 15:return!!F.getScreenSizePixels;case 16:return!!F.getCellSizePixels;case 18:return!!F.getWinSizeChars;case 19:return!!F.getScreenSizeChars;case 20:return!!F.getIconTitle;case 21:return!!F.getWinTitle;case 22:return!!F.pushTitle;case 23:return!!F.popTitle;case 24:return!!F.setWinLines}return!1}var U;(function(Q){Q[Q.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",Q[Q.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(U||(o.WindowsOptionsReportType=U={}));let q=0;class K extends C.Disposable{getAttrData(){return this._curAttrData}constructor(F,N,z,G,H,ee,ue,ce,J=new g.EscapeSequenceParser){super(),this._bufferService=F,this._charsetService=N,this._coreService=z,this._logService=G,this._optionsService=H,this._oscLinkService=ee,this._coreMouseService=ue,this._unicodeService=ce,this._parser=J,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new S.StringToUtf32,this._utf8Decoder=new S.Utf8ToUtf32,this._workCell=new x.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=v.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=v.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new _.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new _.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new _.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new _.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new _.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new _.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new _.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new _.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new _.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new _.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new _.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new _.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new _.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new $(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((V=>this._activeBuffer=V.activeBuffer))),this._parser.setCsiHandlerFallback(((V,ne)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(V),params:ne.toArray()})})),this._parser.setEscHandlerFallback((V=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(V)})})),this._parser.setExecuteHandlerFallback((V=>{this._logService.debug("Unknown EXECUTE code: ",{code:V})})),this._parser.setOscHandlerFallback(((V,ne,he)=>{this._logService.debug("Unknown OSC code: ",{identifier:V,action:ne,data:he})})),this._parser.setDcsHandlerFallback(((V,ne,he)=>{ne==="HOOK"&&(he=he.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(V),action:ne,payload:he})})),this._parser.setPrintHandler(((V,ne,he)=>this.print(V,ne,he))),this._parser.registerCsiHandler({final:"@"},(V=>this.insertChars(V))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(V=>this.scrollLeft(V))),this._parser.registerCsiHandler({final:"A"},(V=>this.cursorUp(V))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(V=>this.scrollRight(V))),this._parser.registerCsiHandler({final:"B"},(V=>this.cursorDown(V))),this._parser.registerCsiHandler({final:"C"},(V=>this.cursorForward(V))),this._parser.registerCsiHandler({final:"D"},(V=>this.cursorBackward(V))),this._parser.registerCsiHandler({final:"E"},(V=>this.cursorNextLine(V))),this._parser.registerCsiHandler({final:"F"},(V=>this.cursorPrecedingLine(V))),this._parser.registerCsiHandler({final:"G"},(V=>this.cursorCharAbsolute(V))),this._parser.registerCsiHandler({final:"H"},(V=>this.cursorPosition(V))),this._parser.registerCsiHandler({final:"I"},(V=>this.cursorForwardTab(V))),this._parser.registerCsiHandler({final:"J"},(V=>this.eraseInDisplay(V,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(V=>this.eraseInDisplay(V,!0))),this._parser.registerCsiHandler({final:"K"},(V=>this.eraseInLine(V,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(V=>this.eraseInLine(V,!0))),this._parser.registerCsiHandler({final:"L"},(V=>this.insertLines(V))),this._parser.registerCsiHandler({final:"M"},(V=>this.deleteLines(V))),this._parser.registerCsiHandler({final:"P"},(V=>this.deleteChars(V))),this._parser.registerCsiHandler({final:"S"},(V=>this.scrollUp(V))),this._parser.registerCsiHandler({final:"T"},(V=>this.scrollDown(V))),this._parser.registerCsiHandler({final:"X"},(V=>this.eraseChars(V))),this._parser.registerCsiHandler({final:"Z"},(V=>this.cursorBackwardTab(V))),this._parser.registerCsiHandler({final:"`"},(V=>this.charPosAbsolute(V))),this._parser.registerCsiHandler({final:"a"},(V=>this.hPositionRelative(V))),this._parser.registerCsiHandler({final:"b"},(V=>this.repeatPrecedingCharacter(V))),this._parser.registerCsiHandler({final:"c"},(V=>this.sendDeviceAttributesPrimary(V))),this._parser.registerCsiHandler({prefix:">",final:"c"},(V=>this.sendDeviceAttributesSecondary(V))),this._parser.registerCsiHandler({final:"d"},(V=>this.linePosAbsolute(V))),this._parser.registerCsiHandler({final:"e"},(V=>this.vPositionRelative(V))),this._parser.registerCsiHandler({final:"f"},(V=>this.hVPosition(V))),this._parser.registerCsiHandler({final:"g"},(V=>this.tabClear(V))),this._parser.registerCsiHandler({final:"h"},(V=>this.setMode(V))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(V=>this.setModePrivate(V))),this._parser.registerCsiHandler({final:"l"},(V=>this.resetMode(V))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(V=>this.resetModePrivate(V))),this._parser.registerCsiHandler({final:"m"},(V=>this.charAttributes(V))),this._parser.registerCsiHandler({final:"n"},(V=>this.deviceStatus(V))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(V=>this.deviceStatusPrivate(V))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(V=>this.softReset(V))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(V=>this.setCursorStyle(V))),this._parser.registerCsiHandler({final:"r"},(V=>this.setScrollRegion(V))),this._parser.registerCsiHandler({final:"s"},(V=>this.saveCursor(V))),this._parser.registerCsiHandler({final:"t"},(V=>this.windowOptions(V))),this._parser.registerCsiHandler({final:"u"},(V=>this.restoreCursor(V))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(V=>this.insertColumns(V))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(V=>this.deleteColumns(V))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(V=>this.selectProtected(V))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(V=>this.requestMode(V,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(V=>this.requestMode(V,!1))),this._parser.setExecuteHandler(f.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(f.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(f.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(f.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(f.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(f.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(f.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(f.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(f.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(f.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(f.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(f.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new M.OscHandler((V=>(this.setTitle(V),this.setIconName(V),!0)))),this._parser.registerOscHandler(1,new M.OscHandler((V=>this.setIconName(V)))),this._parser.registerOscHandler(2,new M.OscHandler((V=>this.setTitle(V)))),this._parser.registerOscHandler(4,new M.OscHandler((V=>this.setOrReportIndexedColor(V)))),this._parser.registerOscHandler(8,new M.OscHandler((V=>this.setHyperlink(V)))),this._parser.registerOscHandler(10,new M.OscHandler((V=>this.setOrReportFgColor(V)))),this._parser.registerOscHandler(11,new M.OscHandler((V=>this.setOrReportBgColor(V)))),this._parser.registerOscHandler(12,new M.OscHandler((V=>this.setOrReportCursorColor(V)))),this._parser.registerOscHandler(104,new M.OscHandler((V=>this.restoreIndexedColor(V)))),this._parser.registerOscHandler(110,new M.OscHandler((V=>this.restoreFgColor(V)))),this._parser.registerOscHandler(111,new M.OscHandler((V=>this.restoreBgColor(V)))),this._parser.registerOscHandler(112,new M.OscHandler((V=>this.restoreCursorColor(V)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const V in m.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:V},(()=>this.selectCharset("("+V))),this._parser.registerEscHandler({intermediates:")",final:V},(()=>this.selectCharset(")"+V))),this._parser.registerEscHandler({intermediates:"*",final:V},(()=>this.selectCharset("*"+V))),this._parser.registerEscHandler({intermediates:"+",final:V},(()=>this.selectCharset("+"+V))),this._parser.registerEscHandler({intermediates:"-",final:V},(()=>this.selectCharset("-"+V))),this._parser.registerEscHandler({intermediates:".",final:V},(()=>this.selectCharset("."+V))),this._parser.registerEscHandler({intermediates:"/",final:V},(()=>this.selectCharset("/"+V)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((V=>(this._logService.error("Parsing error: ",V),V))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new E.DcsHandler(((V,ne)=>this.requestStatusString(V,ne))))}_preserveStack(F,N,z,G){this._parseStack.paused=!0,this._parseStack.cursorStartX=F,this._parseStack.cursorStartY=N,this._parseStack.decodedLength=z,this._parseStack.position=G}_logSlowResolvingAsync(F){this._logService.logLevel<=A.LogLevelEnum.WARN&&Promise.race([F,new Promise(((N,z)=>setTimeout((()=>z("#SLOW_TIMEOUT")),5e3)))]).catch((N=>{if(N!=="#SLOW_TIMEOUT")throw N;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(F,N){let z,G=this._activeBuffer.x,H=this._activeBuffer.y,ee=0;const ue=this._parseStack.paused;if(ue){if(z=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,N))return this._logSlowResolvingAsync(z),z;G=this._parseStack.cursorStartX,H=this._parseStack.cursorStartY,this._parseStack.paused=!1,F.length>O&&(ee=this._parseStack.position+O)}if(this._logService.logLevel<=A.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof F=="string"?` "${F}"`:` "${Array.prototype.map.call(F,(V=>String.fromCharCode(V))).join("")}"`),typeof F=="string"?F.split("").map((V=>V.charCodeAt(0))):F),this._parseBuffer.length<F.length&&this._parseBuffer.length<O&&(this._parseBuffer=new Uint32Array(Math.min(F.length,O))),ue||this._dirtyRowTracker.clearRange(),F.length>O)for(let V=ee;V<F.length;V+=O){const ne=V+O<F.length?V+O:F.length,he=typeof F=="string"?this._stringDecoder.decode(F.substring(V,ne),this._parseBuffer):this._utf8Decoder.decode(F.subarray(V,ne),this._parseBuffer);if(z=this._parser.parse(this._parseBuffer,he))return this._preserveStack(G,H,he,V),this._logSlowResolvingAsync(z),z}else if(!ue){const V=typeof F=="string"?this._stringDecoder.decode(F,this._parseBuffer):this._utf8Decoder.decode(F,this._parseBuffer);if(z=this._parser.parse(this._parseBuffer,V))return this._preserveStack(G,H,V,0),this._logSlowResolvingAsync(z),z}this._activeBuffer.x===G&&this._activeBuffer.y===H||this._onCursorMove.fire();const ce=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),J=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);J<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(J,this._bufferService.rows-1),Math.min(ce,this._bufferService.rows-1))}print(F,N,z){let G,H;const ee=this._charsetService.charset,ue=this._optionsService.rawOptions.screenReaderMode,ce=this._bufferService.cols,J=this._coreService.decPrivateModes.wraparound,V=this._coreService.modes.insertMode,ne=this._curAttrData;let he=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&z-N>0&&he.getWidth(this._activeBuffer.x-1)===2&&he.setCellFromCodepoint(this._activeBuffer.x-1,0,1,ne);let _e=this._parser.precedingJoinState;for(let Ce=N;Ce<z;++Ce){if(G=F[Ce],G<127&&ee){const yt=ee[String.fromCharCode(G)];yt&&(G=yt.charCodeAt(0))}const we=this._unicodeService.charProperties(G,_e);H=T.UnicodeService.extractWidth(we);const Ee=T.UnicodeService.extractShouldJoin(we),qe=Ee?T.UnicodeService.extractWidth(_e):0;if(_e=we,ue&&this._onA11yChar.fire((0,S.stringFromCodePoint)(G)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+H-qe>ce){if(J){const yt=he;let Pe=this._activeBuffer.x-qe;for(this._activeBuffer.x=qe,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),he=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),qe>0&&he instanceof v.BufferLine&&he.copyCellsFrom(yt,Pe,0,qe,!1);Pe<ce;)yt.setCellFromCodepoint(Pe++,0,1,ne)}else if(this._activeBuffer.x=ce-1,H===2)continue}if(Ee&&this._activeBuffer.x){const yt=he.getWidth(this._activeBuffer.x-1)?1:2;he.addCodepointToCell(this._activeBuffer.x-yt,G,H);for(let Pe=H-qe;--Pe>=0;)he.setCellFromCodepoint(this._activeBuffer.x++,0,0,ne)}else if(V&&(he.insertCells(this._activeBuffer.x,H-qe,this._activeBuffer.getNullCell(ne)),he.getWidth(ce-1)===2&&he.setCellFromCodepoint(ce-1,w.NULL_CELL_CODE,w.NULL_CELL_WIDTH,ne)),he.setCellFromCodepoint(this._activeBuffer.x++,G,H,ne),H>0)for(;--H;)he.setCellFromCodepoint(this._activeBuffer.x++,0,0,ne)}this._parser.precedingJoinState=_e,this._activeBuffer.x<ce&&z-N>0&&he.getWidth(this._activeBuffer.x)===0&&!he.hasContent(this._activeBuffer.x)&&he.setCellFromCodepoint(this._activeBuffer.x,0,1,ne),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(F,N){return F.final!=="t"||F.prefix||F.intermediates?this._parser.registerCsiHandler(F,N):this._parser.registerCsiHandler(F,(z=>!j(z.params[0],this._optionsService.rawOptions.windowOptions)||N(z)))}registerDcsHandler(F,N){return this._parser.registerDcsHandler(F,new E.DcsHandler(N))}registerEscHandler(F,N){return this._parser.registerEscHandler(F,N)}registerOscHandler(F,N){return this._parser.registerOscHandler(F,new M.OscHandler(N))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const F=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);F.hasWidth(this._activeBuffer.x)&&!F.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const F=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-F),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(F=this._bufferService.cols-1){this._activeBuffer.x=Math.min(F,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(F,N){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=F,this._activeBuffer.y=this._activeBuffer.scrollTop+N):(this._activeBuffer.x=F,this._activeBuffer.y=N),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(F,N){this._restrictCursor(),this._setCursor(this._activeBuffer.x+F,this._activeBuffer.y+N)}cursorUp(F){const N=this._activeBuffer.y-this._activeBuffer.scrollTop;return N>=0?this._moveCursor(0,-Math.min(N,F.params[0]||1)):this._moveCursor(0,-(F.params[0]||1)),!0}cursorDown(F){const N=this._activeBuffer.scrollBottom-this._activeBuffer.y;return N>=0?this._moveCursor(0,Math.min(N,F.params[0]||1)):this._moveCursor(0,F.params[0]||1),!0}cursorForward(F){return this._moveCursor(F.params[0]||1,0),!0}cursorBackward(F){return this._moveCursor(-(F.params[0]||1),0),!0}cursorNextLine(F){return this.cursorDown(F),this._activeBuffer.x=0,!0}cursorPrecedingLine(F){return this.cursorUp(F),this._activeBuffer.x=0,!0}cursorCharAbsolute(F){return this._setCursor((F.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(F){return this._setCursor(F.length>=2?(F.params[1]||1)-1:0,(F.params[0]||1)-1),!0}charPosAbsolute(F){return this._setCursor((F.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(F){return this._moveCursor(F.params[0]||1,0),!0}linePosAbsolute(F){return this._setCursor(this._activeBuffer.x,(F.params[0]||1)-1),!0}vPositionRelative(F){return this._moveCursor(0,F.params[0]||1),!0}hVPosition(F){return this.cursorPosition(F),!0}tabClear(F){const N=F.params[0];return N===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:N===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(F){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let N=F.params[0]||1;for(;N--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(F){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let N=F.params[0]||1;for(;N--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(F){const N=F.params[0];return N===1&&(this._curAttrData.bg|=536870912),N!==2&&N!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(F,N,z,G=!1,H=!1){const ee=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);ee.replaceCells(N,z,this._activeBuffer.getNullCell(this._eraseAttrData()),H),G&&(ee.isWrapped=!1)}_resetBufferLine(F,N=!1){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);z&&(z.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),N),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+F),z.isWrapped=!1)}eraseInDisplay(F,N=!1){let z;switch(this._restrictCursor(this._bufferService.cols),F.params[0]){case 0:for(z=this._activeBuffer.y,this._dirtyRowTracker.markDirty(z),this._eraseInBufferLine(z++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,N);z<this._bufferService.rows;z++)this._resetBufferLine(z,N);this._dirtyRowTracker.markDirty(z);break;case 1:for(z=this._activeBuffer.y,this._dirtyRowTracker.markDirty(z),this._eraseInBufferLine(z,0,this._activeBuffer.x+1,!0,N),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(z+1).isWrapped=!1);z--;)this._resetBufferLine(z,N);this._dirtyRowTracker.markDirty(0);break;case 2:for(z=this._bufferService.rows,this._dirtyRowTracker.markDirty(z-1);z--;)this._resetBufferLine(z,N);this._dirtyRowTracker.markDirty(0);break;case 3:const G=this._activeBuffer.lines.length-this._bufferService.rows;G>0&&(this._activeBuffer.lines.trimStart(G),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-G,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-G,0),this._onScroll.fire(0))}return!0}eraseInLine(F,N=!1){switch(this._restrictCursor(this._bufferService.cols),F.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,N);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,N);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,N)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(F){this._restrictCursor();let N=F.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const z=this._activeBuffer.ybase+this._activeBuffer.y,G=this._bufferService.rows-1-this._activeBuffer.scrollBottom,H=this._bufferService.rows-1+this._activeBuffer.ybase-G+1;for(;N--;)this._activeBuffer.lines.splice(H-1,1),this._activeBuffer.lines.splice(z,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(F){this._restrictCursor();let N=F.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const z=this._activeBuffer.ybase+this._activeBuffer.y;let G;for(G=this._bufferService.rows-1-this._activeBuffer.scrollBottom,G=this._bufferService.rows-1+this._activeBuffer.ybase-G;N--;)this._activeBuffer.lines.splice(z,1),this._activeBuffer.lines.splice(G,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(F){this._restrictCursor();const N=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return N&&(N.insertCells(this._activeBuffer.x,F.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(F){this._restrictCursor();const N=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return N&&(N.deleteCells(this._activeBuffer.x,F.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(F){let N=F.params[0]||1;for(;N--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(F){let N=F.params[0]||1;for(;N--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(v.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(F){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const N=F.params[0]||1;for(let z=this._activeBuffer.scrollTop;z<=this._activeBuffer.scrollBottom;++z){const G=this._activeBuffer.lines.get(this._activeBuffer.ybase+z);G.deleteCells(0,N,this._activeBuffer.getNullCell(this._eraseAttrData())),G.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(F){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const N=F.params[0]||1;for(let z=this._activeBuffer.scrollTop;z<=this._activeBuffer.scrollBottom;++z){const G=this._activeBuffer.lines.get(this._activeBuffer.ybase+z);G.insertCells(0,N,this._activeBuffer.getNullCell(this._eraseAttrData())),G.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(F){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const N=F.params[0]||1;for(let z=this._activeBuffer.scrollTop;z<=this._activeBuffer.scrollBottom;++z){const G=this._activeBuffer.lines.get(this._activeBuffer.ybase+z);G.insertCells(this._activeBuffer.x,N,this._activeBuffer.getNullCell(this._eraseAttrData())),G.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(F){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const N=F.params[0]||1;for(let z=this._activeBuffer.scrollTop;z<=this._activeBuffer.scrollBottom;++z){const G=this._activeBuffer.lines.get(this._activeBuffer.ybase+z);G.deleteCells(this._activeBuffer.x,N,this._activeBuffer.getNullCell(this._eraseAttrData())),G.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(F){this._restrictCursor();const N=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return N&&(N.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(F.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(F){const N=this._parser.precedingJoinState;if(!N)return!0;const z=F.params[0]||1,G=T.UnicodeService.extractWidth(N),H=this._activeBuffer.x-G,ee=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(H),ue=new Uint32Array(ee.length*z);let ce=0;for(let V=0;V<ee.length;){const ne=ee.codePointAt(V)||0;ue[ce++]=ne,V+=ne>65535?2:1}let J=ce;for(let V=1;V<z;++V)ue.copyWithin(J,0,ce),J+=ce;return this.print(ue,0,J),!0}sendDeviceAttributesPrimary(F){return F.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(f.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(f.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(F){return F.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(f.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(f.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(F.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(f.C0.ESC+"[>83;40003;0c")),!0}_is(F){return(this._optionsService.rawOptions.termName+"").indexOf(F)===0}setMode(F){for(let N=0;N<F.length;N++)switch(F.params[N]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(F){for(let N=0;N<F.length;N++)switch(F.params[N]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,m.DEFAULT_CHARSET),this._charsetService.setgCharset(1,m.DEFAULT_CHARSET),this._charsetService.setgCharset(2,m.DEFAULT_CHARSET),this._charsetService.setgCharset(3,m.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(F){for(let N=0;N<F.length;N++)switch(F.params[N]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(F){for(let N=0;N<F.length;N++)switch(F.params[N]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),F.params[N]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(F,N){const z=this._coreService.decPrivateModes,{activeProtocol:G,activeEncoding:H}=this._coreMouseService,ee=this._coreService,{buffers:ue,cols:ce}=this._bufferService,{active:J,alt:V}=ue,ne=this._optionsService.rawOptions,he=Ee=>Ee?1:2,_e=F.params[0];return Ce=_e,we=N?_e===2?4:_e===4?he(ee.modes.insertMode):_e===12?3:_e===20?he(ne.convertEol):0:_e===1?he(z.applicationCursorKeys):_e===3?ne.windowOptions.setWinLines?ce===80?2:ce===132?1:0:0:_e===6?he(z.origin):_e===7?he(z.wraparound):_e===8?3:_e===9?he(G==="X10"):_e===12?he(ne.cursorBlink):_e===25?he(!ee.isCursorHidden):_e===45?he(z.reverseWraparound):_e===66?he(z.applicationKeypad):_e===67?4:_e===1e3?he(G==="VT200"):_e===1002?he(G==="DRAG"):_e===1003?he(G==="ANY"):_e===1004?he(z.sendFocus):_e===1005?4:_e===1006?he(H==="SGR"):_e===1015?4:_e===1016?he(H==="SGR_PIXELS"):_e===1048?1:_e===47||_e===1047||_e===1049?he(J===V):_e===2004?he(z.bracketedPasteMode):0,ee.triggerDataEvent(`${f.C0.ESC}[${N?"":"?"}${Ce};${we}$y`),!0;var Ce,we}_updateAttrColor(F,N,z,G,H){return N===2?(F|=50331648,F&=-16777216,F|=k.AttributeData.fromColorRGB([z,G,H])):N===5&&(F&=-50331904,F|=33554432|255&z),F}_extractColor(F,N,z){const G=[0,0,-1,0,0,0];let H=0,ee=0;do{if(G[ee+H]=F.params[N+ee],F.hasSubParams(N+ee)){const ue=F.getSubParams(N+ee);let ce=0;do G[1]===5&&(H=1),G[ee+ce+1+H]=ue[ce];while(++ce<ue.length&&ce+ee+1+H<G.length);break}if(G[1]===5&&ee+H>=2||G[1]===2&&ee+H>=5)break;G[1]&&(H=1)}while(++ee+N<F.length&&ee+H<G.length);for(let ue=2;ue<G.length;++ue)G[ue]===-1&&(G[ue]=0);switch(G[0]){case 38:z.fg=this._updateAttrColor(z.fg,G[1],G[3],G[4],G[5]);break;case 48:z.bg=this._updateAttrColor(z.bg,G[1],G[3],G[4],G[5]);break;case 58:z.extended=z.extended.clone(),z.extended.underlineColor=this._updateAttrColor(z.extended.underlineColor,G[1],G[3],G[4],G[5])}return ee}_processUnderline(F,N){N.extended=N.extended.clone(),(!~F||F>5)&&(F=1),N.extended.underlineStyle=F,N.fg|=268435456,F===0&&(N.fg&=-268435457),N.updateExtended()}_processSGR0(F){F.fg=v.DEFAULT_ATTR_DATA.fg,F.bg=v.DEFAULT_ATTR_DATA.bg,F.extended=F.extended.clone(),F.extended.underlineStyle=0,F.extended.underlineColor&=-67108864,F.updateExtended()}charAttributes(F){if(F.length===1&&F.params[0]===0)return this._processSGR0(this._curAttrData),!0;const N=F.length;let z;const G=this._curAttrData;for(let H=0;H<N;H++)z=F.params[H],z>=30&&z<=37?(G.fg&=-50331904,G.fg|=16777216|z-30):z>=40&&z<=47?(G.bg&=-50331904,G.bg|=16777216|z-40):z>=90&&z<=97?(G.fg&=-50331904,G.fg|=16777224|z-90):z>=100&&z<=107?(G.bg&=-50331904,G.bg|=16777224|z-100):z===0?this._processSGR0(G):z===1?G.fg|=134217728:z===3?G.bg|=67108864:z===4?(G.fg|=268435456,this._processUnderline(F.hasSubParams(H)?F.getSubParams(H)[0]:1,G)):z===5?G.fg|=536870912:z===7?G.fg|=67108864:z===8?G.fg|=1073741824:z===9?G.fg|=2147483648:z===2?G.bg|=134217728:z===21?this._processUnderline(2,G):z===22?(G.fg&=-134217729,G.bg&=-134217729):z===23?G.bg&=-67108865:z===24?(G.fg&=-268435457,this._processUnderline(0,G)):z===25?G.fg&=-536870913:z===27?G.fg&=-67108865:z===28?G.fg&=-1073741825:z===29?G.fg&=2147483647:z===39?(G.fg&=-67108864,G.fg|=16777215&v.DEFAULT_ATTR_DATA.fg):z===49?(G.bg&=-67108864,G.bg|=16777215&v.DEFAULT_ATTR_DATA.bg):z===38||z===48||z===58?H+=this._extractColor(F,H,G):z===53?G.bg|=1073741824:z===55?G.bg&=-1073741825:z===59?(G.extended=G.extended.clone(),G.extended.underlineColor=-1,G.updateExtended()):z===100?(G.fg&=-67108864,G.fg|=16777215&v.DEFAULT_ATTR_DATA.fg,G.bg&=-67108864,G.bg|=16777215&v.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",z);return!0}deviceStatus(F){switch(F.params[0]){case 5:this._coreService.triggerDataEvent(`${f.C0.ESC}[0n`);break;case 6:const N=this._activeBuffer.y+1,z=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${f.C0.ESC}[${N};${z}R`)}return!0}deviceStatusPrivate(F){if(F.params[0]===6){const N=this._activeBuffer.y+1,z=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${f.C0.ESC}[?${N};${z}R`)}return!0}softReset(F){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=v.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(F){const N=F.params[0]||1;switch(N){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const z=N%2==1;return this._optionsService.options.cursorBlink=z,!0}setScrollRegion(F){const N=F.params[0]||1;let z;return(F.length<2||(z=F.params[1])>this._bufferService.rows||z===0)&&(z=this._bufferService.rows),z>N&&(this._activeBuffer.scrollTop=N-1,this._activeBuffer.scrollBottom=z-1,this._setCursor(0,0)),!0}windowOptions(F){if(!j(F.params[0],this._optionsService.rawOptions.windowOptions))return!0;const N=F.length>1?F.params[1]:0;switch(F.params[0]){case 14:N!==2&&this._onRequestWindowsOptionsReport.fire(U.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(U.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${f.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:N!==0&&N!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),N!==0&&N!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:N!==0&&N!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),N!==0&&N!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(F){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(F){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(F){return this._windowTitle=F,this._onTitleChange.fire(F),!0}setIconName(F){return this._iconName=F,!0}setOrReportIndexedColor(F){const N=[],z=F.split(";");for(;z.length>1;){const G=z.shift(),H=z.shift();if(/^\d+$/.exec(G)){const ee=parseInt(G);if(Y(ee))if(H==="?")N.push({type:0,index:ee});else{const ue=(0,L.parseColor)(H);ue&&N.push({type:1,index:ee,color:ue})}}}return N.length&&this._onColor.fire(N),!0}setHyperlink(F){const N=F.split(";");return!(N.length<2)&&(N[1]?this._createHyperlink(N[0],N[1]):!N[0]&&this._finishHyperlink())}_createHyperlink(F,N){this._getCurrentLinkId()&&this._finishHyperlink();const z=F.split(":");let G;const H=z.findIndex((ee=>ee.startsWith("id=")));return H!==-1&&(G=z[H].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:G,uri:N}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(F,N){const z=F.split(";");for(let G=0;G<z.length&&!(N>=this._specialColors.length);++G,++N)if(z[G]==="?")this._onColor.fire([{type:0,index:this._specialColors[N]}]);else{const H=(0,L.parseColor)(z[G]);H&&this._onColor.fire([{type:1,index:this._specialColors[N],color:H}])}return!0}setOrReportFgColor(F){return this._setOrReportSpecialColor(F,0)}setOrReportBgColor(F){return this._setOrReportSpecialColor(F,1)}setOrReportCursorColor(F){return this._setOrReportSpecialColor(F,2)}restoreIndexedColor(F){if(!F)return this._onColor.fire([{type:2}]),!0;const N=[],z=F.split(";");for(let G=0;G<z.length;++G)if(/^\d+$/.exec(z[G])){const H=parseInt(z[G]);Y(H)&&N.push({type:2,index:H})}return N.length&&this._onColor.fire(N),!0}restoreFgColor(F){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(F){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(F){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,m.DEFAULT_CHARSET),!0}selectCharset(F){return F.length!==2?(this.selectDefaultCharset(),!0):(F[0]==="/"||this._charsetService.setgCharset(D[F[0]],m.CHARSETS[F[1]]||m.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const F=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,F,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=v.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=v.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(F){return this._charsetService.setgLevel(F),!0}screenAlignmentPattern(){const F=new x.CellData;F.content=4194373,F.fg=this._curAttrData.fg,F.bg=this._curAttrData.bg,this._setCursor(0,0);for(let N=0;N<this._bufferService.rows;++N){const z=this._activeBuffer.ybase+this._activeBuffer.y+N,G=this._activeBuffer.lines.get(z);G&&(G.fill(F),G.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(F,N){const z=this._bufferService.buffer,G=this._optionsService.rawOptions;return(H=>(this._coreService.triggerDataEvent(`${f.C0.ESC}${H}${f.C0.ESC}\\`),!0))(F==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:F==='"p'?'P1$r61;1"p':F==="r"?`P1$r${z.scrollTop+1};${z.scrollBottom+1}r`:F==="m"?"P1$r0m":F===" q"?`P1$r${{block:2,underline:4,bar:6}[G.cursorStyle]-(G.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(F,N){this._dirtyRowTracker.markRangeDirty(F,N)}}o.InputHandler=K;let $=class{constructor(Q){this._bufferService=Q,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(Q){Q<this.start?this.start=Q:Q>this.end&&(this.end=Q)}markRangeDirty(Q,F){Q>F&&(q=Q,Q=F,F=q),Q<this.start&&(this.start=Q),F>this.end&&(this.end=F)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function Y(Q){return 0<=Q&&Q<256}$=u([h(0,A.IBufferService)],$)},844:(a,o)=>{function l(u){for(const h of u)h.dispose();u.length=0}Object.defineProperty(o,"__esModule",{value:!0}),o.getDisposeArrayDisposable=o.disposeArray=o.toDisposable=o.MutableDisposable=o.Disposable=void 0,o.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const h=this._disposables.indexOf(u);h!==-1&&this._disposables.splice(h,1)}},o.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},o.toDisposable=function(u){return{dispose:u}},o.disposeArray=l,o.getDisposeArrayDisposable=function(u){return{dispose:()=>l(u)}}},1505:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.FourKeyMap=o.TwoKeyMap=void 0;class l{constructor(){this._data={}}set(h,f,m){this._data[h]||(this._data[h]={}),this._data[h][f]=m}get(h,f){return this._data[h]?this._data[h][f]:void 0}clear(){this._data={}}}o.TwoKeyMap=l,o.FourKeyMap=class{constructor(){this._data=new l}set(u,h,f,m,g){this._data.get(u,h)||this._data.set(u,h,new l),this._data.get(u,h).set(f,m,g)}get(u,h,f,m){return this._data.get(u,h)?.get(f,m)}clear(){this._data.clear()}}},6114:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.isChromeOS=o.isLinux=o.isWindows=o.isIphone=o.isIpad=o.isMac=o.getSafariVersion=o.isSafari=o.isLegacyEdge=o.isFirefox=o.isNode=void 0,o.isNode=typeof process<"u"&&"title"in process;const l=o.isNode?"node":navigator.userAgent,u=o.isNode?"node":navigator.platform;o.isFirefox=l.includes("Firefox"),o.isLegacyEdge=l.includes("Edge"),o.isSafari=/^((?!chrome|android).)*safari/i.test(l),o.getSafariVersion=function(){if(!o.isSafari)return 0;const h=l.match(/Version\/(\d+)/);return h===null||h.length<2?0:parseInt(h[1])},o.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(u),o.isIpad=u==="iPad",o.isIphone=u==="iPhone",o.isWindows=["Windows","Win16","Win32","WinCE"].includes(u),o.isLinux=u.indexOf("Linux")>=0,o.isChromeOS=/\bCrOS\b/.test(l)},6106:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SortedList=void 0;let l=0;o.SortedList=class{constructor(u){this._getKey=u,this._array=[]}clear(){this._array.length=0}insert(u){this._array.length!==0?(l=this._search(this._getKey(u)),this._array.splice(l,0,u)):this._array.push(u)}delete(u){if(this._array.length===0)return!1;const h=this._getKey(u);if(h===void 0||(l=this._search(h),l===-1)||this._getKey(this._array[l])!==h)return!1;do if(this._array[l]===u)return this._array.splice(l,1),!0;while(++l<this._array.length&&this._getKey(this._array[l])===h);return!1}*getKeyIterator(u){if(this._array.length!==0&&(l=this._search(u),!(l<0||l>=this._array.length)&&this._getKey(this._array[l])===u))do yield this._array[l];while(++l<this._array.length&&this._getKey(this._array[l])===u)}forEachByKey(u,h){if(this._array.length!==0&&(l=this._search(u),!(l<0||l>=this._array.length)&&this._getKey(this._array[l])===u))do h(this._array[l]);while(++l<this._array.length&&this._getKey(this._array[l])===u)}values(){return[...this._array].values()}_search(u){let h=0,f=this._array.length-1;for(;f>=h;){let m=h+f>>1;const g=this._getKey(this._array[m]);if(g>u)f=m-1;else{if(!(g<u)){for(;m>0&&this._getKey(this._array[m-1])===u;)m--;return m}h=m+1}}return h}}},7226:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DebouncedIdleTask=o.IdleTaskQueue=o.PriorityTaskQueue=void 0;const u=l(6114);class h{constructor(){this._tasks=[],this._i=0}enqueue(g){this._tasks.push(g),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(g){this._idleCallback=void 0;let C=0,S=0,v=g.timeRemaining(),_=0;for(;this._i<this._tasks.length;){if(C=Date.now(),this._tasks[this._i]()||this._i++,C=Math.max(1,Date.now()-C),S=Math.max(C,S),_=g.timeRemaining(),1.5*S>_)return v-C<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(v-C))}ms`),void this._start();v=_}this.clear()}}class f extends h{_requestCallback(g){return setTimeout((()=>g(this._createDeadline(16))))}_cancelCallback(g){clearTimeout(g)}_createDeadline(g){const C=Date.now()+g;return{timeRemaining:()=>Math.max(0,C-Date.now())}}}o.PriorityTaskQueue=f,o.IdleTaskQueue=!u.isNode&&"requestIdleCallback"in window?class extends h{_requestCallback(m){return requestIdleCallback(m)}_cancelCallback(m){cancelIdleCallback(m)}}:f,o.DebouncedIdleTask=class{constructor(){this._queue=new o.IdleTaskQueue}set(m){this._queue.clear(),this._queue.enqueue(m)}flush(){this._queue.flush()}}},9282:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.updateWindowsModeWrappedState=void 0;const u=l(643);o.updateWindowsModeWrappedState=function(h){const f=h.buffer.lines.get(h.buffer.ybase+h.buffer.y-1),m=f?.get(h.cols-1),g=h.buffer.lines.get(h.buffer.ybase+h.buffer.y);g&&m&&(g.isWrapped=m[u.CHAR_DATA_CODE_INDEX]!==u.NULL_CELL_CODE&&m[u.CHAR_DATA_CODE_INDEX]!==u.WHITESPACE_CELL_CODE)}},3734:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ExtendedAttrs=o.AttributeData=void 0;class l{constructor(){this.fg=0,this.bg=0,this.extended=new u}static toColorRGB(f){return[f>>>16&255,f>>>8&255,255&f]}static fromColorRGB(f){return(255&f[0])<<16|(255&f[1])<<8|255&f[2]}clone(){const f=new l;return f.fg=this.fg,f.bg=this.bg,f.extended=this.extended.clone(),f}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}o.AttributeData=l;class u{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(f){this._ext=f}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(f){this._ext&=-469762049,this._ext|=f<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(f){this._ext&=-67108864,this._ext|=67108863&f}get urlId(){return this._urlId}set urlId(f){this._urlId=f}get underlineVariantOffset(){const f=(3758096384&this._ext)>>29;return f<0?4294967288^f:f}set underlineVariantOffset(f){this._ext&=536870911,this._ext|=f<<29&3758096384}constructor(f=0,m=0){this._ext=0,this._urlId=0,this._ext=f,this._urlId=m}clone(){return new u(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}o.ExtendedAttrs=u},9092:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Buffer=o.MAX_BUFFER_SIZE=void 0;const u=l(6349),h=l(7226),f=l(3734),m=l(8437),g=l(4634),C=l(511),S=l(643),v=l(4863),_=l(7116);o.MAX_BUFFER_SIZE=4294967295,o.Buffer=class{constructor(w,x,k){this._hasScrollback=w,this._optionsService=x,this._bufferService=k,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=m.DEFAULT_ATTR_DATA.clone(),this.savedCharset=_.DEFAULT_CHARSET,this.markers=[],this._nullCell=C.CellData.fromCharData([0,S.NULL_CELL_CHAR,S.NULL_CELL_WIDTH,S.NULL_CELL_CODE]),this._whitespaceCell=C.CellData.fromCharData([0,S.WHITESPACE_CELL_CHAR,S.WHITESPACE_CELL_WIDTH,S.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new h.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new u.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(w){return w?(this._nullCell.fg=w.fg,this._nullCell.bg=w.bg,this._nullCell.extended=w.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new f.ExtendedAttrs),this._nullCell}getWhitespaceCell(w){return w?(this._whitespaceCell.fg=w.fg,this._whitespaceCell.bg=w.bg,this._whitespaceCell.extended=w.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new f.ExtendedAttrs),this._whitespaceCell}getBlankLine(w,x){return new m.BufferLine(this._bufferService.cols,this.getNullCell(w),x)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const w=this.ybase+this.y-this.ydisp;return w>=0&&w<this._rows}_getCorrectBufferLength(w){if(!this._hasScrollback)return w;const x=w+this._optionsService.rawOptions.scrollback;return x>o.MAX_BUFFER_SIZE?o.MAX_BUFFER_SIZE:x}fillViewportRows(w){if(this.lines.length===0){w===void 0&&(w=m.DEFAULT_ATTR_DATA);let x=this._rows;for(;x--;)this.lines.push(this.getBlankLine(w))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new u.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(w,x){const k=this.getNullCell(m.DEFAULT_ATTR_DATA);let A=0;const T=this._getCorrectBufferLength(x);if(T>this.lines.maxLength&&(this.lines.maxLength=T),this.lines.length>0){if(this._cols<w)for(let E=0;E<this.lines.length;E++)A+=+this.lines.get(E).resize(w,k);let M=0;if(this._rows<x)for(let E=this._rows;E<x;E++)this.lines.length<x+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new m.BufferLine(w,k)):this.ybase>0&&this.lines.length<=this.ybase+this.y+M+1?(this.ybase--,M++,this.ydisp>0&&this.ydisp--):this.lines.push(new m.BufferLine(w,k)));else for(let E=this._rows;E>x;E--)this.lines.length>x+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(T<this.lines.maxLength){const E=this.lines.length-T;E>0&&(this.lines.trimStart(E),this.ybase=Math.max(this.ybase-E,0),this.ydisp=Math.max(this.ydisp-E,0),this.savedY=Math.max(this.savedY-E,0)),this.lines.maxLength=T}this.x=Math.min(this.x,w-1),this.y=Math.min(this.y,x-1),M&&(this.y+=M),this.savedX=Math.min(this.savedX,w-1),this.scrollTop=0}if(this.scrollBottom=x-1,this._isReflowEnabled&&(this._reflow(w,x),this._cols>w))for(let M=0;M<this.lines.length;M++)A+=+this.lines.get(M).resize(w,k);this._cols=w,this._rows=x,this._memoryCleanupQueue.clear(),A>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let w=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,w=!1);let x=0;for(;this._memoryCleanupPosition<this.lines.length;)if(x+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),x>100)return!0;return w}get _isReflowEnabled(){const w=this._optionsService.rawOptions.windowsPty;return w&&w.buildNumber?this._hasScrollback&&w.backend==="conpty"&&w.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(w,x){this._cols!==w&&(w>this._cols?this._reflowLarger(w,x):this._reflowSmaller(w,x))}_reflowLarger(w,x){const k=(0,g.reflowLargerGetLinesToRemove)(this.lines,this._cols,w,this.ybase+this.y,this.getNullCell(m.DEFAULT_ATTR_DATA));if(k.length>0){const A=(0,g.reflowLargerCreateNewLayout)(this.lines,k);(0,g.reflowLargerApplyNewLayout)(this.lines,A.layout),this._reflowLargerAdjustViewport(w,x,A.countRemoved)}}_reflowLargerAdjustViewport(w,x,k){const A=this.getNullCell(m.DEFAULT_ATTR_DATA);let T=k;for(;T-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<x&&this.lines.push(new m.BufferLine(w,A))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-k,0)}_reflowSmaller(w,x){const k=this.getNullCell(m.DEFAULT_ATTR_DATA),A=[];let T=0;for(let M=this.lines.length-1;M>=0;M--){let E=this.lines.get(M);if(!E||!E.isWrapped&&E.getTrimmedLength()<=w)continue;const L=[E];for(;E.isWrapped&&M>0;)E=this.lines.get(--M),L.unshift(E);const D=this.ybase+this.y;if(D>=M&&D<M+L.length)continue;const O=L[L.length-1].getTrimmedLength(),j=(0,g.reflowSmallerGetNewLineLengths)(L,this._cols,w),U=j.length-L.length;let q;q=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+U):Math.max(0,this.lines.length-this.lines.maxLength+U);const K=[];for(let z=0;z<U;z++){const G=this.getBlankLine(m.DEFAULT_ATTR_DATA,!0);K.push(G)}K.length>0&&(A.push({start:M+L.length+T,newLines:K}),T+=K.length),L.push(...K);let $=j.length-1,Y=j[$];Y===0&&($--,Y=j[$]);let Q=L.length-U-1,F=O;for(;Q>=0;){const z=Math.min(F,Y);if(L[$]===void 0)break;if(L[$].copyCellsFrom(L[Q],F-z,Y-z,z,!0),Y-=z,Y===0&&($--,Y=j[$]),F-=z,F===0){Q--;const G=Math.max(Q,0);F=(0,g.getWrappedLineTrimmedLength)(L,G,this._cols)}}for(let z=0;z<L.length;z++)j[z]<w&&L[z].setCell(j[z],k);let N=U-q;for(;N-- >0;)this.ybase===0?this.y<x-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+T)-x&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+U,this.ybase+x-1)}if(A.length>0){const M=[],E=[];for(let $=0;$<this.lines.length;$++)E.push(this.lines.get($));const L=this.lines.length;let D=L-1,O=0,j=A[O];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+T);let U=0;for(let $=Math.min(this.lines.maxLength-1,L+T-1);$>=0;$--)if(j&&j.start>D+U){for(let Y=j.newLines.length-1;Y>=0;Y--)this.lines.set($--,j.newLines[Y]);$++,M.push({index:D+1,amount:j.newLines.length}),U+=j.newLines.length,j=A[++O]}else this.lines.set($,E[D--]);let q=0;for(let $=M.length-1;$>=0;$--)M[$].index+=q,this.lines.onInsertEmitter.fire(M[$]),q+=M[$].amount;const K=Math.max(0,L+T-this.lines.maxLength);K>0&&this.lines.onTrimEmitter.fire(K)}}translateBufferLineToString(w,x,k=0,A){const T=this.lines.get(w);return T?T.translateToString(x,k,A):""}getWrappedRangeForLine(w){let x=w,k=w;for(;x>0&&this.lines.get(x).isWrapped;)x--;for(;k+1<this.lines.length&&this.lines.get(k+1).isWrapped;)k++;return{first:x,last:k}}setupTabStops(w){for(w!=null?this.tabs[w]||(w=this.prevStop(w)):(this.tabs={},w=0);w<this._cols;w+=this._optionsService.rawOptions.tabStopWidth)this.tabs[w]=!0}prevStop(w){for(w==null&&(w=this.x);!this.tabs[--w]&&w>0;);return w>=this._cols?this._cols-1:w<0?0:w}nextStop(w){for(w==null&&(w=this.x);!this.tabs[++w]&&w<this._cols;);return w>=this._cols?this._cols-1:w<0?0:w}clearMarkers(w){this._isClearing=!0;for(let x=0;x<this.markers.length;x++)this.markers[x].line===w&&(this.markers[x].dispose(),this.markers.splice(x--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let w=0;w<this.markers.length;w++)this.markers[w].dispose(),this.markers.splice(w--,1);this._isClearing=!1}addMarker(w){const x=new v.Marker(w);return this.markers.push(x),x.register(this.lines.onTrim((k=>{x.line-=k,x.line<0&&x.dispose()}))),x.register(this.lines.onInsert((k=>{x.line>=k.index&&(x.line+=k.amount)}))),x.register(this.lines.onDelete((k=>{x.line>=k.index&&x.line<k.index+k.amount&&x.dispose(),x.line>k.index&&(x.line-=k.amount)}))),x.register(x.onDispose((()=>this._removeMarker(x)))),x}_removeMarker(w){this._isClearing||this.markers.splice(this.markers.indexOf(w),1)}}},8437:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLine=o.DEFAULT_ATTR_DATA=void 0;const u=l(3734),h=l(511),f=l(643),m=l(482);o.DEFAULT_ATTR_DATA=Object.freeze(new u.AttributeData);let g=0;class C{constructor(v,_,w=!1){this.isWrapped=w,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*v);const x=_||h.CellData.fromCharData([0,f.NULL_CELL_CHAR,f.NULL_CELL_WIDTH,f.NULL_CELL_CODE]);for(let k=0;k<v;++k)this.setCell(k,x);this.length=v}get(v){const _=this._data[3*v+0],w=2097151&_;return[this._data[3*v+1],2097152&_?this._combined[v]:w?(0,m.stringFromCodePoint)(w):"",_>>22,2097152&_?this._combined[v].charCodeAt(this._combined[v].length-1):w]}set(v,_){this._data[3*v+1]=_[f.CHAR_DATA_ATTR_INDEX],_[f.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[v]=_[1],this._data[3*v+0]=2097152|v|_[f.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*v+0]=_[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|_[f.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(v){return this._data[3*v+0]>>22}hasWidth(v){return 12582912&this._data[3*v+0]}getFg(v){return this._data[3*v+1]}getBg(v){return this._data[3*v+2]}hasContent(v){return 4194303&this._data[3*v+0]}getCodePoint(v){const _=this._data[3*v+0];return 2097152&_?this._combined[v].charCodeAt(this._combined[v].length-1):2097151&_}isCombined(v){return 2097152&this._data[3*v+0]}getString(v){const _=this._data[3*v+0];return 2097152&_?this._combined[v]:2097151&_?(0,m.stringFromCodePoint)(2097151&_):""}isProtected(v){return 536870912&this._data[3*v+2]}loadCell(v,_){return g=3*v,_.content=this._data[g+0],_.fg=this._data[g+1],_.bg=this._data[g+2],2097152&_.content&&(_.combinedData=this._combined[v]),268435456&_.bg&&(_.extended=this._extendedAttrs[v]),_}setCell(v,_){2097152&_.content&&(this._combined[v]=_.combinedData),268435456&_.bg&&(this._extendedAttrs[v]=_.extended),this._data[3*v+0]=_.content,this._data[3*v+1]=_.fg,this._data[3*v+2]=_.bg}setCellFromCodepoint(v,_,w,x){268435456&x.bg&&(this._extendedAttrs[v]=x.extended),this._data[3*v+0]=_|w<<22,this._data[3*v+1]=x.fg,this._data[3*v+2]=x.bg}addCodepointToCell(v,_,w){let x=this._data[3*v+0];2097152&x?this._combined[v]+=(0,m.stringFromCodePoint)(_):2097151&x?(this._combined[v]=(0,m.stringFromCodePoint)(2097151&x)+(0,m.stringFromCodePoint)(_),x&=-2097152,x|=2097152):x=_|4194304,w&&(x&=-12582913,x|=w<<22),this._data[3*v+0]=x}insertCells(v,_,w){if((v%=this.length)&&this.getWidth(v-1)===2&&this.setCellFromCodepoint(v-1,0,1,w),_<this.length-v){const x=new h.CellData;for(let k=this.length-v-_-1;k>=0;--k)this.setCell(v+_+k,this.loadCell(v+k,x));for(let k=0;k<_;++k)this.setCell(v+k,w)}else for(let x=v;x<this.length;++x)this.setCell(x,w);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,w)}deleteCells(v,_,w){if(v%=this.length,_<this.length-v){const x=new h.CellData;for(let k=0;k<this.length-v-_;++k)this.setCell(v+k,this.loadCell(v+_+k,x));for(let k=this.length-_;k<this.length;++k)this.setCell(k,w)}else for(let x=v;x<this.length;++x)this.setCell(x,w);v&&this.getWidth(v-1)===2&&this.setCellFromCodepoint(v-1,0,1,w),this.getWidth(v)!==0||this.hasContent(v)||this.setCellFromCodepoint(v,0,1,w)}replaceCells(v,_,w,x=!1){if(x)for(v&&this.getWidth(v-1)===2&&!this.isProtected(v-1)&&this.setCellFromCodepoint(v-1,0,1,w),_<this.length&&this.getWidth(_-1)===2&&!this.isProtected(_)&&this.setCellFromCodepoint(_,0,1,w);v<_&&v<this.length;)this.isProtected(v)||this.setCell(v,w),v++;else for(v&&this.getWidth(v-1)===2&&this.setCellFromCodepoint(v-1,0,1,w),_<this.length&&this.getWidth(_-1)===2&&this.setCellFromCodepoint(_,0,1,w);v<_&&v<this.length;)this.setCell(v++,w)}resize(v,_){if(v===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const w=3*v;if(v>this.length){if(this._data.buffer.byteLength>=4*w)this._data=new Uint32Array(this._data.buffer,0,w);else{const x=new Uint32Array(w);x.set(this._data),this._data=x}for(let x=this.length;x<v;++x)this.setCell(x,_)}else{this._data=this._data.subarray(0,w);const x=Object.keys(this._combined);for(let A=0;A<x.length;A++){const T=parseInt(x[A],10);T>=v&&delete this._combined[T]}const k=Object.keys(this._extendedAttrs);for(let A=0;A<k.length;A++){const T=parseInt(k[A],10);T>=v&&delete this._extendedAttrs[T]}}return this.length=v,4*w*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const v=new Uint32Array(this._data.length);return v.set(this._data),this._data=v,1}return 0}fill(v,_=!1){if(_)for(let w=0;w<this.length;++w)this.isProtected(w)||this.setCell(w,v);else{this._combined={},this._extendedAttrs={};for(let w=0;w<this.length;++w)this.setCell(w,v)}}copyFrom(v){this.length!==v.length?this._data=new Uint32Array(v._data):this._data.set(v._data),this.length=v.length,this._combined={};for(const _ in v._combined)this._combined[_]=v._combined[_];this._extendedAttrs={};for(const _ in v._extendedAttrs)this._extendedAttrs[_]=v._extendedAttrs[_];this.isWrapped=v.isWrapped}clone(){const v=new C(0);v._data=new Uint32Array(this._data),v.length=this.length;for(const _ in this._combined)v._combined[_]=this._combined[_];for(const _ in this._extendedAttrs)v._extendedAttrs[_]=this._extendedAttrs[_];return v.isWrapped=this.isWrapped,v}getTrimmedLength(){for(let v=this.length-1;v>=0;--v)if(4194303&this._data[3*v+0])return v+(this._data[3*v+0]>>22);return 0}getNoBgTrimmedLength(){for(let v=this.length-1;v>=0;--v)if(4194303&this._data[3*v+0]||50331648&this._data[3*v+2])return v+(this._data[3*v+0]>>22);return 0}copyCellsFrom(v,_,w,x,k){const A=v._data;if(k)for(let M=x-1;M>=0;M--){for(let E=0;E<3;E++)this._data[3*(w+M)+E]=A[3*(_+M)+E];268435456&A[3*(_+M)+2]&&(this._extendedAttrs[w+M]=v._extendedAttrs[_+M])}else for(let M=0;M<x;M++){for(let E=0;E<3;E++)this._data[3*(w+M)+E]=A[3*(_+M)+E];268435456&A[3*(_+M)+2]&&(this._extendedAttrs[w+M]=v._extendedAttrs[_+M])}const T=Object.keys(v._combined);for(let M=0;M<T.length;M++){const E=parseInt(T[M],10);E>=_&&(this._combined[E-_+w]=v._combined[E])}}translateToString(v,_,w,x){_=_??0,w=w??this.length,v&&(w=Math.min(w,this.getTrimmedLength())),x&&(x.length=0);let k="";for(;_<w;){const A=this._data[3*_+0],T=2097151&A,M=2097152&A?this._combined[_]:T?(0,m.stringFromCodePoint)(T):f.WHITESPACE_CELL_CHAR;if(k+=M,x)for(let E=0;E<M.length;++E)x.push(_);_+=A>>22||1}return x&&x.push(_),k}}o.BufferLine=C},4841:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getRangeLength=void 0,o.getRangeLength=function(l,u){if(l.start.y>l.end.y)throw new Error(`Buffer range end (${l.end.x}, ${l.end.y}) cannot be before start (${l.start.x}, ${l.start.y})`);return u*(l.end.y-l.start.y)+(l.end.x-l.start.x+1)}},4634:(a,o)=>{function l(u,h,f){if(h===u.length-1)return u[h].getTrimmedLength();const m=!u[h].hasContent(f-1)&&u[h].getWidth(f-1)===1,g=u[h+1].getWidth(0)===2;return m&&g?f-1:f}Object.defineProperty(o,"__esModule",{value:!0}),o.getWrappedLineTrimmedLength=o.reflowSmallerGetNewLineLengths=o.reflowLargerApplyNewLayout=o.reflowLargerCreateNewLayout=o.reflowLargerGetLinesToRemove=void 0,o.reflowLargerGetLinesToRemove=function(u,h,f,m,g){const C=[];for(let S=0;S<u.length-1;S++){let v=S,_=u.get(++v);if(!_.isWrapped)continue;const w=[u.get(S)];for(;v<u.length&&_.isWrapped;)w.push(_),_=u.get(++v);if(m>=S&&m<v){S+=w.length-1;continue}let x=0,k=l(w,x,h),A=1,T=0;for(;A<w.length;){const E=l(w,A,h),L=E-T,D=f-k,O=Math.min(L,D);w[x].copyCellsFrom(w[A],T,k,O,!1),k+=O,k===f&&(x++,k=0),T+=O,T===E&&(A++,T=0),k===0&&x!==0&&w[x-1].getWidth(f-1)===2&&(w[x].copyCellsFrom(w[x-1],f-1,k++,1,!1),w[x-1].setCell(f-1,g))}w[x].replaceCells(k,f,g);let M=0;for(let E=w.length-1;E>0&&(E>x||w[E].getTrimmedLength()===0);E--)M++;M>0&&(C.push(S+w.length-M),C.push(M)),S+=w.length-1}return C},o.reflowLargerCreateNewLayout=function(u,h){const f=[];let m=0,g=h[m],C=0;for(let S=0;S<u.length;S++)if(g===S){const v=h[++m];u.onDeleteEmitter.fire({index:S-C,amount:v}),S+=v-1,C+=v,g=h[++m]}else f.push(S);return{layout:f,countRemoved:C}},o.reflowLargerApplyNewLayout=function(u,h){const f=[];for(let m=0;m<h.length;m++)f.push(u.get(h[m]));for(let m=0;m<f.length;m++)u.set(m,f[m]);u.length=h.length},o.reflowSmallerGetNewLineLengths=function(u,h,f){const m=[],g=u.map(((_,w)=>l(u,w,h))).reduce(((_,w)=>_+w));let C=0,S=0,v=0;for(;v<g;){if(g-v<f){m.push(g-v);break}C+=f;const _=l(u,S,h);C>_&&(C-=_,S++);const w=u[S].getWidth(C-1)===2;w&&C--;const x=w?f-1:f;m.push(x),v+=x}return m},o.getWrappedLineTrimmedLength=l},5295:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferSet=void 0;const u=l(8460),h=l(844),f=l(9092);class m extends h.Disposable{constructor(C,S){super(),this._optionsService=C,this._bufferService=S,this._onBufferActivate=this.register(new u.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new f.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new f.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(C){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(C),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(C,S){this._normal.resize(C,S),this._alt.resize(C,S),this.setupTabStops(C)}setupTabStops(C){this._normal.setupTabStops(C),this._alt.setupTabStops(C)}}o.BufferSet=m},511:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CellData=void 0;const u=l(482),h=l(643),f=l(3734);class m extends f.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new f.ExtendedAttrs,this.combinedData=""}static fromCharData(C){const S=new m;return S.setFromCharData(C),S}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,u.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(C){this.fg=C[h.CHAR_DATA_ATTR_INDEX],this.bg=0;let S=!1;if(C[h.CHAR_DATA_CHAR_INDEX].length>2)S=!0;else if(C[h.CHAR_DATA_CHAR_INDEX].length===2){const v=C[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=v&&v<=56319){const _=C[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=_&&_<=57343?this.content=1024*(v-55296)+_-56320+65536|C[h.CHAR_DATA_WIDTH_INDEX]<<22:S=!0}else S=!0}else this.content=C[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|C[h.CHAR_DATA_WIDTH_INDEX]<<22;S&&(this.combinedData=C[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|C[h.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.CellData=m},643:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WHITESPACE_CELL_CODE=o.WHITESPACE_CELL_WIDTH=o.WHITESPACE_CELL_CHAR=o.NULL_CELL_CODE=o.NULL_CELL_WIDTH=o.NULL_CELL_CHAR=o.CHAR_DATA_CODE_INDEX=o.CHAR_DATA_WIDTH_INDEX=o.CHAR_DATA_CHAR_INDEX=o.CHAR_DATA_ATTR_INDEX=o.DEFAULT_EXT=o.DEFAULT_ATTR=o.DEFAULT_COLOR=void 0,o.DEFAULT_COLOR=0,o.DEFAULT_ATTR=256|o.DEFAULT_COLOR<<9,o.DEFAULT_EXT=0,o.CHAR_DATA_ATTR_INDEX=0,o.CHAR_DATA_CHAR_INDEX=1,o.CHAR_DATA_WIDTH_INDEX=2,o.CHAR_DATA_CODE_INDEX=3,o.NULL_CELL_CHAR="",o.NULL_CELL_WIDTH=1,o.NULL_CELL_CODE=0,o.WHITESPACE_CELL_CHAR=" ",o.WHITESPACE_CELL_WIDTH=1,o.WHITESPACE_CELL_CODE=32},4863:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Marker=void 0;const u=l(8460),h=l(844);class f{get id(){return this._id}constructor(g){this.line=g,this.isDisposed=!1,this._disposables=[],this._id=f._nextId++,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,h.disposeArray)(this._disposables),this._disposables.length=0)}register(g){return this._disposables.push(g),g}}o.Marker=f,f._nextId=1},7116:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DEFAULT_CHARSET=o.CHARSETS=void 0,o.CHARSETS={},o.DEFAULT_CHARSET=o.CHARSETS.B,o.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},o.CHARSETS.A={"#":""},o.CHARSETS.B=void 0,o.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},o.CHARSETS.C=o.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},o.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},o.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.E=o.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},o.CHARSETS.H=o.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(a,o)=>{var l,u,h;Object.defineProperty(o,"__esModule",{value:!0}),o.C1_ESCAPED=o.C1=o.C0=void 0,(function(f){f.NUL="\0",f.SOH="",f.STX="",f.ETX="",f.EOT="",f.ENQ="",f.ACK="",f.BEL="\x07",f.BS="\b",f.HT="	",f.LF=`
`,f.VT="\v",f.FF="\f",f.CR="\r",f.SO="",f.SI="",f.DLE="",f.DC1="",f.DC2="",f.DC3="",f.DC4="",f.NAK="",f.SYN="",f.ETB="",f.CAN="",f.EM="",f.SUB="",f.ESC="\x1B",f.FS="",f.GS="",f.RS="",f.US="",f.SP=" ",f.DEL=""})(l||(o.C0=l={})),(function(f){f.PAD="",f.HOP="",f.BPH="",f.NBH="",f.IND="",f.NEL="",f.SSA="",f.ESA="",f.HTS="",f.HTJ="",f.VTS="",f.PLD="",f.PLU="",f.RI="",f.SS2="",f.SS3="",f.DCS="",f.PU1="",f.PU2="",f.STS="",f.CCH="",f.MW="",f.SPA="",f.EPA="",f.SOS="",f.SGCI="",f.SCI="",f.CSI="",f.ST="",f.OSC="",f.PM="",f.APC=""})(u||(o.C1=u={})),(function(f){f.ST=`${l.ESC}\\`})(h||(o.C1_ESCAPED=h={}))},7399:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.evaluateKeyboardEvent=void 0;const u=l(2584),h={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};o.evaluateKeyboardEvent=function(f,m,g,C){const S={type:0,cancel:!1,key:void 0},v=(f.shiftKey?1:0)|(f.altKey?2:0)|(f.ctrlKey?4:0)|(f.metaKey?8:0);switch(f.keyCode){case 0:f.key==="UIKeyInputUpArrow"?S.key=m?u.C0.ESC+"OA":u.C0.ESC+"[A":f.key==="UIKeyInputLeftArrow"?S.key=m?u.C0.ESC+"OD":u.C0.ESC+"[D":f.key==="UIKeyInputRightArrow"?S.key=m?u.C0.ESC+"OC":u.C0.ESC+"[C":f.key==="UIKeyInputDownArrow"&&(S.key=m?u.C0.ESC+"OB":u.C0.ESC+"[B");break;case 8:S.key=f.ctrlKey?"\b":u.C0.DEL,f.altKey&&(S.key=u.C0.ESC+S.key);break;case 9:if(f.shiftKey){S.key=u.C0.ESC+"[Z";break}S.key=u.C0.HT,S.cancel=!0;break;case 13:S.key=f.altKey?u.C0.ESC+u.C0.CR:u.C0.CR,S.cancel=!0;break;case 27:S.key=u.C0.ESC,f.altKey&&(S.key=u.C0.ESC+u.C0.ESC),S.cancel=!0;break;case 37:if(f.metaKey)break;v?(S.key=u.C0.ESC+"[1;"+(v+1)+"D",S.key===u.C0.ESC+"[1;3D"&&(S.key=u.C0.ESC+(g?"b":"[1;5D"))):S.key=m?u.C0.ESC+"OD":u.C0.ESC+"[D";break;case 39:if(f.metaKey)break;v?(S.key=u.C0.ESC+"[1;"+(v+1)+"C",S.key===u.C0.ESC+"[1;3C"&&(S.key=u.C0.ESC+(g?"f":"[1;5C"))):S.key=m?u.C0.ESC+"OC":u.C0.ESC+"[C";break;case 38:if(f.metaKey)break;v?(S.key=u.C0.ESC+"[1;"+(v+1)+"A",g||S.key!==u.C0.ESC+"[1;3A"||(S.key=u.C0.ESC+"[1;5A")):S.key=m?u.C0.ESC+"OA":u.C0.ESC+"[A";break;case 40:if(f.metaKey)break;v?(S.key=u.C0.ESC+"[1;"+(v+1)+"B",g||S.key!==u.C0.ESC+"[1;3B"||(S.key=u.C0.ESC+"[1;5B")):S.key=m?u.C0.ESC+"OB":u.C0.ESC+"[B";break;case 45:f.shiftKey||f.ctrlKey||(S.key=u.C0.ESC+"[2~");break;case 46:S.key=v?u.C0.ESC+"[3;"+(v+1)+"~":u.C0.ESC+"[3~";break;case 36:S.key=v?u.C0.ESC+"[1;"+(v+1)+"H":m?u.C0.ESC+"OH":u.C0.ESC+"[H";break;case 35:S.key=v?u.C0.ESC+"[1;"+(v+1)+"F":m?u.C0.ESC+"OF":u.C0.ESC+"[F";break;case 33:f.shiftKey?S.type=2:f.ctrlKey?S.key=u.C0.ESC+"[5;"+(v+1)+"~":S.key=u.C0.ESC+"[5~";break;case 34:f.shiftKey?S.type=3:f.ctrlKey?S.key=u.C0.ESC+"[6;"+(v+1)+"~":S.key=u.C0.ESC+"[6~";break;case 112:S.key=v?u.C0.ESC+"[1;"+(v+1)+"P":u.C0.ESC+"OP";break;case 113:S.key=v?u.C0.ESC+"[1;"+(v+1)+"Q":u.C0.ESC+"OQ";break;case 114:S.key=v?u.C0.ESC+"[1;"+(v+1)+"R":u.C0.ESC+"OR";break;case 115:S.key=v?u.C0.ESC+"[1;"+(v+1)+"S":u.C0.ESC+"OS";break;case 116:S.key=v?u.C0.ESC+"[15;"+(v+1)+"~":u.C0.ESC+"[15~";break;case 117:S.key=v?u.C0.ESC+"[17;"+(v+1)+"~":u.C0.ESC+"[17~";break;case 118:S.key=v?u.C0.ESC+"[18;"+(v+1)+"~":u.C0.ESC+"[18~";break;case 119:S.key=v?u.C0.ESC+"[19;"+(v+1)+"~":u.C0.ESC+"[19~";break;case 120:S.key=v?u.C0.ESC+"[20;"+(v+1)+"~":u.C0.ESC+"[20~";break;case 121:S.key=v?u.C0.ESC+"[21;"+(v+1)+"~":u.C0.ESC+"[21~";break;case 122:S.key=v?u.C0.ESC+"[23;"+(v+1)+"~":u.C0.ESC+"[23~";break;case 123:S.key=v?u.C0.ESC+"[24;"+(v+1)+"~":u.C0.ESC+"[24~";break;default:if(!f.ctrlKey||f.shiftKey||f.altKey||f.metaKey)if(g&&!C||!f.altKey||f.metaKey)!g||f.altKey||f.ctrlKey||f.shiftKey||!f.metaKey?f.key&&!f.ctrlKey&&!f.altKey&&!f.metaKey&&f.keyCode>=48&&f.key.length===1?S.key=f.key:f.key&&f.ctrlKey&&(f.key==="_"&&(S.key=u.C0.US),f.key==="@"&&(S.key=u.C0.NUL)):f.keyCode===65&&(S.type=1);else{const _=h[f.keyCode],w=_?.[f.shiftKey?1:0];if(w)S.key=u.C0.ESC+w;else if(f.keyCode>=65&&f.keyCode<=90){const x=f.ctrlKey?f.keyCode-64:f.keyCode+32;let k=String.fromCharCode(x);f.shiftKey&&(k=k.toUpperCase()),S.key=u.C0.ESC+k}else if(f.keyCode===32)S.key=u.C0.ESC+(f.ctrlKey?u.C0.NUL:" ");else if(f.key==="Dead"&&f.code.startsWith("Key")){let x=f.code.slice(3,4);f.shiftKey||(x=x.toLowerCase()),S.key=u.C0.ESC+x,S.cancel=!0}}else f.keyCode>=65&&f.keyCode<=90?S.key=String.fromCharCode(f.keyCode-64):f.keyCode===32?S.key=u.C0.NUL:f.keyCode>=51&&f.keyCode<=55?S.key=String.fromCharCode(f.keyCode-51+27):f.keyCode===56?S.key=u.C0.DEL:f.keyCode===219?S.key=u.C0.ESC:f.keyCode===220?S.key=u.C0.FS:f.keyCode===221&&(S.key=u.C0.GS)}return S}},482:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Utf8ToUtf32=o.StringToUtf32=o.utf32ToString=o.stringFromCodePoint=void 0,o.stringFromCodePoint=function(l){return l>65535?(l-=65536,String.fromCharCode(55296+(l>>10))+String.fromCharCode(l%1024+56320)):String.fromCharCode(l)},o.utf32ToString=function(l,u=0,h=l.length){let f="";for(let m=u;m<h;++m){let g=l[m];g>65535?(g-=65536,f+=String.fromCharCode(55296+(g>>10))+String.fromCharCode(g%1024+56320)):f+=String.fromCharCode(g)}return f},o.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(l,u){const h=l.length;if(!h)return 0;let f=0,m=0;if(this._interim){const g=l.charCodeAt(m++);56320<=g&&g<=57343?u[f++]=1024*(this._interim-55296)+g-56320+65536:(u[f++]=this._interim,u[f++]=g),this._interim=0}for(let g=m;g<h;++g){const C=l.charCodeAt(g);if(55296<=C&&C<=56319){if(++g>=h)return this._interim=C,f;const S=l.charCodeAt(g);56320<=S&&S<=57343?u[f++]=1024*(C-55296)+S-56320+65536:(u[f++]=C,u[f++]=S)}else C!==65279&&(u[f++]=C)}return f}},o.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(l,u){const h=l.length;if(!h)return 0;let f,m,g,C,S=0,v=0,_=0;if(this.interim[0]){let k=!1,A=this.interim[0];A&=(224&A)==192?31:(240&A)==224?15:7;let T,M=0;for(;(T=63&this.interim[++M])&&M<4;)A<<=6,A|=T;const E=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,L=E-M;for(;_<L;){if(_>=h)return 0;if(T=l[_++],(192&T)!=128){_--,k=!0;break}this.interim[M++]=T,A<<=6,A|=63&T}k||(E===2?A<128?_--:u[S++]=A:E===3?A<2048||A>=55296&&A<=57343||A===65279||(u[S++]=A):A<65536||A>1114111||(u[S++]=A)),this.interim.fill(0)}const w=h-4;let x=_;for(;x<h;){for(;!(!(x<w)||128&(f=l[x])||128&(m=l[x+1])||128&(g=l[x+2])||128&(C=l[x+3]));)u[S++]=f,u[S++]=m,u[S++]=g,u[S++]=C,x+=4;if(f=l[x++],f<128)u[S++]=f;else if((224&f)==192){if(x>=h)return this.interim[0]=f,S;if(m=l[x++],(192&m)!=128){x--;continue}if(v=(31&f)<<6|63&m,v<128){x--;continue}u[S++]=v}else if((240&f)==224){if(x>=h)return this.interim[0]=f,S;if(m=l[x++],(192&m)!=128){x--;continue}if(x>=h)return this.interim[0]=f,this.interim[1]=m,S;if(g=l[x++],(192&g)!=128){x--;continue}if(v=(15&f)<<12|(63&m)<<6|63&g,v<2048||v>=55296&&v<=57343||v===65279)continue;u[S++]=v}else if((248&f)==240){if(x>=h)return this.interim[0]=f,S;if(m=l[x++],(192&m)!=128){x--;continue}if(x>=h)return this.interim[0]=f,this.interim[1]=m,S;if(g=l[x++],(192&g)!=128){x--;continue}if(x>=h)return this.interim[0]=f,this.interim[1]=m,this.interim[2]=g,S;if(C=l[x++],(192&C)!=128){x--;continue}if(v=(7&f)<<18|(63&m)<<12|(63&g)<<6|63&C,v<65536||v>1114111)continue;u[S++]=v}}return S}}},225:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeV6=void 0;const u=l(1480),h=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],f=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let m;o.UnicodeV6=class{constructor(){if(this.version="6",!m){m=new Uint8Array(65536),m.fill(1),m[0]=0,m.fill(0,1,32),m.fill(0,127,160),m.fill(2,4352,4448),m[9001]=2,m[9002]=2,m.fill(2,11904,42192),m[12351]=1,m.fill(2,44032,55204),m.fill(2,63744,64256),m.fill(2,65040,65050),m.fill(2,65072,65136),m.fill(2,65280,65377),m.fill(2,65504,65511);for(let g=0;g<h.length;++g)m.fill(0,h[g][0],h[g][1]+1)}}wcwidth(g){return g<32?0:g<127?1:g<65536?m[g]:(function(C,S){let v,_=0,w=S.length-1;if(C<S[0][0]||C>S[w][1])return!1;for(;w>=_;)if(v=_+w>>1,C>S[v][1])_=v+1;else{if(!(C<S[v][0]))return!0;w=v-1}return!1})(g,f)?0:g>=131072&&g<=196605||g>=196608&&g<=262141?2:1}charProperties(g,C){let S=this.wcwidth(g),v=S===0&&C!==0;if(v){const _=u.UnicodeService.extractWidth(C);_===0?v=!1:_>S&&(S=_)}return u.UnicodeService.createPropertyValue(0,S,v)}}},5981:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WriteBuffer=void 0;const u=l(8460),h=l(844);class f extends h.Disposable{constructor(g){super(),this._action=g,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new u.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(g,C){if(C!==void 0&&this._syncCalls>C)return void(this._syncCalls=0);if(this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let S;for(this._isSyncWriting=!0;S=this._writeBuffer.shift();){this._action(S);const v=this._callbacks.shift();v&&v()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(g,C){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(C),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(C)}_innerWrite(g=0,C=!0){const S=g||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const v=this._writeBuffer[this._bufferOffset],_=this._action(v,C);if(_){const x=k=>Date.now()-S>=12?setTimeout((()=>this._innerWrite(0,k))):this._innerWrite(S,k);return void _.catch((k=>(queueMicrotask((()=>{throw k})),Promise.resolve(!1)))).then(x)}const w=this._callbacks[this._bufferOffset];if(w&&w(),this._bufferOffset++,this._pendingData-=v.length,Date.now()-S>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}o.WriteBuffer=f},5941:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.toRgbString=o.parseColor=void 0;const l=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,u=/^[\da-f]+$/;function h(f,m){const g=f.toString(16),C=g.length<2?"0"+g:g;switch(m){case 4:return g[0];case 8:return C;case 12:return(C+C).slice(0,3);default:return C+C}}o.parseColor=function(f){if(!f)return;let m=f.toLowerCase();if(m.indexOf("rgb:")===0){m=m.slice(4);const g=l.exec(m);if(g){const C=g[1]?15:g[4]?255:g[7]?4095:65535;return[Math.round(parseInt(g[1]||g[4]||g[7]||g[10],16)/C*255),Math.round(parseInt(g[2]||g[5]||g[8]||g[11],16)/C*255),Math.round(parseInt(g[3]||g[6]||g[9]||g[12],16)/C*255)]}}else if(m.indexOf("#")===0&&(m=m.slice(1),u.exec(m)&&[3,6,9,12].includes(m.length))){const g=m.length/3,C=[0,0,0];for(let S=0;S<3;++S){const v=parseInt(m.slice(g*S,g*S+g),16);C[S]=g===1?v<<4:g===2?v:g===3?v>>4:v>>8}return C}},o.toRgbString=function(f,m=16){const[g,C,S]=f;return`rgb:${h(g,m)}/${h(C,m)}/${h(S,m)}`}},5770:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PAYLOAD_LIMIT=void 0,o.PAYLOAD_LIMIT=1e7},6351:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DcsHandler=o.DcsParser=void 0;const u=l(482),h=l(8742),f=l(5770),m=[];o.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=m,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=m}registerHandler(C,S){this._handlers[C]===void 0&&(this._handlers[C]=[]);const v=this._handlers[C];return v.push(S),{dispose:()=>{const _=v.indexOf(S);_!==-1&&v.splice(_,1)}}}clearHandler(C){this._handlers[C]&&delete this._handlers[C]}setHandlerFallback(C){this._handlerFb=C}reset(){if(this._active.length)for(let C=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;C>=0;--C)this._active[C].unhook(!1);this._stack.paused=!1,this._active=m,this._ident=0}hook(C,S){if(this.reset(),this._ident=C,this._active=this._handlers[C]||m,this._active.length)for(let v=this._active.length-1;v>=0;v--)this._active[v].hook(S);else this._handlerFb(this._ident,"HOOK",S)}put(C,S,v){if(this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].put(C,S,v);else this._handlerFb(this._ident,"PUT",(0,u.utf32ToString)(C,S,v))}unhook(C,S=!0){if(this._active.length){let v=!1,_=this._active.length-1,w=!1;if(this._stack.paused&&(_=this._stack.loopPosition-1,v=S,w=this._stack.fallThrough,this._stack.paused=!1),!w&&v===!1){for(;_>=0&&(v=this._active[_].unhook(C),v!==!0);_--)if(v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!1,v;_--}for(;_>=0;_--)if(v=this._active[_].unhook(!1),v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!0,v}else this._handlerFb(this._ident,"UNHOOK",C);this._active=m,this._ident=0}};const g=new h.Params;g.addParam(0),o.DcsHandler=class{constructor(C){this._handler=C,this._data="",this._params=g,this._hitLimit=!1}hook(C){this._params=C.length>1||C.params[0]?C.clone():g,this._data="",this._hitLimit=!1}put(C,S,v){this._hitLimit||(this._data+=(0,u.utf32ToString)(C,S,v),this._data.length>f.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(C){let S=!1;if(this._hitLimit)S=!1;else if(C&&(S=this._handler(this._data,this._params),S instanceof Promise))return S.then((v=>(this._params=g,this._data="",this._hitLimit=!1,v)));return this._params=g,this._data="",this._hitLimit=!1,S}}},2015:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.EscapeSequenceParser=o.VT500_TRANSITION_TABLE=o.TransitionTable=void 0;const u=l(844),h=l(8742),f=l(6242),m=l(6351);class g{constructor(_){this.table=new Uint8Array(_)}setDefault(_,w){this.table.fill(_<<4|w)}add(_,w,x,k){this.table[w<<8|_]=x<<4|k}addMany(_,w,x,k){for(let A=0;A<_.length;A++)this.table[w<<8|_[A]]=x<<4|k}}o.TransitionTable=g;const C=160;o.VT500_TRANSITION_TABLE=(function(){const v=new g(4095),_=Array.apply(null,Array(256)).map(((M,E)=>E)),w=(M,E)=>_.slice(M,E),x=w(32,127),k=w(0,24);k.push(25),k.push.apply(k,w(28,32));const A=w(0,14);let T;for(T in v.setDefault(1,0),v.addMany(x,0,2,0),A)v.addMany([24,26,153,154],T,3,0),v.addMany(w(128,144),T,3,0),v.addMany(w(144,152),T,3,0),v.add(156,T,0,0),v.add(27,T,11,1),v.add(157,T,4,8),v.addMany([152,158,159],T,0,7),v.add(155,T,11,3),v.add(144,T,11,9);return v.addMany(k,0,3,0),v.addMany(k,1,3,1),v.add(127,1,0,1),v.addMany(k,8,0,8),v.addMany(k,3,3,3),v.add(127,3,0,3),v.addMany(k,4,3,4),v.add(127,4,0,4),v.addMany(k,6,3,6),v.addMany(k,5,3,5),v.add(127,5,0,5),v.addMany(k,2,3,2),v.add(127,2,0,2),v.add(93,1,4,8),v.addMany(x,8,5,8),v.add(127,8,5,8),v.addMany([156,27,24,26,7],8,6,0),v.addMany(w(28,32),8,0,8),v.addMany([88,94,95],1,0,7),v.addMany(x,7,0,7),v.addMany(k,7,0,7),v.add(156,7,0,0),v.add(127,7,0,7),v.add(91,1,11,3),v.addMany(w(64,127),3,7,0),v.addMany(w(48,60),3,8,4),v.addMany([60,61,62,63],3,9,4),v.addMany(w(48,60),4,8,4),v.addMany(w(64,127),4,7,0),v.addMany([60,61,62,63],4,0,6),v.addMany(w(32,64),6,0,6),v.add(127,6,0,6),v.addMany(w(64,127),6,0,0),v.addMany(w(32,48),3,9,5),v.addMany(w(32,48),5,9,5),v.addMany(w(48,64),5,0,6),v.addMany(w(64,127),5,7,0),v.addMany(w(32,48),4,9,5),v.addMany(w(32,48),1,9,2),v.addMany(w(32,48),2,9,2),v.addMany(w(48,127),2,10,0),v.addMany(w(48,80),1,10,0),v.addMany(w(81,88),1,10,0),v.addMany([89,90,92],1,10,0),v.addMany(w(96,127),1,10,0),v.add(80,1,11,9),v.addMany(k,9,0,9),v.add(127,9,0,9),v.addMany(w(28,32),9,0,9),v.addMany(w(32,48),9,9,12),v.addMany(w(48,60),9,8,10),v.addMany([60,61,62,63],9,9,10),v.addMany(k,11,0,11),v.addMany(w(32,128),11,0,11),v.addMany(w(28,32),11,0,11),v.addMany(k,10,0,10),v.add(127,10,0,10),v.addMany(w(28,32),10,0,10),v.addMany(w(48,60),10,8,10),v.addMany([60,61,62,63],10,0,11),v.addMany(w(32,48),10,9,12),v.addMany(k,12,0,12),v.add(127,12,0,12),v.addMany(w(28,32),12,0,12),v.addMany(w(32,48),12,9,12),v.addMany(w(48,64),12,0,11),v.addMany(w(64,127),12,12,13),v.addMany(w(64,127),10,12,13),v.addMany(w(64,127),9,12,13),v.addMany(k,13,13,13),v.addMany(x,13,13,13),v.add(127,13,0,13),v.addMany([27,156,24,26],13,14,0),v.add(C,0,2,0),v.add(C,8,5,8),v.add(C,6,0,6),v.add(C,11,0,11),v.add(C,13,13,13),v})();class S extends u.Disposable{constructor(_=o.VT500_TRANSITION_TABLE){super(),this._transitions=_,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new h.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(w,x,k)=>{},this._executeHandlerFb=w=>{},this._csiHandlerFb=(w,x)=>{},this._escHandlerFb=w=>{},this._errorHandlerFb=w=>w,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,u.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new f.OscParser),this._dcsParser=this.register(new m.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(_,w=[64,126]){let x=0;if(_.prefix){if(_.prefix.length>1)throw new Error("only one byte as prefix supported");if(x=_.prefix.charCodeAt(0),x&&60>x||x>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(_.intermediates){if(_.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let A=0;A<_.intermediates.length;++A){const T=_.intermediates.charCodeAt(A);if(32>T||T>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");x<<=8,x|=T}}if(_.final.length!==1)throw new Error("final must be a single byte");const k=_.final.charCodeAt(0);if(w[0]>k||k>w[1])throw new Error(`final must be in range ${w[0]} .. ${w[1]}`);return x<<=8,x|=k,x}identToString(_){const w=[];for(;_;)w.push(String.fromCharCode(255&_)),_>>=8;return w.reverse().join("")}setPrintHandler(_){this._printHandler=_}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(_,w){const x=this._identifier(_,[48,126]);this._escHandlers[x]===void 0&&(this._escHandlers[x]=[]);const k=this._escHandlers[x];return k.push(w),{dispose:()=>{const A=k.indexOf(w);A!==-1&&k.splice(A,1)}}}clearEscHandler(_){this._escHandlers[this._identifier(_,[48,126])]&&delete this._escHandlers[this._identifier(_,[48,126])]}setEscHandlerFallback(_){this._escHandlerFb=_}setExecuteHandler(_,w){this._executeHandlers[_.charCodeAt(0)]=w}clearExecuteHandler(_){this._executeHandlers[_.charCodeAt(0)]&&delete this._executeHandlers[_.charCodeAt(0)]}setExecuteHandlerFallback(_){this._executeHandlerFb=_}registerCsiHandler(_,w){const x=this._identifier(_);this._csiHandlers[x]===void 0&&(this._csiHandlers[x]=[]);const k=this._csiHandlers[x];return k.push(w),{dispose:()=>{const A=k.indexOf(w);A!==-1&&k.splice(A,1)}}}clearCsiHandler(_){this._csiHandlers[this._identifier(_)]&&delete this._csiHandlers[this._identifier(_)]}setCsiHandlerFallback(_){this._csiHandlerFb=_}registerDcsHandler(_,w){return this._dcsParser.registerHandler(this._identifier(_),w)}clearDcsHandler(_){this._dcsParser.clearHandler(this._identifier(_))}setDcsHandlerFallback(_){this._dcsParser.setHandlerFallback(_)}registerOscHandler(_,w){return this._oscParser.registerHandler(_,w)}clearOscHandler(_){this._oscParser.clearHandler(_)}setOscHandlerFallback(_){this._oscParser.setHandlerFallback(_)}setErrorHandler(_){this._errorHandler=_}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(_,w,x,k,A){this._parseStack.state=_,this._parseStack.handlers=w,this._parseStack.handlerPos=x,this._parseStack.transition=k,this._parseStack.chunkPos=A}parse(_,w,x){let k,A=0,T=0,M=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,M=this._parseStack.chunkPos+1;else{if(x===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const E=this._parseStack.handlers;let L=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(x===!1&&L>-1){for(;L>=0&&(k=E[L](this._params),k!==!0);L--)if(k instanceof Promise)return this._parseStack.handlerPos=L,k}this._parseStack.handlers=[];break;case 4:if(x===!1&&L>-1){for(;L>=0&&(k=E[L](),k!==!0);L--)if(k instanceof Promise)return this._parseStack.handlerPos=L,k}this._parseStack.handlers=[];break;case 6:if(A=_[this._parseStack.chunkPos],k=this._dcsParser.unhook(A!==24&&A!==26,x),k)return k;A===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(A=_[this._parseStack.chunkPos],k=this._oscParser.end(A!==24&&A!==26,x),k)return k;A===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,M=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let E=M;E<w;++E){switch(A=_[E],T=this._transitions.table[this.currentState<<8|(A<160?A:C)],T>>4){case 2:for(let U=E+1;;++U){if(U>=w||(A=_[U])<32||A>126&&A<C){this._printHandler(_,E,U),E=U-1;break}if(++U>=w||(A=_[U])<32||A>126&&A<C){this._printHandler(_,E,U),E=U-1;break}if(++U>=w||(A=_[U])<32||A>126&&A<C){this._printHandler(_,E,U),E=U-1;break}if(++U>=w||(A=_[U])<32||A>126&&A<C){this._printHandler(_,E,U),E=U-1;break}}break;case 3:this._executeHandlers[A]?this._executeHandlers[A]():this._executeHandlerFb(A),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:E,code:A,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const L=this._csiHandlers[this._collect<<8|A];let D=L?L.length-1:-1;for(;D>=0&&(k=L[D](this._params),k!==!0);D--)if(k instanceof Promise)return this._preserveStack(3,L,D,T,E),k;D<0&&this._csiHandlerFb(this._collect<<8|A,this._params),this.precedingJoinState=0;break;case 8:do switch(A){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(A-48)}while(++E<w&&(A=_[E])>47&&A<60);E--;break;case 9:this._collect<<=8,this._collect|=A;break;case 10:const O=this._escHandlers[this._collect<<8|A];let j=O?O.length-1:-1;for(;j>=0&&(k=O[j](),k!==!0);j--)if(k instanceof Promise)return this._preserveStack(4,O,j,T,E),k;j<0&&this._escHandlerFb(this._collect<<8|A),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|A,this._params);break;case 13:for(let U=E+1;;++U)if(U>=w||(A=_[U])===24||A===26||A===27||A>127&&A<C){this._dcsParser.put(_,E,U),E=U-1;break}break;case 14:if(k=this._dcsParser.unhook(A!==24&&A!==26),k)return this._preserveStack(6,[],0,T,E),k;A===27&&(T|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let U=E+1;;U++)if(U>=w||(A=_[U])<32||A>127&&A<C){this._oscParser.put(_,E,U),E=U-1;break}break;case 6:if(k=this._oscParser.end(A!==24&&A!==26),k)return this._preserveStack(5,[],0,T,E),k;A===27&&(T|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&T}}}o.EscapeSequenceParser=S},6242:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OscHandler=o.OscParser=void 0;const u=l(5770),h=l(482),f=[];o.OscParser=class{constructor(){this._state=0,this._active=f,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(m,g){this._handlers[m]===void 0&&(this._handlers[m]=[]);const C=this._handlers[m];return C.push(g),{dispose:()=>{const S=C.indexOf(g);S!==-1&&C.splice(S,1)}}}clearHandler(m){this._handlers[m]&&delete this._handlers[m]}setHandlerFallback(m){this._handlerFb=m}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=f}reset(){if(this._state===2)for(let m=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;m>=0;--m)this._active[m].end(!1);this._stack.paused=!1,this._active=f,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||f,this._active.length)for(let m=this._active.length-1;m>=0;m--)this._active[m].start();else this._handlerFb(this._id,"START")}_put(m,g,C){if(this._active.length)for(let S=this._active.length-1;S>=0;S--)this._active[S].put(m,g,C);else this._handlerFb(this._id,"PUT",(0,h.utf32ToString)(m,g,C))}start(){this.reset(),this._state=1}put(m,g,C){if(this._state!==3){if(this._state===1)for(;g<C;){const S=m[g++];if(S===59){this._state=2,this._start();break}if(S<48||57<S)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+S-48}this._state===2&&C-g>0&&this._put(m,g,C)}}end(m,g=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let C=!1,S=this._active.length-1,v=!1;if(this._stack.paused&&(S=this._stack.loopPosition-1,C=g,v=this._stack.fallThrough,this._stack.paused=!1),!v&&C===!1){for(;S>=0&&(C=this._active[S].end(m),C!==!0);S--)if(C instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=S,this._stack.fallThrough=!1,C;S--}for(;S>=0;S--)if(C=this._active[S].end(!1),C instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=S,this._stack.fallThrough=!0,C}else this._handlerFb(this._id,"END",m);this._active=f,this._id=-1,this._state=0}}},o.OscHandler=class{constructor(m){this._handler=m,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(m,g,C){this._hitLimit||(this._data+=(0,h.utf32ToString)(m,g,C),this._data.length>u.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(m){let g=!1;if(this._hitLimit)g=!1;else if(m&&(g=this._handler(this._data),g instanceof Promise))return g.then((C=>(this._data="",this._hitLimit=!1,C)));return this._data="",this._hitLimit=!1,g}}},8742:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Params=void 0;const l=2147483647;class u{static fromArray(f){const m=new u;if(!f.length)return m;for(let g=Array.isArray(f[0])?1:0;g<f.length;++g){const C=f[g];if(Array.isArray(C))for(let S=0;S<C.length;++S)m.addSubParam(C[S]);else m.addParam(C)}return m}constructor(f=32,m=32){if(this.maxLength=f,this.maxSubParamsLength=m,m>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(f),this.length=0,this._subParams=new Int32Array(m),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(f),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const f=new u(this.maxLength,this.maxSubParamsLength);return f.params.set(this.params),f.length=this.length,f._subParams.set(this._subParams),f._subParamsLength=this._subParamsLength,f._subParamsIdx.set(this._subParamsIdx),f._rejectDigits=this._rejectDigits,f._rejectSubDigits=this._rejectSubDigits,f._digitIsSub=this._digitIsSub,f}toArray(){const f=[];for(let m=0;m<this.length;++m){f.push(this.params[m]);const g=this._subParamsIdx[m]>>8,C=255&this._subParamsIdx[m];C-g>0&&f.push(Array.prototype.slice.call(this._subParams,g,C))}return f}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(f){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(f<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=f>l?l:f}}addSubParam(f){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(f<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=f>l?l:f,this._subParamsIdx[this.length-1]++}}hasSubParams(f){return(255&this._subParamsIdx[f])-(this._subParamsIdx[f]>>8)>0}getSubParams(f){const m=this._subParamsIdx[f]>>8,g=255&this._subParamsIdx[f];return g-m>0?this._subParams.subarray(m,g):null}getSubParamsAll(){const f={};for(let m=0;m<this.length;++m){const g=this._subParamsIdx[m]>>8,C=255&this._subParamsIdx[m];C-g>0&&(f[m]=this._subParams.slice(g,C))}return f}addDigit(f){let m;if(this._rejectDigits||!(m=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const g=this._digitIsSub?this._subParams:this.params,C=g[m-1];g[m-1]=~C?Math.min(10*C+f,l):f}}o.Params=u},5741:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.AddonManager=void 0,o.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let l=this._addons.length-1;l>=0;l--)this._addons[l].instance.dispose()}loadAddon(l,u){const h={instance:u,dispose:u.dispose,isDisposed:!1};this._addons.push(h),u.dispose=()=>this._wrappedAddonDispose(h),u.activate(l)}_wrappedAddonDispose(l){if(l.isDisposed)return;let u=-1;for(let h=0;h<this._addons.length;h++)if(this._addons[h]===l){u=h;break}if(u===-1)throw new Error("Could not dispose an addon that has not been loaded");l.isDisposed=!0,l.dispose.apply(l.instance),this._addons.splice(u,1)}}},8771:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferApiView=void 0;const u=l(3785),h=l(511);o.BufferApiView=class{constructor(f,m){this._buffer=f,this.type=m}init(f){return this._buffer=f,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(f){const m=this._buffer.lines.get(f);if(m)return new u.BufferLineApiView(m)}getNullCell(){return new h.CellData}}},3785:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLineApiView=void 0;const u=l(511);o.BufferLineApiView=class{constructor(h){this._line=h}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(h,f){if(!(h<0||h>=this._line.length))return f?(this._line.loadCell(h,f),f):this._line.loadCell(h,new u.CellData)}translateToString(h,f,m){return this._line.translateToString(h,f,m)}}},8285:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferNamespaceApi=void 0;const u=l(8771),h=l(8460),f=l(844);class m extends f.Disposable{constructor(C){super(),this._core=C,this._onBufferChange=this.register(new h.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new u.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new u.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}o.BufferNamespaceApi=m},7975:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ParserApi=void 0,o.ParserApi=class{constructor(l){this._core=l}registerCsiHandler(l,u){return this._core.registerCsiHandler(l,(h=>u(h.toArray())))}addCsiHandler(l,u){return this.registerCsiHandler(l,u)}registerDcsHandler(l,u){return this._core.registerDcsHandler(l,((h,f)=>u(h,f.toArray())))}addDcsHandler(l,u){return this.registerDcsHandler(l,u)}registerEscHandler(l,u){return this._core.registerEscHandler(l,u)}addEscHandler(l,u){return this.registerEscHandler(l,u)}registerOscHandler(l,u){return this._core.registerOscHandler(l,u)}addOscHandler(l,u){return this.registerOscHandler(l,u)}}},7090:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeApi=void 0,o.UnicodeApi=class{constructor(l){this._core=l}register(l){this._core.unicodeService.register(l)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(l){this._core.unicodeService.activeVersion=l}}},744:function(a,o,l){var u=this&&this.__decorate||function(v,_,w,x){var k,A=arguments.length,T=A<3?_:x===null?x=Object.getOwnPropertyDescriptor(_,w):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(v,_,w,x);else for(var M=v.length-1;M>=0;M--)(k=v[M])&&(T=(A<3?k(T):A>3?k(_,w,T):k(_,w))||T);return A>3&&T&&Object.defineProperty(_,w,T),T},h=this&&this.__param||function(v,_){return function(w,x){_(w,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferService=o.MINIMUM_ROWS=o.MINIMUM_COLS=void 0;const f=l(8460),m=l(844),g=l(5295),C=l(2585);o.MINIMUM_COLS=2,o.MINIMUM_ROWS=1;let S=o.BufferService=class extends m.Disposable{get buffer(){return this.buffers.active}constructor(v){super(),this.isUserScrolling=!1,this._onResize=this.register(new f.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new f.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(v.rawOptions.cols||0,o.MINIMUM_COLS),this.rows=Math.max(v.rawOptions.rows||0,o.MINIMUM_ROWS),this.buffers=this.register(new g.BufferSet(v,this))}resize(v,_){this.cols=v,this.rows=_,this.buffers.resize(v,_),this._onResize.fire({cols:v,rows:_})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(v,_=!1){const w=this.buffer;let x;x=this._cachedBlankLine,x&&x.length===this.cols&&x.getFg(0)===v.fg&&x.getBg(0)===v.bg||(x=w.getBlankLine(v,_),this._cachedBlankLine=x),x.isWrapped=_;const k=w.ybase+w.scrollTop,A=w.ybase+w.scrollBottom;if(w.scrollTop===0){const T=w.lines.isFull;A===w.lines.length-1?T?w.lines.recycle().copyFrom(x):w.lines.push(x.clone()):w.lines.splice(A+1,0,x.clone()),T?this.isUserScrolling&&(w.ydisp=Math.max(w.ydisp-1,0)):(w.ybase++,this.isUserScrolling||w.ydisp++)}else{const T=A-k+1;w.lines.shiftElements(k+1,T-1,-1),w.lines.set(A,x.clone())}this.isUserScrolling||(w.ydisp=w.ybase),this._onScroll.fire(w.ydisp)}scrollLines(v,_,w){const x=this.buffer;if(v<0){if(x.ydisp===0)return;this.isUserScrolling=!0}else v+x.ydisp>=x.ybase&&(this.isUserScrolling=!1);const k=x.ydisp;x.ydisp=Math.max(Math.min(x.ydisp+v,x.ybase),0),k!==x.ydisp&&(_||this._onScroll.fire(x.ydisp))}};o.BufferService=S=u([h(0,C.IOptionsService)],S)},7994:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CharsetService=void 0,o.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(l){this.glevel=l,this.charset=this._charsets[l]}setgCharset(l,u){this._charsets[l]=u,this.glevel===l&&(this.charset=u)}}},1753:function(a,o,l){var u=this&&this.__decorate||function(x,k,A,T){var M,E=arguments.length,L=E<3?k:T===null?T=Object.getOwnPropertyDescriptor(k,A):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(x,k,A,T);else for(var D=x.length-1;D>=0;D--)(M=x[D])&&(L=(E<3?M(L):E>3?M(k,A,L):M(k,A))||L);return E>3&&L&&Object.defineProperty(k,A,L),L},h=this&&this.__param||function(x,k){return function(A,T){k(A,T,x)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreMouseService=void 0;const f=l(2585),m=l(8460),g=l(844),C={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:x=>x.button!==4&&x.action===1&&(x.ctrl=!1,x.alt=!1,x.shift=!1,!0)},VT200:{events:19,restrict:x=>x.action!==32},DRAG:{events:23,restrict:x=>x.action!==32||x.button!==3},ANY:{events:31,restrict:x=>!0}};function S(x,k){let A=(x.ctrl?16:0)|(x.shift?4:0)|(x.alt?8:0);return x.button===4?(A|=64,A|=x.action):(A|=3&x.button,4&x.button&&(A|=64),8&x.button&&(A|=128),x.action===32?A|=32:x.action!==0||k||(A|=3)),A}const v=String.fromCharCode,_={DEFAULT:x=>{const k=[S(x,!1)+32,x.col+32,x.row+32];return k[0]>255||k[1]>255||k[2]>255?"":`\x1B[M${v(k[0])}${v(k[1])}${v(k[2])}`},SGR:x=>{const k=x.action===0&&x.button!==4?"m":"M";return`\x1B[<${S(x,!0)};${x.col};${x.row}${k}`},SGR_PIXELS:x=>{const k=x.action===0&&x.button!==4?"m":"M";return`\x1B[<${S(x,!0)};${x.x};${x.y}${k}`}};let w=o.CoreMouseService=class extends g.Disposable{constructor(x,k){super(),this._bufferService=x,this._coreService=k,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new m.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const A of Object.keys(C))this.addProtocol(A,C[A]);for(const A of Object.keys(_))this.addEncoding(A,_[A]);this.reset()}addProtocol(x,k){this._protocols[x]=k}addEncoding(x,k){this._encodings[x]=k}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(x){if(!this._protocols[x])throw new Error(`unknown protocol "${x}"`);this._activeProtocol=x,this._onProtocolChange.fire(this._protocols[x].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(x){if(!this._encodings[x])throw new Error(`unknown encoding "${x}"`);this._activeEncoding=x}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(x){if(x.col<0||x.col>=this._bufferService.cols||x.row<0||x.row>=this._bufferService.rows||x.button===4&&x.action===32||x.button===3&&x.action!==32||x.button!==4&&(x.action===2||x.action===3)||(x.col++,x.row++,x.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,x,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(x))return!1;const k=this._encodings[this._activeEncoding](x);return k&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(k):this._coreService.triggerDataEvent(k,!0)),this._lastEvent=x,!0}explainEvents(x){return{down:!!(1&x),up:!!(2&x),drag:!!(4&x),move:!!(8&x),wheel:!!(16&x)}}_equalEvents(x,k,A){if(A){if(x.x!==k.x||x.y!==k.y)return!1}else if(x.col!==k.col||x.row!==k.row)return!1;return x.button===k.button&&x.action===k.action&&x.ctrl===k.ctrl&&x.alt===k.alt&&x.shift===k.shift}};o.CoreMouseService=w=u([h(0,f.IBufferService),h(1,f.ICoreService)],w)},6975:function(a,o,l){var u=this&&this.__decorate||function(w,x,k,A){var T,M=arguments.length,E=M<3?x:A===null?A=Object.getOwnPropertyDescriptor(x,k):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(w,x,k,A);else for(var L=w.length-1;L>=0;L--)(T=w[L])&&(E=(M<3?T(E):M>3?T(x,k,E):T(x,k))||E);return M>3&&E&&Object.defineProperty(x,k,E),E},h=this&&this.__param||function(w,x){return function(k,A){x(k,A,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreService=void 0;const f=l(1439),m=l(8460),g=l(844),C=l(2585),S=Object.freeze({insertMode:!1}),v=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let _=o.CoreService=class extends g.Disposable{constructor(w,x,k){super(),this._bufferService=w,this._logService=x,this._optionsService=k,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new m.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new m.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new m.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new m.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,f.clone)(S),this.decPrivateModes=(0,f.clone)(v)}reset(){this.modes=(0,f.clone)(S),this.decPrivateModes=(0,f.clone)(v)}triggerDataEvent(w,x=!1){if(this._optionsService.rawOptions.disableStdin)return;const k=this._bufferService.buffer;x&&this._optionsService.rawOptions.scrollOnUserInput&&k.ybase!==k.ydisp&&this._onRequestScrollToBottom.fire(),x&&this._onUserInput.fire(),this._logService.debug(`sending data "${w}"`,(()=>w.split("").map((A=>A.charCodeAt(0))))),this._onData.fire(w)}triggerBinaryEvent(w){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${w}"`,(()=>w.split("").map((x=>x.charCodeAt(0))))),this._onBinary.fire(w))}};o.CoreService=_=u([h(0,C.IBufferService),h(1,C.ILogService),h(2,C.IOptionsService)],_)},9074:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DecorationService=void 0;const u=l(8055),h=l(8460),f=l(844),m=l(6106);let g=0,C=0;class S extends f.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new m.SortedList((w=>w?.marker.line)),this._onDecorationRegistered=this.register(new h.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new h.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,f.toDisposable)((()=>this.reset())))}registerDecoration(w){if(w.marker.isDisposed)return;const x=new v(w);if(x){const k=x.marker.onDispose((()=>x.dispose()));x.onDispose((()=>{x&&(this._decorations.delete(x)&&this._onDecorationRemoved.fire(x),k.dispose())})),this._decorations.insert(x),this._onDecorationRegistered.fire(x)}return x}reset(){for(const w of this._decorations.values())w.dispose();this._decorations.clear()}*getDecorationsAtCell(w,x,k){let A=0,T=0;for(const M of this._decorations.getKeyIterator(x))A=M.options.x??0,T=A+(M.options.width??1),w>=A&&w<T&&(!k||(M.options.layer??"bottom")===k)&&(yield M)}forEachDecorationAtCell(w,x,k,A){this._decorations.forEachByKey(x,(T=>{g=T.options.x??0,C=g+(T.options.width??1),w>=g&&w<C&&(!k||(T.options.layer??"bottom")===k)&&A(T)}))}}o.DecorationService=S;class v extends f.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=u.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=u.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(w){super(),this.options=w,this.onRenderEmitter=this.register(new h.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new h.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=w.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.InstantiationService=o.ServiceCollection=void 0;const u=l(2585),h=l(8343);class f{constructor(...g){this._entries=new Map;for(const[C,S]of g)this.set(C,S)}set(g,C){const S=this._entries.get(g);return this._entries.set(g,C),S}forEach(g){for(const[C,S]of this._entries.entries())g(C,S)}has(g){return this._entries.has(g)}get(g){return this._entries.get(g)}}o.ServiceCollection=f,o.InstantiationService=class{constructor(){this._services=new f,this._services.set(u.IInstantiationService,this)}setService(m,g){this._services.set(m,g)}getService(m){return this._services.get(m)}createInstance(m,...g){const C=(0,h.getServiceDependencies)(m).sort(((_,w)=>_.index-w.index)),S=[];for(const _ of C){const w=this._services.get(_.id);if(!w)throw new Error(`[createInstance] ${m.name} depends on UNKNOWN service ${_.id}.`);S.push(w)}const v=C.length>0?C[0].index:g.length;if(g.length!==v)throw new Error(`[createInstance] First service dependency of ${m.name} at position ${v+1} conflicts with ${g.length} static arguments`);return new m(...g,...S)}}},7866:function(a,o,l){var u=this&&this.__decorate||function(v,_,w,x){var k,A=arguments.length,T=A<3?_:x===null?x=Object.getOwnPropertyDescriptor(_,w):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(v,_,w,x);else for(var M=v.length-1;M>=0;M--)(k=v[M])&&(T=(A<3?k(T):A>3?k(_,w,T):k(_,w))||T);return A>3&&T&&Object.defineProperty(_,w,T),T},h=this&&this.__param||function(v,_){return function(w,x){_(w,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.traceCall=o.setTraceLogger=o.LogService=void 0;const f=l(844),m=l(2585),g={trace:m.LogLevelEnum.TRACE,debug:m.LogLevelEnum.DEBUG,info:m.LogLevelEnum.INFO,warn:m.LogLevelEnum.WARN,error:m.LogLevelEnum.ERROR,off:m.LogLevelEnum.OFF};let C,S=o.LogService=class extends f.Disposable{get logLevel(){return this._logLevel}constructor(v){super(),this._optionsService=v,this._logLevel=m.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),C=this}_updateLogLevel(){this._logLevel=g[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(v){for(let _=0;_<v.length;_++)typeof v[_]=="function"&&(v[_]=v[_]())}_log(v,_,w){this._evalLazyOptionalParams(w),v.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+_,...w)}trace(v,..._){this._logLevel<=m.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,v,_)}debug(v,..._){this._logLevel<=m.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,v,_)}info(v,..._){this._logLevel<=m.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,v,_)}warn(v,..._){this._logLevel<=m.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,v,_)}error(v,..._){this._logLevel<=m.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,v,_)}};o.LogService=S=u([h(0,m.IOptionsService)],S),o.setTraceLogger=function(v){C=v},o.traceCall=function(v,_,w){if(typeof w.value!="function")throw new Error("not supported");const x=w.value;w.value=function(...k){if(C.logLevel!==m.LogLevelEnum.TRACE)return x.apply(this,k);C.trace(`GlyphRenderer#${x.name}(${k.map((T=>JSON.stringify(T))).join(", ")})`);const A=x.apply(this,k);return C.trace(`GlyphRenderer#${x.name} return`,A),A}}},7302:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OptionsService=o.DEFAULT_OPTIONS=void 0;const u=l(8460),h=l(844),f=l(6114);o.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:f.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const m=["normal","bold","100","200","300","400","500","600","700","800","900"];class g extends h.Disposable{constructor(S){super(),this._onOptionChange=this.register(new u.EventEmitter),this.onOptionChange=this._onOptionChange.event;const v={...o.DEFAULT_OPTIONS};for(const _ in S)if(_ in v)try{const w=S[_];v[_]=this._sanitizeAndValidateOption(_,w)}catch(w){console.error(w)}this.rawOptions=v,this.options={...v},this._setupOptions(),this.register((0,h.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(S,v){return this.onOptionChange((_=>{_===S&&v(this.rawOptions[S])}))}onMultipleOptionChange(S,v){return this.onOptionChange((_=>{S.indexOf(_)!==-1&&v()}))}_setupOptions(){const S=_=>{if(!(_ in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${_}"`);return this.rawOptions[_]},v=(_,w)=>{if(!(_ in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${_}"`);w=this._sanitizeAndValidateOption(_,w),this.rawOptions[_]!==w&&(this.rawOptions[_]=w,this._onOptionChange.fire(_))};for(const _ in this.rawOptions){const w={get:S.bind(this,_),set:v.bind(this,_)};Object.defineProperty(this.options,_,w)}}_sanitizeAndValidateOption(S,v){switch(S){case"cursorStyle":if(v||(v=o.DEFAULT_OPTIONS[S]),!(function(_){return _==="block"||_==="underline"||_==="bar"})(v))throw new Error(`"${v}" is not a valid value for ${S}`);break;case"wordSeparator":v||(v=o.DEFAULT_OPTIONS[S]);break;case"fontWeight":case"fontWeightBold":if(typeof v=="number"&&1<=v&&v<=1e3)break;v=m.includes(v)?v:o.DEFAULT_OPTIONS[S];break;case"cursorWidth":v=Math.floor(v);case"lineHeight":case"tabStopWidth":if(v<1)throw new Error(`${S} cannot be less than 1, value: ${v}`);break;case"minimumContrastRatio":v=Math.max(1,Math.min(21,Math.round(10*v)/10));break;case"scrollback":if((v=Math.min(v,4294967295))<0)throw new Error(`${S} cannot be less than 0, value: ${v}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(v<=0)throw new Error(`${S} cannot be less than or equal to 0, value: ${v}`);break;case"rows":case"cols":if(!v&&v!==0)throw new Error(`${S} must be numeric, value: ${v}`);break;case"windowsPty":v=v??{}}return v}}o.OptionsService=g},2660:function(a,o,l){var u=this&&this.__decorate||function(g,C,S,v){var _,w=arguments.length,x=w<3?C:v===null?v=Object.getOwnPropertyDescriptor(C,S):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(g,C,S,v);else for(var k=g.length-1;k>=0;k--)(_=g[k])&&(x=(w<3?_(x):w>3?_(C,S,x):_(C,S))||x);return w>3&&x&&Object.defineProperty(C,S,x),x},h=this&&this.__param||function(g,C){return function(S,v){C(S,v,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkService=void 0;const f=l(2585);let m=o.OscLinkService=class{constructor(g){this._bufferService=g,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(g){const C=this._bufferService.buffer;if(g.id===void 0){const k=C.addMarker(C.ybase+C.y),A={data:g,id:this._nextId++,lines:[k]};return k.onDispose((()=>this._removeMarkerFromLink(A,k))),this._dataByLinkId.set(A.id,A),A.id}const S=g,v=this._getEntryIdKey(S),_=this._entriesWithId.get(v);if(_)return this.addLineToLink(_.id,C.ybase+C.y),_.id;const w=C.addMarker(C.ybase+C.y),x={id:this._nextId++,key:this._getEntryIdKey(S),data:S,lines:[w]};return w.onDispose((()=>this._removeMarkerFromLink(x,w))),this._entriesWithId.set(x.key,x),this._dataByLinkId.set(x.id,x),x.id}addLineToLink(g,C){const S=this._dataByLinkId.get(g);if(S&&S.lines.every((v=>v.line!==C))){const v=this._bufferService.buffer.addMarker(C);S.lines.push(v),v.onDispose((()=>this._removeMarkerFromLink(S,v)))}}getLinkData(g){return this._dataByLinkId.get(g)?.data}_getEntryIdKey(g){return`${g.id};;${g.uri}`}_removeMarkerFromLink(g,C){const S=g.lines.indexOf(C);S!==-1&&(g.lines.splice(S,1),g.lines.length===0&&(g.data.id!==void 0&&this._entriesWithId.delete(g.key),this._dataByLinkId.delete(g.id)))}};o.OscLinkService=m=u([h(0,f.IBufferService)],m)},8343:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createDecorator=o.getServiceDependencies=o.serviceRegistry=void 0;const l="di$target",u="di$dependencies";o.serviceRegistry=new Map,o.getServiceDependencies=function(h){return h[u]||[]},o.createDecorator=function(h){if(o.serviceRegistry.has(h))return o.serviceRegistry.get(h);const f=function(m,g,C){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(S,v,_){v[l]===v?v[u].push({id:S,index:_}):(v[u]=[{id:S,index:_}],v[l]=v)})(f,m,C)};return f.toString=()=>h,o.serviceRegistry.set(h,f),f}},2585:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.IDecorationService=o.IUnicodeService=o.IOscLinkService=o.IOptionsService=o.ILogService=o.LogLevelEnum=o.IInstantiationService=o.ICharsetService=o.ICoreService=o.ICoreMouseService=o.IBufferService=void 0;const u=l(8343);var h;o.IBufferService=(0,u.createDecorator)("BufferService"),o.ICoreMouseService=(0,u.createDecorator)("CoreMouseService"),o.ICoreService=(0,u.createDecorator)("CoreService"),o.ICharsetService=(0,u.createDecorator)("CharsetService"),o.IInstantiationService=(0,u.createDecorator)("InstantiationService"),(function(f){f[f.TRACE=0]="TRACE",f[f.DEBUG=1]="DEBUG",f[f.INFO=2]="INFO",f[f.WARN=3]="WARN",f[f.ERROR=4]="ERROR",f[f.OFF=5]="OFF"})(h||(o.LogLevelEnum=h={})),o.ILogService=(0,u.createDecorator)("LogService"),o.IOptionsService=(0,u.createDecorator)("OptionsService"),o.IOscLinkService=(0,u.createDecorator)("OscLinkService"),o.IUnicodeService=(0,u.createDecorator)("UnicodeService"),o.IDecorationService=(0,u.createDecorator)("DecorationService")},1480:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeService=void 0;const u=l(8460),h=l(225);class f{static extractShouldJoin(g){return(1&g)!=0}static extractWidth(g){return g>>1&3}static extractCharKind(g){return g>>3}static createPropertyValue(g,C,S=!1){return(16777215&g)<<3|(3&C)<<1|(S?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new u.EventEmitter,this.onChange=this._onChange.event;const g=new h.UnicodeV6;this.register(g),this._active=g.version,this._activeProvider=g}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(g){if(!this._providers[g])throw new Error(`unknown Unicode version "${g}"`);this._active=g,this._activeProvider=this._providers[g],this._onChange.fire(g)}register(g){this._providers[g.version]=g}wcwidth(g){return this._activeProvider.wcwidth(g)}getStringCellWidth(g){let C=0,S=0;const v=g.length;for(let _=0;_<v;++_){let w=g.charCodeAt(_);if(55296<=w&&w<=56319){if(++_>=v)return C+this.wcwidth(w);const A=g.charCodeAt(_);56320<=A&&A<=57343?w=1024*(w-55296)+A-56320+65536:C+=this.wcwidth(A)}const x=this.charProperties(w,S);let k=f.extractWidth(x);f.extractShouldJoin(x)&&(k-=f.extractWidth(S)),C+=k,S=x}return C}charProperties(g,C){return this._activeProvider.charProperties(g,C)}}o.UnicodeService=f}},i={};function s(a){var o=i[a];if(o!==void 0)return o.exports;var l=i[a]={exports:{}};return n[a].call(l.exports,l,l.exports,s),l.exports}var r={};return(()=>{var a=r;Object.defineProperty(a,"__esModule",{value:!0}),a.Terminal=void 0;const o=s(9042),l=s(3236),u=s(844),h=s(5741),f=s(8285),m=s(7975),g=s(7090),C=["cols","rows"];class S extends u.Disposable{constructor(_){super(),this._core=this.register(new l.Terminal(_)),this._addonManager=this.register(new h.AddonManager),this._publicOptions={...this._core.options};const w=k=>this._core.options[k],x=(k,A)=>{this._checkReadonlyOptions(k),this._core.options[k]=A};for(const k in this._core.options){const A={get:w.bind(this,k),set:x.bind(this,k)};Object.defineProperty(this._publicOptions,k,A)}}_checkReadonlyOptions(_){if(C.includes(_))throw new Error(`Option "${_}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new m.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new g.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new f.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const _=this._core.coreService.decPrivateModes;let w="none";switch(this._core.coreMouseService.activeProtocol){case"X10":w="x10";break;case"VT200":w="vt200";break;case"DRAG":w="drag";break;case"ANY":w="any"}return{applicationCursorKeysMode:_.applicationCursorKeys,applicationKeypadMode:_.applicationKeypad,bracketedPasteMode:_.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:w,originMode:_.origin,reverseWraparoundMode:_.reverseWraparound,sendFocusMode:_.sendFocus,wraparoundMode:_.wraparound}}get options(){return this._publicOptions}set options(_){for(const w in _)this._publicOptions[w]=_[w]}blur(){this._core.blur()}focus(){this._core.focus()}input(_,w=!0){this._core.input(_,w)}resize(_,w){this._verifyIntegers(_,w),this._core.resize(_,w)}open(_){this._core.open(_)}attachCustomKeyEventHandler(_){this._core.attachCustomKeyEventHandler(_)}attachCustomWheelEventHandler(_){this._core.attachCustomWheelEventHandler(_)}registerLinkProvider(_){return this._core.registerLinkProvider(_)}registerCharacterJoiner(_){return this._checkProposedApi(),this._core.registerCharacterJoiner(_)}deregisterCharacterJoiner(_){this._checkProposedApi(),this._core.deregisterCharacterJoiner(_)}registerMarker(_=0){return this._verifyIntegers(_),this._core.registerMarker(_)}registerDecoration(_){return this._checkProposedApi(),this._verifyPositiveIntegers(_.x??0,_.width??0,_.height??0),this._core.registerDecoration(_)}hasSelection(){return this._core.hasSelection()}select(_,w,x){this._verifyIntegers(_,w,x),this._core.select(_,w,x)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(_,w){this._verifyIntegers(_,w),this._core.selectLines(_,w)}dispose(){super.dispose()}scrollLines(_){this._verifyIntegers(_),this._core.scrollLines(_)}scrollPages(_){this._verifyIntegers(_),this._core.scrollPages(_)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(_){this._verifyIntegers(_),this._core.scrollToLine(_)}clear(){this._core.clear()}write(_,w){this._core.write(_,w)}writeln(_,w){this._core.write(_),this._core.write(`\r
`,w)}paste(_){this._core.paste(_)}refresh(_,w){this._verifyIntegers(_,w),this._core.refresh(_,w)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(_){this._addonManager.loadAddon(this,_)}static get strings(){return o}_verifyIntegers(..._){for(const w of _)if(w===1/0||isNaN(w)||w%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(..._){for(const w of _)if(w&&(w===1/0||isNaN(w)||w%1!=0||w<0))throw new Error("This API only accepts positive integers")}}a.Terminal=S})(),r})()))})(M_)),M_.exports}var Khe=Ghe();var Yhe=2,Qhe=1,Jhe=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let t=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(e.css.cell.width===0||e.css.cell.height===0)return;let t=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,n=window.getComputedStyle(this._terminal.element.parentElement),i=parseInt(n.getPropertyValue("height")),s=Math.max(0,parseInt(n.getPropertyValue("width"))),r=window.getComputedStyle(this._terminal.element),a={top:parseInt(r.getPropertyValue("padding-top")),bottom:parseInt(r.getPropertyValue("padding-bottom")),right:parseInt(r.getPropertyValue("padding-right")),left:parseInt(r.getPropertyValue("padding-left"))},o=a.top+a.bottom,l=a.right+a.left,u=i-o,h=s-l-t;return{cols:Math.max(Yhe,Math.floor(h/e.css.cell.width)),rows:Math.max(Qhe,Math.floor(u/e.css.cell.height))}}};var Xhe=class{constructor(e,t,n,i={}){this._terminal=e,this._regex=t,this._handler=n,this._options=i}provideLinks(e,t){let n=efe.computeLink(e,this._regex,this._terminal,this._handler);t(this._addCallbacks(n))}_addCallbacks(e){return e.map(t=>(t.leave=this._options.leave,t.hover=(n,i)=>{if(this._options.hover){let{range:s}=t;this._options.hover(n,i,s)}},t))}};function Zhe(e){try{let t=new URL(e),n=t.password&&t.username?`${t.protocol}//${t.username}:${t.password}@${t.host}`:t.username?`${t.protocol}//${t.username}@${t.host}`:`${t.protocol}//${t.host}`;return e.toLocaleLowerCase().startsWith(n.toLocaleLowerCase())}catch{return!1}}var efe=class Fp{static computeLink(t,n,i,s){let r=new RegExp(n.source,(n.flags||"")+"g"),[a,o]=Fp._getWindowedLineStrings(t-1,i),l=a.join(""),u,h=[];for(;u=r.exec(l);){let f=u[0];if(!Zhe(f))continue;let[m,g]=Fp._mapStrIdx(i,o,0,u.index),[C,S]=Fp._mapStrIdx(i,m,g,f.length);if(m===-1||g===-1||C===-1||S===-1)continue;let v={start:{x:g+1,y:m+1},end:{x:S,y:C+1}};h.push({range:v,text:f,activate:s})}return h}static _getWindowedLineStrings(t,n){let i,s=t,r=t,a=0,o="",l=[];if(i=n.buffer.active.getLine(t)){let u=i.translateToString(!0);if(i.isWrapped&&u[0]!==" "){for(a=0;(i=n.buffer.active.getLine(--s))&&a<2048&&(o=i.translateToString(!0),a+=o.length,l.push(o),!(!i.isWrapped||o.indexOf(" ")!==-1)););l.reverse()}for(l.push(u),a=0;(i=n.buffer.active.getLine(++r))&&i.isWrapped&&a<2048&&(o=i.translateToString(!0),a+=o.length,l.push(o),o.indexOf(" ")===-1););}return[l,s]}static _mapStrIdx(t,n,i,s){let r=t.buffer.active,a=r.getNullCell(),o=i;for(;s;){let l=r.getLine(n);if(!l)return[-1,-1];for(let u=o;u<l.length;++u){l.getCell(u,a);let h=a.getChars();if(a.getWidth()&&(s-=h.length||1,u===l.length-1&&h==="")){let f=r.getLine(n+1);f&&f.isWrapped&&(f.getCell(0,a),a.getWidth()===2&&(s+=1))}if(s<0)return[n,u]}n++,o=0}return[n,o]}},tfe=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function nfe(e,t){let n=window.open();if(n){try{n.opener=null}catch{}n.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}var ife=class{constructor(e=nfe,t={}){this._handler=e,this._options=t}activate(e){this._terminal=e;let t=this._options,n=t.urlRegex||tfe;this._linkProvider=this._terminal.registerLinkProvider(new Xhe(this._terminal,n,this._handler,t))}dispose(){this._linkProvider?.dispose()}},L_={exports:{}},RL;function sfe(){return RL||(RL=1,(function(e,t){(function(n,i){e.exports=i()})(self,(()=>(()=>{var n={903:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BaseRenderLayer=void 0;const u=l(274),h=l(627),f=l(237),m=l(860),g=l(374),C=l(296),S=l(345),v=l(859),_=l(399),w=l(855);class x extends v.Disposable{get canvas(){return this._canvas}get cacheCanvas(){return this._charAtlas?.pages[0].canvas}constructor(T,M,E,L,D,O,j,U,q,K){super(),this._terminal=T,this._container=M,this._alpha=D,this._themeService=O,this._bufferService=j,this._optionsService=U,this._decorationService=q,this._coreBrowserService=K,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._selectionModel=(0,C.createSelectionRenderModel)(),this._bitmapGenerator=[],this._charAtlasDisposable=this.register(new v.MutableDisposable),this._onAddTextureAtlasCanvas=this.register(new S.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._cellColorResolver=new u.CellColorResolver(this._terminal,this._optionsService,this._selectionModel,this._decorationService,this._coreBrowserService,this._themeService),this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${E}-layer`),this._canvas.style.zIndex=L.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._refreshCharAtlas(this._themeService.colors),this.register(this._themeService.onChangeColors(($=>{this._refreshCharAtlas($),this.reset(),this.handleSelectionChanged(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}))),this.register((0,v.toDisposable)((()=>{this._canvas.remove()})))}_initCanvas(){this._ctx=(0,g.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(){}handleFocus(){}handleCursorMove(){}handleGridChanged(T,M){}handleSelectionChanged(T,M,E=!1){this._selectionModel.update(this._terminal._core,T,M,E)}_setTransparency(T){if(T===this._alpha)return;const M=this._canvas;this._alpha=T,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,M),this._refreshCharAtlas(this._themeService.colors),this.handleGridChanged(0,this._bufferService.rows-1)}_refreshCharAtlas(T){if(!(this._deviceCharWidth<=0&&this._deviceCharHeight<=0)){this._charAtlas=(0,h.acquireTextureAtlas)(this._terminal,this._optionsService.rawOptions,T,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlasDisposable.value=(0,S.forwardEvent)(this._charAtlas.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),this._charAtlas.warmUp();for(let M=0;M<this._charAtlas.pages.length;M++)this._bitmapGenerator[M]=new k(this._charAtlas.pages[M].canvas)}}resize(T){this._deviceCellWidth=T.device.cell.width,this._deviceCellHeight=T.device.cell.height,this._deviceCharWidth=T.device.char.width,this._deviceCharHeight=T.device.char.height,this._deviceCharLeft=T.device.char.left,this._deviceCharTop=T.device.char.top,this._canvas.width=T.device.canvas.width,this._canvas.height=T.device.canvas.height,this._canvas.style.width=`${T.css.canvas.width}px`,this._canvas.style.height=`${T.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(this._themeService.colors)}clearTextureAtlas(){this._charAtlas?.clearTexture()}_fillCells(T,M,E,L){this._ctx.fillRect(T*this._deviceCellWidth,M*this._deviceCellHeight,E*this._deviceCellWidth,L*this._deviceCellHeight)}_fillMiddleLineAtCells(T,M,E=1){const L=Math.ceil(.5*this._deviceCellHeight);this._ctx.fillRect(T*this._deviceCellWidth,(M+1)*this._deviceCellHeight-L-this._coreBrowserService.dpr,E*this._deviceCellWidth,this._coreBrowserService.dpr)}_fillBottomLineAtCells(T,M,E=1,L=0){this._ctx.fillRect(T*this._deviceCellWidth,(M+1)*this._deviceCellHeight+L-this._coreBrowserService.dpr-1,E*this._deviceCellWidth,this._coreBrowserService.dpr)}_curlyUnderlineAtCell(T,M,E=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const L=this._coreBrowserService.dpr;this._ctx.lineWidth=L;for(let D=0;D<E;D++){const O=(T+D)*this._deviceCellWidth,j=(T+D+.5)*this._deviceCellWidth,U=(T+D+1)*this._deviceCellWidth,q=(M+1)*this._deviceCellHeight-L-1,K=q-L,$=q+L;this._ctx.moveTo(O,q),this._ctx.bezierCurveTo(O,K,j,K,j,q),this._ctx.bezierCurveTo(j,$,U,$,U,q)}this._ctx.stroke(),this._ctx.restore()}_dottedUnderlineAtCell(T,M,E=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const L=this._coreBrowserService.dpr;this._ctx.lineWidth=L,this._ctx.setLineDash([2*L,L]);const D=T*this._deviceCellWidth,O=(M+1)*this._deviceCellHeight-L-1;this._ctx.moveTo(D,O);for(let j=0;j<E;j++){const U=(T+E+j)*this._deviceCellWidth;this._ctx.lineTo(U,O)}this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_dashedUnderlineAtCell(T,M,E=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const L=this._coreBrowserService.dpr;this._ctx.lineWidth=L,this._ctx.setLineDash([4*L,3*L]);const D=T*this._deviceCellWidth,O=(T+E)*this._deviceCellWidth,j=(M+1)*this._deviceCellHeight-L-1;this._ctx.moveTo(D,j),this._ctx.lineTo(O,j),this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_fillLeftLineAtCell(T,M,E){this._ctx.fillRect(T*this._deviceCellWidth,M*this._deviceCellHeight,this._coreBrowserService.dpr*E,this._deviceCellHeight)}_strokeRectAtCell(T,M,E,L){const D=this._coreBrowserService.dpr;this._ctx.lineWidth=D,this._ctx.strokeRect(T*this._deviceCellWidth+D/2,M*this._deviceCellHeight+D/2,E*this._deviceCellWidth-D,L*this._deviceCellHeight-D)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(T,M,E,L){this._alpha?this._ctx.clearRect(T*this._deviceCellWidth,M*this._deviceCellHeight,E*this._deviceCellWidth,L*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(T*this._deviceCellWidth,M*this._deviceCellHeight,E*this._deviceCellWidth,L*this._deviceCellHeight))}_fillCharTrueColor(T,M,E){this._ctx.font=this._getFont(!1,!1),this._ctx.textBaseline=f.TEXT_BASELINE,this._clipRow(E);let L=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(L=(0,m.tryDrawCustomChar)(this._ctx,T.getChars(),M*this._deviceCellWidth,E*this._deviceCellHeight,this._deviceCellWidth,this._deviceCellHeight,this._optionsService.rawOptions.fontSize,this._coreBrowserService.dpr)),L||this._ctx.fillText(T.getChars(),M*this._deviceCellWidth+this._deviceCharLeft,E*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_drawChars(T,M,E){const L=T.getChars(),D=T.getCode(),O=T.getWidth();if(this._cellColorResolver.resolve(T,M,this._bufferService.buffer.ydisp+E,this._deviceCellWidth),!this._charAtlas)return;let j;if(j=L&&L.length>1?this._charAtlas.getRasterizedGlyphCombinedChar(L,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0):this._charAtlas.getRasterizedGlyph(T.getCode()||w.WHITESPACE_CELL_CODE,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0),!j.size.x||!j.size.y)return;this._ctx.save(),this._clipRow(E),this._bitmapGenerator[j.texturePage]&&this._charAtlas.pages[j.texturePage].canvas!==this._bitmapGenerator[j.texturePage].canvas&&(this._bitmapGenerator[j.texturePage]?.bitmap?.close(),delete this._bitmapGenerator[j.texturePage]),this._charAtlas.pages[j.texturePage].version!==this._bitmapGenerator[j.texturePage]?.version&&(this._bitmapGenerator[j.texturePage]||(this._bitmapGenerator[j.texturePage]=new k(this._charAtlas.pages[j.texturePage].canvas)),this._bitmapGenerator[j.texturePage].refresh(),this._bitmapGenerator[j.texturePage].version=this._charAtlas.pages[j.texturePage].version);let U=j.size.x;this._optionsService.rawOptions.rescaleOverlappingGlyphs&&(0,g.allowRescaling)(D,O,j.size.x,this._deviceCellWidth)&&(U=this._deviceCellWidth-1),this._ctx.drawImage(this._bitmapGenerator[j.texturePage]?.bitmap||this._charAtlas.pages[j.texturePage].canvas,j.texturePosition.x,j.texturePosition.y,j.size.x,j.size.y,M*this._deviceCellWidth+this._deviceCharLeft-j.offset.x,E*this._deviceCellHeight+this._deviceCharTop-j.offset.y,U,j.size.y),this._ctx.restore()}_clipRow(T){this._ctx.beginPath(),this._ctx.rect(0,T*this._deviceCellHeight,this._bufferService.cols*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(T,M){return`${M?"italic":""} ${T?this._optionsService.rawOptions.fontWeightBold:this._optionsService.rawOptions.fontWeight} ${this._optionsService.rawOptions.fontSize*this._coreBrowserService.dpr}px ${this._optionsService.rawOptions.fontFamily}`}}o.BaseRenderLayer=x;class k{get bitmap(){return this._bitmap}constructor(T){this.canvas=T,this._state=0,this._commitTimeout=void 0,this._bitmap=void 0,this.version=-1}refresh(){this._bitmap?.close(),this._bitmap=void 0,_.isSafari||(this._commitTimeout===void 0&&(this._commitTimeout=window.setTimeout((()=>this._generate()),100)),this._state===1&&(this._state=2))}_generate(){this._state===0&&(this._bitmap?.close(),this._bitmap=void 0,this._state=1,window.createImageBitmap(this.canvas).then((T=>{this._state===2?this.refresh():this._bitmap=T,this._state=0})),this._commitTimeout&&(this._commitTimeout=void 0))}}},949:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CanvasRenderer=void 0;const u=l(627),h=l(56),f=l(374),m=l(345),g=l(859),C=l(873),S=l(43),v=l(630),_=l(744);class w extends g.Disposable{constructor(k,A,T,M,E,L,D,O,j,U,q){super(),this._terminal=k,this._screenElement=A,this._bufferService=M,this._charSizeService=E,this._optionsService=L,this._coreBrowserService=j,this._themeService=q,this._observerDisposable=this.register(new g.MutableDisposable),this._onRequestRedraw=this.register(new m.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onChangeTextureAtlas=this.register(new m.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new m.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event;const K=this._optionsService.rawOptions.allowTransparency;this._renderLayers=[new _.TextRenderLayer(this._terminal,this._screenElement,0,K,this._bufferService,this._optionsService,D,U,this._coreBrowserService,q),new v.SelectionRenderLayer(this._terminal,this._screenElement,1,this._bufferService,this._coreBrowserService,U,this._optionsService,q),new S.LinkRenderLayer(this._terminal,this._screenElement,2,T,this._bufferService,this._optionsService,U,this._coreBrowserService,q),new C.CursorRenderLayer(this._terminal,this._screenElement,3,this._onRequestRedraw,this._bufferService,this._optionsService,O,this._coreBrowserService,U,q)];for(const $ of this._renderLayers)(0,m.forwardEvent)($.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas);this.dimensions=(0,f.createRenderDimensions)(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._observerDisposable.value=(0,h.observeDevicePixelDimensions)(this._renderLayers[0].canvas,this._coreBrowserService.window,(($,Y)=>this._setCanvasDevicePixelDimensions($,Y))),this.register(this._coreBrowserService.onWindowChange(($=>{this._observerDisposable.value=(0,h.observeDevicePixelDimensions)(this._renderLayers[0].canvas,$,((Y,Q)=>this._setCanvasDevicePixelDimensions(Y,Q)))}))),this.register((0,g.toDisposable)((()=>{for(const $ of this._renderLayers)$.dispose();(0,u.removeTerminalFromCache)(this._terminal)})))}get textureAtlas(){return this._renderLayers[0].cacheCanvas}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._bufferService.cols,this._bufferService.rows))}handleResize(k,A){this._updateDimensions();for(const T of this._renderLayers)T.resize(this.dimensions);this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}handleCharSizeChanged(){this.handleResize(this._bufferService.cols,this._bufferService.rows)}handleBlur(){this._runOperation((k=>k.handleBlur()))}handleFocus(){this._runOperation((k=>k.handleFocus()))}handleSelectionChanged(k,A,T=!1){this._runOperation((M=>M.handleSelectionChanged(k,A,T))),this._themeService.colors.selectionForeground&&this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}handleCursorMove(){this._runOperation((k=>k.handleCursorMove()))}clear(){this._runOperation((k=>k.reset()))}_runOperation(k){for(const A of this._renderLayers)k(A)}renderRows(k,A){for(const T of this._renderLayers)T.handleGridChanged(k,A)}clearTextureAtlas(){for(const k of this._renderLayers)k.clearTextureAtlas()}_updateDimensions(){if(!this._charSizeService.hasValidSize)return;const k=this._coreBrowserService.dpr;this.dimensions.device.char.width=Math.floor(this._charSizeService.width*k),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*k),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._bufferService.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._bufferService.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/k),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/k),this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows,this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols}_setCanvasDevicePixelDimensions(k,A){this.dimensions.device.canvas.height=A,this.dimensions.device.canvas.width=k;for(const T of this._renderLayers)T.resize(this.dimensions);this._requestRedrawViewport()}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}}o.CanvasRenderer=w},873:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CursorRenderLayer=void 0;const u=l(457),h=l(859),f=l(399),m=l(782),g=l(903);class C extends g.BaseRenderLayer{constructor(v,_,w,x,k,A,T,M,E,L){super(v,_,"cursor",w,!0,L,k,A,E,M),this._onRequestRedraw=x,this._coreService=T,this._cursorBlinkStateManager=this.register(new h.MutableDisposable),this._cell=new m.CellData,this._state={x:0,y:0,isFocused:!1,style:"",width:0},this._cursorRenderers={bar:this._renderBarCursor.bind(this),block:this._renderBlockCursor.bind(this),underline:this._renderUnderlineCursor.bind(this),outline:this._renderOutlineCursor.bind(this)},this.register(A.onOptionChange((()=>this._handleOptionsChanged()))),this._handleOptionsChanged()}resize(v){super.resize(v),this._state={x:0,y:0,isFocused:!1,style:"",width:0}}reset(){this._clearCursor(),this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._handleOptionsChanged()}handleBlur(){this._cursorBlinkStateManager.value?.pause(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleFocus(){this._cursorBlinkStateManager.value?.resume(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}_handleOptionsChanged(){this._optionsService.rawOptions.cursorBlink?this._cursorBlinkStateManager.value||(this._cursorBlinkStateManager.value=new u.CursorBlinkStateManager((()=>this._render(!0)),this._coreBrowserService)):this._cursorBlinkStateManager.clear(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleCursorMove(){this._cursorBlinkStateManager.value?.restartBlinkAnimation()}handleGridChanged(v,_){!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isPaused?this._render(!1):this._cursorBlinkStateManager.value.restartBlinkAnimation()}_render(v){if(!this._coreService.isCursorInitialized||this._coreService.isCursorHidden)return void this._clearCursor();const _=this._bufferService.buffer.ybase+this._bufferService.buffer.y,w=_-this._bufferService.buffer.ydisp;if(w<0||w>=this._bufferService.rows)return void this._clearCursor();const x=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1);if(this._bufferService.buffer.lines.get(_).loadCell(x,this._cell),this._cell.content!==void 0){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css;const k=this._optionsService.rawOptions.cursorStyle,A=this._optionsService.rawOptions.cursorInactiveStyle;return A&&A!=="none"&&this._cursorRenderers[A](x,w,this._cell),this._ctx.restore(),this._state.x=x,this._state.y=w,this._state.isFocused=!1,this._state.style=k,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible){if(this._state){if(this._state.x===x&&this._state.y===w&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===this._optionsService.rawOptions.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[this._optionsService.rawOptions.cursorStyle||"block"](x,w,this._cell),this._ctx.restore(),this._state.x=x,this._state.y=w,this._state.isFocused=!1,this._state.style=this._optionsService.rawOptions.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}_clearCursor(){this._state&&(f.isFirefox||this._coreBrowserService.dpr<1?this._clearAll():this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})}_renderBarCursor(v,_,w){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillLeftLineAtCell(v,_,this._optionsService.rawOptions.cursorWidth),this._ctx.restore()}_renderBlockCursor(v,_,w){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillCells(v,_,w.getWidth(),1),this._ctx.fillStyle=this._themeService.colors.cursorAccent.css,this._fillCharTrueColor(w,v,_),this._ctx.restore()}_renderUnderlineCursor(v,_,w){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillBottomLineAtCells(v,_),this._ctx.restore()}_renderOutlineCursor(v,_,w){this._ctx.save(),this._ctx.strokeStyle=this._themeService.colors.cursor.css,this._strokeRectAtCell(v,_,w.getWidth(),1),this._ctx.restore()}}o.CursorRenderLayer=C},574:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.GridCache=void 0,o.GridCache=class{constructor(){this.cache=[]}resize(l,u){for(let h=0;h<l;h++){this.cache.length<=h&&this.cache.push([]);for(let f=this.cache[h].length;f<u;f++)this.cache[h].push(void 0);this.cache[h].length=u}this.cache.length=l}clear(){for(let l=0;l<this.cache.length;l++)for(let u=0;u<this.cache[l].length;u++)this.cache[l][u]=void 0}}},43:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LinkRenderLayer=void 0;const u=l(197),h=l(237),f=l(903);class m extends f.BaseRenderLayer{constructor(C,S,v,_,w,x,k,A,T){super(C,S,"link",v,!0,T,w,x,k,A),this.register(_.onShowLinkUnderline((M=>this._handleShowLinkUnderline(M)))),this.register(_.onHideLinkUnderline((M=>this._handleHideLinkUnderline(M))))}resize(C){super.resize(C),this._state=void 0}reset(){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);const C=this._state.y2-this._state.y1-1;C>0&&this._clearCells(0,this._state.y1+1,this._state.cols,C),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(C){if(C.fg===h.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:C.fg&&(0,u.is256Color)(C.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[C.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,C.y1===C.y2)this._fillBottomLineAtCells(C.x1,C.y1,C.x2-C.x1);else{this._fillBottomLineAtCells(C.x1,C.y1,C.cols-C.x1);for(let S=C.y1+1;S<C.y2;S++)this._fillBottomLineAtCells(0,S,C.cols);this._fillBottomLineAtCells(0,C.y2,C.x2)}this._state=C}_handleHideLinkUnderline(C){this._clearCurrentLink()}}o.LinkRenderLayer=m},630:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionRenderLayer=void 0;const u=l(903);class h extends u.BaseRenderLayer{constructor(m,g,C,S,v,_,w,x){super(m,g,"selection",C,!0,x,S,w,_,v),this._clearState()}_clearState(){this._state={start:void 0,end:void 0,columnSelectMode:void 0,ydisp:void 0}}resize(m){super.resize(m),this._selectionModel.selectionStart&&this._selectionModel.selectionEnd&&(this._clearState(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode))}reset(){this._state.start&&this._state.end&&(this._clearState(),this._clearAll())}handleBlur(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleFocus(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleSelectionChanged(m,g,C){super.handleSelectionChanged(m,g,C),this._redrawSelection(m,g,C)}_redrawSelection(m,g,C){if(!this._didStateChange(m,g,C,this._bufferService.buffer.ydisp))return;if(this._clearAll(),!m||!g)return void this._clearState();const S=m[1]-this._bufferService.buffer.ydisp,v=g[1]-this._bufferService.buffer.ydisp,_=Math.max(S,0),w=Math.min(v,this._bufferService.rows-1);if(_>=this._bufferService.rows||w<0)this._state.ydisp=this._bufferService.buffer.ydisp;else{if(this._ctx.fillStyle=(this._coreBrowserService.isFocused?this._themeService.colors.selectionBackgroundTransparent:this._themeService.colors.selectionInactiveBackgroundTransparent).css,C){const x=m[0],k=g[0]-x,A=w-_+1;this._fillCells(x,_,k,A)}else{const x=S===_?m[0]:0,k=_===v?g[0]:this._bufferService.cols;this._fillCells(x,_,k-x,1);const A=Math.max(w-_-1,0);if(this._fillCells(0,_+1,this._bufferService.cols,A),_!==w){const T=v===w?g[0]:this._bufferService.cols;this._fillCells(0,w,T,1)}}this._state.start=[m[0],m[1]],this._state.end=[g[0],g[1]],this._state.columnSelectMode=C,this._state.ydisp=this._bufferService.buffer.ydisp}}_didStateChange(m,g,C,S){return!this._areCoordinatesEqual(m,this._state.start)||!this._areCoordinatesEqual(g,this._state.end)||C!==this._state.columnSelectMode||S!==this._state.ydisp}_areCoordinatesEqual(m,g){return!(!m||!g)&&m[0]===g[0]&&m[1]===g[1]}}o.SelectionRenderLayer=h},744:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TextRenderLayer=void 0;const u=l(577),h=l(147),f=l(782),m=l(855),g=l(903),C=l(574);class S extends g.BaseRenderLayer{constructor(_,w,x,k,A,T,M,E,L,D){super(_,w,"text",x,k,D,A,T,E,L),this._characterJoinerService=M,this._characterWidth=0,this._characterFont="",this._characterOverlapCache={},this._workCell=new f.CellData,this._state=new C.GridCache,this.register(T.onSpecificOptionChange("allowTransparency",(O=>this._setTransparency(O))))}resize(_){super.resize(_);const w=this._getFont(!1,!1);this._characterWidth===_.device.char.width&&this._characterFont===w||(this._characterWidth=_.device.char.width,this._characterFont=w,this._characterOverlapCache={}),this._state.clear(),this._state.resize(this._bufferService.cols,this._bufferService.rows)}reset(){this._state.clear(),this._clearAll()}_forEachCell(_,w,x){for(let k=_;k<=w;k++){const A=k+this._bufferService.buffer.ydisp,T=this._bufferService.buffer.lines.get(A),M=this._characterJoinerService.getJoinedCharacters(A);for(let E=0;E<this._bufferService.cols;E++){T.loadCell(E,this._workCell);let L=this._workCell,D=!1,O=E;if(L.getWidth()!==0){if(M.length>0&&E===M[0][0]){D=!0;const j=M.shift();L=new u.JoinedCellData(this._workCell,T.translateToString(!0,j[0],j[1]),j[1]-j[0]),O=j[1]-1}!D&&this._isOverlapping(L)&&O<T.length-1&&T.getCodePoint(O+1)===m.NULL_CELL_CODE&&(L.content&=-12582913,L.content|=8388608),x(L,E,k),E=O}}}}_drawBackground(_,w){const x=this._ctx,k=this._bufferService.cols;let A=0,T=0,M=null;x.save(),this._forEachCell(_,w,((E,L,D)=>{let O=null;E.isInverse()?O=E.isFgDefault()?this._themeService.colors.foreground.css:E.isFgRGB()?`rgb(${h.AttributeData.toColorRGB(E.getFgColor()).join(",")})`:this._themeService.colors.ansi[E.getFgColor()].css:E.isBgRGB()?O=`rgb(${h.AttributeData.toColorRGB(E.getBgColor()).join(",")})`:E.isBgPalette()&&(O=this._themeService.colors.ansi[E.getBgColor()].css);let j=!1;this._decorationService.forEachDecorationAtCell(L,this._bufferService.buffer.ydisp+D,void 0,(U=>{U.options.layer!=="top"&&j||(U.backgroundColorRGB&&(O=U.backgroundColorRGB.css),j=U.options.layer==="top")})),M===null&&(A=L,T=D),D!==T?(x.fillStyle=M||"",this._fillCells(A,T,k-A,1),A=L,T=D):M!==O&&(x.fillStyle=M||"",this._fillCells(A,T,L-A,1),A=L,T=D),M=O})),M!==null&&(x.fillStyle=M,this._fillCells(A,T,k-A,1)),x.restore()}_drawForeground(_,w){this._forEachCell(_,w,((x,k,A)=>this._drawChars(x,k,A)))}handleGridChanged(_,w){this._state.cache.length!==0&&(this._charAtlas&&this._charAtlas.beginFrame(),this._clearCells(0,_,this._bufferService.cols,w-_+1),this._drawBackground(_,w),this._drawForeground(_,w))}_isOverlapping(_){if(_.getWidth()!==1||_.getCode()<256)return!1;const w=_.getChars();if(this._characterOverlapCache.hasOwnProperty(w))return this._characterOverlapCache[w];this._ctx.save(),this._ctx.font=this._characterFont;const x=Math.floor(this._ctx.measureText(w).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[w]=x,x}}o.TextRenderLayer=S},274:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CellColorResolver=void 0;const u=l(855),h=l(160),f=l(374);let m,g=0,C=0,S=!1,v=!1,_=!1,w=0;o.CellColorResolver=class{constructor(x,k,A,T,M,E){this._terminal=x,this._optionService=k,this._selectionRenderModel=A,this._decorationService=T,this._coreBrowserService=M,this._themeService=E,this.result={fg:0,bg:0,ext:0}}resolve(x,k,A,T){if(this.result.bg=x.bg,this.result.fg=x.fg,this.result.ext=268435456&x.bg?x.extended.ext:0,C=0,g=0,v=!1,S=!1,_=!1,m=this._themeService.colors,w=0,x.getCode()!==u.NULL_CELL_CODE&&x.extended.underlineStyle===4){const M=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));w=k*T%(2*Math.round(M))}if(this._decorationService.forEachDecorationAtCell(k,A,"bottom",(M=>{M.backgroundColorRGB&&(C=M.backgroundColorRGB.rgba>>8&16777215,v=!0),M.foregroundColorRGB&&(g=M.foregroundColorRGB.rgba>>8&16777215,S=!0)})),_=this._selectionRenderModel.isCellSelected(this._terminal,k,A),_){if(67108864&this.result.fg||(50331648&this.result.bg)!=0){if(67108864&this.result.fg)switch(50331648&this.result.fg){case 16777216:case 33554432:C=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:C=(16777215&this.result.fg)<<8|255;break;default:C=this._themeService.colors.foreground.rgba}else switch(50331648&this.result.bg){case 16777216:case 33554432:C=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:C=(16777215&this.result.bg)<<8|255}C=h.rgba.blend(C,4294967040&(this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}else C=(this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(v=!0,m.selectionForeground&&(g=m.selectionForeground.rgba>>8&16777215,S=!0),(0,f.treatGlyphAsBackgroundColor)(x.getCode())){if(67108864&this.result.fg&&(50331648&this.result.bg)==0)g=(this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(67108864&this.result.fg)switch(50331648&this.result.bg){case 16777216:case 33554432:g=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:g=(16777215&this.result.bg)<<8|255}else switch(50331648&this.result.fg){case 16777216:case 33554432:g=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:g=(16777215&this.result.fg)<<8|255;break;default:g=this._themeService.colors.foreground.rgba}g=h.rgba.blend(g,4294967040&(this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}S=!0}}this._decorationService.forEachDecorationAtCell(k,A,"top",(M=>{M.backgroundColorRGB&&(C=M.backgroundColorRGB.rgba>>8&16777215,v=!0),M.foregroundColorRGB&&(g=M.foregroundColorRGB.rgba>>8&16777215,S=!0)})),v&&(C=_?-16777216&x.bg&-134217729|C|50331648:-16777216&x.bg|C|50331648),S&&(g=-16777216&x.fg&-67108865|g|50331648),67108864&this.result.fg&&(v&&!S&&(g=(50331648&this.result.bg)==0?-134217728&this.result.fg|16777215&m.background.rgba>>8|50331648:-134217728&this.result.fg|67108863&this.result.bg,S=!0),!v&&S&&(C=(50331648&this.result.fg)==0?-67108864&this.result.bg|16777215&m.foreground.rgba>>8|50331648:-67108864&this.result.bg|67108863&this.result.fg,v=!0)),m=void 0,this.result.bg=v?C:this.result.bg,this.result.fg=S?g:this.result.fg,this.result.ext&=536870911,this.result.ext|=w<<29&3758096384}}},627:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.removeTerminalFromCache=o.acquireTextureAtlas=void 0;const u=l(509),h=l(197),f=[];o.acquireTextureAtlas=function(m,g,C,S,v,_,w,x){const k=(0,h.generateConfig)(S,v,_,w,g,C,x);for(let M=0;M<f.length;M++){const E=f[M],L=E.ownedBy.indexOf(m);if(L>=0){if((0,h.configEquals)(E.config,k))return E.atlas;E.ownedBy.length===1?(E.atlas.dispose(),f.splice(M,1)):E.ownedBy.splice(L,1);break}}for(let M=0;M<f.length;M++){const E=f[M];if((0,h.configEquals)(E.config,k))return E.ownedBy.push(m),E.atlas}const A=m._core,T={atlas:new u.TextureAtlas(document,k,A.unicodeService),config:k,ownedBy:[m]};return f.push(T),T.atlas},o.removeTerminalFromCache=function(m){for(let g=0;g<f.length;g++){const C=f[g].ownedBy.indexOf(m);if(C!==-1){f[g].ownedBy.length===1?(f[g].atlas.dispose(),f.splice(g,1)):f[g].ownedBy.splice(C,1);break}}}},197:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.is256Color=o.configEquals=o.generateConfig=void 0;const u=l(160);o.generateConfig=function(h,f,m,g,C,S,v){const _={foreground:S.foreground,background:S.background,cursor:u.NULL_COLOR,cursorAccent:u.NULL_COLOR,selectionForeground:u.NULL_COLOR,selectionBackgroundTransparent:u.NULL_COLOR,selectionBackgroundOpaque:u.NULL_COLOR,selectionInactiveBackgroundTransparent:u.NULL_COLOR,selectionInactiveBackgroundOpaque:u.NULL_COLOR,ansi:S.ansi.slice(),contrastCache:S.contrastCache,halfContrastCache:S.halfContrastCache};return{customGlyphs:C.customGlyphs,devicePixelRatio:v,letterSpacing:C.letterSpacing,lineHeight:C.lineHeight,deviceCellWidth:h,deviceCellHeight:f,deviceCharWidth:m,deviceCharHeight:g,fontFamily:C.fontFamily,fontSize:C.fontSize,fontWeight:C.fontWeight,fontWeightBold:C.fontWeightBold,allowTransparency:C.allowTransparency,drawBoldTextInBrightColors:C.drawBoldTextInBrightColors,minimumContrastRatio:C.minimumContrastRatio,colors:_}},o.configEquals=function(h,f){for(let m=0;m<h.colors.ansi.length;m++)if(h.colors.ansi[m].rgba!==f.colors.ansi[m].rgba)return!1;return h.devicePixelRatio===f.devicePixelRatio&&h.customGlyphs===f.customGlyphs&&h.lineHeight===f.lineHeight&&h.letterSpacing===f.letterSpacing&&h.fontFamily===f.fontFamily&&h.fontSize===f.fontSize&&h.fontWeight===f.fontWeight&&h.fontWeightBold===f.fontWeightBold&&h.allowTransparency===f.allowTransparency&&h.deviceCharWidth===f.deviceCharWidth&&h.deviceCharHeight===f.deviceCharHeight&&h.drawBoldTextInBrightColors===f.drawBoldTextInBrightColors&&h.minimumContrastRatio===f.minimumContrastRatio&&h.colors.foreground.rgba===f.colors.foreground.rgba&&h.colors.background.rgba===f.colors.background.rgba},o.is256Color=function(h){return(50331648&h)==16777216||(50331648&h)==33554432}},237:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TEXT_BASELINE=o.DIM_OPACITY=o.INVERTED_DEFAULT_COLOR=void 0;const u=l(399);o.INVERTED_DEFAULT_COLOR=257,o.DIM_OPACITY=.5,o.TEXT_BASELINE=u.isFirefox||u.isLegacyEdge?"bottom":"ideographic"},457:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CursorBlinkStateManager=void 0,o.CursorBlinkStateManager=class{constructor(l,u){this._renderCallback=l,this._coreBrowserService=u,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0}))))}_restartInterval(l=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout((()=>{if(this._animationTimeRestarted){const u=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,u>0)return void this._restartInterval(u)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0})),this._blinkInterval=this._coreBrowserService.window.setInterval((()=>{if(this._animationTimeRestarted){const u=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(u)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0}))}),600)}),l)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.tryDrawCustomChar=o.powerlineDefinitions=o.boxDrawingDefinitions=o.blockElementDefinitions=void 0;const u=l(374);o.blockElementDefinitions={"":[{x:0,y:0,w:8,h:4}],"":[{x:0,y:7,w:8,h:1}],"":[{x:0,y:6,w:8,h:2}],"":[{x:0,y:5,w:8,h:3}],"":[{x:0,y:4,w:8,h:4}],"":[{x:0,y:3,w:8,h:5}],"":[{x:0,y:2,w:8,h:6}],"":[{x:0,y:1,w:8,h:7}],"":[{x:0,y:0,w:8,h:8}],"":[{x:0,y:0,w:7,h:8}],"":[{x:0,y:0,w:6,h:8}],"":[{x:0,y:0,w:5,h:8}],"":[{x:0,y:0,w:4,h:8}],"":[{x:0,y:0,w:3,h:8}],"":[{x:0,y:0,w:2,h:8}],"":[{x:0,y:0,w:1,h:8}],"":[{x:4,y:0,w:4,h:8}],"":[{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8}],"":[{x:0,y:4,w:4,h:4}],"":[{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"":[{x:4,y:0,w:4,h:4}],"":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:1,y:0,w:1,h:8}],"":[{x:2,y:0,w:1,h:8}],"":[{x:3,y:0,w:1,h:8}],"":[{x:4,y:0,w:1,h:8}],"":[{x:5,y:0,w:1,h:8}],"":[{x:6,y:0,w:1,h:8}],"":[{x:0,y:1,w:8,h:1}],"":[{x:0,y:2,w:8,h:1}],"":[{x:0,y:3,w:8,h:1}],"":[{x:0,y:4,w:8,h:1}],"":[{x:0,y:5,w:8,h:1}],"":[{x:0,y:6,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:2}],"":[{x:0,y:0,w:8,h:3}],"":[{x:0,y:0,w:8,h:5}],"":[{x:0,y:0,w:8,h:6}],"":[{x:0,y:0,w:8,h:7}],"":[{x:6,y:0,w:2,h:8}],"":[{x:5,y:0,w:3,h:8}],"":[{x:3,y:0,w:5,h:8}],"":[{x:2,y:0,w:6,h:8}],"":[{x:1,y:0,w:7,h:8}],"":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};const h={"":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"":[[1,0],[0,0],[0,1],[0,0]],"":[[0,1],[1,1],[1,0],[1,1]]};o.boxDrawingDefinitions={"":{1:"M0,.5 L1,.5"},"":{3:"M0,.5 L1,.5"},"":{1:"M.5,0 L.5,1"},"":{3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5"},"":{3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M0,.5 L.5,.5 L.5,1"},"":{3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L1,.5"},"":{3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L0,.5"},"":{3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{1:"M.5,.5 L0,.5"},"":{3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0"},"":{3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5"},"":{3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1"},"":{3:"M.5,.5 L.5,1"},"":{1:(S,v)=>`M0,${.5-v} L1,${.5-v} M0,${.5+v} L1,${.5+v}`},"":{1:(S,v)=>`M${.5-S},0 L${.5-S},1 M${.5+S},0 L${.5+S},1`},"":{1:(S,v)=>`M.5,1 L.5,${.5-v} L1,${.5-v} M.5,${.5+v} L1,${.5+v}`},"":{1:(S,v)=>`M${.5-S},1 L${.5-S},.5 L1,.5 M${.5+S},.5 L${.5+S},1`},"":{1:(S,v)=>`M1,${.5-v} L${.5-S},${.5-v} L${.5-S},1 M1,${.5+v} L${.5+S},${.5+v} L${.5+S},1`},"":{1:(S,v)=>`M0,${.5-v} L.5,${.5-v} L.5,1 M0,${.5+v} L.5,${.5+v}`},"":{1:(S,v)=>`M${.5+S},1 L${.5+S},.5 L0,.5 M${.5-S},.5 L${.5-S},1`},"":{1:(S,v)=>`M0,${.5+v} L${.5-S},${.5+v} L${.5-S},1 M0,${.5-v} L${.5+S},${.5-v} L${.5+S},1`},"":{1:(S,v)=>`M.5,0 L.5,${.5+v} L1,${.5+v} M.5,${.5-v} L1,${.5-v}`},"":{1:(S,v)=>`M1,.5 L${.5-S},.5 L${.5-S},0 M${.5+S},.5 L${.5+S},0`},"":{1:(S,v)=>`M1,${.5-v} L${.5+S},${.5-v} L${.5+S},0 M1,${.5+v} L${.5-S},${.5+v} L${.5-S},0`},"":{1:(S,v)=>`M0,${.5+v} L.5,${.5+v} L.5,0 M0,${.5-v} L.5,${.5-v}`},"":{1:(S,v)=>`M0,.5 L${.5+S},.5 L${.5+S},0 M${.5-S},.5 L${.5-S},0`},"":{1:(S,v)=>`M0,${.5-v} L${.5-S},${.5-v} L${.5-S},0 M0,${.5+v} L${.5+S},${.5+v} L${.5+S},0`},"":{1:(S,v)=>`M.5,0 L.5,1 M.5,${.5-v} L1,${.5-v} M.5,${.5+v} L1,${.5+v}`},"":{1:(S,v)=>`M${.5-S},0 L${.5-S},1 M${.5+S},0 L${.5+S},1 M${.5+S},.5 L1,.5`},"":{1:(S,v)=>`M${.5-S},0 L${.5-S},1 M1,${.5+v} L${.5+S},${.5+v} L${.5+S},1 M1,${.5-v} L${.5+S},${.5-v} L${.5+S},0`},"":{1:(S,v)=>`M.5,0 L.5,1 M0,${.5-v} L.5,${.5-v} M0,${.5+v} L.5,${.5+v}`},"":{1:(S,v)=>`M0,.5 L${.5-S},.5 M${.5-S},0 L${.5-S},1 M${.5+S},0 L${.5+S},1`},"":{1:(S,v)=>`M${.5+S},0 L${.5+S},1 M0,${.5+v} L${.5-S},${.5+v} L${.5-S},1 M0,${.5-v} L${.5-S},${.5-v} L${.5-S},0`},"":{1:(S,v)=>`M0,${.5-v} L1,${.5-v} M0,${.5+v} L1,${.5+v} M.5,${.5+v} L.5,1`},"":{1:(S,v)=>`M0,.5 L1,.5 M${.5-S},.5 L${.5-S},1 M${.5+S},.5 L${.5+S},1`},"":{1:(S,v)=>`M0,${.5-v} L1,${.5-v} M0,${.5+v} L${.5-S},${.5+v} L${.5-S},1 M1,${.5+v} L${.5+S},${.5+v} L${.5+S},1`},"":{1:(S,v)=>`M.5,0 L.5,${.5-v} M0,${.5-v} L1,${.5-v} M0,${.5+v} L1,${.5+v}`},"":{1:(S,v)=>`M0,.5 L1,.5 M${.5-S},.5 L${.5-S},0 M${.5+S},.5 L${.5+S},0`},"":{1:(S,v)=>`M0,${.5+v} L1,${.5+v} M0,${.5-v} L${.5-S},${.5-v} L${.5-S},0 M1,${.5-v} L${.5+S},${.5-v} L${.5+S},0`},"":{1:(S,v)=>`M.5,0 L.5,1 M0,${.5-v} L1,${.5-v} M0,${.5+v} L1,${.5+v}`},"":{1:(S,v)=>`M0,.5 L1,.5 M${.5-S},0 L${.5-S},1 M${.5+S},0 L${.5+S},1`},"":{1:(S,v)=>`M0,${.5+v} L${.5-S},${.5+v} L${.5-S},1 M1,${.5+v} L${.5+S},${.5+v} L${.5+S},1 M0,${.5-v} L${.5-S},${.5-v} L${.5-S},0 M1,${.5-v} L${.5+S},${.5-v} L${.5+S},0`},"":{1:"M1,0 L0,1"},"":{1:"M0,0 L1,1"},"":{1:"M1,0 L0,1 M0,0 L1,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{1:(S,v)=>`M.5,1 L.5,${.5+v/.15*.5} C.5,${.5+v/.15*.5},.5,.5,1,.5`},"":{1:(S,v)=>`M.5,1 L.5,${.5+v/.15*.5} C.5,${.5+v/.15*.5},.5,.5,0,.5`},"":{1:(S,v)=>`M.5,0 L.5,${.5-v/.15*.5} C.5,${.5-v/.15*.5},.5,.5,0,.5`},"":{1:(S,v)=>`M.5,0 L.5,${.5-v/.15*.5} C.5,${.5-v/.15*.5},.5,.5,1,.5`}},o.powerlineDefinitions={"":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},o.powerlineDefinitions[""]=o.powerlineDefinitions[""],o.powerlineDefinitions[""]=o.powerlineDefinitions[""],o.tryDrawCustomChar=function(S,v,_,w,x,k,A,T){const M=o.blockElementDefinitions[v];if(M)return(function(O,j,U,q,K,$){for(let Y=0;Y<j.length;Y++){const Q=j[Y],F=K/8,N=$/8;O.fillRect(U+Q.x*F,q+Q.y*N,Q.w*F,Q.h*N)}})(S,M,_,w,x,k),!0;const E=h[v];if(E)return(function(O,j,U,q,K,$){let Y=f.get(j);Y||(Y=new Map,f.set(j,Y));const Q=O.fillStyle;if(typeof Q!="string")throw new Error(`Unexpected fillStyle type "${Q}"`);let F=Y.get(Q);if(!F){const N=j[0].length,z=j.length,G=O.canvas.ownerDocument.createElement("canvas");G.width=N,G.height=z;const H=(0,u.throwIfFalsy)(G.getContext("2d")),ee=new ImageData(N,z);let ue,ce,J,V;if(Q.startsWith("#"))ue=parseInt(Q.slice(1,3),16),ce=parseInt(Q.slice(3,5),16),J=parseInt(Q.slice(5,7),16),V=Q.length>7&&parseInt(Q.slice(7,9),16)||1;else{if(!Q.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${Q}" when drawing pattern glyph`);[ue,ce,J,V]=Q.substring(5,Q.length-1).split(",").map((ne=>parseFloat(ne)))}for(let ne=0;ne<z;ne++)for(let he=0;he<N;he++)ee.data[4*(ne*N+he)]=ue,ee.data[4*(ne*N+he)+1]=ce,ee.data[4*(ne*N+he)+2]=J,ee.data[4*(ne*N+he)+3]=j[ne][he]*(255*V);H.putImageData(ee,0,0),F=(0,u.throwIfFalsy)(O.createPattern(G,null)),Y.set(Q,F)}O.fillStyle=F,O.fillRect(U,q,K,$)})(S,E,_,w,x,k),!0;const L=o.boxDrawingDefinitions[v];if(L)return(function(O,j,U,q,K,$,Y){O.strokeStyle=O.fillStyle;for(const[Q,F]of Object.entries(j)){let N;O.beginPath(),O.lineWidth=Y*Number.parseInt(Q),N=typeof F=="function"?F(.15,.15/$*K):F;for(const z of N.split(" ")){const G=z[0],H=g[G];if(!H){console.error(`Could not find drawing instructions for "${G}"`);continue}const ee=z.substring(1).split(",");ee[0]&&ee[1]&&H(O,C(ee,K,$,U,q,!0,Y))}O.stroke(),O.closePath()}})(S,L,_,w,x,k,T),!0;const D=o.powerlineDefinitions[v];return!!D&&((function(O,j,U,q,K,$,Y,Q){const F=new Path2D;F.rect(U,q,K,$),O.clip(F),O.beginPath();const N=Y/12;O.lineWidth=Q*N;for(const z of j.d.split(" ")){const G=z[0],H=g[G];if(!H){console.error(`Could not find drawing instructions for "${G}"`);continue}const ee=z.substring(1).split(",");ee[0]&&ee[1]&&H(O,C(ee,K,$,U,q,!1,Q,(j.leftPadding??0)*(N/2),(j.rightPadding??0)*(N/2)))}j.type===1?(O.strokeStyle=O.fillStyle,O.stroke()):O.fill(),O.closePath()})(S,D,_,w,x,k,A,T),!0)};const f=new Map;function m(S,v,_=0){return Math.max(Math.min(S,v),_)}const g={C:(S,v)=>S.bezierCurveTo(v[0],v[1],v[2],v[3],v[4],v[5]),L:(S,v)=>S.lineTo(v[0],v[1]),M:(S,v)=>S.moveTo(v[0],v[1])};function C(S,v,_,w,x,k,A,T=0,M=0){const E=S.map((L=>parseFloat(L)||parseInt(L)));if(E.length<2)throw new Error("Too few arguments for instruction");for(let L=0;L<E.length;L+=2)E[L]*=v-T*A-M*A,k&&E[L]!==0&&(E[L]=m(Math.round(E[L]+.5)-.5,v,0)),E[L]+=w+T*A;for(let L=1;L<E.length;L+=2)E[L]*=_,k&&E[L]!==0&&(E[L]=m(Math.round(E[L]+.5)-.5,_,0)),E[L]+=x;return E}},56:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.observeDevicePixelDimensions=void 0;const u=l(859);o.observeDevicePixelDimensions=function(h,f,m){let g=new f.ResizeObserver((C=>{const S=C.find((w=>w.target===h));if(!S)return;if(!("devicePixelContentBoxSize"in S))return g?.disconnect(),void(g=void 0);const v=S.devicePixelContentBoxSize[0].inlineSize,_=S.devicePixelContentBoxSize[0].blockSize;v>0&&_>0&&m(v,_)}));try{g.observe(h,{box:["device-pixel-content-box"]})}catch{g.disconnect(),g=void 0}return(0,u.toDisposable)((()=>g?.disconnect()))}},374:(a,o)=>{function l(h){return 57508<=h&&h<=57558}function u(h){return h>=128512&&h<=128591||h>=127744&&h<=128511||h>=128640&&h<=128767||h>=9728&&h<=9983||h>=9984&&h<=10175||h>=65024&&h<=65039||h>=129280&&h<=129535||h>=127462&&h<=127487}Object.defineProperty(o,"__esModule",{value:!0}),o.computeNextVariantOffset=o.createRenderDimensions=o.treatGlyphAsBackgroundColor=o.allowRescaling=o.isEmoji=o.isRestrictedPowerlineGlyph=o.isPowerlineGlyph=o.throwIfFalsy=void 0,o.throwIfFalsy=function(h){if(!h)throw new Error("value must not be falsy");return h},o.isPowerlineGlyph=l,o.isRestrictedPowerlineGlyph=function(h){return 57520<=h&&h<=57527},o.isEmoji=u,o.allowRescaling=function(h,f,m,g){return f===1&&m>Math.ceil(1.5*g)&&h!==void 0&&h>255&&!u(h)&&!l(h)&&!(function(C){return 57344<=C&&C<=63743})(h)},o.treatGlyphAsBackgroundColor=function(h){return l(h)||(function(f){return 9472<=f&&f<=9631})(h)},o.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},o.computeNextVariantOffset=function(h,f,m=0){return(h-(2*Math.round(f)-m))%(2*Math.round(f))}},296:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createSelectionRenderModel=void 0;class l{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(h,f,m,g=!1){if(this.selectionStart=f,this.selectionEnd=m,!f||!m||f[0]===m[0]&&f[1]===m[1])return void this.clear();const C=h.buffers.active.ydisp,S=f[1]-C,v=m[1]-C,_=Math.max(S,0),w=Math.min(v,h.rows-1);_>=h.rows||w<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=g,this.viewportStartRow=S,this.viewportEndRow=v,this.viewportCappedStartRow=_,this.viewportCappedEndRow=w,this.startCol=f[0],this.endCol=m[0])}isCellSelected(h,f,m){return!!this.hasSelection&&(m-=h.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?f>=this.startCol&&m>=this.viewportCappedStartRow&&f<this.endCol&&m<=this.viewportCappedEndRow:f<this.startCol&&m>=this.viewportCappedStartRow&&f>=this.endCol&&m<=this.viewportCappedEndRow:m>this.viewportStartRow&&m<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&m===this.viewportStartRow&&f>=this.startCol&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportEndRow&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportStartRow&&f>=this.startCol)}}o.createSelectionRenderModel=function(){return new l}},509:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TextureAtlas=void 0;const u=l(237),h=l(860),f=l(374),m=l(160),g=l(345),C=l(485),S=l(385),v=l(147),_=l(855),w={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}};let x;class k{get pages(){return this._pages}constructor(L,D,O){this._document=L,this._config=D,this._unicodeService=O,this._didWarmUp=!1,this._cacheMap=new C.FourKeyMap,this._cacheMapCombined=new C.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new v.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new g.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new g.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=M(L,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=(0,f.throwIfFalsy)(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(const L of this.pages)L.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){const L=new S.IdleTaskQueue;for(let D=33;D<126;D++)L.enqueue((()=>{if(!this._cacheMap.get(D,_.DEFAULT_COLOR,_.DEFAULT_COLOR,_.DEFAULT_EXT)){const O=this._drawToCache(D,_.DEFAULT_COLOR,_.DEFAULT_COLOR,_.DEFAULT_EXT);this._cacheMap.set(D,_.DEFAULT_COLOR,_.DEFAULT_COLOR,_.DEFAULT_EXT,O)}}))}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(const L of this._pages)L.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(k.maxAtlasPages&&this._pages.length>=Math.max(4,k.maxAtlasPages)){const D=this._pages.filter((Y=>2*Y.canvas.width<=(k.maxTextureSize||4096))).sort(((Y,Q)=>Q.canvas.width!==Y.canvas.width?Q.canvas.width-Y.canvas.width:Q.percentageUsed-Y.percentageUsed));let O=-1,j=0;for(let Y=0;Y<D.length;Y++)if(D[Y].canvas.width!==j)O=Y,j=D[Y].canvas.width;else if(Y-O==3)break;const U=D.slice(O,O+4),q=U.map((Y=>Y.glyphs[0].texturePage)).sort(((Y,Q)=>Y>Q?1:-1)),K=this.pages.length-U.length,$=this._mergePages(U,K);$.version++;for(let Y=q.length-1;Y>=0;Y--)this._deletePage(q[Y]);this.pages.push($),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire($.canvas)}const L=new A(this._document,this._textureSize);return this._pages.push(L),this._activePages.push(L),this._onAddTextureAtlasCanvas.fire(L.canvas),L}_mergePages(L,D){const O=2*L[0].canvas.width,j=new A(this._document,O,L);for(const[U,q]of L.entries()){const K=U*q.canvas.width%O,$=Math.floor(U/2)*q.canvas.height;j.ctx.drawImage(q.canvas,K,$);for(const Q of q.glyphs)Q.texturePage=D,Q.sizeClipSpace.x=Q.size.x/O,Q.sizeClipSpace.y=Q.size.y/O,Q.texturePosition.x+=K,Q.texturePosition.y+=$,Q.texturePositionClipSpace.x=Q.texturePosition.x/O,Q.texturePositionClipSpace.y=Q.texturePosition.y/O;this._onRemoveTextureAtlasCanvas.fire(q.canvas);const Y=this._activePages.indexOf(q);Y!==-1&&this._activePages.splice(Y,1)}return j}_deletePage(L){this._pages.splice(L,1);for(let D=L;D<this._pages.length;D++){const O=this._pages[D];for(const j of O.glyphs)j.texturePage--;O.version++}}getRasterizedGlyphCombinedChar(L,D,O,j,U){return this._getFromCacheMap(this._cacheMapCombined,L,D,O,j,U)}getRasterizedGlyph(L,D,O,j,U){return this._getFromCacheMap(this._cacheMap,L,D,O,j,U)}_getFromCacheMap(L,D,O,j,U,q=!1){return x=L.get(D,O,j,U),x||(x=this._drawToCache(D,O,j,U,q),L.set(D,O,j,U,x)),x}_getColorFromAnsiIndex(L){if(L>=this._config.colors.ansi.length)throw new Error("No color found for idx "+L);return this._config.colors.ansi[L]}_getBackgroundColor(L,D,O,j){if(this._config.allowTransparency)return m.NULL_COLOR;let U;switch(L){case 16777216:case 33554432:U=this._getColorFromAnsiIndex(D);break;case 50331648:const q=v.AttributeData.toColorRGB(D);U=m.channels.toColor(q[0],q[1],q[2]);break;default:U=O?m.color.opaque(this._config.colors.foreground):this._config.colors.background}return U}_getForegroundColor(L,D,O,j,U,q,K,$,Y,Q){const F=this._getMinimumContrastColor(L,D,O,j,U,q,K,Y,$,Q);if(F)return F;let N;switch(U){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&Y&&q<8&&(q+=8),N=this._getColorFromAnsiIndex(q);break;case 50331648:const z=v.AttributeData.toColorRGB(q);N=m.channels.toColor(z[0],z[1],z[2]);break;default:N=K?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(N=m.color.opaque(N)),$&&(N=m.color.multiplyOpacity(N,u.DIM_OPACITY)),N}_resolveBackgroundRgba(L,D,O){switch(L){case 16777216:case 33554432:return this._getColorFromAnsiIndex(D).rgba;case 50331648:return D<<8;default:return O?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(L,D,O,j){switch(L){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&j&&D<8&&(D+=8),this._getColorFromAnsiIndex(D).rgba;case 50331648:return D<<8;default:return O?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(L,D,O,j,U,q,K,$,Y,Q){if(this._config.minimumContrastRatio===1||Q)return;const F=this._getContrastCache(Y),N=F.getColor(L,j);if(N!==void 0)return N||void 0;const z=this._resolveBackgroundRgba(D,O,K),G=this._resolveForegroundRgba(U,q,K,$),H=m.rgba.ensureContrastRatio(z,G,this._config.minimumContrastRatio/(Y?2:1));if(!H)return void F.setColor(L,j,null);const ee=m.channels.toColor(H>>24&255,H>>16&255,H>>8&255);return F.setColor(L,j,ee),ee}_getContrastCache(L){return L?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(L,D,O,j,U=!1){const q=typeof L=="number"?String.fromCharCode(L):L,K=Math.min(this._config.deviceCellWidth*Math.max(q.length,2)+4,this._textureSize);this._tmpCanvas.width<K&&(this._tmpCanvas.width=K);const $=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<$&&(this._tmpCanvas.height=$),this._tmpCtx.save(),this._workAttributeData.fg=O,this._workAttributeData.bg=D,this._workAttributeData.extended.ext=j,this._workAttributeData.isInvisible())return w;const Y=!!this._workAttributeData.isBold(),Q=!!this._workAttributeData.isInverse(),F=!!this._workAttributeData.isDim(),N=!!this._workAttributeData.isItalic(),z=!!this._workAttributeData.isUnderline(),G=!!this._workAttributeData.isStrikethrough(),H=!!this._workAttributeData.isOverline();let ee=this._workAttributeData.getFgColor(),ue=this._workAttributeData.getFgColorMode(),ce=this._workAttributeData.getBgColor(),J=this._workAttributeData.getBgColorMode();if(Q){const Te=ee;ee=ce,ce=Te;const Fe=ue;ue=J,J=Fe}const V=this._getBackgroundColor(J,ce,Q,F);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=V.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";const ne=Y?this._config.fontWeightBold:this._config.fontWeight,he=N?"italic":"";this._tmpCtx.font=`${he} ${ne} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=u.TEXT_BASELINE;const _e=q.length===1&&(0,f.isPowerlineGlyph)(q.charCodeAt(0)),Ce=q.length===1&&(0,f.isRestrictedPowerlineGlyph)(q.charCodeAt(0)),we=this._getForegroundColor(D,J,ce,O,ue,ee,Q,F,Y,(0,f.treatGlyphAsBackgroundColor)(q.charCodeAt(0)));this._tmpCtx.fillStyle=we.css;const Ee=Ce?0:4;let qe=!1;this._config.customGlyphs!==!1&&(qe=(0,h.tryDrawCustomChar)(this._tmpCtx,q,Ee,Ee,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let yt,Pe=!_e;if(yt=typeof L=="number"?this._unicodeService.wcwidth(L):this._unicodeService.getStringCellWidth(L),z){this._tmpCtx.save();const Te=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),Fe=Te%2==1?.5:0;if(this._tmpCtx.lineWidth=Te,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())Pe=!1,this._tmpCtx.strokeStyle=`rgb(${v.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{Pe=!1;let ze=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&ze<8&&(ze+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(ze).css}this._tmpCtx.beginPath();const _t=Ee,se=Math.ceil(Ee+this._config.deviceCharHeight)-Fe-(U?2*Te:0),ge=se+Te,Me=se+2*Te;let je=this._workAttributeData.getUnderlineVariantOffset();for(let ze=0;ze<yt;ze++){this._tmpCtx.save();const Ye=_t+ze*this._config.deviceCellWidth,He=_t+(ze+1)*this._config.deviceCellWidth,Yt=Ye+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(Ye,se),this._tmpCtx.lineTo(He,se),this._tmpCtx.moveTo(Ye,Me),this._tmpCtx.lineTo(He,Me);break;case 3:const zt=Te<=1?Me:Math.ceil(Ee+this._config.deviceCharHeight-Te/2)-Fe,sn=Te<=1?se:Math.ceil(Ee+this._config.deviceCharHeight+Te/2)-Fe,St=new Path2D;St.rect(Ye,se,this._config.deviceCellWidth,Me-se),this._tmpCtx.clip(St),this._tmpCtx.moveTo(Ye-this._config.deviceCellWidth/2,ge),this._tmpCtx.bezierCurveTo(Ye-this._config.deviceCellWidth/2,sn,Ye,sn,Ye,ge),this._tmpCtx.bezierCurveTo(Ye,zt,Yt,zt,Yt,ge),this._tmpCtx.bezierCurveTo(Yt,sn,He,sn,He,ge),this._tmpCtx.bezierCurveTo(He,zt,He+this._config.deviceCellWidth/2,zt,He+this._config.deviceCellWidth/2,ge);break;case 4:const Wn=je===0?0:je>=Te?2*Te-je:Te-je;je>=Te||Wn===0?(this._tmpCtx.setLineDash([Math.round(Te),Math.round(Te)]),this._tmpCtx.moveTo(Ye+Wn,se),this._tmpCtx.lineTo(He,se)):(this._tmpCtx.setLineDash([Math.round(Te),Math.round(Te)]),this._tmpCtx.moveTo(Ye,se),this._tmpCtx.lineTo(Ye+Wn,se),this._tmpCtx.moveTo(Ye+Wn+Te,se),this._tmpCtx.lineTo(He,se)),je=(0,f.computeNextVariantOffset)(He-Ye,Te,je);break;case 5:const Gn=.6,il=.3,ss=He-Ye,yi=Math.floor(Gn*ss),_i=Math.floor(il*ss),rs=ss-yi-_i;this._tmpCtx.setLineDash([yi,_i,rs]),this._tmpCtx.moveTo(Ye,se),this._tmpCtx.lineTo(He,se);break;default:this._tmpCtx.moveTo(Ye,se),this._tmpCtx.lineTo(He,se)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!qe&&this._config.fontSize>=12&&!this._config.allowTransparency&&q!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";const ze=this._tmpCtx.measureText(q);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in ze&&ze.actualBoundingBoxDescent>0){this._tmpCtx.save();const Ye=new Path2D;Ye.rect(_t,se-Math.ceil(Te/2),this._config.deviceCellWidth*yt,Me-se+Math.ceil(Te/2)),this._tmpCtx.clip(Ye),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=V.css,this._tmpCtx.strokeText(q,Ee,Ee+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(H){const Te=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),Fe=Te%2==1?.5:0;this._tmpCtx.lineWidth=Te,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(Ee,Ee+Fe),this._tmpCtx.lineTo(Ee+this._config.deviceCharWidth*yt,Ee+Fe),this._tmpCtx.stroke()}if(qe||this._tmpCtx.fillText(q,Ee,Ee+this._config.deviceCharHeight),q==="_"&&!this._config.allowTransparency){let Te=T(this._tmpCtx.getImageData(Ee,Ee,this._config.deviceCellWidth,this._config.deviceCellHeight),V,we,Pe);if(Te)for(let Fe=1;Fe<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=V.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(q,Ee,Ee+this._config.deviceCharHeight-Fe),Te=T(this._tmpCtx.getImageData(Ee,Ee,this._config.deviceCellWidth,this._config.deviceCellHeight),V,we,Pe),Te);Fe++);}if(G){const Te=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),Fe=this._tmpCtx.lineWidth%2==1?.5:0;this._tmpCtx.lineWidth=Te,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(Ee,Ee+Math.floor(this._config.deviceCharHeight/2)-Fe),this._tmpCtx.lineTo(Ee+this._config.deviceCharWidth*yt,Ee+Math.floor(this._config.deviceCharHeight/2)-Fe),this._tmpCtx.stroke()}this._tmpCtx.restore();const Ot=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height);let Nt;if(Nt=this._config.allowTransparency?(function(Te){for(let Fe=0;Fe<Te.data.length;Fe+=4)if(Te.data[Fe+3]>0)return!1;return!0})(Ot):T(Ot,V,we,Pe),Nt)return w;const Qe=this._findGlyphBoundingBox(Ot,this._workBoundingBox,K,Ce,qe,Ee);let Ge,Ke;for(;;){if(this._activePages.length===0){const Te=this._createNewPage();Ge=Te,Ke=Te.currentRow,Ke.height=Qe.size.y;break}Ge=this._activePages[this._activePages.length-1],Ke=Ge.currentRow;for(const Te of this._activePages)Qe.size.y<=Te.currentRow.height&&(Ge=Te,Ke=Te.currentRow);for(let Te=this._activePages.length-1;Te>=0;Te--)for(const Fe of this._activePages[Te].fixedRows)Fe.height<=Ke.height&&Qe.size.y<=Fe.height&&(Ge=this._activePages[Te],Ke=Fe);if(Ke.y+Qe.size.y>=Ge.canvas.height||Ke.height>Qe.size.y+2){let Te=!1;if(Ge.currentRow.y+Ge.currentRow.height+Qe.size.y>=Ge.canvas.height){let Fe;for(const _t of this._activePages)if(_t.currentRow.y+_t.currentRow.height+Qe.size.y<_t.canvas.height){Fe=_t;break}if(Fe)Ge=Fe;else if(k.maxAtlasPages&&this._pages.length>=k.maxAtlasPages&&Ke.y+Qe.size.y<=Ge.canvas.height&&Ke.height>=Qe.size.y&&Ke.x+Qe.size.x<=Ge.canvas.width)Te=!0;else{const _t=this._createNewPage();Ge=_t,Ke=_t.currentRow,Ke.height=Qe.size.y,Te=!0}}Te||(Ge.currentRow.height>0&&Ge.fixedRows.push(Ge.currentRow),Ke={x:0,y:Ge.currentRow.y+Ge.currentRow.height,height:Qe.size.y},Ge.fixedRows.push(Ke),Ge.currentRow={x:0,y:Ke.y+Ke.height,height:0})}if(Ke.x+Qe.size.x<=Ge.canvas.width)break;Ke===Ge.currentRow?(Ke.x=0,Ke.y+=Ke.height,Ke.height=0):Ge.fixedRows.splice(Ge.fixedRows.indexOf(Ke),1)}return Qe.texturePage=this._pages.indexOf(Ge),Qe.texturePosition.x=Ke.x,Qe.texturePosition.y=Ke.y,Qe.texturePositionClipSpace.x=Ke.x/Ge.canvas.width,Qe.texturePositionClipSpace.y=Ke.y/Ge.canvas.height,Qe.sizeClipSpace.x/=Ge.canvas.width,Qe.sizeClipSpace.y/=Ge.canvas.height,Ke.height=Math.max(Ke.height,Qe.size.y),Ke.x+=Qe.size.x,Ge.ctx.putImageData(Ot,Qe.texturePosition.x-this._workBoundingBox.left,Qe.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,Qe.size.x,Qe.size.y),Ge.addGlyph(Qe),Ge.version++,Qe}_findGlyphBoundingBox(L,D,O,j,U,q){D.top=0;const K=j?this._config.deviceCellHeight:this._tmpCanvas.height,$=j?this._config.deviceCellWidth:O;let Y=!1;for(let Q=0;Q<K;Q++){for(let F=0;F<$;F++){const N=Q*this._tmpCanvas.width*4+4*F+3;if(L.data[N]!==0){D.top=Q,Y=!0;break}}if(Y)break}D.left=0,Y=!1;for(let Q=0;Q<q+$;Q++){for(let F=0;F<K;F++){const N=F*this._tmpCanvas.width*4+4*Q+3;if(L.data[N]!==0){D.left=Q,Y=!0;break}}if(Y)break}D.right=$,Y=!1;for(let Q=q+$-1;Q>=q;Q--){for(let F=0;F<K;F++){const N=F*this._tmpCanvas.width*4+4*Q+3;if(L.data[N]!==0){D.right=Q,Y=!0;break}}if(Y)break}D.bottom=K,Y=!1;for(let Q=K-1;Q>=0;Q--){for(let F=0;F<$;F++){const N=Q*this._tmpCanvas.width*4+4*F+3;if(L.data[N]!==0){D.bottom=Q,Y=!0;break}}if(Y)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:D.right-D.left+1,y:D.bottom-D.top+1},sizeClipSpace:{x:D.right-D.left+1,y:D.bottom-D.top+1},offset:{x:-D.left+q+(j||U?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-D.top+q+(j||U?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}o.TextureAtlas=k;class A{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(L){this._glyphs.push(L),this._usedPixels+=L.size.x*L.size.y}constructor(L,D,O){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],O)for(const j of O)this._glyphs.push(...j.glyphs),this._usedPixels+=j._usedPixels;this.canvas=M(L,D,D),this.ctx=(0,f.throwIfFalsy)(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function T(E,L,D,O){const j=L.rgba>>>24,U=L.rgba>>>16&255,q=L.rgba>>>8&255,K=D.rgba>>>24,$=D.rgba>>>16&255,Y=D.rgba>>>8&255,Q=Math.floor((Math.abs(j-K)+Math.abs(U-$)+Math.abs(q-Y))/12);let F=!0;for(let N=0;N<E.data.length;N+=4)E.data[N]===j&&E.data[N+1]===U&&E.data[N+2]===q||O&&Math.abs(E.data[N]-j)+Math.abs(E.data[N+1]-U)+Math.abs(E.data[N+2]-q)<Q?E.data[N+3]=0:F=!1;return F}function M(E,L,D){const O=E.createElement("canvas");return O.width=L,O.height=D,O}},577:function(a,o,l){var u=this&&this.__decorate||function(_,w,x,k){var A,T=arguments.length,M=T<3?w:k===null?k=Object.getOwnPropertyDescriptor(w,x):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(_,w,x,k);else for(var E=_.length-1;E>=0;E--)(A=_[E])&&(M=(T<3?A(M):T>3?A(w,x,M):A(w,x))||M);return T>3&&M&&Object.defineProperty(w,x,M),M},h=this&&this.__param||function(_,w){return function(x,k){w(x,k,_)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharacterJoinerService=o.JoinedCellData=void 0;const f=l(147),m=l(855),g=l(782),C=l(97);class S extends f.AttributeData{constructor(w,x,k){super(),this.content=0,this.combinedData="",this.fg=w.fg,this.bg=w.bg,this.combinedData=x,this._width=k}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(w){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.JoinedCellData=S;let v=o.CharacterJoinerService=class G3{constructor(w){this._bufferService=w,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new g.CellData}register(w){const x={id:this._nextCharacterJoinerId++,handler:w};return this._characterJoiners.push(x),x.id}deregister(w){for(let x=0;x<this._characterJoiners.length;x++)if(this._characterJoiners[x].id===w)return this._characterJoiners.splice(x,1),!0;return!1}getJoinedCharacters(w){if(this._characterJoiners.length===0)return[];const x=this._bufferService.buffer.lines.get(w);if(!x||x.length===0)return[];const k=[],A=x.translateToString(!0);let T=0,M=0,E=0,L=x.getFg(0),D=x.getBg(0);for(let O=0;O<x.getTrimmedLength();O++)if(x.loadCell(O,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==L||this._workCell.bg!==D){if(O-T>1){const j=this._getJoinedRanges(A,E,M,x,T);for(let U=0;U<j.length;U++)k.push(j[U])}T=O,E=M,L=this._workCell.fg,D=this._workCell.bg}M+=this._workCell.getChars().length||m.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-T>1){const O=this._getJoinedRanges(A,E,M,x,T);for(let j=0;j<O.length;j++)k.push(O[j])}return k}_getJoinedRanges(w,x,k,A,T){const M=w.substring(x,k);let E=[];try{E=this._characterJoiners[0].handler(M)}catch(L){console.error(L)}for(let L=1;L<this._characterJoiners.length;L++)try{const D=this._characterJoiners[L].handler(M);for(let O=0;O<D.length;O++)G3._mergeRanges(E,D[O])}catch(D){console.error(D)}return this._stringRangesToCellRanges(E,A,T),E}_stringRangesToCellRanges(w,x,k){let A=0,T=!1,M=0,E=w[A];if(E){for(let L=k;L<this._bufferService.cols;L++){const D=x.getWidth(L),O=x.getString(L).length||m.WHITESPACE_CELL_CHAR.length;if(D!==0){if(!T&&E[0]<=M&&(E[0]=L,T=!0),E[1]<=M){if(E[1]=L,E=w[++A],!E)break;E[0]<=M?(E[0]=L,T=!0):T=!1}M+=O}}E&&(E[1]=this._bufferService.cols)}}static _mergeRanges(w,x){let k=!1;for(let A=0;A<w.length;A++){const T=w[A];if(k){if(x[1]<=T[0])return w[A-1][1]=x[1],w;if(x[1]<=T[1])return w[A-1][1]=Math.max(x[1],T[1]),w.splice(A,1),w;w.splice(A,1),A--}else{if(x[1]<=T[0])return w.splice(A,0,x),w;if(x[1]<=T[1])return T[0]=Math.min(x[0],T[0]),w;x[0]<T[1]&&(T[0]=Math.min(x[0],T[0]),k=!0)}}return k?w[w.length-1][1]=x[1]:w.push(x),w}};o.CharacterJoinerService=v=u([h(0,C.IBufferService)],v)},160:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.contrastRatio=o.toPaddedHex=o.rgba=o.rgb=o.css=o.color=o.channels=o.NULL_COLOR=void 0;let l=0,u=0,h=0,f=0;var m,g,C,S,v;function _(x){const k=x.toString(16);return k.length<2?"0"+k:k}function w(x,k){return x<k?(k+.05)/(x+.05):(x+.05)/(k+.05)}o.NULL_COLOR={css:"#00000000",rgba:0},(function(x){x.toCss=function(k,A,T,M){return M!==void 0?`#${_(k)}${_(A)}${_(T)}${_(M)}`:`#${_(k)}${_(A)}${_(T)}`},x.toRgba=function(k,A,T,M=255){return(k<<24|A<<16|T<<8|M)>>>0},x.toColor=function(k,A,T,M){return{css:x.toCss(k,A,T,M),rgba:x.toRgba(k,A,T,M)}}})(m||(o.channels=m={})),(function(x){function k(A,T){return f=Math.round(255*T),[l,u,h]=v.toChannels(A.rgba),{css:m.toCss(l,u,h,f),rgba:m.toRgba(l,u,h,f)}}x.blend=function(A,T){if(f=(255&T.rgba)/255,f===1)return{css:T.css,rgba:T.rgba};const M=T.rgba>>24&255,E=T.rgba>>16&255,L=T.rgba>>8&255,D=A.rgba>>24&255,O=A.rgba>>16&255,j=A.rgba>>8&255;return l=D+Math.round((M-D)*f),u=O+Math.round((E-O)*f),h=j+Math.round((L-j)*f),{css:m.toCss(l,u,h),rgba:m.toRgba(l,u,h)}},x.isOpaque=function(A){return(255&A.rgba)==255},x.ensureContrastRatio=function(A,T,M){const E=v.ensureContrastRatio(A.rgba,T.rgba,M);if(E)return m.toColor(E>>24&255,E>>16&255,E>>8&255)},x.opaque=function(A){const T=(255|A.rgba)>>>0;return[l,u,h]=v.toChannels(T),{css:m.toCss(l,u,h),rgba:T}},x.opacity=k,x.multiplyOpacity=function(A,T){return f=255&A.rgba,k(A,f*T/255)},x.toColorRGB=function(A){return[A.rgba>>24&255,A.rgba>>16&255,A.rgba>>8&255]}})(g||(o.color=g={})),(function(x){let k,A;try{const T=document.createElement("canvas");T.width=1,T.height=1;const M=T.getContext("2d",{willReadFrequently:!0});M&&(k=M,k.globalCompositeOperation="copy",A=k.createLinearGradient(0,0,1,1))}catch{}x.toColor=function(T){if(T.match(/#[\da-f]{3,8}/i))switch(T.length){case 4:return l=parseInt(T.slice(1,2).repeat(2),16),u=parseInt(T.slice(2,3).repeat(2),16),h=parseInt(T.slice(3,4).repeat(2),16),m.toColor(l,u,h);case 5:return l=parseInt(T.slice(1,2).repeat(2),16),u=parseInt(T.slice(2,3).repeat(2),16),h=parseInt(T.slice(3,4).repeat(2),16),f=parseInt(T.slice(4,5).repeat(2),16),m.toColor(l,u,h,f);case 7:return{css:T,rgba:(parseInt(T.slice(1),16)<<8|255)>>>0};case 9:return{css:T,rgba:parseInt(T.slice(1),16)>>>0}}const M=T.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(M)return l=parseInt(M[1]),u=parseInt(M[2]),h=parseInt(M[3]),f=Math.round(255*(M[5]===void 0?1:parseFloat(M[5]))),m.toColor(l,u,h,f);if(!k||!A)throw new Error("css.toColor: Unsupported css format");if(k.fillStyle=A,k.fillStyle=T,typeof k.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(k.fillRect(0,0,1,1),[l,u,h,f]=k.getImageData(0,0,1,1).data,f!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:m.toRgba(l,u,h,f),css:T}}})(C||(o.css=C={})),(function(x){function k(A,T,M){const E=A/255,L=T/255,D=M/255;return .2126*(E<=.03928?E/12.92:Math.pow((E+.055)/1.055,2.4))+.7152*(L<=.03928?L/12.92:Math.pow((L+.055)/1.055,2.4))+.0722*(D<=.03928?D/12.92:Math.pow((D+.055)/1.055,2.4))}x.relativeLuminance=function(A){return k(A>>16&255,A>>8&255,255&A)},x.relativeLuminance2=k})(S||(o.rgb=S={})),(function(x){function k(T,M,E){const L=T>>24&255,D=T>>16&255,O=T>>8&255;let j=M>>24&255,U=M>>16&255,q=M>>8&255,K=w(S.relativeLuminance2(j,U,q),S.relativeLuminance2(L,D,O));for(;K<E&&(j>0||U>0||q>0);)j-=Math.max(0,Math.ceil(.1*j)),U-=Math.max(0,Math.ceil(.1*U)),q-=Math.max(0,Math.ceil(.1*q)),K=w(S.relativeLuminance2(j,U,q),S.relativeLuminance2(L,D,O));return(j<<24|U<<16|q<<8|255)>>>0}function A(T,M,E){const L=T>>24&255,D=T>>16&255,O=T>>8&255;let j=M>>24&255,U=M>>16&255,q=M>>8&255,K=w(S.relativeLuminance2(j,U,q),S.relativeLuminance2(L,D,O));for(;K<E&&(j<255||U<255||q<255);)j=Math.min(255,j+Math.ceil(.1*(255-j))),U=Math.min(255,U+Math.ceil(.1*(255-U))),q=Math.min(255,q+Math.ceil(.1*(255-q))),K=w(S.relativeLuminance2(j,U,q),S.relativeLuminance2(L,D,O));return(j<<24|U<<16|q<<8|255)>>>0}x.blend=function(T,M){if(f=(255&M)/255,f===1)return M;const E=M>>24&255,L=M>>16&255,D=M>>8&255,O=T>>24&255,j=T>>16&255,U=T>>8&255;return l=O+Math.round((E-O)*f),u=j+Math.round((L-j)*f),h=U+Math.round((D-U)*f),m.toRgba(l,u,h)},x.ensureContrastRatio=function(T,M,E){const L=S.relativeLuminance(T>>8),D=S.relativeLuminance(M>>8);if(w(L,D)<E){if(D<L){const U=k(T,M,E),q=w(L,S.relativeLuminance(U>>8));if(q<E){const K=A(T,M,E);return q>w(L,S.relativeLuminance(K>>8))?U:K}return U}const O=A(T,M,E),j=w(L,S.relativeLuminance(O>>8));if(j<E){const U=k(T,M,E);return j>w(L,S.relativeLuminance(U>>8))?O:U}return O}},x.reduceLuminance=k,x.increaseLuminance=A,x.toChannels=function(T){return[T>>24&255,T>>16&255,T>>8&255,255&T]}})(v||(o.rgba=v={})),o.toPaddedHex=_,o.contrastRatio=w},345:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.runAndSubscribe=o.forwardEvent=o.EventEmitter=void 0,o.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=l=>(this._listeners.push(l),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===l)return void this._listeners.splice(u,1)}}})),this._event}fire(l,u){const h=[];for(let f=0;f<this._listeners.length;f++)h.push(this._listeners[f]);for(let f=0;f<h.length;f++)h[f].call(void 0,l,u)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},o.forwardEvent=function(l,u){return l((h=>u.fire(h)))},o.runAndSubscribe=function(l,u){return u(void 0),l((h=>u(h)))}},859:(a,o)=>{function l(u){for(const h of u)h.dispose();u.length=0}Object.defineProperty(o,"__esModule",{value:!0}),o.getDisposeArrayDisposable=o.disposeArray=o.toDisposable=o.MutableDisposable=o.Disposable=void 0,o.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const h=this._disposables.indexOf(u);h!==-1&&this._disposables.splice(h,1)}},o.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},o.toDisposable=function(u){return{dispose:u}},o.disposeArray=l,o.getDisposeArrayDisposable=function(u){return{dispose:()=>l(u)}}},485:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.FourKeyMap=o.TwoKeyMap=void 0;class l{constructor(){this._data={}}set(h,f,m){this._data[h]||(this._data[h]={}),this._data[h][f]=m}get(h,f){return this._data[h]?this._data[h][f]:void 0}clear(){this._data={}}}o.TwoKeyMap=l,o.FourKeyMap=class{constructor(){this._data=new l}set(u,h,f,m,g){this._data.get(u,h)||this._data.set(u,h,new l),this._data.get(u,h).set(f,m,g)}get(u,h,f,m){return this._data.get(u,h)?.get(f,m)}clear(){this._data.clear()}}},399:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.isChromeOS=o.isLinux=o.isWindows=o.isIphone=o.isIpad=o.isMac=o.getSafariVersion=o.isSafari=o.isLegacyEdge=o.isFirefox=o.isNode=void 0,o.isNode=typeof process<"u"&&"title"in process;const l=o.isNode?"node":navigator.userAgent,u=o.isNode?"node":navigator.platform;o.isFirefox=l.includes("Firefox"),o.isLegacyEdge=l.includes("Edge"),o.isSafari=/^((?!chrome|android).)*safari/i.test(l),o.getSafariVersion=function(){if(!o.isSafari)return 0;const h=l.match(/Version\/(\d+)/);return h===null||h.length<2?0:parseInt(h[1])},o.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(u),o.isIpad=u==="iPad",o.isIphone=u==="iPhone",o.isWindows=["Windows","Win16","Win32","WinCE"].includes(u),o.isLinux=u.indexOf("Linux")>=0,o.isChromeOS=/\bCrOS\b/.test(l)},385:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DebouncedIdleTask=o.IdleTaskQueue=o.PriorityTaskQueue=void 0;const u=l(399);class h{constructor(){this._tasks=[],this._i=0}enqueue(g){this._tasks.push(g),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(g){this._idleCallback=void 0;let C=0,S=0,v=g.timeRemaining(),_=0;for(;this._i<this._tasks.length;){if(C=Date.now(),this._tasks[this._i]()||this._i++,C=Math.max(1,Date.now()-C),S=Math.max(C,S),_=g.timeRemaining(),1.5*S>_)return v-C<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(v-C))}ms`),void this._start();v=_}this.clear()}}class f extends h{_requestCallback(g){return setTimeout((()=>g(this._createDeadline(16))))}_cancelCallback(g){clearTimeout(g)}_createDeadline(g){const C=Date.now()+g;return{timeRemaining:()=>Math.max(0,C-Date.now())}}}o.PriorityTaskQueue=f,o.IdleTaskQueue=!u.isNode&&"requestIdleCallback"in window?class extends h{_requestCallback(m){return requestIdleCallback(m)}_cancelCallback(m){cancelIdleCallback(m)}}:f,o.DebouncedIdleTask=class{constructor(){this._queue=new o.IdleTaskQueue}set(m){this._queue.clear(),this._queue.enqueue(m)}flush(){this._queue.flush()}}},147:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ExtendedAttrs=o.AttributeData=void 0;class l{constructor(){this.fg=0,this.bg=0,this.extended=new u}static toColorRGB(f){return[f>>>16&255,f>>>8&255,255&f]}static fromColorRGB(f){return(255&f[0])<<16|(255&f[1])<<8|255&f[2]}clone(){const f=new l;return f.fg=this.fg,f.bg=this.bg,f.extended=this.extended.clone(),f}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}o.AttributeData=l;class u{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(f){this._ext=f}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(f){this._ext&=-469762049,this._ext|=f<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(f){this._ext&=-67108864,this._ext|=67108863&f}get urlId(){return this._urlId}set urlId(f){this._urlId=f}get underlineVariantOffset(){const f=(3758096384&this._ext)>>29;return f<0?4294967288^f:f}set underlineVariantOffset(f){this._ext&=536870911,this._ext|=f<<29&3758096384}constructor(f=0,m=0){this._ext=0,this._urlId=0,this._ext=f,this._urlId=m}clone(){return new u(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}o.ExtendedAttrs=u},782:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CellData=void 0;const u=l(133),h=l(855),f=l(147);class m extends f.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new f.ExtendedAttrs,this.combinedData=""}static fromCharData(C){const S=new m;return S.setFromCharData(C),S}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,u.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(C){this.fg=C[h.CHAR_DATA_ATTR_INDEX],this.bg=0;let S=!1;if(C[h.CHAR_DATA_CHAR_INDEX].length>2)S=!0;else if(C[h.CHAR_DATA_CHAR_INDEX].length===2){const v=C[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=v&&v<=56319){const _=C[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=_&&_<=57343?this.content=1024*(v-55296)+_-56320+65536|C[h.CHAR_DATA_WIDTH_INDEX]<<22:S=!0}else S=!0}else this.content=C[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|C[h.CHAR_DATA_WIDTH_INDEX]<<22;S&&(this.combinedData=C[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|C[h.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.CellData=m},855:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WHITESPACE_CELL_CODE=o.WHITESPACE_CELL_WIDTH=o.WHITESPACE_CELL_CHAR=o.NULL_CELL_CODE=o.NULL_CELL_WIDTH=o.NULL_CELL_CHAR=o.CHAR_DATA_CODE_INDEX=o.CHAR_DATA_WIDTH_INDEX=o.CHAR_DATA_CHAR_INDEX=o.CHAR_DATA_ATTR_INDEX=o.DEFAULT_EXT=o.DEFAULT_ATTR=o.DEFAULT_COLOR=void 0,o.DEFAULT_COLOR=0,o.DEFAULT_ATTR=256|o.DEFAULT_COLOR<<9,o.DEFAULT_EXT=0,o.CHAR_DATA_ATTR_INDEX=0,o.CHAR_DATA_CHAR_INDEX=1,o.CHAR_DATA_WIDTH_INDEX=2,o.CHAR_DATA_CODE_INDEX=3,o.NULL_CELL_CHAR="",o.NULL_CELL_WIDTH=1,o.NULL_CELL_CODE=0,o.WHITESPACE_CELL_CHAR=" ",o.WHITESPACE_CELL_WIDTH=1,o.WHITESPACE_CELL_CODE=32},133:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Utf8ToUtf32=o.StringToUtf32=o.utf32ToString=o.stringFromCodePoint=void 0,o.stringFromCodePoint=function(l){return l>65535?(l-=65536,String.fromCharCode(55296+(l>>10))+String.fromCharCode(l%1024+56320)):String.fromCharCode(l)},o.utf32ToString=function(l,u=0,h=l.length){let f="";for(let m=u;m<h;++m){let g=l[m];g>65535?(g-=65536,f+=String.fromCharCode(55296+(g>>10))+String.fromCharCode(g%1024+56320)):f+=String.fromCharCode(g)}return f},o.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(l,u){const h=l.length;if(!h)return 0;let f=0,m=0;if(this._interim){const g=l.charCodeAt(m++);56320<=g&&g<=57343?u[f++]=1024*(this._interim-55296)+g-56320+65536:(u[f++]=this._interim,u[f++]=g),this._interim=0}for(let g=m;g<h;++g){const C=l.charCodeAt(g);if(55296<=C&&C<=56319){if(++g>=h)return this._interim=C,f;const S=l.charCodeAt(g);56320<=S&&S<=57343?u[f++]=1024*(C-55296)+S-56320+65536:(u[f++]=C,u[f++]=S)}else C!==65279&&(u[f++]=C)}return f}},o.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(l,u){const h=l.length;if(!h)return 0;let f,m,g,C,S=0,v=0,_=0;if(this.interim[0]){let k=!1,A=this.interim[0];A&=(224&A)==192?31:(240&A)==224?15:7;let T,M=0;for(;(T=63&this.interim[++M])&&M<4;)A<<=6,A|=T;const E=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,L=E-M;for(;_<L;){if(_>=h)return 0;if(T=l[_++],(192&T)!=128){_--,k=!0;break}this.interim[M++]=T,A<<=6,A|=63&T}k||(E===2?A<128?_--:u[S++]=A:E===3?A<2048||A>=55296&&A<=57343||A===65279||(u[S++]=A):A<65536||A>1114111||(u[S++]=A)),this.interim.fill(0)}const w=h-4;let x=_;for(;x<h;){for(;!(!(x<w)||128&(f=l[x])||128&(m=l[x+1])||128&(g=l[x+2])||128&(C=l[x+3]));)u[S++]=f,u[S++]=m,u[S++]=g,u[S++]=C,x+=4;if(f=l[x++],f<128)u[S++]=f;else if((224&f)==192){if(x>=h)return this.interim[0]=f,S;if(m=l[x++],(192&m)!=128){x--;continue}if(v=(31&f)<<6|63&m,v<128){x--;continue}u[S++]=v}else if((240&f)==224){if(x>=h)return this.interim[0]=f,S;if(m=l[x++],(192&m)!=128){x--;continue}if(x>=h)return this.interim[0]=f,this.interim[1]=m,S;if(g=l[x++],(192&g)!=128){x--;continue}if(v=(15&f)<<12|(63&m)<<6|63&g,v<2048||v>=55296&&v<=57343||v===65279)continue;u[S++]=v}else if((248&f)==240){if(x>=h)return this.interim[0]=f,S;if(m=l[x++],(192&m)!=128){x--;continue}if(x>=h)return this.interim[0]=f,this.interim[1]=m,S;if(g=l[x++],(192&g)!=128){x--;continue}if(x>=h)return this.interim[0]=f,this.interim[1]=m,this.interim[2]=g,S;if(C=l[x++],(192&C)!=128){x--;continue}if(v=(7&f)<<18|(63&m)<<12|(63&g)<<6|63&C,v<65536||v>1114111)continue;u[S++]=v}}return S}}},776:function(a,o,l){var u=this&&this.__decorate||function(v,_,w,x){var k,A=arguments.length,T=A<3?_:x===null?x=Object.getOwnPropertyDescriptor(_,w):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(v,_,w,x);else for(var M=v.length-1;M>=0;M--)(k=v[M])&&(T=(A<3?k(T):A>3?k(_,w,T):k(_,w))||T);return A>3&&T&&Object.defineProperty(_,w,T),T},h=this&&this.__param||function(v,_){return function(w,x){_(w,x,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.traceCall=o.setTraceLogger=o.LogService=void 0;const f=l(859),m=l(97),g={trace:m.LogLevelEnum.TRACE,debug:m.LogLevelEnum.DEBUG,info:m.LogLevelEnum.INFO,warn:m.LogLevelEnum.WARN,error:m.LogLevelEnum.ERROR,off:m.LogLevelEnum.OFF};let C,S=o.LogService=class extends f.Disposable{get logLevel(){return this._logLevel}constructor(v){super(),this._optionsService=v,this._logLevel=m.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),C=this}_updateLogLevel(){this._logLevel=g[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(v){for(let _=0;_<v.length;_++)typeof v[_]=="function"&&(v[_]=v[_]())}_log(v,_,w){this._evalLazyOptionalParams(w),v.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+_,...w)}trace(v,..._){this._logLevel<=m.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,v,_)}debug(v,..._){this._logLevel<=m.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,v,_)}info(v,..._){this._logLevel<=m.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,v,_)}warn(v,..._){this._logLevel<=m.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,v,_)}error(v,..._){this._logLevel<=m.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,v,_)}};o.LogService=S=u([h(0,m.IOptionsService)],S),o.setTraceLogger=function(v){C=v},o.traceCall=function(v,_,w){if(typeof w.value!="function")throw new Error("not supported");const x=w.value;w.value=function(...k){if(C.logLevel!==m.LogLevelEnum.TRACE)return x.apply(this,k);C.trace(`GlyphRenderer#${x.name}(${k.map((T=>JSON.stringify(T))).join(", ")})`);const A=x.apply(this,k);return C.trace(`GlyphRenderer#${x.name} return`,A),A}}},726:(a,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createDecorator=o.getServiceDependencies=o.serviceRegistry=void 0;const l="di$target",u="di$dependencies";o.serviceRegistry=new Map,o.getServiceDependencies=function(h){return h[u]||[]},o.createDecorator=function(h){if(o.serviceRegistry.has(h))return o.serviceRegistry.get(h);const f=function(m,g,C){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(S,v,_){v[l]===v?v[u].push({id:S,index:_}):(v[u]=[{id:S,index:_}],v[l]=v)})(f,m,C)};return f.toString=()=>h,o.serviceRegistry.set(h,f),f}},97:(a,o,l)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.IDecorationService=o.IUnicodeService=o.IOscLinkService=o.IOptionsService=o.ILogService=o.LogLevelEnum=o.IInstantiationService=o.ICharsetService=o.ICoreService=o.ICoreMouseService=o.IBufferService=void 0;const u=l(726);var h;o.IBufferService=(0,u.createDecorator)("BufferService"),o.ICoreMouseService=(0,u.createDecorator)("CoreMouseService"),o.ICoreService=(0,u.createDecorator)("CoreService"),o.ICharsetService=(0,u.createDecorator)("CharsetService"),o.IInstantiationService=(0,u.createDecorator)("InstantiationService"),(function(f){f[f.TRACE=0]="TRACE",f[f.DEBUG=1]="DEBUG",f[f.INFO=2]="INFO",f[f.WARN=3]="WARN",f[f.ERROR=4]="ERROR",f[f.OFF=5]="OFF"})(h||(o.LogLevelEnum=h={})),o.ILogService=(0,u.createDecorator)("LogService"),o.IOptionsService=(0,u.createDecorator)("OptionsService"),o.IOscLinkService=(0,u.createDecorator)("OscLinkService"),o.IUnicodeService=(0,u.createDecorator)("UnicodeService"),o.IDecorationService=(0,u.createDecorator)("DecorationService")}},i={};function s(a){var o=i[a];if(o!==void 0)return o.exports;var l=i[a]={exports:{}};return n[a].call(l.exports,l,l.exports,s),l.exports}var r={};return(()=>{var a=r;Object.defineProperty(a,"__esModule",{value:!0}),a.CanvasAddon=void 0;const o=s(345),l=s(859),u=s(776),h=s(949);class f extends l.Disposable{constructor(){super(...arguments),this._onChangeTextureAtlas=this.register(new o.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new o.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event}get textureAtlas(){return this._renderer?.textureAtlas}activate(g){const C=g._core;if(!g.element)return void this.register(C.onWillOpen((()=>this.activate(g))));this._terminal=g;const S=C.coreService,v=C.optionsService,_=C.screenElement,w=C.linkifier,x=C,k=x._bufferService,A=x._renderService,T=x._characterJoinerService,M=x._charSizeService,E=x._coreBrowserService,L=x._decorationService,D=x._logService,O=x._themeService;(0,u.setTraceLogger)(D),this._renderer=new h.CanvasRenderer(g,_,w,k,M,v,T,S,E,L,O),this.register((0,o.forwardEvent)(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register((0,o.forwardEvent)(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),A.setRenderer(this._renderer),A.handleResize(k.cols,k.rows),this.register((0,l.toDisposable)((()=>{A.setRenderer(this._terminal._core._createRenderer()),A.handleResize(g.cols,g.rows),this._renderer?.dispose(),this._renderer=void 0})))}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}}a.CanvasAddon=f})(),r})()))})(L_)),L_.exports}var rfe=sfe();const vx="MesloLGLDZ Nerd Font Mono",ofe=["https://cdn.jsdmirror.com/gh/mshaugh/nerdfont-webfonts@v3.3.0/build/fonts/MesloLGLDZNerdFontMono-Regular.woff2","https://cdn.jsdelivr.net/gh/mshaugh/nerdfont-webfonts@v3.3.0/build/fonts/MesloLGLDZNerdFontMono-Regular.woff2"],K3=["JetBrainsMono Nerd Font","JetBrainsMonoNerdFont","FiraCode Nerd Font","FiraCodeNerdFont","Hack Nerd Font","HackNerdFont","MapleMono NF","Maple Mono NF","Iosevka Nerd Font","IosevkaNerdFont","CaskaydiaCove Nerd Font","MesloLGS Nerd Font","SourceCodePro Nerd Font","UbuntuMono Nerd Font"],afe=["ui-monospace","monospace"],lfe=['"SFMono-Regular"','"Menlo"','"Monaco"','"Consolas"','"Liberation Mono"','"Courier New"'];async function cfe(){let e=null;for(const t of ofe)try{const n=new FontFace(vx,`url(${t}) format("woff2")`,{style:"normal",weight:"400",display:"swap"});await n.load(),document.fonts.add(n);return}catch(n){e=n,console.warn(`[TerminalFont] Failed to load from ${t}, trying next...`)}throw e??new Error("All CDN URLs failed")}class ufe{constructor(t){this.fontFamily=t}getFontFamily(){return this.fontFamily}}const dfe=K3.map(e=>`"${e}"`).join(", "),hfe=[dfe,`"${vx}"`,...lfe,...afe],ffe=hfe.join(", "),pfe=new ufe(ffe);let up=null;function mfe(e){if(typeof document>"u")return!1;const n=document.createElement("canvas").getContext("2d");if(!n)return!1;const i="mmmmmmmmmmlli";n.font='72px "__nonexistent_font_test__", monospace';const s=n.measureText(i).width;return n.font=`72px "${e}", monospace`,n.measureText(i).width!==s}function gfe(){return[vx,...K3].some(mfe)}function vfe(){return pfe}function bfe(){return up||(gfe()?(console.log("[TerminalFont] Local Nerd Font detected; skip CDN load"),up=Promise.resolve(!1)):up=cfe().then(()=>(console.log("[TerminalFont] CDN font loaded"),!0)).catch(e=>(console.error("[TerminalFont] Failed to load CDN font:",e),!1))),up}function yfe(){const e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--app-bg").trim()||"#000000",n=e.getPropertyValue("--app-fg").trim()||"#ffffff",i=e.getPropertyValue("--app-subtle-bg").trim()||"rgba(255, 255, 255, 0.2)";return{background:t,foreground:n,selectionBackground:i}}function _fe(e){const t=P.useRef(null),n=P.useRef(e.onMount),i=P.useRef(e.onResize);return P.useEffect(()=>{n.current=e.onMount},[e.onMount]),P.useEffect(()=>{i.current=e.onResize},[e.onResize]),P.useEffect(()=>{const s=t.current;if(!s)return;const r=new AbortController,a=vfe(),{background:o,foreground:l,selectionBackground:u}=yfe(),h=new Khe.Terminal({cursorBlink:!0,fontFamily:a.getFontFamily(),fontSize:13,theme:{background:o,foreground:l,cursor:l,selectionBackground:u},convertEol:!0,customGlyphs:!0}),f=new Jhe,m=new ife,g=new rfe.CanvasAddon;h.loadAddon(f),h.loadAddon(m),h.loadAddon(g),h.open(s);const C=new ResizeObserver(()=>{requestAnimationFrame(()=>{f.fit(),i.current?.(h.cols,h.rows)})});C.observe(s);const S=(v=!1)=>{if(r.signal.aborted)return;const _=a.getFontFamily();if(v&&h.options.fontFamily===_){h.options.fontFamily=`${_}, "__codex_font_refresh__"`,requestAnimationFrame(()=>{r.signal.aborted||(h.options.fontFamily=_,h.rows>0&&h.refresh(0,h.rows-1),f.fit(),i.current?.(h.cols,h.rows))});return}h.options.fontFamily=_,h.rows>0&&h.refresh(0,h.rows-1),f.fit(),i.current?.(h.cols,h.rows)};return bfe().then(v=>{v&&S(!0)}),r.signal.addEventListener("abort",()=>{C.disconnect(),f.dispose(),m.dispose(),g.dispose(),h.dispose()}),requestAnimationFrame(()=>{f.fit(),i.current?.(h.cols,h.rows)}),n.current?.(h),()=>r.abort()},[]),b.jsx("div",{ref:t,className:`h-full w-full ${e.className??""}`})}function Sfe(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:b.jsx("polyline",{points:"15 18 9 12 15 6"})})}function Cfe(e){const t=e.status==="connected",n=e.status==="connecting",i=t?"Connected":n?"Connecting":"Offline",s=t?"bg-emerald-500":n?"bg-amber-400 animate-pulse":"bg-[var(--app-hint)]";return b.jsx("div",{className:"flex items-center","aria-label":i,title:i,role:"status",children:b.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${s}`})})}function xfe(e,t){let n=e;if(t.alt&&(n=`\x1B${n}`),t.ctrl&&n.length===1){const i=n.toUpperCase().charCodeAt(0);i>=64&&i<=95&&(n=String.fromCharCode(i-64))}return n}function wfe(e,t){return e?t.ctrl||t.alt:!1}const kfe=[[{label:"Esc",sequence:"\x1B",description:"Escape"},{label:"/",sequence:"/",description:"Forward slash",popup:{label:"?",sequence:"?",description:"Question mark"}},{label:"-",sequence:"-",description:"Hyphen",popup:{label:"|",sequence:"|",description:"Pipe"}},{label:"Home",sequence:"\x1B[H",description:"Home"},{label:"",sequence:"\x1B[A",description:"Arrow up"},{label:"End",sequence:"\x1B[F",description:"End"},{label:"PgUp",sequence:"\x1B[5~",description:"Page up"}],[{label:"Tab",sequence:"	",description:"Tab"},{label:"Ctrl",description:"Control",modifier:"ctrl"},{label:"Alt",description:"Alternate",modifier:"alt"},{label:"",sequence:"\x1B[D",description:"Arrow left"},{label:"",sequence:"\x1B[B",description:"Arrow down"},{label:"",sequence:"\x1B[C",description:"Arrow right"},{label:"PgDn",sequence:"\x1B[6~",description:"Page down"}]];function Tfe(e){const{input:t,disabled:n,isActive:i,onPress:s,onToggleModifier:r}=e,a=t.modifier,o=t.popup?.sequence,l=t.popup?.description,h=n||!!a||!!!o,f=P.useCallback(()=>{if(a){r(a);return}s(t.sequence??"")},[a,r,s,t.sequence]),m=P.useCallback(C=>{C.pointerType==="touch"&&C.preventDefault()},[]),g=U3({onLongPress:()=>{o&&!a&&s(o)},onClick:f,disabled:h});return b.jsx("button",{type:"button",...g,onPointerDown:m,disabled:n,"aria-pressed":a?i:void 0,className:`flex-1 border-l border-[var(--app-border)] px-2 py-1.5 text-xs font-medium text-[var(--app-fg)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-button)] focus-visible:ring-inset disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:bg-transparent first:border-l-0 active:bg-[var(--app-subtle-bg)] sm:px-3 sm:text-sm ${i?"bg-[var(--app-link)] text-[var(--app-bg)]":"hover:bg-[var(--app-subtle-bg)]"}`,"aria-label":t.description,title:l?`${t.description} (long press: ${l})`:t.description,children:t.label})}function Efe(){const{t:e}=ot(),{sessionId:t}=jo({from:"/sessions/$sessionId/terminal"}),{api:n,token:i,baseUrl:s}=Pc(),r=Ka(),{session:a}=gx(n,t),o=P.useMemo(()=>typeof crypto?.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,[t]),l=P.useRef(null),u=P.useRef(null),h=P.useRef(!1),f=P.useRef(null),m=P.useRef({ctrl:!1,alt:!1}),[g,C]=P.useState(null),[S,v]=P.useState(!1),[_,w]=P.useState(!1),[x,k]=P.useState(!1),[A,T]=P.useState(""),{state:M,connect:E,write:L,resize:D,disconnect:O,onOutput:j,onExit:U}=Whe({token:i,sessionId:t,terminalId:o,baseUrl:s});P.useEffect(()=>{j(J=>{l.current?.write(J)})},[j]),P.useEffect(()=>{U((J,V)=>{C({code:J,signal:V}),l.current?.write(`\r
[process exited${J!==null?` with code ${J}`:""}]`),h.current=!1})},[U]),P.useEffect(()=>{m.current={ctrl:S,alt:_}},[S,_]);const q=P.useCallback(()=>{v(!1),w(!1)},[]),K=P.useCallback((J,V)=>{L(xfe(J,V)),wfe(J,V)&&q()},[L,q]),$=P.useCallback(J=>{l.current=J,u.current?.dispose(),u.current=J.onData(V=>{const ne=m.current;K(V,ne)})},[K]),Y=P.useCallback((J,V)=>{f.current={cols:J,rows:V},a?.active&&(h.current?D(J,V):(h.current=!0,E(J,V)))},[a?.active,E,D]);P.useEffect(()=>{if(!a?.active||h.current)return;const J=f.current;J&&(h.current=!0,E(J.cols,J.rows))},[a?.active,E]),P.useEffect(()=>{h.current=!1,C(null),O()},[t,O]),P.useEffect(()=>()=>{u.current?.dispose(),h.current=!1,O()},[O]),P.useEffect(()=>{a?.active===!1&&(O(),h.current=!1)},[a?.active,O]),P.useEffect(()=>{if(M.status==="error"){h.current=!1;return}(M.status==="connecting"||M.status==="connected")&&C(null)},[M.status]);const Q=!a?.active||M.status!=="connected",F=P.useCallback(J=>!J||Q?!1:(L(J),q(),l.current?.focus(),!0),[Q,L,q]),N=P.useCallback(async()=>{if(Q)return;const J=navigator.clipboard?.readText;if(J)try{const V=await J.call(navigator.clipboard);if(!V||F(V))return}catch{}T(""),k(!0)},[Q,F]),z=P.useCallback(()=>{A.trim()&&F(A)&&(k(!1),T(""))},[A,F]),G=P.useCallback(J=>{if(Q)return;K(J,{ctrl:S,alt:_}),l.current?.focus()},[Q,S,_,K]),H=P.useCallback(J=>{Q||(J==="ctrl"?(v(V=>!V),w(!1)):(w(V=>!V),v(!1)),l.current?.focus())},[Q]);if(!a)return b.jsx("div",{className:"flex h-full items-center justify-center",children:b.jsx(mm,{label:"Loading session",className:"text-sm"})});const ee=a.metadata?.path??t,ue=M.status,ce=M.status==="error"?M.error:null;return b.jsxs("div",{className:"flex h-full flex-col",children:[b.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3 border-b border-[var(--app-border)]",children:[b.jsx("button",{type:"button",onClick:r,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:b.jsx(Sfe,{})}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"truncate font-semibold",children:"Terminal"}),b.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:ee})]}),b.jsx(Cfe,{status:ue})]})}),a.active?null:b.jsx("div",{className:"px-3 pt-3",children:b.jsx("div",{className:"mx-auto w-full max-w-content rounded-md bg-[var(--app-subtle-bg)] p-3 text-sm text-[var(--app-hint)]",children:"Session is inactive. Terminal is unavailable."})}),ce?b.jsx("div",{className:"mx-auto w-full max-w-content px-3 pt-3",children:b.jsx("div",{className:"rounded-md border border-[var(--app-badge-error-border)] bg-[var(--app-badge-error-bg)] p-3 text-xs text-[var(--app-badge-error-text)]",children:ce})}):null,g?b.jsx("div",{className:"mx-auto w-full max-w-content px-3 pt-3",children:b.jsxs("div",{className:"rounded-md border border-[var(--app-border)] bg-[var(--app-subtle-bg)] p-3 text-xs text-[var(--app-hint)]",children:["Terminal exited",g.code!==null?` with code ${g.code}`:"",g.signal?` (${g.signal})`:"","."]})}):null,b.jsx("div",{className:"flex-1 overflow-hidden bg-[var(--app-bg)]",children:b.jsx("div",{className:"mx-auto h-full w-full max-w-content p-3",children:b.jsx(_fe,{onMount:$,onResize:Y,className:"h-full w-full"})})}),b.jsx("div",{className:"bg-[var(--app-bg)] border-t border-[var(--app-border)] pb-[env(safe-area-inset-bottom)]",children:b.jsx("div",{className:"mx-auto w-full max-w-content px-3",children:b.jsxs("div",{className:"flex flex-col gap-2 py-2",children:[b.jsx("button",{type:"button",onClick:()=>{N()},disabled:Q,className:"w-full rounded-md border border-[var(--app-border)] bg-[var(--app-secondary-bg)] px-3 py-2 text-sm font-medium text-[var(--app-fg)] transition-colors hover:bg-[var(--app-subtle-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-button)] disabled:cursor-not-allowed disabled:opacity-50",children:e("button.paste")}),kfe.map((J,V)=>b.jsx("div",{className:"flex items-stretch overflow-hidden rounded-md bg-[var(--app-secondary-bg)]",children:J.map(ne=>{const he=ne.modifier,we=he==="ctrl"&&S||he==="alt"&&_;return b.jsx(Tfe,{input:ne,disabled:Q,isActive:we,onPress:G,onToggleModifier:H},ne.label)})},`terminal-quick-row-${V}`))]})})}),b.jsx(Ja,{open:x,onOpenChange:J=>{k(J),J||T("")},children:b.jsxs(Ho,{className:"max-w-md",children:[b.jsxs(Xa,{children:[b.jsx($o,{children:e("terminal.paste.fallbackTitle")}),b.jsx(ih,{children:e("terminal.paste.fallbackDescription")})]}),b.jsx("textarea",{value:A,onChange:J=>T(J.target.value),placeholder:e("terminal.paste.placeholder"),className:"mt-2 min-h-32 w-full resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-link)]",autoCapitalize:"none",autoCorrect:"off"}),b.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[b.jsx(Rn,{type:"button",variant:"secondary",onClick:()=>{k(!1),T("")},children:e("button.cancel")}),b.jsx(Rn,{type:"button",onClick:z,disabled:!A.trim(),children:e("button.paste")})]})]})})]})}const AL=[{value:"en",nativeLabel:"English"},{value:"zh-CN",nativeLabel:""}],ML=_9();function Rfe(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:b.jsx("polyline",{points:"15 18 9 12 15 6"})})}function I_(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:b.jsx("polyline",{points:"20 6 9 17 4 12"})})}function P_(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:b.jsx("polyline",{points:"6 9 12 15 18 9"})})}function Afe(){const{t:e,locale:t,setLocale:n}=ot(),i=Ka(),[s,r]=P.useState(!1),[a,o]=P.useState(!1),[l,u]=P.useState(!1),h=P.useRef(null),f=P.useRef(null),m=P.useRef(null),{fontScale:g,setFontScale:C}=aU(),[S,v]=P.useState(()=>localStorage.getItem("codex-voice-lang")),_=tU(),w=AL.find(E=>E.value===t),x=_.find(E=>E.value===g)?.label??"100%",k=ML.find(E=>E.code===S),A=E=>{n(E),r(!1)},T=E=>{C(E),o(!1)},M=E=>{v(E.code),E.code===null?localStorage.removeItem("codex-voice-lang"):localStorage.setItem("codex-voice-lang",E.code),u(!1)};return P.useEffect(()=>{if(!s&&!a&&!l)return;const E=L=>{s&&h.current&&!h.current.contains(L.target)&&r(!1),a&&f.current&&!f.current.contains(L.target)&&o(!1),l&&m.current&&!m.current.contains(L.target)&&u(!1)};return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[s,a,l]),P.useEffect(()=>{if(!s&&!a&&!l)return;const E=L=>{L.key==="Escape"&&(r(!1),o(!1),u(!1))};return document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)},[s,a,l]),b.jsxs("div",{className:"flex h-full flex-col",children:[b.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3 border-b border-[var(--app-border)]",children:[b.jsx("button",{type:"button",onClick:i,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:b.jsx(Rfe,{})}),b.jsx("div",{className:"flex-1 font-semibold",children:e("settings.title")})]})}),b.jsx("div",{className:"flex-1 overflow-y-auto",children:b.jsxs("div",{className:"mx-auto w-full max-w-content",children:[b.jsxs("div",{className:"border-b border-[var(--app-divider)]",children:[b.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-[var(--app-hint)] uppercase tracking-wide",children:e("settings.language.title")}),b.jsxs("div",{ref:h,className:"relative",children:[b.jsxs("button",{type:"button",onClick:()=>r(!s),className:"flex w-full items-center justify-between px-3 py-3 text-left transition-colors hover:bg-[var(--app-subtle-bg)]","aria-expanded":s,"aria-haspopup":"listbox",children:[b.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.language.label")}),b.jsxs("span",{className:"flex items-center gap-1 text-[var(--app-hint)]",children:[b.jsx("span",{children:w?.nativeLabel}),b.jsx(P_,{className:`transition-transform ${s?"rotate-180":""}`})]})]}),s&&b.jsx("div",{className:"absolute right-3 top-full mt-1 min-w-[160px] rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] shadow-lg overflow-hidden z-50",role:"listbox","aria-label":e("settings.language.title"),children:AL.map(E=>{const L=t===E.value;return b.jsxs("button",{type:"button",role:"option","aria-selected":L,onClick:()=>A(E.value),className:`flex items-center justify-between w-full px-3 py-2 text-base text-left transition-colors ${L?"text-[var(--app-link)] bg-[var(--app-subtle-bg)]":"text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)]"}`,children:[b.jsx("span",{children:E.nativeLabel}),L&&b.jsx("span",{className:"ml-2 text-[var(--app-link)]",children:b.jsx(I_,{})})]},E.value)})})]})]}),b.jsxs("div",{className:"border-b border-[var(--app-divider)]",children:[b.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-[var(--app-hint)] uppercase tracking-wide",children:e("settings.display.title")}),b.jsxs("div",{ref:f,className:"relative",children:[b.jsxs("button",{type:"button",onClick:()=>o(!a),className:"flex w-full items-center justify-between px-3 py-3 text-left transition-colors hover:bg-[var(--app-subtle-bg)]","aria-expanded":a,"aria-haspopup":"listbox",children:[b.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.display.fontSize")}),b.jsxs("span",{className:"flex items-center gap-1 text-[var(--app-hint)]",children:[b.jsx("span",{children:x}),b.jsx(P_,{className:`transition-transform ${a?"rotate-180":""}`})]})]}),a&&b.jsx("div",{className:"absolute right-3 top-full mt-1 min-w-[140px] rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] shadow-lg overflow-hidden z-50",role:"listbox","aria-label":e("settings.display.fontSize"),children:_.map(E=>{const L=g===E.value;return b.jsxs("button",{type:"button",role:"option","aria-selected":L,onClick:()=>T(E.value),className:`flex items-center justify-between w-full px-3 py-2 text-base text-left transition-colors ${L?"text-[var(--app-link)] bg-[var(--app-subtle-bg)]":"text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)]"}`,children:[b.jsx("span",{children:E.label}),L&&b.jsx("span",{className:"ml-2 text-[var(--app-link)]",children:b.jsx(I_,{})})]},E.value)})})]})]}),b.jsxs("div",{className:"border-b border-[var(--app-divider)]",children:[b.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-[var(--app-hint)] uppercase tracking-wide",children:e("settings.voice.title")}),b.jsxs("div",{ref:m,className:"relative",children:[b.jsxs("button",{type:"button",onClick:()=>u(!l),className:"flex w-full items-center justify-between px-3 py-3 text-left transition-colors hover:bg-[var(--app-subtle-bg)]","aria-expanded":l,"aria-haspopup":"listbox",children:[b.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.voice.language")}),b.jsxs("span",{className:"flex items-center gap-1 text-[var(--app-hint)]",children:[b.jsx("span",{children:k?k.code===null?e("settings.voice.autoDetect"):PR(k):e("settings.voice.autoDetect")}),b.jsx(P_,{className:`transition-transform ${l?"rotate-180":""}`})]})]}),l&&b.jsx("div",{className:"absolute right-3 top-full mt-1 min-w-[200px] max-h-[300px] overflow-y-auto rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] shadow-lg z-50",role:"listbox","aria-label":e("settings.voice.title"),children:ML.map(E=>{const L=S===E.code,D=E.code===null?e("settings.voice.autoDetect"):PR(E);return b.jsxs("button",{type:"button",role:"option","aria-selected":L,onClick:()=>M(E),className:`flex items-center justify-between w-full px-3 py-2 text-base text-left transition-colors ${L?"text-[var(--app-link)] bg-[var(--app-subtle-bg)]":"text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)]"}`,children:[b.jsx("span",{children:D}),L&&b.jsx("span",{className:"ml-2 text-[var(--app-link)]",children:b.jsx(I_,{})})]},E.code??"auto")})})]})]}),b.jsxs("div",{className:"border-b border-[var(--app-divider)]",children:[b.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-[var(--app-hint)] uppercase tracking-wide",children:e("settings.about.title")}),b.jsxs("div",{className:"flex w-full items-center justify-between px-3 py-3",children:[b.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.about.website")}),b.jsx("a",{href:"https://developers.openai.com/codex",target:"_blank",rel:"noopener noreferrer",className:"text-[var(--app-link)] hover:underline",children:"developers.openai.com/codex"})]}),b.jsxs("div",{className:"flex w-full items-center justify-between px-3 py-3",children:[b.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.about.appVersion")}),b.jsx("span",{className:"text-[var(--app-hint)]",children:"dev"})]}),b.jsxs("div",{className:"flex w-full items-center justify-between px-3 py-3",children:[b.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.about.protocolVersion")}),b.jsx("span",{className:"text-[var(--app-hint)]",children:LU})]})]})]})})]})}function Mfe(e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:b.jsx("polyline",{points:"15 18 9 12 15 6"})})}function Lfe(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),b.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function Ife(e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[b.jsx("circle",{cx:"12",cy:"12",r:"3"}),b.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}function Pfe(){const{api:e}=Pc(),t=Ts(),n=kd({select:C=>C.pathname}),i=h2(),{t:s}=ot(),{sessions:r,isLoading:a,error:o,refetch:l}=z3(e),u=P.useCallback(()=>{l()},[l]),h=new Set(r.map(C=>C.metadata?.worktree?.basePath??C.metadata?.path??"Other")).size,f=i({to:"/sessions/$sessionId",fuzzy:!0}),m=f&&f.sessionId!=="new"?f.sessionId:null,g=n==="/sessions"||n==="/sessions/";return b.jsxs("div",{className:"flex h-full min-h-0",children:[b.jsxs("div",{className:`${g?"flex":"hidden lg:flex"} w-full lg:w-[420px] xl:w-[480px] shrink-0 flex-col bg-[var(--app-bg)] lg:border-r lg:border-[var(--app-divider)]`,children:[b.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:b.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center justify-between px-3 py-2",children:[b.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:s("sessions.count",{n:r.length,m:h})}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("button",{type:"button",onClick:()=>t({to:"/settings"}),className:"p-1.5 rounded-full text-[var(--app-hint)] hover:text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)] transition-colors",title:s("settings.title"),children:b.jsx(Ife,{className:"h-5 w-5"})}),b.jsx("button",{type:"button",onClick:()=>t({to:"/sessions/new"}),className:"session-list-new-button p-1.5 rounded-full text-[var(--app-link)] transition-colors",title:s("sessions.new"),children:b.jsx(Lfe,{className:"h-5 w-5"})})]})]})}),b.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto desktop-scrollbar-left",children:[o?b.jsx("div",{className:"mx-auto w-full max-w-content px-3 py-2",children:b.jsx("div",{className:"text-sm text-red-600",children:o})}):null,b.jsx(Tde,{sessions:r,selectedSessionId:m,onSelect:C=>t({to:"/sessions/$sessionId",params:{sessionId:C}}),onNewSession:()=>t({to:"/sessions/new"}),onRefresh:u,isLoading:a,renderHeader:!1,api:e})]})]}),b.jsx("div",{className:`${g?"hidden lg:flex":"flex"} min-w-0 flex-1 flex-col bg-[var(--app-bg)]`,children:b.jsx("div",{className:"flex-1 min-h-0",children:b.jsx(Wm,{})})})]})}function Dfe(){return null}function Ofe(){const{api:e}=Pc(),{t}=ot(),n=Ka(),i=Ts(),s=Fr(),{addToast:r}=pC(),{sessionId:a}=jo({from:"/sessions/$sessionId"}),{session:o,refetch:l}=gx(e,a),{messages:u,warning:h,isLoading:f,isLoadingMore:m,hasMore:g,loadMore:C,refetch:S,pendingCount:v,messagesVersion:_,flushPending:w,setAtBottom:x}=Gde(e,a),{sendMessage:k,retryMessage:A,isSending:T}=ehe(e,a,{resolveSessionId:async j=>{if(!e||!o||o.active)return j;try{return await e.resumeSession(j)}catch(U){const q=U instanceof Error?U.message:"Resume failed";throw r({title:"Resume failed",body:q,sessionId:j,url:""}),U}},onSessionResolved:j=>{(async()=>{if(e){o&&j!==o.id&&(JU(o.id,j),s.setQueryData(Vt.session(j),{session:{...o,id:j,active:!0}}));try{await Promise.all([s.prefetchQuery({queryKey:Vt.session(j),queryFn:()=>e.getSession(j)}),sd(e,j)])}catch{}}i({to:"/sessions/$sessionId",params:{sessionId:j},replace:!0})})()},onBlocked:j=>{j==="no-api"&&r({title:t("send.blocked.title"),body:t("send.blocked.noConnection"),sessionId:a??"",url:""})}}),M=o?.metadata?.flavor??"claude",{getSuggestions:E}=Qde(e,a,M),{getSuggestions:L}=Xde(e,a),D=P.useCallback(async j=>j.startsWith("$")?await L(j):await E(j),[L,E]),O=P.useCallback(()=>{l(),S()},[S,l]);return o?b.jsx(mde,{api:e,session:o,messages:u,messagesWarning:h,hasMoreMessages:g,isLoadingMessages:f,isLoadingMoreMessages:m,isSending:T,pendingCount:v,messagesVersion:_,onBack:n,onRefresh:O,onLoadMore:C,onSend:k,onFlushPending:w,onAtBottomChange:x,onRetryMessage:A,autocompleteSuggestions:D}):b.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:b.jsx(mm,{label:"Loading session",className:"text-sm"})})}function Nfe(){const e=kd({select:s=>s.pathname}),{sessionId:t}=jo({from:"/sessions/$sessionId"}),n=`/sessions/${t}`;return e===n||e===`${n}/`?b.jsx(Ofe,{}):b.jsx(Wm,{})}function jfe(){const{api:e}=Pc(),t=Ts(),n=Ka(),i=Fr(),{machines:s,isLoading:r,error:a}=Kde(e,!0),o=P.useCallback(()=>{t({to:"/sessions"})},[t]),l=P.useCallback(u=>{i.invalidateQueries({queryKey:Vt.sessions}),t({to:"/sessions",replace:!0}),requestAnimationFrame(()=>{t({to:"/sessions/$sessionId",params:{sessionId:u}})})},[t,i]);return b.jsxs("div",{className:"flex-1 overflow-y-auto",children:[b.jsxs("div",{className:"flex items-center gap-2 border-b border-[var(--app-border)] bg-[var(--app-bg)] p-3 pt-[calc(0.75rem+env(safe-area-inset-top))]",children:[!SS()&&b.jsx("button",{type:"button",onClick:n,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:b.jsx(Mfe,{})}),b.jsx("div",{className:"flex-1 font-semibold",children:"Create Session"})]}),a?b.jsx("div",{className:"p-3 text-sm text-red-600",children:a}):null,b.jsx(Wde,{api:e,machines:s,isLoading:r,onCancel:o,onSuccess:l})]})}const xg=$6({component:XW}),Bfe=Xs({getParentRoute:()=>xg,path:"/",component:()=>b.jsx(M6,{to:"/sessions",replace:!0})}),wg=Xs({getParentRoute:()=>xg,path:"/sessions",component:Pfe}),Ffe=Xs({getParentRoute:()=>wg,path:"/",component:Dfe}),kg=Xs({getParentRoute:()=>wg,path:"$sessionId",component:Nfe}),Ufe=Xs({getParentRoute:()=>kg,path:"files",validateSearch:e=>{const t=typeof e.tab=="string"?e.tab:void 0,n=t==="directories"?"directories":t==="changes"?"changes":void 0;return n?{tab:n}:{}},component:Dhe}),zfe=Xs({getParentRoute:()=>kg,path:"terminal",component:Efe}),Hfe=Xs({getParentRoute:()=>kg,path:"file",validateSearch:e=>{const t=typeof e.path=="string"?e.path:"",n=e.staged===!0||e.staged==="true"?!0:e.staged===!1||e.staged==="false"?!1:void 0,i=typeof e.tab=="string"?e.tab:void 0,s=i==="directories"?"directories":i==="changes"?"changes":void 0,r={path:t};return n!==void 0&&(r.staged=n),s!==void 0&&(r.tab=s),r},component:qhe}),$fe=Xs({getParentRoute:()=>wg,path:"new",component:jfe}),qfe=Xs({getParentRoute:()=>xg,path:"/settings",component:Afe}),Vfe=xg.addChildren([Bfe,wg.addChildren([Ffe,$fe,kg.addChildren([zfe,Ufe,Hfe])]),qfe]);function Wfe(e){return J6({routeTree:Vfe,history:e,scrollRestoration:!0})}function Gfe(){const e=new URLSearchParams(window.location.search),t=e.get("startapp")||e.get("tgWebAppStartParam");return t||($s()?.initDataUnsafe?.start_param??null)}function Kfe(){const e=Gfe();return e?.startsWith("session_")?e.slice(8):null}function Yfe(){const e=Kfe();return e?`/sessions/${e}`:"/sessions"}async function Qfe(){oU();const e=g2();e&&await lU();const t=e?vF({initialEntries:[Yfe()]}):void 0,n=Wfe(t);g4.createRoot(document.getElementById("root")).render(b.jsx(Un.StrictMode,{children:b.jsx(g8,{children:b.jsxs(z4,{client:cU,children:[b.jsx(eU,{router:n}),null]})})}))}Qfe();
